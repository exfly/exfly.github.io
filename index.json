[{"categories":null,"content":" ExFly Keep It Simple \u0026 Stupid. ","date":"2014-10-01","objectID":"/about/:0:0","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"Description Focusing on computer technology, has basic operating system, computer network, data structure and algorithm knowledge, good at back-end, distributed, master certain data analysis knowledge, understand basic Linux server maintenance, understand the basic maintenance of the database, understand Basic network security, convinced that technology changes the world, and hopes to have a place in the computer industry. ","date":"2014-10-01","objectID":"/about/:1:0","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"Skills Golang \u003e Java \u003e Python \u003e others Distribution, Microservice Linux Docker DevOps k8s ","date":"2014-10-01","objectID":"/about/:2:0","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"Project ","date":"2014-10-01","objectID":"/about/:3:0","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"newdb Implement RDBMS ","date":"2014-10-01","objectID":"/about/:3:1","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"wiki wor2vec ","date":"2014-10-01","objectID":"/about/:3:2","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"DistributedSystems-MIT6.824 ","date":"2014-10-01","objectID":"/about/:3:3","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"pubsub ","date":"2014-10-01","objectID":"/about/:3:4","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"gracefully ","date":"2014-10-01","objectID":"/about/:3:5","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"money ","date":"2014-10-01","objectID":"/about/:3:6","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"jsonrpc boilerplate ","date":"2014-10-01","objectID":"/about/:3:7","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"dockerc ","date":"2014-10-01","objectID":"/about/:3:8","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"container-lab ","date":"2014-10-01","objectID":"/about/:3:9","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"go-mod-helper ","date":"2014-10-01","objectID":"/about/:3:10","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"ucore æ“ä½œç³»ç»Ÿ ","date":"2014-10-01","objectID":"/about/:3:11","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"ghttp a http server written by pure c ","date":"2014-10-01","objectID":"/about/:3:12","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"awesome blog springboot-ssm ","date":"2014-10-01","objectID":"/about/:3:13","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"graphql-mongo-boilerplate ","date":"2014-10-01","objectID":"/about/:3:14","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"openapi boilerplate ","date":"2014-10-01","objectID":"/about/:3:15","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"go cache in mem ","date":"2014-10-01","objectID":"/about/:3:16","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"Books Computer Science from the Bottom Up ç¿»è¯‘ Computer Science from the Bottom Up å®˜ç½‘ Distributed Query Processing (DQP) Operating System Concepts Operating Systems: Three Easy Pieces R870: Unix System Administration - A Survival Course ","date":"2014-10-01","objectID":"/about/:4:0","tags":null,"title":"å…³äº","uri":"/about/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šK3s è‡ªå¸¦çš„ CA æœ‰æ•ˆæœŸ 10 å¹´ï¼Œå…¶ç­¾å‘çš„ mTLS è¯ä¹¦åªæœ‰ 1 å¹´ï¼Œè¿œä¸èƒ½æ»¡è¶³â€œä¸€æ¬¡éƒ¨ç½²ã€é•¿æœŸå…è¿ç»´â€çš„ç”Ÿäº§è¯‰æ±‚ã€‚æœ¬æ–‡ç»™å‡ºé›¶ä¾µå…¥å¼æ–¹æ¡ˆï¼Œè®© K3s ä¸€æ¬¡æ€§ä½¿ç”¨ 100 å¹´æœ‰æ•ˆæœŸçš„ CA ä¸ç»ˆç«¯å®ä½“è¯ä¹¦ï¼ŒçœŸæ­£åšåˆ°â€œè¯ä¹¦ä¸€ç”Ÿåªè£…ä¸€æ¬¡â€ã€‚ ","date":"2025-07-27","objectID":"/k3s-100year-ca-certs/:0:0","tags":["k3s","devops","ops"],"title":"K3s ç™¾å¹´è¯ä¹¦","uri":"/k3s-100year-ca-certs/"},{"categories":null,"content":"èƒŒæ™¯ K3s é»˜è®¤è¯ä¹¦ç­–ç•¥ CA æœ‰æ•ˆæœŸï¼š10 å¹´ï¼ˆå†™æ­»ï¼Œä¸å¯é€šè¿‡å‚æ•°è°ƒæ•´ï¼‰ Server / Client è¯ä¹¦ï¼š1 å¹´ï¼ˆhard-coded 365 dï¼Œå¯é€šè¿‡ç¯å¢ƒå˜é‡å¾®è°ƒï¼‰ å¯¹äºè¾¹ç¼˜ã€ç¦»çº¿æˆ–æ— äººå€¼å®ˆåœºæ™¯ï¼Œ1 å¹´ä¸€æ¢è¯ä¹¦æ„å‘³ç€å·¨å¤§çš„è¿ç»´é£é™©ã€‚ç¤¾åŒºåœ¨ issue #3253 ä¸­æ—©å·²åé¦ˆè¯¥ç—›ç‚¹ï¼Œå®˜æ–¹è„šæœ¬å·²æä¾›â€œè‡ªå®šä¹‰ CAâ€èƒ½åŠ›ï¼Œä½†æœªç»™å‡ºå®Œæ•´ç™¾å¹´æ–¹æ¡ˆã€‚ ","date":"2025-07-27","objectID":"/k3s-100year-ca-certs/:1:0","tags":["k3s","devops","ops"],"title":"K3s ç™¾å¹´è¯ä¹¦","uri":"/k3s-100year-ca-certs/"},{"categories":null,"content":"æ•´ä½“æ€è·¯ æå‰ç”Ÿæˆè¶…é•¿å¯¿å‘½ CAï¼ˆ100 å¹´ï¼‰ K3s å¯åŠ¨æ—¶ç”Ÿæˆ CATTLE_NEW_SIGNED_CERT_EXPIRATION_DAYS æœ‰æ•ˆæœŸçš„ server/client cert åŒæ­¥è°ƒæ•´ Kubernetes æ§åˆ¶å¹³é¢ CSR æœ‰æ•ˆæœŸï¼ˆ100 å¹´ï¼‰ ","date":"2025-07-27","objectID":"/k3s-100year-ca-certs/:2:0","tags":["k3s","devops","ops"],"title":"K3s ç™¾å¹´è¯ä¹¦","uri":"/k3s-100year-ca-certs/"},{"categories":null,"content":"æ­¥éª¤ 1ï¼šç”Ÿæˆ 100 å¹´ CA åŠä¸­é—´è¯ä¹¦ k3s ä½¿ç”¨ certutil.NewSelfSignedCACert ç­¾å‘ CA è¯ä¹¦ï¼Œæœ‰æ•ˆæœŸæ˜¯å†™æ­»çš„ 10 å¹´ï¼Œè¿™ä¸ªå€¼ä¸æ˜¯å¾ˆç”Ÿäº§å¯ç”¨ã€‚ç¤¾åŒºä¹Ÿé‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œå…¶ä¸­ CA éƒ¨åˆ†é‡‡ç”¨çš„è§£å†³åŠæ³•æ˜¯è‡ªç­¾åä¸€ä¸ªè‡ªå®šä¹‰è¯ä¹¦ï¼Œè„šæœ¬é»˜è®¤ 20 å¹´è¯ä¹¦ï¼Œè¿™é‡Œæˆ‘ä»¬æ”¹æˆ 100 å¹´ï¼š --- \"ansible/files/generate-custom-ca-certs copy.sh\" 2024-08-06 17:43:32.663442036 +0800 +++ ansible/files/generate-custom-ca-certs.sh 2024-08-06 17:53:07.285515777 +0800 @@ -30,6 +30,11 @@ PRODUCT=\"${PRODUCT:-k3s}\" DATA_DIR=\"${DATA_DIR:-/var/lib/rancher/${PRODUCT}}\" +if [[ -d \"${DATA_DIR}/server/tls\" ]]; then + echo \"SKIPING: ${DATA_DIR}/server/tls is exists\" + exit 0 +fi + if type -t openssl-3 \u0026\u003e/dev/null; then OPENSSL=openssl-3 else @@ -93,7 +98,7 @@ else echo \"Generating root certificate authority RSA key and certificate\" ${OPENSSL} genrsa ${OPENSSL_GENRSA_FLAGS:-} -out root-ca.key 4096 - ${OPENSSL} req -x509 -new -nodes -sha256 -days 7300 \\ + ${OPENSSL} req -x509 -new -nodes -sha256 -days 37000 \\ -subj \"/CN=${PRODUCT}-root-ca@${TIMESTAMP}\" \\ -key root-ca.key \\ -out root-ca.pem \\ @@ -116,7 +121,7 @@ ${OPENSSL} req -new -nodes \\ -subj \"/CN=${PRODUCT}-intermediate-ca@${TIMESTAMP}\" \\ -key intermediate-ca.key | - ${OPENSSL} ca -batch -notext -days 3700 \\ + ${OPENSSL} ca -batch -notext -days 37000 \\ -in /dev/stdin \\ -out intermediate-ca.pem \\ -keyfile root-ca.key \\ @@ -139,7 +144,7 @@ ${OPENSSL} req -new -nodes \\ -subj \"/CN=${CERT_NAME}@${TIMESTAMP}\" \\ -key ${TYPE}-ca.key | - ${OPENSSL} ca -batch -notext -days 3700 \\ + ${OPENSSL} ca -batch -notext -days 37000 \\ -in /dev/stdin \\ -out ${TYPE}-ca.pem \\ -keyfile intermediate-ca.key \\ ä¿®æ”¹åæ‰§è¡Œå³å¯ï¼š bash k3s-generate-custom-ca-certs.sh ","date":"2025-07-27","objectID":"/k3s-100year-ca-certs/:2:1","tags":["k3s","devops","ops"],"title":"K3s ç™¾å¹´è¯ä¹¦","uri":"/k3s-100year-ca-certs/"},{"categories":null,"content":"æ­¥éª¤ 2ï¼šè°ƒæ•´ K3s Server / Client è¯ä¹¦æœ‰æ•ˆæœŸ k3s åˆ›å»º tls è¯ä¹¦ï¼Œå…¶ server è¯ä¹¦æœ‰æ•ˆæœŸæ˜¯ 365 å¤©ï¼Œå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ CATTLE_NEW_SIGNED_CERT_EXPIRATION_DAYS ä¿®æ”¹ä¸ºå¸Œæœ›çš„å€¼ï¼Œå•ä½å¤©ï¼š echo 'CATTLE_NEW_SIGNED_CERT_EXPIRATION_DAYS=36500' \u003e\u003e /etc/systemd/system/k3s.service.env ","date":"2025-07-27","objectID":"/k3s-100year-ca-certs/:2:2","tags":["k3s","devops","ops"],"title":"K3s ç™¾å¹´è¯ä¹¦","uri":"/k3s-100year-ca-certs/"},{"categories":null,"content":"æ­¥éª¤ 3ï¼šè®© Kubernetes CSR ä¹Ÿä¸€æ¬¡ç­¾ 100 å¹´ Kubernetes æ§åˆ¶å¹³é¢è‡ªå¸¦çš„ kube-controller-manager é»˜è®¤å¯¹ CSR ç­¾å‘ 1 å¹´ï¼Œå¯ä»¥è¦†ç›–è¿™ä¸ªé…ç½® /etc/rancher/k3s/config.yamlï¼š kube-controller-manager-arg: - cluster-signing-duration=876000h # 100year ","date":"2025-07-27","objectID":"/k3s-100year-ca-certs/:2:3","tags":["k3s","devops","ops"],"title":"K3s ç™¾å¹´è¯ä¹¦","uri":"/k3s-100year-ca-certs/"},{"categories":null,"content":"æœ€ç»ˆéªŒè¯ # æŸ¥çœ‹ CA æœ‰æ•ˆæœŸ openssl x509 -in /var/lib/rancher/k3s/server/tls/root-ca.pem -noout -dates # æŸ¥çœ‹ server è¯ä¹¦æœ‰æ•ˆæœŸ openssl x509 -in /var/lib/rancher/k3s/server/tls/serving-kube-apiserver.crt -noout -dates # æŸ¥çœ‹ kubelet client è¯ä¹¦æœ‰æ•ˆæœŸ openssl x509 -in /var/lib/rancher/k3s/agent/client-kubelet.crt -noout -dates ","date":"2025-07-27","objectID":"/k3s-100year-ca-certs/:2:4","tags":["k3s","devops","ops"],"title":"K3s ç™¾å¹´è¯ä¹¦","uri":"/k3s-100year-ca-certs/"},{"categories":null,"content":"ç»“è¯­ CA 100 å¹´ï¼ˆè„šæœ¬ä¸€æ¬¡æ€§ç”Ÿæˆï¼ŒK3s ç›´æ¥å¤ç”¨ï¼‰ Server / Client è¯ä¹¦ 100 å¹´ï¼ˆç¯å¢ƒå˜é‡æ§åˆ¶ï¼‰ Kubernetes CSR 100 å¹´ï¼ˆcontroller-manager å‚æ•°æ§åˆ¶ï¼‰ è‡³æ­¤ï¼Œä¸€æ¬¡éƒ¨ç½²ï¼Œè¯ä¹¦ç»ˆèº«å…è¿ç»´çš„ K3s é›†ç¾¤æ­£å¼å°±ç»ªã€‚ ","date":"2025-07-27","objectID":"/k3s-100year-ca-certs/:3:0","tags":["k3s","devops","ops"],"title":"K3s ç™¾å¹´è¯ä¹¦","uri":"/k3s-100year-ca-certs/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šæ¯å‘¨å…­ 11:00 å®šæ—¶å‡ºç°çš„ IO å»¶è¿Ÿï¼Œæœ€ç»ˆå®šä½åˆ° Raid å¡çš„åå°ä¸€è‡´æ€§æ£€æŸ¥ï¼ˆCC \u0026 PRï¼‰ã€‚å…³é—­åå»¶è¿Ÿæ¶ˆå¤±ï¼Œå¤ç›˜è®°å½•åœ¨æ­¤ã€‚ æœºå™¨æœºå™¨ raid ä¿¡æ¯ è°ƒæ•´å‰ç£ç›˜ etcd çš„ grep -E '(apply request took too lon)|(slow fdatasyn)' took è¶‹åŠ¿ï¼š å®¢æˆ·ç°åœºçš„æœºå™¨æ˜¯æµªæ½®çš„æ•´æœºï¼Œä¿¡æ¯å¦‚ä¸‹ï¼š TODO: ç¡®è®¤ä¸‹å®¢æˆ·æœºå™¨ä¿¡æ¯ æ ¹æ® io å»¶è¿Ÿçš„å‡ºç°æ—¶é—´ï¼Œåˆ¤æ–­æ¯å‘¨å…­çš„ 11:00 å‡ºç°çš„å®šæ—¶ä»»åŠ¡ï¼› ä¸šåŠ¡å±‚æ’æŸ¥ï¼šæ— å¯¹åº”å®šæ—¶ä»»åŠ¡ å®¿ä¸»æœºæ’æŸ¥ï¼šæ— å¼‚å¸¸è¿›ç¨‹ æ€€ç–‘ç¡¬ä»¶ä¸å‚å•†ç¡®è®¤ï¼šRaid å¡é»˜è®¤æ¯å‘¨å…­ 11:00 è¿è¡Œ Consistency Checkï¼ˆCCï¼‰ä¸ Patrol Readï¼ˆPRï¼‰ å…³é—­å etcd çš„å»¶è¿Ÿå‡ ä¹æ¶ˆå¤±ï¼š åœ¨å†…ç½‘æ‰¾äº† 3 å°åŒå‹å·æœºå™¨ï¼ˆRaid å¡ï¼šAVAGOMegaRAIDSAS9361-8iï¼‰ï¼Œ400 GB SSD RAID 1 å¹³å‡ Disk Average Wait Timeï¼š [root@TODO storcli]# ./storcli64 /c0 show ---------------------------------------------------------------------------------------- EID:Slt DID State DG Size Intf Med SED PI SeSz Model Sp Type ---------------------------------------------------------------------------------------- 252:0 14 Onln 0 446.625 GB SATA SSD N N 512B SAMSUNG MZ7LH480HAHQ-00005 U - 252:1 15 Onln 0 446.625 GB SATA SSD N N 512B SAMSUNG MZ7LH480HAHQ-00005 U - 252:2 8 Onln 1 7.276 TB SATA HDD N N 512B ST8000NM000A-2KE101 U - 252:3 9 Onln 1 7.276 TB SATA HDD N N 512B ST8000NM000A-2KE101 U - 252:5 11 Onln 1 7.276 TB SATA HDD N N 512B ST8000NM000A-2KE101 U - 252:6 12 Onln 1 7.276 TB SATA HDD N N 512B ST8000NM000A-2KE101 U - 252:7 13 Onln 1 7.276 TB SATA HDD N N 512B ST8000NM000A-2KE101 U - ---------------------------------------------------------------------------------------- [root@TODO storcli]# ./storcli64 /c0 show cc CLI Version = 007.3404.0000.0000 April 18, 2025 Operating system = Linux 3.10.0-1160.el7.x86_64 Controller = 0 Status = Success Description = None Controller Properties : ===================== ----------------------------------------------- Ctrl_Prop Value ----------------------------------------------- CC Operation Mode Concurrent CC Execution Delay 168 hours CC Next Starttime 07/26/2025, 03:00:00 CC Current State Stopped CC Number of iterations 164 CC Number of VD completed 2 CC Excluded VDs None ----------------------------------------------- [root@TODO storcli]# ./storcli64 /c0 show pr CLI Version = 007.3404.0000.0000 April 18, 2025 Operating system = Linux 3.10.0-1160.el7.x86_64 Controller = 0 Status = Success Description = None Controller Properties : ===================== --------------------------------------------- Ctrl_Prop Value --------------------------------------------- PR Mode Auto PR Execution Delay 168 hours PR iterations completed 120 PR Next Start time 07/26/2025, 03:00:00 PR on SSD Disabled PR Current State Stopped PR Excluded VDs None PR MaxConcurrentPd 248 --------------------------------------------- ssd ä¸Šå·²ç» disable äº† PRï¼Œåªæœ‰ ccï¼Œçœ‹èµ·æ¥ cc ç»™ç£ç›˜å¸¦æ¥äº†å¤§çº¦ 5ms Â± 15ms å·¦å³çš„ iowaitï¼Œè€Œå®¢æˆ·è¿™è¾¹ io wait è·Ÿæ¯”è¿™è¦é«˜éå¸¸å¤šã€‚ å‚è€ƒï¼šæµ…è°ˆ Raid å¡çš„ä¸¤ç§ä¸€è‡´æ€§æ ¡éªŒæ–¹å¼ï¼ˆPR\u0026CCï¼‰ æ‰¾äº†ç¡¬ä»¶å‚å•†çš„äººï¼Œåé¦ˆå›æ¥ï¼š å›  CC å’Œ PR æ ¡éªŒä¼šå½±å“ç¡¬ç›˜ IOï¼Œä¸åŒä¸šåŠ¡ç¯å¢ƒå¯¹å»¶è¿Ÿæ•æ„Ÿç¨‹åº¦ä¸åŒï¼Œç³»ç»Ÿä¸‹å—å½±å“çš„ç°è±¡ä¸åŒï¼Œç›®å‰æ¨èå¦‚ä¸‹ï¼š 1. CC å‘¨æœŸæ¨è 28 å¤©æ‰§è¡Œä¸€æ¬¡ï¼Œé»˜è®¤ Cc rate ä¸º 30%ï¼Œè¿™ä¸ª 30% æ˜¯ä¸€ä¸ªå¤§çº¦çš„ CPU æ—¶é—´å ç”¨æ¯”ä¾‹ï¼Œç”±è¿™ä¸ª rate å†³å®šå¤šä¹…è¿›è¡Œä¸€æ¬¡ Cc çš„åå°åŠ¨ä½œï¼Œä½†æ˜¯å³ä½¿é™åˆ° 0 ä¹Ÿä¼šå ç”¨ä¸€ç‚¹ CPUï¼Œå› ä¸º CC å¿…é¡»è¦åšã€‚ï¼ˆç›®å‰å·²è°ƒæ•´è‡³ 5%ï¼Œå·²ç»æœ€ä½ï¼‰ 2. å¦‚å®é™…ä¸šåŠ¡å¯¹å»¶è¿Ÿè¾ƒæ•æ„Ÿï¼Œè¯·è¯„ä¼°æ˜¯å¦å…³é—­ CCã€‚å…³é—­ CC åï¼Œå›  CC å¸¦æ¥çš„ IO æ€§èƒ½å’Œå»¶è¿Ÿå½±å“å¾—åˆ°æ”¹å–„ã€‚å»ºè®®å‚è€ƒ CC å¯¹æ€§èƒ½å’Œæ•°æ®å®‰å…¨çš„å½±å“è¿›è¡Œç»¼åˆè¯„ä¼°ã€‚å…³é—­ CC åï¼Œåœ¨é‡åˆ°ç›˜ç«¯æœ‰ä»‹è´¨é”™è¯¯çš„æ—¶å€™ï¼ŒRAID å¡ç«¯ä¼šèŠ±è´¹æ›´å¤šçš„æ—¶é—´æ¥å°è¯•è¯»å–æ•°æ®å¹¶æ ‡è®°ä¿®å¤å¼‚å¸¸æ•°æ®ï¼Œå¯èƒ½é€ æˆå»¶è¿Ÿå‡é«˜ï¼Œä¸¥é‡æƒ…å†µä¸‹ï¼Œå¦‚æœåŒæ¡å¸¦ä¸­å¤šä¸ªæ•°æ®é”™è¯¯å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ æ¥ä¸‹æ¥ç»§ç»­ç­‰å¾…ç¡¬ä»¶å‚å•†çš„ debug ç»“æœå§ã€‚ ","date":"2025-07-20","objectID":"/raid-cc-causes-disk-io-lantency-increase/:0:0","tags":["k8s","debug","raid","io"],"title":"Raid å¡ Consistency Check å¯¼è‡´ io å»¶è¿Ÿå˜é«˜","uri":"/raid-cc-causes-disk-io-lantency-increase/"},{"categories":null,"content":"åç»­ ç­‰å¾…å‚å•†è¿›ä¸€æ­¥ debug å¯¹ etcd åœºæ™¯è€Œè¨€ï¼Œå·²æœ‰ snapshot + 12 h å¤‡ä»½ï¼Œå¯ç›´æ¥å…³é—­ CC ä»¥æ¢å–ç¡®å®šæ€§ä½å»¶è¿Ÿ æ˜¯å¦å¯å°† etcd æ•°æ®ç›®å½•ç›´æ¥æ”¾ tmpfsï¼Ÿéœ€è¯„ä¼°å†…å­˜å®¹é‡ä¸æ–­ç”µé£é™© ","date":"2025-07-20","objectID":"/raid-cc-causes-disk-io-lantency-increase/:1:0","tags":["k8s","debug","raid","io"],"title":"Raid å¡ Consistency Check å¯¼è‡´ io å»¶è¿Ÿå˜é«˜","uri":"/raid-cc-causes-disk-io-lantency-increase/"},{"categories":null,"content":"ç»“è®º Raid å¡ä¸æ˜¯å…è´¹çš„åˆé¤ï¼Œåå°ç»´æŠ¤ä»»åŠ¡åŒæ ·æ¶ˆè€—èµ„æºã€‚åœ¨å»¶è¿Ÿæ•æ„Ÿå‹ä¸šåŠ¡ä¸­ï¼Œéœ€è¦æ˜¾å¼æƒè¡¡æ•°æ®å®‰å…¨ä¸æ€§èƒ½ã€‚ ","date":"2025-07-20","objectID":"/raid-cc-causes-disk-io-lantency-increase/:2:0","tags":["k8s","debug","raid","io"],"title":"Raid å¡ Consistency Check å¯¼è‡´ io å»¶è¿Ÿå˜é«˜","uri":"/raid-cc-causes-disk-io-lantency-increase/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šnetstat -s å·²ç»åºŸå¼ƒï¼Œä¸€äº›æœºå™¨å·²ç»ä¸å†…ç½®ï¼Œä½† ss å’Œ nstat æ˜¯å†…ç½®çš„ã€‚æœ¬æ–‡é€šè¿‡ä»£ç æè¿°ä»–ä¿©ä¹‹é—´è¿ç§»çš„æ–¹æ³•ã€‚ netstat -s è¯»å– /proc/net/netstatï¼Œæ‰€æœ‰å‚æ•°ä¼šç”±è¿™ä¸ª table å¯¹åº”èµ·æ¥ï¼Œè¿›è€Œå±•ç¤º å³ä¾§äººå¯è¯»ä¿¡æ¯ã€‚ä»£ç è§ è¿™é‡Œã€‚ è¯´ç»“è®ºå§ï¼š ä¾‹å¦‚ï¼š netstat -s | grep -i 'invalid SYN cookies received' 87441 invalid SYN cookies received åœ¨ è¿™é‡Œ æœç´¢ invalid SYN cookies received å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š {\"SyncookiesFailed\", N_(\"%llu invalid SYN cookies received\"), opt_number}, å¯ä»¥çœ‹åˆ° SyncookiesFailedï¼Œåˆ™å¯¹åº”çš„æ›´ç°ä»£çš„ nstat å¯¹åº”èµ·æ¥å°±æ˜¯ï¼š nstat -s -za | grep SyncookiesFailed TcpExtSyncookiesFailed 87441 0.0 ç»“æœ 87441 å¯ä»¥å¯¹åº”ä¸Šã€‚ è¯¦ç»† table è§ï¼š https://github.com/ecki/net-tools/blob/master/statistics.c#L223 ","date":"2025-04-10","objectID":"/netstat-migrate-to-ss-nstat/:0:0","tags":["linux","ops","network"],"title":"Netstat Migrate to Ss Nstat","uri":"/netstat-migrate-to-ss-nstat/"},{"categories":null,"content":"nstat -s -za nstat -s -za ä¼šç›´æ¥æ ¹æ® /proc/net/netstat ä¸­çš„ä¸Šä¸‹çº§å…³ç³»ç›´æ¥æ‹¼æ¥ æ¯”å¦‚ï¼š cat /proc/net/netstat TcpExt: SyncookiesSent SyncookiesRecv SyncookiesFailed TcpExt: 0 0 6248048 netstat -s | grep -i 'SYN cookies received' 6248058 invalid SYN cookies received nstat -s -za | grep SyncookiesFailed TcpExtSyncookiesFailed 6248058 0.0 å…¶ä¸­ TcpExtSyncookiesFailed éƒ¨åˆ†æ°å¥½ä¸º TcpExt+SyncookiesFailed å¦å¤– /proc/net/netstat å¯¹åº”çš„é—®é¢˜å†è¿™é‡Œ å¯¹åº”çš„å†…æ ¸ä»£ç åœ¨è¿™é‡Œ ","date":"2025-04-10","objectID":"/netstat-migrate-to-ss-nstat/:1:0","tags":["linux","ops","network"],"title":"Netstat Migrate to Ss Nstat","uri":"/netstat-migrate-to-ss-nstat/"},{"categories":null,"content":"ref https://blog.csdn.net/yscisco/article/details/121443965 ","date":"2025-04-10","objectID":"/netstat-migrate-to-ss-nstat/:2:0","tags":["linux","ops","network"],"title":"Netstat Migrate to Ss Nstat","uri":"/netstat-migrate-to-ss-nstat/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šGitea Earthly æ„å»ºæ—¶é—´ä» 1m30s ä¼˜åŒ–åˆ° 11s ","date":"2025-04-06","objectID":"/gitea-earthly-speedup-from-1m30s-to-11s/:0:0","tags":["homelab","docker","gitea","actions"],"title":"Gitea Earthly æ„å»ºæ—¶é—´ä» 1m30s ä¼˜åŒ–åˆ° 11s","uri":"/gitea-earthly-speedup-from-1m30s-to-11s/"},{"categories":null,"content":"èƒŒæ™¯ åœ¨æˆ‘çš„ homelab server ä¸Šæ­å»ºäº†ä¸€å¥— gitea + actions cicd å¹³å°ï¼Œä½¿ç”¨ docker + earthly æ„å»º golang ç¨‹åºã€‚workflow å¦‚ä¸‹ï¼š name: Gitea Actions Demo run-name: ${{ gitea.actor }} is testing out Gitea Actions ğŸš€ on: push: schedule: - cron: '30 5 * * */2' # æ¯ä¸¤å¤© jobs: Explore-Gitea-Actions: runs-on: ubuntu-latest steps: - run: echo \"ğŸ‰ The job was automatically triggered by a ${{ gitea.event_name }} event.\" - run: echo \"ğŸ§ This job is now running on a ${{ runner.os }} server hosted by Gitea!\" - run: echo \"ğŸ” The name of your branch is ${{ gitea.ref }} and your repository is ${{ gitea.repository }}.\" - name: Check out repository code # uses: actions/checkout@v3 uses: https://gitea.com/actions/checkout@v4 with: fetch-depth: 0 - name: install docker client run: | sed -E -i -e 's/(archive|ports|security).ubuntu.com/mirrors.dev.domain/g' /etc/apt/sources.list.d/ubuntu.sources apt update \u0026\u0026 apt install sudo sh .gitea/workflows/get-docker.sh --mirror Exfly ls -alh /var/run/ # truenas ä¸­ä¸æ”¯æŒ å®‰è£… qemuï¼Œæ•…é™åˆ¶äº† crosscompile # - name: Set up QEMU # id: qemu # # docker/setup-qemu-action@v1 # uses: https://gitee.com/exfly/setupqemuaction@v1 # with: # image: docker.m.daocloud.io/tonistiigi/binfmt:latest # platforms: all # - run: /bin/sh -c \"wget https://mirror.ghproxy.com/https://github.com/earthly/earthly/releases/latest/download/earthly-linux-amd64 -O /usr/local/bin/earthly \u0026\u0026 chmod +x /usr/local/bin/earthly \u0026\u0026 /usr/local/bin/earthly bootstrap --with-autocomplete\" - uses: https://gitee.com/exfly/earthly-actions-setup@main with: version: \"v0.8.1\" # version: v0.7.2 - name: Earthly version run: earthly --version - name: Run build run: earthly -V --buildkit-image=docker.1ms.run/earthly/buildkitd:v0.8.3 +build - run: echo \"ğŸ’¡ The ${{ gitea.repository }} repository has been cloned to the runner.\" - run: echo \"ğŸ–¥ï¸ The workflow is now ready to test your code on the runner.\" - name: List files in the repository run: | ls ${{ gitea.workspace }} - run: echo \"ğŸ This job's status is ${{ gitea.status }}.\" åˆ†æä¸‹ docker çš„å®‰è£…å ç”¨äº†å¤§é‡æ—¶é—´ï¼›å¦ä¸€éƒ¨åˆ†ç”±äº earthly-actions-setup ä» github ä¸­ä¸‹è½½ earthlyï¼Œä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œéå¸¸ä¸ç¨³å®šï¼Œè¿˜å¥½æœ‰æ­£å¸¸å¯ä»¥è®¿é—®æ—¶å€™çš„ cacheï¼Œæ¶ˆè€—æ—¶é—´æ¯”è¾ƒçŸ­ã€‚ å¯ä»¥åŸºäº ubuntu-latest æ·»åŠ  earthly + docker-clientï¼Œçœ‹çœ‹æ•ˆæœï¼š ","date":"2025-04-06","objectID":"/gitea-earthly-speedup-from-1m30s-to-11s/:1:0","tags":["homelab","docker","gitea","actions"],"title":"Gitea Earthly æ„å»ºæ—¶é—´ä» 1m30s ä¼˜åŒ–åˆ° 11s","uri":"/gitea-earthly-speedup-from-1m30s-to-11s/"},{"categories":null,"content":"æ€»ç»“ ci çš„ä¼˜åŒ–ç©ºé—´ä»å‡ åˆ†é’Ÿå·²ç»ä¼˜åŒ–åˆ° 11sï¼Œæ–¹æ³•å°±æ˜¯å°†å®æ—¶å®‰è£…ä¾èµ–è½¬ä¸ºæ”¾åˆ°åŸºç¡€é•œåƒä¸­ã€‚ ","date":"2025-04-06","objectID":"/gitea-earthly-speedup-from-1m30s-to-11s/:2:0","tags":["homelab","docker","gitea","actions"],"title":"Gitea Earthly æ„å»ºæ—¶é—´ä» 1m30s ä¼˜åŒ–åˆ° 11s","uri":"/gitea-earthly-speedup-from-1m30s-to-11s/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šé€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»ï¼›æ¢è®¨å¦‚ä½•æ§åˆ¶ååï¼›å®éªŒ curl é™é€Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼› æŒ‰ç…§ï¼šTCP æ€§èƒ½å’Œå‘é€æ¥æ”¶çª—å£ã€Buffer çš„å…³ç³» | plantegg å®éªŒè°ƒæ•´ RTã€æ§åˆ¶æ­»å†…æ ¸ tcp bufferï¼Œè®©é€Ÿåº¦éšç€ RT å¢åŠ æ…¢ä¸‹æ¥ã€‚å®éªŒå¤§è‡´è¿‡ç¨‹æ˜¯å…ˆåˆ›å»ºä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ–‡ä»¶ï¼Œä½¿ç”¨ python å¼€ä¸€ä¸ª http serverï¼Œè°ƒæ•´ tcp çš„é…ç½®ä¿¡æ¯ï¼Œåœ¨å¦ä¸€å°æœºå™¨ä¸Šä½¿ç”¨ curl ä¸‹è½½è¿™ä¸ªå¤§æ–‡ä»¶ï¼Œä½¿ç”¨ tcpdump æŠ“åŒ…åä½¿ç”¨ wireshark åˆ†æç»“æœã€‚ ","date":"2025-02-23","objectID":"/the-relationship-between-bdp-buffer-rt/:0:0","tags":["linux","curl","network","å®éªŒ"],"title":"é€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»","uri":"/the-relationship-between-bdp-buffer-rt/"},{"categories":null,"content":"æ­å»ºç¯å¢ƒ æˆ‘çš„ Macbook M1 ä¸‹ä½¿ç”¨ vagrant + vmware åˆ›å»ºè™šæ‹Ÿæœºå¦‚ä¸‹ï¼š # -*- mode: ruby -*- # vi: set ft=ruby : Vagrant.configure(\"2\") do |config| (1..2).each do |i| #å®šä¹‰èŠ‚ç‚¹å˜é‡ config.vm.define \"node#{i}\" do |node| # box é…ç½® node.vm.box = \"bento/rockylinux-9\" # è®¾ç½®è™šæ‹Ÿæœºçš„ä¸»æœºå node.vm.hostname = \"node#{i}\" # è®¾ç½®è™šæ‹Ÿæœºçš„ IP # node.vm.network \"private_network\", ip: \"192.168.60.#{10+i}\" node.vm.synced_folder \".\", \"/vagrant\", disabled: true # vagrant rsync-auto --debug # https://developer.hashicorp.com/vagrant/docs/synced-folders/rsync node.vm.synced_folder \".\", \"/vagrant\", type: \"rsync\", rsync__exclude: [\".git/\", \"docs/\", \".vagrant/\"], rsync__args: [\"--verbose\", \"--rsync-path='sudo rsync'\", \"--archive\", \"-z\"] node.vm.provider :vmware_desktop do |vmware| vmware.vmx[\"ethernet0.pcislotnumber\"] = \"160\" end # è®¾ç½®ä¸»æœºä¸è™šæ‹Ÿæœºçš„å…±äº«ç›®å½• # VirtaulBox ç›¸å…³é…ç½® node.vm.provision \"shell\", inline: \u003c\u003c-SHELL echo \"hello\" sed -e 's|^mirrorlist=|#mirrorlist=|g' \\ -e 's|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.ustc.edu.cn/rocky|g' \\ -i.bak \\ /etc/yum.repos.d/rocky-extras.repo \\ /etc/yum.repos.d/rocky.repo yum install -y yum-utils yum-config-manager --add-repo https://mirrors.ustc.edu.cn/docker-ce/linux/centos/docker-ce.repo sed -i 's+https://download.docker.com+https://mirrors.ustc.edu.cn/docker-ce+' /etc/yum.repos.d/docker-ce.repo dnf makecache # dnf install -y epel-release \u0026\u0026 dnf makecache yum install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin tmux nc nmap systemctl enable --now docker # https://github.com/iovisor/bcc/blob/master/INSTALL.md#rhel---binary # export PATH=\"/usr/share/bcc/tools:$PATH\" yum install -y bcc-tools # https://tshark.dev/setup/install/ yum install -y tcpdump net-tools gdb dstat zip wireshark-cli SHELL end # end config.vm.define node end # end each 3 node end å…±åˆ›å»ºäº†ä¸¤ä¸ª vmï¼Œä¸€ä¸ªæ˜¯ VM1 å’Œ VM2 export VM1=192.168.245.151 export VM2=192.168.245.152 # ç”Ÿæˆ 2g çš„æ–‡ä»¶ test.txt fallocate -l 2G test.txt # ç”Ÿæˆ 2g æ–‡ä»¶ï¼Œls \u0026 du éƒ½æ˜¯ 2g python3 -m http.server 8089 # åœ¨ VM2 ä¸­è®¿é—® vm çš„è¿™ä¸ªæ–‡ä»¶ curl -v --output /tmp/test.txt http://{VM1}:8089/test.txt å½“å‰çš„ sysctl å‚æ•°å¦‚ä¸‹ï¼š sysctl -a | egrep \"rmem|wmem|tcp_mem|adv_win|moderate\" net.core.rmem_default = 212992 net.core.rmem_max = 212992 net.core.wmem_default = 212992 net.core.wmem_max = 212992 net.ipv4.tcp_adv_win_scale = 1 net.ipv4.tcp_mem = 18852 25136 37704 net.ipv4.tcp_moderate_rcvbuf = 1 net.ipv4.tcp_rmem = 4096 131072 6291456 net.ipv4.tcp_wmem = 4096 4096 4096 net.ipv4.udp_rmem_min = 4096 net.ipv4.udp_wmem_min = 4096 vm.lowmem_reserve_ratio = 256 256 32 0 0 ä¸‹é¢çš„å®ç°ä¼šè°ƒæ•´ rmem å’Œ wmem çš„å¤§å°åšç›¸å…³çš„å®éªŒ å…ˆæ•´ä½“çœ‹ä¸‹å®éªŒçš„ç»“æœï¼š group rmem(bytes) window(bytes) rtt(ms) throughput(KB/s) dup ack(%) retransmission(%) outoforder(%) packetcount benchmark 4096 1040 2 3,079 0 0 0 66086 10ms 4096 1040 10 108 0 0 0 2239 20ms 4096 1040 20 58 0 0 0 1263 40ms 4096 1040 40 30 0 0 0 644 80ms 4096 1040 80 15 0 0 0 348 100ms 4096 1040 100 12 0 0 0 283 1%lose 4096 1040 2 1651 0.63% 0.50% 0.12% 36264 10%lose 4096 1040 2 202 250/5057=5.00% 97/5057=1.90% 152/5057=3.00% 5057 ","date":"2025-02-23","objectID":"/the-relationship-between-bdp-buffer-rt/:1:0","tags":["linux","curl","network","å®éªŒ"],"title":"é€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»","uri":"/the-relationship-between-bdp-buffer-rt/"},{"categories":null,"content":"å®éªŒ 1 å›ºå®š rmem å’Œ wmemï¼Œå¢åŠ å»¶è¿Ÿ sysctl -w \"net.ipv4.tcp_rmem=4096 4096 4096\" //æœ€å°å€¼ é»˜è®¤å€¼ æœ€å¤§å€¼ sysctl -w \"net.ipv4.tcp_wmem=4096 4096 4096\" ","date":"2025-02-23","objectID":"/the-relationship-between-bdp-buffer-rt/:2:0","tags":["linux","curl","network","å®éªŒ"],"title":"é€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»","uri":"/the-relationship-between-bdp-buffer-rt/"},{"categories":null,"content":"æ§åˆ¶ rmem å’Œ wmem åœ¨ 4096ï¼Œæ— å»¶è¿Ÿ ååä¸ºï¼š2.110**7 bits/s = python3 -c â€˜print(2.110**7/8/1024)â€™ = 2563.48 KB/s TODO: è¿™ä¸ªå€¼è·Ÿ wireshark Capture File Properties æ˜¾ç¤ºçš„ 3,079KB/s æœ‰å‡ºå…¥ï¼Œéœ€è¦çœ‹çœ‹ RT éå¸¸å° ","date":"2025-02-23","objectID":"/the-relationship-between-bdp-buffer-rt/:2:1","tags":["linux","curl","network","å®éªŒ"],"title":"é€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»","uri":"/the-relationship-between-bdp-buffer-rt/"},{"categories":null,"content":"ç°åœ¨å¢åŠ å»¶è¿Ÿåˆ° 10ms tc qdisc add dev eth0 root netem delay 10ms [root@node2 vagrant]# ping $VM1 PING 192.168.245.151 (192.168.245.151) 56(84) bytes of data. 64 bytes from 192.168.245.151: icmp_seq=1 ttl=64 time=24.5 ms 64 bytes from 192.168.245.151: icmp_seq=2 ttl=64 time=11.9 ms 64 bytes from 192.168.245.151: icmp_seq=3 ttl=64 time=10.7 ms 64 bytes from 192.168.245.151: icmp_seq=4 ttl=64 time=11.7 ms 64 bytes from 192.168.245.151: icmp_seq=5 ttl=64 time=11.4 ms curl -v --output test.txt http://$VM1:8089/test.txt 92104bytes/s æ¯ä¸ªå°é˜¶çš„æ—¶é—´å¤§æ¦‚æ˜¯ 10msï¼Œè¯´æ˜ 10ms ç”Ÿæ•ˆäº† å¯ä»¥çœ‹åˆ°ååä¸åˆ° 700000bits/s = python3 -c â€˜print(700000/8/1024)â€™ = 85.45 KB/s çœ‹æŠ¥æ–‡ä¸­ Calculated window size: 1040 ","date":"2025-02-23","objectID":"/the-relationship-between-bdp-buffer-rt/:2:2","tags":["linux","curl","network","å®éªŒ"],"title":"é€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»","uri":"/the-relationship-between-bdp-buffer-rt/"},{"categories":null,"content":"å°ç»“ å›ºå®š rmemã€wmemï¼Œéšç€å»¶è¿Ÿçš„å¢åŠ ï¼Œååä¹Ÿéšä¹‹é™ä½ã€‚ åšäº†å‡ ä¸ªå®éªŒï¼Œåˆ†åˆ«æ˜¯ 10msã€20msã€30msã€40msï¼Œå¯ä»¥çœ‹åˆ°å‘åŒ…è§„å¾‹ï¼Œå‡è®¾å‘åŒ…å¤§å°åŠå»¶è¿Ÿçš„å›ºå®šçš„ï¼ˆå³æ’é™¤ç½‘ç»œæ³¢åŠ¨ï¼‰ï¼Œå¯ä»¥å¾—åˆ°æ•°å­¦å…¬å¼ï¼Œä½¿ç”¨ python å®ç°ä¸ºï¼š '''window å•ä½ bytes, rtt å•ä½ ms''' def throughput(window: int, rtt: int): return window * (1000/rtt)/1024 å¦‚åœ¨ 10msã€window size 1040bytes ä¸‹çš„ååä¸º print(throughput(1040, 10)) 101.5625 101 ç›¸è¾ƒ 85.45 æœ‰ä¸€äº›è¯¯å·®ï¼Œç½‘ç»œä¼ è¾“æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œæ•…ä¼šæœ‰å·®è·ï¼›å¯ä»¥ä½¿ç”¨æ­¤å…¬å¼ä¼°ç®—ç½‘ç»œååã€‚ ","date":"2025-02-23","objectID":"/the-relationship-between-bdp-buffer-rt/:2:3","tags":["linux","curl","network","å®éªŒ"],"title":"é€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»","uri":"/the-relationship-between-bdp-buffer-rt/"},{"categories":null,"content":"å®éªŒ 2 å›ºå®š rmem å’Œ wmemï¼Œå¢åŠ ä¸¢åŒ…ç‡ seq æ›²çº¿éå¸¸å¼¯ï¼Œå‘åŒ…ä¸ç¨³å®š ä¸¢åŒ…ä¼šè®©ååå˜çš„ä¸ç¨³å®š ","date":"2025-02-23","objectID":"/the-relationship-between-bdp-buffer-rt/:3:0","tags":["linux","curl","network","å®éªŒ"],"title":"é€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»","uri":"/the-relationship-between-bdp-buffer-rt/"},{"categories":null,"content":"å°ç»“ ä¸¢åŒ…ä¼šå‡ºç°é‡ä¼ ï¼Œé‡ä¼ å¾ˆæ…¢ï¼Œååæ³¢åŠ¨æ¯”è¾ƒå¤§ã€‚éšç€ä¸¢åŒ…ç‡çš„æé«˜ï¼Œæ³¢åŠ¨ä¼šè¿›ä¸€æ­¥å˜å¤§ï¼Œåååœ¨å‡å°ã€‚ ","date":"2025-02-23","objectID":"/the-relationship-between-bdp-buffer-rt/:3:1","tags":["linux","curl","network","å®éªŒ"],"title":"é€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»","uri":"/the-relationship-between-bdp-buffer-rt/"},{"categories":null,"content":"å®éªŒ 3 åˆ†åˆ«è®¾ç½® rmem å’Œ wmem TODO: æŠ“åŒ…è¯•ä¸€ä¸‹ å¯ä»¥çœ‹åˆ°å¯¹ client çš„ rmem é™åˆ¶çš„æ—¶å€™ï¼Œä¼šå‡ºç°å¤§é‡çš„ TCP Window Fullï¼Œè€Œå¯¹ server çš„ wmem é™åˆ¶åˆ™ä¸ä¼šæœ‰éå¸¸å¤§çš„å½±å“ã€‚client rmem è¯»å–åï¼Œéœ€è¦ä¸€ä¸ª rtt æ—¶é—´æ‰èƒ½é€šçŸ¥åˆ° server å¯ä»¥å‘é€ï¼Œæ•…å¯¹ååçš„å½±å“æ›´å¤§ï¼›è€Œ server wmem ä½¿ç”¨å®Œåï¼Œåªéœ€ç­‰å¾…å‘é€å®Œé‡æ–°ç”³è¯·å†…å­˜å³å¯ï¼Œå»¶è¿Ÿä¸ºå†…å­˜å»¶è¿Ÿï¼Œå¯¹ååå½±å“å°ã€‚ å¦‚ä¸‹å›¾ï¼Œå¯ä»¥æ›´ç›´è§‚çš„å±•ç¤º rmem/wmem å¯¹ååå½±å“çš„åŸå› ã€‚ ","date":"2025-02-23","objectID":"/the-relationship-between-bdp-buffer-rt/:4:0","tags":["linux","curl","network","å®éªŒ"],"title":"é€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»","uri":"/the-relationship-between-bdp-buffer-rt/"},{"categories":null,"content":"å®éªŒ 4 curl é™é€Ÿ åŸºäºç‰ˆæœ¬ 8.12.1 æ ¸å¿ƒæ•°æ®ç»“æ„ã€å…³é”®å‡½æ•°ã€ç®—æ³•é€»è¾‘ã€è°ƒç”¨æµç¨‹ 4 ä¸ªæ–¹é¢åˆ†æ ","date":"2025-02-23","objectID":"/the-relationship-between-bdp-buffer-rt/:5:0","tags":["linux","curl","network","å®éªŒ"],"title":"é€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»","uri":"/the-relationship-between-bdp-buffer-rt/"},{"categories":null,"content":"æ•°æ®ç»“æ„ struct pgrs_measure { struct curltime start; /* when measure started */ curl_off_t start_size; /* the 'cur_size' the measure started at */ }; struct pgrs_dir { curl_off_t total_size; /* total expected bytes */ curl_off_t cur_size; /* transferred bytes so far */ curl_off_t speed; /* bytes per second transferred */ struct pgrs_measure limit; }; ","date":"2025-02-23","objectID":"/the-relationship-between-bdp-buffer-rt/:5:1","tags":["linux","curl","network","å®éªŒ"],"title":"é€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»","uri":"/the-relationship-between-bdp-buffer-rt/"},{"categories":null,"content":"å…³é”®ä»£ç  Curl_pgrsStartNow å‡½æ•°åˆå§‹åŒ–é™é€Ÿç›¸å…³çš„åˆå§‹çŠ¶æ€ void Curl_pgrsStartNow(struct Curl_easy *data) { data-\u003eprogress.speeder_c = 0; /* reset the progress meter display */ data-\u003eprogress.start = Curl_now(); data-\u003eprogress.is_t_startransfer_set = FALSE; data-\u003eprogress.ul.limit.start = data-\u003eprogress.start; data-\u003eprogress.dl.limit.start = data-\u003eprogress.start; data-\u003eprogress.ul.limit.start_size = 0; data-\u003eprogress.dl.limit.start_size = 0; data-\u003eprogress.dl.cur_size = 0; data-\u003eprogress.ul.cur_size = 0; /* clear all bits except HIDE and HEADERS_OUT */ data-\u003eprogress.flags \u0026= PGRS_HIDE|PGRS_HEADERS_OUT; Curl_ratelimit(data, data-\u003eprogress.start); } Curl_pgrsLimitWaitTime è®¡ç®—åœ¨éœ€è¦ç­‰å¾…å¤šå°‘æ¯«ç§’æ‰èƒ½å›åˆ°é€Ÿåº¦é™åˆ¶ä»¥ä¸‹ /* * This is used to handle speed limits, calculating how many milliseconds to * wait until we are back under the speed limit, if needed. * * The way it works is by having a \"starting point\" (time \u0026 amount of data * transferred by then) used in the speed computation, to be used instead of * the start of the transfer. This starting point is regularly moved as * transfer goes on, to keep getting accurate values (instead of average over * the entire transfer). * * This function takes the current amount of data transferred, the amount at * the starting point, the limit (in bytes/s), the time of the starting point * and the current time. * * Returns 0 if no waiting is needed or when no waiting is needed but the * starting point should be reset (to current); or the number of milliseconds * to wait to get back under the speed limit. */ timediff_t Curl_pgrsLimitWaitTime(struct pgrs_dir *d, curl_off_t speed_limit, struct curltime now) { curl_off_t size = d-\u003ecur_size - d-\u003elimit.start_size; timediff_t minimum; timediff_t actual; if(!speed_limit || !size) return 0; /* * 'minimum' is the number of milliseconds 'size' should take to download to * stay below 'limit'. */ if(size \u003c CURL_OFF_T_MAX/1000) minimum = (timediff_t) (CURL_OFF_T_C(1000) * size / speed_limit); else { minimum = (timediff_t) (size / speed_limit); if(minimum \u003c TIMEDIFF_T_MAX/1000) minimum *= 1000; else minimum = TIMEDIFF_T_MAX; } /* * 'actual' is the time in milliseconds it took to actually download the * last 'size' bytes. */ actual = Curl_timediff_ceil(now, d-\u003elimit.start); if(actual \u003c minimum) { /* if it downloaded the data faster than the limit, make it wait the difference */ return minimum - actual; } return 0; } /* * Update the timestamp and sizestamp to use for rate limit calculations. */ void Curl_ratelimit(struct Curl_easy *data, struct curltime now) { /* do not set a new stamp unless the time since last update is long enough */ if(data-\u003eset.max_recv_speed) { if(Curl_timediff(now, data-\u003eprogress.dl.limit.start) \u003e= MIN_RATE_LIMIT_PERIOD) { data-\u003eprogress.dl.limit.start = now; data-\u003eprogress.dl.limit.start_size = data-\u003eprogress.dl.cur_size; } } if(data-\u003eset.max_send_speed) { if(Curl_timediff(now, data-\u003eprogress.ul.limit.start) \u003e= MIN_RATE_LIMIT_PERIOD) { data-\u003eprogress.ul.limit.start = now; data-\u003eprogress.ul.limit.start_size = data-\u003eprogress.ul.cur_size; } } } state_performing å®é™…æ‰§è¡Œè¯»å†™ socketï¼Œåˆ°è¾¾é™é€Ÿè¦æ±‚ï¼Œè·³è½¬åˆ°é™é€Ÿ static CURLMcode state_performing(struct Curl_easy *data, struct curltime *nowp, bool *stream_errorp, CURLcode *resultp) { char *newurl = NULL; bool retry = FALSE; timediff_t recv_timeout_ms = 0; timediff_t send_timeout_ms = 0; CURLMcode rc = CURLM_OK; CURLcode result = *resultp = CURLE_OK; *stream_errorp = FALSE; /* check if over send speed */ if(data-\u003eset.max_send_speed) send_timeout_ms = Curl_pgrsLimitWaitTime(\u0026data-\u003eprogress.ul, data-\u003eset.max_send_speed, *nowp); /* check if over recv speed */ if(data-\u003eset.max_recv_speed) recv_timeout_ms = Curl_pgrsLimitWaitTime(\u0026data-\u003eprogress.dl, data-\u003eset.max_recv_speed, *nowp); if(send_timeout_ms || recv_timeout_ms) { Curl_ratelimit(data, *nowp); multistate(data, MSTATE_RATELIMITING); if(send_timeout_ms \u003e= recv_timeout_ms) Curl_expire(data, send_timeout_ms, EXPIRE_TOOFAST); else Curl_expire(data, recv_timeout_ms, EXPIRE_TOOFAST); return CURLM_OK; } /* read/wr","date":"2025-02-23","objectID":"/the-relationship-between-bdp-buffer-rt/:5:2","tags":["linux","curl","network","å®éªŒ"],"title":"é€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»","uri":"/the-relationship-between-bdp-buffer-rt/"},{"categories":null,"content":"ç®—æ³•é€»è¾‘ curl çš„é™é€Ÿä½¿ç”¨æ»‘åŠ¨çª—å£ç®—æ³•å®ç°ã€‚Curl_pgrsStartNow åˆå§‹åŒ–æ»‘åŠ¨çª—å£ç›¸å…³ç®—æ³•ã€‚Curl_pgrsLimitWaitTime è®¡ç®—äº†éœ€è¦ç­‰å¾…å¤šä¹…å¯ä»¥è¾¾åˆ°é¢„æœŸçš„é™é€Ÿã€‚å®é™…æ‰§è¡Œè¿‡ç¨‹ä¸­ (state_performing) è®¡ç®—æ˜¯å¦éœ€è¦é™é€Ÿï¼Œå½“éœ€è¦é™é€Ÿæ—¶ç­‰å¾… Curl_pgrsLimitWaitTime è¿”å›çš„é¢„æœŸç­‰å¾…æ—¶é—´ã€‚ç„¶åæ¢å¤è¯»å†™ socketã€‚ å¤§æ¦‚çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š limit = \"10kb/s\" Curl_pgrsStartNow(...) for { if limitWait := Curl_pgrsLimitWaitTime(...); limitWait \u003e 0 { sleep(limitWait) } state_performing(...) } å…¨å±€æœç´¢ SO_RCVBUF æœªæ‰¾åˆ°ï¼Œå¯ä»¥è¯´æ˜ curl æœªä½¿ç”¨è®¾ç½®å‘é€/æ¥æ”¶çª—å£çš„æ–¹å¼åšé™é€Ÿã€‚ ","date":"2025-02-23","objectID":"/the-relationship-between-bdp-buffer-rt/:5:3","tags":["linux","curl","network","å®éªŒ"],"title":"é€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»","uri":"/the-relationship-between-bdp-buffer-rt/"},{"categories":null,"content":"å®é™…æŠ“åŒ…çœ‹çœ‹ æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æŠ“åŒ…çœ‹çœ‹å®é™…çš„é™é€Ÿè¡Œä¸ºæ˜¯ä»€ä¹ˆæ ·çš„ï¼š curl http://mirrors.tuna.tsinghua.edu.cn/ubuntu-releases/24.04.2/ubuntu-24.04.2-live-server-amd64.iso -k -v --output t.iso --limit-rate 200K å¼€å§‹ç¬é—´çš„ååéå¸¸é«˜ 4638 KB/sï¼Œåç»­å‡ ä¸ªå³°å€¼æ¯”è¾ƒé«˜ï¼Œ1220 KB/s åˆ° 2441KB/sï¼›æ•´ä½“å¹³å‡ä¸‹æ¥ 233 KB/sï¼Œç¬æ—¶ååéå¸¸é«˜ 4638 KB/sã€‚è¿›ä¸€æ­¥è¯å®ï¼Œæ²¡æœ‰é€šè¿‡è®¾ç½® SO_RCVBUF/SO_SNDBUF æ§åˆ¶å‘é€/æ¥æ”¶çª—å£çš„æ–¹å¼æ§åˆ¶ç½‘é€Ÿã€‚ ","date":"2025-02-23","objectID":"/the-relationship-between-bdp-buffer-rt/:5:4","tags":["linux","curl","network","å®éªŒ"],"title":"é€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»","uri":"/the-relationship-between-bdp-buffer-rt/"},{"categories":null,"content":"è°ƒç”¨æµç¨‹ ","date":"2025-02-23","objectID":"/the-relationship-between-bdp-buffer-rt/:5:5","tags":["linux","curl","network","å®éªŒ"],"title":"é€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»","uri":"/the-relationship-between-bdp-buffer-rt/"},{"categories":null,"content":"è‡ªå·±å®ç°ä¸€ä¸ªç±»ä¼¼çš„é™é€Ÿ package main import ( \"context\" \"fmt\" \"io\" \"net\" \"net/http\" \"os\" \"time\" ) const ( BufferSize = 1024 ) // GOARCH=arm64 GOOS=linux go build -o golimitclient labs/network/BDP-buffer-RT/golimitclient/main.go func main() { tcpdialer := \u0026net.Dialer{ Timeout: 30 * time.Second, KeepAlive: 30 * time.Second, } transport := \u0026http.Transport{ Proxy: http.ProxyFromEnvironment, DialContext: func(ctx context.Context, network, addr string) (net.Conn, error) { ret, err := tcpdialer.DialContext(ctx, network, addr) if err != nil { return nil, err } tcpConn, ok := ret.(*net.TCPConn) if ok { err := tcpConn.SetReadBuffer(BufferSize) if err != nil { return nil, err } } return ret, err }, ForceAttemptHTTP2: true, MaxIdleConns: 100, IdleConnTimeout: 90 * time.Second, TLSHandshakeTimeout: 10 * time.Second, ExpectContinueTimeout: 1 * time.Second, // ReadBufferSize: BufferSize, } client := \u0026http.Client{Transport: transport} response, err := client.Get(fmt.Sprintf(\"http://%s:8089/test.txt\", os.Getenv(\"VM1\"))) check(err) defer response.Body.Close() var readTimes int64 = 2000 var readTimesPerSecond int64 = 20 _ = readTimesPerSecond for i := 0; i \u003c int(readTimes); i++ { io.CopyN(io.Discard, response.Body, BufferSize) println(i) time.Sleep(time.Second / time.Duration(readTimesPerSecond)) } } func check(err error) { if err != nil { panic(err) } } å¦‚å›¾ï¼ŒåŸºæœ¬å¯ä»¥é™é€Ÿé™åˆ¶åœ¨ 20k å·¦å³ã€‚ åœ¨å®è·µä¸­å‘ç°ï¼Œè®¾ç½® tcp readbufï¼ˆtcpConn.SetReadBuffer(BufferSize)ï¼‰æ˜¯æœ‰ä½œç”¨çš„ï¼Œä¸è®¾ç½®æœ€ç»ˆä¹Ÿä¼šååæ”¶æ•›åˆ° 20k çš„é™é€Ÿã€‚ ","date":"2025-02-23","objectID":"/the-relationship-between-bdp-buffer-rt/:5:6","tags":["linux","curl","network","å®éªŒ"],"title":"é€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»","uri":"/the-relationship-between-bdp-buffer-rt/"},{"categories":null,"content":"ç»“è®º RT è¶Šå¤§ï¼Œé€Ÿåº¦è¶Šæ…¢ ä¸¢åŒ…è¶Šé«˜ï¼Œé€Ÿåº¦è¶Šæ…¢ curl çš„é™é€Ÿæ˜¯é€šè¿‡åŠ¨æ€é™åˆ¶æŸæ®µæ—¶é—´å†…è¯»å–åˆ°æœ€å¤šå¤šå°‘æ•°æ®è¾¾åˆ°é™é€Ÿçš„æ•ˆæœ ","date":"2025-02-23","objectID":"/the-relationship-between-bdp-buffer-rt/:6:0","tags":["linux","curl","network","å®éªŒ"],"title":"é€šè¿‡å®éªŒï¼Œæ¢ç´¢ BDPã€tcp bufferã€RT ä¸‰è€…ä¹‹é—´çš„å…³ç³»","uri":"/the-relationship-between-bdp-buffer-rt/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šä¸€æ¬¡ä¸šåŠ¡é€»è¾‘é—®é¢˜å¯¼è‡´çš„ kafka è¿æ¥æ³„éœ²é—®é¢˜æ’æŸ¥ ç”Ÿäº§å‡ºäº†é—®é¢˜ï¼Œå†ä¸€æ¬¡è¢«æ‹‰æ¥æ•‘åœºã€‚ é—®é¢˜ç°è±¡ï¼šgolang ç¨‹åºæ‰€æœ‰ä½¿ç”¨ kafka è¿æ¥çš„åœ°æ–¹æŠ¥é”™ cannot assign requested addressï¼Œä¸šåŠ¡ä¸å¯ç”¨ã€‚ é”™è¯¯çš„å«æ„æ˜¯å®¢æˆ·ç«¯æ— æ³•ç”³è¯·æ–°çš„ç«¯å£ã€‚ å…ˆçœ‹ pedestal åº•å±‚è¿æ¥æ•°ï¼š netstat -nt | grep 9092 ç»“æœéå¸¸å¤šï¼Œå‘½ä»¤æ‰§è¡Œäº†å¾ˆä¹…ï¼Œç–¯ç‹‚åˆ·å„ç§ kafka è¿æ¥ä¿¡æ¯ã€‚å¯¹äº kafka æ¥è¯´æ˜¯ä¸å¤ªåˆç†çš„ï¼Œçœ‹èµ·æ¥æ˜¯ä¸€æ¬¡ kafka è¿æ¥æ³„éœ²é—®é¢˜ï¼Œå³ä¸šåŠ¡ç–¯ç‹‚åˆ›å»º kafka è¿æ¥ï¼Œä½†æœªå…³é—­è¿æ¥ã€‚ å…ˆçœ‹çœ‹è°ƒç”¨æ ˆï¼š grep 'sarama@v1.38.1/client.go:209' 'goroutine' | wc -l 23311 çœ‹èµ·æ¥æœ‰å¾ˆå¤š sarama kafka åå° goroutine åœ¨è·‘ï¼Œä¹Ÿå°è¯äº†æœ‰è¿æ¥æ³„éœ²ã€‚ ç„¶åçœ‹ profile ä¹Ÿå°è¯äº†åŒæ ·çš„ç»“è®ºã€‚ ä½†æ˜¯ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿkafka å‡½æ•°è°ƒç”¨ä¼šåˆ›å»º goroutine åé€€å‡ºï¼Œè°ƒç”¨æ ˆä¸æºå¸¦è°ƒç”¨æ–¹è°ƒç”¨æ ˆï¼Œæ‰€ä»¥æ— æ³•åœ¨ profile æˆ–è€… goroutine ä¸­çœ‹åˆ°å®é™…æœ‰é—®é¢˜çš„ä»£ç é€»è¾‘ã€‚ åˆ°æ­¤é—®é¢˜å¡ä½äº†ã€‚ å°è¯•çœ‹çœ‹å†…å­˜åˆ†é…æ˜¯å¦æ”¯æŒï¼Œç¡®è®¤å“ªé‡Œçš„å†…å­˜åˆ†é…å¯¹è±¡ä¸ªæ•°æœ‰é—®é¢˜å‘¢ã€‚ heapï¼š å¯ä»¥çœ‹åˆ°å †è°ƒç”¨äº† InitClientï¼Œè¿™ä¸ªå‡½æ•°ä¸­è°ƒç”¨äº†å¾ˆå¤šçš„ sarama.NewClientï¼Œæš‚æ—¶çŒœæµ‹æ˜¯è¿™ä¸ªä»£ç çš„é—®é¢˜ã€‚ è¯¦ç»†çœ‹è¿‡ä»£ç åå‘ç°ç±»ä¼¼è¿™ç§é€»è¾‘ï¼š func (s *service) InitClient() error { s.producer, err := NewProducer() if err != nil { return err } err = doSomeInit() if err != nil { return err } return nil } func do() { s := newService() err := s.InitClient() if err != nil { return } defer s.producer.Close() } æ­£å¸¸æƒ…å†µä¸‹ InitClient ä¸ä¼šæŠ¥é”™ï¼Œdefer é€»è¾‘ä¼šè¢«æ‰§è¡Œï¼Œproducer ä¼šè¢«æ­£ç¡®çš„å…³é—­ã€‚å½“ InitClient çš„ doSomeInit å¤±è´¥åï¼Œdo å‡½æ•°ä¼šæ²¡æœ‰æ‰§è¡Œ s.producer.Close() ç›´æ¥é€€å‡ºäº†ï¼Œå¯¼è‡´è¿æ¥æ³„éœ²äº†ã€‚ ä¿®å¤æ–¹æ³•ä¹Ÿæ¯”è¾ƒæœ´ç´  func (s *service) InitClient() error { s.producer, err := NewProducer() if err != nil { return err } err = doSomeInit() if err != nil { + _ = s.producer.Close() return err } return nil } func do() { s := newService() err := s.InitClient() if err != nil { return } defer s.producer.Close() } ","date":"2025-02-07","objectID":"/connect-kafka-failed-with-cannot-assign-requested-address/:0:0","tags":["debug","golang","linux","tcp","kafka"],"title":"connect kafka failed with cannot assign requested address","uri":"/connect-kafka-failed-with-cannot-assign-requested-address/"},{"categories":null,"content":"æ€»ç»“ é—®é¢˜ç°è±¡éå¸¸éš¾å¯¹åº”åˆ°ä»£ç ä¸Šï¼Œéœ€è¦ä¸æ–­æ¢ç´¢ï¼Œè§£å†³çš„è¿‡ç¨‹ä¸­ä¸€åº¦æƒ³è¦æ”¾å¼ƒäº†ã€‚è¿˜å¥½ï¼Œå†ä¸€æ¬¡å‘ç°äº†é—®é¢˜çš„åŸå› ï¼Œå¹¶è§£å†³äº†ã€‚ ","date":"2025-02-07","objectID":"/connect-kafka-failed-with-cannot-assign-requested-address/:1:0","tags":["debug","golang","linux","tcp","kafka"],"title":"connect kafka failed with cannot assign requested address","uri":"/connect-kafka-failed-with-cannot-assign-requested-address/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šç¨‹åºå› ä¸º tcp window full hang ä½çš„ä¸€æ¬¡æ’æŸ¥è¿‡ç¨‹ ","date":"2024-12-29","objectID":"/why-golang-prog-hang-tcp-window-full/:0:0","tags":["debug","golang","linux","tcp"],"title":"ç¨‹åºå› ä¸º tcp window full hang ä½çš„ä¸€æ¬¡æ’æŸ¥è¿‡ç¨‹","uri":"/why-golang-prog-hang-tcp-window-full/"},{"categories":null,"content":"èƒŒæ™¯ ç”Ÿäº§å‡ºäº†é—®é¢˜ï¼Œè¢«æ‹‰æ¥æ•‘åœºã€‚ ä¸šåŠ¡æµç¨‹æ˜¯ server1 ä¼šä» kafka1 ä¸­æ¶ˆè´¹æ•°æ®ï¼Œé‡æ–°æ•´ç†æ•°æ®åé€šè¿‡ tcp å‘é€ç»™ logstashï¼Œlogstash å†å°†æ•°æ®å‘é€ç»™ä¸‹æ¸¸çš„ kafka2ï¼›ä¸ºäº†ç¡®ä¿ä¸ä¸¢æ•°æ®ï¼Œlogstach å¼€äº†æŸç§å¹‚ç­‰æ’ä»¶ã€‚ é—®é¢˜ç°è±¡æ˜¯ï¼Œkafka1 ä¸­æœ‰ 1000 æ¡æ•°æ®ï¼Œtcp ç¡®è®¤å‘é€æˆåŠŸ 500 æ¡ï¼Œå‰©ä¸‹çš„ 500 æ¡æ•°æ®æœªå‘é€æˆ–è€…å‘é€å¤±è´¥äº†ï¼›kafka2 ä¸­æœªæ”¶åˆ°æ•°æ®ï¼› ","date":"2024-12-29","objectID":"/why-golang-prog-hang-tcp-window-full/:1:0","tags":["debug","golang","linux","tcp"],"title":"ç¨‹åºå› ä¸º tcp window full hang ä½çš„ä¸€æ¬¡æ’æŸ¥è¿‡ç¨‹","uri":"/why-golang-prog-hang-tcp-window-full/"},{"categories":null,"content":"debug è¿‡ç¨‹ é¦–å…ˆä»æºå¤´çœ‹ server 1 ä¸­ tcp æ˜¯æœªå‘é€è¿˜æ˜¯å‘é€å¤±è´¥äº†ã€‚ä»æ—¥å¿—ä¸­æœªå‘ç°å‘é€å¤±è´¥çš„æ—¥å¿—ã€‚ ä»ç¨‹åºä¸­çš„ goroutine è°ƒç”¨æ ˆå¯ä»¥ç¡®è®¤ï¼Œç¨‹åºå¡åœ¨ syscall write 27 minutesï¼Œæ€€ç–‘ tcp è¿æ¥å‡ºäº†é—®é¢˜ï¼› åœ¨ logstash è¿™ä¸ªæœºå™¨ä¸Š ss æŸ¥çœ‹è¿æ¥çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œlogstash æ²¡æœ‰å°† socket ä¸­çš„æ•°æ® copy åˆ°ç”¨æˆ·ç©ºé—´ã€‚ Recv-Q: The count of bytes not copied by the user program connected to this socket. man 8 netstat æŸ¥çœ‹ logstash å‘ç°å‘é€åˆ° kafka å¤±è´¥äº†ï¼š çœ‹ä¸‹æŠ“åŒ…ï¼Œå¯ä»¥çœ‹åˆ°å† keepalive + zerowindowï¼Œç¡®è®¤ä¸º tcp read buf å·²ç»æ»¡äº†ï¼Œtcp æ— æ³•ç»§ç»­å‘é€æ–°çš„æ•°æ®ï¼Œgolang çš„ socket.write åªèƒ½æ­»ç­‰ã€‚ ","date":"2024-12-29","objectID":"/why-golang-prog-hang-tcp-window-full/:2:0","tags":["debug","golang","linux","tcp"],"title":"ç¨‹åºå› ä¸º tcp window full hang ä½çš„ä¸€æ¬¡æ’æŸ¥è¿‡ç¨‹","uri":"/why-golang-prog-hang-tcp-window-full/"},{"categories":null,"content":"è§£å†³ ä¿®å¤ kafka TopicAuthorizationException: not authorized to aceess topics, ä¸šåŠ¡å³æ¢å¤ã€‚ ","date":"2024-12-29","objectID":"/why-golang-prog-hang-tcp-window-full/:3:0","tags":["debug","golang","linux","tcp"],"title":"ç¨‹åºå› ä¸º tcp window full hang ä½çš„ä¸€æ¬¡æ’æŸ¥è¿‡ç¨‹","uri":"/why-golang-prog-hang-tcp-window-full/"},{"categories":null,"content":"ç»¼ä¸Š tcp write çš„æˆåŠŸï¼Œä¸æ„å‘³ç€æ•°æ®çœŸçš„è¢«æ¥æ”¶åˆ°ï¼Œå¦‚æœä¸šåŠ¡éœ€è¦ç¡®ä¿ä¸‹æ¸¸è¢«æ¥æ”¶åˆ°ï¼Œéœ€è¦æœ‰ä¸šåŠ¡ ack æœºåˆ¶ï¼› æ”¹è¿›æ–¹æ¡ˆå¯ä»¥è€ƒè™‘æ·»åŠ ä¸€ä¸ª kafka topic æˆ–è€…ä¸­é—´æ·»åŠ ä¸€ä¸ª mqï¼Œæ•´ä½“æ•°æ®æµå˜æ›´ä¸º kafka1 -\u003e server1 -\u003e mq -\u003e kafka2 ","date":"2024-12-29","objectID":"/why-golang-prog-hang-tcp-window-full/:4:0","tags":["debug","golang","linux","tcp"],"title":"ç¨‹åºå› ä¸º tcp window full hang ä½çš„ä¸€æ¬¡æ’æŸ¥è¿‡ç¨‹","uri":"/why-golang-prog-hang-tcp-window-full/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šMac m1 æœºå™¨ä¸Šå®‰è£…çš„ rust ç¼–è¯‘è¿è¡Œç¨‹åºé‡åˆ°é—®é¢˜ zsh: killed ./mainï¼Œé—®é¢˜è§£å†³ åœ¨ Mac M1 æœºå™¨ä¸Šå®‰è£…å®Œ rust åè¿è¡Œç¨‹åºï¼ŒæŠ¥é”™ zsh: killed ./mainã€‚ å…ˆçœ‹ä¸‹æˆ‘çš„ç¯å¢ƒ fastfetch ..' xxx@hostname ,xNMM. -------------------- .OMMMMo OS: macOS Ventura 13.4 arm64 lMM\" Host: MacBook Pro (14-inch, 2021) .;loddo:. .olloddol;. Kernel: Darwin 22.5.0 cKMMMMMMMMMMNWMMMMMMMMMM0: Uptime: 22 days, 22 hours, 40 mins .KMMMMMMMMMMMMMMMMMMMMMMMWd. Packages: 220 (nix-system), 45 (nix-default), 158 (brew), 48 (brew-cask) XMMMMMMMMMMMMMMMMMMMMMMMX. Shell: zsh 5.9 ;MMMMMMMMMMMMMMMMMMMMMMMM: Display (Color LCD): 3024x1964 @ 120 Hz (as 1512x982) in 14\" [Built-in] :MMMMMMMMMMMMMMMMMMMMMMMM: DE: Aqua .MMMMMMMMMMMMMMMMMMMMMMMMX. WM: Quartz Compositor kMMMMMMMMMMMMMMMMMMMMMMMMWd. WM Theme: Multicolor (Dark) 'XMMMMMMMMMMMMMMMMMMMMMMMMMMk Font: .AppleSystemUIFont [System], Helvetica [User] 'XMMMMMMMMMMMMMMMMMMMMMMMMK. Cursor: Fill - Black, Outline - White (32px) kMMMMMMMMMMMMMMMMMMMMMMd Terminal: tmux 3.4 ;KMMMMMMMWXXWMMMMMMMk. CPU: Apple M1 Pro (8) @ 3.23 GHz \"cooc*\" \"*coo'\" GPU: Apple M1 Pro (14) @ 1.30 GHz [Integrated] Memory: 13.42 GiB / 16.00 GiB (84%) Swap: 17.39 GiB / 18.00 GiB (97%) Disk (/): 425.64 GiB / 460.43 GiB (92%) - apfs [Read-only] Disk (/Volumes/code): 425.64 GiB / 460.43 GiB (92%) - apfs Local IP (en0): 192.167.1.4/24 Battery (bq40z651): 84% (3 hours, 52 mins remaining) [Discharging] Locale: en_US.UTF-8 rustc --version -v rustc 1.83.0 (90b35a623 2024-11-26) binary: rustc commit-hash: 90b35a6239c3d8bdabc530a6a0816f7ff89a0aaf commit-date: 2024-11-26 host: aarch64-apple-darwin release: 1.83.0 LLVM version: 19.1.1 æ‰§è¡Œå¦‚ä¸‹ä»£ç ä¼šæŠ¥é”™ cat \u003c\u003cEOF \u003e main.rs fn main() { println!(\"Hello, world!\"); } EOF rm -rf main \u0026\u0026 rustc main.rs \u0026\u0026 ./main \u0026\u0026 rm -rf main.rs main zsh: killed ./main å¼€äº†æ–°çš„ shell ä¸­è¿è¡Œåˆ™æ­£å¸¸è¾“å‡ºã€‚ Hello, world! åçš„ç¨‹åºåœ¨å¥½çš„ shell ä¸­ä¹ŸæŠ¥ç›¸åŒçš„é”™è¯¯ã€‚ å¤šæ¬¡å°è¯•åå‘ç°æ–°å¼€çš„ zsh ä¸‹æ­£å¸¸ï¼Œtmux ä¸‹çš„ zsh ä¸­æœ‰é—®é¢˜ï¼Œå¼€å§‹æ€€ç–‘æ˜¯å¦æ˜¯ç¯å¢ƒå˜é‡çš„é—®é¢˜ã€‚diff äº†ä¸¤ä¸ªç¯å¢ƒçš„ç¯å¢ƒå˜é‡å¦‚ä¸‹ï¼š --- 1good.env 2024-12-13 21:56:57.329383153 +0800 +++ 1bad.env 2024-12-13 21:56:45.666162367 +0800 @@ -1,19 +1,29 @@ +AR= +AS= AUTO_NOTIFY_EXPIRE_TIME=8000 AUTO_NOTIFY_THRESHOLD=10 AUTO_NOTIFY_VERSION=0.10.0 +CC= CLICOLOR=true COLORTERM=truecolor COMMAND_MODE=unix2003 CONDA_PROMPT_MODIFIER=false +CONFIG_SHELL= +CXX= +DIRENV_DIFF= +DIRENV_DIR= +DIRENV_FILE= +DIRENV_WATCHES= EDITOR=vim +HOST_PATH= +IN_NIX_SHELL= JENV_LOADED=1 JENV_SHELL=zsh +LANG=en_US.UTF-8 LC_CTYPE=UTF-8 +LD= +LD_DYLD_PATH= zsh é tmux ä¸‹å°è¯•ä¸æ–­è®¾ç½®ä¸åŒçš„ç¯å¢ƒå˜é‡åæµ‹è¯•å‘ç°å¥½çš„ç¯å¢ƒä¸‹è®¾ç½®äº† LD_DYLD_PATH å˜é‡å°±ä¼šæœ‰é—®é¢˜ã€‚ æœ€å°é‡ç°ä»£ç å¦‚ä¸‹ï¼š export LD_DYLD_PATH= cat \u003c\u003cEOF \u003e main.rs fn main() { println!(\"Hello, world!\"); } EOF rm -rf main \u0026\u0026 rustc main.rs \u0026\u0026 ./main \u0026\u0026 rm -rf main.rs main æ£€æŸ¥äº†å½“å‰æˆ‘åœ¨ä½¿ç”¨çš„ dotfiles ä¸­æ²¡æœ‰è®¾ç½®è¿‡ LD_DYLD_PATHï¼Œå°è¯•ä¸€ä¸‹ workaroundï¼š unset LD_DYLD_PATH å°è¯•åœ¨ linux ä¸‹çœ‹çœ‹æ˜¯å¦ä¼šæœ‰åŒæ ·çš„é—®é¢˜ï¼š docker run --rm -it docker.m.daocloud.io/library/rust:1-bookworm bash Hello, world! çœ‹èµ·æ¥æ˜¯ macos ä¸‹ç‰¹æœ‰çš„é—®é¢˜ã€‚ sudo dtrace ./main dtrace: system integrity protection is on, some features will not be available dtrace: failed to execute /tmp/main: Malformed Mach-o file æäº† issue ï¼Œçœ‹çœ‹ç¤¾åŒºæ€ä¹ˆè¯´ã€‚ ","date":"2024-12-14","objectID":"/rustc-compiled-bin-killed-on-mac-m1/:0:0","tags":["rust","debug"],"title":"rustc ç¼–è¯‘çš„ç¨‹åºç›´æ¥æ‰§è¡ŒæŠ¥é”™ `zsh: killed     ./main`","uri":"/rustc-compiled-bin-killed-on-mac-m1/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šé€šè¿‡ä¸€ä¸ªå®éªŒç†è§£è¶…çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ ","date":"2024-11-03","objectID":"/experiment-to-understand-how-hyperthreading-works/:0:0","tags":["debug","cpu","intel",""],"title":"è¶…çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ - å®éªŒ","uri":"/experiment-to-understand-how-hyperthreading-works/"},{"categories":null,"content":"èƒŒæ™¯ å­¦ä¹  CPU è¶…çº¿ç¨‹çš„æ—¶å€™ï¼Œå®è·µä¸€ä¸‹ plantegg å¤§ä½¬çš„å®éªŒã€‚å®éªŒå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š å†™ä¸€ä¸ªèƒ½æŠŠ IPCï¼ˆinstructions per cycleï¼‰è·‘åˆ°æœ€é«˜çš„ä»£ç  (å¯ä»¥è¯•è¯•è·‘ä¸€æ®µæ­»å¾ªç¯çš„ IPC èƒ½åˆ°å¤šå°‘)ï¼›å†™ä¸€ä¸ªèƒ½æŠŠ IPC è·‘åˆ°æœ€ä½çš„ç¨‹åºã€‚ç„¶åç”¨ perf å»çœ‹ä»–ä»¬çš„ IPCï¼Œç”¨ top å»çœ‹ä»–ä»¬çš„ CPU ä½¿ç”¨ç‡ã€‚è¿›ä¸€æ­¥åŒæ—¶æŠŠè¿™æ ·çš„ç¨‹åºè·‘ä¸¤ä»½ï¼Œä½†æ˜¯å°†ä»–ä»¬ç»‘åˆ°ä¸€å¯¹è¶…çº¿ç¨‹ä¸Šï¼Œç„¶åå†çœ‹ä»–ä»¬çš„ IPC ä»¥åŠ topã€‚ nop.c void main() { while (1) { __asm__( \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\\n\\t\" \"nop\"); } } pause.c void main() { while (1) { __asm__( \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\\n\\t\" \"pause\"); } } ","date":"2024-11-03","objectID":"/experiment-to-understand-how-hyperthreading-works/:1:0","tags":["debug","cpu","intel",""],"title":"è¶…çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ - å®éªŒ","uri":"/experiment-to-understand-how-hyperthreading-works/"},{"categories":null,"content":"å®éªŒç¯å¢ƒä¿¡æ¯ root@localhost# cat /etc/redhat-release Rocky Linux release 8.10 (Green Obsidian) root@localhost# uname -a Linux localhost.localdomain 3.10.0-1160.el7.x86_64 #1 SMP Mon Oct 19 16:18:59 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux root@localhost# lscpu Architecture: x86_64 CPU op-mode(s): 32-bit, 64-bit Byte Order: Little Endian CPU(s): 80 On-line CPU(s) list: 0-79 Thread(s) per core: 2 Core(s) per socket: 20 Socket(s): 2 NUMA node(s): 2 Vendor ID: GenuineIntel BIOS Vendor ID: Intel(R) Corporation CPU family: 6 Model: 85 Model name: Intel(R) Xeon(R) Gold 5218R CPU @ 2.10GHz BIOS Model name: Intel(R) Xeon(R) Gold 5218R CPU @ 2.10GHz Stepping: 7 CPU MHz: 799.932 CPU max MHz: 4000.0000 CPU min MHz: 800.0000 BogoMIPS: 4200.00 Virtualization: VT-x L1d cache: 32K L1i cache: 32K L2 cache: 1024K L3 cache: 28160K NUMA node0 CPU(s): 0-19,40-59 NUMA node1 CPU(s): 20-39,60-79 Flags: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc art arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm 3dnowprefetch epb cat_l3 cdp_l3 invpcid_single intel_ppin intel_pt ssbd mba ibrs ibpb stibp ibrs_enhanced tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm cqm mpx rdt_a avx512f avx512dq rdseed adx smap clflushopt clwb avx512cd avx512bw avx512vl xsaveopt xsavec xgetbv1 cqm_llc cqm_occup_llc cqm_mbm_total cqm_mbm_local dtherm ida arat pln pts hwp hwp_act_window hwp_epp hwp_pkg_req pku ospke avx512_vnni md_clear spec_ctrl intel_stibp flush_l1d arch_capabilities numactl -H available: 2 nodes (0-1) node 0 cpus: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 node 0 size: 128410 MB node 0 free: 52082 MB node 1 cpus: 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 node 1 size: 128985 MB node 1 free: 120673 MB node distances: node 0 1 0: 10 21 1: 21 10 lstopo-no-graphics --output-format svg \u003e IntelRXeonGold5218R.svg æˆ‘çš„ç¯å¢ƒæ¯”è¾ƒå¥‡æ€ªï¼Œå®¿ä¸»æœºçš„ç³»ç»Ÿæ˜¯ centos7.9ï¼Œé‡è£…ç³»ç»Ÿä¼šç›¸å¯¹éº»çƒ¦ä¸€äº›ã€‚centos å·²ç» EOLï¼Œç›´æ¥å®¿ä¸»æœºå®‰è£…å„ç§éœ€è¦çš„è½¯ä»¶ã€æ­å»ºç¼–è¯‘ç¯å¢ƒç›¸å¯¹éº»çƒ¦ï¼Œä¸”æˆ‘çš„ç”µè„‘æ˜¯ M1 armï¼Œæ­å»ºäº¤å‰ç¼–è¯‘ç¯å¢ƒä¼šæ¶‰åŠä¿®æ”¹ç¼–è¯‘å‘½ä»¤ï¼Œå…¥é—¨é—¨æ§›ç›¸å¯¹è¾ƒé«˜ã€‚æ‰€ä»¥å°è¯•åœ¨ docker ä¸­æ­å»ºè¿è¡Œã€ç¼–è¯‘ç¯å¢ƒã€‚ç¯å¢ƒå¦‚ä¸‹ï¼š ","date":"2024-11-03","objectID":"/experiment-to-understand-how-hyperthreading-works/:2:0","tags":["debug","cpu","intel",""],"title":"è¶…çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ - å®éªŒ","uri":"/experiment-to-understand-how-hyperthreading-works/"},{"categories":null,"content":"ç¼–è¯‘è¿è¡Œç¯å¢ƒ Dockerfile è§å¦‚ä¸‹ï¼Œæ–‡ä»¶ä¿å­˜åˆ° tools/Dockerfile.labsï¼š FROM --platform=linux/amd64 rockylinux/rockylinux:8 RUN dnf groupinstall -y 'Development Tools' \\ \u0026\u0026 dnf --enablerepo=devel -y install bison byacc flex patch glibc-static git libtirpc libtirpc-devel numactl numa* hwloc perf tmux ç¼–è¯‘ docker é•œåƒ docker build -f tools/Dockerfile.labs -t cpulabs:dev . åªä½¿ç”¨é•œåƒä¸­çš„ linux å‘è¡Œç‰ˆ rootfsï¼Œå…¶ä»–æ‰€æœ‰çš„éš”ç¦»æ‰‹æ®µä¸ä½¿ç”¨ï¼Œå°½å¯èƒ½åŒ¹é…å®¿ä¸»æœºè£¸æœºæ‰§è¡Œçš„ç¯å¢ƒï¼š docker run --name casestudy --rm -it --privileged --userns=host --network=host --pid=host -v $(pwd):/host -w /host cpulabs:dev bash ","date":"2024-11-03","objectID":"/experiment-to-understand-how-hyperthreading-works/:2:1","tags":["debug","cpu","intel",""],"title":"è¶…çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ - å®éªŒ","uri":"/experiment-to-understand-how-hyperthreading-works/"},{"categories":null,"content":"å®éªŒä¸»ä½“ ","date":"2024-11-03","objectID":"/experiment-to-understand-how-hyperthreading-works/:3:0","tags":["debug","cpu","intel",""],"title":"è¶…çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ - å®éªŒ","uri":"/experiment-to-understand-how-hyperthreading-works/"},{"categories":null,"content":"æµ‹è¯• nop æŒ‡ä»¤ ç†è®ºä¸Š intel 4 æ¡æµæ°´çº¿å¹¶è¡Œï¼Œnop æ‰§è¡Œéœ€è¦ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸï¼Œcpu å®Œå…¨è·‘ nop æŒ‡ä»¤çš„ IPC å¤§çº¦æ˜¯ 4ã€‚æ¥ä¸‹æ¥éªŒè¯ä¸€ä¸‹ã€‚ gcc ./nop.c -o nop æ‰§è¡Œæµ‹è¯• perf stat timeout 10 ./nop Performance counter stats for 'timeout 10 ./nop': 9977.71 msec task-clock # 0.997 CPUs utilized 8 context-switches # 0.802 /sec 2 cpu-migrations # 0.200 /sec 511 page-faults # 51.214 /sec 38351130635 cycles # 3.844 GHz 149695103720 instructions # 3.90 insn per cycle 1168639909 branches # 117.125 M/sec 465623 branch-misses # 0.04% of all branches 10.002747608 seconds time elapsed 9.977095000 seconds user 0.001750000 seconds sys ç°è±¡ï¼š IPC è·‘åˆ° 3.90 CPUs util 0.997 é—®é¢˜ï¼š IPC è·Ÿ perf æ‰§è¡Œå¤šä¹…æ— å…³ï¼Œä½†æ˜¯æ‰§è¡Œæ—¶é—´è¿‡çŸ­ï¼ŒIPC è®¡æ•°ä¼šå°ä¸€ç‚¹ç‚¹ï¼ŒçŒœæµ‹å¯èƒ½æ˜¯æ—¶é—´å¤ªçŸ­ï¼Œwhile å¾ªç¯ä¹Ÿéœ€è¦æ‰§è¡Œæ‰§è¡Œï¼Œè·³è½¬æŒ‡ä»¤è®©æŒ‡ä»¤æµæ°´çº¿å—é˜»å¯¼è‡´çš„ï¼Œé•¿æ—¶é—´çš„æ‰§è¡Œä»¤åˆ†æ”¯é¢„æµ‹æ›´åŠ å‡†ç¡®ï¼ŒIPC è¶‹äºç¨³å®š perf stat timeout 0.1 ./nop IPC åœ¨ 3.84 perf stat timeout 1 ./nop IPC åœ¨ 3.90 IPC æ˜¯å¦å¯ä»¥æ¥è¿‘ 4? æ®è¯´ intel æµæ°´çº¿å¯è¾¾ 4 æ¡å¹¶è¡Œï¼Œç†è®ºå€¼æ˜¯ 4ï¼Œwhile å¾ªç¯ä¹Ÿä¼šè½¬æ¢æˆå…¶ä»–å‘½ä»¤ï¼Œä¼šç¨€é‡Šä¸€éƒ¨åˆ†å¯¼è‡´ IPC é™ä½ï¼Œå¯ä»¥è€ƒè™‘å¢åŠ  asm ä¸­çš„ nop çš„æ•°é‡ ","date":"2024-11-03","objectID":"/experiment-to-understand-how-hyperthreading-works/:3:1","tags":["debug","cpu","intel",""],"title":"è¶…çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ - å®éªŒ","uri":"/experiment-to-understand-how-hyperthreading-works/"},{"categories":null,"content":"æµ‹è¯• pause æŒ‡ä»¤ ç†è®ºä¸Š intel å…± 4 æ¡æµæ°´çº¿å¹¶è¡Œï¼Œä¸€ä¸ª pause æŒ‡ä»¤å¤§æ¦‚ 140 æ—¶é’Ÿå‘¨æœŸï¼Œ4/140=0.02857142857142857ï¼Œæ¥ä¸‹æ¥éªŒè¯ä¸€ä¸‹ã€‚ gcc ./pause.c -o pause æ‰§è¡Œæµ‹è¯• perf stat timeout 10 ./pause Performance counter stats for 'timeout 10 ./pause': 9980.35 msec task-clock # 0.997 CPUs utilized 6 context-switches # 0.601 /sec 3 cpu-migrations # 0.301 /sec 510 page-faults # 51.100 /sec 35500797866 cycles # 3.557 GHz 929191714 instructions # 0.03 insn per cycle 15430712 branches # 1.546 M/sec 373753 branch-misses # 2.42% of all branches 10.005685906 seconds time elapsed 9.979564000 seconds user 0.002129000 seconds sys ç°è±¡ï¼š IPC å¤§çº¦ 0.03ï¼Œä¼°è®¡æ˜¯ç²¾åº¦é—®é¢˜ï¼Œä¸è®¡ç®—å‡ºçš„ç†è®ºå€¼æ¥è¿‘ã€‚ ","date":"2024-11-03","objectID":"/experiment-to-understand-how-hyperthreading-works/:3:2","tags":["debug","cpu","intel",""],"title":"è¶…çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ - å®éªŒ","uri":"/experiment-to-understand-how-hyperthreading-works/"},{"categories":null,"content":"æµ‹è¯• nop æŒ‡ä»¤è·‘ä¸¤ä»½å„è‡ªç»‘å®šåˆ°åŒä¸€ç‰©ç†æ ¸ cat /proc/cpuinfo ä¸­ å¸Œæœ›æ‰¾åˆ°ç›¸åŒç‰©ç†æ ¸å¿ƒçš„ä¸¤ä¸ªè¶…çº¿ç¨‹ï¼Œå³å¯»æ‰¾ core id ç›¸åŒ ä¸” physical id ç›¸åŒçš„ ä¸¤ä¸ª processor å³å¯ã€‚ perf stat timeout 3 taskset -c 0 ./nop \u0026 perf stat timeout 3 taskset -c 40 ./nop Performance counter stats for 'taskset -c 40 ./nop': 6668.00 msec task-clock # 0.997 CPUs utilized 2 context-switches # 0.300 /sec 1 cpu-migrations # 0.150 /sec 343 page-faults # 51.440 /sec 21645830628 cycles # 3.246 GHz 32415527643 instructions # 1.50 insn per cycle 256383559 branches # 38.450 M/sec 273069 branch-misses # 0.11% of all branches 6.684805024 seconds time elapsed 6.666732000 seconds user 0.001996000 seconds sys Performance counter stats for 'timeout 3 taskset -c 40 ./nop': 3000.46 msec task-clock # 0.996 CPUs utilized 6 context-switches # 2.000 /sec 1 cpu-migrations # 0.333 /sec 740 page-faults # 246.629 /sec 10749571656 cycles # 3.583 GHz 19580067188 instructions # 1.82 insn per cycle 155065143 branches # 51.680 M/sec 159560 branch-misses # 0.10% of all branches 3.013625515 seconds time elapsed 2.995919000 seconds user 0.008434000 seconds sys å¯ä»¥çœ‹åˆ°ä¸¤ä¸ª nop è·‘åœ¨ç›¸åŒç‰©ç†æ ¸çš„ä¸¤ä¸ªè¶…çº¿ç¨‹ä¸‹ï¼ŒIPC ä¸‹é™åˆ°åŸæ¥çš„ä¸€åŠä»¥ä¸‹äº†ã€‚ (1.50+1.82)/(3.90*2)=0.42 ","date":"2024-11-03","objectID":"/experiment-to-understand-how-hyperthreading-works/:3:3","tags":["debug","cpu","intel",""],"title":"è¶…çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ - å®éªŒ","uri":"/experiment-to-understand-how-hyperthreading-works/"},{"categories":null,"content":"æµ‹è¯• pause æŒ‡ä»¤è·‘ä¸¤ä»½å„è‡ªç»‘å®šåˆ°åŒä¸€ç‰©ç†æ ¸ perf stat timeout 3 taskset -c 0 ./pause \u0026 perf stat timeout 3 taskset -c 40 ./pause Performance counter stats for 'timeout 3 taskset -c 40 ./pause': 3000.71 msec task-clock # 0.997 CPUs utilized 5 context-switches # 1.666 /sec 1 cpu-migrations # 0.333 /sec 740 page-faults # 246.608 /sec 9127896305 cycles # 3.042 GHz 232869301 instructions # 0.03 insn per cycle 5153047 branches # 1.717 M/sec 149048 branch-misses # 2.89% of all branches 3.008989678 seconds time elapsed 2.996138000 seconds user 0.005710000 seconds sys Performance counter stats for 'timeout 3 taskset -c 0 ./pause': 3002.08 msec task-clock # 0.997 CPUs utilized 8 context-switches # 2.665 /sec 1 cpu-migrations # 0.333 /sec 740 page-faults # 246.496 /sec 9036205346 cycles # 3.010 GHz 228681050 instructions # 0.03 insn per cycle 4910490 branches # 1.636 M/sec 151013 branch-misses # 3.08% of all branches 3.010698825 seconds time elapsed 3.000847000 seconds user 0.002973000 seconds sys ç°è±¡ï¼š ç»‘å®šåœ¨ 0 å· CPU ä¸Šçš„ IPC ä¸º 0.03ï¼Œç»‘å®šåˆ° 40 å· CPU ä¸Šçš„ IPC ä¸º 0.03ï¼Œä¸åŸå§‹è·‘ä¸€ä¸ª pause æ—¶ä¸€æ · ","date":"2024-11-03","objectID":"/experiment-to-understand-how-hyperthreading-works/:3:4","tags":["debug","cpu","intel",""],"title":"è¶…çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ - å®éªŒ","uri":"/experiment-to-understand-how-hyperthreading-works/"},{"categories":null,"content":"æµ‹è¯• pause/nop æŒ‡ä»¤å„è‡ªç»‘å®šåˆ°åŒä¸€ç‰©ç†æ ¸ perf stat timeout 3 taskset -c 0 ./nop \u0026 perf stat timeout 3 taskset -c 40 ./pause Performance counter stats for 'timeout 3 taskset -c 0 ./nop': 3004.09 msec task-clock # 0.997 CPUs utilized 9 context-switches # 2.996 /sec 1 cpu-migrations # 0.333 /sec 741 page-faults # 246.663 /sec 8734459274 cycles # 2.908 GHz 27382699175 instructions # 3.14 insn per cycle 215882285 branches # 71.863 M/sec 170322 branch-misses # 0.08% of all branches 3.013204769 seconds time elapsed 2.999945000 seconds user 0.006140000 seconds sys Performance counter stats for 'timeout 3 taskset -c 40 ./pause': 2997.37 msec task-clock # 0.997 CPUs utilized 5 context-switches # 1.668 /sec 1 cpu-migrations # 0.334 /sec 738 page-faults # 246.216 /sec 8791793294 cycles # 2.933 GHz 219616224 instructions # 0.02 insn per cycle 5261702 branches # 1.755 M/sec 144141 branch-misses # 2.74% of all branches 3.005700376 seconds time elapsed 2.992557000 seconds user 0.006074000 seconds sys ç°è±¡ï¼š è®¡ç®—å½“å‰ IPC æ˜¯è·‘åœ¨ä¸¤ä¸ªç‰©ç†æ ¸å¿ƒä¸Šçš„ (3.14+0.02)/(3.90+0.03) = 0.80ï¼Œæ¯”åŒæ—¶è·‘ nop çš„ 0.42 æé«˜æ˜æ˜¾ã€‚ ","date":"2024-11-03","objectID":"/experiment-to-understand-how-hyperthreading-works/:3:5","tags":["debug","cpu","intel",""],"title":"è¶…çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ - å®éªŒ","uri":"/experiment-to-understand-how-hyperthreading-works/"},{"categories":null,"content":"å¾…è§£ç­”é—®é¢˜ ","date":"2024-11-03","objectID":"/experiment-to-understand-how-hyperthreading-works/:4:0","tags":["debug","cpu","intel",""],"title":"è¶…çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ - å®éªŒ","uri":"/experiment-to-understand-how-hyperthreading-works/"},{"categories":null,"content":"ä¸ºä»€ä¹ˆæ­»å¾ªç¯é‡Œè¦å†™è¿™ä¹ˆå¤š pause/nopï¼Œå°‘äº†ï¼Œæ˜¯ä»€ä¹ˆå› ç´ å¯¼è‡´çš„ IPC é™ä½å‘¢ï¼Ÿ ","date":"2024-11-03","objectID":"/experiment-to-understand-how-hyperthreading-works/:4:1","tags":["debug","cpu","intel",""],"title":"è¶…çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ - å®éªŒ","uri":"/experiment-to-understand-how-hyperthreading-works/"},{"categories":null,"content":"æœ‰ä»€ä¹ˆæ–¹å¼å¯ä»¥æŸ¥çœ‹å½“å‰ CPU çš„æµæ°´çº¿é•¿åº¦å—ï¼Ÿ TODO: ","date":"2024-11-03","objectID":"/experiment-to-understand-how-hyperthreading-works/:4:2","tags":["debug","cpu","intel",""],"title":"è¶…çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ - å®éªŒ","uri":"/experiment-to-understand-how-hyperthreading-works/"},{"categories":null,"content":"æ€»ç»“ å­¦ä¹ äº† perf å‘½ä»¤ç›‘æ§ç¨‹åºæ€§èƒ½ å­¦ä¹ äº† taskset å‘½ä»¤æ§åˆ¶ç»‘æ ¸ å­¦ä¹ äº†è¶…çº¿ç¨‹ç›¸å…³ä¿¡æ¯ ä¸Šé¢å­¦ä¹ åˆ°çš„éƒ½æ˜¯éœ€è¦åç»­æ·±å…¥ç ”ç©¶ã€‚ ","date":"2024-11-03","objectID":"/experiment-to-understand-how-hyperthreading-works/:5:0","tags":["debug","cpu","intel",""],"title":"è¶…çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ - å®éªŒ","uri":"/experiment-to-understand-how-hyperthreading-works/"},{"categories":null,"content":"ref IPC(Instructions per cycle) NOP (code) X86_instruction_listings è¯´è¯´å¦‚ä½•åˆ¤æ–­ Linux æ˜¯å¦å¼€å¯äº†è¶…çº¿ç¨‹ Perf IPC ä»¥åŠ CPU æ€§èƒ½ ","date":"2024-11-03","objectID":"/experiment-to-understand-how-hyperthreading-works/:6:0","tags":["debug","cpu","intel",""],"title":"è¶…çº¿ç¨‹æ˜¯å¦‚ä½•å·¥ä½œçš„ - å®éªŒ","uri":"/experiment-to-understand-how-hyperthreading-works/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šæ¢ç´¢ä¸ºä»€ä¹ˆ sysbench æ²¡æœ‰é‡è¿ Reconnect ","date":"2024-10-16","objectID":"/why-sysbench-dont-reconnect-after-kill/:0:0","tags":["debug","mysql","sysbench"],"title":"sysbench benchmark MySQL æ—¶å€™ï¼Œä¸ºä»€ä¹ˆ kill è¿æ¥åï¼Œsysbench æ²¡æœ‰é‡è¿","uri":"/why-sysbench-dont-reconnect-after-kill/"},{"categories":null,"content":"èƒŒæ™¯ plantegg æä¾›äº†ä¸€ä¸ªæ¡ˆä¾‹ï¼Œå¤§ä½“ä¸Šæ˜¯é˜¿é‡Œäº‘ä¸Š sysbench å‹æµ‹ MySQL çš„æ—¶å€™ï¼Œä½¿ç”¨ MySQL å®¢æˆ·ç«¯ kill sysbench å‘èµ·çš„å‹æµ‹è¿æ¥ï¼Œå‘ç° sysbench æ²¡æœ‰é‡è¿ï¼ŒQPS å§‹ç»ˆä¸º 0ã€‚plantegg ç»™å‡ºäº†å¤ç°æ–¹æ³•ã€‚ ","date":"2024-10-16","objectID":"/why-sysbench-dont-reconnect-after-kill/:1:0","tags":["debug","mysql","sysbench"],"title":"sysbench benchmark MySQL æ—¶å€™ï¼Œä¸ºä»€ä¹ˆ kill è¿æ¥åï¼Œsysbench æ²¡æœ‰é‡è¿","uri":"/why-sysbench-dont-reconnect-after-kill/"},{"categories":null,"content":"é—®é¢˜å¤ç° åœ¨æˆ‘çš„ M1 mac ä¸Šä½¿ç”¨ vagrant + vmware_fusion å¯åŠ¨äº†ä¸€ä¸ªè™šæ‹Ÿæœºï¼ŒVagrantfile å¦‚ä¸‹ï¼Œè™šæ‹Ÿæœºå¯åŠ¨çš„ç¯å¢ƒå†…æ ¸ç‰ˆæœ¬æ›´å¯æ§ï¼› # -*- mode: ruby -*- # vi: set ft=ruby : Vagrant.configure(\"2\") do |config| config.vm.box = \"bento/ubuntu-22.04\" config.vm.box_architecture = \"arm64\" config.vm.provider :vmware_fusion do |vm| # https://gist.github.com/jtopper/8588263 end config.vm.provision \"shell\", inline: \u003c\u003c-SHELL # https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/ sed -E -i -e 's/(archive|ports).ubuntu.com/mirrors.tuna.tsinghua.edu.cn/g' -e '/security.ubuntu.com/d' /etc/apt/sources.list apt update apt install -y tshark tcpdump net-tools gdb dstat apt autoremove apt install -y linux-tools-common linux-tools-$(uname -r) SHELL end # å…ˆåœ¨ vm ä¸­å¯åŠ¨ä¸€ä¸ª mysqlï¼Œåæ–‡ä»¥ plantegg# å¼€å¤´ docker run -it -d --net=host -e MYSQL_ROOT_PASSWORD=123 --name=plantegg docker.m.daocloud.io/library/mysql:8 plantegg# mysql --ssl-mode=DISABLED -uroot -p123 # åœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œç”¨äºæ‰§è¡Œ sysbenchï¼Œåæ–‡ä»¥ sysbench# å¼€å¤´ docker run --privileged -it --name sysbench registry.dockermirror.com/747301585/alinux3:20220901 bash #sysbench# uname -a Linux e590c969f57f 6.6.16-linuxkit #1 SMP Fri Feb 16 11:54:02 UTC 2024 aarch64 aarch64 aarch64 GNU/Linux sysbench# yum install -y sysstat sysbench iproute net-tools strace ltrace perf gdb sysbench# export MYSQL_HOST='192.168.245.145' sysbench# sysbench --mysql-user='root' --mysql-password='123' --mysql-db='test' --mysql-host=$MYSQL_HOST --mysql-port='3306' --tables='16' --table-size='10000' --range-size='5' --db-ps-mode='disable' --skip-trx='on' --mysql-ignore-errors='all' --time='1180' --report-interval='1' --histogram='on' --threads=1 oltp_read_only prepare # å‘½ä»¤æœ‰äº›æŠ¥é”™ï¼Œä¸å½±å“é—®é¢˜å¤ç° sysbench# sysbench --mysql-user='root' --mysql-password='123' --mysql-db='test' --mysql-host=$MYSQL_HOST --mysql-port='3306' --tables='16' --table-size='10000' --range-size='5' --db-ps-mode='disable' --skip-trx='on' --mysql-ignore-errors='all' --time='1180' --report-interval='1' --histogram='on' --threads=1 oltp_read_only run plantegg# mysql --ssl-mode=DISABLED -uroot -p123 plantegg#mysql# select version(); +-----------+ | version() | +-----------+ | 8.4.2 | +-----------+ plantegg#mysql# show processlist; plantegg#mysql# kill some-pid; -- å¤ç°å…³é”®ç‚¹åœ¨è¿™é‡Œ plantegg#mysql# show processlist; å¤ç°åçš„ç°è±¡ï¼š sysbench ååè·Œé›¶ï¼š sysbench# [ 15s ] thds: 1 tps: 68.07 qps: 2033.94 (r/w/o: 2033.94/0.00/0.00) lat (ms,95%): 36.89 err/s: 146.14 reconn/s: 0.00 [ 16s ] thds: 1 tps: 55.94 qps: 1998.85 (r/w/o: 1998.85/0.00/0.00) lat (ms,95%): 42.61 err/s: 168.82 reconn/s: 0.00 [ 17s ] thds: 1 tps: 24.81 qps: 1079.68 (r/w/o: 1079.68/0.00/0.00) lat (ms,95%): 74.46 err/s: 97.25 reconn/s: 0.00 [ 18s ] thds: 1 tps: 0.00 qps: 0.00 (r/w/o: 0.00/0.00/0.00) lat (ms,95%): 0.00 err/s: 0.00 reconn/s: 0.00 [ 19s ] thds: 1 tps: 0.00 qps: 0.00 (r/w/o: 0.00/0.00/0.00) lat (ms,95%): 0.00 err/s: 0.00 reconn/s: 0.00 [ 20s ] thds: 1 tps: 0.00 qps: 0.00 (r/w/o: 0.00/0.00/0.00) lat (ms,95%): 0.00 err/s: 0.00 reconn/s: 0.00 [ 21s ] thds: 1 tps: 0.00 qps: 0.00 (r/w/o: 0.00/0.00/0.00) lat (ms,95%): 0.00 err/s: 0.00 reconn/s: 0.00 [ 22s ] thds: 1 tps: 0.00 qps: 0.00 (r/w/o: 0.00/0.00/0.00) lat (ms,95%): 0.00 err/s: 0.00 reconn/s: 0.00 [ 23s ] thds: 1 tps: 0.00 qps: 0.00 (r/w/o: 0.00/0.00/0.00) lat (ms,95%): 0.00 err/s: 0.00 reconn/s: 0.00 [ 24s ] thds: 1 tps: 0.00 qps: 0.00 (r/w/o: 0.00/0.00/0.00) lat (ms,95%): 0.00 err/s: 0.00 reconn/s: 0.00 [ 25s ] thds: 1 tps: 0.00 qps: 0.00 (r/w/o: 0.00/0.00/0.00) lat (ms,95%): 0.00 err/s: 0.00 reconn/s: 0.00 [ 26s ] thds: 1 tps: 0.00 qps: 0.00 (r/w/o: 0.00/0.00/0.00) lat (ms,95%): 0.00 err/s: 0.00 reconn/s: 0.00 [ 27s ] thds: 1 tps: 0.00 qps: 0.00 (r/w/o: 0.00/0.00/0.00) lat (ms,95%): 0.00 err/s: 0.00 reconn/s: 0.00 [ 28s ] thds: 1 tps: 0.00 qps: 0.00 (r/w/o: 0.00/0.00/0.00) lat (ms,95%): 0.00 err/s: 0.00 reconn/s: 0.00 ç½‘ç»œè¿æ¥å¤§é‡ CLOSE_WAITï¼š sysbench# ss -tnp | head -n 30 State Recv-Q Send-Q Local Address:Port Peer Address:PortProcess CLOSE-WAIT 28 0 172.17.0.2:55265 192.168.245.145:3306 users:((\"sysbench\",pid=207,fd=22757)) CLOSE-WAIT 28 0 172.17.0.2:","date":"2024-10-16","objectID":"/why-sysbench-dont-reconnect-after-kill/:2:0","tags":["debug","mysql","sysbench"],"title":"sysbench benchmark MySQL æ—¶å€™ï¼Œä¸ºä»€ä¹ˆ kill è¿æ¥åï¼Œsysbench æ²¡æœ‰é‡è¿","uri":"/why-sysbench-dont-reconnect-after-kill/"},{"categories":null,"content":"åˆ†æä¸€ä¸‹åŸå›  å…ˆçœ‹çœ‹ cpu åˆ°è¢«æ¶ˆè€—åœ¨äº†å†…æ ¸è¿˜æ˜¯è¿›ç¨‹ pidstat 1 Linux 6.6.16-linuxkit (e590c969f57f) 10/17/24 _aarch64_ (4 CPU) 09:22:11 UID PID %usr %system %guest %wait %CPU CPU Command 09:22:12 0 115 0.00 64.08 0.00 0.00 64.08 0 sysbench 09:22:12 0 259 0.00 3.88 0.00 0.00 3.88 1 pidstat 09:22:12 UID PID %usr %system %guest %wait %CPU CPU Command 09:22:13 0 115 0.00 67.00 0.00 0.00 67.00 0 sysbench 09:22:13 UID PID %usr %system %guest %wait %CPU CPU Command 09:22:14 0 115 0.00 70.00 0.00 0.00 70.00 0 sysbench 09:22:14 UID PID %usr %system %guest %wait %CPU CPU Command 09:22:15 0 115 0.00 69.00 0.00 0.00 69.00 0 sysbench å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„ cpu éƒ½åœ¨å†…æ ¸æ€ã€‚å®é™…è·‘ä¸‹æ¥ï¼Œåˆšå¤ç°è·Œé›¶æ—¶å€™ cpu æ¯”è¾ƒå°‘ï¼Œéšç€ TCP è¿æ¥çš„å˜å¤šï¼Œå†…æ ¸ cpu è¶Šæ¥è¶Šé«˜ã€‚ çœ‹çœ‹å†…æ ¸åœ¨å¹²ä»€ä¹ˆï¼š perf top -g -p `pidof sysbench` + 98.36% 0.01% [kernel] [k] __sys_connect + 97.73% 0.05% libpthread-2.32.so [.] __libc_connect + 97.35% 5.06% [kernel] [k] __inet_hash_connect + 92.17% 0.01% [kernel] [k] __inet_stream_connect + 86.99% 59.51% [kernel] [k] __inet_check_established + 86.84% 0.00% [kernel] [k] tcp_v4_connect + 67.97% 0.01% [kernel] [k] do_el0_svc + 28.19% 28.19% [kernel] [k] inet_ehashfn + 19.36% 0.00% libc-2.32.so [.] thread_start + 19.36% 0.00% libpthread-2.32.so [.] start_thread + 19.35% 0.00% sysbench [.] 0x0000aaaade71bce0 + 19.35% 0.00% libluajit-5.1.so.2.1.0 [.] lua_pcall + 19.35% 0.00% [JIT] tid 207 [.] 0x0000ffffac384eb8 + 19.35% 0.00% sysbench [.] db_execute + 19.35% 0.00% sysbench [.] 0x0000aaaade72b744 + 19.35% 0.00% [kernel] [k] el0t_64_sync + 19.35% 0.00% [kernel] [k] el0t_64_sync_handler + 19.35% 0.01% [kernel] [k] el0_svc + 19.33% 0.00% sysbench [.] 0x0000aaaade72affc + 19.33% 0.00% sysbench [.] 0x0000aaaade72a078 + 19.33% 0.00% libmariadb.so.3 [.] 0x0000ffffae08ce54 + 19.33% 0.00% [kernel] [k] invoke_syscall.constprop.0 + 19.27% 0.00% libmariadb.so.3 [.] 0x0000ffffae084f10 + 19.27% 0.00% libmariadb.so.3 [.] 0x0000ffffae084600 + 19.26% 0.00% [kernel] [k] __arm64_sys_connect + 19.24% 0.00% [kernel] [k] inet_stream_connect + 19.24% 0.00% [kernel] [k] inet_hash_connect + 2.81% 0.98% [kernel] [k] __cond_resched + 2.81% 2.26% [kernel] [k] __local_bh_enable_ip __inet_check_established, inet_ehashfn å†…æ ¸å‡½æ•°æ‰§è¡Œå ç”¨è¿‡å¤š cpu å¯ä»¥çœ‹åˆ° __inet_check_established å’Œ inet_ehashfn ä¸¤ä¸ªå‡½æ•°å ç”¨æ¯”è¾ƒé«˜ï¼› TODO: éœ€è¦ç ”ç©¶ä¸€ä¸‹ kernel å‡½æ•° __inet_check_established å’Œ inet_ehashfn æ€§èƒ½æ¶ˆè€—åœ¨äº†å“ªé‡Œã€‚ ç°åœ¨çœ‹çœ‹è¿›ç¨‹åœ¨åšä»€ä¹ˆäº‹æƒ…ï¼š strace -f -p `pidof sysbench` 437 sendto(3, \"5\\0\\0\\0\\3SELECT c FROM sbtest7 WHERE\"..., 57, MSG_DONTWAIT|MSG_NOSIGNAL, NULL, 0) = 57 437 recvfrom(3, 0xffff80027600, 16384, MSG_DONTWAIT, NULL, NULL) = -1 EAGAIN (Resource temporarily unavailable) 437 ppoll([{fd=3, events=POLLIN}], 1, NULL, NULL, 0) = 1 ([{fd=3, revents=POLLIN}]) 437 recvfrom(3, \"\\1\\0\\0\\1\\1*\\0\\0\\2\\3def\\4test\\7sbtest7\\7sbtes\"..., 16384, MSG_DONTWAIT, NULL, NULL) = 689 437 sendto(3, \";\\0\\0\\0\\3SELECT SUM(k) FROM sbtest15\"..., 63, MSG_DONTWAIT|MSG_NOSIGNAL, NULL, 0) = 63 437 recvfrom(3, 0xffff80027600, 16384, MSG_DONTWAIT, NULL, NULL) = -1 EAGAIN (Resource temporarily unavailable) 437 ppoll([{fd=3, events=POLLIN}], 1, NULL, NULL, 0) = 1 ([{fd=3, revents=POLLIN}]) 437 recvfrom(3, \",\\0\\0\\1\\377z\\4#42S02Table 'test.sbtest1\"..., 16384, MSG_DONTWAIT, NULL, NULL) = 48 437 sendto(3, \"%\\0\\0\\0\\3SELECT c FROM sbtest10 WHER\"..., 41, MSG_DONTWAIT|MSG_NOSIGNAL, NULL, 0) = 41 437 recvfrom(3, 0xffff80027600, 16384, MSG_DONTWAIT, NULL, NULL) = -1 EAGAIN (Resource temporarily unavailable) 437 ppoll([{fd=3, events=POLLIN}], 1, NULL, NULL, 0) = 1 ([{fd=3, revents=POLLIN}]) 437 recvfrom(3, \"\", 16384, MSG_DONTWAIT, NULL, NULL) = 0 437 close(3) = 0 437 getpid() = 435 437 socket(AF_INET, SOCK_STREAM, IPPROTO_TCP) = 3 437 fcntl(3, F_SETFL, O_RDONLY|O_NONBLOCK) = 0 437 connect(3, {sa_family=AF_INET, sin_port=htons(3306), sin_addr=inet_addr(\"192.168.245.145\")}, 16) = -1 EINPROGRESS (Operation now in progress) 437 ppoll([{fd=3, events=POLLOUT}], 1, NULL, NULL, 0) = 1 ([{fd=3, revents=POLLOUT}]) 437 getsockopt(3, SOL_SOCKET, SO_ERROR, [0], [4]) = 0 437 fcntl(3, F_SETFL, O_RDONLY) = 0 437 clock_nanosleep(CLOCK_REALTIME, 0, {tv_sec=0, tv_nsec=1000000}, NULL) = ","date":"2024-10-16","objectID":"/why-sysbench-dont-reconnect-after-kill/:3:0","tags":["debug","mysql","sysbench"],"title":"sysbench benchmark MySQL æ—¶å€™ï¼Œä¸ºä»€ä¹ˆ kill è¿æ¥åï¼Œsysbench æ²¡æœ‰é‡è¿","uri":"/why-sysbench-dont-reconnect-after-kill/"},{"categories":null,"content":"é—®é¢˜ ","date":"2024-10-16","objectID":"/why-sysbench-dont-reconnect-after-kill/:4:0","tags":["debug","mysql","sysbench"],"title":"sysbench benchmark MySQL æ—¶å€™ï¼Œä¸ºä»€ä¹ˆ kill è¿æ¥åï¼Œsysbench æ²¡æœ‰é‡è¿","uri":"/why-sysbench-dont-reconnect-after-kill/"},{"categories":null,"content":"ä¸ºä»€ä¹ˆ MySQL 8.4.2 æœ‰çš„ Recv-Q æ˜¯ 28ï¼Œæœ‰çš„æ˜¯ 132 State Recv-Q Send-Q Local Address:Port Peer Address:PortProcess CLOSE-WAIT 28 0 172.17.0.2:37863 192.168.245.145:3306 users:((\"sysbench\",pid=207,fd=20236)) CLOSE-WAIT 28 0 172.17.0.2:55403 192.168.245.145:3306 users:((\"sysbench\",pid=207,fd=16731)) CLOSE-WAIT 132 0 172.17.0.2:53963 192.168.245.145:3306 users:((\"sysbench\",pid=207,fd=25906)) TODO: è¯¦ç»†å­¦ä¹ ä¸€ä¸‹ Recv-Q Send-Q åˆ†åˆ«æ„å‘³ç€å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ… å°è¯•æŠ“ mysqld çš„ syscall å‘ç°ï¼Œæ­£å¸¸çš„ç™»å½•è¿‡ç¨‹ï¼Œsendto å‘é€äº† 77(æ­£å¸¸ç™»å½•å›æ˜¾)+54(è¶…æ—¶å›æ˜¾)+1(close åçš„ fin å ç”¨ä¸€ä¸ª byte)=132 strace -ff -p `pidof mysqld` -o mysqld_syscal.txt 14595 \u003c... accept resumed\u003e{sa_family=AF_INET6, sin6_port=htons(65517), sin6_flowinfo=htonl(0), inet_pton(AF_INET6, \"::ffff:192.168.245.1\", \u0026sin6_addr), sin6_scope_id=0}, [128 =\u003e 28]) = 49 19382 sendto(49, \"2\\0\\0\\1\\377\\207\\4#08S01Got timeout reading\"..., 54, MSG_DONTWAIT, NULL, 0 \u003cunfinished ...\u003e 19382 setsockopt(49, SOL_TCP, TCP_NODELAY, [1], 4) = 0 19382 getpeername(49, {sa_family=AF_INET6, sin6_port=htons(64695), sin6_flowinfo=htonl(0), inet_pton(AF_INET6, \"::ffff:192.168.245.1\", \u0026sin6_addr), sin6_scope_id=0}, [128 =\u003e 28]) = 0 19382 setsockopt(49, SOL_SOCKET, SO_KEEPALIVE, [1], 4) = 0 19382 sendto(49, \"I\\0\\0\\0\\n8.4.2\\0\\2448\\0\\0W%59p.\\21Y\\0\\377\\377\\377\\2\\0\\377\\337\\25\"..., 77, MSG_DONTWAIT, NULL, 0) = 77 19382 recvfrom(49, 0xffff5c1d0db0, 4, MSG_DONTWAIT, NULL, NULL) = -1 EAGAIN (Resource temporarily unavailable) 19382 sendto(49, \"2\\0\\0\\1\\377\\207\\4#08S01Got timeout reading\"..., 54, MSG_DONTWAIT, NULL, 0) = 54 19382 shutdown(49, SHUT_RDWR) = 0 19382 close(49) = 0 19373 setsockopt(49, SOL_TCP, TCP_NODELAY, [1], 4 \u003cunfinished ...\u003e 19373 getpeername(49, {sa_family=AF_INET6, sin6_port=htons(65517), sin6_flowinfo=htonl(0), inet_pton(AF_INET6, \"::ffff:192.168.245.1\", \u0026sin6_addr), sin6_scope_id=0}, [128 =\u003e 28]) = 0 19373 setsockopt(49, SOL_SOCKET, SO_KEEPALIVE, [1], 4) = 0 19373 sendto(49, \"I\\0\\0\\0\\n8.4.2\\0;9\\0\\0\\n(V\\0201D_\\26\\0\\377\\377\\377\\2\\0\\377\\337\\25\"..., 77, MSG_DONTWAIT, NULL, 0) = 77 19373 recvfrom(49, 0xffff78034a00, 4, MSG_DONTWAIT, NULL, NULL) = -1 EAGAIN (Resource temporarily unavailable) echo $((54+77+1)) 132 å°è¯•æŠ“ mysqld çš„ syscall å‘ç°ï¼Œè¿æ¥è¿‡å¤šæ—¶ï¼Œsendto å‘é€äº† 27(too many conn)+1(close åçš„ fin å ç”¨ä¸€ä¸ª byte)=28 14595 accept(20, {sa_family=AF_INET6, sin6_port=htons(64852), sin6_flowinfo=htonl(0), inet_pton(AF_INET6, \"::ffff:192.168.245.1\", \u0026sin6_addr), sin6_scope_id=0}, [128 =\u003e 28]) = 197 14595 setsockopt(197, SOL_TCP, TCP_NODELAY, [1], 4) = 0 14595 sendto(197, \"\\27\\0\\0\\0\\377\\20\\4Too many connections\", 27, MSG_DONTWAIT, NULL, 0) = 27 14595 shutdown(197, SHUT_RDWR) = 0 14595 close(197) = 0 echo $((27+1)) 28 ","date":"2024-10-16","objectID":"/why-sysbench-dont-reconnect-after-kill/:4:1","tags":["debug","mysql","sysbench"],"title":"sysbench benchmark MySQL æ—¶å€™ï¼Œä¸ºä»€ä¹ˆ kill è¿æ¥åï¼Œsysbench æ²¡æœ‰é‡è¿","uri":"/why-sysbench-dont-reconnect-after-kill/"},{"categories":null,"content":"ä¸ºä»€ä¹ˆ CPU è¿™ä¹ˆé«˜ï¼ŒCPU éƒ½åœ¨å¿™ä»€ä¹ˆ perf top å¯ä»¥çœ‹åˆ°ï¼Œkernel åœ¨æ‰§è¡Œ __inet_check_establishedï¼› strace -f -p `pidof sysbench` 437 mprotect(0xffff80037000, 8192, PROT_READ|PROT_WRITE) = 0 437 clock_nanosleep(CLOCK_REALTIME, 0, {tv_sec=0, tv_nsec=1000000}, NULL) = 0 437 getpid() = 435 437 mprotect(0xffff80039000, 8192, PROT_READ|PROT_WRITE) = 0 437 socket(AF_INET, SOCK_STREAM, IPPROTO_TCP) = 6 437 fcntl(6, F_SETFL, O_RDONLY|O_NONBLOCK) = 0 437 connect(6, {sa_family=AF_INET, sin_port=htons(3306), sin_addr=inet_addr(\"192.168.245.145\")}, 16) = -1 EINPROGRESS (Operation now in progress) 437 ppoll([{fd=6, events=POLLOUT}], 1, NULL, NULL, 0) = 1 ([{fd=6, revents=POLLOUT}]) 437 getsockopt(6, SOL_SOCKET, SO_ERROR, [0], [4]) = 0 437 fcntl(6, F_SETFL, O_RDONLY) = 0 437 mprotect(0xffff8003b000, 8192, PROT_READ|PROT_WRITE) = 0 437 clock_nanosleep(CLOCK_REALTIME, 0, {tv_sec=0, tv_nsec=1000000}, NULL) = 0 437 getpid() = 435 437 mprotect(0xffff8003d000, 8192, PROT_READ|PROT_WRITE) = 0 437 socket(AF_INET, SOCK_STREAM, IPPROTO_TCP) = 7 437 fcntl(7, F_SETFL, O_RDONLY|O_NONBLOCK) = 0 437 connect(7, {sa_family=AF_INET, sin_port=htons(3306), sin_addr=inet_addr(\"192.168.245.145\")}, 16) = -1 EINPROGRESS (Operation now in progress) 437 ppoll([{fd=7, events=POLLOUT}], 1, NULL, NULL, 0) = 1 ([{fd=7, revents=POLLOUT}]) 437 getsockopt(7, SOL_SOCKET, SO_ERROR, [0], [4]) = 0 437 fcntl(7, F_SETFL, O_RDONLY) = 0 437 mprotect(0xffff8003f000, 8192, PROT_READ|PROT_WRITE) = 0 437 clock_nanosleep(CLOCK_REALTIME, 0, {tv_sec=0, tv_nsec=1000000}, NULL) = 0 437 getpid() = 435 437 mprotect(0xffff80041000, 8192, PROT_READ|PROT_WRITE) = 0 437 socket(AF_INET, SOCK_STREAM, IPPROTO_TCP) = 8 437 fcntl(8, F_SETFL, O_RDONLY|O_NONBLOCK) = 0 437 connect(8, {sa_family=AF_INET, sin_port=htons(3306), sin_addr=inet_addr(\"192.168.245.145\")}, 16) = -1 EINPROGRESS (Operation now in progress) 437 ppoll([{fd=8, events=POLLOUT}], 1, NULL, NULL, 0) = 1 ([{fd=8, revents=POLLOUT}]) 437 getsockopt(8, SOL_SOCKET, SO_ERROR, [0], [4]) = 0 437 fcntl(8, F_SETFL, O_RDONLY) = 0 437 mprotect(0xffff80043000, 8192, PROT_READ|PROT_WRITE) = 0 437 clock_nanosleep(CLOCK_REALTIME, 0, {tv_sec=0, tv_nsec=1000000}, NULL) = 0 strace -f -c -p `pidof sysbench` strace: Process 207 attached with 3 threads ^Cstrace: Process 207 detached strace: Process 208 detached strace: Process 209 detached % time seconds usecs/call calls errors syscall ------ ----------- ----------- --------- --------- ---------------- 49.55 16.874015 3734 4518 clock_nanosleep 49.22 16.759397 3731 4491 4491 connect 0.56 0.192136 192136 1 restart_syscall 0.25 0.085898 19 4492 close 0.18 0.061314 13 4491 socket 0.11 0.037854 8 4491 fcntl 0.11 0.037465 8 4491 getpid 0.01 0.004097 146 28 write ------ ----------- ----------- --------- --------- ---------------- 100.00 34.052176 1261 27003 4491 total strace å¯ä»¥çœ‹å‡º sysbench åœ¨æ‰§è¡Œ connectï¼Œä½†æ˜¯ä¸€ç›´ errorsï¼Œä¸”å¯ä»¥çœ‹åˆ°å‡ ä¸ª syscall calls ç›¸å·®ä¸å¤§ï¼Œecho $((4518-4491)) = 27 ","date":"2024-10-16","objectID":"/why-sysbench-dont-reconnect-after-kill/:4:2","tags":["debug","mysql","sysbench"],"title":"sysbench benchmark MySQL æ—¶å€™ï¼Œä¸ºä»€ä¹ˆ kill è¿æ¥åï¼Œsysbench æ²¡æœ‰é‡è¿","uri":"/why-sysbench-dont-reconnect-after-kill/"},{"categories":null,"content":"ä»€ä¹ˆåŸå› ä¼šå¯¼è‡´ CLOSE_WAIT çŠ¶æ€ ä» wiki ä¸­æ¬ä¸€å¼ å›¾ï¼š è¢«åŠ¨å…³é—­æ–¹æ¥æ”¶åˆ° fin åï¼Œæ²¡æœ‰å‘é€ finï¼Œè¢«åŠ¨å…³é—­æ–¹çŠ¶æ€åœç•™åœ¨ CLOSE_WAITã€‚æ­¤ä¾‹å­ä¸­ CLOSE_WAIT å‡ºç°åœ¨ sysbench ä¸­ï¼Œè¯´æ˜æ˜¯ç”±äº mysql server å…³é—­å‘èµ· closeï¼Œè€Œå®¢æˆ·ç«¯è¢«åŠ¨å…³é—­æœª closeï¼Œå®¢æˆ·ç«¯ï¼ˆsysbenchï¼‰è¿æ¥çŠ¶æ€ä¸º CLOSE_WAITï¼› åœ¨ sysbench æœºå™¨ä¸­æ‰§è¡Œ nc -vz ip 3306ï¼ŒæŠ¥é”™ Cannot assign requested address. ä¹Ÿè¯´æ˜æ˜¯ sysbench çš„é—®é¢˜ã€‚ bash-4.4# nc -v 192.168.245.145 3306 Ncat: Version 7.92 ( https://nmap.org/ncat ) Ncat: Cannot assign requested address. ","date":"2024-10-16","objectID":"/why-sysbench-dont-reconnect-after-kill/:4:3","tags":["debug","mysql","sysbench"],"title":"sysbench benchmark MySQL æ—¶å€™ï¼Œä¸ºä»€ä¹ˆ kill è¿æ¥åï¼Œsysbench æ²¡æœ‰é‡è¿","uri":"/why-sysbench-dont-reconnect-after-kill/"},{"categories":null,"content":"mysql è¿™é‡Œåœ¨åšä»€ä¹ˆäº‹æƒ…ï¼Ÿmysql å¤šä¹…ä¼šè§¦å‘ close è¡Œä¸ºå‘¢ï¼Ÿ mysql æ¥æ”¶åˆ°è¯·æ±‚ï¼Œåè¶…æ—¶çš„åŒ…åœ¨è¿™é‡Œ å¯ä»¥çœ‹åˆ°ï¼Œmysql åœ¨ 0.00618s mysql è¿”å›äº†ç™»å½•éªŒè¯çš„ promptï¼Œæ­¤æ—¶ mysql ä¸­çš„è¿æ¥çŠ¶æ€æ˜¯ï¼š 10.008458 mysql è¿”å›è¶…æ—¶ã€‚è¯´æ˜ mysql è¿™é‡Œçš„ç™»å½•è¶…æ—¶æ—¶é—´æ˜¯ 10 sã€‚ åç»­è¶…æ—¶çš„è¿æ¥è¢«å†…æ ¸ reset æ‰ã€‚ ","date":"2024-10-16","objectID":"/why-sysbench-dont-reconnect-after-kill/:4:4","tags":["debug","mysql","sysbench"],"title":"sysbench benchmark MySQL æ—¶å€™ï¼Œä¸ºä»€ä¹ˆ kill è¿æ¥åï¼Œsysbench æ²¡æœ‰é‡è¿","uri":"/why-sysbench-dont-reconnect-after-kill/"},{"categories":null,"content":"ä¸ºä»€ä¹ˆ Sysbench è¦ç–¯ç‹‚åˆ›å»º 4 ä¸‡å¤šä¸ªè¿æ¥ TODO: éœ€è¦ç¿»ç¿» sysbench çš„ä»£ç ï¼Œç¡®è®¤ä¸€ä¸‹åŸå› äº†ï¼Œçœ‹åˆ° syscall ä¸­å¤§é‡çš„ connectï¼Œå¤§æ¦‚æ˜¯åˆ°äº†ä¸€ä¸ªæ­»å¾ªç¯å¤„ TODO: perf top ä¸­å±•å¼€å¯ä»¥çœ‹åˆ°å¾ˆå¤šå‡½æ•°åœ°å€ï¼Œå¹¶æ— æ‰§è¡Œçš„å‡½æ•°åå­—ï¼ŒçŒœæµ‹æ˜¯ sysbench çš„å‡½æ•°ï¼Œéœ€è¦ç¼–è¯‘ sysbench åç¡®è®¤ä¸€ä¸‹ TODO: EADDRNOTAVAIL; //Cannot assign requested address è¿™ä¸ªé”™è¯¯çš„å«æ„æ˜¯ä»€ä¹ˆï¼Œä½•æ—¶å‡ºç° ","date":"2024-10-16","objectID":"/why-sysbench-dont-reconnect-after-kill/:4:5","tags":["debug","mysql","sysbench"],"title":"sysbench benchmark MySQL æ—¶å€™ï¼Œä¸ºä»€ä¹ˆ kill è¿æ¥åï¼Œsysbench æ²¡æœ‰é‡è¿","uri":"/why-sysbench-dont-reconnect-after-kill/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šk3s ç¯å¢ƒåœ¨é«˜ CPU\u0026\u0026Memory\u0026\u0026IO è´Ÿè½½ä¸‹ï¼Œpod ä¸­çš„ container éšæœºå¥åº·æ£€æŸ¥å¤±è´¥ é—®é¢˜æ’æŸ¥åŠè§£å†³ åœ¨å¤§æ•°æ®é‡ä¸‹å‹æµ‹ä¸šåŠ¡æ—¶ï¼Œå‘ç°æ¯”è¾ƒéšæœºçš„ pod ä¸­çš„ container failedï¼ˆé‡å¯æ¬¡æ•°ä¸æ–­ç´¯ç§¯ï¼‰, å¥åº·æ£€æŸ¥å¤±è´¥ã€‚ kubectl describe pod postgres-xxxx TODO tail -f /var/lib/rancher/k3s/agent/containerd/containerd.log çœ‹åˆ°éå¸¸å¤šå¦‚ä¸‹æ—¥å¿—ï¼š time=\"2024-08-21T08:42:37.199951601+08:00\" level=error msg=\"ExecSync for \\\"69994ab2f7a951735b5d613d80b9ac33e1c1366a3e0fae5fd9ec24fb545cb1d6\\\" failed\" error=\"rpc error: code = DeadlineExceeded desc = failed to exec in container: timeout 5s exceeded: context deadline exceeded\" ... time=\"2024-07-30T10:39:39.772561484+08:00\" level=error msg=\"get state for 39756d9fdea7fcf15eb76d0c792614681b1d801fb8a70bc72c3042503e619473\" error=\"context deadline exceeded: unknown\" ... å½“å‰éƒ¨ç½²çš„ k3s å·²ç»ä¸ºäº†è§£å†³ etcd ç¨³å®šæ€§é—®é¢˜ï¼Œå°† etcd çš„å­˜å‚¨æŒ‚è½½åˆ°äº† ssd ä¸‹ã€‚è€Œ /var/lib/rancher/k3s/agent/containerd ä¸‹ç›®å½•æ”¾åˆ°æœºæ¢°ç¡¬ç›˜ä¸Šäº†ã€‚è¿™æ¬¡çš„é—®é¢˜å°±åœ¨äº k3s çš„å¥åº·æ£€æŸ¥è®¾ç½®çš„æ—¶é—´ä¸º 5sï¼Œå¥åº·æ£€æŸ¥æ˜¯ containerd æ‰§è¡Œå‘½ä»¤ï¼Œ5s å†… containerd æœªå®é™…æ‰§è¡Œå®Œå¯¹åº”çš„å‘½ä»¤ï¼Œè¶…æ—¶å¤±è´¥å¤šæ¬¡åï¼Œpod å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œpod è¿›å…¥ unhealthy çŠ¶æ€ã€‚å¯¹å¤–çš„è¡¨ç°å°±æ˜¯è®¿é—®å¯¹åº”çš„ service çš„è¯·æ±‚ timeout å¯¼è‡´ä¸šåŠ¡ä¸å¯ç”¨ã€‚ç¤¾åŒº issue å¯ä»¥å‚è€ƒ Containerd fails to stop containers åŠ Pod stuck terminating / KillContainerError è§£å†³åŠæ³•ï¼šå°† /var/lib/rancher/k3s/agent/containerd/ æŒ‚è½½åˆ° ssd ä¸‹å³å¯ã€‚ k3s çš„æ–‡æ¡£ä¸­å·²ç»åœ¨ Resource Profiling ä¸­æè¿°ï¼Œä¸ºäº†ä¿è¯ k3s çš„ç¨³å®šæ€§ï¼Œéœ€è¦å°† /var/lib/rancher/k3s/{agent,server,storage} ä¸‰ä¸ªç›®å½•åˆ†å¼€äº’ä¸å½±å“ã€‚æˆ‘ä»¬å°† k3s agent åŠ server æ”¾åˆ° ssd ä¸‹ï¼Œä¸ storage æ”¾åˆ°ä¸åŒçš„ç›®å½•ä¸‹ï¼Œè§£å†³é«˜è´Ÿè½½ä¸‹ç¨³å®šæ€§é—®é¢˜ã€‚ ","date":"2024-08-20","objectID":"/k8s-pod-random-killed/:0:0","tags":["k8s","k3s","containerd","bugs"],"title":"k3s ç¯å¢ƒåœ¨é«˜ CPU\u0026\u0026Memory\u0026\u0026IO è´Ÿè½½ä¸‹ï¼Œpod ä¸­çš„ container éšæœºå¥åº·æ£€æŸ¥å¤±è´¥","uri":"/k8s-pod-random-killed/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šgolang çš„ timer åœ¨è°ƒæ•´ç³»ç»Ÿæ—¶é—´ä¸‹çš„è¡Œä¸º åœ¨æµ‹è¯• k3s é‡å¯è‡ªåŠ¨ç»­ç­¾è¯ä¹¦æ—¶ï¼Œå‘ç°æ‰‹åŠ¨è°ƒæ•´æœºå™¨æ—¶é—´åï¼Œcalico Unauthorizedï¼Œpod å› æ— æ³•åˆ›å»º network sandbox æ— æ³•å¯åŠ¨ï¼Œä¸”å¯ä»¥çœ‹åˆ° calico-node -monitor-token æ²¡æœ‰æ‰§è¡Œã€‚ calico-node -monitor-token æ˜¯ calico åå°åˆ·æ–°è¯ä¹¦çš„ç¨‹åºï¼Œï¼Œæ¯æ¬¡åˆ·æ–°éƒ½ä¼š time.After max(nextExpiration/4, 5s*4)ã€‚ä½†æ˜¯å®æµ‹ä¸‹æ¥ï¼Œç›´æ¥æ‰‹å·¥è°ƒæ•´æ—¶é—´åï¼Œcalico å¹¶æ²¡æœ‰ä¸»åŠ¨é‡æ–°ç”³è¯· tokenï¼Œè¿™é‡Œæ¶‰åŠåˆ° time.After çš„å·¥ä½œæœºåˆ¶ã€‚ linux æ—¶é—´æœ‰ CLOCK_REALTIME_COARSEï¼ˆå¢™ä¸Šæ—¶é’Ÿï¼‰Â å’ŒÂ CLOCK_MONOTONIC_COARSE ï¼ˆå•è°ƒæ—¶é’Ÿï¼‰ï¼Œè¿™ä¸¤ç§æ—¶é’Ÿè¯¦ç»†è§£é‡Šè§ è¿™é‡Œã€‚ ä» golang ä¸­æ‰¾åˆ°çš„ä»£ç çœ‹åˆ° time.After è°ƒç”¨æ ˆè§ï¼š [checkTimers](https://github.com/golang/go/blob/release-branch.go1.22/src/runtime/proc.go#L3945) [runtimeÂ·nanotime1](https://github.com/golang/go/blob/release-branch.go1.22/src/runtime/sys_linux_amd64.s#L258) å¯ä»¥çœ‹åˆ° golang ä¸­çš„ timer.Timer ä½¿ç”¨çš„æ˜¯ CLOCK_MONOTONIC_COARSE ä¹Ÿå³å•è°ƒæ—¶é’Ÿï¼Œdate å‘½ä»¤è°ƒæ•´æ—¶é—´å¹¶ä¸ä¼šä½“ç°åœ¨è¿™é‡Œè·å¾—åˆ°çš„æ—¶é—´ï¼Œæ‰€ä»¥è°ƒæ•´æ—¶é—´å¹¶ä¸ä¼šè®© calico æŒ‰ç…§å¢™ä¸Šæ—¶é’Ÿå¿«é€Ÿè§¦å‘ã€‚ é—®é¢˜ç¡®è®¤å³å¯å¿«é€Ÿç¡®è®¤æ–¹æ¡ˆï¼Œå¦‚æœä¸ºäº†è§„é¿æ—¶é—´é—®é¢˜ï¼Œå¯ä»¥åªé‡å¯ k3s å³å¯ï¼Œå¦‚æœæœŸæœ›å¯ä»¥å¿«é€Ÿä½¿ç”¨ date è°ƒæ•´æ—¶é—´ calico å¿«é€Ÿæ¢å¤ï¼Œå¯ä»¥è€ƒè™‘é‡å¯ calico-node è¿›ç¨‹é‡æ–°ç”Ÿæˆ kubeconfã€‚ golang issue 12914 ä¸­è®¨è®ºäº† nanotime ç¬¬ä¸‰æ–¹æ— æ³•è°ƒç”¨ï¼Œä»¥åŠå½“å‰çš„è¿›å±•ã€‚å½“å‰å¦‚æœå¸Œæœ›è·å¾— å•è°ƒæ—¶é’Ÿï¼Œå¯ä»¥å‚è€ƒ è¿™ä¸ª ","date":"2024-08-10","objectID":"/go-timer-behavior-in-adjucting-sysmte-time/:0:0","tags":[],"title":"golang çš„ timer åœ¨è°ƒæ•´ç³»ç»Ÿæ—¶é—´ä¸‹çš„è¡Œä¸º","uri":"/go-timer-behavior-in-adjucting-sysmte-time/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šæˆ‘æ˜¯å¦‚ä½•å°† kafka æ¶ˆè´¹ååæé«˜ 100 å€çš„ ","date":"2024-05-13","objectID":"/how-to-increase-alarm-throughput-100-times/:0:0","tags":[],"title":"æˆ‘æ˜¯å¦‚ä½•å°† kafka æ¶ˆè´¹ååæé«˜ 100 å€","uri":"/how-to-increase-alarm-throughput-100-times/"},{"categories":null,"content":"èƒŒæ™¯ å‘Šè­¦å…¥åº“/å½’æ¡£æ•ˆç‡å·®ï¼Œ200 å·¦å³ å‘Šè­¦æ¶ˆè´¹å ç”¨èµ„æºå¤šï¼Œ500w ä¸‹å¤§é‡å‘Šè­¦ä¼šç›´æ¥å‹å®å¹³å°ï¼Œå¹³å°ä¸»è¦ä¸šåŠ¡ 504 timeout å‘Šè­¦é¢‘ç¹å…¥åº“/å½’æ¡£æƒ…å†µä¸‹ï¼Œpostgres æ•°æ®åº“å‘Šè­¦ç›¸å…³è¡¨ç©ºæ´ç‡è¾¾åˆ° 90% ä»¥ä¸Šï¼Œå¤§é‡æ•°æ®ç©ºæ´æ‹–æ…¢æ•°æ®åº“æŸ¥è¯¢å‡ ä¸ªæ•°æ®é‡ ","date":"2024-05-13","objectID":"/how-to-increase-alarm-throughput-100-times/:1:0","tags":[],"title":"æˆ‘æ˜¯å¦‚ä½•å°† kafka æ¶ˆè´¹ååæé«˜ 100 å€","uri":"/how-to-increase-alarm-throughput-100-times/"},{"categories":null,"content":"åˆ†æåŸå›  å•è¡¨å­˜å‚¨è¿‡å¤šæ•°æ®ï¼Œå•è¡¨è¶…è¿‡ 500w è¡Œ æ•°æ®åº“æ’å…¥æ›´æ–°åˆ é™¤é¢‘ç¹ï¼Œpostgres mvvc ä¸ autovacuum æœºåˆ¶æ²¡æœ‰åŠæ—¶è§¦å‘ï¼Œå¯¼è‡´ç©ºæ´ç‡æé«˜ å‘Šè­¦ä¸šåŠ¡æµç¨‹é•¿ï¼Œå¾ˆå¤šå®æ—¶æ€§è¦æ±‚ä¸é«˜çš„é€»è¾‘ï¼ˆå‘Šè­¦è‡ªåŠ¨åŒ–å¤„ç½®/ç»Ÿè®¡ï¼‰ä¸²åœ¨å‘Šè­¦æ¶ˆè´¹è¿‡ç¨‹ä¸­ï¼Œå½±å“å‘Šè­¦åå å‘Šè­¦æ¶ˆè´¹æœ‰å¤§é‡å°è€Œé¢‘ç¹çš„æŸ¥è¯¢ï¼Œæ²¡æœ‰æ·»åŠ ç¼“å­˜ï¼Œæ•°æ®åº“å ç”¨å¤§é‡ qps æ•°æ®åº“ä½¿ç”¨é»˜è®¤é…ç½®ï¼Œå†…å­˜/cpu æ²¡æœ‰å……åˆ†ä½¿ç”¨ ","date":"2024-05-13","objectID":"/how-to-increase-alarm-throughput-100-times/:2:0","tags":[],"title":"æˆ‘æ˜¯å¦‚ä½•å°† kafka æ¶ˆè´¹ååæé«˜ 100 å€","uri":"/how-to-increase-alarm-throughput-100-times/"},{"categories":null,"content":"éƒ½åšäº†å“ªäº›äº‹ æ•°æ®åº“é…ç½®è°ƒä¼˜ å‘Šè­¦åŸºäºæ—¶é—´åˆ†åŒºï¼Œæ¯å¤©ä¸€ä¸ªåˆ†åŒºï¼Œå½’æ¡£æ¯æ¬¡å¤„ç†ä¸€ä¸ªåˆ†åŒºï¼Œåˆ†åŒºç´¢å¼•ä¸å¹¶è¡ŒæŸ¥è¯¢ï¼Œæé«˜æŸ¥è¯¢åååŠç¨³å®šæ€§ å‘Šè­¦æ¶ˆè´¹æµç¨‹é‡æ–°æ¢³ç†ï¼Œæ‹†æˆä¸‰ä¸ªé˜¶æ®µï¼Œå‘Šè­¦å…¥åº“/å‘Šè­¦ç»Ÿè®¡/è‡ªåŠ¨åŒ–å¤„ç½®; å‘Šè­¦æ¶ˆè´¹è¿‡ç¨‹ä¸ä¼šå› ä¸ºå‘Šè­¦è‡ªåŠ¨åŒ–å¤„ç½®æ…¢è€Œå½±å“åˆ°æ•´ä½“çš„åå å‘Šè­¦æ¶‰åŠåˆ°å¤šå¼ è¡¨æ‰¹é‡å…¥åº“ï¼Œæé«˜ååï¼Œé™ä½èµ„æºæ¶ˆè€— å‘Šè­¦å½’æ¡£åŒæ­¥åˆ° hbase ä¸­åï¼Œtruncate å­è¡¨ åŠ  cache æ…¢æŸ¥è¯¢ä¼˜åŒ–ï¼Œä¼˜åŒ– sql åŠæ·»åŠ ç´¢å¼•; åˆ é™¤ä»æœªè¢«ä½¿ç”¨è¿‡çš„ç´¢å¼• æ¶ˆè´¹ç¨‹åºå•ç‹¬ä¸€ä¸ªè¿›ç¨‹ï¼Œèµ„æº/æ•…éšœéš”ç¦» æ¶ˆè´¹æ·»åŠ é™æµï¼Œæé«˜ç¨³å®šæ€§ ","date":"2024-05-13","objectID":"/how-to-increase-alarm-throughput-100-times/:3:0","tags":[],"title":"æˆ‘æ˜¯å¦‚ä½•å°† kafka æ¶ˆè´¹ååæé«˜ 100 å€","uri":"/how-to-increase-alarm-throughput-100-times/"},{"categories":null,"content":"è¾¾åˆ°çš„æ•ˆæœ 32 æ ¸ 64GB 500w å‘Šè­¦ä¸‹ å‘Šè­¦å…¥åº“ååå¯ä»¥åˆ° 40000ï¼Œæ¯”ä¼˜åŒ–å‰é«˜ 2 ä¸ªæ•°é‡çº§ å‘Šè­¦åˆ—è¡¨å–å‰ 20 æ¡æ•°æ® sql æé«˜ 2500 å€ï¼›count é€Ÿåº¦æé«˜ 27 å€ï¼›å‘Šè­¦åˆ—è¡¨æ•´ä½“åŠ è½½æ—¶é—´ç”± 15s ç¼©çŸ­ä¸º 3s ä»¥å†…ï¼Œå‘Šè­¦ç»Ÿè®¡é¡µé¢åŠ è½½æ—¶é—´ 504 timeout ä¼˜åŒ–åˆ° 15s å†… æ•°æ®åº“è°ƒæ•´å‚æ•°åååæé«˜ä¸‰å€ å‘Šè­¦é‡ 3000w æƒ…å†µä¸‹æœåŠ¡å¯ç”¨ï¼Œé¢„æœŸä¼šå­˜åŠå¹´ç”šè‡³æ›´å¤šçš„æ•°æ®åæœåŠ¡ä¾ç„¶å¯ç”¨ ","date":"2024-05-13","objectID":"/how-to-increase-alarm-throughput-100-times/:4:0","tags":[],"title":"æˆ‘æ˜¯å¦‚ä½•å°† kafka æ¶ˆè´¹ååæé«˜ 100 å€","uri":"/how-to-increase-alarm-throughput-100-times/"},{"categories":null,"content":"å‘Šè­¦åˆ—è¡¨ä¼˜åŒ– ä¼˜åŒ–å‰ explain (ANALYZE, VERBOSE, TIMING,COSTS, BUFFERS, SUMMARY) SELECT * FROM \"alarm\" WHERE (judged_state = 1 OR judged_state = 0) ORDER BY alarm.updated_at desc nulls last LIMIT 20; ä¼˜åŒ–å create index if not exists alarm_multiline_index on alarm (created_at desc, updated_at desc nulls last, judged_state, alarm_level, disposed_state); ","date":"2024-05-13","objectID":"/how-to-increase-alarm-throughput-100-times/:4:1","tags":[],"title":"æˆ‘æ˜¯å¦‚ä½•å°† kafka æ¶ˆè´¹ååæé«˜ 100 å€","uri":"/how-to-increase-alarm-throughput-100-times/"},{"categories":null,"content":"å¤§å±å¤§é‡ä½¿ç”¨çš„ count ä¼˜åŒ– 17134.851/623.675 = 27 å€ ä¼˜åŒ–å‰ï¼š explain (ANALYZE, VERBOSE, TIMING,COSTS, BUFFERS, SUMMARY) SELECT COUNT(\"id\") FROM \"alarm\" WHERE created_at \u003e= '2023-05-30 07:34:46.002537+00' AND created_at \u003c '2023-05-31 07:34:46.002537+00'; QUERY PLAN ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------- Finalize Aggregate (cost=840896.65..840896.66 rows=1 width=8) (actual time=17098.462..17134.785 rows=1 loops=1) Output: count(alarm.id) Buffers: shared hit=5615853 read=105541 written=1 -\u003e Gather (cost=840896.23..840896.64 rows=4 width=8) (actual time=17098.338..17134.774 rows=5 loops=1) Output: (PARTIAL count(alarm.id)) Workers Planned: 4 Workers Launched: 4 Buffers: shared hit=5615853 read=105541 written=1 -\u003e Partial Aggregate (cost=839896.23..839896.24 rows=1 width=8) (actual time=17094.127..17094.129 rows=1 loops=5) Output: PARTIAL count(alarm.id) Buffers: shared hit=5615853 read=105541 written=1 Worker 0: actual time=17093.145..17093.148 rows=1 loops=1 Buffers: shared hit=1478094 read=28657 Worker 1: actual time=17093.203..17093.205 rows=1 loops=1 Buffers: shared hit=1470692 read=28510 Worker 2: actual time=17093.147..17093.150 rows=1 loops=1 Buffers: shared hit=886771 read=16085 Worker 3: actual time=17093.167..17093.170 rows=1 loops=1 Buffers: shared hit=882627 read=16017 written=1 -\u003e Parallel Append (cost=0.55..836170.65 rows=1490232 width=37) (actual time=0.946..17023.812 rows=1188508 loops=5) Buffers: shared hit=5615853 read=105541 written=1 Worker 0: actual time=1.212..17006.371 rows=1491562 loops=1 Buffers: shared hit=1478094 read=28657 Worker 1: actual time=0.939..17005.878 rows=1484942 loops=1 Buffers: shared hit=1470692 read=28510 Worker 2: actual time=0.814..17034.576 rows=986228 loops=1 Buffers: shared hit=886771 read=16085 Worker 3: actual time=0.471..17035.496 rows=982083 loops=1 Buffers: shared hit=882627 read=16017 written=1 -\u003e Parallel Index Only Scan using alarm_20230530_pkey on public.alarm_20230530 alarm_1 (cost=0.56..713942.31 rows=1157253 width=37) (actual time=0.796..14931.447 rows=919 379 loops=5) Output: alarm_1.id Index Cond: ((alarm_1.created_at \u003e= '2023-05-30 07:34:46.002537+00'::timestamp with time zone) AND (alarm_1.created_at \u003c '2023-05-31 07:34:46.002537+00'::timestamp wi th time zone)) Heap Fetches: 296346 Buffers: shared hit=4552140 read=88971 written=1 Worker 0: actual time=1.211..16900.689 rows=1491562 loops=1 Buffers: shared hit=1478094 read=28657 Worker 1: actual time=0.938..16900.152 rows=1484942 loops=1 Buffers: shared hit=1470692 read=28510 Worker 2: actual time=0.501..13618.651 rows=537258 loops=1 Buffers: shared hit=532080 read=10556 Worker 3: actual time=1.098..13619.421 rows=536621 loops=1 Buffers: shared hit=530559 read=10531 written=1 -\u003e Parallel Index Only Scan using alarm_20230531_pkey on public.alarm_20230531 alarm_2 (cost=0.55..114777.18 rows=332979 width=37) (actual time=0.860..3347.784 rows=44854 8 loops=3) Output: alarm_2.id Index Cond: ((alarm_2.created_at \u003e= '2023-05-30 07:34:46.002537+00'::timestamp with time zone) AND (alarm_2.created_at \u003c '2023-05-31 07:34:46.002537+00'::timestamp wi th time zone)) Heap Fetches: 68366 Buffers: shared hit=1063713 read=16570 Worker 2: actual time=0.813..3346.199 rows=448970 loops=1 Buffers: shared hit=354691 read=5529 Worker 3: actual time=0.470..3347.495 rows=445462 loops=1 Buffers: shared hit=352068 read=5486 Query Identifier: 4802739785007802293 Planning: Buffers: shared hit=14 Planning Time: 0.299 ms Execution Time: 17134.851 ms (56 rows) ä¼˜åŒ–åï¼š pedestal=# explain (ANALYZE, VERBOSE, TIMING,COSTS, BUFFERS, SUMMARY) SELECT COUNT(*) FROM \"alarm\" WHERE created_at \u003e= '2023-05-30 07:34:46.002537+00' AND created_at \u003c '2023-05-31 07:34:46.002537+00'; QUERY PLAN -------------------------------------------------------------------------------------------------------------------------------","date":"2024-05-13","objectID":"/how-to-increase-alarm-throughput-100-times/:4:2","tags":[],"title":"æˆ‘æ˜¯å¦‚ä½•å°† kafka æ¶ˆè´¹ååæé«˜ 100 å€","uri":"/how-to-increase-alarm-throughput-100-times/"},{"categories":null,"content":"å‘Šè­¦æ¶ˆè´¹ååå¦‚ä½•ä¼˜åŒ– ","date":"2024-05-13","objectID":"/how-to-increase-alarm-throughput-100-times/:5:0","tags":[],"title":"æˆ‘æ˜¯å¦‚ä½•å°† kafka æ¶ˆè´¹ååæé«˜ 100 å€","uri":"/how-to-increase-alarm-throughput-100-times/"},{"categories":null,"content":"è¯¥å¦‚ä½•ä¼˜åŒ– ä¼˜åŒ–æ•°æ®åº“é…ç½®ï¼Œæé«˜æ•°æ®åº“æœ¬èº«çš„å¤„ç†èƒ½åŠ› deadlock_timeout = 2s max_connections = 500 # 16 æ ¸ 8 GB å†…å­˜ shared_buffers = 2GB effective_cache_size = 6GB maintenance_work_mem = 1GB effective_io_concurrency = 2 bgwriter_lru_maxpages = 500 wal_buffers = 32MB max_wal_size = 8GB min_wal_size = 4GB work_mem = 8MB max_worker_processes = 16 max_parallel_workers_per_gather = 4 max_parallel_workers = 16 max_parallel_maintenance_workers = 4 æé«˜ pg å†…å­˜ä½¿ç”¨é‡ æé«˜ pg cpu ä½¿ç”¨é‡ï¼Œsql å¹¶è¡ŒæŸ¥è¯¢ æ‰¹é‡å…¥åº“æé«˜åå const ( AlarmSize = 50000 AlarmBatch = 100 ) // go test -timeout 30s -run ^TestSingleInsert$ github.com/exfly/alarmopt func TestSingleInsert(t *testing.T) { err := DB.AutoMigrate(\u0026Alarm{}) require.NoError(t, err) err = DB.Exec(\"truncate alarm;\").Error require.NoError(t, err) alarms := testGenAlarm(t, AlarmSize) err = DB.Debug().CreateInBatches(alarms, 1).Error require.NoError(t, err) } // go test -timeout 30s -run ^TestBatchInsert$ github.com/exfly/alarmopt func TestBatchInsert(t *testing.T) { err := DB.AutoMigrate(\u0026Alarm{}) require.NoError(t, err) err = DB.Exec(\"truncate alarm;\").Error require.NoError(t, err) alarms := testGenAlarm(t, AlarmSize) err = DB.Debug().CreateInBatches(alarms, AlarmBatch).Error require.NoError(t, err) } go test -timeout 30s -run ^TestSingleInsert$ github.com/exfly/alarmopt ok github.com/exfly/alarmopt 20.156s go test -timeout 30s -run ^TestBatchInsert$ github.com/exfly/alarmopt ok github.com/exfly/alarmopt 0.551s 20.156/0.551 = 36.58 å€ ","date":"2024-05-13","objectID":"/how-to-increase-alarm-throughput-100-times/:5:1","tags":[],"title":"æˆ‘æ˜¯å¦‚ä½•å°† kafka æ¶ˆè´¹ååæé«˜ 100 å€","uri":"/how-to-increase-alarm-throughput-100-times/"},{"categories":null,"content":"å¦‚ä½•åšçš„å‘Šè­¦æ¶ˆè´¹æ‰¹é‡å…¥åº“ å‘Šè­¦æ¶ˆè´¹æ˜¯ä» kafka ä¸­æ¶ˆè´¹æ•°æ®ï¼Œè§å¦‚ä¸‹ä»£ç ã€‚Kafka æ¶ˆæ¯ä¼ é€’é‡‡ç”¨çš„æ–¹å¼æ˜¯å®šæ—¶ä» Server ä¸­ pull Messageï¼Œä¸€æ¬¡ pull ä¼šæ‹‰å¤šæ¡æ•°æ®ï¼Œä½†æ˜¯ sarama çš„ ConsumerGroup æš´æ¼å‡ºçš„ interface sarama.ConsumerGroupClaim ä¸­æ²¡æœ‰åŠæ³•ä¸€æ¬¡æ€§è·å¾—æ•´æ‰¹æ•°æ®ï¼Œéœ€è¦å®ç°è¿™éƒ¨åˆ†èšåˆé€»è¾‘ã€‚ type handler struct { actPool *ants.PoolWithFunc } func (consumer *handler) Setup(session sarama.ConsumerGroupSession) error { return nil } func (consumer *handler) Cleanup(session sarama.ConsumerGroupSession) error { return nil } func (consumer *handler) ConsumeClaim(session sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) error { for message := range claim.Messages() { if err := consumer.actPool.Invoke(message); err != nil { if err == ants.ErrPoolClosed { return err } } session.MarkMessage(message, \"\") } return nil } éœ€è¦çš„èšåˆé€»è¾‘å¦‚ä¸‹æ‰€è¿°ï¼š ä» chan ä¸­ä¸€æ¬¡æ‹¿å‡ºä¸€ä¸ª Messsage å¤šæ¡æ¶ˆæ¯æŒ‰ç…§å¦‚ä¸‹è§„åˆ™èšåˆåˆ°ä¸€èµ· å½“æ•°é‡è¾¾åˆ° N ä¸ªæ—¶ ä¸Šä¸€æ¬¡å‘é€æ•°æ®åˆ°å½“å‰æ—¶é—´è¶…è¿‡ T æ—¶ æ‰¹é‡å…¥åº“æ‰‹åŠ¨å®ç° import ( \"context\" \"log/slog\" \"os\" \"sync\" \"testing\" \"time\" ) var ( logger = slog.New(slog.NewTextHandler(os.Stderr, \u0026slog.HandlerOptions{AddSource: true, Level: slog.LevelDebug})) ) type Alarm struct { ID int } type batchInsert struct { do func(context.Context, []Alarm) error interval time.Duration maxBatchSize int64 lock sync.RWMutex buf []Alarm once sync.Once } func (b *batchInsert) Do(ctx context.Context, in Alarm) error { b.once.Do(func() { go func() { ticker := time.NewTicker(b.interval) for range ticker.C { if b.lock.TryLock() { if len(b.buf) \u003e 0 { logger.Info(\"timer do\") if err := b.do(ctx, b.buf); err != nil { logger.Error(\"in ticker do failed\", \"err\", err) } else if err == nil { b.buf = nil } } b.lock.Unlock() } } }() }) b.lock.Lock() defer b.lock.Unlock() if b.buf == nil { b.buf = make([]Alarm, 0, b.maxBatchSize) } b.buf = append(b.buf, in) if len(b.buf) \u003e= int(b.maxBatchSize) { logger.Info(\"realtime do\") if err := b.do(ctx, b.buf); err != nil { logger.Error(\"do failed\", \"err\", err) } else if err == nil { b.buf = nil } } return nil } ç¤¾åŒº dataloader å®ç° dataloader æ¥èµ„æº Facebook çš„ graphqlï¼Œä¸ºäº†è§£å†³å…¶ N+1 é—®é¢˜å‡ºç°çš„ go é‡çš„ Dataloader å®ç°ï¼šhttps://github.com/graph-gophers/dataloader/tree/master package alarmopt import ( \"context\" \"testing\" \"time\" dataloader \"github.com/graph-gophers/dataloader/v7\" ) func TestDataloaderNoCache(t *testing.T) { batchFunc := func(_ context.Context, keys []int) []*dataloader.Result[*Alarm] { var results []*dataloader.Result[*Alarm] // do some pretend work to resolve keys for _, k := range keys { results = append(results, \u0026dataloader.Result[*Alarm]{Data: \u0026Alarm{ID: k}}) } logger.Debug(\"real do\", \"ids\", keys) return results } cache := \u0026dataloader.NoCache[int, *Alarm]{} loader := dataloader.NewBatchedLoader( batchFunc, dataloader.WithCache[int, *Alarm](cache), dataloader.WithWait[int, *Alarm](time.Second*3), dataloader.WithBatchCapacity[int, *Alarm](5), dataloader.WithInputCapacity[int, *Alarm](1), ) for i := 0; i \u003c 50; i++ { logger.Debug(\"submit\", \"id\", i) loader.Load(context.Background(), i) } } func TestAlarmDataloaderNoCacheRetResult(t *testing.T) { batchFunc := func(_ context.Context, keys []Alarm) []*dataloader.Result[*Alarm] { var results []*dataloader.Result[*Alarm] // do some pretend work to resolve keys for _, k := range keys { results = append(results, \u0026dataloader.Result[*Alarm]{Data: \u0026Alarm{ID: k.ID}}) } logger.Debug(\"real do\", \"ids\", keys) return results } cache := \u0026dataloader.NoCache[Alarm, *Alarm]{} loader := dataloader.NewBatchedLoader( batchFunc, dataloader.WithCache[Alarm, *Alarm](cache), dataloader.WithWait[Alarm, *Alarm](time.Second*3), dataloader.WithBatchCapacity[Alarm, *Alarm](5), dataloader.WithInputCapacity[Alarm, *Alarm](1), ) for i := 0; i \u003c 50; i++ { logger.Debug(\"submit\", \"id\", i) result, err := loader.Load(context.Background(), Alarm{ID: i})() if err != nil { t.Error(err) } _ = result } } ","date":"2024-05-13","objectID":"/how-to-increase-alarm-throughput-100-times/:5:2","tags":[],"title":"æˆ‘æ˜¯å¦‚ä½•å°† kafka æ¶ˆè´¹ååæé«˜ 100 å€","uri":"/how-to-increase-alarm-throughput-100-times/"},{"categories":null,"content":"REF ä¸ºä»€ä¹ˆé»˜è®¤ä½¿ç”¨ PostgreSQL æ•°æ®åº“ï¼Ÿ ","date":"2024-05-13","objectID":"/how-to-increase-alarm-throughput-100-times/:6:0","tags":[],"title":"æˆ‘æ˜¯å¦‚ä½•å°† kafka æ¶ˆè´¹ååæé«˜ 100 å€","uri":"/how-to-increase-alarm-throughput-100-times/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šç¦»çº¿å®‰è£…å„ç§å®¹å™¨å¼•æ“ï¼Œdocker/containerd+nerdctl ","date":"2024-05-07","objectID":"/install-docker-engine-from-bin/:0:0","tags":["docker","linux","nerdctl","containerd","ops"],"title":"ç¦»çº¿å®‰è£…å¼€ç®±å³ç”¨çš„å®¹å™¨è¿è¡Œç¯å¢ƒè¿è¡Œç¯å¢ƒ","uri":"/install-docker-engine-from-bin/"},{"categories":null,"content":"èƒŒæ™¯ é€šå¸¸æ¯ä¸ª linux å‘è¡Œç‰ˆéƒ½ä¼šè‡ªå¸¦çš„åŒ…ç®¡ç†å®‰è£… dockerï¼Œä½†è¿™ç§å®‰è£…æ–¹å¼åœ¨ to b å®Œå…¨ç¦»çº¿ç¯å¢ƒä¸‹é€‚é…ä¸åŒç§ linux å‘è¡Œç‰ˆå®‰è£…æˆæœ¬æ¯”è¾ƒé«˜ã€‚docker ç”± golang å¼€å‘ï¼Œä¾èµ–éƒ½æ˜¯æ†ç»‘åˆ°ä¸€èµ·çš„ï¼Œç›´æ¥å¤åˆ¶äºŒè¿›åˆ¶æ–‡ä»¶å³å¯å®Œæˆéƒ¨ç½²ï¼Œç®€å•ä¾¿æ·ã€‚Docker å®˜æ–¹ä»‹ç»äº†ä¸€ç§ Install Docker Engine from binaries æ–¹æ³•ï¼Œä½†æ˜¯è¿™ç§æ–¹å¼ä¸å®Œæ•´ï¼šThis page contains information on how to install Docker using binaries. These instructions are mostly suitable for testing purposes. We do not recommend installing Docker using binaries in production environments as they don't have automatic security updates.ã€‚æœ¬æ–‡å°†ä»‹ç»ä¸€ç§ç”Ÿäº§å¯ç”¨çš„ç¦»çº¿å®‰è£… dockerã€ä¸”è·¨ linux å‘è¡Œç‰ˆçš„æ–¹æ³•ã€‚ ","date":"2024-05-07","objectID":"/install-docker-engine-from-bin/:1:0","tags":["docker","linux","nerdctl","containerd","ops"],"title":"ç¦»çº¿å®‰è£…å¼€ç®±å³ç”¨çš„å®¹å™¨è¿è¡Œç¯å¢ƒè¿è¡Œç¯å¢ƒ","uri":"/install-docker-engine-from-bin/"},{"categories":null,"content":"æ–¹æ³• 1: å®‰è£…å®˜æ–¹çš„ docker ç¦»çº¿åŒ… Docker å®˜æ–¹æ–‡æ¡£ä¸­æä¾›çš„æ–¹æ³• ä½¿ç”¨çš„æ–¹æ³•æ˜¯ sudo dockerd \u0026 ï¼Œæ²¡æœ‰æœåŠ¡ä¿æ´»ï¼Œä¸é€‚ç”¨ä¸ç”Ÿäº§ä½¿ç”¨ã€‚åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå®Œå–„ä¸€ä¸‹ä¿æ´»åŸºæœ¬å°±å¯ä»¥äº†ã€‚ å¦‚ä¸‹ä¸º package.shï¼Œæ‰“åŒ…ä¸€ä¸ªç¦»çº¿å®‰è£…åŒ… #!/usr/bin/env bash set -o errtrace set -o errexit set -o nounset set -o pipefail set -o xtrace cd \"$(dirname \"$0\")\" function debug() { echo \"[$(date +'%Y-%m-%dT%H:%M:%S%z')]:DEBU: $*\" \u003e\u00262 } function info() { echo \"[$(date +'%Y-%m-%dT%H:%M:%S%z')]:INFO: $*\" \u003e\u00262 } function err() { echo \"[$(date +'%Y-%m-%dT%H:%M:%S%z')]:ERRR: $*\" \u003e\u00262 } DOCKER_VERSION=\"${DOCKER_VERSION:-\"26.1.1\"}\" DOCKRE_MIRROR=${DOCKRE_MIRROR:-\"https://mirrors.tuna.tsinghua.edu.cn\"} function machine_arch() { arch=$(uname -m) case $arch in x86_64) echo amd64 ;; aarch64) echo arm64 ;; *) echo $arch ;; esac } function docker_arch() { arch=$(uname -m) case $arch in arm64) echo aarch64 ;; *) echo $arch ;; esac } # https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/static/stable/aarch64/docker-26.1.1.tgz DOCKER_DOWNLOAD_URL=\"${DOCKRE_MIRROR}/docker-ce/linux/static/stable/$(docker_arch)/docker-${DOCKER_VERSION}.tgz\" BASEPATH=./installer mkdir -p $BASEPATH pushd $BASEPATH wget $DOCKER_DOWNLOAD_URL popd mkdir -p $BASEPATH/docker cat \u003e $BASEPATH/docker/daemon.json \u003c\u003c'EOF' { \"live-restore\": true, \"log-driver\": \"json-file\", \"log-opts\": { \"max-size\": \"200m\" } } EOF mkdir -p $BASEPATH/systemd cat \u003e $BASEPATH/systemd/containerd.service \u003c\u003c'EOF' [Unit] Description=containerd container runtime Documentation=https://containerd.io After=network.target [Service] ExecStartPre=-/sbin/modprobe overlay ExecStart=/usr/local/bin/containerd Restart=always RestartSec=2 TimeoutSec=30 StartLimitInterval=0 KillMode=process Delegate=yes LimitNOFILE=1048576 # Having non-zero Limit*s causes performance problems due to accounting overhead # in the kernel. We recommend using cgroups to do container-local accounting. LimitNPROC=infinity LimitCORE=infinity # TasksMax=infinity [Install] WantedBy=multi-user.target EOF cat \u003e $BASEPATH/systemd/docker.service \u003c\u003c'EOF' [Unit] Description=Docker Application Container Engine Documentation=https://docs.docker.com BindsTo=containerd.service After=network-online.target firewalld.service Wants=network-online.target Requires=docker.socket [Service] Type=notify # the default is not to use systemd for cgroups because the delegate issues still # exists and systemd currently does not support the cgroup feature set required # for containers run by docker ExecStart=/usr/local/bin/dockerd -H fd:// ExecReload=/bin/kill -s HUP $MAINPID TimeoutSec=30 RestartSec=2 Restart=always # Note that StartLimit* options were moved from \"Service\" to \"Unit\" in systemd 229. # Both the old, and new location are accepted by systemd 229 and up, so using the old location # to make them work for either version of systemd. StartLimitBurst=3 # Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230. # Both the old, and new name are accepted by systemd 230 and up, so using the old name to make # this option work for either version of systemd. # retry start always StartLimitInterval=0 # Having non-zero Limit*s causes performance problems due to accounting overhead # in the kernel. We recommend using cgroups to do container-local accounting. LimitNOFILE=infinity LimitNPROC=infinity LimitCORE=infinity # Comment TasksMax if your systemd version does not supports it. # Only systemd 226 and above support this option. # TasksMax=infinity # set delegate yes so that systemd does not reset the cgroups of docker containers Delegate=yes # kill only the docker process, not all processes in the cgroup KillMode=process [Install] WantedBy=multi-user.target EOF cat \u003e $BASEPATH/systemd/docker.socket \u003c\u003c'EOF' [Unit] Description=Docker Socket for the API PartOf=docker.service [Socket] ListenStream=/var/run/docker.sock SocketMode=0660 SocketUser=root SocketGroup=docker [Install] WantedBy=sockets.target EOF tar -zvcf dockerbin-installer.tar.gz installer install.sh å…¶ä¸­ install.sh å†…å®¹ä¸ºï¼š #!/usr/bin/env bash set -o errtrace set -o errexit set -o nounset set -o pipefail set ","date":"2024-05-07","objectID":"/install-docker-engine-from-bin/:2:0","tags":["docker","linux","nerdctl","containerd","ops"],"title":"ç¦»çº¿å®‰è£…å¼€ç®±å³ç”¨çš„å®¹å™¨è¿è¡Œç¯å¢ƒè¿è¡Œç¯å¢ƒ","uri":"/install-docker-engine-from-bin/"},{"categories":null,"content":"æ–¹æ³• 2: nerdctl docker çš„å†…å­˜å ç”¨ç›¸å¯¹æ¥è¯´è¿˜æ˜¯è¿‡äºå¤æ‚ï¼Œè¿›ç¨‹ä¼šåŒ…å« containerd + dockerdï¼Œå¹¶ä¸” dockerd æœ¬èº«å°±åŒ…å«äº†è‡ªå·±çš„ç½‘ç»œå®ç°å’Œ overlay å­˜å‚¨å®ç°ã€‚è€Œ containerd + ctr å³å¯å®Œæˆå¯¹æ—¥å¸¸å®¹å™¨é•œåƒçš„ç®¡ç†ç­‰å·¥ä½œï¼Œå†é…åˆ nerdctl å…¼å®¹éƒ¨åˆ† docker çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œå¦‚æœåªæ˜¯åœ¨ç±»ä¼¼äº‘ä¸»æœºä¸­è·‘æœåŠ¡çš„åœºæ™¯ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•æ›¿æ¢ã€‚ nerdctl çš„å®‰è£…éå¸¸ç®€å•ï¼Œå† nerdctl release ä¸­ä¸‹è½½nerdctl-full-*-linux-*.tar.gz, `` wget -O nerdctl-full-1.7.6-linux-amd64.tar.gz https://github.com/containerd/nerdctl/releases/download/v1.7.6/nerdctl-full-1.7.6-linux-amd64.tar.gz tar -zvxf nerdctl-full-*-linux-amd64.tar.gz -C /usr/local sudo systemctl enable --now containerd sudo systemctl enable --now buildkit # å¦‚æœéœ€è¦ docker buildï¼Œåˆ™éœ€è¦å¯åŠ¨ä»– nerdctl run --debug-full -d --name nginx -p 80:80 nginx:alpine nerdctl åŒ…å« compose å‘½ä»¤ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ ","date":"2024-05-07","objectID":"/install-docker-engine-from-bin/:3:0","tags":["docker","linux","nerdctl","containerd","ops"],"title":"ç¦»çº¿å®‰è£…å¼€ç®±å³ç”¨çš„å®¹å™¨è¿è¡Œç¯å¢ƒè¿è¡Œç¯å¢ƒ","uri":"/install-docker-engine-from-bin/"},{"categories":null,"content":"æ–¹æ³• 3: truenas scale ä¸­ä½¿ç”¨ç±» docker çš„ä½“éªŒ ç© truenas scale çš„å°ä¼™ä¼´ä¼šäº†è§£åˆ°ï¼Œtruenas scale ä¸­å®é™…å¯åŠ¨äº†ä¸€ä¸ªå•èŠ‚ç‚¹çš„ k3s ä½œä¸ºå®¹å™¨å¼•æ“ã€‚å¾ˆå¤šå°ä¼™ä¼´åé¦ˆ k3s çš„å­¦ä¹ é—¨æ§›è¿‡é«˜äº†ã€‚truenas scale è™½ç„¶æ˜¯åŸºäº debian çš„ linux å‘è¡Œç‰ˆï¼Œå®é™…ä½¿ç”¨çš„åŒ…ç®¡ç†ä¸æ˜¯ aptï¼Œä¸”ä¸èƒ½ä½¿ç”¨ apt å®‰è£…å…¶ä»–çš„åŒ…ï¼Œå…·ä½“ä¿¡æ¯å¦‚ä¸‹ï¼š apt Package management tools are disabled on TrueNAS appliances. Attempting to update SCALE with apt or methods other than the SCALE web interface can result in a nonfunctional system. ç»è¿‡è°ƒç ”ï¼Œå¯ä»¥ä½¿ç”¨ è¿™ä¸ªé¡¹ç›® ï¼Œä½¿ç”¨ nerdctl ä½œä¸º å®¢æˆ·ç«¯è®¿é—®éš”ç¦»ç¯å¢ƒä¸­çš„ containerdï¼Œåšåˆ°ä¸ æ–¹æ³• 2 ä¸­æè¿°çš„ç›¸åŒä½¿ç”¨ä½“éªŒã€‚ å†æˆ‘çš„ truenas ä¸­ï¼Œæˆ‘çš„å·¥ä½œæµæ˜¯æœ¬åœ°ä½¿ç”¨ docker-compose å°†éœ€è¦é…ç½®çš„æœåŠ¡å†™å¥½ï¼Œç„¶å rsync åˆ° trunenas ä¸Šï¼Œnerdctl compose up -d å®Œäº‹ã€‚å¦‚æœæ·»åŠ çš„ alias docker=nerdctl, å‡ ä¹å¯ä»¥å¿½ç•¥æ‰ nerdctl çš„å­˜åœ¨ï¼Œå½“æˆ docker ä½¿ç”¨å³å¯ã€‚ ","date":"2024-05-07","objectID":"/install-docker-engine-from-bin/:4:0","tags":["docker","linux","nerdctl","containerd","ops"],"title":"ç¦»çº¿å®‰è£…å¼€ç®±å³ç”¨çš„å®¹å™¨è¿è¡Œç¯å¢ƒè¿è¡Œç¯å¢ƒ","uri":"/install-docker-engine-from-bin/"},{"categories":null,"content":"æ€»ç»“ å¦‚ä¸Šï¼Œè¯·æ¬¢å¿«çš„ä½¿ç”¨ docker / containerd å§ã€‚ ","date":"2024-05-07","objectID":"/install-docker-engine-from-bin/:5:0","tags":["docker","linux","nerdctl","containerd","ops"],"title":"ç¦»çº¿å®‰è£…å¼€ç®±å³ç”¨çš„å®¹å™¨è¿è¡Œç¯å¢ƒè¿è¡Œç¯å¢ƒ","uri":"/install-docker-engine-from-bin/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šä¸€æ¬¡ sarama è®¿é—® kafka æŠ¥é”™ client/metadata got error from broker 1002 while fetching metadata: write tcp x.x.x.x:49749-\u003ex.x.x.x:9092: write: broken pipe é—®é¢˜æ’æŸ¥ ","date":"2024-04-08","objectID":"/kafka-sarama-go-fetch-metadta-write-broken-pipe/:0:0","tags":[],"title":"Kafka Sarama Go Fetch Metadta Write Broken Pipe","uri":"/kafka-sarama-go-fetch-metadta-write-broken-pipe/"},{"categories":null,"content":"é—®é¢˜ç°è±¡ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²äº† 3 èŠ‚ç‚¹ kafka é›†ç¾¤ï¼Œç”¨ golang ä½¿ç”¨ IBM/sarama çš„ consumergroup æ¶ˆè´¹ kafka æ•°æ®ï¼Œè§„å¾‹æ€§çš„æŠ¥é”™ï¼š 2024-04-01T19:20:08.341+0800 ERROR [Input] [Kafka-Sarama] client/metadata got error from broker 1002 while fetching metadata: write tcp myclient:57096-\u003emyserver:9092: write: broken pipe ... 2024-04-01T21:29:07.462+0800 ERROR [Input] [Kafka-Sarama] client/metadata got error from broker 1002 while fetching metadata: EOF sarama çš„é…ç½®è§ï¼š config := sarama.NewConfig() // Kafka broker ç‰ˆæœ¬å· version, err := sarama.ParseKafkaVersion(\"2.0.0\") if err != nil { return err } config.Version = version config.Net.KeepAlive = time.Second * 5 config.ClientID = i.Name + \"test-abc\" config.Metadata.RefreshFrequency = 1 * time.Minute config.Metadata.Retry.Max = 9999999 config.Metadata.Retry.BackoffFunc = func(retries, maxRetries int) time.Duration { if retries \u003e= maxRetries { return 0 } log.Info(\"[Input] [Kafka] Metadata Has Anomalies, Please Handle It\") return 20 * time.Second } config.Consumer.Offsets.Initial = -1 config.Consumer.Group.Heartbeat.Interval = time.Second * 3 è¯¦ç»†æ—¥å¿—è§ 2024-04-01T19:05:11.132+0800 DEBUG [Input] [Kafka-Sarama] consumer/broker/1001 added subscription to test4/0 2024-04-01T19:06:08.015+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from broker bg43:9092 2024-04-01T19:07:07.995+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from broker bg43:9092 2024-04-01T19:08:07.857+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from broker bg43:9092 2024-04-01T19:09:07.548+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from broker bg43:9092 2024-04-01T19:10:07.793+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from broker bg43:9092 2024-04-01T19:11:07.849+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from broker bg42:9092 2024-04-01T19:12:09.010+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from broker bg43:9092 2024-04-01T19:13:08.559+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from broker bg43:9092 2024-04-01T19:14:07.847+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from broker bg43:9092 2024-04-01T19:15:07.692+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from broker bg43:9092 2024-04-01T19:16:08.470+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from broker bg43:9092 2024-04-01T19:17:08.396+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from broker bg43:9092 2024-04-01T19:18:08.160+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from broker bg43:9092 2024-04-01T19:19:07.845+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from broker bg43:9092 2024-04-01T19:20:08.341+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from broker bg41:9092 2024-04-01T19:20:08.341+0800 ERROR [Input] [Kafka-Sarama] client/metadata got error from broker 1002 while fetching metadata: write tcp myclient:57096-\u003emyserver:9092: write: broken pipe 2024-04-01T19:20:08.341+0800 DEBUG [Input] [Debug] [Kafka-Sarama] Closed connection to broker bg41:9092 2024-04-01T19:20:08.341+0800 DEBUG [Input] [Kafka-Sarama] client/brokers deregistered broker #1002 at bg41:9092 2024-04-01T19:20:09.476+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from broker bg42:9092 2024-04-01T19:20:09.506+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/brokers registered new broker #1002 at bg41:9092 2024-04-01T19:21:08.197+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from br","date":"2024-04-08","objectID":"/kafka-sarama-go-fetch-metadta-write-broken-pipe/:1:0","tags":[],"title":"Kafka Sarama Go Fetch Metadta Write Broken Pipe","uri":"/kafka-sarama-go-fetch-metadta-write-broken-pipe/"},{"categories":null,"content":"è§£å†³åŠæ³• sarama çš„ keepalive åŠ heatbeat æœºåˆ¶é—®é¢˜ï¼Œå¹¶éå¯¹æ‰€æœ‰èŠ‚ç‚¹éƒ½æœ‰å¯é çš„ heatbeatï¼Œè¯·æ±‚é—²ç½®æ—¶é—´è¶…è¿‡é˜ˆå€¼è¿æ¥è¢« kafka server ä¸»åŠ¨ closeï¼Œsarama ä½¿ç”¨äº†è¿™ä¸ªåçš„è¿æ¥å¯¼è‡´ write: broken pipe æˆ– EOF + // manual heatbeat + go func() { + for range time.NewTicker(time.Minute).C { + fmt.Printf(\"manual heatbeat\\n\") + for _, one := range client.Brokers() { + _, err := one.Heartbeat(\u0026sarama.HeartbeatRequest{}) + if err != nil { + fmt.Printf(\"%v %v\\n\", one.Addr(), err) + } + } + } + }() + ","date":"2024-04-08","objectID":"/kafka-sarama-go-fetch-metadta-write-broken-pipe/:2:0","tags":[],"title":"Kafka Sarama Go Fetch Metadta Write Broken Pipe","uri":"/kafka-sarama-go-fetch-metadta-write-broken-pipe/"},{"categories":null,"content":"TL;DR ","date":"2024-04-08","objectID":"/kafka-sarama-go-fetch-metadta-write-broken-pipe/:3:0","tags":[],"title":"Kafka Sarama Go Fetch Metadta Write Broken Pipe","uri":"/kafka-sarama-go-fetch-metadta-write-broken-pipe/"},{"categories":null,"content":"why kafka close conn? çœ‹åˆ° write: broken pipe é¦–å…ˆä»åº•å±‚åˆ†æï¼Œå¯èƒ½æ¥æºä¸ºæœåŠ¡ç«¯ä¸»åŠ¨ closeã€‚kafka ä¸»åŠ¨ close å¯èƒ½æ¥æºä¸ºä¸¤å¤„ tcp keepalive åº”ç”¨å±‚è¶…è¿‡äº† connections.max.idle.ms TCP keepalive å…ˆçœ‹ç¬¬ä¸€ç§æƒ…å†µï¼ŒTCP keepalive å›¾ä¸­é«˜äº®çš„ä¸€ä¸ªåŒ…æ˜¯ç¬¬ä¸€æ¬¡å¼€å§‹ TCP keepalive çš„åœ°æ–¹ï¼Œæ¯ä¸ª tcp keepalive é—´éš” 5s å·¦å³ï¼Œæ°å¥½ä¸ä»£ç ä¸­çš„é…ç½® config.Net.KeepAlive = time.Second * 5 åŒ¹é…ã€‚è¯´æ˜ tcp keepalive å‚æ•°å·²ç»æŒ‰ç…§é¢„æœŸå·¥ä½œäº†ã€‚ kafka connections.max.idle.ms æŸ¥çœ‹é…ç½®ï¼Œå‘ç°é»˜è®¤çš„ connections.max.idle.ms 10 åˆ†é’Ÿï¼Œsession.timeout.ms ä¸º 45sï¼Œè€Œæ¯æ¬¡åˆ° client/metadata fetching metadata for all topics from broker bg41:9092 åˆ° write: broken pipe çš„æœ€å°é—´éš”æ—¶é—´éƒ½è¶…è¿‡äº† 10minï¼Œæ—¥å¿—ä¸­ä¸€ä¸ªä¾‹å­å¦‚ä¸‹ï¼Œé—´éš”ä¸º 18minï¼š 2024-04-01T21:46:07.437+0800 DEBUG [Input] [Debug] [Kafka-Sarama] client/metadata fetching metadata for all topics from broker bg41:9092 2024-04-01T22:04:07.444+0800 ERROR [Input] [Kafka-Sarama] client/metadata got error from broker 1002 while fetching metadata: write tcp myclient:62648-\u003emyserver:9092: write: broken pipe åœ¨ tcpdump ä¸­çœ‹åˆ°ä¸€æ¬¡ fetch medadate åˆ° write broken pipe ç»å†äº† (2447-1756)/60 = 11.51minã€‚ æ—¢ç„¶æ˜¯è¶…è¿‡äº†æœ€å¤§ç©ºé—²æ—¶é—´ï¼Œæƒ³åˆ°ä½¿ç”¨è·Ÿ kafka äº¤äº’æœ€è½»é‡çš„æ“ä½œ heartbeat è¯•è¯•çœ‹æ˜¯å¦å¯ä»¥ä¿®å¤ã€‚æŒ‰ç…§ä¸Šæ–‡çš„ è§£å†³åŠæ³• ä¿®å¤åï¼Œä¾¿ä¸å†å‡ºç° write: broken pipe é”™è¯¯ï¼Œè‡³æ­¤ï¼Œå¯ä»¥å®Œå…¨ç¡®è®¤æ˜¯ sarama è§¦å‘äº† kafka çš„æœ€å¤§ç©ºé—²æ—¶é—´ (connections.max.idle.ms) å¯¼è‡´çš„ã€‚ ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ ","date":"2024-04-08","objectID":"/kafka-sarama-go-fetch-metadta-write-broken-pipe/:3:1","tags":[],"title":"Kafka Sarama Go Fetch Metadta Write Broken Pipe","uri":"/kafka-sarama-go-fetch-metadta-write-broken-pipe/"},{"categories":null,"content":"sarama çš„ heatbeat æ˜¯æ€ä¹ˆå·¥ä½œçš„ TODO: è¯¦ç»†çš„åˆ†æä¸€ä¸‹ kafka æœºåˆ¶åŠ sasrama çš„å·¥ä½œè¿‡ç¨‹ï¼Œåˆ†æä¸€ä¸‹å‡ºç°æ­¤é—®é¢˜å‡ºç°è¿‡ç¨‹ TODO: ç¿»ä»£ç ï¼ŒæŸ¥çœ‹ sarama çš„ heatbeat çš„å®ç°æ‰¾åŸå›  ","date":"2024-04-08","objectID":"/kafka-sarama-go-fetch-metadta-write-broken-pipe/:3:2","tags":[],"title":"Kafka Sarama Go Fetch Metadta Write Broken Pipe","uri":"/kafka-sarama-go-fetch-metadta-write-broken-pipe/"},{"categories":null,"content":"æ˜¯å¦å¯ä»¥ä¿®å¤ä¸€ä¸‹ TODO: å°è¯•çœ‹æ˜¯å¦æ pr ä¿®å¤æ‰è¿™ä¸ªé—®é¢˜ ","date":"2024-04-08","objectID":"/kafka-sarama-go-fetch-metadta-write-broken-pipe/:3:3","tags":[],"title":"Kafka Sarama Go Fetch Metadta Write Broken Pipe","uri":"/kafka-sarama-go-fetch-metadta-write-broken-pipe/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šæ€»ç»“æœ€è¿‘å‡ å¹´ä½¿ç”¨ k8s çš„ç»éªŒ ","date":"2024-03-16","objectID":"/k8s-in-action/:0:0","tags":["k8s","k3s"],"title":"K8s å®è·µç»éªŒ (k8s in action)","uri":"/k8s-in-action/"},{"categories":null,"content":"èƒŒæ™¯ ToB é¡¹ç›® ç¦»çº¿å®‰è£…è¿è¡Œç¯å¢ƒ å®¹å™¨åŒ– å¤šç»„ä»¶ç¼–æ’ åŸºäºè¿™ä¸ªèƒŒæ™¯ä¸‹ï¼Œå…¬å¸é€‰æ‹©ä½¿ç”¨ k8sã€‚ ","date":"2024-03-16","objectID":"/k8s-in-action/:1:0","tags":["k8s","k3s"],"title":"K8s å®è·µç»éªŒ (k8s in action)","uri":"/k8s-in-action/"},{"categories":null,"content":"rke é€‰æ‹©ä½¿ç”¨ rancher/rke è¿™ä¸ª k8s å‘è¡Œç‰ˆï¼Œdocker/ansible ç­‰ä¾èµ–ç¦»çº¿åŒ–å¤„ç†ï¼Œæ”¯æŒ ubuntu 20.04/ centos 7.9ã€‚ ","date":"2024-03-16","objectID":"/k8s-in-action/:2:0","tags":["k8s","k3s"],"title":"K8s å®è·µç»éªŒ (k8s in action)","uri":"/k8s-in-action/"},{"categories":null,"content":"åŸºäº kustomize çš„éƒ¨ç½² kustomize æä¾›äº† template free çš„ k8s manifest yaml ç”Ÿæˆå·¥å…·ï¼Œå¯ä»¥ç®€å•çš„ä¸º base/prod/staging ç­‰ä¸åŒçš„ç”Ÿäº§ç¯å¢ƒæ‰“ patch å®šåˆ¶ä¸åŒçš„ç¯å¢ƒã€‚å½“å‰ä¼šä½¿ç”¨ helm chart ç”Ÿæˆ yaml æ–‡ä»¶ä¾› helm charts ä½¿ç”¨ã€‚æ­¤æ—¶æ‰€æœ‰çš„éƒ¨ç½²ç›¸å…³æ–‡ä»¶æ˜¯åœ¨ç»Ÿä¸€çš„ä¸€ä¸ªä»“åº“ deploy ä¸­ç»´æŠ¤çš„ã€‚è¿™ç§æ¨¡å¼ä¸‹æ¯ä¸ªé¡¹ç›®éƒ½ä¼šæœ‰è‡ªå·±çš„ deploy.sh æ–‡ä»¶ï¼Œç”¨äºæŒç»­éƒ¨ç½² patch é¡¹ç›®çš„ imageã€‚å¦‚æœæŸä¸ªé¡¹ç›®çš„éƒ¨ç½²æ¨¡å¼å˜åŒ–äº†ï¼Œè¦åŒæ—¶ä¿®æ”¹ deploy è¿™ä¸ªä»“åº“ã€‚ä¸¤é¡¹ç›®è€¦åˆä¸¥é‡ã€‚ ","date":"2024-03-16","objectID":"/k8s-in-action/:3:0","tags":["k8s","k3s"],"title":"K8s å®è·µç»éªŒ (k8s in action)","uri":"/k8s-in-action/"},{"categories":null,"content":"åŸºäº helm charts ä»¥ app ä¸ºå•ä½çš„éƒ¨ç½² ä¸ºäº†è§£å†³ deploy é¡¹ç›®ä¸ app é¡¹ç›®è€¦åˆä¸¥é‡çš„é—®é¢˜ï¼Œå°†deploy ä¸­ app çš„ configmap/service/deployment ç­‰èµ„æºç§»åŠ¨åˆ° app ä»“åº“ä¸­ï¼Œæ­¤æ—¶ deploy åªéœ€è¦å¼•ç”¨ app ä»“åº“çš„ç‰ˆæœ¬å·/åˆ†æ”¯å³å¯ã€‚ ","date":"2024-03-16","objectID":"/k8s-in-action/:4:0","tags":["k8s","k3s"],"title":"K8s å®è·µç»éªŒ (k8s in action)","uri":"/k8s-in-action/"},{"categories":null,"content":"longhorn + nacos ç³»ç»Ÿæä¸ç¨³å®šæ¥æº åœ¨ç¬¬ä¸€æ¬¡ç”Ÿäº§éªŒè¯è¿‡ç¨‹ä¸­ï¼Œk8s çš„åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ä½¿ç”¨äº† longhornã€‚ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šé¢‘ç¹çš„ IO error, longhorn å®˜æ–¹ç”šè‡³åˆ—å‡ºäº†éå¸¸å¤šçš„å·²çŸ¥é—®é¢˜ã€‚åœ¨ç”Ÿäº§ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šæ¯”è¾ƒé¢‘ç¹çš„å‡ºç°æ–‡ä»¶ç³»ç»Ÿ readonly/è¯»å†™å»¶è¿Ÿè¿‡é«˜ï¼Œnacos æœåŠ¡è§„å¾‹æ€§ä¸å¯ç”¨ã€é‡å¯ nacos 5-10åˆ†é’Ÿï¼Œå¯¼è‡´ä¾èµ–æ­¤æœåŠ¡çš„å…¶ä»–æ‰€æœ‰æœåŠ¡é•¿æ—¶é—´ä¸å¯ç”¨ã€‚ç”±äº poc ä¸ºå•æœºç‰ˆæœ¬ï¼Œè€ƒè™‘ä½¿ç”¨æœ¬åœ°çš„æ–‡ä»¶ç³»ç»Ÿæ›¿æ¢åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚ ","date":"2024-03-16","objectID":"/k8s-in-action/:5:0","tags":["k8s","k3s"],"title":"K8s å®è·µç»éªŒ (k8s in action)","uri":"/k8s-in-action/"},{"categories":null,"content":"ç¬¬ä¸€æ¬¡ç”Ÿäº§ POC é˜¶æ®µä¸å¯å¤ç°å‡çº§è¿‡ç¨‹ ç”±äºäº§å“æ˜¯ ToB é¡¹ç›®ï¼Œäº§å“äº§å‡ºç‰©ä¸ºç¦»çº¿å®‰è£…åŒ…ã€‚åœ¨å®¢æˆ·ç¦»çº¿ç½‘ç»œä¸‹å®‰è£…åï¼Œä¼šé¢‘ç¹çš„æ›´æ–°æŸä¸ªæœåŠ¡çš„é•œåƒã€‚æ€¥éœ€ä¸€ä¸ªç¨³å®šå¯å¤ç°çš„å‡çº§è¿‡ç¨‹ï¼Œæ–¹ä¾¿ç°åœºç¦»çº¿å‡çº§ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æˆ‘ä»¬äº§å‡ºæ–‡å­—ç‰ˆæœ¬ã€æœ‰æ­§ä¹‰çš„å‡çº§è¿‡ç¨‹æ–‡æ¡£ã€‚ ","date":"2024-03-16","objectID":"/k8s-in-action/:6:0","tags":["k8s","k3s"],"title":"K8s å®è·µç»éªŒ (k8s in action)","uri":"/k8s-in-action/"},{"categories":null,"content":"å¤æ€ªçš„ helm upgrade ç¬¬ä¸€ç‰ˆæœ¬å‡çº§åŒ…æœ‰ä¸€ä¸ªæ¯”è¾ƒç¥å¥‡ helm å‡çº§è¿‡ç¨‹ helm show values appname1 \u003e values.yaml helm upgrade --debug --install appname1 appname1-0.0.1.tgz -f values.yaml app çš„ values ç»è¿‡é‡æ„åï¼Œå¾ˆå®¹æ˜“å‡ºç° valuesç»“æ„å˜åŒ–ï¼Œå˜åŒ–çš„åŒ–ï¼Œéœ€è¦å¦‚æ­¤äººå·¥å†™æ–°çš„å‡çº§é€»è¾‘ helm show values appname1 \u003e values.yaml migrate_appname1_patch_values.py helm upgrade --debug --install appname1 appname1-0.0.1.tgz -f values.yaml å¯¼è‡´å‡çº§ç»´æŠ¤å›°éš¾ ","date":"2024-03-16","objectID":"/k8s-in-action/:6:1","tags":["k8s","k3s"],"title":"K8s å®è·µç»éªŒ (k8s in action)","uri":"/k8s-in-action/"},{"categories":null,"content":"æ”¹è¿›åçš„ helm upgrade ä½¿ç”¨ IaC çš„æ€è·¯ï¼Œå°†æ‰€æœ‰çš„åŸºç¡€è®¾æ–½éƒ½åœ¨ä»“åº“ä¸­ç»´æŠ¤ï¼Œå°†æ‰€æœ‰ values.yaml ä¹Ÿè¦æ”¾åˆ°å‡çº§åŒ…ä¸­ï¼Œè€Œä¸æ˜¯ charts æ”¾åˆ°ä»“åº“ï¼Œvalues ä½¿ç”¨ç”Ÿäº§ä¸­çš„ helm upgrade --debug --install appname1 appname1-0.0.1.tgz -f values.yaml ä¸ºäº†ä¿è¯ values.yaml éƒ¨åˆ†å€¼éœ€è¦ä¾èµ–ç”Ÿäº§ç¯å¢ƒï¼Œvalues.yaml æ˜¯ä¸€ç§ template æ¯”å¦‚ golang çš„ templateï¼Œä½¿ç”¨æ–°çš„å·¥å…·åŸºäºå½“å‰ç”Ÿäº§ç¯å¢ƒä¸­çš„ deploy-env configmap ç”Ÿæˆ, å…¶ä»–æ‰€æœ‰éƒ¨åˆ†éƒ½æ”¾åˆ° gitlab ä¸­ç»´æŠ¤ã€‚ kubectl get cm deploy-env -o go-template --template='{{range $key, $value := .data}}export {{$key}}='\"'\"'{{$value}}'\"'\"';{{end}}' gotemplate values.yaml.tmpl \u003e values.yaml helm upgrade --debug --install appname1 appname1-0.0.1.tgz -f values.yaml æœ€ç»ˆæ‰€æœ‰çš„å‡çº§æ‰“åŒ…è¿‡ç¨‹ä¼šå˜æˆï¼š ä» gitlab ä¸­ä¸‹è½½æ‰€æœ‰çš„ charts charts + values æ¸²æŸ“å‡º k8s manifest yaml, ä»å…¶ä¸­æå–å‡º docker imgï¼Œå¹¶ä¸‹è½½ä¸‹æ¥ æœ€ç»ˆæ‰€æœ‰çš„å‡çº§è¿‡ç¨‹å˜æˆï¼š skopeo copy file docker://host/xxx éå†æ‰€æœ‰ appsï¼Œæ¸²æŸ“ values.yaml.tmpl, helm upgrade ","date":"2024-03-16","objectID":"/k8s-in-action/:6:2","tags":["k8s","k3s"],"title":"K8s å®è·µç»éªŒ (k8s in action)","uri":"/k8s-in-action/"},{"categories":null,"content":"é€‰æ‹©æ›´ç®€å•çš„æ¶æ„ï¼Œk3s æ”¹é€  rke çš„ k8s å‘è¡Œç‰ˆä¾èµ– dockerï¼Œdocker éœ€è¦è‡ªå·±å®‰è£…ã€‚å½“å‰çš„å®ç°ä¸­éœ€è¦ä½¿ç”¨å‘è¡Œç‰ˆä¸­çš„ docker ä¾èµ–æ ‘ã€‚å®¢æˆ·åœºæ™¯éœ€è¦æ”¯æŒå¾ˆå¤šä¸åŒä¸­ linux å‘è¡Œç‰ˆï¼Œé€‚é…ä¸åŒçš„å‘è¡Œç‰ˆæˆæœ¬æã€‚æ­ä¸Š k3s çš„é¡ºé£è½¦ï¼Œå•æ–‡ä»¶å¯åŠ¨å…¼å®¹ k8s çš„æœåŠ¡ï¼Œå…¶ä½™ç»„ä»¶å·²ç»å®¹å™¨åŒ–ï¼Œå®‰è£…è¿‡ç¨‹ç®€åŒ–äº†å¾ˆå¤šé€‚é… linux å‘è¡Œç‰ˆçš„è¿‡ç¨‹ã€‚ ","date":"2024-03-16","objectID":"/k8s-in-action/:7:0","tags":["k8s","k3s"],"title":"K8s å®è·µç»éªŒ (k8s in action)","uri":"/k8s-in-action/"},{"categories":null,"content":"k8s é›†ç¾¤å›å½’ é›†ç¾¤éƒ¨ç½² æ–‡ä»¶ç³»ç»Ÿé‡‡ç”¨æœ¬åœ°å­˜å‚¨ï¼Œè¦æ±‚åº”ç”¨å±‚é¢çš„å‰¯æœ¬æœºåˆ¶ä¿è¯æœåŠ¡æ•°æ®ä¸ä¸¢: rancher/local-path-provisioner ","date":"2024-03-16","objectID":"/k8s-in-action/:8:0","tags":["k8s","k3s"],"title":"K8s å®è·µç»éªŒ (k8s in action)","uri":"/k8s-in-action/"},{"categories":null,"content":"æ€»ç»“ å°é›†ç¾¤ï¼ˆ\u003c=50èŠ‚ç‚¹ï¼‰k3s çœŸçš„å¾ˆé¦™ï¼Œ80% ä¼ä¸šçš„æœåŠ¡éƒ½æ˜¯å°‘äº 50èŠ‚ç‚¹çš„ï¼ˆæœªå®é™…ç»Ÿè®¡ï¼Œå‡­å½“å‰ç®€å•çš„ä¼ä¸šé›†ç¾¤æ•°é‡ä¼°ç®—ï¼‰ åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»ŸçœŸçš„å¤ªç†æƒ³åŒ–äº†ï¼Œå½“å‰æµ‹è¯•å‘ç° longhorn å°½é‡ä¸è¦åœ¨ç”Ÿäº§ä½¿ç”¨ï¼Œé™¤éä»–çœŸçš„é€‚åˆä½ çš„åœºæ™¯ IaC åœ¨è¿ç»´åœºæ™¯ä¸ºæˆ‘ä»¬çœå»äº†å¤ªå¤šåæœŸç»´æŠ¤çš„éº»çƒ¦äº‹ï¼Œèƒ½ç”¨å°±ç”¨ï¼Œä¸èƒ½ç”¨ä¹Ÿè¦æƒ³æ–¹è®¾æ³•ä½¿ç”¨ ","date":"2024-03-16","objectID":"/k8s-in-action/:9:0","tags":["k8s","k3s"],"title":"K8s å®è·µç»éªŒ (k8s in action)","uri":"/k8s-in-action/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šä»‹ç»è¿ç§»é²²é¹ arm64 æ¶æ„çš„æ–¹æ¡ˆåŠé‡åˆ°çš„å‘ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:0:0","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"èƒŒæ™¯ä»‹ç» ","date":"2024-01-29","objectID":"/kunpeng-arm64/:1:0","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"é¡¹ç›®èƒŒæ™¯ å®¢æˆ·è¦æ±‚ arm64 æœºå™¨çš„éœ€æ±‚ã€‚ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:1:1","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"ARM64 æŒ‡ä»¤é›†ç‰¹æ€§ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:2:0","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"AMD64 åˆ° ARM64 çš„è¿ç§»ç­–ç•¥ ç”±äºå®¹å™¨åŒ–ï¼Œéœ€è¦æ”¯æŒ k8s åœ¨ arm64 ä¸‹è¿è¡Œï¼Œæ‰€æœ‰ä½¿ç”¨çš„å®¹å™¨æ”¯æŒ amd64+arm64ï¼›æœ‰æºç çš„é¡¹ç›®é‡‡ç”¨é‡æ–°æ„å»ºçš„æ–¹å¼ï¼Œæ— æºç ä¸”åªæ”¯æŒ amd64 çš„é¡¹ç›®é‡‡ç”¨ binfmt_misc æ–¹å¼è¿è¡Œï¼›æœ€ç»ˆå®Œæˆå…¨éƒ¨è¿ç§»è¿‡ç¨‹ã€‚ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:3:0","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"å‡†å¤‡å·¥ä½œ çœ‹çœ‹æˆ‘ä»¬çš„ç¡¬ä»¶ä¿¡æ¯ root@cosmos:~# cat /etc/os-release NAME=\"openEuler\" VERSION=\"22.03 (LTS-SP2)\" ID=\"openEuler\" VERSION_ID=\"22.03\" PRETTY_NAME=\"openEuler 22.03 (LTS-SP2)\" ANSI_COLOR=\"0;31\" root@cosmos:~# hostnamectl Static hostname: cosmos Icon name: computer-server Chassis: server ğŸ–³ Machine ID: 682d69e664ef4e5695cb3eaf805d7158 Boot ID: 034c84cb591145dab0cad91871dd5dd6 Operating System: Debian GNU/Linux 12 (bookworm) Kernel: Linux 6.1.62-generic Architecture: arm64 Hardware Vendor: PowerLeader Hardware Model: CT0101202306013E7A Firmware Version: 1.93 root@cosmos:~# uname -a Linux cosmos 6.1.62-generic #1 SMP Sun Nov 19 05:53:26 UTC 2023 aarch64 GNU/Linux root@cosmos:~# lscpu Architecture: aarch64 CPU op-mode(s): 64-bit Byte Order: Little Endian CPU(s): 48 On-line CPU(s) list: 0-47 Vendor ID: HiSilicon BIOS Vendor ID: HiSilicon Model name: Kunpeng-920 BIOS Model name: HUAWEI Kunpeng 920 3210 To be filled by O.E.M. CPU @ 2.6GHz BIOS CPU family: 280 Model: 0 Thread(s) per core: 1 Core(s) per socket: 24 Socket(s): 2 Stepping: 0x1 Frequency boost: disabled CPU(s) scaling MHz: 100% CPU max MHz: 2600.0000 CPU min MHz: 200.0000 BogoMIPS: 200.00 Flags: fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma dcpop asimddp asimdfhm Caches (sum of all): L1d: 3 MiB (48 instances) L1i: 3 MiB (48 instances) L2: 24 MiB (48 instances) L3: 48 MiB (2 instances) NUMA: NUMA node(s): 2 NUMA node0 CPU(s): 0-23 NUMA node1 CPU(s): 24-47 Vulnerabilities: Gather data sampling: Not affected Itlb multihit: Not affected L1tf: Not affected Mds: Not affected Meltdown: Not affected Mmio stale data: Not affected Retbleed: Not affected Spec rstack overflow: Not affected Spec store bypass: Not affected Spectre v1: Mitigation; __user pointer sanitization Spectre v2: Not affected Srbds: Not affected Tsx async abort: Not affected ","date":"2024-01-29","objectID":"/kunpeng-arm64/:4:0","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"å®‰è£…å’Œé…ç½® ARM64 ç‰ˆæœ¬çš„ Kubernetes å½“å‰ç¤¾åŒºçš„ k8s å‘è¡Œç‰ˆå·²ç»æ”¯æŒ arm64ï¼Œæ ¹æ®ç¤¾åŒºçš„æ–‡æ¡£å®‰è£…å³å¯ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:4:1","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"è¿ç§»è¿‡ç¨‹ä¸­çš„è¯­è¨€æŒ‘æˆ˜ åä¸ºæœ‰ä¸€æœ¬é²²é¹è½¯ä»¶è¿ç§»ä¸€æœ¬é€šï¼Œå¯ä»¥åç»­çœ‹ä¸€ä¸‹ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:5:0","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"Go è¯­è¨€åº”ç”¨çš„ç‰¹æ®Šæ³¨æ„äº‹é¡¹ golang ä» 1.5 å¼€å§‹æ”¯æŒ cross compile, arm çš„æ”¯æŒè¿›å±•è§è¿™é‡Œã€‚ å¯¹äºçº¯ golang ç¼–å†™çš„é¡¹ç›®ï¼Œå¯é€šè¿‡ç®€å•çš„ä¿®æ”¹ CICD é€‚é…æ„å»º arm64 æ¶æ„çš„å¯æ‰§è¡Œæ–‡ä»¶å³å¯ã€‚GOOS=linux GOARCH=arm64 go build ... å¯¹äºä½¿ç”¨äº† cgo çš„é¡¹ç›®ï¼Œåˆ™éœ€è¦ä»˜å‡ºæ›´å¤šåŠªåŠ›ã€‚ä½¿ç”¨ gcc åœ¨ go build è¿‡ç¨‹ä¸­ç¼–è¯‘çš„é¡¹ç›®ï¼Œéœ€è¦ä¿®æ”¹ç¼–è¯‘æ–¹å¼ï¼Œåš crosscompileï¼Œä¸€ä¸ªä¾‹å­æ¯”å¦‚ä½¿ç”¨äº† sqlite çš„é¡¹ç›®äº¤å‰ç¼–è¯‘ã€‚ä¸€äº›é¡¹ç›®åœ¨é¡¹ç›®ä¸­å·²ç»å°†å¤šç§æ¶æ„çš„åŠ¨æ€é“¾æ¥åº“/é™æ€é“¾æ¥åº“æ–‡ä»¶ commit åˆ°ä»“åº“ä¸­ï¼Œè¿è¡Œæ—¶ç›´æ¥ä½¿ç”¨å³å¯ï¼Œæ¯”å¦‚ confluent-kafka-goã€‚éƒ¨åˆ†ä½¿ç”¨äº† cgo é¡¹ç›®å¯èƒ½ä¸æ”¯æŒ arm64ï¼Œæ¯”å¦‚ github.com/bytedance/sonic æ˜¯ä¸æ”¯æŒ arm64 çš„ï¼Œéœ€è¦å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆï¼Œæ¯”å¦‚æ›¿æ¢æˆæ ‡å‡†åº“æˆ–è€…å…¶ä»–æ”¯æŒ arm64 çš„åº“ï¼ˆå¦‚ github.com/json-iterator/goï¼‰ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:5:1","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"Python é¡¹ç›®çš„é€‚é…å’Œä¿®æ”¹ ä¿®æ”¹ python ç‰ˆæœ¬ä¸ºæ”¯æŒ arm64 çš„ python ç‰ˆæœ¬ï¼Œpython2.7 ä»¥åŠ python 3 éƒ½æœ‰æ¯”è¾ƒå¥½çš„ arm64 æ”¯æŒ å« C æ¨¡å—æˆ–å…¨ C æ¨¡å—çš„è¿ç§»ï¼Œä¸‹è½½æ¨¡å—æºç ï¼Œå¹¶ä½¿ç”¨ -fsigned-char é€‰é¡¹é‡æ–°ç¼–è¯‘ã€‚å¦å¤– python å®˜æ–¹æä¾›äº†ä¸€ç§èƒ½å¤Ÿæ–¹ä¾¿æ„å»ºä¸åŒæ¶æ„çš„ wheel çš„åŸºç¡€è®¾æ–½ï¼ˆåŸºäº dockerï¼‰pypa/manylinux ","date":"2024-01-29","objectID":"/kunpeng-arm64/:5:2","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"Java åº”ç”¨çš„è¿ç§»è€ƒè™‘ Java ä¸åŒäºä¸€èˆ¬çš„ç¼–è¯‘è¯­è¨€æˆ–è§£é‡Šå‹è¯­è¨€ã€‚å®ƒé¦–å…ˆå°†æºä»£ç ç¼–è¯‘æˆå­—èŠ‚ç ï¼Œå†ä¾èµ–å„ç§ä¸åŒå¹³å°ä¸Šçš„è™šæ‹Ÿæœºæ¥è§£é‡Šæ‰§è¡Œå­—èŠ‚ç ï¼Œä»è€Œå…·æœ‰â€œä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œâ€çš„è·¨å¹³å°ç‰¹æ€§ã€‚ä½†æ˜¯ java æ”¯æŒçš„ JNI å¯ä»¥åœ¨ java ä¸­è°ƒç”¨ c/c++ ç­‰å…¶ä»–è¯­è¨€ç¼–å†™çš„åŠ¨æ€é“¾æ¥åº“ï¼Œè¿™ç§æœ¬åœ°ç¨‹åºæ˜¯ä¸è·¨å¹³å°çš„ï¼Œå¯¼è‡´ä¸èƒ½ç›´æ¥é‡‡ç”¨æ›´æ¢ arm64 jre ä¸ä¿®æ”¹ç¨‹åºçš„æ–¹å¼åšè¿ç§»ã€‚ æ›´æ¢ arm64 æ¶æ„çš„ JRE å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯¹äºçº¯ Java çš„ç¨‹åºï¼Œå¯ä»¥è€ƒè™‘ç›´æ¥æ›´æ¢ ARM64 çš„ JRE æ¥è¿è¡ŒæœåŠ¡ã€‚å¦‚æœç¬¬ä¸‰æ–¹åº“æ˜¯ç”¨åˆ°äº† jni è°ƒç”¨æœ¬åœ°æ–¹æ³•ï¼Œå°±éœ€è¦å¯¹è¿™ä¸ªåº“é€‚é… arm64 jni å¦‚æœæ˜¯å¼€æºè½¯ä»¶ï¼Œç›´æ¥åŸºäºä»£ç åš arm64 é€‚é…ï¼Œå¦‚æœä¸ºéå¼€æºé¡¹ç›®ï¼Œåˆ™éœ€è¦å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆã€æˆ–å¯»æ±‚å•†ä¸šæ”¯æŒ è®¾ç½® JVM å‚æ•°è§£å†³ç¨‹åºè¿è¡Œæ˜¯æ”¹åŠ¨ç‚¹ ä¸‰å¤§ç»éªŒï¼šé¦–å…ˆï¼Œå®Œæˆä¸€æ¬¡ Full GC åï¼Œåº”è¯¥é‡Šæ”¾å‡º 70% çš„å †ç©ºé—´ï¼ˆ30% çš„ç©ºé—´ä»ç„¶å ç”¨ï¼‰ã€‚å…¶æ¬¡ï¼Œå‡è®¾è€å¹´ä»£å­˜æ´»å¯¹è±¡ (å³ Full GC åè€å¹´ä»£å†…å­˜å ç”¨) å¤§å°ä¸º Xï¼Œå»ºè®®å †çš„æ€»å¤§å°æ˜¯ X çš„ä¸‰åˆ°å››å€ï¼Œå¹´è½»ä»£çš„å¤§å°æ˜¯ X çš„ 1 åˆ° 1.5 å€ï¼Œè€å¹´ä»£çš„å¤§å°æ˜¯ X çš„ä¸¤åˆ°ä¸‰å€ï¼Œæ°¸ä¹…ä»£çš„å¤§å°æ˜¯ X çš„ 1.2 åˆ° 1.5 å€ã€‚ç¬¬ä¸‰ï¼ŒJDK å®˜æ–¹çš„å»ºè®®æ˜¯å¹´è½»ä»£å¤§å°å æ•´ä¸ªå †ç©ºé—´å¤§å°çš„ 3/8 å·¦å³ã€‚ åœ¨å…·ä½“çš„é¡¹ç›®è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰å¦‚ä¸‹å·®å¼‚ï¼š çº¿ç¨‹å¤§å°çš„ Xss å‚æ•°åœ¨ ARM ä¸Šé»˜è®¤å€¼æ˜¯ 2mï¼Œåœ¨ x86 ä¸º 1mã€‚å› æ­¤å¦‚æœçº¿ç¨‹å¼€çš„å¤ªå¤šï¼Œå°±éœ€è¦è°ƒæ•´ Xss å‚æ•°å¤§å°ï¼Œé˜²æ­¢å‡ºç°è€—æ—¶ã€‚ ç”±äº ARM å’Œ x86 æŒ‡ä»¤é›†çš„å·®å¼‚æ€§ï¼Œå¯¼è‡´ JDK çš„ JIT ç¼–è¯‘å­˜åœ¨å·®å¼‚ã€‚å¯ä»¥é€šè¿‡è®¾ç½®å‚æ•° ReservedCodeCacheSizeï¼Œè°ƒæ•´ CodeCache å¤§å°ã€‚ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:5:3","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"C/C++ ç­‰ç¼–è¯‘å‹è¯­è¨€å¦‚ä½•è¿ç§» ä¸è¿‡ï¼ŒC/C++ ä»£ç åœ¨è¿ç§»ä¸­ä¹Ÿä¼šæœ‰è¯¸å¤šé—®é¢˜å­˜åœ¨ï¼Œæœ€å…·ä»£è¡¨æ€§çš„äº”ç±»è¿ç§»é—®é¢˜å¦‚ä¸‹ï¼š 1ã€ç¼–è¯‘è„šæœ¬å’Œç¼–è¯‘é€‰é¡¹çš„ç§»æ¤ã€‚ä¸åŒçš„æ¶æ„å¹³å°ä¼šæœ‰ç‹¬ç‰¹çš„ç¼–è¯‘é€‰é¡¹æ”¯æŒç¡¬ä»¶ç‰¹æ€§ï¼Œä¸å½“å‰ç¼–è¯‘å¹³å°å±æ€§å¼ºç›¸å…³è¿™ç§å¸¦æœ‰æ¶æ„å±æ€§çš„ç¼–è¯‘é€‰é¡¹éœ€è¦è¿›è¡Œç§»æ¤ï¼Œè¿™äº›ç¼–è¯‘é€‰é¡¹ä¸€èˆ¬ä»¥â€“m å¼€å¤´ï¼› 2ã€ç¼–è¯‘å®çš„ç§»æ¤ã€‚ç¼–è¯‘å®çš„ä½œç”¨æ˜¯ç¡®å®šå¹³å°ä¸‹éœ€è¦æ‰§è¡Œå“ªä¸ªåˆ†æ”¯ä»£ç ï¼Œä¸€èˆ¬åˆ†ä¸º x86 è‡ªå®šä¹‰å®å’Œç”¨æˆ·è‡ªå®šä¹‰çš„å®ã€‚ä¸¤ç±»å®çš„ç¼–è¯‘ç§»æ¤æ–¹å¼å„ä¸ç›¸åŒï¼› 3ã€builtin å‡½æ•°é—®é¢˜ã€‚builtin å‡½æ•°æ˜¯ç¼–è¯‘å™¨è‡ªå®šä¹‰çš„å‡½æ•°ï¼Œæœ‰è¾ƒå¥½çš„æ€§èƒ½ï¼Œå¯ä»¥å®ç°ä¸€äº›ç®€å•å¿«æ·çš„åŠŸèƒ½ï¼Œæ ¹æ®ç›¸åº”éœ€æ±‚è¿›è¡Œä½¿ç”¨ä¼˜åŒ–ï¼ŒåŠ©åŠ›ç¨‹åºç¼–å†™ï¼› 4ã€å†…è”æ±‡ç¼–ç§»æ¤ï¼Œå¸¸ç”¨è¿ç§»æ–¹æ³•æœ‰æ±‡ç¼–æŒ‡ä»¤æ–¹å¼æ›¿æ¢ä»¥åŠ builtin å‡½æ•°æ›¿æ¢ä¸¤ç§ï¼› 5ã€SSE intrinsic å‡½æ•°ç§»æ¤ã€‚ä¸€èˆ¬åœ¨å¤šåª’ä½“æŠ€æœ¯å¼€å‘ä»¥åŠæ•°å­¦çŸ©é˜µåº“ä¸­åº”ç”¨è¾ƒå¤šçš„ SSE intrinsic å‡½æ•°ç§»æ¤è¾ƒä¸ºå¤æ‚ï¼Œä¸ºé‡éš¾ç‚¹ã€‚æ¯”å¦‚ clickhouse ä¸­ä½¿ç”¨åˆ°äº† SIMD æŒ‡ä»¤ï¼Œéœ€è¦æ›¿æ¢æˆ arm64 ä¸‹å¯¹åº”çš„ä½¿ç”¨æ–¹å¼ï¼Œå¹¶ä¸”å› ä¸ºé²²é¹å·²ç»æ˜¯æ¯”è¾ƒæ—§çš„æŒ‡ä»¤é›†äº†ï¼Œå¯¹äºä¸€äº›æ–°çš„æŒ‡ä»¤ä¸æ”¯æŒå¯¼è‡´ clickhouse æŠ¥é”™éæ³•æŒ‡ä»¤é›†ï¼Œéœ€è¦åˆ é™¤æ–°çš„æŒ‡ä»¤é›†ç‰¹æ€§é‡æ–°ç¼–è¯‘ï¼Œæˆ–è€…é™çº§ clickhouse ç‰ˆæœ¬åˆ°æœªä½¿ç”¨æ–°æŒ‡ä»¤çº§ç‰¹æ€§çš„ç‰ˆæœ¬ã€‚ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:5:4","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"éå¼€æºé¡¹ç›®çš„è¿ç§»æŒ‘æˆ˜ å¯¹äºéå¼€æºå•†ä¸šé¡¹ç›®ï¼Œå¯ä»¥ç›´æ¥æ‰¾å•†ä¸šå…¬å¸å¯»æ±‚æ”¯æŒã€‚ä½†æ˜¯å¯¹äºéƒ¨åˆ†éå¼€æºå•†ä¸šé¡¹ç›®ï¼Œå·²ç»è¿‡äº†ç»´æŠ¤æœŸï¼Œå°±éœ€è¦æˆ‘ä»¬è‡ªå·±æƒ³åŠæ³•è¿ç§»äº†ã€‚ æ¯”è¾ƒæ˜¾è€Œæ˜“è§çš„æ–¹å¼æ˜¯ä½¿ç”¨ qemu åœ¨ arm64 ä¸Šç›´æ¥æ‰§è¡Œ amd64 çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œç¨‹åºã€‚æ”¯æŒçš„åŸç†å¯ä»¥ç®€å•ç†è§£ä¸ºï¼Œlinux æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œä½¿å†…æ ¸èƒ½å¤Ÿå°†ä¸æ”¯æŒçš„ bin æ ¼å¼è½¬äº¤ç»™è™šæ‹Ÿæœº/è½¬æ¢ç¨‹åºæ‰§è¡Œï¼Œè¯¦ç»†è§ binfmt_misc, æ³¨æ„æ­¤ä¸­æ–¹æ³•åœ¨éƒ¨åˆ†åº”ç”¨ä¸‹æ˜¯å¯ç”¨çš„ï¼Œæ¯”å¦‚ golang çš„äºŒè¿›åˆ¶ç¨‹åºã€éƒ¨åˆ† c ç¨‹åºï¼Œå¯¹äºåƒ redisã€java ç­‰ç¨‹åºï¼Œä¼šæœ‰ segment fault æˆ–è€…å¡ä½ä¸å¯ç”¨çš„æƒ…å†µï¼Œéœ€è¦äº²è‡ªæµ‹è¯•ç¡®è®¤ä¸€ä¸‹åº”ç”¨æ˜¯å¦å¯ç”¨ã€‚ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:6:0","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"ä½¿ç”¨ Docker æ„å»ºæ”¯æŒå¤šæ¶æ„çš„é•œåƒ æœŸæœ›è¦ç»™é•œåƒæ”¯æŒå¤šä¸ªæ¶æ„ï¼Œè¿™æ ·ç”±å®¢æˆ·ç«¯å†³å®šæ‹‰å–å“ªä¸€ç§æ¶æ„çš„é•œåƒã€‚ æ ¹æ® docker å®˜æ–¹çš„æ–‡æ¡£æè¿°ï¼Œä½¿ç”¨ docker æ„å»ºå¤šæ¶æ„ docker image ä¸€èˆ¬æœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼ï¼š ä½¿ç”¨å†…æ ¸æ”¯æŒçš„ QEMU emulation åˆ›å»ºä¸€ä¸ª builderï¼Œåç«¯ä¸ºå¤šä¸ªä¸åŒæ¶æ„çš„ç‰©ç†æœº ä½¿ç”¨ cross-compile åœ¨æœ¬åœ°æ¶æ„æ„å»ºä¸åŒæ¶æ„çš„å¯æ‰§è¡Œç¨‹åº ä¸åŒçš„æ–¹å¼çš„ä½¿ç”¨æ¡ä»¶ä¸åŒï¼Œæˆ‘ä»¬é€ä¸ªåˆ†æã€‚ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:7:0","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"ä½¿ç”¨å†…æ ¸æ”¯æŒçš„ QEMU emulation ä½¿ç”¨å†…æ ¸æ”¯æŒçš„ qemu emulationï¼Œå¯ä»¥ åœ¨æœ¬åœ°ä½¿ç”¨ qemu å¯åŠ¨ä¸åŒçš„æ¶æ„çš„ç±»ä¼¼ vm çš„è¿›ç¨‹ï¼Œåœ¨å¯¹åº”æ¶æ„ä¸Šæ‰§è¡Œä»£ç ã€‚ç”±äºæ˜¯åŸºäº qemu emulationï¼Œæ€§èƒ½ä¼šæ¯”è¾ƒä½ï¼Œå¯¹äºä¸€äº› cpu å¯†é›†å‹çš„ä»»åŠ¡æ¯”å¦‚ç¼–è¯‘ã€å‹ç¼©ã€è§£å‹é€Ÿåº¦ä¼šæœ‰å¾ˆå¤§çš„å½±å“ã€‚ # æ³¨å†Œå¤šæ¶æ„æ”¯æŒ docker run --privileged --rm tonistiigi/binfmt --install all # æŸ¥çœ‹æ˜¯å¦æ³¨å†ŒæˆåŠŸ, enabled ä¸ºæ³¨å†Œçš„æ¶æ„ cat /proc/sys/fs/binfmt_misc/qemu-* enabled interpreter /usr/bin/qemu-x86_64 flags: POCF offset 0 magic 7f454c4602010100000000000000000002003e00 mask fffffffffffefe00fffffffffffffffffeffffff é»˜è®¤çš„ docker driver æ˜¯ä¸æ”¯æŒå¤šæ¶æ„æ„å»ºçš„ï¼Œéœ€è¦ä½¿ç”¨å¦‚ä¸‹æ–¹å¼åˆ›å»ºä¸€ä¸ªæ–°çš„ builderã€‚ docker buildx create --name mybuilder --bootstrap --use docker buildx build --platform=linux/amd64,linux/arm64 -f Dockerfile -t dev:tmp . åœ¨ç¼–è¯‘ arm java ç¨‹åºæ—¶å€™ï¼Œå¯èƒ½ä¼šé‡åˆ° hang çš„æƒ…å†µï¼Œè¿™ç§æ–¹æ³•éœ€è¦å®é™…è¯•éªŒä¸€ä¸‹çœ‹æ˜¯å¦å¯è¡Œã€‚ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:7:1","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"åˆ›å»ºä¸€ä¸ª builderï¼Œåç«¯ä¸ºå¤šä¸ªä¸åŒæ¶æ„çš„ç‰©ç†æœº æ­¤ç§æ–¹å¼é¦–å…ˆéœ€è¦å¤šå°ä¸åŒç§æ¶æ„çš„ç¡¬ä»¶æœºå™¨ã€‚æ„å»ºè¿‡ç¨‹ä¼šåœ¨å¯¹åº”æ¶æ„æœºå™¨ä¸­æ‰§è¡Œï¼Œæ¯”å¦‚ arm64 ä¼šåœ¨ arm64 çš„æœºå™¨ä¸­æ‰§è¡Œï¼Œamd64 ä¼šåœ¨ amd64 çš„æœºå™¨ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥æœ‰æ›´å¥½çš„æ€§èƒ½ã€æ›´åŸç”Ÿçš„ä½“éªŒï¼Œæ”¯æŒçš„åœºæ™¯æ›´å¤šä¸€äº›ã€‚ ä½¿ç”¨å¦‚ä¸‹æ–¹å¼åœ¨æœ¬åœ°æ„å»ºä¸€ä¸ªæ”¯æŒ amd64 å’Œ arm64 çš„ buildkit: EXTRA_BUILDKIT_ADDRESS=1.1.1.1 docker buildx create --use --name buildkit --driver=docker-container --driver-opt=image=buildkit:buildx-stable-1 docker buildx create --use --name buildkit --append ${EXTRA_BUILDKIT_ADDRESS} --platform linux/arm64 --driver=docker-container --driver-opt=image=buildkit:buildx-stable-1 ","date":"2024-01-29","objectID":"/kunpeng-arm64/:7:2","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"ä½¿ç”¨ cross-compile åœ¨æœ¬åœ°æ¶æ„æ„å»ºä¸åŒæ¶æ„çš„å¯æ‰§è¡Œç¨‹åº å¦‚æœç¼–ç¨‹è¯­è¨€æ”¯æŒ cross-compilationï¼Œåœ¨ä¸åŒçš„æ¶æ„æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æŒ‡å®šæŸä¸ª stage åœ¨å½“å‰æœºå™¨æ¶æ„ä¸­æ„å»ºè·¨æ¶æ„çš„äºŒè¿›åˆ¶ç¨‹åºï¼Œåå¤åˆ¶åˆ°è¿è¡Œæ—¶ stage ä¸­ã€‚ å®˜æ–¹æ–‡æ¡£è§è¿™é‡Œ å¦‚ä¸‹ä¸ºä¸€ä¸ªä¾‹å­ï¼š # syntax=docker/dockerfile:1 FROM --platform=$BUILDPLATFORM golang:1.17-alpine AS build WORKDIR /src COPY . . ARG TARGETOS TARGETARCH RUN GOOS=$TARGETOS GOARCH=$TARGETARCH go build -o /out/myapp . FROM alpine COPY --from=build /out/myapp /bin docker buildx build --platform=linux/amd64,linux/arm64 . ","date":"2024-01-29","objectID":"/kunpeng-arm64/:7:3","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"æ€§èƒ½ä¼˜åŒ–å’Œè°ƒæ•´ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:8:0","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"æ•…éšœæ’é™¤ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:9:0","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"clickhouse Illegal instruction (core dumped) åŸå› å¯ä»¥è¿½æº¯ä¸Šæ¸¸ issue ä¸Šæ¸¸çš„é•œåƒæ„å»ºå¯èƒ½åœ¨è¾ƒæ–°çš„æœºå™¨ä¸­ç¼–è¯‘ï¼Œæ–°æœºå™¨å¯èƒ½æ”¯æŒæ›´å¤šçš„ç‰¹æ€§ï¼Œè€Œ kunpeng ARMv8.2 çš„æŒ‡ä»¤é›†æ— æ­¤ç‰¹æ€§å¯¼è‡´ä¸èƒ½è¿è¡Œã€‚ å¯ä»¥åˆ‡æ¢åˆ°ç‰ˆæœ¬ clickhouse/clickhouse-server:23.3.9.55 æˆ–è€… bitnami/clickhouse:23.3.9-debian-11-r0ï¼Œ2024.03.05 æµ‹è¯•å¯ç”¨ã€‚ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:9:1","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"k3s-root binaries cause segmentation fault on aarch64 nodes with 64k page size issue getconf PAGESIZE /var/lib/rancher/k3s/data/current/bin/mv Segmentation fault cento8 pagesize 64k, centos9 revert, donot use centos8 like os OS é¡µè¡¨é€‰æ‹© VA/PA BITS NR_CPUS NODES_SHIFTï¼ˆNODES) RHEL/CentOS 7 Series 64K 48 4096 2 (4) RHEL/CentOS 8 Series 64K 48/52 4096 3 (8) RHEL/CentOS 9 Series 4K 48 4096 6 (64) SLE12-SP1-ARM 64K 42 128 2 (4) SLE12-SP2 4K 48 128 2 (4) SLE12-SP3/SP4 4K 48 256 2 (4) SLE15-SP1 4K 48 480 2 (4) SLE15-SP2/SP3/SP4 4K 48 768 6 (64) SLE15-SP4 (64K) 64K 52 768 6 (64) ubuntu 20.04 4K uos 1040d 64K kylinv10sp3 64K openEuler 20.03 64K openEuler 22.03 4K dockerhub ä¸­é•œåƒå‡ ä¹éƒ½ä¸ºåœ¨ 4k pagesize ä¸­ç¼–è¯‘çš„ï¼›å½“å‰ CI arm64 CI pagesize ä¸º 4kï¼›é•¿æœŸçœ‹æ–°çš„æ“ä½œç³»ç»Ÿå‡ ä¹éƒ½ä¸º 4kï¼Œå†³å®šå…¨æ ˆ 4kï¼Œä¸æ”¯æŒçš„æ“ä½œç³»ç»Ÿé€šè¿‡é‡æ–°ç¼–è¯‘ 4k çš„ linux å†…æ ¸æ”¯æŒã€‚ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:9:2","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"redis Unsupported system page size [root@cosmos ~]# kubectl logs -f shared-redis-node-0 -c redis \u003cjemalloc\u003e: Unsupported system page size Could not connect to Redis at shared-redis.default.svc.cluster.local:26379: Connection refused 08:13:17.49 INFO ==\u003e Configuring the node as master \u003cjemalloc\u003e: Unsupported system page size \u003cjemalloc\u003e: Unsupported system page size å‡ºè¿™ä¸ªé”™è¯¯çš„åŸå› æ˜¯å› ä¸º jemalloc æ˜¯åœ¨ç¼–è¯‘æ—¶ç¡®å®š pagesize çš„å¤§å°ï¼›åœ¨ pagesize 4k çš„ç¯å¢ƒä¸­ç¼–è¯‘æ”¾åˆ° 64k ç¯å¢ƒä¸­è¿è¡Œï¼Œå³ä¼šæŠ¥é”™ã€‚è¯¦ç»†ä¿¡æ¯å¯ä»¥çœ‹ è¿™é‡Œã€‚åŸºäºå½“å‰é‡åˆ°çš„é—®é¢˜ï¼Œå†³å®šé‡æ–°ç¼–è¯‘å†…æ ¸ï¼Œæ”¹æˆ 4k çš„ç¯å¢ƒã€‚ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:9:3","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"WARNING Your kernel has a bug that could lead to data corruption during background save. Please upgrade to the latest stable kernel ç¼–è¯‘å†…æ ¸ åˆ°4.19.90 å‡ºç°æ–°çš„é—®é¢˜ï¼Œéœ€è¦åœ¨ redis common é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  ignore-warnings ARM64-COW-BUG 1:M 28 Feb 2024 08:47:04.347 * Running mode=standalone, port=6379. 1:M 28 Feb 2024 08:47:04.347 # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128. 1:M 28 Feb 2024 08:47:04.347 # Server initialized 1:M 28 Feb 2024 08:47:04.348 # WARNING Your kernel has a bug that could lead to data corruption during background save. Please upgrade to the latest stable kernel. 1:M 28 Feb 2024 08:47:04.348 # Redis will now exit to prevent data corruption. Note that it is possible to suppress this warning by setting the following config: ignore-warnings ARM64-COW-BUG è¿™æ˜¯ä¸€ä¸ªå†…æ ¸ bugï¼š ref: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=977615 # Fixed in versions linux/5.9.15-1, linux/5.10~rc6-1~exp1, linux/5.10~rc7-1~exp1, linux/4.19.171-1 æ¢äº†æ–°çš„å†…æ ¸ 4.19.x ä¿®å¤ã€‚ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:9:4","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"chrome/chromium Trace/breakpoint trap (core dumped) é”™è¯¯åŸå› åŒæ ·æ˜¯å› ä¸º pagesizeï¼Œchromium ç¤¾åŒºå¯¹ pagesize 64k çš„æ”¯æŒä¸æ„Ÿå…´è¶£ï¼Œå¹¶ä¸” chromium å½“å‰ç”±äºSlotSpanMetadata è¿˜ä¸æ”¯æŒ 64kï¼Œå¯¼è‡´ chrome/chromium æ˜¯ä¸æ”¯æŒ 64k pagesize çš„ï¼Œå¦‚æœæƒ³åœ¨ arm64 ä¸‹è¿è¡Œï¼Œpagesize è¦æ±‚ 4kã€‚åŒæ ·çš„ï¼Œè¿˜æœ‰ä¸€äº›ç±»ä¼¼çš„ issueï¼š [https://github.com/electron/electron/issues/25387](Electron segmentation fault on CentOS7 aarch64(arm64)) browserless When the kernel PAGESIZE is 64k ","date":"2024-01-29","objectID":"/kunpeng-arm64/:9:5","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"postgres åœ¨ pagesize 64k ä¸‹çš„ sql æŸ¥è¯¢ä¼šæ¯” 4k ä¸‹æ…¢å‡ ä¸ªæ•°é‡çº§ å…·ä½“å¯ä»¥çœ‹è¿™é‡Œï¼Œæ­¤æ–‡ä¸­è¯´åŒä¸€ä¸ª sql/åŒæ•°æ®é‡ä¸‹, pg åœ¨ 64k çš„æ‰§è¡Œæ—¶é—´æ˜¯ 4k ä¸‹çš„ 80+ å€ã€‚ ","date":"2024-01-29","objectID":"/kunpeng-arm64/:9:6","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"hadoop ç‰ˆæœ¬ 3.1.1 ä¸æ”¯æŒ arm64ï¼Œéœ€è¦é‡æ–°æºç ç¼–è¯‘ TODO: ","date":"2024-01-29","objectID":"/kunpeng-arm64/:9:7","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"å­¦åˆ°çš„ç»éªŒå’Œæ•™è®­ linux kernel pagesize å°½é‡é€‰æ‹© 4kï¼Œé—®é¢˜ä¼šå°‘å¾ˆå¤š å–„ç”¨ docker multiarch build ","date":"2024-01-29","objectID":"/kunpeng-arm64/:10:0","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"Q\u0026A å’Œè®¨è®º ","date":"2024-01-29","objectID":"/kunpeng-arm64/:11:0","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"å‚è€ƒ é²²é¹è½¯ä»¶è¿ç§» ppt é²²é¹æ€§èƒ½ä¼˜åŒ–åæ¿æ–§ 5.0 ","date":"2024-01-29","objectID":"/kunpeng-arm64/:12:0","tags":["ops","linux","arm64","docker",""],"title":"é²²é¹ 920 arm64 æœºå™¨é€‚é…ç»éªŒ","uri":"/kunpeng-arm64/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šbitnami/postgres-ha ä½¿ç”¨ pg_upgrade å…¨è‡ªåŠ¨å¤§ç‰ˆæœ¬å‡çº§ ä» 14 åˆ° 15 ","date":"2023-12-04","objectID":"/postgres-upgrade-bitnami-ha/:0:0","tags":["db","postgres","bitnami","bitnami/postgres-ha","pg_upgrade"],"title":"åœ¨ k8s å®é™…ç”Ÿäº§ä¸­ bitnami/postgres-ha çš„ä¸€æ¬¡ 14 å‡çº§ 15 ç»éªŒåŠè¿‡ç¨‹","uri":"/postgres-upgrade-bitnami-ha/"},{"categories":null,"content":"Infrastructural notes ","date":"2023-12-04","objectID":"/postgres-upgrade-bitnami-ha/:1:0","tags":["db","postgres","bitnami","bitnami/postgres-ha","pg_upgrade"],"title":"åœ¨ k8s å®é™…ç”Ÿäº§ä¸­ bitnami/postgres-ha çš„ä¸€æ¬¡ 14 å‡çº§ 15 ç»éªŒåŠè¿‡ç¨‹","uri":"/postgres-upgrade-bitnami-ha/"},{"categories":null,"content":"Reasons to upgrade å¼€å§‹æˆ‘æ‰€åœ¨äº§å“è®¡åˆ’åšåŸºäº k8s çš„é›†ç¾¤ç‰ˆï¼Œpostgres éœ€è¦ä¸€ä¸ªå¯é çš„å¯ä»¥è‡ªåŠ¨ä¸»ä»åˆ‡æ¢çš„ HA æ–¹æ¡ˆã€‚æœ¬ç€ä¸é‡æ–°é€ è½®å­çš„åŸåˆ™ï¼Œé€‰æ‹©äº† bitnami/postgres-ha çš„æ–¹æ¡ˆã€‚è°ƒç ”æ—¶å‘ç°å¼€äº† witness/pg_rewind åï¼Œpg åå¤é‡å¯ã€‚ä¸ºæ­¤æŠŠ witness/pg_rewind å…³äº†åä¸Šäº†ç”Ÿäº§ã€‚åç»­ç”±äºæˆ‘ä»¬ç™¾ G å­˜å‚¨çš„ pg æµ‹è¯•é›†ç¾¤å¶å‘äº†ä¸€æ¬¡ä¸¢æ‰€æœ‰çš„æ•°æ®ï¼Œè°ƒæŸ¥åå†³å®šå¼€å¯ pg_rewind é˜²æ­¢ä¸¢æ•°æ®ã€‚è°ƒç ”ä¸­å‘ç°æœ€æ–°çš„ bitnami/postgres-ha åŸºäº postgres 15, pg 14 å¼€å¯åä¸å·¥ä½œï¼Œpostgres 15 å·²ç»ç»è¿‡ä¸€æ®µæ—¶é—´çš„ç”Ÿäº§ç¯å¢ƒéªŒè¯ï¼Œå†³å®šå°è¯• pg14 å‡çº§ 15ã€‚ å½“å‰å®˜æ–¹æä¾›çš„å‡çº§æ–¹æ¡ˆåŒ…æ‹¬: Dump \u0026 restore: æœ€ç®€å•ä¹Ÿæ˜¯æœ€è€—æ—¶çš„æ–¹æ³•ã€‚å°†é¢ä¸´æ›´é•¿çš„åœæœºæ—¶é—´ï¼Œæˆ‘ä»¬ä¸€ä¸ªæµ‹è¯•ç¯å¢ƒé‡‡ç”¨ä¸è½ç›˜æ–¹æ¡ˆï¼Œ30G æ•°æ®å¤§çº¦èŠ±è´¹äº† 30 åˆ†é’Ÿï¼Œåœ¨æ›´å¤§çš„æ•°æ®åº“æˆ–ä¸åŒçš„ç¡¬ä»¶é…ç½®å¯èƒ½ä¼šæœ‰ä¸åŒçš„æ‰§è¡Œæ—¶é—´; Logical replication: åœæœºæ—¶é—´æœ€çŸ­çš„æ–¹å¼(æ‰€æœ‰æ•°æ®åº“å®ä¾‹æ•°æ®åŒæ­¥å®Œæˆååˆ‡æ¢æ—§é›†ç¾¤åˆ°æ–°é›†ç¾¤è¿™æ®µæ—¶é—´ä¼šæœ‰çŸ­æš‚ç§’çº§æœåŠ¡ä¸å¯ç”¨)ã€‚ä» pg10 å¼€å§‹å°±å†…ç½®äº†é€»è¾‘å¤åˆ¶ã€‚ PostgreSQL official upgrade tool: pg_upgrade å®˜æ–¹ç»´æŠ¤äº†ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·, ç”¨äºæ­¤åœºæ™¯. æˆ‘æ‰€é¢ä¸´çš„åœºæ™¯è¦æ±‚åŸåœ°å‡çº§ï¼Œä¸æ¥å—ä½¿ç”¨ä¸€ä¸ªæ–°çš„ bitnami/postgres-ha é›†ç¾¤æ›¿æ¢æ–°çš„é›†ç¾¤ï¼Œå…è®¸æ¯”è¾ƒçŸ­çš„ç»´æŠ¤æ—¶é—´çª—å£ï¼ˆå¯åœæœï¼‰ï¼Œæ•…é‡‡ç”¨æ–¹æ¡ˆ 3ï¼š PostgreSQL official upgrade tool pg_upgradeã€‚å¦‚æœå¯¹åœæœºæ—¶é—´æœ‰ä¸¥æ ¼è¦æ±‚çš„ï¼Œè¿˜æ˜¯å»ºè®®é‡‡ç”¨æ–¹æ¡ˆ 2 Logical replicationã€‚ å› ä¸ºæˆ‘ä»¬çš„åœºæ™¯å±äºå®¹å™¨åŒ–åœºæ™¯ï¼Œåœ¨ä¸€ä¸ª k8s é›†ç¾¤ä¸­éƒ¨ç½²äº†æˆ‘ä»¬æ‰€æœ‰çš„æ•°æ®åº“æœåŠ¡åŠä¸šåŠ¡æœåŠ¡ï¼Œæˆ‘ä»¬å…ˆåœ¨ docker ç¯å¢ƒä¸‹ç†Ÿæ‚‰ä¸€ä¸‹ pg_upgrade çš„æ“ä½œã€‚ ","date":"2023-12-04","objectID":"/postgres-upgrade-bitnami-ha/:1:1","tags":["db","postgres","bitnami","bitnami/postgres-ha","pg_upgrade"],"title":"åœ¨ k8s å®é™…ç”Ÿäº§ä¸­ bitnami/postgres-ha çš„ä¸€æ¬¡ 14 å‡çº§ 15 ç»éªŒåŠè¿‡ç¨‹","uri":"/postgres-upgrade-bitnami-ha/"},{"categories":null,"content":"åŸºäº docker çš„ postgres å‡çº§è¿‡ç¨‹æ¢ç´¢ è°ƒç ”è¿‡ç¨‹ä¸­çœ‹åˆ°å®¹å™¨åœºæ™¯æ¯”è¾ƒç†æƒ³çš„è¿ç§»æ–¹æ¡ˆ blog Terabyte-scale PostgreSQL upgrade from 9.6 to 14 ï¼Œå…¶ä¸­ä¸ºä»–ä»¬çš„åœºæ™¯è‡ªåˆ¶äº†ä¸€ä¸ªç”¨äºå‡çº§çš„ docker imageï¼Œæ­¤é¡¹ç›®ä¸­å¯¹è‡ªå·±çš„ä»‹ç» This is a PoC for using pg_upgrade inside Docker -- learn from it, adapt it for your needs; don't expect it to work as-is!ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨æ­¤æ–¹æ³•å¤ç°ä¸€ä¸‹å¤§ç‰ˆæœ¬å‡çº§è¿‡ç¨‹ã€‚ ","date":"2023-12-04","objectID":"/postgres-upgrade-bitnami-ha/:2:0","tags":["db","postgres","bitnami","bitnami/postgres-ha","pg_upgrade"],"title":"åœ¨ k8s å®é™…ç”Ÿäº§ä¸­ bitnami/postgres-ha çš„ä¸€æ¬¡ 14 å‡çº§ 15 ç»éªŒåŠè¿‡ç¨‹","uri":"/postgres-upgrade-bitnami-ha/"},{"categories":null,"content":"å‡çº§è¿‡ç¨‹ åœ¨æ­¤è¿‡ç¨‹ä¸­æˆ‘ä»¬ä¼šå…ˆå¯åŠ¨ä¸€ä¸ª postgres14, ç„¶åä½¿ç”¨ tianon/postgres-upgrade:14-to-15 ä» 14 å‡çº§åˆ° 15. ç„¶åå¯åŠ¨ pg15 éªŒè¯æ˜¯å¦å‡çº§æˆåŠŸã€‚ å…ˆçœ‹ä¸€ä¸‹ docker-compose.yaml æ–‡ä»¶ version: \"3\" services: db14: image: postgres:14-bookworm container_name: db14 environment: POSTGRES_USER: postgres POSTGRES_PASSWORD: test POSTGRES_DB: test PGDATA: /var/lib/postgresql/all/db14 volumes: - ./data/:/var/lib/postgresql/all ports: - 5432:5432 db15: image: postgres:15-bookworm container_name: db15 environment: POSTGRES_USER: postgres POSTGRES_PASSWORD: test POSTGRES_DB: test PGDATA: /var/lib/postgresql/all/db15 volumes: - ./data/:/var/lib/postgresql/all ports: - 5433:5432 upgrade: image: tianon/postgres-upgrade:14-to-15 container_name: upgrade environment: PGDATAOLD: /var/lib/postgresql/all/db14 PGDATANEW: /var/lib/postgresql/all/db15 POSTGRES_USER: test POSTGRES_PASSWORD: password command: [\"tail\", \"-f\", \"/dev/null\"] volumes: - ./data/:/var/lib/postgresql/all é¦–å…ˆæˆ‘ä»¬æŠŠ pg 14 å¯åŠ¨èµ·æ¥ï¼Œå¹¶åˆ›å»ºä¸€äº›æ•°æ®ã€‚ docker-compose up -d db14 [+] Building 0.0s (0/0) docker-container:multiarch [+] Running 2/2 âœ” Network docker_default Created 0.1s âœ” Container db14 Started export database='postgres://postgres:test@localhost:5432/test?sslmode=disable' docker-compose exec db14 psql \"$database\" -c 'select version();' ------------------------------------------------------------------------------------------------------------ ----------------- PostgreSQL 14.10 (Debian 14.10-1.pgdg120+1) on aarch64-unknown-linux-gnu, compiled by gcc (Debian 12.2.0-14 ) 12.2.0, 64-bit (1 row) docker-compose exec db14 psql \"$database\" -c 'CREATE TABLE IF NOT EXISTS t_test( ID INT NOT NULL, NAME TEXT NOT NULL, AGE INT NOT NULL, ADDRESS CHAR(50), SALARY REAL );' CREATE TABLE docker-compose exec db14 psql \"$database\" -c 'select count(*) from t_test;' count ------- 0 (1 row) docker-compose exec db14 psql \"$database\" -c 'insert into t_test SELECT generate_series(1,1) as key,repeat( chr(int4(random()*26)+65),4), (random()*(6^2))::integer,null,(random()*(10^4))::integer;' INSERT 0 1 docker-compose exec db14 psql \"$database\" -c 'select count(*) from t_test;' count ------- 1 (1 row) å¼€å§‹å‡çº§è¿‡ç¨‹ docker-compose stop db14 [+] Stopping 1/1 âœ” Container db14 Stopped docker-compose up -d upgrade [+] Running 1/1 âœ” Container upgrade Started docker-compose exec upgrade docker-upgrade pg_upgrade The files belonging to this database system will be owned by user \"postgres\". This user must also own the server process. The database cluster will be initialized with locale \"en_US.utf8\". The default database encoding has accordingly been set to \"UTF8\". The default text search configuration will be set to \"english\". Data page checksums are disabled. fixing permissions on existing directory /var/lib/postgresql/all/db15 ... ok creating subdirectories ... ok selecting dynamic shared memory implementation ... posix selecting default max_connections ... 100 selecting default shared_buffers ... 128MB selecting default time zone ... Etc/UTC creating configuration files ... ok running bootstrap script ... ok performing post-bootstrap initialization ... ok syncing data to disk ... ok initdb: warning: enabling \"trust\" authentication for local connections initdb: hint: You can change this by editing pg_hba.conf or using the option -A, or --auth-local and --auth-host, the next time you run initdb. Success. You can now start the database server using: pg_ctl -D /var/lib/postgresql/all/db15 -l logfile start Performing Consistency Checks ----------------------------- Checking cluster versions ok Checking database user is the install user ok Checking database connection settings ok Checking for prepared transactions ok Checking for system-defined composite types in user tables ok Checking for reg* data types in user tables ok Checking for contrib/isn with bigint-passing mismatch ok Creating dump of global objects ok Creating dump of database schemas ok Checking for presence of required libraries ok Checking database user is the install user ok Checking for prepared transactions ok Checking for ","date":"2023-12-04","objectID":"/postgres-upgrade-bitnami-ha/:2:1","tags":["db","postgres","bitnami","bitnami/postgres-ha","pg_upgrade"],"title":"åœ¨ k8s å®é™…ç”Ÿäº§ä¸­ bitnami/postgres-ha çš„ä¸€æ¬¡ 14 å‡çº§ 15 ç»éªŒåŠè¿‡ç¨‹","uri":"/postgres-upgrade-bitnami-ha/"},{"categories":null,"content":"å‡çº§æ³¨æ„äº‹é¡¹ å¦‚æœä½¿ç”¨äº† PostgreSQL extensionï¼Œ éœ€è¦æ‰‹åŠ¨å®‰è£… åœ¨å‡çº§å®¹å™¨æ–°ç‰ˆæœ¬ PG æ‰‹åŠ¨å®‰è£… apt update \u0026\u0026 apt install postgresql-14-pgaudit apt update \u0026\u0026 apt install postgresql-15-pgaudit æ—§ postgres:14-alpine ä½¿ç”¨ postgres:15-bookworm-pg_upgrade æ–°è¿è¡Œç¯å¢ƒ postgres:15-alpine ä½¿ç”¨ postgres:15-bookworm åš pg_upgrade é‡åˆ° warning: database \"postgres\" has no actual collation version, but a version was recorded REINDEX REINDEX DATABASE splat;ALTER DATABASE splat REFRESH COLLATION VERSION; ``` ```bash ERROR: invalid collation version change glibc ç‰ˆæœ¬/ç³»ç»Ÿç‰ˆæœ¬å˜åŒ–å¯¼è‡´ pg_upgrade å‡çº§åæŠ¥é”™ å®˜æ–¹å»ºè®® æ–°æ—§åŠå‡çº§å®¹å™¨çš„ linux è¿è¡Œæ—¶éƒ½ä½¿ç”¨ç›¸åŒçš„. æ¯”å¦‚æ­¤ä¾‹å­ä¸­åº”éƒ½ä½¿ç”¨ alpine:3.14. æœ€ç»ˆï¼Œå†™äº†å®Œæ•´éªŒè¯è‡ªåŠ¨åŒ–è„šæœ¬: # docker-compose.yaml version: \"3\" services: db14: image: postgres:14-bookworm container_name: db14 environment: POSTGRES_USER: postgres POSTGRES_PASSWORD: test POSTGRES_DB: test PGDATA: /var/lib/postgresql/all/db14 volumes: - ./data/:/var/lib/postgresql/all ports: - 5432:5432 db15: image: postgres:15-bookworm container_name: db15 environment: POSTGRES_USER: postgres POSTGRES_PASSWORD: test POSTGRES_DB: test PGDATA: /var/lib/postgresql/all/db15 volumes: - ./data/:/var/lib/postgresql/all ports: - 5433:5432 upgrade: image: tianon/postgres-upgrade:14-to-15 container_name: upgrade environment: PGDATAOLD: /var/lib/postgresql/all/db14 PGDATANEW: /var/lib/postgresql/all/db15 POSTGRES_USER: test POSTGRES_PASSWORD: password command: [\"tail\", \"-f\", \"/dev/null\"] volumes: - ./data/:/var/lib/postgresql/all # test.sh #!/usr/bin/env bash set -o errtrace set -o errexit set -o nounset set -o pipefail set -o xtrace cd \"$(dirname \"$0\")\" export database='postgres://postgres:test@localhost:5432/test?sslmode=disable' docker-compose down rm -rf data sleep 3 docker-compose up -d db14 sleep 5 docker-compose exec db14 pg_isready -d \"$database\" -t 20 docker-compose exec db14 psql \"$database\" -c 'select version();' docker-compose exec db14 psql \"$database\" -c 'CREATE TABLE IF NOT EXISTS t_test( ID INT NOT NULL, NAME TEXT NOT NULL, AGE INT NOT NULL, ADDRESS CHAR(50), SALARY REAL );' docker-compose exec db14 psql \"$database\" -c 'select count(*) from t_test;' docker-compose exec db14 psql \"$database\" -c 'insert into t_test SELECT generate_series(1,1) as key,repeat( chr(int4(random()*26)+65),4), (random()*(6^2))::integer,null,(random()*(10^4))::integer;' docker-compose exec db14 psql \"$database\" -c 'select count(*) from t_test;' docker-compose stop db14 docker-compose up -d upgrade docker-compose exec upgrade docker-upgrade pg_upgrade docker-compose up -d db15 sleep 3 docker-compose exec db15 psql \"$database\" -c 'ALTER DATABASE test REFRESH COLLATION VERSION;' docker-compose exec db15 vacuumdb --username=postgres --all --analyze-in-stages docker-compose logs -f db15 ","date":"2023-12-04","objectID":"/postgres-upgrade-bitnami-ha/:2:2","tags":["db","postgres","bitnami","bitnami/postgres-ha","pg_upgrade"],"title":"åœ¨ k8s å®é™…ç”Ÿäº§ä¸­ bitnami/postgres-ha çš„ä¸€æ¬¡ 14 å‡çº§ 15 ç»éªŒåŠè¿‡ç¨‹","uri":"/postgres-upgrade-bitnami-ha/"},{"categories":null,"content":"åŸºäº k8s çš„ bitnami/postgres-ha å‡çº§çš„å°è¯• Terabyte-scale PostgreSQL upgrade from 9.6 to 14 ä¸­æœ‰æè¿°åŸåœ°å‡çº§æ–¹æ³•ï¼Œåœ¨æ­¤å¤ç°ï¼Œå¹¶å°†è¿‡ç¨‹è‡ªåŠ¨åŒ–ã€‚ é‡å¤å‡çº§æ–¹æ³•ã€‚ é¦–å…ˆåˆ›å»ºä¸€ä¸ª postgres 14 çš„ pg é›†ç¾¤ helm pull oci://registry-1.docker.io/bitnamicharts/postgresql-ha --version 12.3.1 helm upgrade --install shared postgresql-ha-12.3.1.tgz --set postgresql.image.tag='14.10.0-debian-11-r6' --set postgresql.replicaCount=1 --set postgresql.sharedPreloadLibraries='\"pgaudit, repmgr, pg_stat_statements\"' å…ˆå‡†å¤‡å‡çº§ pod # åœæ­¢pg kubectl scale --replicas=0 sts shared-postgresql-ha-postgresql cat \u003c\u003c'EOF' | kubectl apply -f - apiVersion: batch/v1 kind: Job metadata: name: pgupgrade spec: completions: 1 backoffLimit: 1 template: spec: restartPolicy: Never volumes: - name: data-sharedx-pgha-0 persistentVolumeClaim: claimName: data-shared-postgresql-ha-postgresql-0 containers: - name: pg-upgrade image: tianon/postgres-upgrade:14-to-15 imagePullPolicy: IfNotPresent command: - \"sh\" - -c - \"tail -f /dev/null\" env: - name: PGDATABASE value: /bitnami/postgresql/ - name: PGDATAOLD value: /bitnami/postgresql/data - name: PGDATANEW value: /bitnami/postgresql/datanew volumeMounts: - mountPath: \"/bitnami/postgresql\" name: data-sharedx-pgha-0 EOF # è·å¾—å‡çº§ shell kubectl exec -it $(kubectl get pod -l batch.kubernetes.io/job-name=pgupgrade -o name) -- bash ","date":"2023-12-04","objectID":"/postgres-upgrade-bitnami-ha/:3:0","tags":["db","postgres","bitnami","bitnami/postgres-ha","pg_upgrade"],"title":"åœ¨ k8s å®é™…ç”Ÿäº§ä¸­ bitnami/postgres-ha çš„ä¸€æ¬¡ 14 å‡çº§ 15 ç»éªŒåŠè¿‡ç¨‹","uri":"/postgres-upgrade-bitnami-ha/"},{"categories":null,"content":"å°è¯• docker-upgrade pg_upgrade Performing Consistency Checks ----------------------------- Checking cluster versions ok *failure* Consult the last few lines of \"/bitnami/postgresql/datanew/pg_upgrade_output.d/20231128T060414.361/log/pg_upgrade_server.log\" for the probable cause of the failure. connection to server on socket \"/var/lib/postgresql/.s.PGSQL.50432\" failed: No such file or directory Is the server running locally and accepting connections on that socket? could not connect to source postmaster started with the command: \"/usr/lib/postgresql/14/bin/pg_ctl\" -w -l \"/bitnami/postgresql/datanew/pg_upgrade_output.d/20231128T060414.361/log/pg_upgrade_server.log\" -D \"/bitnami/postgresql/data\" -o \"-p 50432 -b -c listen_addresses='' -c unix_socket_permissions=0700 -c unix_socket_directories='/var/lib/postgresql'\" start Failure, exiting cat /bitnami/postgresql/datanew/pg_upgrade_output.d/20231128T060414.361/log/pg_upgrade_server.log ----------------------------------------------------------------- pg_upgrade run on Tue Nov 28 06:04:14 2023 ----------------------------------------------------------------- command: \"/usr/lib/postgresql/14/bin/pg_ctl\" -w -l \"/bitnami/postgresql/datanew/pg_upgrade_output.d/20231128T060414.361/log/pg_upgrade_server.log\" -D \"/bitnami/postgresql/data\" -o \"-p 50432 -b -c listen_addresses='' -c unix_socket_permissions=0700 -c unix_socket_directories='/var/lib/postgresql'\" start \u003e\u003e \"/bitnami/postgresql/datanew/pg_upgrade_output.d/20231128T060414.361/log/pg_upgrade_server.log\" 2\u003e\u00261 waiting for server to start....postgres: could not access the server configuration file \"/bitnami/postgresql/data/postgresql.conf\": No such file or directory stopped waiting pg_ctl: could not start server Examine the log output. çœ‹èµ·æ¥æ—§æ•°æ®éœ€è¦ postgresql.conf æ‰å¯ä»¥å¯åŠ¨ã€‚ç°å°†æ‰€æœ‰æ—§é…ç½®éƒ½å¤åˆ¶åˆ°æ•°æ®ç›®å½• kubectl exec -it shared-postgresql-ha-postgresql-0 -- cp /opt/bitnami/postgresql/conf/postgresql.conf /bitnami/postgresql/data root@task-pg-upgrade-545cbc8cdf-6z8mf:/var/lib/postgresql# cat /bitnami/postgresql/datanew/pg_upgrade_output.d/20231128T064300.020/log/pg_upgrade_server.log ----------------------------------------------------------------- pg_upgrade run on Tue Nov 28 06:43:00 2023 ----------------------------------------------------------------- command: \"/usr/lib/postgresql/14/bin/pg_ctl\" -w -l \"/bitnami/postgresql/datanew/pg_upgrade_output.d/20231128T064300.020/log/pg_upgrade_server.log\" -D \"/bitnami/postgresql/data\" -o \"-p 50432 -b -c listen_addresses='' -c unix_socket_permissions=0700 -c unix_socket_directories='/var/lib/postgresql'\" start \u003e\u003e \"/bitnami/postgresql/datanew/pg_upgrade_output.d/20231128T064300.020/log/pg_upgrade_server.log\" 2\u003e\u00261 waiting for server to start....2023-11-28 06:43:00.206 GMT [177] LOG: could not open configuration directory \"/bitnami/postgresql/data/conf.d\": No such file or directory 2023-11-28 06:43:00.207 GMT [177] FATAL: configuration file \"/bitnami/postgresql/data/postgresql.conf\" contains errors stopped waiting pg_ctl: could not start server Examine the log output. æ‰§è¡Œ mkdir -p /bitnami/postgresql/data/conf.d ä¿®å¤ cat/bitnami/postgresql/datanew/pg_upgrade_output.d/20231128T064744.773/log/pg_upgrade_server.log ----------------------------------------------------------------- pg_upgrade run on Tue Nov 28 06:47:44 2023 ----------------------------------------------------------------- command: \"/usr/lib/postgresql/14/bin/pg_ctl\" -w -l \"/bitnami/postgresql/datanew/pg_upgrade_output.d/20231128T064744.773/log/pg_upgrade_server.log\" -D \"/bitnami/postgresql/data\" -o \"-p 50432 -b -c listen_addresses='' -c unix_socket_permissions=0700 -c unix_socket_directories='/var/lib/postgresql'\" start \u003e\u003e \"/bitnami/postgresql/datanew/pg_upgrade_output.d/20231128T064744.773/log/pg_upgrade_server.log\" 2\u003e\u00261 waiting for server to start....2023-11-28 06:47:44.970 GMT [255] FATAL: 58P01: could not access file \"repmgr\": No such file or directory 2023-11-28 06:47:44.970 GMT [255] LOCATION: internal_load_library, dfmgr.c:208 2023-11-28 06:47:44.970 GMT [","date":"2023-12-04","objectID":"/postgres-upgrade-bitnami-ha/:3:1","tags":["db","postgres","bitnami","bitnami/postgres-ha","pg_upgrade"],"title":"åœ¨ k8s å®é™…ç”Ÿäº§ä¸­ bitnami/postgres-ha çš„ä¸€æ¬¡ 14 å‡çº§ 15 ç»éªŒåŠè¿‡ç¨‹","uri":"/postgres-upgrade-bitnami-ha/"},{"categories":null,"content":"è‡ªåŠ¨åŒ– k8s bitnami/postgres-ha å‡çº§æ­¥éª¤æ¯”è¾ƒå¤šï¼Œåœ¨æ­¤æ±‡æ€»å‡ºè‡ªåŠ¨åŒ–, ä»£ç æ”¾åˆ° exfly/bitnami-pg-upgrade. å¯ä»¥æ ¹æ®æƒ…å†µé€‚é‡ä¿®æ”¹ã€‚ ","date":"2023-12-04","objectID":"/postgres-upgrade-bitnami-ha/:3:2","tags":["db","postgres","bitnami","bitnami/postgres-ha","pg_upgrade"],"title":"åœ¨ k8s å®é™…ç”Ÿäº§ä¸­ bitnami/postgres-ha çš„ä¸€æ¬¡ 14 å‡çº§ 15 ç»éªŒåŠè¿‡ç¨‹","uri":"/postgres-upgrade-bitnami-ha/"},{"categories":null,"content":"å‚è€ƒ å®˜æ–¹æ–‡æ¡£ Terabyte-scale PostgreSQL upgrade from 9.6 to 14 bitnami æä¾›çš„å‡çº§ postgres çš„æ–¹æ³• Better documentation needed on major version upgrades ","date":"2023-12-04","objectID":"/postgres-upgrade-bitnami-ha/:4:0","tags":["db","postgres","bitnami","bitnami/postgres-ha","pg_upgrade"],"title":"åœ¨ k8s å®é™…ç”Ÿäº§ä¸­ bitnami/postgres-ha çš„ä¸€æ¬¡ 14 å‡çº§ 15 ç»éªŒåŠè¿‡ç¨‹","uri":"/postgres-upgrade-bitnami-ha/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šæœ¬æ–‡ä»‹ç»äº†ä¸€ç§è·¨å¹³å°ï¼ˆæ”¯æŒ Macï¼ŒLinuxï¼ŒWindowsï¼‰çš„å‘½ä»¤è¡Œæ¸²æŸ“ draw.io å›¾è¡¨æ–‡ä»¶ä¸ºå›¾ç‰‡çš„æ–¹æ³•. draw.io æ˜¯ä¸€æ¬¾æ¯”è¾ƒç®€å•çš„ç”»æµç¨‹å›¾ã€æ¶æ„å›¾çš„å¼€æºå…è´¹è½¯ä»¶ã€‚å…·ä½“ä»‹ç»å¯ä»¥çœ‹ä¸‹ wikipedia ä»‹ç»ã€‚ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨ä»–çš„ç½‘é¡µç‰ˆç”»å›¾ï¼Œä¸‹è½½åŸæ–‡ä»¶åŠæ¸²æŸ“çš„ PNG æ–‡ä»¶ç”¨äºæ–‡æ¡£ä¸­. ä½†å¦‚æœå¸Œæœ›ä¿®æ”¹ä¸€ä¸‹å›¾å†…å®¹ï¼Œéœ€è¦æµè§ˆå™¨æ‰“å¼€ draw.ioï¼Œä¸Šä¼ æºæ–‡ä»¶ï¼Œä¿®æ”¹ï¼Œä¸‹è½½ï¼Œä¿®æ”¹æ–‡æ¡£ä¸­ä½¿ç”¨åˆ°è¿™ä¸ªå›¾çš„é“¾æ¥ã€‚æ˜¯å¦æœ‰ä¸€ç§æ–¹æ³•åœ¨æœ¬åœ° CLI æ¸²æŸ“æˆå›ºå®šæ–‡ä»¶åå­—çš„æ–‡ä»¶ï¼Œæœ¬åœ°ä¿®æ”¹åä¸€é”®ä¿®æ”¹å‘¢ï¼Ÿ é¦–å…ˆ vscode æœ‰ draw.io çš„æ’ä»¶ï¼Œå¯ä»¥ç›´æ¥ GUI æ–¹å¼ä¿®æ”¹å›¾ï¼Œä¿å­˜åˆ° draw.io æºæ–‡ä»¶ã€‚ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¡Œå·¥å…·å¯ä»¥å°†å½“å‰ç›®å½•ä¸‹çš„ *.drawio æ¸²æŸ“æˆ *.draio.png. ç›´æ¥å°†ç”Ÿæˆçš„ png æ–‡ä»¶åœ¨ markdown ä¸­å¼•ç”¨ã€‚ä¿®æ”¹å›¾çš„å·¥ä½œæµå˜æˆ vscode draw.io æ’ä»¶ä¿®æ”¹å›¾åä¿å­˜ï¼Œåç›´æ¥æ‰§è¡Œè„šæœ¬å³å¯ã€‚ ä½¿ç”¨è„šæœ¬ render.sh å¦‚ä¸‹. é¦–å…ˆä¸‹è½½å®‰è£… drawio-desktop, å¹¶æ ¹æ®å¹³å°ä¿®æ”¹è„šæœ¬ draw_io éƒ¨åˆ†ã€‚ #!/usr/bin/env bash set -o errtrace set -o errexit set -o nounset set -o pipefail set -o xtrace cd \"$(dirname \"$0\")\" draw_io='/Applications/draw.io.app/Contents/MacOS/draw.io' for drawio_file in $(ls *.drawio); do echo \"$drawio_file\" ${draw_io} -x --format png -o \"$drawio_file.png\" \"$drawio_file\" done âš ï¸ æ³¨æ„ï¼šæœ¬äººåªæµ‹è¯•è¿‡ Macï¼Œå…¶ä»–å¹³å°å¯èƒ½ä¼šå°‘é‡ä¿®æ”¹è„šæœ¬å†…å®¹ ","date":"2023-10-29","objectID":"/draw.io-cli-render/:0:0","tags":["tools","draw.io","cli"],"title":"è·¨å¹³å°å‘½ä»¤è¡Œæ¸²æŸ“ draw.io æ–¹æ³•","uri":"/draw.io-cli-render/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šæœ¬æ–‡ç®€å•ä»‹ç»äº† Hadoop Resource Manager é¡µé¢ HA æ–¹å¼ï¼Œå¹¶åŸºäºæ­¤å®ç°äº†ä¸€ç§ Openrestry + Lua ç¼–å†™åŠ¨æ€è„šæœ¬ï¼Œå°† Hadoop Resource Manager ä½¿ç”¨ Nginx åå‘ä»£ç†å‡ºæ¥çš„æ–¹æ³•ã€‚å…¶ä¸­æä¾›çš„ä»£ç ï¼Œå¯ç›´æ¥è¿è¡Œèµ·æ¥ã€‚ ","date":"2023-10-22","objectID":"/hadoop-resource-manager-behind-nginx/:0:0","tags":["nginx","openresty","lua","bigdata"],"title":"Hadoop ResourceManager Behind Nginx,  ä½¿ç”¨ Nginx åä»£ Hadoop ResourceManager ç®¡ç†ç•Œé¢","uri":"/hadoop-resource-manager-behind-nginx/"},{"categories":null,"content":"é—®é¢˜åœºæ™¯ Hadoop Resource Manager(RM) çš„ç®¡ç†é¡µé¢é‡‡ç”¨äº†ç±»ä¼¼å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„ HA æ–¹æ¡ˆã€‚Resource Manager åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼ŒMaster/Standbyã€‚å½“ http è¯·æ±‚åˆ° Standbyï¼ŒStandby å°†é‡å®šå‘åˆ° Masterï¼Œè¿™æ ·æµè§ˆå™¨å³å¯è®¿é—®åˆ°å®é™…å·¥ä½œçš„ RM äº†ã€‚è€Œè¿™ç§åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ Nginx ä½œä¸º Load Balance ä»£ç† RM å°±ä¸åˆé€‚ï¼Œå› ä¸ºå¯¹ nginx æ¥è¯´ï¼Œnginx æœŸæœ›æ‰€æœ‰çš„å®ä¾‹éƒ½å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ã€‚Nginx æ˜¯å¦å¯ä»¥æä¾›ä¸€ç§æœºåˆ¶ï¼Œæ‰¾åˆ°å®é™…çš„ RM master èŠ‚ç‚¹ï¼Œå°†æ‰€æœ‰è¯·æ±‚å‘é€åˆ°è¿™ä¸ªèŠ‚ç‚¹å‘¢? ","date":"2023-10-22","objectID":"/hadoop-resource-manager-behind-nginx/:1:0","tags":["nginx","openresty","lua","bigdata"],"title":"Hadoop ResourceManager Behind Nginx,  ä½¿ç”¨ Nginx åä»£ Hadoop ResourceManager ç®¡ç†ç•Œé¢","uri":"/hadoop-resource-manager-behind-nginx/"},{"categories":null,"content":"è§£å†³åŠæ³• HadoopResourceManagerHA æ–‡æ¡£ å¯¹äº Load Balancer æœ‰å¦‚ä¸‹æè¿° If you are running a set of ResourceManagers behind a Load Balancer (e.g. Azure or AWS ) and would like the Load Balancer to point to the active RM, you can use the /isActive HTTP endpoint as a health probe. http://RM_HOSTNAME/isActive will return a 200 status code response if the RM is in Active HA State, 405 otherwise. åœ¨ä½¿ç”¨çš„ HadoopResourceManager ç‰ˆæœ¬ æ²¡æœ‰ /isActive è¿™ä¸ªè·¯ç”±ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨è¿™ä¸ªåŠæ³•ã€‚ æŸ¥çœ‹èµ„æ–™çš„æ—¶å€™ï¼Œå‘ç° http://ip:8088/jmx?qry=Hadoop:service=ResourceManager,name=ClusterMetrics ä¸­ä¼šæœ‰ä¸»èŠ‚ç‚¹çš„ hostname, å¹¶ä¸”è¿™ä¸ªæ¥å£åªæœ‰ Master æ‰ä¼šæœ‰å“åº”ã€‚åŸºäºè¿™ä¸ªç‰¹å¾ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æŸ¥æ˜¯å¦å¯ä»¥è¿”å›ä¸»èŠ‚ç‚¹ä¿¡æ¯åˆ¤æ–­æ˜¯å¦ä¸ºä¸»ã€‚ å¦å¤–ï¼ŒStandby 307 çš„ response body ä¸­ä¹Ÿæ˜ç¡®æ ‡è¯†äº†å½“å‰æ˜¯ standbyï¼Œæ­¤è¡Œä¸ºä¹Ÿå¯ä»¥ä½œä¸ºåˆ¤æ–­æ˜¯å¦ä¸ºä¸»çš„æ ‡è¯†ã€‚ å½“å‰æˆ‘ä»¬å„ç»„å»ºç‰ˆæœ¬: ResourceManager ç‰ˆæœ¬3.1.1.3.1.0.0-78 from e4f82af51faec922b4804d0232a637422ec29e64 by jenkins source checksum 47cebb2682958b68f58d47415f5d2555 on 2018-12-06T12:28Z Hadoop version: 3.1.1.3.1.0.0-78 from e4f82af51faec922b4804d0232a637422ec29e64 by jenkins source checksum eab9fa2a6aa38c6362c66d8df75774 on 2018-12-06T12:26Z å…·ä½“çš„å“åº”çš„æ ·å­å¦‚ä¸‹å›¾ å°è¯•è¯·æ±‚ Standby çœ‹ä¸‹æ•ˆæœ: curl xx.xx.xx.xx:8088/ -k -v * Trying xx.xx.xx.xx:8088... * Connected to xx.xx.xx.xx (xx.xx.xx.xx) port 8088 (#0) \u003e GET / HTTP/1.1 \u003e Host: xx.xx.xx.xx:8088 \u003e User-Agent: curl/7.88.1 \u003e Accept: */* \u003e \u003c HTTP/1.1 307 Temporary Redirect \u003c Date: Wed, 25 Oct 2023 02:05:48 GMT \u003c Cache-Control: no-cache \u003c Expires: Wed, 25 Oct 2023 02:05:48 GMT \u003c Date: Wed, 25 Oct 2023 02:05:48 GMT \u003c Pragma: no-cache \u003c Content-Type: text/plain;charset=utf-8 \u003c X-Frame-Options: SAMEORIGIN \u003c Location: http://bigdata3:8088/ \u003c Content-Length: 43 \u003c This is standby RM. The redirect url is: / curl 'http://xx.xx.xx.xx:8088/jmx?qry=Hadoop:service=ResourceManager,name=ClusterMetrics' -k -v * Trying xx.xx.xx.xx:8088... * Connected to xx.xx.xx.xx (xx.xx.xx.xx) port 8088 (#0) \u003e GET /jmx?qry=Hadoop:service=ResourceManager,name=ClusterMetrics HTTP/1.1 \u003e Host: xx.xx.xx.xx:8088 \u003e User-Agent: curl/7.88.1 \u003e Accept: */* \u003e \u003c HTTP/1.1 307 Temporary Redirect \u003c Date: Wed, 25 Oct 2023 02:10:32 GMT \u003c Cache-Control: no-cache \u003c Expires: Wed, 25 Oct 2023 02:10:32 GMT \u003c Date: Wed, 25 Oct 2023 02:10:32 GMT \u003c Pragma: no-cache \u003c Content-Type: text/plain;charset=utf-8 \u003c X-Frame-Options: SAMEORIGIN \u003c Location: http://bigdata3:8088/jmx?qry=Hadoop%3Aservice%3DResourceManager%2Cname%3DClusterMetrics \u003c Content-Length: 109 \u003c This is standby RM. The redirect url is: /jmx?qry=Hadoop%3Aservice%3DResourceManager%2Cname%3DClusterMetrics * Connection #0 to host xx.xx.xx.xx left intact è¯·æ±‚ Master èŠ‚ç‚¹ï¼Œçœ‹ä¸‹è¯·æ±‚æ˜¯ä»€ä¹ˆæ ·å­çš„: curl xx.xx.xx.xx:8088/ -k -v * Trying xx.xx.xx.xx:8088... * Connected to xx.xx.xx.xx (xx.xx.xx.xx) port 8088 (#0) \u003e GET / HTTP/1.1 \u003e Host: xx.xx.xx.xx:8088 \u003e User-Agent: curl/7.88.1 \u003e Accept: */* \u003e \u003c HTTP/1.1 302 Found \u003c Date: Wed, 25 Oct 2023 02:06:01 GMT \u003c Cache-Control: no-cache \u003c Expires: Wed, 25 Oct 2023 02:06:01 GMT \u003c Date: Wed, 25 Oct 2023 02:06:01 GMT \u003c Pragma: no-cache \u003c Content-Type: text/plain;charset=utf-8 \u003c X-Frame-Options: SAMEORIGIN \u003c Vary: Accept-Encoding \u003c Location: http://xx.xx.xx.xx:8088/cluster \u003c Content-Length: 0 curl 'http://xx.xx.xx.xx:8088/jmx?qry=Hadoop:service=ResourceManager,name=ClusterMetrics' -k -v * Trying xx.xx.xx.xx:8088... * Connected to xx.xx.xx.xx (xx.xx.xx.xx) port 8088 (#0) \u003e GET /jmx?qry=Hadoop:service=ResourceManager,name=ClusterMetrics HTTP/1.1 \u003e Host: xx.xx.xx.xx:8088 \u003e User-Agent: curl/7.88.1 \u003e Accept: */* \u003e \u003c HTTP/1.1 200 OK \u003c Date: Wed, 25 Oct 2023 02:09:49 GMT \u003c Cache-Control: no-cache \u003c Expires: Wed, 25 Oct 2023 02:09:49 GMT \u003c Date: Wed, 25 Oct 2023 02:09:49 GMT \u003c Pragma: no-cache \u003c Content-Type: application/json; charset=utf8 \u003c X-Frame-Options: SAMEORIGIN \u003c Vary: Accept-Encoding \u003c Access-Control-Allow-Methods: GET \u003c Access-Control-Allow-Origin: * \u003c Transfer-Encoding: chunked \u003c { \"beans\" : [ { \"name\" : \"Hadoop:service=ResourceManager,name=ClusterMetrics\", \"modelerType\" : \"ClusterMetrics\", \"tag.ClusterMetrics\" : \"ResourceManager\", \"tag.Context\" : \"yarn\", \"tag.Hostname\" : \"bigdata3\", \"NumActiveNMs\" : 3, \"NumDecommissioningNMs\" : 0, \"NumDecomm","date":"2023-10-22","objectID":"/hadoop-resource-manager-behind-nginx/:2:0","tags":["nginx","openresty","lua","bigdata"],"title":"Hadoop ResourceManager Behind Nginx,  ä½¿ç”¨ Nginx åä»£ Hadoop ResourceManager ç®¡ç†ç•Œé¢","uri":"/hadoop-resource-manager-behind-nginx/"},{"categories":null,"content":"nginx ä½¿ç”¨ nginx åŸç”Ÿæ”¯æŒçš„èƒ½åŠ›åˆ¤æ–­ä¸» upstream çš„æ–¹æ³•å¯ä»¥è€ƒè™‘ 1ï¼Œ2ï¼Œ3 ä¸‰ç§æ–¹æ³•ã€‚ ç¿»äº†ä¸‹ nginx upstream çš„æ–‡æ¡£, Dynamically configurable group with periodic health checks is available as part of our commercial subscription:. æ‰€ä»¥å‡†å¤‡å°è¯•ä¸€ä¸‹ ngx_http_upstream_hc_moduleã€‚æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ nginx:latest é•œåƒï¼Œé…ç½®å¦‚ä¸‹: upstream backend { server bing.com:80; # server www.baidu.com:80; } server { listen 8080; server_name localhost; location / { proxy_set_header Host 'bing.com'; proxy_pass http://backend; health_check; } } å¯åŠ¨ nginx ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯: 2023/10/23 01:56:53 [emerg] 1#1: unknown directive \"health_check\" in /etc/nginx/conf.d/default.conf:13 é”™è¯¯è¡¨ç¤ºå†…ç½®çš„ nginx æ²¡ç¼–è¯‘ ngx_http_upstream_hc_moduleã€‚å¦‚æœå¸Œæœ›ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œéœ€è¦è‡ªç¼–è¯‘ nginx æ·»åŠ æ­¤æ¨¡å—ã€‚æš‚ä¸æƒ³è‡ªç¼–è¯‘ nginxï¼Œæ­¤æ–¹æ³•å¼ƒç”¨ã€‚ ","date":"2023-10-22","objectID":"/hadoop-resource-manager-behind-nginx/:2:1","tags":["nginx","openresty","lua","bigdata"],"title":"Hadoop ResourceManager Behind Nginx,  ä½¿ç”¨ Nginx åä»£ Hadoop ResourceManager ç®¡ç†ç•Œé¢","uri":"/hadoop-resource-manager-behind-nginx/"},{"categories":null,"content":"openresty+lua æ¢ä¸€ä¸ªæ€è·¯ï¼Œå¦‚æœæˆ‘ä»¬æœŸæœ›çš„è¡Œä¸ºæ˜¯åœ¨è¯·æ±‚çš„æ—¶å€™ï¼Œèƒ½å¤ŸåŒºåˆ†å¼€ï¼Œä½¿ç”¨åŸºäº nginx çš„ æ›´åŠ¨æ€çš„ openresty+lua ç»„åˆå†™è„šæœ¬æ–¹æ¡ˆæ‰¾åˆ°å½“å‰çš„ä¸»ï¼Œé—®é¢˜å³å¯è§£å†³äº†ã€‚ https://hadoop.apache.org/docs/stable/hadoop-yarn/hadoop-yarn-site/ResourceManagerHA.html é¦–å…ˆå‡†å¤‡ä¸€ä¸‹ openresty çš„ docker é•œåƒ docker build --platform linux/amd64 -t openresty:dev -f Dockerfile . FROM openresty/openresty:latest RUN sed -E -i 's/(deb|security).debian.org/mirrors.tuna.tsinghua.edu.cn/g' /etc/apt/sources.list RUN DEBIAN_FRONTEND=noninteractive apt-get update \\ \u0026\u0026 DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \\ wget \\ curl \\ \u0026\u0026 rm -rf /var/lib/apt/lists/* nginx.conf æ–‡ä»¶å¦‚ä¸‹ nginx.conf_root daemon off; worker_processes 3; user root root; events { worker_connections 1024; } http { default_type application/octet-stream; include /etc/nginx/conf.d/*.conf; } é»˜è®¤è·¯ç”±æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹ï¼Œè¯·æ±‚è¿›æ¥åï¼Œé€šè¿‡æ‰§è¡Œ shell è¯·æ±‚æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ‰¾å‡ºå½“å‰çš„ä¸»çš„ hostname, ç„¶åå°†è¯·æ±‚è·¯ç”±åˆ° hostname å¯¹åº”çš„ upstream default.conf server { listen 80; server_name localhost; location / { access_by_lua_block { os.execute(\"/bin/bash /etc/nginx/conf.d/hadoop-status.sh \u003e /tmp/hadoop-status.tmp\") handle = io.open(\"/tmp/hadoop-status.tmp\", \"r\") result = handle:read(\"*a\") handle:close() ngx.log(ngx.ERR, result) ngx.exec(\"@\"..result) } } location @bigdata1 { proxy_pass http://192.168.100.41:8088; } location @bigdata2 { proxy_pass http://192.168.100.42:8088; } location @bigdata3 { proxy_pass http://192.168.100.43:8088; } } æ‰¾åˆ°ä¸»çš„èŠ‚ç‚¹çš„æ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œéå†æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œæœ‰ jmx è¿”å›çš„å³ä¸º Masterã€‚Master ä¸­åŒ…å«å½“å‰çš„ hostnameï¼Œä»è„šæœ¬è¿”å›ï¼Œä¼ é€’ç»™ nginx åšè·¯ç”±é€‰æ‹©å³å¯. ä»£ç å¦‚ä¸‹: hadoop-status.sh #!/usr/bin/env bash set -o errtrace set -o errexit set -o nounset # set -o pipefail # set -o xtrace cd \"$(dirname \"$0\")\" # cat /etc/nginx/conf.d/host_ip.txt | while read line; cat /etc/nginx/conf.d/host_ip.txt | while read line; do # å¿½ç•¥å¤‡æ³¨è¡Œ if [[ $line == \\#* ]] then continue fi linearray=( $line ) RAW_IP=${linearray[0]} RAW_HOSTNAME=${linearray[1]} MASTER_NODE=$(wget -qO- \"http://${RAW_IP}:8088/jmx?qry=Hadoop:service=ResourceManager,name=ClusterMetrics\" | sed 's/,/\\n/g' | grep 'tag.Hostname' | sed 's/tag.Hostname\" : \"//g' | sed 's/[\" ]//g') if [ \"${RAW_HOSTNAME}\" == \"${MASTER_NODE}\" ]; then echo -n $RAW_HOSTNAME fi done host_ip.txt ä¸­åŒ…å«æ‰€æœ‰èŠ‚ç‚¹ ip å’Œ hostname 192.168.100.41 bigdata1 192.168.100.42 bigdata2 192.168.100.43 bigdata3 æ‰§è¡Œä¸‹è¾¹å‘½ä»¤åï¼Œè®¿é—® 127.0.0.1:12346 çœ‹ä¸‹æ•ˆæœ docker run --rm -it -p 12346:80 -v $(pwd)/:/etc/nginx/conf.d/ openresty:dev nginx -c /etc/nginx/conf.d/nginx.conf_root ","date":"2023-10-22","objectID":"/hadoop-resource-manager-behind-nginx/:2:2","tags":["nginx","openresty","lua","bigdata"],"title":"Hadoop ResourceManager Behind Nginx,  ä½¿ç”¨ Nginx åä»£ Hadoop ResourceManager ç®¡ç†ç•Œé¢","uri":"/hadoop-resource-manager-behind-nginx/"},{"categories":null,"content":"æ€»ç»“ å¦‚ä¸Šï¼Œä½¿ç”¨ openresty+lua ç¼–å†™æ£€æŸ¥ä¸‹æ¸¸ upstream ä¸­æ‰€æœ‰èŠ‚ç‚¹ä¸»ä¸ºä½•ï¼Œç„¶å nginx è¯·æ±‚è·¯ç”±åˆ°ä¸»ã€‚ ","date":"2023-10-22","objectID":"/hadoop-resource-manager-behind-nginx/:3:0","tags":["nginx","openresty","lua","bigdata"],"title":"Hadoop ResourceManager Behind Nginx,  ä½¿ç”¨ Nginx åä»£ Hadoop ResourceManager ç®¡ç†ç•Œé¢","uri":"/hadoop-resource-manager-behind-nginx/"},{"categories":null,"content":"ref ä½¿ç”¨ Nginx+Lua ä»£ç† Hadoop HA, æ€è·¯æ¥è‡ªäºæ­¤ï¼Œæ­¤æ–‡ä¸­çš„æ–¹æ³•åªæ¥å—ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œç”Ÿäº§åŸºæœ¬ä¸å¯ç”¨ ","date":"2023-10-22","objectID":"/hadoop-resource-manager-behind-nginx/:4:0","tags":["nginx","openresty","lua","bigdata"],"title":"Hadoop ResourceManager Behind Nginx,  ä½¿ç”¨ Nginx åä»£ Hadoop ResourceManager ç®¡ç†ç•Œé¢","uri":"/hadoop-resource-manager-behind-nginx/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šå¦‚ä½•é…ç½®ä¸€ä¸ªè·¨ linux å‘è¡Œç‰ˆè§£å‹å³ç”¨çš„ python è¿è¡Œç¯å¢ƒ ","date":"2023-09-24","objectID":"/portable-python/:0:0","tags":["python","ops","portable","linux"],"title":"å¦‚ä½•é…ç½®ä¸€ä¸ªè·¨ linux å‘è¡Œç‰ˆè§£å‹å³ç”¨çš„ python è¿è¡Œç¯å¢ƒ(Portable Python)","uri":"/portable-python/"},{"categories":null,"content":"åœºæ™¯åˆ†æ æˆ‘ä»¬æ‰€å¤„çš„å·¥ä½œç¯å¢ƒå ToB ç¦»çº¿å®‰è£…å‡çº§ã€‚python åœ¨è¿ç»´å·¥å…·ä¸Šæœ‰æˆç†Ÿçš„ ansible ç­‰è¿ç»´å·¥å…·ã€‚è€Œåœ¨å®é™…ç”Ÿäº§ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œéœ€è¦é€‚é…ä¸åŒçš„ linux å‘è¡Œç‰ˆã€‚åœ¨è¿™è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¯”è¾ƒ ç¨³å®šå¼€ç®±å³ç”¨çš„ python è¿è¡Œç¯å¢ƒ å®‰è£…ç®€å• (æœ€å¥½è§£å‹å³å¯è¿è¡Œ) ç¬¬ä¸‰æ–¹åŒ…å®‰è£…å°½å¯èƒ½ç®€å• æˆ‘ä»¬æ‰€é¢å‘çš„é—®é¢˜ï¼š linux å‘è¡Œç‰ˆä¼—å¤šï¼Œä¸€äº›ä¸º python2ï¼Œä¸€äº›ä¸º python3ï¼›ä»£ç å¯ä»¥å…¼å®¹ python2 å’Œ python3ï¼Œä½†éƒ¨åˆ†ä¾èµ–ä¸å…¼å®¹ python2 å’Œ python3ï¼›å¹¶ä¸” python2 å·²ç» EOLï¼Œä¸æœŸæœ›ä¸ºå®ƒèŠ±è´¹åŠ›æ°”åšé€‚é… linux å‘è¡Œç‰ˆ glibc ç‰ˆæœ¬å„ä¸ç›¸åŒï¼Œé«˜ç‰ˆæœ¬ glibc ä¸‹ç¼–è¯‘ python æ”¾åˆ°ä½ç‰ˆæœ¬ glibc è¿è¡Œç¯å¢ƒä¸‹ä¼š glibc ç‰ˆæœ¬æ£€æŸ¥å¤±è´¥ ","date":"2023-09-24","objectID":"/portable-python/:1:0","tags":["python","ops","portable","linux"],"title":"å¦‚ä½•é…ç½®ä¸€ä¸ªè·¨ linux å‘è¡Œç‰ˆè§£å‹å³ç”¨çš„ python è¿è¡Œç¯å¢ƒ(Portable Python)","uri":"/portable-python/"},{"categories":null,"content":"è§£å†³åŠæ³• ","date":"2023-09-24","objectID":"/portable-python/:2:0","tags":["python","ops","portable","linux"],"title":"å¦‚ä½•é…ç½®ä¸€ä¸ªè·¨ linux å‘è¡Œç‰ˆè§£å‹å³ç”¨çš„ python è¿è¡Œç¯å¢ƒ(Portable Python)","uri":"/portable-python/"},{"categories":null,"content":"docker ç¬¬ä¸€ä¸ªæƒ³åˆ°çš„æ˜¯ docker. åŸºäº docker çš„å®¹å™¨ python è¿è¡Œç¯å¢ƒï¼Œdocker image ä¸­åŒ…å«æ‰€æœ‰çš„ python è¿è¡Œæ—¶ä¾èµ–ï¼ŒåŒ…æ‹¬ python ä»£ç åŠåŠ¨æ€åº“ï¼ˆåŒ…æ‹¬ glibcï¼‰ FROM python:3.9-slim as base FROM base as builder RUN mkdir /install WORKDIR /install COPY requirements.txt /requirements.txt RUN sed -E -i -e 's/deb.debian.org/mirrors.aliyun.com/g' -e 's/security.debian.org/mirrors.aliyun.com/g' /etc/apt/sources.list RUN apt update --allow-insecure-repositories \\ \u0026\u0026 apt install -y gcc python3.9-dev libffi-dev -y RUN pip install --no-cache-dir --trusted-host mirrors.aliyun.com --prefix=/install -r /requirements.txt # FROM gcr.io/distroless/python3 FROM base COPY --from=builder /install /usr/local WORKDIR /app COPY hello.py /app/ CMD [\"hello.py\", \"/etc\"] ä½†è¿™ç§æ–¹å¼ä¹Ÿæœ‰ç¼ºé™·ï¼Œdocker é‡‡ç”¨ namespace çš„æ–¹å¼å°† / ä¸ å®¿ä¸»æœºçš„ / éš”ç¦»å¼€ï¼Œå®¹å™¨å¦‚æœæœŸæœ›æ“ä½œå®¿ä¸»æœºçš„ systemd/crond ä¼šæ¯”è¾ƒå¤æ‚ï¼Œå¯èƒ½ä¼šéœ€è¦ docker run -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i sh ã€‚å¦å¤–ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ ssh å…å¯†æ“ä½œå®¿ä¸»æœº ï¼ˆssh root@hostip shï¼‰, åŒæ ·æ“ä½œå¤æ‚ã€‚ ","date":"2023-09-24","objectID":"/portable-python/:2:1","tags":["python","ops","portable","linux"],"title":"å¦‚ä½•é…ç½®ä¸€ä¸ªè·¨ linux å‘è¡Œç‰ˆè§£å‹å³ç”¨çš„ python è¿è¡Œç¯å¢ƒ(Portable Python)","uri":"/portable-python/"},{"categories":null,"content":"portable python æƒ³æ³•æ¥è‡ªäº golang, æ‰€æœ‰çš„ä¾èµ–éƒ½ä»¥é™æ€ç¼–è¯‘çš„æ–¹å¼ç¼–è¯‘åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå•æ–‡ä»¶å¤åˆ¶åˆ°å…¶ä»–æœºå™¨å³å¯è¿è¡Œï¼Œä¹‹å‰åœ¨é™æ€ç¼–è¯‘ chrony, åŸºäºè¿™ä¸ªæƒ³æ³•ï¼Œè°ƒç ”ä¸‹ python æœ‰æ²¡æœ‰ç±»ä¼¼çš„èƒ½åŠ›. å°†å¦‚ä¸‹å‘½ä»¤æ”¾åˆ° Dockerfile ä¸­ # Dockerfile FROM ubuntu:22.04 RUN sed -E -i -e 's/(archive|ports).ubuntu.com/mirrors.aliyun.com/g' -e '/security.ubuntu.com/d' /etc/apt/sources.list RUN apt-get update \u0026\u0026 \\ apt-get install -y --no-install-recommends ca-certificates zstd wget \u0026\u0026 \\ rm -rf /var/lib/apt/lists/* \u0026\u0026 \\ update-ca-certificates WORKDIR /opt/ ARG filename=cpython-3.10.13+20230826-x86_64-unknown-linux-gnu-debug-full RUN wget https://github.com/indygreg/python-build-standalone/releases/download/20230826/${filename}.tar.zst \\ \u0026\u0026 unzstd ${filename}.tar.zst \\ \u0026\u0026 mkdir -p portable \u0026\u0026 tar -xvf ${filename}.tar -C portable \\ \u0026\u0026 rm -rf ${filename}.tar.zst ${filename}.tar ENV PYTHON_HOME=/opt/portable/python/ RUN ${PYTHON_HOME}/install/bin/pip3 install --debug --verbose requests psycopg2-binary ansible -i https://pypi.tuna.tsinghua.edu.cn/simple ç”Ÿæˆçš„ python åŒ…çš„å‘½ä»¤ docker build -t portable-python:dev --build-arg HTTPS_PROXY=\"http://host.docker.internal:7890\" . docker run --rm -it -v \"$(pwd):/host\" --workdir=/opt/portable portable-python:dev tar -cvf /host/portable-python-3.10.13.tar python å½“å‰å·²ç»æµ‹è¯•è¿‡çš„æ“ä½œç³»ç»Ÿ: centos:7 ubuntu:20.04 ubuntu:22.04 rockylinux:8-minimal rockylinux:9-minimal openeuler:20.03-lts openeuler:22.03-lts æµ‹è¯•è¿‡çš„ pip åŒ…: requests psycopg2-binary ansible ","date":"2023-09-24","objectID":"/portable-python/:2:2","tags":["python","ops","portable","linux"],"title":"å¦‚ä½•é…ç½®ä¸€ä¸ªè·¨ linux å‘è¡Œç‰ˆè§£å‹å³ç”¨çš„ python è¿è¡Œç¯å¢ƒ(Portable Python)","uri":"/portable-python/"},{"categories":null,"content":"æ€»ç»“ TODO: è¿™é‡Œç¼ºä¸€ä¸ªæ€»ç»“ å¤„ç†é—®é¢˜çš„æ€è·¯å†³å®šäº†åšäº‹çš„æ•ˆç‡. ","date":"2023-09-24","objectID":"/portable-python/:3:0","tags":["python","ops","portable","linux"],"title":"å¦‚ä½•é…ç½®ä¸€ä¸ªè·¨ linux å‘è¡Œç‰ˆè§£å‹å³ç”¨çš„ python è¿è¡Œç¯å¢ƒ(Portable Python)","uri":"/portable-python/"},{"categories":null,"content":"å‚è€ƒ Keep These Portable Python Builds for Linux Always With You indygreg/python-build-standalone ","date":"2023-09-24","objectID":"/portable-python/:4:0","tags":["python","ops","portable","linux"],"title":"å¦‚ä½•é…ç½®ä¸€ä¸ªè·¨ linux å‘è¡Œç‰ˆè§£å‹å³ç”¨çš„ python è¿è¡Œç¯å¢ƒ(Portable Python)","uri":"/portable-python/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šè®°ä¸€æ¬¡ grpc çŸ­è¿æ¥æœªå…³é—­å¯¼è‡´çš„èµ„æºæ³„æ¼é—®é¢˜çš„æ’æŸ¥è¿‡ç¨‹ ","date":"2023-08-24","objectID":"/go-grpc-short-link-is-not-closed-causing-leak/:0:0","tags":["go","grpc","bug","å†…å­˜æ³„æ¼"],"title":"è®°ä¸€æ¬¡ grpc çŸ­è¿æ¥æœªå…³é—­å¯¼è‡´çš„èµ„æºæ³„æ¼é—®é¢˜çš„æ’æŸ¥è¿‡ç¨‹","uri":"/go-grpc-short-link-is-not-closed-causing-leak/"},{"categories":null,"content":"é—®é¢˜ç°è±¡ æ­£åœ¨æ¬¢å¿«çš„å†™ bug çš„æ—¶å€™ï¼Œæµ‹è¯•å¸ˆå‚…çªç„¶å‘¼å«æˆ‘è¯´ä¸€ä¸ªæµ‹è¯•ç¯å¢ƒçš„ cpu 90%+, å†…å­˜ 10GB(è¶…å‡ºé¢„æœŸå¤ªå¤š)ã€‚èµ¶ç´§ç™»å½•åˆ°æœºå™¨ä¸Šçœ‹ä¸‹ç°åœºã€‚ ","date":"2023-08-24","objectID":"/go-grpc-short-link-is-not-closed-causing-leak/:1:0","tags":["go","grpc","bug","å†…å­˜æ³„æ¼"],"title":"è®°ä¸€æ¬¡ grpc çŸ­è¿æ¥æœªå…³é—­å¯¼è‡´çš„èµ„æºæ³„æ¼é—®é¢˜çš„æ’æŸ¥è¿‡ç¨‹","uri":"/go-grpc-short-link-is-not-closed-causing-leak/"},{"categories":null,"content":"é—®é¢˜æ’æŸ¥è¿‡ç¨‹ é¦–å…ˆä½¿ç”¨ fgprof çœ‹ä¸‹å½“å‰æ¯”è¾ƒè€—æ—¶çš„ä»£ç é€»è¾‘åœ¨å“ªé‡Œï¼š export ENDPOINT=http://localhost:9699 go tool pprof -http=:8081 ${ENDPOINT}/debug/fgprof å›¾ä¸­å¯ä»¥çœ‹åˆ° grpc.Server ç›¸å…³çš„æ—¶é—´æ—¶é—´æ¯”è¾ƒå¤šã€‚æ­¤å›¾å¯ä»¥åæ˜ å‡ºæ…¢å¤„ç†è·¯å¾„ã€‚ä½†çœ‹åˆ° grpc server æ…¢ï¼Œä¸èƒ½åæ˜ å‡ºæ˜¯ grpc server å¤„ç†æ…¢ã€‚ å…¶æ¬¡çœ‹ profileï¼š go tool pprof -http=:8081 \"${ENDPOINT}/debug/pprof/profile?seconds=30\" æ­¤å›¾åæ˜ å‡ºä¸šåŠ¡å ç”¨ On-CPU æ—¶é—´ 37%ï¼Œåœ¨åŠªåŠ›æ¶ˆè´¹ kafka ä¸­çš„æ•°æ®ï¼› 30% cpu åœ¨æ‰§è¡Œ runtime.gcBgMarkWorkerï¼Œå…¶ä»–æ—¶é—´å æ¯”æ¯”è¾ƒå°‘ï¼Œå¯å¿½ç•¥ã€‚37%æ—¶é—´æ¶ˆè€—åœ¨æ¶ˆè´¹ kafka æ¶ˆæ¯ä¸­ï¼Œè¿™ä¸ªç¬¦åˆé¢„æœŸï¼Œè¿™ä¸ªä¸šåŠ¡ä¸»è¦åšæ¶ˆè´¹ kafka ä¸­çš„æ•°æ®ã€‚30% çš„ runtime.gcBgMarkWorker æ‰§è¡Œé€»è¾‘ä»åå­—å¯ä»¥çœ‹å‡ºï¼Œåœ¨æ‰§è¡Œ gc çš„é€»è¾‘ï¼›runtime.scanobject å ç”¨äº† 30%çš„æ—¶é—´ï¼Œå¤§é‡æ—¶é—´æ¶ˆè€—åœ¨ gc ä¸Šï¼ŒçŒœæµ‹æ˜¯æœ‰å†…å­˜æ³„æ¼. æŸ¥çœ‹ heapdump ä¸­çš„ inused_objectsï¼š go tool pprof -http=:8081 ${ENDPOINT}/debug/pprof/heap ä»å›¾ä¸­å¯ä»¥çœ‹åˆ° grpc.DialContext/grpc.(*addrConn).resetTransport å‡½æ•°æ‰§è¡Œè·¯å¾„åˆ†é…äº†è¿‡å¤šå†…å­˜ã€‚grpc.DialContext çš„ä½œç”¨æ˜¯åˆ›å»º grpc è¿æ¥ï¼Œgrpc.(*addrConn).resetTransport æ˜¯ http2 è¿æ¥ä¿æ´». æŸ¥çœ‹å½“å‰ goroutine stacktraceï¼Œå¤šå°‘å‡½æ•°è°ƒç”¨æ ˆåŒ…å« resetTransport å³è¡¨ç¤ºå½“å‰è¿›ç¨‹æœ‰å¤šå°‘ grpc è¿æ¥. ææ€–çš„ 20348ï¼Œå¹¶ä¸”åœ¨æŒç»­çš„å¢å¤§. é—®é¢˜å¯ä»¥å¤§èƒ†çŒœæµ‹ï¼Œç”±äº kafka æ¶ˆè´¹è¿‡ç¨‹ä¸­æ¯ä¸ªæ¶ˆæ¯æ‰§è¡Œä¸€æ¬¡ service.SendNoticeCallBack, æ¯æ¬¡æ‰ç”¨ grpc åˆ›å»ºè¿æ¥ rpcclient.NewMsgDogServiceGrpcClientï¼Œ è€Œæ²¡æœ‰å…³é—­è¿æ¥ï¼Œå¯¼è‡´å¤§é‡çš„è¿æ¥æŒç»­åå°ä¿æ´»ï¼Œgrpc è¿æ¥è¿‡å¤šå¯¹è±¡è¿‡å¤šå¯¼è‡´ gc æ—¶é—´è¿‡å¤šï¼Œå†…å­˜å ç”¨å¤šã€‚ åŸºäºè¿™ä¸ªå‡è®¾ï¼ŒæŸ¥çœ‹è¿™ä¸ªgrpcå®¢æˆ·ç«¯å¯¹åº”çš„æœåŠ¡ç«¯çš„è¿æ¥çŠ¶æ€: æœåŠ¡ç«¯è¿æ¥ä¹ŸåŸºæœ¬ä¸ä¸Šè¾¹çš„å®¢æˆ·ç«¯è¿æ¥æ•°å¯¹çš„ä¸Šã€‚ ","date":"2023-08-24","objectID":"/go-grpc-short-link-is-not-closed-causing-leak/:2:0","tags":["go","grpc","bug","å†…å­˜æ³„æ¼"],"title":"è®°ä¸€æ¬¡ grpc çŸ­è¿æ¥æœªå…³é—­å¯¼è‡´çš„èµ„æºæ³„æ¼é—®é¢˜çš„æ’æŸ¥è¿‡ç¨‹","uri":"/go-grpc-short-link-is-not-closed-causing-leak/"},{"categories":null,"content":"è§£å†³åŠæ³• å…ˆç®€å•æ‰“ä¸ª patchï¼Œæ‰¾åˆ° service.SendNoticeCallBack å‡½æ•°ï¼ŒæŠŠ rpcclient.NewMsgDogServiceGrpcClient è¿”å›çš„ grpc è¿æ¥åœ¨ä½¿ç”¨å®ŒååŠæ—¶å…³é—­ã€‚ é•¿æœŸè§£å†³åŠæ³•: å³grpcå¤ç”¨è¿æ¥ï¼Œåœ¨åˆå§‹åŒ–åº”ç”¨çš„æ—¶å€™åˆå§‹åŒ–ä¸€ä¸ª grpc è¿æ¥ï¼Œä½œä¸ºä¾èµ–ä¼ é€’ç»™æ­¤å‡½æ•°ï¼Œä½¿ç”¨çš„æ—¶å€™ç›´æ¥ä½¿ç”¨åˆ›å»ºå¥½çš„è¿æ¥æ‰ç”¨æœåŠ¡. ","date":"2023-08-24","objectID":"/go-grpc-short-link-is-not-closed-causing-leak/:3:0","tags":["go","grpc","bug","å†…å­˜æ³„æ¼"],"title":"è®°ä¸€æ¬¡ grpc çŸ­è¿æ¥æœªå…³é—­å¯¼è‡´çš„èµ„æºæ³„æ¼é—®é¢˜çš„æ’æŸ¥è¿‡ç¨‹","uri":"/go-grpc-short-link-is-not-closed-causing-leak/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼štcpdump å¯ä»¥æ”¶åˆ°åŒ…ï¼Œudp server æ— æ³•æ”¶åŒ…ï¼Œç®€å•çš„æ’æŸ¥è¿‡ç¨‹ ","date":"2023-03-09","objectID":"/udp-tcpdump-receive-pkg-sock-not/:0:0","tags":[],"title":"tcpdump å¯ä»¥æ”¶åˆ°åŒ…ï¼Œudp server æ— æ³•æ”¶åŒ…ï¼Œæœ€ç»ˆå‘ç°æ˜¯ uRPF çš„é”… DRAFT","uri":"/udp-tcpdump-receive-pkg-sock-not/"},{"categories":null,"content":"ç°è±¡ æˆ‘ä»¬çš„æŸæœºå™¨ä» 0.0.0.0:514/udp æ¥å—æ•°æ®ï¼Œip ä¸º 10.1.1.11/24 å’Œ 10.1.2.10/24.å¦ä¸€å°æœºå™¨ 10.1.1.10/24 å‘ 10.1.1.11/24 å‘é€ udp åŒ…ã€‚ machine1: 1. 10.1.1.10/24 machine2: 1. 10.1.2.10/24 2. 10.1.1.11/24 æˆ‘ä»¬ä½¿ç”¨ tcpdump æŸ¥çœ‹æ”¶åˆ°äº†æ•°æ®ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š tcpdump -i any host 10.1.1.10 and udp port 514 or icmp -X nstat -s -az | grep TcpExtIPReversePathFilter TcpExtIPReversePathFilter xxx 0.0 è€Œ machine1 514/udp æœåŠ¡æ²¡æœ‰æ”¶åˆ°æ•°æ®ã€‚ ","date":"2023-03-09","objectID":"/udp-tcpdump-receive-pkg-sock-not/:1:0","tags":[],"title":"tcpdump å¯ä»¥æ”¶åˆ°åŒ…ï¼Œudp server æ— æ³•æ”¶åŒ…ï¼Œæœ€ç»ˆå‘ç°æ˜¯ uRPF çš„é”… DRAFT","uri":"/udp-tcpdump-receive-pkg-sock-not/"},{"categories":null,"content":"å¦‚ä½•å¿«é€Ÿæ¢å¤çš„ ç»™ machine2 æœåŠ¡æ·»åŠ è·¯ç”±åï¼Œ ip route add 10.1.1.10/32 via 10.1.1.1 ","date":"2023-03-09","objectID":"/udp-tcpdump-receive-pkg-sock-not/:2:0","tags":[],"title":"tcpdump å¯ä»¥æ”¶åˆ°åŒ…ï¼Œudp server æ— æ³•æ”¶åŒ…ï¼Œæœ€ç»ˆå‘ç°æ˜¯ uRPF çš„é”… DRAFT","uri":"/udp-tcpdump-receive-pkg-sock-not/"},{"categories":null,"content":"åŸå›  TODO: æ‰¾åˆ°äº†å¤§è‡´æ–¹å‘ï¼Œå°è¯•å¤ç°éªŒè¯ä¸‹ é‡æ–°æ¢³ç† linux çš„å®ç°æœºåˆ¶ï¼Œåœ¨ è¿™é‡Œ æ‰¾åˆ°äº†ç±»ä¼¼çš„ç°è±¡ï¼Œæ— è·¯ç”± udp æ— æ³•æ”¶åŒ…ã€‚ è§£å†³åŠæ³•ï¼š sysctl net.ipv4.conf.all.rp_filter=0 sysctl net.ipv4.conf.eth0.rp_filter=0 ","date":"2023-03-09","objectID":"/udp-tcpdump-receive-pkg-sock-not/:3:0","tags":[],"title":"tcpdump å¯ä»¥æ”¶åˆ°åŒ…ï¼Œudp server æ— æ³•æ”¶åŒ…ï¼Œæœ€ç»ˆå‘ç°æ˜¯ uRPF çš„é”… DRAFT","uri":"/udp-tcpdump-receive-pkg-sock-not/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šä»‹ç»åœ¨ gitlab ä¸­ä½¿ç”¨ chatgpt åš code review çš„æ–¹æ³•å’Œä»£ç  æœ€è¿‘ chatgpt éå¸¸ç«æš´ï¼Œå®é™…ä½“éªŒæ„Ÿå—äº†ä¸€ä¸‹ï¼Œå…¶åœ¨ä½œä¸ºè¾…åŠ©å·¥å…·ä¸Šè¿˜æ˜¯å¯ä»¥ä½¿ç”¨çš„. å½“å‰ chatgpt apitoken æ¥å…¥åœ¨å›½å†…æ˜¯å¯ä»¥ç›´æ¥è®¿é—®çš„. ","date":"2023-02-28","objectID":"/gitlab-chatgpt-mr-code-review/:0:0","tags":["gitlab","devops","chatgpt","code_review"],"title":"åœ¨ gitlab ä¸­ä½¿ç”¨ chatgpt åš code review","uri":"/gitlab-chatgpt-mr-code-review/"},{"categories":null,"content":"å‡†å¤‡ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›é­”æ³•æ‰‹æ®µè·å¾—ä¸€ä¸ªè´¦å·ä»¥åŠç”Ÿæˆä¸€ä¸ª chatgpt çš„ apitoken. ","date":"2023-02-28","objectID":"/gitlab-chatgpt-mr-code-review/:1:0","tags":["gitlab","devops","chatgpt","code_review"],"title":"åœ¨ gitlab ä¸­ä½¿ç”¨ chatgpt åš code review","uri":"/gitlab-chatgpt-mr-code-review/"},{"categories":null,"content":"å½“å‰ä½¿ç”¨çš„ prompt Bellow is the code patch, please help me do a brief code review, if any bug risk and improvement suggestion are welcome %s é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šå¥½ç©æœ‰ç”¨çš„ prompt è§ è¿™é‡Œ ","date":"2023-02-28","objectID":"/gitlab-chatgpt-mr-code-review/:2:0","tags":["gitlab","devops","chatgpt","code_review"],"title":"åœ¨ gitlab ä¸­ä½¿ç”¨ chatgpt åš code review","uri":"/gitlab-chatgpt-mr-code-review/"},{"categories":null,"content":"å¼€å§‹åˆ¶ä½œ code review è„šæœ¬ CI ä¸­ä½¿ç”¨ chatgpt åš code review çš„ä¸»è¦å®ç°æ€è·¯æ˜¯: ä½¿ç”¨ git diff ç”Ÿæˆå½“å‰ mr çš„ patch å‘æˆ‘çš„åç«¯è½¬å‘æœåŠ¡å™¨å‘é€ patchï¼Œ è¿”å› code review çš„ç»“æœ å‘å½“å‰ mr åˆ›å»ºè¯„è®ºï¼Œè¯„è®ºå†…å®¹ä¸º code review çš„ç»“æœ å¦‚ä¸‹æ˜¯æˆ‘ä»¬è‡ªåŠ¨ code review è„šæœ¬,å…¶ä¸­ http://1.1.1.1:5151/ æ˜¯æˆ‘å¼€å‘çš„ä¸€ä¸ªåç«¯æœåŠ¡ï¼Œå°†çš„è¯·æ±‚ä»£ç†åˆ° chatgptä¸­. git fetch git diff origin/${CI_MERGE_REQUEST_TARGET_BRANCH_NAME:-\"main\"}...origin/${CI_COMMIT_REF_NAME} | tee mr.patch echo \"patch\" CHATBODY=$(jq --null-input --arg category \"code_review\" --arg prompt \"$(cat mr.patch)\" '{\"category\": $category, \"prompt\": $prompt}') echo \"code reviews\" curl -X 'POST' 'http://1.1.1.1:5151/api/v1/chat/conversation' -H 'accept: text/plain' -H 'Content-Type: application/json' -d \"${CHATBODY}\" | tee code_review.txt # echo \"comments\" NOTES=$(jq --null-input --arg body \"$(cat code_review.txt)\" '{\"body\": $body}') curl --location --request POST --header \"PRIVATE-TOKEN: $ADMIN_ACCESS_TOKEN\" --header \"Content-Type: application/json\" \"https://git.example.com/api/v4/projects/$CI_MERGE_REQUEST_PROJECT_ID/merge_requests/$CI_MERGE_REQUEST_IID/notes\" -d \"$NOTES\" -k å®é™…å‘é€çš„ prompt è§å¦‚ä¸‹: Bellow is the code patch, please help me do a brief code review, if any bug risk and improvement suggestion are welcome diff --git a/content/posts/ai/gitlab-chatgpt-mr-code-review.md b/content/posts/ai/gitlab-chatgpt-mr-code-review.md index 0f3a990..dab4d0b 100644 --- a/content/posts/ai/gitlab-chatgpt-mr-code-review.md +++ b/content/posts/ai/gitlab-chatgpt-mr-code-review.md @@ -18,6 +18,15 @@ date: 2023-02-28T08:50:33+08:00 é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›é­”æ³•æ‰‹æ®µè·å¾—ä¸€ä¸ªè´¦å·ä»¥åŠç”Ÿæˆä¸€ä¸ª chatgpt çš„ apitoken. +## å½“å‰ä½¿ç”¨çš„ prompt + +```txt +Bellow is the code patch, please help me do a brief code review, if any bug risk and improvement suggestion are welcome +%s +``` + +é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šå¥½ç©æœ‰ç”¨çš„ prompt è§ [è¿™é‡Œ](https://github.com/f/awesome-chatgpt-prompts) + ## å¼€å§‹åˆ¶ä½œ code review è„šæœ¬ CI ä¸­ä½¿ç”¨ chatgpt åš code review çš„ä¸»è¦å®ç°æ€è·¯æ˜¯: æˆ‘çš„ chatgpt code review è®¡åˆ’åœ¨æäº¤ mr ä»¥åŠ mr çš„æ¯æ¬¡ commit çš„æ—¶å€™æ‰§è¡Œã€‚ .gitlab.yaml æ–‡ä»¶éƒ¨åˆ†å†…å®¹å¦‚ä¸‹: chatgpt: stage: check image: alpine:edge script: - apk add git curl - ci/chatgpt.sh allow_failure: true rules: - if: $CI_PIPELINE_SOURCE == \"merge_request_event\" when: manual - when: never ","date":"2023-02-28","objectID":"/gitlab-chatgpt-mr-code-review/:3:0","tags":["gitlab","devops","chatgpt","code_review"],"title":"åœ¨ gitlab ä¸­ä½¿ç”¨ chatgpt åš code review","uri":"/gitlab-chatgpt-mr-code-review/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šubuntu 22.04 vagrant up Authentication failure. Retrying, vagrant ssh å¯ä»¥ç™»å½•è¿› vm é—®é¢˜å¤„ç† ","date":"2022-12-11","objectID":"/vagrant-authentication-failure-retrying/:0:0","tags":["Linux","vagrant","bugs"],"title":"vagrant up Authentication failure. Retrying","uri":"/vagrant-authentication-failure-retrying/"},{"categories":null,"content":"é—®é¢˜ç°è±¡ vagrant up ä¼šæŠ¥é”™ default: Warning: Authentication failure. Retrying.... $ vagrant init ubuntu/jammy64 # ubuntu 22.04 $ vagrant up Bringing machine 'default' up with 'virtualbox' provider... ==\u003e default: Importing base box 'rockylinux/9'... ==\u003e default: Matching MAC address for NAT networking... ==\u003e default: Checking if box 'rockylinux/9' version '1.0.0' is up to date... ==\u003e default: Setting the name of the VM: network_default_1670762466033_92955 ==\u003e default: Clearing any previously set network interfaces... ==\u003e default: Preparing network interfaces based on configuration... default: Adapter 1: nat ==\u003e default: Forwarding ports... default: 22 (guest) =\u003e 2222 (host) (adapter 1) ==\u003e default: Booting VM... ==\u003e default: Waiting for machine to boot. This may take a few minutes... default: SSH address: 127.0.0.1:2222 default: SSH username: vagrant default: SSH auth method: private key default: Warning: Authentication failure. Retrying... $ vagrant --debug up ... D, [2022-08-18T08:41:57.807561 #278356] DEBUG -- net.ssh.authentication.session[20120]: allowed methods: publickey D, [2022-08-18T08:41:57.807635 #278356] DEBUG -- net.ssh.authentication.methods.none[20134]: none failed D, [2022-08-18T08:41:57.807714 #278356] DEBUG -- net.ssh.authentication.session[20120]: trying publickey D, [2022-08-18T08:41:57.809423 #278356] DEBUG -- net.ssh.authentication.agent[20148]: connecting to ssh-agent D, [2022-08-18T08:41:57.809776 #278356] DEBUG -- net.ssh.authentication.agent[20148]: sending agent request 1 len 48 D, [2022-08-18T08:41:57.810239 #278356] DEBUG -- net.ssh.authentication.agent[20148]: received agent packet 5 len 1 D, [2022-08-18T08:41:57.810303 #278356] DEBUG -- net.ssh.authentication.agent[20148]: sending agent request 11 len 0 D, [2022-08-18T08:41:57.810656 #278356] DEBUG -- net.ssh.authentication.agent[20148]: received agent packet 12 len 841 D, [2022-08-18T08:41:57.811330 #278356] DEBUG -- net.ssh.authentication.methods.publickey[20170]: trying publickey (dd:3b:b8:2e:85:04:06:e9:ab:ff:a8:0a:c0:04:6e:d6) D, [2022-08-18T08:41:57.811474 #278356] DEBUG -- socket[2010c]: using encrypt-then-mac D, [2022-08-18T08:41:57.811624 #278356] DEBUG -- socket[2010c]: queueing packet nr 5 type 50 len 352 D, [2022-08-18T08:41:57.811724 #278356] DEBUG -- socket[2010c]: sent 420 bytes D, [2022-08-18T08:41:57.819401 #278356] DEBUG -- socket[2010c]: read 100 bytes D, [2022-08-18T08:41:57.819740 #278356] DEBUG -- socket[2010c]: received packet nr 5 type 51 len 32 D, [2022-08-18T08:41:57.819872 #278356] DEBUG -- net.ssh.authentication.session[20120]: allowed methods: publickey E, [2022-08-18T08:41:57.819952 #278356] ERROR -- net.ssh.authentication.session[20120]: all authorization methods failed (tried none, publickey) DEBUG ssh: == Net-SSH connection debug-level log END == INFO ssh: SSH not ready: #\u003cVagrant::Errors::SSHAuthenticationFailed: SSH authentication failed! This is typically caused by the public/private keypair for the SSH user not being properly set on the guest VM. Please verify that the guest VM is setup with the proper public key, and that the private key path for Vagrant is setup properly as well.\u003e ... vagrant ssh å¯ä»¥ç™»å½• $ journalctl -u sshd -f -n 1000 Dec 11 12:42:49 10.0.2.15 sshd[1466]: userauth_pubkey: key type ssh-rsa not in PubkeyAcceptedAlgorithms [preauth] Dec 11 12:42:49 10.0.2.15 sshd[1466]: Connection closed by authenticating user vagrant 10.0.2.2 port 58914 [preauth] Dec 11 12:42:49 10.0.2.15 sshd[1458]: pam_unix(sshd:session): session opened for user vagrant(uid=1000) by (uid=0) å¯ä»¥çœ‹åˆ°é”™è¯¯åŸå› æ˜¯ userauth_pubkey: key type ssh-rsa not in PubkeyAcceptedAlgorithms. ","date":"2022-12-11","objectID":"/vagrant-authentication-failure-retrying/:1:0","tags":["Linux","vagrant","bugs"],"title":"vagrant up Authentication failure. Retrying","uri":"/vagrant-authentication-failure-retrying/"},{"categories":null,"content":"å¤„ç†æ–¹æ³• ","date":"2022-12-11","objectID":"/vagrant-authentication-failure-retrying/:2:0","tags":["Linux","vagrant","bugs"],"title":"vagrant up Authentication failure. Retrying","uri":"/vagrant-authentication-failure-retrying/"},{"categories":null,"content":"ubuntu 22.04 éœ€è¦é¢„å…ˆå‡†å¤‡ä¸¤ä¸ª terminal: term1 å’Œ term2. # term1: vagrant up # æ‰§è¡Œå®Œååˆ‡æ¢åˆ° term2 # term2: vagrant ssh echo 'PubkeyAcceptedKeyTypes=+ssh-rsa' \u003e\u003e /etc/ssh/sshd_config systemctl restart sshd # term1 # å¯ä»¥çœ‹åˆ°æ—¥å¿—, å¯ä»¥çœ‹åˆ°é—®é¢˜å·²ç»è§£å†³äº† ==\u003e default: Booting VM... ==\u003e default: Waiting for machine to boot. This may take a few minutes... default: SSH address: 127.0.0.1:2222 default: SSH username: vagrant default: SSH auth method: private key default: Warning: Authentication failure. Retrying... default: Warning: Authentication failure. Retrying... default: Warning: Authentication failure. Retrying... default: default: Vagrant insecure key detected. Vagrant will automatically replace default: this with a newly generated keypair for better security. default: default: Inserting generated public key within guest... default: Removing insecure key from the guest if it's present... default: Key inserted! Disconnecting and reconnecting using new SSH key... ==\u003e default: Machine booted and ready! ==\u003e default: Checking for guest additions in VM... ==\u003e default: Mounting shared folders... default: /vagrant =\u003e /Volumes/code/ ","date":"2022-12-11","objectID":"/vagrant-authentication-failure-retrying/:2:1","tags":["Linux","vagrant","bugs"],"title":"vagrant up Authentication failure. Retrying","uri":"/vagrant-authentication-failure-retrying/"},{"categories":null,"content":"rocylinux 9 update-crypto-policies --set LEGACY ","date":"2022-12-11","objectID":"/vagrant-authentication-failure-retrying/:2:2","tags":["Linux","vagrant","bugs"],"title":"vagrant up Authentication failure. Retrying","uri":"/vagrant-authentication-failure-retrying/"},{"categories":null,"content":"åŸå›  TODO https://github.com/hashicorp/vagrant/issues/12840 https://bugzilla.redhat.com/show_bug.cgi?id=2061607 https://bbs.archlinux.org/viewtopic.php?id=270005 ","date":"2022-12-11","objectID":"/vagrant-authentication-failure-retrying/:3:0","tags":["Linux","vagrant","bugs"],"title":"vagrant up Authentication failure. Retrying","uri":"/vagrant-authentication-failure-retrying/"},{"categories":null,"content":"æ€»ç»“ TODO ","date":"2022-12-11","objectID":"/vagrant-authentication-failure-retrying/:4:0","tags":["Linux","vagrant","bugs"],"title":"vagrant up Authentication failure. Retrying","uri":"/vagrant-authentication-failure-retrying/"},{"categories":null,"content":"ref network_configuration ","date":"2022-12-11","objectID":"/vagrant-authentication-failure-retrying/:5:0","tags":["Linux","vagrant","bugs"],"title":"vagrant up Authentication failure. Retrying","uri":"/vagrant-authentication-failure-retrying/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šchrony é™æ€ç¼–è¯‘åŠè·¨æ“ä½œç³»ç»Ÿå®‰è£… systemd service ","date":"2022-11-26","objectID":"/static-build-chrony/:0:0","tags":["Linux","ops","é™æ€ç¼–è¯‘"],"title":"chrony é™æ€ç¼–è¯‘åŠè·¨ Linux å‘è¡Œç‰ˆå®‰è£… systemd service","uri":"/static-build-chrony/"},{"categories":null,"content":"æ›´æ–° åŸºäº ubuntu çš„é•œåƒç¼–è¯‘å‡ºçš„ chronyc åœ¨ centos7.9 ä¸‹æ‰§è¡Œ chronyc sources -v ä¼š Segmentation fault, åˆæ­¥æ–­å®šæ˜¯ç”±äº glibc é™æ€ç¼–è¯‘æ—¶æœ‰éƒ¨åˆ†åŠ¨æ€ä¾èµ–çš„ wake link è¢«ä½¿ç”¨åˆ°å¯¼è‡´çš„ã€‚æ›¿æ¢æˆåŸºäº alpine çš„ musl å³å¯è§£å†³é—®é¢˜. FROM alpine:edge as build ARG branch=4.2 ENV DEBIAN_FRONTEND noninteractive RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g' /etc/apk/repositories WORKDIR /opt # COPY chrony . # äºŒé€‰ä¸€ RUN apk add build-base libcap-dev texinfo nettle-dev gnutls-dev bash wget tar gcc make \\ \u0026\u0026 wget https://download.tuxfamily.org/chrony/chrony-${branch}.tar.gz \\ \u0026\u0026 tar zxf chrony-${branch}.tar.gz \\ \u0026\u0026 mv chrony-${branch} chrony \\ \u0026\u0026 rm -f chrony-${branch}.tar.gz RUN cd chrony; \\ CFLAGS='-static -g' LDFLAGS='-static -lm' \\ ./configure \\ --enable-scfilter \\ --enable-ntp-signd \\ \u0026\u0026 make; echo $?; \\ mkdir -p /install_root; \\ make DESTDIR=/install_root install \\ \u0026\u0026 find /install_root RUN rm -rf /install_root/usr/local/share \\ \u0026\u0026 rmdir /install_root/var/lib/chrony/ /install_root/etc FROM scratch AS bin COPY --from=build /install_root / ","date":"2022-11-26","objectID":"/static-build-chrony/:1:0","tags":["Linux","ops","é™æ€ç¼–è¯‘"],"title":"chrony é™æ€ç¼–è¯‘åŠè·¨ Linux å‘è¡Œç‰ˆå®‰è£… systemd service","uri":"/static-build-chrony/"},{"categories":null,"content":"æ­£æ–‡ æœ€è¿‘ä¸€æ®µæ—¶é—´åšçš„éœ€æ±‚ä¸»è¦æ˜¯é€‚é… kylinsec å›½äº§åŒ–æ“ä½œç³»ç»Ÿ. å› ä¸ºäº§å“æ˜¯ tob ç§æœ‰åŒ–éƒ¨ç½² k8s é›†ç¾¤ï¼Œå¹¶ä¸”å¤šæœºå™¨éœ€è¦åŒæ­¥æ—¶é—´ã€‚ç»è¿‡è°ƒç ”åå‘ç° chrony å·²ç»ä½œä¸º redhat 8 ç­‰å¤šç§å‘è¡Œç‰ˆçš„é»˜è®¤é€‰é¡¹ï¼Œå†³å®šç»Ÿä¸€ä½¿ç”¨ chrony ä½œä¸ºæˆ‘ä»¬çš„æ—¶é—´åŒæ­¥ daemon. åº”ç”¨çš„è‡ªåŠ¨åŒ–éƒ¨ç½²æ–¹æ¡ˆä½¿ç”¨äº† ansibleï¼Œä¸åŒ Linux å‘è¡Œç‰ˆè½¯ä»¶åŒ…ä¸ç›¸åŒï¼Œæ‰€ä»¥é€‚é…ä¸€ç§ Linux å‘è¡Œç‰ˆï¼Œå°±éœ€è¦ä¸ºè¿™ç§ Linux å‘è¡Œç‰ˆä¸‹è½½å¯¹åº”è½¯ä»¶åŒ…ã€‚æ¯”å¦‚ chrony åœ¨ centos 7/8/9, ubuntu 20.04/18.04, kylinsec â€¦ ç­‰éƒ½éœ€è¦å•ç‹¬ä¸‹è½½ä¸€é chrony å®‰è£…åŒ…ï¼Œæ•´ä½“æ€»å…±é€‚é…äº† 6 éï¼Œååˆ†éº»çƒ¦ã€‚å½“éœ€è¦é€‚é…çš„è½¯ä»¶åŒ…æ›´å¤šåï¼Œæˆæœ¬å°±å‡¸æ˜¾å‡ºæ¥äº†. å¯ä»¥é€‰æ‹©é™æ€ç¼–è¯‘ï¼ŒæŠ¹å¹³å„å‘è¡Œç‰ˆçš„å·®å¼‚ï¼Œä¸€æ¬¡æå®šã€‚ è¿˜å¥½ï¼Œé™æ€ç¼–è¯‘çš„å·¥ä½œå·²ç»æœ‰å¤§ä½¬åšè¿‡äº†é™æ€ç¼–è¯‘ chrony, dockerfile å¦‚ä¸‹ # docker buildx build -f Dockerfile.chrony --platform linux/amd64 --target bin --output installer FROM ubuntu:20.04 as build ARG branch=4.2 ENV DEBIAN_FRONTEND noninteractive RUN sed -ri 's/(ports|deb|security|archive).(debian.org|ubuntu.com)/mirrors.tuna.tsinghua.edu.cn/g' /etc/apt/sources.list \\ \u0026\u0026 apt-get update WORKDIR /opt # COPY chrony . # äºŒé€‰ä¸€ #RUN apt-get install -y git \u0026\u0026 git clone --branch ${branch} https://git.tuxfamily.org/chrony/chrony.git RUN apt-get install -y wget \u0026\u0026 wget https://download.tuxfamily.org/chrony/chrony-${branch}.tar.gz \\ \u0026\u0026 tar zxf chrony-${branch}.tar.gz \\ \u0026\u0026 mv chrony-${branch} chrony \\ \u0026\u0026 rm -f chrony-${branch}.tar.gz RUN apt-get install -y \\ bison asciidoctor \\ gcc \\ make \\ pkg-config \\ libcap-dev \\ pps-tools \\ libedit-dev \\ nettle-dev \\ libnss3-dev \\ libtomcrypt-dev \\ libgnutls28-dev \\ libseccomp-dev RUN cd chrony; \\ CFLAGS='-static -s' LDFLAGS='-static -lm' \\ ./configure \\ --enable-scfilter \\ --enable-ntp-signd \\ \u0026\u0026 make; echo $?; \\ mkdir -p /install_root; \\ make DESTDIR=/install_root install \\ \u0026\u0026 find /install_root RUN rm -rf /install_root/usr/local/share \\ \u0026\u0026 rmdir /install_root/var/lib/chrony/ /install_root/etc FROM scratch AS bin COPY --from=build /install_root / buildx ä¸€æ­¥ç¼–è¯‘å‡ºè½¯ä»¶åŒ… docker buildx build -f Dockerfile.chrony --platform linux/amd64 --target bin --output installer file installer/{usr/local/bin/chronyc,usr/local/sbin/chronyd} installer/usr/local/bin/chronyc: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, BuildID[sha1]=a8851c783b1074f3414d8b38bb337cb10a8b016d, for GNU/Linux 3.2.0, stripped installer/usr/local/sbin/chronyd: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, BuildID[sha1]=a7ed52ca561252969d5e0f29b8894380b70bd8c5, for GNU/Linux 3.2.0, stripped # å¤šå¹³å°ç¼–è¯‘ docker buildx build . --platform linux/amd64,linux/arm64 --target bin --output installer ","date":"2022-11-26","objectID":"/static-build-chrony/:2:0","tags":["Linux","ops","é™æ€ç¼–è¯‘"],"title":"chrony é™æ€ç¼–è¯‘åŠè·¨ Linux å‘è¡Œç‰ˆå®‰è£… systemd service","uri":"/static-build-chrony/"},{"categories":null,"content":"æœ‰äº†äºŒè¿›åˆ¶æ–‡ä»¶è¯¥å¦‚ä½•éƒ¨ç½²æœåŠ¡å‘¢ï¼Ÿ å¦‚ä¸‹æ˜¯å†™å¥½çš„ systemd service æ–‡ä»¶ cat \u003c\u003cEOF \u003e/etc/chrony.conf # Generated by TODO # Use public servers from the pool.ntp.org project. # Please consider joining the pool (http://www.pool.ntp.org/join.html). server pool.ntp.org iburst driftfile /var/lib/chrony/drift makestep 1.0 3 # Enable kernel synchronization of the real-time clock (RTC). rtcsync allow 0.0.0.0/0 local stratum 10 logdir /var/log/chrony log measurements statistics tracking EOF cat \u003c\u003cEOF \u003e/etc/chrony.keys # This file is solely used for NTP authentication with symmetric keys # as defined by RFC 1305 and RFC 5905. # # It can contain ID/key pairs which can be generated using the â€œkeygenâ€ option # from â€œchronycâ€; for example: # chronyc keygen 1 SHA256 256 \u003e\u003e /etc/chrony/chrony.keys # would generate a 256-bit SHA-256 key using ID 1. # # A list of supported hash functions and output encoding is available by # consulting the \"keyfile\" directive in the chrony.conf(5) man page. EOF cat \u003c\u003cEOF \u003e/etc/systemd/system/chrony.service [Unit] Description=chrony, an NTP client/server Documentation=man:chronyd(8) man:chronyc(1) man:chrony.conf(5) Conflicts=openntpd.service ntp.service ntpsec.service systemd-timesyncd.service Wants=time-sync.target Before=time-sync.target After=network.target # ConditionCapability=CAP_SYS_TIME [Service] # Type=forking # PIDFile=/run/chronyd.pid # EnvironmentFile=-/etc/default/chrony # Starter takes care of special cases mostly for containers ExecStart=/usr/sbin/chronyd -F -0 -d -f /etc/chrony.conf PrivateTmp=yes ProtectHome=yes ProtectSystem=full [Install] Alias=chronyd.service WantedBy=multi-user.target EOF systemctl enable --now chrony ","date":"2022-11-26","objectID":"/static-build-chrony/:3:0","tags":["Linux","ops","é™æ€ç¼–è¯‘"],"title":"chrony é™æ€ç¼–è¯‘åŠè·¨ Linux å‘è¡Œç‰ˆå®‰è£… systemd service","uri":"/static-build-chrony/"},{"categories":null,"content":"åˆ°è¿™é‡Œå°±å¯ä»¥äº†å—ï¼Ÿ å½“æˆ‘ä»¬æ‰§è¡Œ timedatectl set-ntp off å, chronyd æœåŠ¡å¹¶æ²¡æœ‰æŒ‰ç…§é¢„æœŸåœæ­¢æ—¶é—´åŒæ­¥ã€‚æ ¹æ®æ–‡æ¡£ timedated , å‘½ä»¤ timedatectl set-ntp off ä¼šå¯åŠ¨æˆ–åœæ­¢ systemd-timedated.service; æ–‡æ¡£ systemd-timedated.service æè¿°, systemd-timedated.service ä¼šä» /usr/lib/systemd/ntp-units.d/50-chronyd.list æ–‡ä»¶ä¸­å¯åœç³»ç»Ÿæ—¶é—´åŒæ­¥æœåŠ¡ã€‚å½“å‰ä½¿ç”¨çš„æ—¶é—´æœåŠ¡æ˜¯ chronyï¼Œéœ€è¦è¦†ç›–æ–‡ä»¶/usr/lib/systemd/ntp-units.d/50-chronyd.listä¸­çš„å€¼ï¼Œä½¿å¾— timedatectl set-ntp off èƒ½å¤ŸæŒ‰ç…§é¢„æœŸå¯åœæ—¶é—´åŒæ­¥. echo 'chrony.service' \u003e/usr/lib/systemd/ntp-units.d/50-chronyd.list åˆ°è¿™é‡Œï¼Œchrony æ­£å¼å·¥ä½œäº†. ","date":"2022-11-26","objectID":"/static-build-chrony/:4:0","tags":["Linux","ops","é™æ€ç¼–è¯‘"],"title":"chrony é™æ€ç¼–è¯‘åŠè·¨ Linux å‘è¡Œç‰ˆå®‰è£… systemd service","uri":"/static-build-chrony/"},{"categories":null,"content":"å®‰è£… chrony service çš„å®Œæ•´è„šæœ¬ #!/usr/bin/env bash set -o errtrace set -o errexit set -o nounset set -o pipefail set -o xtrace cd $(dirname \"$0\") if [[ $EUID -ne 0 ]]; then echo \"This script must be run as root\" exit 1 fi DIR=$(dirname $(realpath $0)) install_chrony() { systemctl stop chrony || true systemctl disable chrony || true # å‘å‰å…¼å®¹ ubuntu 20.04 ä¸­å¯èƒ½ä¼šå®‰è£…æœ‰ chrony systemctl stop chronyd || true systemctl disable chronyd || true # ubuntu 20.04 ä¸­ä¼šæœ‰æ­¤æœåŠ¡ systemctl stop systemd-timesyncd || true systemctl disable systemd-timesyncd || true chown root:root /var/run/chrony || true # for chrony logdir on ubuntu rm -rf /var/log/chrony mkdir -p /var/log/chrony mkdir -p /var/lib/chrony/ mkdir -p /etc/chrony/ # ubuntu é»˜è®¤çš„é…ç½®æ–‡ä»¶ä½ç½®æ˜¯ /etc/chrony/chrony.conf # centos7 é»˜è®¤çš„é…ç½®æ–‡ä»¶ä½ç½®æ˜¯ /etc/chrony.conf test -f \"/etc/chrony/chrony.conf\" \u0026\u0026 mv /etc/chrony/chrony.conf /etc/chrony/chrony.conf.$(date \"+%Y-%m-%d_%H%M%S\").bak test -f /etc/chrony.conf \u0026\u0026 mv /etc/chrony.conf /etc/chrony.conf.$(date \"+%Y-%m-%d_%H%M%S\").bak ln -s -f /etc/chrony.conf /etc/chrony/chrony.conf cat \u003c\u003cEOF \u003e/etc/chrony.conf # Generated by TODO # Use public servers from the pool.ntp.org project. # Please consider joining the pool (http://www.pool.ntp.org/join.html). server pool.ntp.org iburst driftfile /var/lib/chrony/drift makestep 1.0 3 # Enable kernel synchronization of the real-time clock (RTC). rtcsync allow 0.0.0.0/0 local stratum 10 logdir /var/log/chrony log measurements statistics tracking EOF cat \u003c\u003cEOF \u003e/etc/chrony.keys # This file is solely used for NTP authentication with symmetric keys # as defined by RFC 1305 and RFC 5905. # # It can contain ID/key pairs which can be generated using the â€œkeygenâ€ option # from â€œchronycâ€; for example: # chronyc keygen 1 SHA256 256 \u003e\u003e /etc/chrony/chrony.keys # would generate a 256-bit SHA-256 key using ID 1. # # A list of supported hash functions and output encoding is available by # consulting the \"keyfile\" directive in the chrony.conf(5) man page. EOF cat \u003c\u003cEOF \u003e/etc/systemd/system/chrony.service [Unit] Description=chrony, an NTP client/server Documentation=man:chronyd(8) man:chronyc(1) man:chrony.conf(5) Conflicts=openntpd.service ntp.service ntpsec.service systemd-timesyncd.service Wants=time-sync.target Before=time-sync.target After=network.target # ConditionCapability=CAP_SYS_TIME [Service] # Type=forking # PIDFile=/run/chronyd.pid # EnvironmentFile=-/etc/default/chrony # Starter takes care of special cases mostly for containers ExecStart=/usr/sbin/chronyd -F -1 -d -f /etc/chrony.conf PrivateTmp=yes ProtectHome=yes ProtectSystem=full [Install] Alias=chronyd.service WantedBy=multi-user.target EOF cp usr/local/sbin/chronyd /usr/sbin/chronyd cp usr/local/bin/chronyc /usr/bin/chronyc # timedatectl set-ntp off ä¼šè§¦å‘ # http://www.freedesktop.org/wiki/Software/systemd/timedated # systemctl status systemd-timedated # https://www.freedesktop.org/software/systemd/man/systemd-timedated.service.html# # STEP: centos7.9 ls /usr/lib/systemd/ntp-units.d/ echo 'chrony.service' \u003e/usr/lib/systemd/ntp-units.d/50-chronyd.list || true # /usr/sbin/chronyd -f /etc/chrony/chrony.conf -d -R systemctl enable --now chrony || true systemctl restart chrony } install_chrony ","date":"2022-11-26","objectID":"/static-build-chrony/:5:0","tags":["Linux","ops","é™æ€ç¼–è¯‘"],"title":"chrony é™æ€ç¼–è¯‘åŠè·¨ Linux å‘è¡Œç‰ˆå®‰è£… systemd service","uri":"/static-build-chrony/"},{"categories":null,"content":"å‚è€ƒ chrony é™æ€ç¼–è¯‘ chrony æ–‡æ¡£ timedated æ–‡æ¡£ systemd-timedated.service ","date":"2022-11-26","objectID":"/static-build-chrony/:6:0","tags":["Linux","ops","é™æ€ç¼–è¯‘"],"title":"chrony é™æ€ç¼–è¯‘åŠè·¨ Linux å‘è¡Œç‰ˆå®‰è£… systemd service","uri":"/static-build-chrony/"},{"categories":null,"content":"gorm no valid transactions ","date":"2022-09-15","objectID":"/go-jinzhu-gorm-no-valid-transactions/:0:0","tags":["db","gorm","go","bugs"],"title":"golang jinzhu/gorm no valid transactions","uri":"/go-jinzhu-gorm-no-valid-transactions/"},{"categories":null,"content":"ç°è±¡ poc: package main import ( \"fmt\" \"github.com/jinzhu/gorm\" _ \"github.com/jinzhu/gorm/dialects/postgres\" ) var db *gorm.DB // A is just a demo table. type A struct{ Val string } func init() { var err error db, err = gorm.Open(\"postgres\", \"postgres://postgres:postgres@localhost?sslmode=disable\") if err != nil { panic(err) } db.LogMode(true) } func main() { panicOnDBErr(db.DropTableIfExists(\u0026A{})) panicOnDBErr(db.AutoMigrate(\u0026A{})) panicOnDBErr(db.Begin()) panicOnDBErr(db.Create(\u0026A{\"test\"})) panicOnDBErr(db.Rollback()) // panic here var list []A panicOnDBErr(db.Find(\u0026list)) fmt.Println(\u0026list) } func panicOnDBErr(db *gorm.DB) { panicOnErr(db.Error) } func panicOnErr(err error) { if err != nil { panic(err) } } (main.go:26) [2017-12-02 14:30:56] [49.42ms] DROP TABLE \"as\" [0 rows affected or returned ] (main.go:27) [2017-12-02 14:30:56] [40.77ms] CREATE TABLE \"as\" (\"val\" text ) [0 rows affected or returned ] (main.go:31) [2017-12-02 14:30:56] [0.51ms] INSERT INTO \"as\" (\"val\") VALUES ('test') RETURNING \"as\".* [1 rows affected or returned ] (main.go:33) [2017-12-02 14:30:56] no valid transaction panic: no valid transaction goroutine 1 [running]: main.panicOnErr(0x850c20, 0xc4201324e0) main.go:47 +0x4a main.panicOnDBErr(0xc420180000) main.go:42 +0x38 main.main() main.go:33 +0x1a8 exit status 2 ","date":"2022-09-15","objectID":"/go-jinzhu-gorm-no-valid-transactions/:1:0","tags":["db","gorm","go","bugs"],"title":"golang jinzhu/gorm no valid transactions","uri":"/go-jinzhu-gorm-no-valid-transactions/"},{"categories":null,"content":"é—®é¢˜å‡ºç°åŸå› åŠè§£å†³æ–¹æ³• é—®é¢˜åŸå› ï¼šdb.Begin() ä¼šå°† db å¯¹è±¡é”å®šåœ¨ä¸€ä¸ªæ•°æ®åº“è¿æ¥ä¸­ï¼Œå½“ rollback åï¼Œå½“å‰æ•°æ®åº“è¿æ¥å·²ç»ä¸å¯ç”¨äº†ã€‚ è§£å†³æ–¹æ³•ï¼šdb.Begin() ä¹‹å‰ï¼Œclone ä¸€ä¸ª db ç¤ºä¾‹ï¼Œç”¨ clone å‡ºçš„ newDB å®ä¾‹æ‰§è¡Œ newDB.Begin(), ä¿è¯ db å˜é‡ä¸­çš„çŠ¶æ€å§‹ç»ˆæ˜¯çŠ¶æ€å¥åº·çš„. ","date":"2022-09-15","objectID":"/go-jinzhu-gorm-no-valid-transactions/:2:0","tags":["db","gorm","go","bugs"],"title":"golang jinzhu/gorm no valid transactions","uri":"/go-jinzhu-gorm-no-valid-transactions/"},{"categories":null,"content":"references gorm issue/1699 ","date":"2022-09-15","objectID":"/go-jinzhu-gorm-no-valid-transactions/:3:0","tags":["db","gorm","go","bugs"],"title":"golang jinzhu/gorm no valid transactions","uri":"/go-jinzhu-gorm-no-valid-transactions/"},{"categories":null,"content":"Sarama go-metrics.newExpDecaySampleHeap å ç”¨å¤§é‡å†…å­˜ ","date":"2022-09-15","objectID":"/go-sarama-metrics-spend-too-much-mem/:0:0","tags":["db"],"title":"Sarama go-metrics.newExpDecaySampleHeap å ç”¨å¤§é‡å†…å­˜é—®é¢˜å¤„ç†","uri":"/go-sarama-metrics-spend-too-much-mem/"},{"categories":null,"content":"é—®é¢˜ç°è±¡ å†…å­˜æ³„æ¼ï¼Œ ","date":"2022-09-15","objectID":"/go-sarama-metrics-spend-too-much-mem/:1:0","tags":["db"],"title":"Sarama go-metrics.newExpDecaySampleHeap å ç”¨å¤§é‡å†…å­˜é—®é¢˜å¤„ç†","uri":"/go-sarama-metrics-spend-too-much-mem/"},{"categories":null,"content":"references issues/1321 Memory leak when using metrics A way to stop meter rcrowley/go-metrics/meter.go#L37 ä»£ç  ","date":"2022-09-15","objectID":"/go-sarama-metrics-spend-too-much-mem/:2:0","tags":["db"],"title":"Sarama go-metrics.newExpDecaySampleHeap å ç”¨å¤§é‡å†…å­˜é—®é¢˜å¤„ç†","uri":"/go-sarama-metrics-spend-too-much-mem/"},{"categories":null,"content":"Postgres å†…éƒ¨å·¥ä½œæœºåˆ¶ ä»‹ç» TODO: Postgres ä»‹ç» Database å’Œ Tables ä¸€ä¸ª Postgres server ä¸­ä¼šæœ‰å¤šä¸ª databaseï¼Œæ¯ä¸ª database ä¸­ä¼šæœ‰å¤šå¼  tableï¼Œæ¯ä¸ª table ä¸­ä¼šæœ‰å¤šæ¡æ•°æ®è®°å½• (tuple), æ¯ä¸ªæ•°æ®è®°å½•ä¼šæœ‰å¤šä¸ªå­—æ®µã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ¯ä¸ª database ä¸­è¿˜ä¼šæœ‰å¾ˆå¤šå…¶ä»–è¢«ç®¡ç†çš„å¯¹è±¡. æ¯ä¸ªæ•°æ®åº“å¯¹è±¡éƒ½æœ‰å”¯ä¸€çš„ OID, å„æ•°æ®åº“å¯¹è±¡è¢«ä¿å­˜åœ¨å„è‡ªçš„ system catalogs ä¸­. ä¾‹å¦‚ database å’Œ heap tuple è¢«ä¿å­˜åœ¨ pg_database å’Œ pg_class ä¸­, å¯ä»¥é€šè¿‡å¦‚ä¸‹ sql æŸ¥è¯¢åˆ° postgres=# select datname, oid from pg_database where datname = 'postgres'; postgres | 5 postgres=# select relname, oid from pg_class where relname='actor'; actor | 16475 ","date":"2022-09-14","objectID":"/postgres-internal/:0:0","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"ç‰©ç†ç»“æ„ å½“å‰æˆ‘ä»¬ä»‹ç»æ–‡ä»¶ç›®å½•å­˜å‚¨ç»“æ„ã€‚ Postgres çš„ä¸€ä¸ªæ•°æ®åº“å®ä¾‹çš„æ•°æ®å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ PGDATA ä¸­ï¼Œé€šå¸¸ PGDATA çš„å€¼ä¸º /var/lib/pgsql/dataã€‚åŒä¸€å°æœºå™¨ä¸­å¯ä»¥éƒ¨ç½²å¤šä¸ª Postgres æœåŠ¡å®ä¾‹ï¼Œä¸åŒçš„æœåŠ¡å®ä¾‹ä½¿ç”¨ä¸åŒçš„ PGDATA ä»¥åŠä¸åŒçš„ç«¯å£. PGDATA å­ç›®å½•ä¸‹åŒ…å«æ•°æ®åº“æ§åˆ¶é…ç½®æ–‡ä»¶åŠæ•°æ®æ–‡ä»¶ã€‚æ§åˆ¶æ•°æ®åº“æœåŠ¡å®ä¾‹è¿è¡Œçš„é…ç½®æ–‡ä»¶ postgresql.confã€pg_hba.conf å’Œ pg_ident.conf é€šå¸¸æƒ…å†µä¸‹ä¹Ÿå­˜å‚¨åœ¨ PGDATA ä¸­ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒä»¬æ”¾åˆ°å…¶ä»–çš„åœ°æ–¹(å…·ä½“å¯ä»¥çœ‹ postgres å‘½ä»¤çš„å¯åŠ¨å‚æ•°æˆ–è€… pg_ctl çš„å¯åŠ¨å‚æ•°) PGDATA ä¸­çš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹: # tree -L 2 $PGDATA . â”œâ”€â”€ PG_VERSION â”œâ”€â”€ base â”‚ â”œâ”€â”€ 1 â”‚ â””â”€â”€ pgsql_tmp â”œâ”€â”€ global â”‚ â”œâ”€â”€ 1213 â”‚ â”œâ”€â”€ 1213_fsm â”‚ â”œâ”€â”€ 1213_vm â”‚ â”œâ”€â”€ pg_control â”‚ â”œâ”€â”€ pg_filenode.map â”‚ â””â”€â”€ pg_internal.init â”œâ”€â”€ pg_commit_ts â”œâ”€â”€ pg_dynshmem â”œâ”€â”€ pg_hba.conf â”œâ”€â”€ pg_ident.conf â”œâ”€â”€ pg_logical â”‚ â”œâ”€â”€ mappings â”‚ â”œâ”€â”€ replorigin_checkpoint â”‚ â””â”€â”€ snapshots â”œâ”€â”€ pg_multixact â”‚ â”œâ”€â”€ members â”‚ â””â”€â”€ offsets â”œâ”€â”€ pg_notify â”œâ”€â”€ pg_replslot â”œâ”€â”€ pg_serial â”œâ”€â”€ pg_snapshots â”œâ”€â”€ pg_stat â”œâ”€â”€ pg_stat_tmp â”œâ”€â”€ pg_subtrans â”‚ â””â”€â”€ 0000 â”œâ”€â”€ pg_tblspc â”œâ”€â”€ pg_twophase â”œâ”€â”€ pg_wal â”‚ â”œâ”€â”€ 000000010000000000000004 â”‚ â”œâ”€â”€ 000000010000000000000005 â”‚ â””â”€â”€ archive_status â”œâ”€â”€ pg_xact â”‚ â””â”€â”€ 0000 â”œâ”€â”€ postgresql.auto.conf â”œâ”€â”€ postgresql.conf â”œâ”€â”€ postmaster.opts â””â”€â”€ postmaster.pid https://www.postgresql.org/docs/devel/storage-file-layout.html Item Description PG_VERSION PostgreSQL ä¸»è¦ç‰ˆæœ¬å·çš„æ–‡ä»¶ base æ¯ä¸ªæ•°æ®åº“çš„å­ç›®å½• global ç³»ç»Ÿè¡¨, æ¯”å¦‚ pg_database pg_commit_ts äº‹åŠ¡æäº¤æ—¶é—´æˆ³æ•°æ®, Version 9.5 or later. pg_dynshmem dynamic shared memory subsystem ä½¿ç”¨çš„æ–‡ä»¶, Version 9.4 or later. pg_logical status data for logical decoding pg_multixact multitransaction status data (used for shared row locks) pg_notify LISTEN/NOTIFY status data pg_replslot replication slot data pg_serial information about committed serializable transactions pg_snapshots exported snapshots pg_stat permanent files for the statistics subsystem pg_stat_tmp temporary files for the statistics subsystem pg_subtrans subtransaction status data pg_tblspc symbolic links to tablespaces pg_twophase state files for prepared transactions pg_wal WAL (Write Ahead Log) files. It is renamed from pg_xlog in Version 10. pg_xact transaction commit status data, It is renamed from pg_clog in Version 10. postgresql.auto.conf A file used for storing configuration parameters that are set by ALTER SYSTEM postmaster.opts A file recording the command-line options the server was last started with postmaster.pid A lock file recording the current postmaster process ID (PID), cluster data directory path, postmaster start timestamp, port number, Unix-domain socket directory path (could be empty), first valid listen_address (IP address or *, or empty if not listening on TCP), and shared memory segment ID (this file is not present after server shutdown) ","date":"2022-09-14","objectID":"/postgres-internal/:1:0","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"æ•°æ®åº“å¯¹è±¡åœ¨æ–‡ä»¶å­˜å‚¨ä¸­çš„å¸ƒå±€ ä¸ºäº†ç ”ç©¶æ•°æ®åº“æ•°æ®å­˜å‚¨ï¼Œé¦–å…ˆå¯åŠ¨æ•°æ®åº“å®ä¾‹ï¼Œåˆ›å»ºå¦‚ä¸‹è¡¨ç»“æ„: create database test; CREATE TABLE sal_emp ( id int primary key, name text, pay_by_quarter integer[], schedule text[][] ); INSERT INTO sal_emp VALUES ( 1, 'Bill', '{10000, 10000, 10000, 10000}', '{{\"meeting\", \"lunch\"}, {\"training\", \"presentation\"}}' ); create index sal_emp_btree ON sal_emp (pay_by_quarter); create index sal_emp_gin ON sal_emp USING gin(pay_by_quarter); ","date":"2022-09-14","objectID":"/postgres-internal/:2:0","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"databaseã€tablesã€index ç­‰æ–‡ä»¶å¸ƒå±€ åœ¨ 9.0 ç‰ˆæœ¬ä¹‹åï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰ç™»å½•æ•°æ®åº“çš„æ•°æ®ç›®å½• test=# show data_directory; data_directory --------------------------- /home/vagrant/pgdata/data (1 row) æ•°æ®åº“ä½äº base å­ç›®å½•ä¸‹ï¼Œæ•°æ®åº“ç›®å½•åå­—æ˜¯å…¶ oidã€‚ä¾‹å¦‚ test çš„ oid ä¸º 16966ï¼Œä»–çš„ç›®å½•åå­—ä¸º 16966. test=# select oid,datname from pg_database; oid | datname -------+----------- 5 | postgres 16966 | test 1 | template1 4 | template0 $ ls -ld base/16966/ drwx------ 2 vagrant vagrant 12288 Sep 16 01:59 base/16966/ æ¯ä¸ªä¸è¶…è¿‡ 1GB çš„ table æˆ–è€… index å­˜å‚¨åœ¨å…¶æ‰€å±çš„ database ç›®å½•ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶ä¸‹. test=# SELECT relname, oid, relfilenode FROM pg_class WHERE relname = 'sal_emp'; relname | oid | relfilenode ---------+-------+------------- sal_emp | 16967 | 16967 test=# select * from pg_relation_filepath('sal_emp'); pg_relation_filepath ---------------------- base/16966/16967 $ ls -alh base/16966/16967 -rw------- 1 vagrant vagrant 8.0K Sep 16 02:03 base/16966/16967 å½“ä¸€ä¸ª table æˆ–è€… index çš„æ–‡ä»¶å¤§å°è¶…è¿‡ 1GBï¼ŒPostgreSQL ä¼šåˆ›å»ºåå­—ç±»ä¼¼äº relfilenode.1, å¹¶ä½¿ç”¨å®ƒã€‚å¦‚æœæ–°çš„æ–‡ä»¶è¢«å¡«æ»¡äº†ï¼Œä¸‹ä¸€ä¸ªæ–°çš„æ–‡ä»¶ relfilenode.2 å°†è¢«åˆ›å»ºï¼Œä»¥æ­¤ç±»æ¨ã€‚ ls -alh base/16966/16967* -rw------- 1 vagrant vagrant 1.0G Sep 16 02:03 base/16966/16967 -rw------- 1 vagrant vagrant 1M Sep 16 02:03 base/16966/16967.1 å•ä¸ª table/index ç´¢å¼•æ–‡ä»¶å¤§å°æ˜¯å¯ä»¥é…ç½®çš„, PostgreSQL ç¼–è¯‘é€‰é¡¹æ˜¯ --with-segsize . ä»”ç»†è§‚å¯Ÿæ•°æ®åº“å­ç›®å½•ï¼Œå¯ä»¥å‘ç°ä¸€äº›æ–‡ä»¶çš„åç¼€æ˜¯ _fsm å’Œ _vm, å®ƒä»¬åˆ†åˆ«æ˜¯å¯¹åº”æ–‡ä»¶çš„ free space map visibility map, åˆ†åˆ«å­˜å‚¨ç€æ¯ä¸ªæ–‡ä»¶ä¸­æ¯ä¸ª page çš„ ç©ºé—²ç©ºé—´åŠæ˜¯å¦å¯è§ã€‚indexs åªæœ‰ fsmï¼Œæ²¡æœ‰ vm. å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åå‘æŸ¥çœ‹æ–‡ä»¶å¯¹åº”çš„æ•°æ®åº“å¯¹è±¡. test=# SELECT pg_filenode_relation(0, 16967); pg_filenode_relation ---------------------- sal_emp (1 row) ","date":"2022-09-14","objectID":"/postgres-internal/:2:1","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"Tablespaces PostgreSQL ä¸­çš„ Tablespaces æ˜¯ base ç›®å½•ä¹‹å¤–çš„é™„åŠ æ•°æ®åŒºåŸŸã€‚ è¯¥åŠŸèƒ½å·²åœ¨ 8.0 ç‰ˆæœ¬ä¸­å®ç°ã€‚ TODO: è¡¥å……æ›´å¤šç»†èŠ‚ ","date":"2022-09-14","objectID":"/postgres-internal/:3:0","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"Heap Table File çš„å†…éƒ¨æ–‡ä»¶æ ¼å¼ storage-page-layout æ•°æ®æ–‡ä»¶å†…éƒ¨å­˜å‚¨ç€å¤§é‡çš„ pages, æ¯ä¸ª page çš„å›ºå®šå¤§å°ä¸º 8192 byte(8KB)ã€‚æ¯ä¸ªæ•°æ®æ–‡ä»¶ä¸­çš„ page ä» 0 å¼€å§‹ç¼–å·ï¼Œè¿™äº›ç¼–å·å« block numbers. page å¤§å°å¯ä»¥æ‰§è¡Œ sql æŸ¥çœ‹, SELECT current_setting('block_size');ï¼Œå…¶å€¼å¯ä»¥åœ¨ç¼–è¯‘æ—¶æ·»åŠ å‚æ•°ä¿®æ”¹ â€“with-blocksize=BLOCKSIZE eq: ./configure --with-blocksize=BLOCKSIZE --with-wal-blocksize=BLOCKSIZE ä¸åŒç§ç±»çš„æ–‡ä»¶çš„å†…éƒ¨å¸ƒå±€ä¸ç›¸åŒã€‚å¦‚ä¸‹ä¸º heap table file çš„æ–‡ä»¶å¸ƒå±€ heap table ä¸­çš„ page åŒ…å«å¦‚ä¸‹ä¸‰éƒ¨åˆ†ï¼š heap tuple(s): ä¸€ä¸ª heap tuple ä»£è¡¨ tables ä¸­çš„ä¸€è¡Œè®°å½•ã€‚heap tuple ä»¥æ ˆå…¥é¡ºåºæ·»åŠ åˆ° page ä¸­ï¼Œå³æ–°çš„ tuple å›è¢«æ’å…¥åˆ°æ—§çš„å‰è¾¹; line pointer(s): line pointer æŒæœ‰ tuple çš„æŒ‡é’ˆã€‚line pointer æ˜¯ä¸€ä¸ªå˜é•¿æŒ‡é’ˆï¼Œæ¯ä¸ª line pointer çš„åºå·ä» 1 å¼€å§‹ï¼Œå½“æ–°çš„ tuple è¢«æ’å…¥åˆ° page ä¸­æ—¶ï¼ŒæŒ‡å‘æ–° tuple çš„ line pointer ä¹Ÿä¼šè¢«ä»æ’å…¥åˆ° line pointer æ•°ç»„çš„å°¾éƒ¨; header data: ä½äº page çš„å¼€å§‹ä½ç½®ï¼Œè®°å½•äº†å½“å‰ page çš„å…ƒæ•°æ®ã€‚å…¶è¯¦ç»†æ„æˆå®šä¹‰åœ¨ PageHeaderData ä¸­.å…¶ä¸»è¦ä¿¡æ¯å¦‚ä¸‹: pd_lsn: ä¿å­˜äº† WAL çš„ LSNï¼Œäº WAL æœºåˆ¶ç›¸å…³ï¼› pd_checksum: ä¿å­˜äº†å½“å‰ page çš„ checksumï¼› pd_lower, pd_upper: pd_lower æŒ‡å‘ linepointer çš„æœ«å°¾ï¼Œpd_upper æŒ‡å‘æœ€æ–°çš„ tuple çš„å¼€å§‹ï¼› pd_special, è¿™ä¸ªå˜é‡æ˜¯ç»™ index ä½¿ç”¨çš„ï¼Œä»–æŒ‡å‘ page çš„æœ«å°¾æœ€åä¸€ä¸ª byte lin pointer çš„æœ€ååˆ°æœ€æ–° tuple çš„å¼€å§‹æ˜¯å½“å‰ page çš„ ç©ºé—²ç©ºé—´ã€‚ tuple identifierï¼ˆTIDï¼‰å”¯ä¸€æ ‡è¯†ä¸€ä¸ª tuple. TID åŒ…å«ä¸¤ä¸ªæŒ‡ï¼Œblock number æ ‡è¯†å®ƒæ‰€åœ¨çš„ pageï¼Œoffset number æ ‡è¯†å®ƒåœ¨ page ä¸­çš„ä½ç½®. å®ƒçš„å…¸å‹ä½¿ç”¨åœºæ™¯çš„ index. å¦å¤–ï¼Œå½“ heap tuple çš„å¤§ä¸‹è¶…è¿‡ 2k(1/4 page size 8k) æ—¶å€™ï¼Œå­˜å‚¨ä¼šä½¿ç”¨ TOAST(The Oversized-Attribute Storage Technique), è¯¦ç»†ä¿¡æ¯è§ Postgres æ–‡æ¡£ tuple æœ€å¤š MaxHeapAttributeNumber=1664 ä¸ª column. ","date":"2022-09-14","objectID":"/postgres-internal/:4:0","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"heap tuple çš„è¯»å†™ ","date":"2022-09-14","objectID":"/postgres-internal/:5:0","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"heap tuple å†™ å¦‚ä¸‹å›¾æ‰€ç¤º, å‡è®¾å½“å‰ table åªæœ‰ä¸€é¡µæ•°æ®ï¼Œå½“å‰é¡µä¸­æœ‰ä¸€æ¡æ•°æ®. pg_lower æŒ‡å‘ linp æœ€åä¸€é¡¹çš„æœ«å°¾, pg_upper æŒ‡å‘æœ€åä¸€ä¸ª tuple çš„å¼€å§‹. tuple çš„å¢é•¿æ–¹å‘æ˜¯ä»æ¯é¡µçš„å°¾éƒ¨åˆ°å¤´éƒ¨ã€‚ç¬¬äºŒä¸ª tuple ä¼šæ’å…¥åˆ°ç¬¬ä¸€ä¸ª tuple çš„å‰è¾¹(åœ°å€æ›´å°çš„ä½ç½®), æ–°çš„ linp ä¼šæ’å…¥åˆ°ç¬¬ä¸€ä¸ª linp åè¾¹ï¼Œpg_lower ä¼šæŒ‡å‘æ–°çš„ linp å°¾éƒ¨, åŸæœ¬æŒ‡å‘ç¬¬ä¸€ä¸ª tuple å¤´éƒ¨çš„ pg_upper ä¼šä¿®æ”¹ä¸ºæŒ‡å‘ç¬¬äºŒä¸ª tuple å¤´éƒ¨, å…¶ä»– page header ä¸­çš„æ•°æ®(eq: pd_lsn, pg_checksum, pg_flag)ä¹Ÿä¼šè¢«ä¿®æ”¹. ä¿®æ”¹åçš„ page å¸ƒå±€å¦‚ä¸‹å›¾æ‰€ç¤º TODO: æ‰§è¡Œ sql é…åˆ pg_inspect åˆ†ææ’å…¥è¯»å–è¿‡ç¨‹ ","date":"2022-09-14","objectID":"/postgres-internal/:5:1","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"heap tuple è¯» heap tuple çš„è¯»æœ‰ä¸¤ç§æ–¹å¼ï¼š sequential scan å’Œ index scan: sequential scan: æ¯ä¸ª tables ä¼šæœ‰å¤šä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶ä¸­ä¼šæœ‰å¾ˆå¤šå›ºå®šå¤§å°çš„ page é¡ºåºå­˜å‚¨ï¼Œæ¯ä¸ª page ä¸­ä¼šæœ‰å¾ˆå¤š tupleã€‚sequential scan ä¼šæ‰«ææ‰€æœ‰æ–‡ä»¶ä¸­æ‰€æœ‰ page ä¸­çš„ æ‰€æœ‰ tuple. index scan: index æ˜¯ä¸€æ£µæœç´¢æ ‘ï¼Œindex ä¸­åŒ…å«å¾ˆå¤š index tupleï¼Œè¿™äº› index tuple ä¸­åŒ…å« index key å’Œ æŒ‡å‘ heap tuple çš„ TIDã€‚å‡è®¾ index tuple ä¸­åŒ…å«å¦‚ä¸‹å†…å®¹ â€˜(block=3, offset=7)â€™. å½“ index scan æ‰¾åˆ°æŸä¸ª index tuple ç¬¦åˆæ¡ä»¶æ—¶ï¼Œè·å¾—åˆ° index tuple ä¸­çš„ TID. ç”±äº page æ˜¯å›ºå®šå¤§å°çš„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ç±»ä¼¼äº lseek è°ƒç”¨ å®šä½åˆ°å¯¹åº”çš„ page åå°†æ•°æ® load åˆ°å†…å­˜ï¼Œå†ç”± offset å®šä½åˆ° å†…å­˜ä¸­ linp çš„ä½ç½®ï¼Œlinp ä¸­åŒ…å« tuple çš„æŒ‡é’ˆåŠçŠ¶æ€ï¼Œæ•°æ®å³å¯å®šä½åˆ°å¹¶è¯»å‡ºæ¥ã€‚ TODO: è¿™é‡Œæœ€å¥½å¯ä»¥ç”»ä¸ªå›¾ è¿›ç¨‹æ¨¡å‹ä¸å†…å­˜æ¨¡å‹ ","date":"2022-09-14","objectID":"/postgres-internal/:5:2","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"è¿›ç¨‹æ¨¡å‹ Postgres server æ˜¯å¤šè¿›ç¨‹æ¨¡å‹ï¼Œå¤šä¸ªè¿›ç¨‹ååŒå·¥ä½œå®Œæˆæ‰€æœ‰çš„æ•°æ®åº“ç®¡ç†å·¥ä½œï¼Œå®ƒåŒ…å«å¦‚ä¸‹è¿›ç¨‹ï¼š postgres server è¿›ç¨‹æ˜¯æ‰€æœ‰ pg è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œç›‘å¬ tcp ç«¯å£å¹¶å¯¹å¤–æä¾›æœåŠ¡ backend è¿›ç¨‹å¤„ç†ä»å®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„è¯·æ±‚ å„ç§ background processes ï¼ˆåŒ…æ‹¬ VACUUMã€CHECKPOINT ç­‰ï¼‰ replication associated processes å¤„ç†æµå¤åˆ¶ background worker process ç”¨æˆ·å®šä¹‰çš„åå°è¿›ç¨‹ï¼Œè¯¦ç»†ä¿¡æ¯è§ office docs æŸ¥çœ‹ Postgres è¿›ç¨‹è¿›ç¨‹æ ‘çš„æ–¹æ³•å¦‚ä¸‹ï¼Œå…¶ä¸­å‡è®¾ pg çš„è¿›ç¨‹ id ä¸º 503065 export PID=503065 ps f -p $(pstree -p ${PID} | sed 's/(/\\n(/g' | grep '(' | sed 's/(\\(.*\\)).*/\\1/' | tr \"\\n\" \" \") PID TTY STAT TIME COMMAND 503065 pts/1 S+ 0:00 ./src/backend/postgres 503068 ? Ss 0:00 \\_ postgres: checkpointer 503069 ? Ss 0:00 \\_ postgres: background writer 503071 ? Ss 0:00 \\_ postgres: walwriter 503072 ? Ss 0:00 \\_ postgres: autovacuum launcher 503073 ? Ss 0:00 \\_ postgres: logical replication launcher 503265 ? Ss 0:00 \\_ postgres: vagrant postgres [local] idle postgres server è¿›ç¨‹æ˜¯æ‰€æœ‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œè´Ÿè´£å¯åŠ¨å¹¶ç®¡ç†å„åå°è¿›ç¨‹ï¼›å¦å¤–ä¼šç›‘å¬ tcp ç«¯å£ã€‚å½“æœ‰æ–°çš„è¿æ¥è¯·æ±‚è¿‡æ¥æ—¶ï¼Œä¸»è¿›ç¨‹ä¼šåˆå§‹åŒ–å¹¶ fork å­è¿›ç¨‹ï¼Œç”±å­è¿›ç¨‹å¤„ç†è¯·æ±‚ã€‚ backend è¿›ç¨‹ç”± postgres server å¯åŠ¨ï¼Œå¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼Œç›´åˆ°å®¢æˆ·ç«¯æ–­å¼€ tcp è¿æ¥åï¼Œ backend è¿›ç¨‹ä¹Ÿä¼šä¸€èµ·é€€å‡ºã€‚Postgres æ”¯æŒæœ‰å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è¿æ¥å¹¶æ“ä½œæ•°æ®åº“ã€‚å®¢æˆ·ç«¯æ•°é‡çš„ä¸Šé™ç”±é…ç½®é¡¹ max_connections å†³å®šï¼Œé»˜è®¤å€¼æ˜¯ 100ã€‚å½“å®¢æˆ·ç«¯è¿æ¥æ•°è¶…è¿‡ max_connections åï¼ŒæœåŠ¡ä¼šæ‹’ç»æ–°çš„è¿æ¥ï¼Œç›´åˆ°å½“å‰è¿æ¥æ•°å°‘äº max_connections ä¸ºæ­¢ã€‚å¦å¤–ï¼Œå½“è¿æ¥æ•°é‡è¶…è¿‡ max_connections åï¼ŒæœåŠ¡å™¨æ— æ³•æ¥å—æ–°çš„è¿æ¥ï¼Œæ­¤æ—¶å¦‚æœæƒ³è¿æ¥ä¸Š postgres åšä¸€äº›ç»´æŠ¤å·¥ä½œå°†ä¼šè¢«æ‹’ç»ã€‚é…ç½®äº†é€‰é¡¹superuser_reserved_connections ï¼Œå³ä½¿è¿æ¥æ•°è¶…è¿‡äº† max_connections ï¼Œè¶…çº§ç®¡ç†å‘˜ä¹Ÿå¯ä»¥ç™»å½•åˆ°æœåŠ¡å™¨ã€‚ å¦‚æœå¾ˆå¤šå®¢æˆ·ç«¯ï¼ˆå¦‚ WEB åº”ç”¨ï¼‰é¢‘ç¹é‡å¤ä¸ PostgreSQL æœåŠ¡å™¨çš„è¿æ¥å’Œæ–­å¼€è¿æ¥ï¼Œä¼šå¢åŠ å»ºç«‹è¿æ¥å’Œåˆ›å»ºåç«¯è¿›ç¨‹çš„æˆæœ¬ï¼Œå› ä¸º PostgreSQL æ²¡æœ‰å®ç°åŸç”Ÿçš„è¿æ¥æ± ç‰¹æ€§.è¿™ä¼šåœ¨ä¸€äº›æƒ…å†µä¸‹ä¸¥é‡çš„å½±å“æ•°æ®åº“çš„æ€§èƒ½ã€‚ä¸€äº›æ•°æ®åº“ä¸­é—´ä»¶å¯ä»¥è§£å†³æ­¤é—®é¢˜(pgbouncer ã€pgpool-II) ","date":"2022-09-14","objectID":"/postgres-internal/:6:0","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"å†…å­˜æ¨¡å‹ å®½æ³›çš„ç»™ Postgres ä¸­çš„å†…å­˜å¯ä»¥è¢«åˆ†æˆä¸¤ç±» æœ¬åœ°å†…å­˜åŒº - æ¯ä¸ª backend åˆ†é…æ¥è‡ªå·±ä½¿ç”¨ å…±äº«å†…å­˜åŒº - Postgres server è¿›ç¨‹åˆ†é…ï¼Œç”±æ‰€æœ‰è¿›ç¨‹å…±äº«ä½¿ç”¨çš„å†…å­˜åŒº ","date":"2022-09-14","objectID":"/postgres-internal/:7:0","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"æœ¬åœ°å†…å­˜åŒº æ¯ä¸ªæœ¬åœ°å†…å­˜åŒºä¼šåˆ†é…ä¸€ä¸ªæœ¬åœ°å†…å­˜åŒºç”¨äºå¤„ç†æŸ¥è¯¢ï¼Œæ¯ä¸ªæœ¬åœ°å†…å­˜åŒºæœ‰å¤šä¸ªå­å†…å­˜åŒºï¼Œè¿™äº›å­å†…å­˜åŒºä¸€äº›æ˜¯å›ºå®šå¤§å°çš„ï¼Œä¸€äº›æ˜¯å¯å˜å¤§å°çš„ã€‚ å­åŒºåŸŸ æè¿° work_mem æ­¤åŒºåŸŸç”¨äº ORDER BY å’Œ DISTINCT æ’åº tuple, ä»¥åŠ join æ“ä½œä¸­çš„ merge-join å’Œ hash-join. maintenance_work_mem ä¸€äº›ç»´æŠ¤å·¥ä½œ (VACUUM, REINDEX) ä½¿ç”¨çš„å†…å­˜. temp_buffers ç”¨äºå­˜å‚¨ä¸´æ—¶è¡¨. ","date":"2022-09-14","objectID":"/postgres-internal/:7:1","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"å…±äº«å†…å­˜åŒº Postgres å¯åŠ¨çš„æ—¶å€™ä¼šåˆ†é…å›ºå®šå¤§å°çš„å¤šä¸ªå†…å­˜åŒº å­åŒºåŸŸ description shared buffer pool PostgreSQL ä»æŒä¹…å­˜å‚¨ä¸­åŠ è½½è¡¨å’Œç´¢å¼•ä¸­çš„ page åˆ°æ­¤åŒºåŸŸ, ä¹‹åç›´æ¥åŸåœ°æ“ä½œ. WAL buffer ä¸ºäº†ä¿è¯æ•°æ®åº“å¤±è´¥ä¸å¯¹æ•°æ®ï¼ŒPostgres æ”¯æŒ WAL æœºåˆ¶. WAL æ˜¯ Postgres çš„äº‹åŠ¡æ—¥å¿—; WAL buffer æ˜¯ WAL æ•°æ®å†™å›æŒä¹…å­˜å‚¨å‰çš„ç¼“å­˜åŒºåŸŸã€‚ commit log Commit Log(CLOG) ä¿å­˜äº‹åŠ¡æäº¤çŠ¶æ€ï¼Œç”¨äº MVCC æœºåˆ¶. å¹¶å‘æ§åˆ¶ tutorial-transactions ","date":"2022-09-14","objectID":"/postgres-internal/:7:2","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"äº‹åŠ¡ ID TODO: ","date":"2022-09-14","objectID":"/postgres-internal/:8:0","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"Tuple çš„ç»“æ„ HeapTuple åˆ†ä¸º æ™®é€š tuple å’Œ TOAST tupleã€‚ æˆ‘ä»¬åªé˜è¿° æ™®é€š tupleã€‚ ä¸€ä¸ª HeapTuple åŒ…å«ä¸‰éƒ¨åˆ† HeapTupleHeaderData structure NULL bitmap ç”¨æˆ·æ•°æ® HeapTupleHeaderData åŒ…å«å¾ˆå¤šå­—æ®µï¼Œå…¶ä¸­è·Ÿå¹¶å‘æ§åˆ¶ç›¸å…³çš„å­—æ®µå¦‚ä¸‹ï¼š t_xmin æ’å…¥æ­¤ tuple çš„äº‹åŠ¡çš„ txid t_xmax æ›´æ–°æˆ–åˆ é™¤æ­¤ tuple çš„äº‹åŠ¡çš„ txidã€‚å¦‚æœ tuple æ²¡æœ‰è¢«åˆ é™¤æˆ–æ›´æ–°è¿‡ï¼Œæ­¤æŒ‡ä¸º 0ï¼Œæ ‡è¯† INVALID. t_cid åœ¨å½“å‰äº‹åŠ¡ä¸‹ï¼Œæ‰§è¡Œæ­¤å‘½ä»¤å‰æ‰§è¡Œè¿‡å¤šå°‘ sqlï¼›ä» 0 å¼€å§‹ã€‚ä¾‹å¦‚æˆ‘ä»¬åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸‹æ‰§è¡Œå¤šä¸ª INSERT sql, â€œBEGIN;INSERT;INSERT;INSERT;COMMIT;â€, ç¬¬ä¸€ä¸ª INSERT å‘½ä»¤æ‰§è¡Œï¼Œt_cid=0ï¼› ç¬¬äºŒä¸ªå€¼ä¸º 1ï¼Œä¸€æ¬¡ç±»æ¨ã€‚ t_ctid å½“å‰ tuple çš„ tid æˆ–è€…æ–°çš„ tuple çš„ tid. tid æ ‡è¯†ä¸€ä¸ª tupleã€‚å¦‚æœæ­¤ tuple æœ‰è¢«æ›´æ–°ï¼Œåˆ™æŒ‡å‘æ–°çš„ tupleï¼Œå¦åˆ™æŒ‡å‘è‡ªå·±. DROP TABLE tbl; CREATE TABLE tbl (data text); BEGIN;INSERT INTO tbl VALUES('A');INSERT INTO tbl VALUES('B');INSERT INTO tbl VALUES('C');COMMIT; SELECT lp as tuple, t_xmin, t_xmax, t_field3 as t_cid, t_ctid, t_infomask2, t_infomask, t_hoff, t_bits, t_data FROM heap_page_items(get_raw_page('tbl', 0)); tuple | t_xmin | t_xmax | t_cid | t_ctid | t_infomask2 | t_infomask | t_hoff | t_bits | t_data -------+--------+--------+-------+--------+-------------+------------+--------+--------+-------- 1 | 1130 | 0 | 0 | (0,1) | 1 | 2050 | 24 | | \\x0541 2 | 1130 | 0 | 1 | (0,2) | 1 | 2050 | 24 | | \\x0542 3 | 1130 | 0 | 2 | (0,3) | 1 | 2050 | 24 | | \\x0543 ç‚¹æˆ‘å±•å¼€ HeapTupleHeaderData å£°æ˜ typedef struct HeapTupleFields { TransactionId t_xmin; /* inserting xact ID */ TransactionId t_xmax; /* deleting or locking xact ID */ union { CommandId t_cid; /* inserting or deleting command ID, or both */ TransactionId t_xvac; /* old-style VACUUM FULL xact ID */ } t_field3; } HeapTupleFields; typedef struct DatumTupleFields { int32 datum_len_; /* varlena header (do not touch directly!) */ int32 datum_typmod; /* -1, or identifier of a record type */ Oid datum_typeid; /* composite type OID, or RECORDOID */ /* * Note: field ordering is chosen with thought that Oid might someday * widen to 64 bits. */ } DatumTupleFields; typedef struct HeapTupleHeaderData { union { HeapTupleFields t_heap; DatumTupleFields t_datum; } t_choice; ItemPointerData t_ctid; /* current TID of this or newer tuple */ /* Fields below here must match MinimalTupleData! */ uint16 t_infomask2; /* number of attributes + various flags */ uint16 t_infomask; /* various flag bits, see below */ uint8 t_hoff; /* sizeof header incl. bitmap, padding */ /* ^ - 23 bytes - ^ */ bits8 t_bits[1]; /* bitmap of NULLs -- VARIABLE LENGTH */ /* MORE DATA FOLLOWS AT END OF STRUCT */ } HeapTupleHeaderData; typedef HeapTupleHeaderData *HeapTupleHeader; ","date":"2022-09-14","objectID":"/postgres-internal/:9:0","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"Tuple Insert Update Delete å½“å‰èŠ‚ä¸»è¦æè¿° tupleï¼Œä¸‹é¢æ²¡æœ‰è¡¨ç¤º page header ã€linpã€‚ DROP TABLE tbl; CREATE TABLE tbl (data text); INSERT INTO tbl VALUES('A');UPDATE tbl SET data='B'; SELECT t_xmin, t_xmax, t_field3 as t_cid, t_ctid, t_bits, t_data FROM heap_page_items(get_raw_page('tbl', 0)); t_xmin | t_xmax | t_cid | t_ctid | t_bits | t_data --------+--------+-------+--------+--------+-------- 99 | 100 | 0 | (0,2) | | \\x0541 100 | 0 | 0 | (0,2) | | \\x0542 ","date":"2022-09-14","objectID":"/postgres-internal/:10:0","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"Insert insert æ“ä½œä¼šç›´æ¥å°† tuple æ’å…¥åˆ° page ä¸­. DROP TABLE tbl; CREATE TABLE tbl (data text); INSERT INTO tbl VALUES('A'); SELECT t_xmin, t_xmax, t_field3 as t_cid, t_ctid, t_data FROM heap_page_items(get_raw_page('tbl', 0)); t_xmin | t_xmax | t_cid | t_ctid | t_data --------+--------+-------+--------+-------- 99 | 0 | 0 | (0,1) | \\x0541 t_xmin ä¸º 99ï¼Œè¿™ä¸ª tuple æ˜¯åœ¨äº‹åŠ¡ txid=99 æ’å…¥çš„ t_xmax ä¸º 0ï¼Œå½“å‰ tuple æ²¡æœ‰è¢«æ›´æ–°æˆ–åˆ é™¤è¿‡ t_cid ä¸º 0ï¼Œè¡¨ç¤º tid=99 ç¬¬ä¸€ä¸ª sql t_ctid ä¸º â€˜(0,1)â€™, æŒ‡å‘ä»–è‡ªå·±ï¼Œå› ä¸ºä»–æ˜¯ç¬¬ä¸€ä¸ª tuple ","date":"2022-09-14","objectID":"/postgres-internal/:10:1","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"Delete åˆ é™¤æ“ä½œæ˜¯é€»è¾‘åˆ é™¤. æ‰§è¡Œ DELETE æ“ä½œå®é™…çš„æ“ä½œæ˜¯å°† t_xmax çš„å€¼ä¿®æ”¹ä¸º txid=100 çš„ txid DROP TABLE tbl; CREATE TABLE tbl (data text); INSERT INTO tbl VALUES('A'); -- txid=99 Delete from tbl where data='A'; -- txid=100 SELECT lp as tuple, t_xmin, t_xmax, t_field3 as t_cid, t_ctid, t_data FROM heap_page_items(get_raw_page('tbl', 0)); tuple | t_xmin | t_xmax | t_cid | t_ctid | t_data -------+--------+--------+-------+--------+-------- 1 | 99 | 100 | 0 | (0,1) | \\x0541 å½“äº‹åŠ¡è¢«æäº¤ä¹‹åï¼Œtuple1 å·²ç»ä¸éœ€è¦äº†ã€‚é€šå¸¸è¿™ç§ä¸éœ€è¦çš„ tuple è¢«ç§°ä¸º dead tuples. dead tuples æœ€ç»ˆä¼šè¢«æ¸…ç†æ‰ã€‚æ¸…ç† dead tuples å·¥ä½œç”± VACUUM æ‰§è¡Œã€‚ ","date":"2022-09-14","objectID":"/postgres-internal/:10:2","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"Update æ›´æ–°æ“ä½œä¼šåˆ é™¤(t_xmax ä¿®æ”¹ä¸ºå½“å‰ txid)æ—§çš„ tupleï¼Œæ’å…¥ä¸€ä¸ªæ–°çš„ tuple. å¦‚ä¸‹ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œä¸€æ¬¡æ’å…¥ï¼Œåç»­åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸‹æ‰§è¡Œä¸¤ä¸ª UPDATEã€‚ TODO: ç”»å›¾æŠŠæ•°æ®å˜åŒ–è¿‡ç¨‹å¯è§†åŒ–ä¸€ä¸‹ DROP TABLE tbl; CREATE TABLE tbl (data text); INSERT INTO tbl VALUES('A'); -- txid=99 SELECT lp as tuple, t_xmin, t_xmax, t_field3 as t_cid, t_ctid, t_data FROM heap_page_items(get_raw_page('tbl', 0)); BEGIN; UPDATE tbl set data='B'; SELECT lp as tuple, t_xmin, t_xmax, t_field3 as t_cid, t_ctid, t_data FROM heap_page_items(get_raw_page('tbl', 0)); UPDATE tbl set data='C'; COMMIT; SELECT lp as tuple, t_xmin, t_xmax, t_field3 as t_cid, t_ctid, t_data FROM heap_page_items(get_raw_page('tbl', 0)); -- æ‰§è¡Œ insert tuple | t_xmin | t_xmax | t_cid | t_ctid | t_data -------+--------+--------+-------+--------+-------- 1 | 1168 | 0 | 0 | (0,1) | \\x0541 -- æ‰§è¡Œç¬¬ä¸€æ¬¡ update tuple | t_xmin | t_xmax | t_cid | t_ctid | t_data -------+--------+--------+-------+--------+-------- 1 | 1168 | 1169 | 0 | (0,2) | \\x0541 2 | 1169 | 0 | 0 | (0,2) | \\x0542 -- æ‰§è¡Œç¬¬äºŒæ¬¡ update tuple | t_xmin | t_xmax | t_cid | t_ctid | t_data -------+--------+--------+-------+--------+-------- 1 | 1168 | 1169 | 0 | (0,2) | \\x0541 2 | 1169 | 1169 | 0 | (0,3) | \\x0542 3 | 1169 | 0 | 1 | (0,3) | \\x0543 å‡è®¾ç¬¬äºŒä¸ªäº‹åŠ¡çš„ txid=1169 æ‰§è¡Œç¬¬ä¸€ä¸ª Update çš„æ—¶å€™, é€šè¿‡è®¾ç½® t_xmax=txid åˆ é™¤ Tuple1; t_ctid æŒ‡å‘æ–°çš„ tuple Tuple2. tuple çš„ head å˜åŒ–å¦‚ä¸‹ï¼š Tuple1: t_xmax=txid t_ctid '(0,1)' ä¿®æ”¹ä¸º '(0,2)' Tuple2: t_xmin=txid t_xmax=0 t_cid=0 t_ctid='(0,2)' æ‰§è¡Œç¬¬äºŒä¸ª Update çš„æ—¶å€™ï¼Œé€šè¿‡è®¾ç½® t_xmax=txid åˆ é™¤ Tuple2; t_ctid æŒ‡å‘ Tuple3 Tuple2: t_xmax=txid t_ctid '(0,2)' ä¿®æ”¹ä¸º '(0,3)' Tuple3: t_xmin=txid t_xmax=0 t_cid=1 t_ctid='(0,3)' å¦‚æœ txid äº‹åŠ¡ commitedï¼ŒTuple1ã€Tuple2 ä¼šå˜æˆ dead tupleï¼›å¦‚æœ txid äº‹åŠ¡ abordedï¼ŒTuple2ã€Tuple3 ä¼šå˜æˆ dead tuple ","date":"2022-09-14","objectID":"/postgres-internal/:10:3","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"Free Space Map Free Space Map ç”¨äºè·Ÿè¸ªæ•°æ®åº“å…³ç³»çš„å¯ç”¨ç©ºé—´. å½“æ’å…¥ heap/index tuple çš„æ—¶å€™ï¼ŒPostgreSQL ä½¿ç”¨ FSM å¯»æ‰¾åˆé€‚çš„ page æ’å…¥ tuple. FSM æ–‡ä»¶å‘½åä¸ºå…¶å…³ç³»çš„ filenode æ•°å­—åŠ åç¼€ _fsm. ä¾‹å¦‚ï¼Œå…³ç³» public.user ä¿å­˜çš„æ–‡ä»¶çš„ filenode ä¸º 1000ï¼Œåˆ™å®ƒçš„ FSM æ–‡ä»¶ä¸ºåŒç›®å½•ä¸‹çš„ 1000_fsm æ–‡ä»¶ã€‚FSM æ–‡ä»¶ä¼šåœ¨éœ€è¦çš„æ—¶å€™åŠ è½½åˆ° shared memory ä¸­ã€‚ pg_freespacemap æ‰©å±•å¯ä»¥æŸ¥çœ‹å…³ç³»çš„ç©ºé—²ç©ºé—´å¤§å°ã€‚å¦‚ä¸‹æŸ¥è¯¢å…³ç³» tbl çš„ç©ºé—²ç©ºé—´ç™¾åˆ†ç‡ã€‚ CREATE EXTENSION pg_freespacemap; SELECT *, round(100 * avail/8192 ,2) as \"freespace ratio\" FROM pg_freespace('tbl'); blkno | avail | freespace ratio -------+-------+----------------- 0 | 0 | 0.00 ","date":"2022-09-14","objectID":"/postgres-internal/:10:4","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"Commit Log (clog) Commit Log ä¿å­˜ç€äº‹åŠ¡çŠ¶æ€ã€‚Commit Log é€šå¸¸ä¹Ÿè¢«å«åš clogï¼Œè¢«åˆ†é…åœ¨ shared memory, è´¯ç©¿åœ¨æ•´ä¸ªäº‹åŠ¡çš„å¤„ç†è¿‡ç¨‹ä¸­ã€‚ ","date":"2022-09-14","objectID":"/postgres-internal/:11:0","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"Transaction Status Postgres å®šä¹‰äº†4ä¸­äº‹åŠ¡çŠ¶æ€ N_PROGRESS, COMMITTED, ABORTED, and SUB_COMMITTED. ","date":"2022-09-14","objectID":"/postgres-internal/:11:1","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"Clog å¦‚ä½•å·¥ä½œçš„ clog ç”± shared memory ä¸­ä¸€ä¸ªåˆ°å¤šä¸ª 8kb å¤§å°çš„ page æ„æˆ. clog æ˜¯é€»è¾‘ä¸Šçš„æ•°ç»„ã€‚æ•°ç»„çš„ index è¡¨ç¤ºäº‹åŠ¡çš„ idï¼Œæ•°ç»„çš„å„é¡¹ å¦‚å›¾ T1: txid=200 commit, çŠ¶æ€ç”± IN_PROGRESS å˜ä¸º COMMITTED T2: txid=201 abort, çŠ¶æ€ç”± IN_PROGRESS å˜ä¸º ABORTED åç»­ä¼šè®²è¿° clog æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚ ","date":"2022-09-14","objectID":"/postgres-internal/:11:2","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"Transaction Snapshot transaction snapshot ä¿å­˜äº†æ‰€æœ‰äº‹åŠ¡çš„çš„æ‰§è¡ŒçŠ¶æ€ä¿¡æ¯ã€‚Postgres å†…éƒ¨å®šä¹‰äº†æ–‡æœ¬æ ¼å¼çš„ transaction Snapshot å¦‚ â€˜100ğŸ’¯â€™. â€˜100ğŸ’¯â€™ æ„æ€æ˜¯txids\u003c=99 æ²¡æœ‰åœ¨æ´»è·ƒï¼Œ txids\u003e=100 åœ¨æ´»è·ƒã€‚ å†…ç½®çš„å‡½æ•° txid_current_snapshot å±•ç¤ºå½“å‰äº‹åŠ¡çš„å¿«ç…§ SELECT txid_current_snapshot(); txid_current_snapshot ----------------------- 100:104:100,102 æ–‡æœ¬æ ¼å¼çš„ txid_current_snapshot æ˜¯ â€˜xmin:xmax:xip_listâ€™, æ¯éƒ¨åˆ†çš„å«ä¹‰å¦‚ä¸‹ï¼š xmin æœ€æ—©çš„æ´»è·ƒäº‹åŠ¡ã€‚æ—©äºå®ƒçš„äº‹åŠ¡è¦ä¹ˆ committed äº‹åŠ¡å¯è§ï¼Œè¦ä¹ˆ rollback æäº¤å†…å®¹ä¸ç”Ÿæ•ˆ/ä¸å¯è§ xmax ç¬¬ä¸€ä¸ªå°šæœªåˆ†é…çš„ txidã€‚ æ‰€æœ‰ \u003e=txid çš„äº‹åŠ¡å°šæœªå¯åŠ¨ï¼Œæ˜¯ä¸å¯è§çš„ xip_list æ´»è·ƒçš„äº‹åŠ¡ã€‚è¿™ä¸ªåˆ—è¡¨åªåŒ…å« xmin å’Œ xmax ä¹‹é—´çš„äº‹åŠ¡ å¦‚ä¸Šå›¾ï¼Œç¬¬ä¸€ä¸ªä¾‹å­ â€˜100ğŸ’¯â€™ xmin=100ï¼Œè¡¨ç¤º txids\u003c100 çš„æ²¡æ´»è·ƒ xmax=100ï¼Œè¡¨ç¤º txids\u003e=100 çš„æ´»è·ƒ ç¬¬äºŒä¸ªä¾‹å­ â€˜100:104:100,102â€™ xmin=100ï¼Œè¡¨ç¤º txids\u003c100 çš„æ²¡æœ‰æ´»è·ƒ xmax=104ï¼Œè¡¨ç¤º txids\u003e=104 çš„æ­£åœ¨æ´»è·ƒ xip_list=100,102ï¼Œè¡¨ç¤º 100å’Œ102 æ­£å¸¸æ‰§è¡Œ transaction manager ç®¡ç† transaction snapshotsã€‚transaction snapshots ç”¨äºåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ¤æ–­ tuple æ˜¯å¦å¯è§ã€‚ç›¸åŒçš„ tuple åŠç›¸åŒçš„ transaction snapshots ä¸‹ï¼Œä¸åŒçš„äº‹åŠ¡éš”ç¦»çº§åˆ«ä¼šæœ‰ä¸åŒçš„å¯è§ç»“æœã€‚ transaction manager ä¸­æŒæœ‰å½“å‰æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ã€‚å¦‚å›¾ï¼Œä¸‰ä¸ªäº‹åŠ¡ç›¸ç»§æ‰§è¡Œï¼ŒTxA å’Œ TxB çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯ READ COMMITTEDï¼ŒTxC çš„æ˜¯ REPREATABLE READ. T1: TxA å¼€å§‹æ‰§è¡Œç¬¬ä¸€ä¸ª SELECT å‘½ä»¤ã€‚å½“æ‰§è¡Œç¬¬ä¸€ä¸ªå‘½ä»¤æ—¶å€™ï¼ŒTxAè¯·æ±‚è·å¾— txid å’Œ å¿«ç…§ã€‚transaction manager åˆ†é… txid=200, transation snapshot '200:200:' T2: TxB å¼€å§‹æ‰§è¡Œç¬¬ä¸€ä¸ª SELECT å‘½ä»¤ï¼Œtransaction manager åˆ†é… tx=201ï¼Œtransaction snapshot '200:200:', å› æ­¤ TxB ä¸­æ— æ³•çœ‹åˆ° TxA T3: TxC å¼€å§‹æ‰§è¡Œç¬¬ä¸€ä¸ª SELECT å‘½ä»¤ï¼Œåˆ†é… tx=202ï¼Œtx snapshot '200:200:'. TxC çœ‹ä¸åˆ° TxA å’Œ TxB T4: TxA æäº¤ã€‚transaction manager ç§»é™¤ä»–çš„äº‹åŠ¡ä¿¡æ¯ T5: TxB å’Œ TxC å†æ¬¡æ‰§è¡Œ SELECTå‘½ä»¤ã€‚ TxB è¯·æ±‚è·å¾— tx snapshootï¼Œå› ä¸ºä»–çš„äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯ `READ COMMITTED`ï¼ŒTxB è·å¾—çš„ tx snapshot æ˜¯ '201:201:'ã€‚ TxA å·²ç» commited äº†ï¼Œæ•… TxB å¯ä»¥çœ‹åˆ° TxA TxC å› ä¸ºå…¶äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯ `REPEATABLE READ`ï¼Œåº”è¯¥ç»§ç»­ä½¿ç”¨ä¹‹å‰è·å¾—çš„ snapshot '200:200:'. TxC çœ‹ä¸åˆ° TxA å’Œ TxB ","date":"2022-09-14","objectID":"/postgres-internal/:12:0","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"å¯è§æ€§è§„åˆ™ åŸºäºç°åœ¨çš„å †æ–‡ä»¶çš„å®ç°ï¼Œä¸€ä¸ªäº‹åŠ¡å¦‚ä½•åˆ¤æ–­å½“å‰è·å–åˆ°çš„ tuple æ˜¯å¯è§çš„å‘¢ï¼Ÿinterdb åšçš„æ£€æŸ¥è§„åˆ™å¦‚ä¸‹: /* t_xmin status = ABORTED */ Rule 1: IF t_xmin status is 'ABORTED' THEN RETURN 'Invisible' END IF /* t_xmin status = IN_PROGRESS */ IF t_xmin status is 'IN_PROGRESS' THEN IF t_xmin = current_txid THEN Rule 2: IF t_xmax = INVALID THEN RETURN 'Visible' Rule 3: ELSE /* this tuple has been deleted or updated by the current transaction itself. */ RETURN 'Invisible' END IF Rule 4: ELSE /* t_xmin â‰  current_txid */ RETURN 'Invisible' END IF END IF /* t_xmin status = COMMITTED */ IF t_xmin status is 'COMMITTED' THEN Rule 5: IF t_xmin is active in the obtained transaction snapshot THEN RETURN 'Invisible' Rule 6: ELSE IF t_xmax = INVALID OR status of t_xmax is 'ABORTED' THEN RETURN 'Visible' ELSE IF t_xmax status is 'IN_PROGRESS' THEN Rule 7: IF t_xmax = current_txid THEN RETURN 'Invisible' Rule 8: ELSE /* t_xmax â‰  current_txid */ RETURN 'Visible' END IF ELSE IF t_xmax status is 'COMMITTED' THEN Rule 9: IF t_xmax is active in the obtained transaction snapshot THEN RETURN 'Visible' Rule 10: ELSE RETURN 'Invisible' END IF END IF END IF è¢« ABORTED çš„ tuple ä¸å¯è§ï¼ˆRule 1ï¼‰ã€‚ æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡ï¼Œå½“å‰äº‹åŠ¡è‡ªå·±å¯è§(Rule 2, Rule 3, Rule 4). Rule 7, tuple è¢«å½“å‰äº‹åŠ¡åˆ é™¤äº† Rule 8ï¼Œå…¶ä»–çš„äº‹åŠ¡çš„åˆ é™¤æ²¡æœ‰æäº¤ï¼Œå½“å‰äº‹åŠ¡æ˜¯å¯è§çš„ Rule 1: If Status(t_xmin) = ABORTED =\u003e Invisible Rule 2: If Status(t_xmin) = IN_PROGRESS âˆ§ t_xmin = current_txid âˆ§ t_xmax = INVAILD =\u003e Visible Rule 3: If Status(t_xmin) = IN_PROGRESS âˆ§ t_xmin = current_txid âˆ§ t_xmax != INVAILD =\u003e Invisible Rule 4: If Status(t_xmin) = IN_PROGRESS âˆ§ t_xmin != current_txid =\u003e Invisible Rule 5: If Status(t_xmin) = COMMITTED âˆ§ Snapshot(t_xmin) = active =\u003e Invisible Rule 6: If Status(t_xmin) = COMMITTED âˆ§ (t_xmax = INVALID âˆ¨ Status(t_xmax) = ABORTED) =\u003e Visible Rule 7: If Status(t_xmin) = COMMITTED âˆ§ Status(t_xmax) = IN_PROGRESS âˆ§ t_xmax = current_txid =\u003e Invisible Rule 8: If Status(t_xmin) = COMMITTED âˆ§ Status(t_xmax) = IN_PROGRESS âˆ§ t_xmax != current_txid =\u003e Visible Rule 9: If Status(t_xmin) = COMMITTED âˆ§ Status(t_xmax) = COMMITTED âˆ§ Snapshot(t_xmax) = active =\u003e Visible Rule 10: If Status(t_xmin) = COMMITTED âˆ§ Status(t_xmax) = COMMITTED âˆ§ Snapshot(t_xmax) != active =\u003e Invisible ","date":"2022-09-14","objectID":"/postgres-internal/:13:0","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"TOAST TODO VACUUM Processing TODO Buffer Manager TODO Write Ahead Logging (WAL) TODO references postgres-src The Internals of PostgreSQL for database administrators and system developers ","date":"2022-09-14","objectID":"/postgres-internal/:14:0","tags":["db","postgres"],"title":"Postgres å†…éƒ¨å·¥ä½œåŸç†","uri":"/postgres-internal/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹: docker å†…ç½® bridge çš„ ip ä¿®æ”¹æ–¹æ³• Configure the default bridge network docker daemon çš„é…ç½®æ–‡ä»¶ /etc/docker/daemon.json æä¾›äº†è‡ªå®šä¹‰ docker builtin bridge é…ç½®é¡¹. # ä¿®æ”¹ daemon.json ä¸­ \"bip\" { .... \"bip: \"100.100.1.1/24\", # bip: ä¿®æ”¹ builtin bridge çš„ ip \"default-address-pools\":[{\"base\":\"100.100.0.0/16\",\"size\":24}} ... } docker stop $(docker ps -qa) \u0026\u0026 systemctl restart docker \u0026\u0026 docker start $(docker ps -qa) æ³¨æ„: docker å¦‚æœå·²ç»æœ‰å®¹å™¨åœ¨è¿è¡Œï¼Œbip çš„é…ç½®æ˜¯ä¸ä¼šç”Ÿæ•ˆã€‚é…ç½®æ·»åŠ  {\"debug\": true} åä¼šæœ‰å¦‚ä¸‹æ—¥å¿—: Jun 11 18:31:45 hostname dockerd[323728]: time=\"2022-06-11T18:31:45.251000544+08:00\" level=debug msg=\"RequestPool(LocalDefault, 172.17.0.0/16, , map[], false)\" Jun 11 18:31:45 hostname dockerd[323728]: time=\"2022-06-22T18:31:45.251092001+08:00\" level=debug msg=\"RequestAddress(LocalDefault/172.17.0.0/16, 172.17.0.1, map[RequestAddressType:com.docker.network.gateway])\" Jun 11 18:31:45 hostname dockerd[323728]: time=\"2022-06-11T18:31:45.251140234+08:00\" level=debug msg=\"Request address PoolID:172.17.0.0/16 App: ipam/default/data, ID: LocalDefault/172.17.0.0/16, DBIndex: 0x0, Bits: 65536, Unselected: 65534, Sequence: (0x80000000, 1)-\u003e(0x0, 2046)-\u003e(0x1, 1)-\u003eend Curr:0 Serial:false PrefAddress:172.17.0.1 \" Jun 11 18:31:45 hostname dockerd[323728]: time=\"2022-06-11T18:31:45.272456556+08:00\" level=info msg=\"There are old running containers, the network config will not take affect\" è§£å†³æ–¹æ³•æ˜¯å…ˆå°†æ‰€æœ‰å¯åŠ¨çš„å®¹å™¨ stopï¼Œç„¶åé‡å¯ docker é…ç½®ç”Ÿæ•ˆåï¼Œstart å®¹å™¨ ","date":"2022-06-23","objectID":"/docker-change-default-bridge-ip/:0:0","tags":["docker","fix"],"title":"Docker ä¿®æ”¹å†…ç½® bridge ip ä¸ç”Ÿæ•ˆ, åŸå› åŠè§£å†³åŠæ³•","uri":"/docker-change-default-bridge-ip/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šLinux Network æ˜¯å¦‚ä½•ä½¿ç”¨åŠå·¥ä½œçš„ Linux Network éå¸¸å¤æ‚ï¼Œå…¶æœ¬èº«çš„æœºåˆ¶éå¸¸å¤æ‚ï¼Œæ¯ä¸€ç§ Linux å‘è¡Œç‰ˆçš„ç½‘ç»œä¹Ÿæœ‰å·®åˆ«ï¼Œç®¡ç†å·¥å…·ä¹Ÿçº·ç¹å¤æ‚ã€‚è¿™é‡Œå…ˆç®€å•çš„æè¿°åœ¨ Centos7 å’Œ Ubuntu20.04 ä¸‹å¦‚ä½•é…ç½®ç½‘ç»œï¼Œåç®€å•çš„æè¿°ä¸€ä¸‹ network æ˜¯æ€æ ·å·¥ä½œçš„. Centos6 ä½¿ç”¨ network.service Centos7 network.service å’Œ NetworkManager.service å¹¶å­˜ Centos8 ä¹‹ååªä½¿ç”¨ NetworkManager.service Ubuntu ä½¿ç”¨ netplan å‰ç«¯ï¼ŒNetworkManager/networkd åç«¯ ","date":"2022-01-01","objectID":"/linux_config_network/:0:0","tags":["Linux","network"],"title":"Linux Network å¦‚ä½•é…ç½®åŠå·¥ä½œåŸç†","uri":"/linux_config_network/"},{"categories":null,"content":"Linux ç½‘ç»œè®¾å¤‡ TODO: ç½‘ç»œè®¾å¤‡æ¶æ„ TODO: ç½‘ç»œæ¥å£å‘½å ","date":"2022-01-01","objectID":"/linux_config_network/:1:0","tags":["Linux","network"],"title":"Linux Network å¦‚ä½•é…ç½®åŠå·¥ä½œåŸç†","uri":"/linux_config_network/"},{"categories":null,"content":"network.service ä½¿ç”¨æ–¹æ³• ä¿®æ”¹ /etc/sysconfig/network-scripts ä¸‹çš„ ifcfg-*æ–‡ä»¶ï¼Œä¹‹åæ‰§è¡Œ service network restartï¼Œé…ç½®å³å¯ç”Ÿæ•ˆã€‚ æ³¨æ„: ç½‘ç»œé…ç½®ä¿®æ”¹å¯èƒ½ä¼šåœæ‰å½“å‰çš„ ssh è¿æ¥ åŸç†ï¼š network.service ä¼šæ‰§è¡Œ /etc/rc.d/init.d/network start å¯åŠ¨ç½‘ç»œæœåŠ¡ï¼Œå¯åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ ip å‘½ä»¤å¯åŠ¨å„ deviceï¼Œä½¿ç”¨ route é…ç½®ç³»ç»Ÿè·¯ç”±ï¼Œä½¿ç”¨ sysctl é…ç½®ç­‰ã€‚ ","date":"2022-01-01","objectID":"/linux_config_network/:1:1","tags":["Linux","network"],"title":"Linux Network å¦‚ä½•é…ç½®åŠå·¥ä½œåŸç†","uri":"/linux_config_network/"},{"categories":null,"content":"NetworkNanager ä½¿ç”¨æ–¹æ³• Managing IP Networking åŒ…å«ä¼˜ç‚¹åŠå¦‚ä½•ä½¿ç”¨ D-Bus çš„ unix socket: /var/run/dbus/system_bus_socket udev é…ç½®: /etc/udev/udev.conf é…ç½®æ–‡ä»¶ç›®å½• /etc/NetworkManager /etc/sysconfig/network-scripts å‘½ä»¤ systemctl restart NetworkManager.service # é‡å¯æœåŠ¡ journalctl -u NetworkManager.service -f -n 100 # æŸ¥çœ‹æ—¥å¿— # æŸ¥è¯¢è¿æ¥ä¿¡æ¯ nmcli conn # æ·»åŠ è¿æ¥ nmcli conn add type ethernet con-name eth0-static ifname eth0 ipv4.method manual ipv4.addresses \"10.0.2.16/24\" ipv4.gateway 10.0.2.2 ipv4.dns 114.114.114.114 ipv6.method auto # ä¿®æ”¹è¿æ¥ nmcli conn modify eth0-static ipv4.method manual ipv4.addresses 10.0.2.254/24 ipv4.gateway 10.0.2.2 # interactive edit connection nmcli conn edit \u003cconn-name\u003e # ç³»ç»Ÿ link(è®¾å¤‡) nmcli dev # é‡æ–°åº”ç”¨é…ç½® nmcli dev reapply eth0 # TUI nmtui æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ nmcli é…ç½®ç½‘ç»œï¼Œå½“å‡ºç°é”™è¯¯çš„æ—¶å€™ï¼Œé€šè¿‡ journalctl æŸ¥çœ‹æ—¥å¿—ï¼Œåˆ†æé…ç½®é”™è¯¯åŸå› ï¼Œç»§ç»­ä½¿ç”¨ nmcli é…ç½®ç½‘ç»œï¼Œç›´åˆ°ç½‘ç»œæœåŠ¡é…ç½®å¥½. ","date":"2022-01-01","objectID":"/linux_config_network/:1:2","tags":["Linux","network"],"title":"Linux Network å¦‚ä½•é…ç½®åŠå·¥ä½œåŸç†","uri":"/linux_config_network/"},{"categories":null,"content":"NetworkNanager å·¥ä½œåŸç† NetworkNanager æœ‰ä¸¤ä¸ªç»„ä»¶: NetworkManager daemon, ç®¡ç†è¿æ¥å’Œç›‘å¬å¹¶æŠ¥å‘Šç½‘ç»œå˜åŒ– ä¸€äº›ç®¡ç†å‰ç«¯ï¼ˆfront-endsï¼‰, æ¯”å¦‚ nmcli,ä¸€äº› GUI ç¨‹åºç­‰ NetworkManager daemon ä¾èµ–äº D-Bus, å®ç°äº†ç®¡ç†è¿æ¥çš„æ¥å£ï¼Œåº•å±‚ä½¿ç”¨ netlink è·Ÿ linux å†…æ ¸äº¤äº’ï¼Œè·å¾—è®¾å¤‡ä¿¡æ¯ï¼Œé…ç½®è¿æ¥ï¼ˆæ¯”å¦‚ä¿®æ”¹ ipv4 çš„åœ°å€ç­‰ï¼‰ã€‚nmcli è·Ÿ D-Bus äº¤äº’è¿æ¥ NetworkManager daemonï¼Œè·å¾—ä¿¡æ¯ä»¥åŠé…ç½®ç½‘ç»œ # ip å‘½ä»¤ä¹Ÿæ˜¯ä½¿ç”¨ netlink è·Ÿ kernel äº¤äº’çš„ strace -fff ip a socket(AF_NETLINK, SOCK_RAW|SOCK_CLOEXEC, NETLINK_ROUTE) = 3 sendto(3, {{len=40, type=RTM_GETLINK, flags=NLM_F_REQUEST|NLM_F_DUMP, seq=1641054708, pid=0}, {ifi_family=AF_UNSPEC, ifi_type=ARPHRD_NETROM, ifi_index=0, ifi_flags=0, ifi_change=0}, {{nla_len=8, nla_type=IFLA_EXT_MASK}, 1}}, 40, 0, NULL, 0) = 40 recvmsg(3, {msg_name={sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, msg_namelen=12, msg_iov=[{iov_base=NULL, iov_len=0}], msg_iovlen=1, msg_controllen=0, msg_flags=MSG_TRUNC}, MSG_PEEK|MSG_TRUNC) recvmsg(3, {msg_name={sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000} sendto(3, {{len=40, type=RTM_GETADDR, flags=NLM_F_REQUEST|NLM_F_DUMP, seq=1641054709, pid=0}, {ifa_family=AF_UNSPEC, ifa_prefixlen=0, ifa_flags=0, ifa_scope=RT_SCOPE_UNIVERSE, ifa_index=0}, {nla_len=0, nla_type=IFA_UNSPEC}}, 40, 0, NULL, 0) = 40 recvmsg(3, {msg_name={sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, msg_namelen=12, msg_iov=[{iov_base=NULL, iov_len=0}], msg_iovlen=1, msg_controllen=0, msg_flags=MSG_TRUNC}, MSG_PEEK|MSG_TRUNC) TODO: ç®€å•çš„ demo ä½¿ç”¨ netlink è·å¾— ip åœ°å€å’Œé…ç½® ip åœ°å€ netlink-demo ","date":"2022-01-01","objectID":"/linux_config_network/:1:3","tags":["Linux","network"],"title":"Linux Network å¦‚ä½•é…ç½®åŠå·¥ä½œåŸç†","uri":"/linux_config_network/"},{"categories":null,"content":"NetworkNanager å’Œ network.service å¦‚ä½•å¹¶å­˜ TODO: ","date":"2022-01-01","objectID":"/linux_config_network/:1:4","tags":["Linux","network"],"title":"Linux Network å¦‚ä½•é…ç½®åŠå·¥ä½œåŸç†","uri":"/linux_config_network/"},{"categories":null,"content":"netplan The network configuration abstraction renderer netplan æ˜¯ä¸€ä¸ªæ–¹ä¾¿åœ¨ linux ç³»ç»Ÿä¸‹é…ç½®ç½‘ç»œçš„å·¥å…·ã€‚æˆ‘ä»¬é€šè¿‡ yaml æ–‡ä»¶æè¿°ç½‘ç»œé…ç½®ï¼Œ\u0008netplan ä¼šä¸ºæˆ‘ä»¬ç”Ÿæˆæˆ‘ä»¬é€‰æ‹©çš„ç½‘ç»œåç«¯æ‰€éœ€è¦çš„é…ç½®ã€‚å½“å‰æ”¯æŒåç«¯ Systemd-networkd(default) å’Œ NetworkManager. Ubuntu 20.04 ä½¿ç”¨ netplan ä½œä¸ºç½‘ç»œé…ç½®å·¥å…·. é…ç½®æ–‡ä»¶åœ¨ ls /{lib,etc,run}/netplan/*.yaml. ls /etc/netplan netplan design netplan reference ls /{lib,etc,run}/netplan/*.yaml # é…ç½®æ–‡ä»¶ä½ç½® netplan generate # ç”Ÿæˆé…ç½® ls /run/systemd/network/ ip a # å„æ¥å£ä¿¡æ¯ lshw -class network # ç¡¬ä»¶æ›´è¯¦ç»†çš„ä¿¡æ¯ ethtool enp0s3 # ä¿®æ”¹é…ç½® /etc/netplan/*.yaml netplan try # æµ‹è¯•æ˜¯å¦ç”Ÿæ•ˆ netplan apply # åº”ç”¨é…ç½® resolvectl status # resolve name netplan ä¸€äº›é€šç”¨çš„é…ç½®æ¨¡ç‰ˆ netplan é…ç½® dhcp è‡ªåŠ¨è·å– ip cat /etc/netplan/50-cloud-init.yaml # This file is generated from information provided by the datasource. Changes # to it will not persist across an instance reboot. To disable cloud-init's # network configuration capabilities, write a file # /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following: # network: {config: disabled} network: ethernets: enp0s3: dhcp4: true match: macaddress: 02:f6:7f:02:5c:72 set-name: enp0s3 version: 2 netplan é…ç½® static ip: network: version: 2 ethernets: enp0s3: match: macaddress: 02:f6:7f:02:5c:72 addresses: - 10.10.10.2/24 gateway4: 10.10.10.1 set-name: enp0s3 nameservers: search: [mydomain, otherdomain] addresses: [10.10.10.1, 1.1.1.1] routes: - to: default via: 10.10.10.1 # netplan generate --root-dir /vagrant Name resolve # /run/systemd/resolve/stub-resolv.conf man 8 systemd-resolved systemd-resolve --statistics # resolve æœåŠ¡ systemd-resolve --reset-statistics # é‡ç½®ç»Ÿè®¡ä¿¡æ¯ systemctl restart systemd-resolved # é‡å¯ ubuntu resolved æœåŠ¡ resolvectl flush-caches # flush dns cache (old: systemd-resolve --flush-caches) # flush dns cache # https://www.linuxuprising.com/2019/07/how-to-flush-dns-cache-on-linux-for.html ","date":"2022-01-01","objectID":"/linux_config_network/:1:5","tags":["Linux","network"],"title":"Linux Network å¦‚ä½•é…ç½®åŠå·¥ä½œåŸç†","uri":"/linux_config_network/"},{"categories":null,"content":"æ€»ç»“ ç½‘ç»œé…ç½®æœ€ç»ˆéƒ½æ˜¯è·Ÿå†…æ ¸ç”¨ netlink æ²Ÿé€šï¼Œå‘Šè¯‰ \u0008linux å†…æ ¸ç½‘ç»œé…ç½®ï¼Œç”± kernel ç”Ÿæ•ˆå¹¶å·¥ä½œã€‚ç”¨æˆ·æ€ç®¡ç†ç¨‹åºå…¸å‹ä»£è¡¨ï¼š NetworkManager å’Œ systemd-networkdã€‚ç†Ÿæ‚‰äº†è¿™äº›ï¼Œä¾¿æœ‰äº†æ‰‹æ®µæŒ‡æŒ¥ linux kernel ç½‘ç»œå¦‚ä½•å·¥ä½œã€‚å‰©ä¸‹çš„å°±éœ€è¦æˆ‘ä»¬æ…¢æ…¢äº†è§£å’Œå­¦ä¹  linux ç½‘ç»œæä¾›äº†å“ªäº›åŠŸèƒ½ã€‚ ","date":"2022-01-01","objectID":"/linux_config_network/:2:0","tags":["Linux","network"],"title":"Linux Network å¦‚ä½•é…ç½®åŠå·¥ä½œåŸç†","uri":"/linux_config_network/"},{"categories":null,"content":"ref network_configuration linux kernel network docs Netplan configuration examples ","date":"2022-01-01","objectID":"/linux_config_network/:3:0","tags":["Linux","network"],"title":"Linux Network å¦‚ä½•é…ç½®åŠå·¥ä½œåŸç†","uri":"/linux_config_network/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šlinux è®¾ç½®å¼€æœºè‡ªå¯åŠ¨è„šæœ¬çš„å‡ ç§æ–¹å¼ ","date":"2022-01-01","objectID":"/linux_boot_script/:0:0","tags":["Linux","commands","shell"],"title":"Linux å¼€æœºè‡ªå¯åŠ¨è„šæœ¬æœºå™¨å®ç°åŸç†","uri":"/linux_boot_script/"},{"categories":null,"content":"rc.local ","date":"2022-01-01","objectID":"/linux_boot_script/:1:0","tags":["Linux","commands","shell"],"title":"Linux å¼€æœºè‡ªå¯åŠ¨è„šæœ¬æœºå™¨å®ç°åŸç†","uri":"/linux_boot_script/"},{"categories":null,"content":"ä½¿ç”¨æ–¹æ³• # æ–‡ä»¶ /etc/rc.d/rc.local # centos æˆ–è€…å·²ç»é…ç½®è¿‡æ­¤æ–‡ä»¶ echo \"echo 'do HelloWord'\" \u003e\u003e /etc/rc.local # å·²ç»æœ‰è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™ # ubuntu æ²¡æœ‰ /etc/rc.localï¼Œéœ€è¦åˆ›å»ºæ–‡ä»¶ï¼Œæ­£ç¡®çš„é…ç½® shebang printf '%s\\n' '#!/bin/bash' 'exit 0' | sudo tee -a /etc/rc.local # æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™ # Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure # that this script will be executed during boot. chmod +x /etc/rc.local systemctl enable --now rc-local systemctl status rc-local.service å·¥ä½œåŸç† systemctl cat rc-local.service [Unit] Description=/etc/rc.local Compatibility Documentation=man:systemd-rc-local-generator(8) ConditionFileIsExecutable=/etc/rc.local After=network.target [Service] Type=forking ExecStart=/etc/rc.local start TimeoutSec=0 RemainAfterExit=yes GuessMainPID=no å¯ä»¥çœ‹åˆ°ï¼Œ\u0008ConditionFileIsExecutable=/etc/rc.localï¼Œå½“ /etc/rc.local å¯æ‰§è¡Œçš„æ—¶å€™ï¼Œsystemd æ‹‰èµ·æœåŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæ‰§è¡Œ /etc/rc.local. ","date":"2022-01-01","objectID":"/linux_boot_script/:1:1","tags":["Linux","commands","shell"],"title":"Linux å¼€æœºè‡ªå¯åŠ¨è„šæœ¬æœºå™¨å®ç°åŸç†","uri":"/linux_boot_script/"},{"categories":null,"content":"crontab reboot echo '@reboot /root/helloworld.sh' \u003e\u003e /etc/crontab crontab /etc/crontab crontab -e @reboot /root/helloworld.sh ","date":"2022-01-01","objectID":"/linux_boot_script/:2:0","tags":["Linux","commands","shell"],"title":"Linux å¼€æœºè‡ªå¯åŠ¨è„šæœ¬æœºå™¨å®ç°åŸç†","uri":"/linux_boot_script/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šå­¦ä¹  systemd ç¬”è®° Linux çš„å¯åŠ¨ å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡‡ç”¨ init è¿›ç¨‹ã€‚init æ˜¯ç³»ç»Ÿå¯åŠ¨åçš„ç¬¬ä¸€ä¸ªç”¨æˆ·çº§ç¨‹åºï¼Œpid=1. init ç¨‹åºæœ‰ä¸¤ä¸ªç¼ºç‚¹: å¯åŠ¨æ—¶é—´é•¿ã€‚init è¿›ç¨‹æ˜¯ä¸²è¡Œå¯åŠ¨ï¼Œåªæœ‰å‰ä¸€ä¸ªè¿›ç¨‹å¯åŠ¨å®Œï¼Œæ‰ä¼šå¯åŠ¨ä¸‹ä¸€ä¸ªè¿›ç¨‹; å¯åŠ¨è„šæœ¬å¤æ‚ã€‚init è¿›ç¨‹åªæ˜¯æ‰§è¡Œå¯åŠ¨è„šæœ¬ï¼Œä¸ç®¡å…¶ä»–äº‹æƒ…ã€‚è„šæœ¬éœ€è¦è‡ªå·±å¤„ç†å„ç§æƒ…å†µï¼Œè¿™å¾€å¾€ä½¿å¾—è„šæœ¬å˜å¾—å¾ˆé•¿; ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒLennart Poettering è®¾è®¡äº† systemdã€‚ systemd æ˜¯ Linux ç”µè„‘æ“ä½œç³»ç»Ÿä¹‹ä¸‹çš„ä¸€å¥—ä¸­å¤®åŒ–ç³»ç»ŸåŠè®¾ç½®ç®¡ç†ç¨‹åºï¼ˆinitï¼‰ï¼ŒåŒ…æ‹¬æœ‰å®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰ã€ç¨‹åºåº“ä»¥åŠåº”ç”¨è½¯ä»¶.å·²çŸ¥çš„ä¸»æµ Linux å‘è¡Œç‰ˆéƒ½æŠŠ systemd ä½œä¸º init. systemd è¿˜é™„å¸¦å¾ˆå¤šåŸºç¡€å·¥å…·ï¼ŒåŒ…æ‹¬ timesync, hostnamectl ç­‰ä¸€ç³»åˆ—ç®¡ç†ç³»ç»Ÿçš„å·¥å…·ã€‚å…·ä½“ä½¿ç”¨æ–¹æ³• è¿™é‡Œ å·²ç»è®²äº†å¾ˆå¤šï¼Œåœ¨è¿™é‡Œä¸å†èµ˜è¿°ã€‚ systemd ä½¿ç”¨æƒ…å†µå¦‚ä¸‹: ç³»ç»Ÿ ç‰ˆæœ¬ å¤‡æ³¨ Ubuntu 15.04 åŠåç»­ç‰ˆæœ¬ 1 Debian GNU/Linux Debian 8â€œJessieâ€ä¹‹å Red Hat åŠå…¶æ´¾ç”Ÿå“ 7 åŠåç»­ç‰ˆæœ¬ Fedora 15 åŠåç»­ç‰ˆæœ¬ ","date":"2022-01-01","objectID":"/systemd-usages/:0:0","tags":["Linux","Systemd"],"title":"Systemd ç®€å•ä»‹ç»ï¼Œä½¿ç”¨åŠå¦‚ä½• Debug","uri":"/systemd-usages/"},{"categories":null,"content":"å¦‚ä½• debug systemctl æä¾›äº†ä¸€äº›å·¥å…·ç”¨äº debugã€‚ systemctl cat multi-user.service # æŸ¥çœ‹ unit é…ç½® systemctl show multi-user.service # æ˜¾ç¤ºæŸä¸ª Unit çš„æ‰€æœ‰åº•å±‚å‚æ•° systemctl show -p CPUShares multi-user.service # è®¾ç½®æŸä¸ª Unit çš„æŒ‡å®šå±æ€§ systemctl list-dependencies --all multi-user.service # åˆ—å‡ºä¾èµ–é¡¹ systemctl list-dependencies --all multi-user.service # åˆ—å‡ºä¾èµ–é¡¹ systemd-analyze critical-chain # cli æ˜¾ç¤ºç€‘å¸ƒçŠ¶çš„å¯åŠ¨è¿‡ç¨‹æµ systemd-analyze blame # åˆ†æå½“å‰ç³»ç»Ÿå„é¡¹æœåŠ¡å¯åŠ¨æ—¶é—´ systemd-analyze plot \u003e boot.svg # åˆ†æå½“å‰ç³»ç»Ÿå„é¡¹æœåŠ¡å¯åŠ¨é¡ºåº ls /etc/systemd/system/ # ä¿®æ”¹ unit æ–‡ä»¶ # é‡æ–°åŠ è½½ service ä¿¡æ¯ # systemd ä¼šå°†æ‰€æœ‰ unit ä¿¡æ¯ç¼“å­˜åœ¨å†…å­˜ï¼Œåªæœ‰é‡æ–°åŠ è½½ï¼Œä¿®æ”¹å†…å®¹æ‰ä¼šç”Ÿæ•ˆ systemctl daemon-reload journalctl -u ssh.service -f # æŸ¥çœ‹ unit æ—¥å¿— ","date":"2022-01-01","objectID":"/systemd-usages/:1:0","tags":["Linux","Systemd"],"title":"Systemd ç®€å•ä»‹ç»ï¼Œä½¿ç”¨åŠå¦‚ä½• Debug","uri":"/systemd-usages/"},{"categories":null,"content":"ref Systemd å…¥é—¨æ•™ç¨‹ï¼šå‘½ä»¤ç¯‡ Linux çš„å¯åŠ¨æµç¨‹ ","date":"2022-01-01","objectID":"/systemd-usages/:2:0","tags":["Linux","Systemd"],"title":"Systemd ç®€å•ä»‹ç»ï¼Œä½¿ç”¨åŠå¦‚ä½• Debug","uri":"/systemd-usages/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹: ä½¿ç”¨ nginx åˆ¶ä½œä¸€ä¸ª yum mirror nginx å¯ä»¥æ”¯æŒç¼“å­˜æ–‡ä»¶ï¼Œæ•…å°† nginx é…ç½®æˆ yum åŒ… mirror serverï¼Œå¸¦æ–‡ä»¶è‡ªåŠ¨è¿‡æœŸ, å¹¶é™åˆ¶æœ€å¤§æ–‡ä»¶è¿‡æœŸæ—¶é—´. #å†…å®¹å­˜å‚¨åˆ° pkg_mirror.conf æ–‡ä»¶ä¸­ upstream centos_mirror { server mirrors.tuna.tsinghua.edu.cn; } # centos 7 yum local source server { listen 7000; server_name $host; index index.html ; root /opt/nginx/cache/; add_header Access-Control-Allow-Origin *; add_header Access-Control-Allow-Headers X-Requested-With; add_header Access-Control-Allow-Methods GET,POST,OPTIONS; location / { proxy_store on; proxy_temp_path \"/opt/nginx/cache/\"; proxy_set_header Accept-Encoding identity; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Host 'mirrors.tuna.tsinghua.edu.cn'; proxy_next_upstream error http_502; if ( !-e $request_filename ) { proxy_pass http://centos_mirror; } expires 6h; # proxy_pass http://centos_mirror; } } # å°†æ–‡ä»¶å­˜å‚¨åˆ° docker-compose.yaml ä¸­ version: \"3\" services: repo_mirror: container_name: repo_mirror image: nginx:alpine ports: - 7000:7000 volumes: - ./pkg_mirror.conf:/etc/nginx/conf.d/pkg_mirror.conf - ./mirror_cache:/opt/nginx/cache logging: driver: \"json-file\" options: max-size: \"512m\" restart: always docker-compose up -d æµ‹è¯•æ•ˆæœ # Dockerfile FROM ubuntu:20.04 RUN sed -E -i -e 's/(archive|ports).ubuntu.com/192.168.0.102:7000/g' -e '/security.ubuntu.com/d' /etc/apt/sources.list RUN apt-get update \u0026\u0026 \\ apt-get install -y --no-install-recommends ca-certificates \u0026\u0026 \\ rm -rf /var/lib/apt/lists/* \u0026\u0026 \\ update-ca-certificates docker build -t tmp:dev . # æ—¥å¿—ä¸­ apt ä½¿ç”¨äº† 192.168.0.102:7000 å®‰è£…è½¯ä»¶æˆåŠŸï¼Œä¸” mirror_cache ç›®å½•ä¸­æœ‰ç›¸å…³çš„æ–‡ä»¶ ","date":"2021-10-25","objectID":"/build-yum-mirror-with-nginx/:0:0","tags":["nginx","linux"],"title":"ä½¿ç”¨ nginx åˆ¶ä½œä¸€ä¸ª yum mirror","uri":"/build-yum-mirror-with-nginx/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šgolang scheduler ç›¸å…³çš„å†…å®¹ ","date":"2021-08-08","objectID":"/go-scheduler-intenal-and-gmp/:0:0","tags":null,"title":"golang è°ƒåº¦å™¨åº•å±‚åŸç†åŠ GMP å·¥ä½œåŸç†","uri":"/go-scheduler-intenal-and-gmp/"},{"categories":null,"content":"ç®€ä»‹ ç°åœ¨ä¸»æµçš„çº¿ç¨‹æ¨¡å‹åˆ†ä¸‰ç§ï¼šå†…æ ¸çº§çº¿ç¨‹æ¨¡å‹ã€ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹å’Œä¸¤çº§çº¿ç¨‹æ¨¡å‹ï¼ˆä¹Ÿç§°æ··åˆå‹çº¿ç¨‹æ¨¡å‹ï¼‰ï¼Œä»–ä»¬éƒ½å¾ˆå¤æ‚ã€‚golang å±äº ä¸¤çº§çº¿ç¨‹æ¨¡å‹ï¼Œæ˜¯ç”± goroutine å®ç°çš„, goroutine æ˜¯ golang æœ€é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå…·æœ‰ä½¿ç”¨æˆæœ¬ä½ã€æ¶ˆè€—èµ„æºä½ã€èƒ½æ•ˆé«˜ç­‰ç‰¹ç‚¹ï¼Œå®˜æ–¹å®£ç§°åŸç”Ÿ goroutine å¹¶å‘æˆåƒä¸Šä¸‡ä¸æˆé—®é¢˜. CSP(é€šä¿¡é¡ºåºè¿›ç¨‹) æ˜¯ golang ä¸­çš„å¹¶å‘æ¨¡å‹ã€‚æœ¬ç‰‡æ–‡æ¡£å°†å¸¦é¢†è¯»è€…æ·±å…¥ç†è§£ golang çš„ goroutine çš„å·¥ä½œæ–¹å¼ã€‚ stack å¤§å°ï¼š goroutineï¼š2KB çº¿ç¨‹ï¼š8MB çº¿ç¨‹åˆ‡æ¢éœ€è¦é™·å…¥å†…æ ¸ï¼›goroutine åªéœ€è¦ getcontext å’Œ setcontextï¼Œ30+ ä¸ªå¯„å­˜å™¨çš„è¯»åˆå†™ï¼Œéå¸¸å¿«é€Ÿ ","date":"2021-08-08","objectID":"/go-scheduler-intenal-and-gmp/:1:0","tags":null,"title":"golang è°ƒåº¦å™¨åº•å±‚åŸç†åŠ GMP å·¥ä½œåŸç†","uri":"/go-scheduler-intenal-and-gmp/"},{"categories":null,"content":"coroutine çš„å·¥ä½œæ–¹å¼ è¯´åˆ° goroutineï¼Œå°±ä¸å¾—ä¸è¯´ä¸€ä¸‹ coroutineã€‚goroutine æ˜¯coroutine åœ¨ golang ä¸­çš„å®ç°å’Œä¼˜åŒ–ã€‚golang ä½œè€…ä¹‹ä¸€ Russ Cox æœ‰å®ç°è½»é‡çš„ libtask ï¼Œ400 è¡Œå·¦å³ä»£ç æè¿°æ¸…æ¥šäº† coroutine æ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚ å»ºè®®äº²è‡ªä¸‹è½½ä»£ç ï¼Œçœ‹ä¸€ä¸‹å…·ä½“çš„å®ç°é€»è¾‘, éœ€è¦æ¯”è¾ƒç®€å•çš„ c åŸºç¡€ ä¸€ä¸ª coroutine æ¯”è¾ƒæ ¸å¿ƒçš„å·¥ä½œåŒ…æ‹¬ï¼š task ç®¡ç†, åŒ…æ‹¬åˆ›å»ºï¼Œé”€æ¯ï¼Œåˆ‡æ¢ç­‰ coroutine è°ƒåº¦ç®—æ³• å…ˆçœ‹ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ä¾‹å­: // https://github.com/mixinlib/libtask/blob/651d7b69a4f7b10c798dcd544e6a25fd7505632c/primes.c#L12 void primetask(void *arg) { Channel *c, *nc; int p, i; c = arg; p = chanrecvul(c); if(p \u003e goal) taskexitall(0); if(!quiet) printf(\"%d\\n\", p); nc = chancreate(sizeof(unsigned long), buffer); taskcreate(primetask, nc, 32768); for(;;){ i = chanrecvul(c); if(i%p) chansendul(nc, i); } } void taskmain(int argc, char **argv) { int i; Channel *c; if(argc\u003e1) goal = atoi(argv[1]); else goal = 100; printf(\"goal=%d\\n\", goal); c = chancreate(sizeof(unsigned long), buffer); taskcreate(primetask, c, 32768); // åˆ›å»º coroutineï¼Œå¼€å§‹æ‰§è¡Œä»»åŠ¡ primetask for(i=2;; i++) chansendul(c, i); } ä¼šå‘ç°ç¨‹åºä¸­æ²¡æœ‰å¸¸è§çš„ c main å‡½æ•°ï¼Œå®é™…æ˜¯åœ¨ libtask ä¸­å®ç°äº†ã€‚æ•´ä¸ªç¨‹åºæ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œmain ä¸­åˆ›å»ºäº†ç¬¬ä¸€ä¸ª taskï¼Œå¹¶å¯åŠ¨ task è°ƒåº¦å™¨ // https://github.com/mixinlib/libtask/blob/main/task.c#L353 static void taskmainstart(void *v) { taskname(\"taskmain\"); taskmain(taskargc, taskargv); } int main(int argc, char **argv) { struct sigaction sa, osa; memset(\u0026sa, 0, sizeof sa); sa.sa_handler = taskinfo; sa.sa_flags = SA_RESTART; sigaction(SIGQUIT, \u0026sa, \u0026osa); #ifdef SIGINFO sigaction(SIGINFO, \u0026sa, \u0026osa); #endif argv0 = argv[0]; taskargc = argc; taskargv = argv; if(mainstacksize == 0) mainstacksize = 256*1024; taskcreate(taskmainstart, nil, mainstacksize); taskscheduler(); // task è°ƒåº¦å™¨å¯åŠ¨ fprint(2, \"taskscheduler returned in main!\\n\"); abort(); return 0; } è°ƒåº¦å™¨çš„å·¥ä½œæ˜¯ä» runnable_queue ä¸­è·å¾—ä¸€ä¸ªå¯æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç„¶ååˆ‡æ¢è¿‡å» static void taskscheduler(void) { int i; Task *t; taskdebug(\"scheduler enter\"); for(;;){ if(taskcount == 0) exit(taskexitval); t = taskrunqueue.head; if(t == nil){ fprint(2, \"no runnable tasks! %d tasks stalled\\n\", taskcount); exit(1); } deltask(\u0026taskrunqueue, t); t-\u003eready = 0; taskrunning = t; tasknswitch++; taskdebug(\"run %d (%s)\", t-\u003eid, t-\u003ename); contextswitch(\u0026taskschedcontext, \u0026t-\u003econtext); //print(\"back in scheduler\\n\"); taskrunning = nil; if(t-\u003eexiting){ if(!t-\u003esystem) taskcount--; i = t-\u003ealltaskslot; alltask[i] = alltask[--nalltask]; alltask[i]-\u003ealltaskslot = i; free(t); } } } coroutine æ˜¯å¦‚ä½•åˆ‡æ¢çš„å‘¢ï¼Ÿç”±è®¡ç®—æœºçš„å·¥ä½œåŸç†çŸ¥é“ï¼Œç¨‹åºçš„æ‰§è¡Œæ˜¯æ ¹æ® pc å¯„å­˜å™¨ä¸­çš„ä½ç½®å–æŒ‡ä»¤æ‰§è¡Œçš„ï¼Œæ‰§è¡Œ task éœ€è¦ stack å’Œå¯„å­˜å™¨ã€‚å¯„å­˜å™¨ä¸­çš„æ•°æ®å°±æ˜¯ä¸€ä¸ª coroutine çš„ ä¸Šä¸‹æ–‡ï¼Œè®°å½•ä¸‹æ¥ï¼Œset æˆå…¶ä»–çš„ ä¸Šä¸‹æ–‡çš„ å¯„å­˜å™¨çš„å€¼ï¼Œå³å¯è¾¾åˆ°åˆ‡æ¢ coroutine çš„ç›®çš„ã€‚ç”±äºä¸åŒå¹³å°çš„å¯„å­˜å™¨ä¸åŒï¼ŒæŒ‡ä»¤é›†ä¸åŒï¼Œéœ€è¦åŒºåˆ†å¹³å°åšä¸åŒçš„äº‹æƒ…: // linux x86 å¹³å°çš„æŒ‡ä»¤ // https://github.com/mixinlib/libtask/blob/651d7b69a4f7b10c798dcd544e6a25fd7505632c/asm.S#L43 #ifdef NEEDX86CONTEXT .globl SET SET: movl 4(%esp), %eax movl 8(%eax), %fs movl 12(%eax), %es movl 16(%eax), %ds movl 76(%eax), %ss movl 20(%eax), %edi movl 24(%eax), %esi movl 28(%eax), %ebp movl 36(%eax), %ebx movl 40(%eax), %edx movl 44(%eax), %ecx movl 72(%eax), %esp pushl 60(%eax) /* new %eip */ movl 48(%eax), %eax ret .globl GET GET: movl 4(%esp), %eax movl %fs, 8(%eax) movl %es, 12(%eax) movl %ds, 16(%eax) movl %ss, 76(%eax) movl %edi, 20(%eax) movl %esi, 24(%eax) movl %ebp, 28(%eax) movl %ebx, 36(%eax) movl %edx, 40(%eax) movl %ecx, 44(%eax) movl $1, 48(%eax) /* %eax */ movl (%esp), %ecx /* %eip */ movl %ecx, 60(%eax) leal 4(%esp), %ecx /* %esp */ movl %ecx, 72(%eax) movl 44(%eax), %ecx /* restore %ecx */ movl $0, %eax ret #endif // c ä¸­çš„ Context struct Context { ucontext_t uc; }; åˆ°æ­¤ï¼Œç”¨æˆ·çº§ task( coroutine )åˆ‡æ¢/è°ƒåº¦/è¿è¡Œå·¥ä½œåŸºæœ¬å¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚ æ€»ç»“ä¸€ä¸‹ï¼š coroutine æ˜¯å•çº¿ç¨‹ç¨‹åºï¼Œå¯ä»¥ä¸²è¡Œçš„è·‘å¤šä¸ªä»»åŠ¡ï¼›å¤šä¸ªä»»åŠ¡é€šè¿‡ä¸€ä¸ª scheduler task åˆ‡æ¢ï¼›åˆ‡æ¢çš„æ–¹å¼æ˜¯é€šè¿‡æ›¿æ¢cpuçš„å¯„å­˜å™¨å®ç°çš„ï¼›åˆ‡æ¢çš„è¿‡ç¨‹ os kernel æ˜¯ä¸çŸ¥é“çš„; ç”±äº context switch åªæ˜¯æ‰§è¡Œ 30+ ä¸ªæ±‡ç¼–æŒ‡ä»¤ï¼Œï¼ˆos context switch éœ€è¦è‡³å°‘ä¸¤æ¬¡ context switchï¼Œä»¥åŠä¸€äº›çŠ¶æ€ç»´æŠ¤ï¼Œç›¸æ¯”è¾ƒæ¥è¯´ï¼‰å¼€é”€æ›´å°ï¼Œcpu çš„åˆ©ç”¨ç‡ä¼šæé«˜ä¸å°‘ï¼›ä½¿ç”¨åŒæ­¥çš„æ–¹å¼å†™å‡ºå¯ä»¥å¼‚æ­¥æ‰§è¡Œçš„ä»£ç ï¼Œç¬¦åˆäººçš„æ™®éæ€è€ƒæ–¹å¼ã€‚ ","date":"2021-08-08","objectID":"/go-scheduler-intenal-and-gmp/:2:0","tags":null,"title":"golang è°ƒåº¦å™¨åº•å±‚åŸç†åŠ GMP å·¥ä½œåŸç†","uri":"/go-scheduler-intenal-and-gmp/"},{"categories":null,"content":"channel çš„å·¥ä½œæ–¹å¼ è¿™ä¸€èŠ‚å†…å®¹å’Œåç¨‹æœºç†æ²¡æœ‰ç›´æ¥è”ç³»ï¼Œä½†æ˜¯å› ä¸ºchannelæ€»æ˜¯ä¼´éšç€goroutineå‡ºç°ï¼Œæ‰€ä»¥æˆ‘ä»¬ é¡ºä¾¿äº†è§£ä¸€ä¸‹channelçš„åŸç†ä¹Ÿé¢‡æœ‰å¥½å¤„ã€‚å¹¸è¿çš„æ˜¯ï¼Œlibtask ä¸­ä¹Ÿæä¾›äº†channelçš„å‚è€ƒå®ç°. channel åˆ†ä¸ºæœ‰ buf å’Œ æ—  buf channel å¯¹äºæ—  buf çš„ channel æŸä¸€ä¸ª task æ‰§è¡Œ chansendul ä¼šç›´æ¥å°†å½“å‰ task åŠ å…¥ channel çš„ send é˜Ÿåˆ—ä¸­ï¼Œç„¶åè§¦å‘ä¸€æ¬¡ context switchã€‚ç”±äºæ­¤æ—¶ channel çš„ task å·²ç»ä¸åœ¨ taskrunqueue ä¸­ï¼Œå‘é€æ•°æ®åˆ° channel çš„ task ä¸ä¼šå†è¢« taskscheduler è°ƒåº¦åˆ°ï¼Œç›´åˆ° chanrecvul task è¢«è°ƒåº¦ï¼Œä¸”æ¶ˆè´¹ channel ä¸­çš„æ•°æ®ï¼Œæ­¤æ—¶ å‘é€ç«¯ task é‡æ–°è¢«æ”¾åˆ°å¯æ‰§è¡Œé˜Ÿåˆ—ä¸­ã€‚ å¯¹äº æœ‰ buf çš„ channel æŸä¸€ä¸ª task æ‰§è¡Œ chansendulï¼Œå¦‚æœ channel buf æ²¡æœ‰æ»¡ï¼Œåˆ™ä¼šå°†æ•°æ®å¤åˆ¶åˆ° channel buf ä¸­ï¼Œtask ä¼šç»§ç»­æ‰§è¡Œã€‚ å¦‚æœ channel buf å·²æ»¡ï¼Œä¼šå°† send task è¿› channel send ç­‰å¾…é˜Ÿåˆ—ï¼Œå¹¶è®©å‡º cpuã€‚ chanrecvul task æ¥å—æ•°æ®æ—¶å€™ï¼Œå¦‚æœ channel buf ä¸ä¸ºç©ºï¼Œåˆ™ä¼šç›´æ¥æ¶ˆè´¹ buf ä¸­çš„æ•°æ®ï¼›å¦‚æœ buf ä¸ºç©ºï¼Œåˆ™ä¼š åŠ å…¥ channel çš„ recv ç­‰å¾…é˜Ÿåˆ—ï¼Œå¹¶è®©å‡º cpuï¼Œç›´åˆ°æœ‰æ–°çš„æ•°æ®è¢«send åˆ° channel ä¸ºæ­¢ã€‚ ","date":"2021-08-08","objectID":"/go-scheduler-intenal-and-gmp/:2:1","tags":null,"title":"golang è°ƒåº¦å™¨åº•å±‚åŸç†åŠ GMP å·¥ä½œåŸç†","uri":"/go-scheduler-intenal-and-gmp/"},{"categories":null,"content":"golang goroutine å·¥ä½œæ–¹å¼ äº†è§£äº†ä¼ ç»Ÿ coroutine çš„å®ç°æ–¹å¼ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ golang çš„ goroutine çš„å·¥ä½œæ–¹å¼. golang å®ç°äº†ä¸€ç§å«åš å·¥ä½œçªƒå–ä»»åŠ¡è°ƒåº¦. å…·ä½“çš„åŠŸèƒ½ä»‹ç»è§: [ç¿»è¯‘]The Go scheduler å…·ä½“çš„æ›´è¯¦ç»†çš„æºç åˆ†æè§ï¼šGo è°ƒåº¦å™¨ ","date":"2021-08-08","objectID":"/go-scheduler-intenal-and-gmp/:3:0","tags":null,"title":"golang è°ƒåº¦å™¨åº•å±‚åŸç†åŠ GMP å·¥ä½œåŸç†","uri":"/go-scheduler-intenal-and-gmp/"},{"categories":null,"content":"åŸºæœ¬çš„ç»„æˆå…ƒç´ å’Œå·¥ä½œæ–¹å¼ Gã€Pã€M G: è¡¨ç¤º Goroutineï¼Œæ¯ä¸ª Goroutine å¯¹åº”ä¸€ä¸ª G ç»“æ„ä½“ï¼ŒG å­˜å‚¨ Goroutine çš„è¿è¡Œå †æ ˆã€çŠ¶æ€ä»¥åŠä»»åŠ¡å‡½æ•°ï¼Œå¯é‡ç”¨ã€‚G å¹¶éæ‰§è¡Œä½“ï¼Œæ¯ä¸ª G éœ€è¦ç»‘å®šåˆ° P æ‰èƒ½è¢«è°ƒåº¦æ‰§è¡Œã€‚ P: Processorï¼Œè¡¨ç¤ºé€»è¾‘å¤„ç†å™¨ï¼Œ å¯¹ G æ¥è¯´ï¼ŒP ç›¸å½“äº CPU æ ¸ï¼ŒG åªæœ‰ç»‘å®šåˆ° P(åœ¨ P çš„ local runq ä¸­)æ‰èƒ½è¢«è°ƒåº¦ã€‚å¯¹ M æ¥è¯´ï¼ŒP æä¾›äº†ç›¸å…³çš„æ‰§è¡Œç¯å¢ƒ(Context)ï¼Œå¦‚å†…å­˜åˆ†é…çŠ¶æ€(mcache)ï¼Œä»»åŠ¡é˜Ÿåˆ—(G)ç­‰ï¼ŒP çš„æ•°é‡å†³å®šäº†ç³»ç»Ÿå†…æœ€å¤§å¯å¹¶è¡Œçš„ G çš„æ•°é‡ï¼ˆå‰æï¼šç‰©ç† CPU æ ¸æ•° \u003e= P çš„æ•°é‡ï¼‰ï¼ŒP çš„æ•°é‡ç”±ç”¨æˆ·è®¾ç½®çš„ GOMAXPROCS å†³å®šï¼Œä½†æ˜¯ä¸è®º GOMAXPROCS è®¾ç½®ä¸ºå¤šå¤§ï¼ŒP çš„æ•°é‡æœ€å¤§ä¸º 256ã€‚ M: Machineï¼ŒOS çº¿ç¨‹æŠ½è±¡ï¼Œä»£è¡¨ç€çœŸæ­£æ‰§è¡Œè®¡ç®—çš„èµ„æºï¼Œåœ¨ç»‘å®šæœ‰æ•ˆçš„ P åï¼Œè¿›å…¥ schedule å¾ªç¯ï¼›è€Œ schedule å¾ªç¯çš„æœºåˆ¶å¤§è‡´æ˜¯ä» Global é˜Ÿåˆ—ã€P çš„ Local é˜Ÿåˆ—ä»¥åŠ wait é˜Ÿåˆ—ä¸­è·å– Gï¼Œåˆ‡æ¢åˆ° G çš„æ‰§è¡Œæ ˆä¸Šå¹¶æ‰§è¡Œ G çš„å‡½æ•°ï¼Œè°ƒç”¨ goexit åšæ¸…ç†å·¥ä½œå¹¶å›åˆ° Mï¼Œå¦‚æ­¤åå¤ã€‚M å¹¶ä¸ä¿ç•™ G çŠ¶æ€ï¼Œè¿™æ˜¯ G å¯ä»¥è·¨ M è°ƒåº¦çš„åŸºç¡€ï¼ŒM çš„æ•°é‡æ˜¯ä¸å®šçš„ï¼Œç”± Go Runtime è°ƒæ•´ï¼Œä¸ºäº†é˜²æ­¢åˆ›å»ºè¿‡å¤š OS çº¿ç¨‹å¯¼è‡´ç³»ç»Ÿè°ƒåº¦ä¸è¿‡æ¥ï¼Œç›®å‰é»˜è®¤æœ€å¤§é™åˆ¶ä¸º 10000 ä¸ªã€‚ ä»»åŠ¡é˜Ÿåˆ—å…±æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ p ä¸Šçš„æœ¬åœ°é˜Ÿåˆ—ï¼Œå¦ä¸€ç§æ˜¯ global queueã€‚å½“ä½¿ç”¨ go å…³é”®è¯å¯åŠ¨ä¸€ä¸ªæ–°çš„ goroutine çš„æ—¶å€™ï¼Œè¿™æ—¢å¯èƒ½æ˜¯å…¨å±€çš„è¿è¡Œé˜Ÿåˆ—ï¼Œä¹Ÿå¯èƒ½æ˜¯å¤„ç†å™¨æœ¬åœ°çš„è¿è¡Œé˜Ÿåˆ—ã€‚ runtime.runqput å¯çŸ¥ï¼Œ å½“ next ä¸º true æ—¶ï¼Œä¼šå°† Goroutine è®¾ç½®åˆ°å¤„ç†å™¨çš„ runnext ä½œä¸ºä¸‹ä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œçš„ä»»åŠ¡ï¼› å½“ next ä¸º false å¹¶ä¸”æœ¬åœ°é˜Ÿåˆ—è¿˜æœ‰å‰©ä½™ç©ºé—´ï¼ŒGoroutine ä¼šè¢«æ”¾åˆ°æœ¬åœ°è¿è¡Œé˜Ÿåˆ—ä¸Šï¼› å½“å¤„ç†å™¨çš„æœ¬åœ°è¿è¡Œé˜Ÿåˆ—å·²ç»æ²¡æœ‰å‰©ä½™ç©ºé—´æ—¶å°±ä¼šæŠŠæœ¬åœ°é˜Ÿåˆ—ä¸­çš„ä¸€éƒ¨åˆ† Goroutine å’Œå¾…åŠ å…¥çš„ Goroutine é€šè¿‡ runtime.runqputslow æ·»åŠ åˆ°è°ƒåº¦å™¨æŒæœ‰çš„å…¨å±€è¿è¡Œé˜Ÿåˆ—ä¸Šï¼› è°ƒåº¦å¯æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ã€‚ runtime.schedule å‡½æ•°ä¼šä»ä¸‹é¢å‡ ä¸ªåœ°æ–¹æŸ¥æ‰¾å¾…æ‰§è¡Œçš„ Goroutineï¼š ä¸ºäº†ä¿è¯å…¬å¹³ï¼Œå½“å…¨å±€è¿è¡Œé˜Ÿåˆ—ä¸­æœ‰å¾…æ‰§è¡Œçš„ Goroutine æ—¶ï¼Œé€šè¿‡ schedtick ä¿è¯æœ‰ä¸€å®šå‡ ç‡ä¼šä»å…¨å±€çš„è¿è¡Œé˜Ÿåˆ—ä¸­æŸ¥æ‰¾å¯¹åº”çš„ Goroutineï¼› ä»å¤„ç†å™¨æœ¬åœ°çš„è¿è¡Œé˜Ÿåˆ—ä¸­æŸ¥æ‰¾å¾…æ‰§è¡Œçš„ Goroutineï¼› å¦‚æœå‰ä¸¤ç§æ–¹æ³•éƒ½æ²¡æœ‰æ‰¾åˆ° Goroutineï¼Œä¼šé€šè¿‡ runtime.findrunnable è¿›è¡Œé˜»å¡åœ°æŸ¥æ‰¾ Goroutine. å¦‚æœå¤„ç†å™¨æ²¡æœ‰ä»»åŠ¡å¯å¤„ç†ï¼Œå®ƒä¼šæŒ‰ä»¥ä¸‹è§„åˆ™æ¥æ‰§è¡Œï¼Œç›´åˆ°æ»¡è¶³æŸä¸€æ¡è§„åˆ™ï¼š ä»æœ¬åœ°é˜Ÿåˆ—è·å–ä»»åŠ¡ ä»å…¨å±€é˜Ÿåˆ—è·å–ä»»åŠ¡ ä»ç½‘ç»œè½®è¯¢å™¨è·å–ä»»åŠ¡ ä»å…¶å®ƒçš„å¤„ç†å™¨çš„æœ¬åœ°é˜Ÿåˆ—çªƒå–ä»»åŠ¡ ","date":"2021-08-08","objectID":"/go-scheduler-intenal-and-gmp/:3:1","tags":null,"title":"golang è°ƒåº¦å™¨åº•å±‚åŸç†åŠ GMP å·¥ä½œåŸç†","uri":"/go-scheduler-intenal-and-gmp/"},{"categories":null,"content":"åŸºäº goroutine å·¥ä½œæ–¹å¼ï¼Œæœ‰å“ªäº›ä¼˜ç‚¹ç‚¹ç¼ºç‚¹ï¼Œç¼ºç‚¹å¦‚ä½•è§„é¿ ","date":"2021-08-08","objectID":"/go-scheduler-intenal-and-gmp/:4:0","tags":null,"title":"golang è°ƒåº¦å™¨åº•å±‚åŸç†åŠ GMP å·¥ä½œåŸç†","uri":"/go-scheduler-intenal-and-gmp/"},{"categories":null,"content":"ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼š ç”±äº golang goroutine å®ç°çš„ scheduler æ¯”è¾ƒç®€å•ï¼Œåœ¨å¤§é‡ goroutine è°ƒåº¦æ—¶å€™æ€§èƒ½æ¶ˆè€—ç›¸æ¯”è¾ƒ os thread çš„è°ƒåº¦æ¥è¯´ä¼šä½è‡³å°‘ä¸€ä¸ªæ•°é‡çº§ã€‚ ç¼ºç‚¹ï¼š scheduler çš„å®ç°ç»†èŠ‚éå¸¸å¤šï¼Œå¤æ‚ ç”¨æˆ·æƒ³ hack è‡ªå·±çš„çº¿ç¨‹æ¨¡å‹åŸºæœ¬ä¸å¯èƒ½ (å½“ç„¶ golang çš„ scheduler å·²ç»è¶³å¤Ÿä¼˜ç§€äº†) ","date":"2021-08-08","objectID":"/go-scheduler-intenal-and-gmp/:4:1","tags":null,"title":"golang è°ƒåº¦å™¨åº•å±‚åŸç†åŠ GMP å·¥ä½œåŸç†","uri":"/go-scheduler-intenal-and-gmp/"},{"categories":null,"content":"goroutine pool 10M(ç™¾ä¸‡) goroutine æ‰§è¡Œè½»é‡æ“ä½œä¼šå‡ºç°ç“¶é¢ˆï¼Œéœ€è¦è€ƒè™‘ goroutine pool æ¥åšä¼˜åŒ–äº† golang æœ‰ gcï¼Œgoroutine çš„åˆ›å»ºä¸åˆ é™¤è¿˜æ˜¯éœ€è¦ç”³è¯·å†…å­˜çš„ï¼Œå¦‚æœå¯ä»¥ï¼Œå°½é‡ä½¿ç”¨ poolï¼Œè®© goroutineè°ƒåº¦å‹åŠ›å°½é‡å°ä¸€ç‚¹ï¼Œç”¨æˆ·ç¨‹åºå¤ç”¨ goroutineã€‚å¯ä»¥ä½¿ç”¨ goroutine pool å®ç° goroutine çš„å¤ç”¨ã€‚åŒæ—¶ä¸å¥½çš„ pool å®ç°ä¹Ÿä¼šè®©ä¸€æŠŠé”ç ´åæ‰å¥½çš„æ€§èƒ½ã€‚æ˜¯å¦ä½¿ç”¨ï¼Œéœ€è¦è§†æƒ…å†µè€Œå®š. ","date":"2021-08-08","objectID":"/go-scheduler-intenal-and-gmp/:4:2","tags":null,"title":"golang è°ƒåº¦å™¨åº•å±‚åŸç†åŠ GMP å·¥ä½œåŸç†","uri":"/go-scheduler-intenal-and-gmp/"},{"categories":null,"content":"ref GMP å¹¶å‘è°ƒåº¦å™¨æ·±åº¦è§£æä¹‹æ‰‹æ’¸ä¸€ä¸ªé«˜æ€§èƒ½ goroutine pool Scheduler structures golang/proposal Scalable Go Scheduler Design Doc Scalable Go Scheduler Design Doc -zh Scalable Go Scheduler Design Doc -en ç¬¬ä¸€ä»£ Go Preemptive Scheduler Design Doc Scheduling Multithreaded Computations by Work Stealing ä¸‡å­—é•¿æ–‡æ·±å…¥æµ…å‡º Golang Runtime Goâ€™s work-stealing scheduler The Go runtime scheduler source go-scheduler go-scheduler-zh Go è¯­è¨€åå¹´è€Œç«‹ï¼ŒGo2 è“„åŠ¿å¾…å‘ ","date":"2021-08-08","objectID":"/go-scheduler-intenal-and-gmp/:5:0","tags":null,"title":"golang è°ƒåº¦å™¨åº•å±‚åŸç†åŠ GMP å·¥ä½œåŸç†","uri":"/go-scheduler-intenal-and-gmp/"},{"categories":null,"content":"TODO: golang scheduler ç›¸å…³çš„å†…å®¹ ","date":"2021-08-02","objectID":"/go-abstract/:0:0","tags":null,"title":"Go è¯­è¨€åå¹´è€Œç«‹ï¼ŒGo2 è“„åŠ¿å¾…å‘","uri":"/go-abstract/"},{"categories":null,"content":"Go è¯­è¨€åå¹´è€Œç«‹ï¼ŒGo2 è“„åŠ¿å¾…å‘ åœ¨ 21 ä¸–çºªçš„ç¬¬ä¸€ä¸ªåå¹´ï¼Œè®¡ç®—æœºåœ¨ä¸­å›½å¤§é™†æ‰é€æ¸å¼€å§‹æ™®åŠï¼Œé«˜æ ¡çš„è®¡ç®—æœºç›¸å…³ä¸“ä¸šä¹Ÿé€æ¸å˜å¾—çƒ­é—¨ã€‚å½“æ—¶å­¦æ ¡ä¸»è¦ä»¥ C/C++å’Œ Java è¯­è¨€å­¦ä¹ ä¸ºä¸»ï¼Œè€Œè¿™äº›è¯­è¨€å¤§å¤šæ˜¯ä¸Šä¸ªä¸–çºª 90 å¹´ä»£æˆ–æ›´æ—©è¯ç”Ÿçš„ï¼Œå› æ­¤è¿™äº›è®¡ç®—æœºé¢†åŸŸçš„ç†è®ºçŸ¥è¯†æˆ–ç¼–ç¨‹è¯­è¨€ä»¿ä½›æ˜¯ä¸Šå¸åˆ›ä¸–çºªæ—¶çš„äº§ç‰©ï¼Œä½œä¸ºè®¡ç®—æœºç›¸å…³ä¸“ä¸šçš„å­¦ç”Ÿåªèƒ½ä»°æœ›è¿™äº›æˆæœã€‚ Go è¯­è¨€è¯ç”Ÿåœ¨ 21 ä¸–çºªæ–°ä¸€æ³¢å·¥ä¸šç¼–ç¨‹è¯­è¨€å³å°†çˆ†å‘çš„æ—¶æœŸã€‚åœ¨ 2010 å¹´å‰åè¯ç”Ÿäº†ç¼–è¯‘å‹è¯­è¨€ Rustã€Kotlin å’Œ Swift è¯­è¨€ï¼Œå‰ç«¯è¯ç”Ÿäº† Dartã€TypeScript ç­‰å·¥ä¸šå‹è¯­è¨€ï¼Œæœ€æ–°å‡ºç°çš„ V è¯­è¨€æ›´ç”šè‡³å°è¯•ç«™åœ¨ Go å’Œ Rust è¯­è¨€è‚©è†€ä¹‹ä¸Šåˆ›æ–°ã€‚è€Œè¿™äº›å˜åŒ–éƒ½å‘ç”Ÿåœ¨æˆ‘ä»¬èº«è¾¹ï¼Œè®©ä¸­å›½çš„è®¡ç®—æœºçˆ±å¥½è€…åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­è§è¯å†å²çš„å‘å±•ï¼Œç”šè‡³æœ‰æœºä¼šå‚ä¸å…¶ä¸­ã€‚ 2019 å¹´æ˜¯ CSDN çš„äºŒåå‘¨å¹´ï¼Œä¹Ÿæ˜¯ Go è¯­è¨€é¢ä¸–åå‘¨å¹´ã€‚æ„Ÿè°¢ CSDN å¹³å°æä¾›çš„æœºä¼šï¼Œè®©ç¬”è€…å¯ä»¥è·Ÿå¤§å®¶åˆ†äº«åå¹´æ¥ä¸­å›½ Go è¯­è¨€ç¤¾åŒºçš„ä¸€äº›æ•…äº‹ã€‚ Go è¯­è¨€è¯ç”Ÿ Go è¯­è¨€æœ€åˆç”± Google å…¬å¸çš„ Robert Griesemerã€Ken Thompson å’Œ Rob Pike ä¸‰ä½å¤§ç‰›äº 2007 å¹´å¼€å§‹è®¾è®¡å‘æ˜çš„ã€‚**å…¶è®¾è®¡æœ€åˆçš„æ´ªè’ä¹‹åŠ›æ¥è‡ªäºå¯¹è¶…çº§å¤æ‚çš„ C++11 ç‰¹æ€§çš„å¹æ§æŠ¥å‘Šçš„é„™è§†ï¼Œæœ€ç»ˆç›®æ ‡æ˜¯è®¾è®¡ç½‘ç»œå’Œå¤šæ ¸æ—¶ä»£çš„ C è¯­è¨€ã€‚**åˆ° 2008 å¹´ä¸­æœŸï¼Œè¯­è¨€çš„å¤§éƒ¨åˆ†ç‰¹æ€§è®¾è®¡å·²ç»å®Œæˆï¼Œå¹¶å¼€å§‹ç€æ‰‹å®ç°ç¼–è¯‘å™¨å’Œè¿è¡Œï¼Œå¤§çº¦åœ¨è¿™ä¸€å¹´ Russ Cox ä½œä¸ºä¸»åŠ›å¼€å‘è€…åŠ å…¥ã€‚åˆ°äº† 2009 å¹´ï¼ŒGo è¯­è¨€å·²ç»é€æ­¥è¶‹äºç¨³å®šã€‚åŒå¹´ 9 æœˆï¼ŒGo è¯­è¨€æ­£å¼å‘å¸ƒå¹¶å¼€æºäº†ä»£ç ã€‚ ä»¥ä¸Šæ˜¯ã€ŠGo è¯­è¨€é«˜çº§ç¼–ç¨‹ã€‹ä¸€ä¹¦ä¸­ç¬¬ä¸€ç« ç¬¬ä¸€èŠ‚çš„å†…å®¹ã€‚Go è¯­è¨€åˆšåˆšå¼€æºçš„æ—¶å€™ï¼Œå¤§å®¶å¯¹å®ƒçš„ç¼–è¯‘é€Ÿåº¦å°è±¡å¼‚å¸¸æ·±åˆ»ï¼šç§’çº§ç¼–è¯‘å®Œæˆï¼Œå‡ ä¹åƒè„šæœ¬ä¸€æ ·å¯ä»¥é©¬ä¸Šç¼–è¯‘å¹¶æ‰§è¡Œã€‚åŒæ—¶ Go è¯­è¨€çš„éšå¼æ¥å£è®©ä¸€ä¸ªç¼–è¯‘å‹è¯­è¨€æœ‰äº†é¸­å­ç±»å‹çš„èƒ½åŠ›ï¼Œç¬”è€…ä¹Ÿç¬¬ä¸€æ¬¡è®¤è¯†åˆ°åŸæ¥ C++çš„è™šè¡¨ vtab ä¹Ÿå¯ä»¥åŠ¨æ€ç”Ÿæˆï¼è‡³äºå¤§å®¶æœ€æ„¿æ„è®¨è®ºçš„å¹¶éç‰¹æ€§ï¼Œå…¶å®å¹¶ä¸æ˜¯ Go è¯­è¨€æ–°å‘æ˜çš„åŸºçŸ³ï¼Œæ—©åœ¨ä¸Šä¸ªä¸–çºªçš„å…«ä¹åå¹´ä»£å°±æœ‰è¯¸å¤šè¯­è¨€å¼€å§‹é™†ç»­å°è¯•å°† CSP ç†è®ºå¼•å…¥ç¼–ç¨‹è¯­è¨€ï¼ˆRob Pike æ˜¯å…¶ä¸­åšå®šçš„å®è·µè€…ï¼‰ã€‚åªä¸è¿‡æ—©æœŸçš„ CSP å®è·µçš„è¯­è¨€æ²¡æœ‰è¿›å…¥ä¸»æµå¼€å‘é¢†åŸŸï¼Œå¯¼è‡´å¤§å®¶å¯¹è¿™ç§å¹¶å‘æ¨¡å¼æ¯”è¾ƒé™Œç”Ÿã€‚ é™¤äº†è¯­è¨€ç‰¹æ€§çš„åˆ›æ–°ä¹‹å¤–ï¼ŒGo è¯­è¨€è¿˜è‡ªå¸¦äº†ä¸€å¥—ç¼–è¯‘å’Œæ„å»ºå·¥å…·ï¼ŒåŒæ—¶å°å·§çš„æ ‡å‡†åº“æºå¸¦äº†å®Œå¤‡çš„ Web ç¼–ç¨‹åŸºç¡€æ„å»ºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ Go è¯­è¨€è½»æ¾ç¼–å†™ä¸€ä¸ªæ”¯æŒé«˜å¹¶å‘è®¿é—®çš„ Web æœåŠ¡ã€‚ ä½œä¸ºäº’è”ç½‘æ—¶ä»£çš„ C è¯­è¨€ï¼ŒGo è¯­è¨€ç»ˆäºå¼ºåŠ¿è¿›å…¥ä¸»æµçš„ç¼–ç¨‹é¢†åŸŸã€‚ Go è¯­è¨€åå¹´å¥‹è¿› Go ä» 2007 å¹´å¼€å§‹è®¾è®¡ï¼Œåœ¨ 2009 å¹´æ­£å¼å¯¹å¤–å…¬å¸ƒï¼Œè‡³ä»Šåˆšå¥½åå¹´ã€‚åå¹´æ¥ Go è¯­è¨€ä»¥ç¨³å®šè‘—ç§°ï¼ŒGo1.0 çš„ä»£ç åœ¨ 2019 å¹´ä¾ç„¶å¯ä»¥ä¸ç”¨ä¿®æ”¹ç›´æ¥è¢«ç¼–è¯‘è¿è¡Œã€‚ä½†æ˜¯åœ¨ä¿æŒè¯­è¨€ç¨³å®šçš„åŒæ—¶ï¼ŒGo è¯­è¨€ä¹Ÿåœ¨é€æ­¥å¤¯å®åŸºç¡€ï¼Œåå¹´æ¥ä¸€ç›´å‘ç€å®Œç¾çš„æé™é€¼è¿‘ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™åå¹´æ¥ Go è¯­è¨€æœ‰å“ªäº›å˜åŒ–ã€‚ ç•Œé¢å˜åŒ– é¦–å…ˆæ˜¯çœ‹çœ‹ç•Œé¢çš„å˜åŒ–ã€‚ç¬¬ä¸€æ¬¡æ˜¯åœ¨ 2009 åˆšå¼€æºçš„æ—¶å€™ï¼Œè¿™æ—¶å€™å¯ä»¥è¯´æ˜¯ Go è¯­è¨€çš„ä¸Šå¤æ—¶ä»£ã€‚Go è¯­è¨€çš„ä¸»é¡µå¦‚ä¸‹ï¼š é‚£ä¸ªå¹´ä»£çš„ Gopher ä»¬ï¼Œä½¿ç”¨çš„æ˜¯ hg å·¥å…·ä¸‹è½½ä»£ç ï¼ˆè€Œä¸æ˜¯ Gitï¼‰ï¼ŒGo ä»£ç æ˜¯åœ¨ Google Code æ‰˜ç®¡ï¼ˆè€Œä¸æ˜¯ GitHubï¼‰ã€‚éšç€ä»£ç çš„å‘å±•ï¼Œhg å·²ç»æ…¢æ…¢æ·¡å‡º Gopher è§†é‡ï¼ŒGoogle Code ç½‘ç«™ä¹Ÿæ—©å·²ç»å…³é—­ï¼Œè€Œ Go1 ä¹‹å‰çš„ä¸Šå¤æ—¶ä»£çš„ Go è€ä»£ç å·²ç»å¼€å§‹æ…¢æ…¢è…åŒ–äº†ã€‚ é¦–é¡µä¸­å¿ƒæ˜¯ Go è¯­è¨€æœ€å¼€å§‹çš„å£å·ï¼šGo è¯­è¨€æ˜¯å¯Œæœ‰è¡¨ç°åŠ›çš„ã€å¹¶å‘çš„ç¼–ç¨‹è¯­è¨€ï¼Œå¹¶ä¸”æ˜¯ç®€æ´çš„ã€‚åŒæ—¶ç»™äº†ä¸€ä¸ªâ€œHello, ä¸–ç•Œâ€çš„ä¾‹å­ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œçš„â€œä¸–ç•Œâ€æ˜¯æ—¥æ–‡ï¼‰ã€‚ ç„¶åå³ä¸Šè§’æ˜¯åˆå­¦è€…çš„ä¹å›­ï¼šé¦–å…ˆæ˜¯å®‰è£…ç¯å¢ƒï¼Œç„¶åå¯èƒ½æ˜¯æ—©æœŸçš„ä¸‰æ—¥æ•™ç¨‹ï¼Œç¬¬ä¸‰ä¸ªæ˜¯æ ‡å‡†åº“çš„ä½¿ç”¨ã€‚å³ä¸Šè§’çš„å›¾ç‰‡æ˜¯ Russ Cox çš„ä¸€ä¸ªè§†é¢‘ï¼Œåœ¨ Youtube åº”è¯¥è¿˜èƒ½æ‰¾åˆ°ã€‚ å·¦ä¸Šè§’æ˜¯ Go å®æˆ˜çš„é‚£ä¸ªç»å…¸æ–‡æ¡£ã€‚æ­¤å¤– FAQã€è¯­è¨€è§„èŒƒã€å†…å­˜æ¨¡å‹æ˜¯éå¸¸é‡è¦çš„æ ¸å¿ƒæ¸©åº¦ã€‚å·¦ä¸‹è§’è¿˜æœ‰ cmd ç­‰æ–‡æ¡£é“¾æ¥ï¼Œå­é¡µé¢çš„å†…å®¹åº”è¯¥æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ã€‚ ç„¶ååœ¨ 2012 å¹´å‡†å¤‡å‘å¸ƒç¬¬ä¸€ä¸ªæ­£å¼ç‰ˆæœ¬ Go1ï¼Œåœ¨ Go1 ä¹‹å‰è¯­è¨€ã€æ ‡å‡†åº“å’Œ godoc éƒ½è¿›è¡Œäº†å¤§é‡çš„æ”¹è¿›ã€‚Go1 é£æ ¼çš„é¡µé¢æ•ˆæœå¦‚ä¸‹ï¼š æ–°é¡µé¢åˆšå‡ºæ¥çš„æ—¶å€™æœ‰çœ¼ç›ä¸€äº®çš„æ„Ÿè§‰ï¼Œè¿™ä¸ªæ˜¯ç›®å‰å­˜åœ¨æ—¶é—´æœ€é•¿ä¹…çš„é¡µé¢å¸ƒå±€ã€‚ä½†æ˜¯ä¸ä»…ä»…æ˜¯ç¬”è€…æˆ‘ï¼Œç”šè‡³ Go è¯­è¨€å®˜æ–¹ä¹Ÿæ…¢æ…¢å¯¹ä¸­å›½é¡µé¢æœ‰ç‚¹å®¡ç¾ç–²åŠ³äº†ã€‚å› æ­¤ï¼Œä» 2018 å¹´å¼€å§‹ Go è¯­è¨€å¼€å§‹æ–°çš„ Logo å’Œç½‘ç«™çš„é‡æ–°è®¾è®¡å·¥ä½œã€‚ ä¸‹é¢çš„æ˜¯ Go è¯­è¨€æ–°çš„ Logoï¼š 2019 å¹´æ˜¯å¯¹ Go è¯­è¨€å‘å±•æå…¶é‡è¦çš„ä¸€å¹´ï¼Œä»Šå¹´ 8 æœˆå°†å‘å¸ƒ Go1.13ï¼Œè€Œè¿™ä¸ªç‰ˆæœ¬å°†æ­£å¼é‡å¯ Go è¯­è¨€è¯­æ³•çš„è¿›åŒ–ï¼Œå‘ç€ Go2 å‰è¿›ã€‚è€Œæ–°çš„ç½‘ç«™å·²ç»åœ¨ Go1.13 æ­£å¼å‘å¸ƒä¹‹å‰çš„ 7 æœˆä»½å°±å·²ç»ä¸Šçº¿ï¼š å¤´éƒ¨çš„æŒ‰é’®é£æ ¼çš„èœå•å˜æˆäº†å¹³é“ºçš„é£æ ¼ï¼Œæ˜¾å¾—æ›´åŠ é«˜å¤§ä¸Šã€‚åŒæ—¶é¡µé¢çš„é¢œè‰²åšäº†è°ƒæ•´ï¼Œä¿æŒå’Œæ–° Logo é¢œè‰²ä¸€è‡´ã€‚é¡µé¢çš„å¸ƒå±€ä¹Ÿåšäº†è°ƒæ•´ï¼Œå°†ä¸‹è½½å·¦å³ä¸¤åˆ—åšäº†è°ƒæ¢ã€‚åŒæ—¶åœ°é¼ çš„è„‘è¢‹æ­ªåˆ°ä¸€è¾¹ï¼Œä¼°è®¡æ˜¯é¢ˆæ¤ç—…å¤å‘äº†ã€‚ æ€»çš„æ¥è¯´ï¼ŒGo è¯­è¨€å®˜ç½‘ä¸»é¡µç»å†äº† Go1 å‰ã€Go1ï¼ˆ1.0 ï½ 1.10ï¼‰ã€Go1 åï¼ˆæˆ–è€…å« Go2 å‰ï¼‰ä¸‰ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«å¯¹åº” 3 ç§é£æ ¼çš„é¡µé¢ã€‚æ–°çš„å¸ƒå±€æˆ–è®¸ä¼šæˆä¸ºä¸‹ä¸ªåå¹´ Go2 çš„ä¸»åŠ›é¡µé¢ã€‚ è¯­æ³•å˜åŒ– Go è¯­è¨€è™½ç„¶ä» 2009 å¹´è¯ç”Ÿï¼Œä½†æ˜¯åˆ°äº† 2012 å¹´æ‰å‘å¸ƒç¬¬ä¸€ä¸ªæ­£å¼çš„ç‰ˆæœ¬ Go1ã€‚å…¶å®åœ¨ Go1 è¯ç”Ÿä¹‹å‰ Go è¯­è¨€å°±å·²ç»è¶³å¤Ÿç¨³å®šäº†ï¼Œå›½å†…çš„ä¸ƒç‰›äº‘ä» Go1 ä¹‹å‰å°±å¼€å§‹å¤§åŠ›è½¬å‘ Go è¯­è¨€å¼€å‘ï¼Œæ˜¯å›½å†…ç¬¬ä¸€å®¶å¹¿æ³›é‡‡ç”¨ Go è¯­è¨€å¼€å‘çš„äº’è”ç½‘å…¬å¸ã€‚Go1 çš„ç›®æ ‡æ˜¯æ¢³ç†è¯­æ³•å’Œæ ‡å‡†åº“é˜´æš—çš„è§’è½ï¼Œä¸ºåç»­çš„ 10 å¹´æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚ ä»ç›®å‰çš„ç»“æœçœ‹ï¼ŒGo1 æ— ç–‘æ˜¯å–å¾—äº†æå¤§çš„æˆæœï¼ŒGo1 æ—¶ä»£çš„ä»£ç ä¾ç„¶å¯ä»¥ä¸ç”¨ä¿®æ”¹å°±å¯ä»¥ç”¨æœ€æ–°çš„ Go è¯­è¨€å·¥å…·ç¼–è¯‘æ„å»ºï¼ˆä¸åŒ…å« CGO æˆ–æ±‡ç¼–è¯­è¨€éƒ¨åˆ†ï¼Œå› ä¸ºè¿™äº›å¤–å»¶çš„å·¥å…·å¹¶ä¸åœ¨ Go1 çš„æ‰¿è¯ºèŒƒå›´ï¼‰ã€‚ä½†æ˜¯ Go1 ä¹‹åä¾ç„¶æœ‰ä¸€äº›è¯­æ³•çš„æ›´æ–°ï¼Œåœ¨ Go1.10 å‰çš„ Go1 æ—¶ä»£è¯­æ³•å’Œæ ‡å‡†åº“éƒ¨åˆ†çš„é‡å¤§å˜åŒ–ä¸»è¦æœ‰ä¸‰ä¸ªï¼š ç¬¬ä¸€ä¸ªé‡å¤§çš„è¯­æ³•å˜åŒ–æ˜¯åœ¨ 2012 å¹´å‘å¸ƒçš„ Go1.2 ä¸­ï¼Œç»™åˆ‡ç‰‡è¯­æ³•å¢åŠ äº†å®¹é‡çš„æ§åˆ¶ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸åŒçš„åˆ‡ç‰‡ä¸å°å¿ƒè¶Šç•Œè®¿é—®æœ‰ç€ç›¸åŒåº•å±‚æ•°ç»„çš„å…¶å®ƒåˆ‡ç‰‡çš„å†…å­˜ã€‚ **ç¬¬äºŒä¸ªé‡å¤§çš„å˜åŒ–æ˜¯ 2016 å¹´å‘å¸ƒçš„ Go1.7 æ ‡å‡†åº“å¼•å…¥äº† context åŒ…ã€‚**context åŒ…æ˜¯ Go è¯­è¨€å®˜æ–¹å¯¹ Go è¿›è¡Œå¹¶å‘ç¼–ç¨‹çš„å®è·µæˆæœï¼Œç”¨æ¥ç®€åŒ–å¯¹äºå¤„ç†å•ä¸ªè¯·æ±‚çš„å¤šä¸ª Goroutine ä¹‹é—´ä¸è¯·æ±‚åŸŸçš„æ•°æ®ã€è¶…æ—¶å’Œé€€å‡ºç­‰æ“ä½œã€‚context åŒ…æ¨å‡ºåå°±è¢«ç¤¾åŒºå¿«é€Ÿå¸æ”¶ä½¿ç”¨ï¼Œä¾‹å¦‚ gRPC ä»¥åŠå¾ˆå¤š Web æ¡†æ¶éƒ½é€šè¿‡ context æ¥æ§åˆ¶ Goroutine çš„ç”Ÿå‘½å‘¨æœŸã€‚ **ç¬¬ä¸‰ä¸ªé‡å¤§çš„è¯­æ³•å˜åŒ–æ˜¯ 2017 å¹´å‘å¸ƒçš„ Go1.9 ï¼Œå¼•å…¥äº†ç±»å‹åˆ«åçš„ç‰¹æ€§ï¼š****type T1 = T2ã€‚**å…¶ä¸­ç±»å‹åˆ«å T1 æ˜¯é€šè¿‡=ç¬¦å·ä» T2 å®šä¹‰ï¼Œè¿™é‡Œçš„ T1 å’Œ T2 æ˜¯å®Œå…¨ç›¸åŒçš„ç±»å‹ã€‚ä¹‹æ‰€ä»¥å¼•å…¥ç±»å‹åˆ«åï¼Œå¾ˆå¤§çš„åŸå› æ˜¯ä¸ºäº†è§£å†³ Go1.7 å°† context æ‰©å±•åº“ç§»åŠ¨åˆ°æ ‡å‡†åº“å¸¦æ¥çš„é—®é¢˜ã€‚å› ä¸ºæ ‡å‡†åº“å’Œæ‰©å±•åº“ä¸­åˆ†åˆ«å®šä¹‰äº† context.Context ç±»å‹ï¼Œè€Œä¸åŒåŒ…ä¸­çš„ç±»å‹æ˜¯ä¸ç›¸å®¹çš„ã€‚è€Œ gRPC ç­‰å¾ˆå¤šå¼€æºçš„åº“ä½¿ç”¨çš„æ˜¯æœ€å¼€å§‹ä»¥æ¥çš„æ‰©å±•åº“ä¸­çš„ context.Context ç±»å‹ï¼Œç»“æœå¯¼è‡´å…¶æ— æ³•å’Œ Go1.7 æ ‡å‡†åº“ä¸­çš„ context.Context ç±»å‹å…¼å®¹ã€‚è¿™ä¸ªé—®é¢˜æœ€ç»ˆé€šè¿‡ç±»å‹åˆ«åè§£å†³äº†ï¼šæ‰©å±•åº“ä¸­çš„ context.Context ç±»å‹æ˜¯æ ‡å‡†åº“ä¸­ context.Context çš„åˆ«åç±»å‹ï¼Œä»è€Œå®ç°äº†å’Œæ ‡å‡†åº“çš„å…¼å®¹ã€‚ æ­¤å¤–è¿˜æœ‰ä¸€äº›è¯­æ³•ç»†èŠ‚çš„å˜åŒ–ï¼Œæ¯”å¦‚ Go1.4 å¯¹ for å¾ªç¯è¯­æ³•è¿›è¡Œäº†å¢å¼ºã€Go1.8 æ”¾å¼€å¯¹æœ‰ç€ç›¸åŒå†…å­˜å¸ƒå±€çš„ç»“æ„ä½“å¼ºåˆ¶è½¬å‹é™åˆ¶ã€‚è¯»è€…å¯ä»¥æ ¹æ®è‡ªå·±æ–°éœ€è¦æŸ¥çœ‹ç›¸å…³å‘å¸ƒæ—¥å¿—çš„æ–‡æ¡£è¯´æ˜ã€‚ è¿è¡Œæ—¶çš„å˜åŒ– è¿è¡Œæ—¶éƒ¨åˆ†æœ€å¤§çš„å˜åŒ–æ˜¯åŠ¨æ€æ ˆéƒ¨åˆ†ã€‚åœ¨ Go1.2 ä¹‹å‰ Go è¯­è¨€é‡‡ç”¨åˆ†æ®µæ ˆçš„æ–¹å¼å®ç°æ ˆçš„åŠ¨æ€ä¼¸ç¼©ã€‚ä½†æ˜¯åˆ†æ®µå¼åŠ¨æ€æ ˆæœ‰ä¸ªæ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºæ ˆå†…å­˜ä¸è¿ç»­ä¼šå¯¼è‡´ CPU ç¼“å­˜å‘½ä¸­ç‡ä¸‹é™ï¼Œä»è€Œå¯¼è‡´çƒ­ç‚¹çš„å‡½æ•°è°ƒç”¨æ€§èƒ½å—åˆ°å½±å“ã€‚å› æ­¤ä» Go1.3 å¼€å§‹è¯¥æœ‰è¿ç»­å¼çš„åŠ¨æ€æ ˆã€‚è¿ç»­å¼çš„åŠ¨æ€æ ˆè™½ç„¶éƒ¨åˆ†ç¼“è§£äº† CPU ç¼“å­˜å‘½ä¸­ç‡é—®é¢˜ï¼ˆä¾ç„¶å­˜åœ¨æ ˆçš„åˆ‡æ¢é—®é¢˜ï¼Œè¿™å¯èƒ½å¯¼è‡´ CPU ç¼“å­˜å¤±æ•ˆï¼‰ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†æ›´å¤§çš„å®ç°é—®é¢˜ï¼šæ ˆä¸Šå˜é‡çš„åœ°å€å¯èƒ½ä¼šéšç€æ ˆçš„ç§»åŠ¨è€Œå‘ç”Ÿå˜åŒ–ã€‚è¿™ç›´æ¥å¸¦æ¥äº† CGO ç¼–ç¨‹ä¸­ï¼ŒGo è¯­è¨€å†…å­˜å¯¹è±¡æ— æ³•ç›´æ¥ä¼ é€’ç»™ C è¯­è¨€ç©ºé—´ä½¿ç”¨ï¼Œå› æ­¤åæ¥ Go è¯­è¨€å®˜æ–¹é’ˆå¯¹ CGO é—®é¢˜åˆ¶å®šäº†å¤æ‚çš„å†…å­˜ä½¿ç”¨è§„èŒƒã€‚ æ€»ä½“æ¥è¯´ï¼ŒåŠ¨æ€æ ˆå¦‚ä½•å®ç°æ˜¯ä¸€ä¸ªå¦‚ä½•å–èˆçš„é—®é¢˜ï¼Œå› ä¸ºæ²¡æœ‰é“¶å¼¹ã€é±¼å’Œç†ŠæŒä¸å¯å…¼å¾—ï¼Œç›®å‰çš„é€‰æ‹©æ˜¯ç¬¬ä¸€ä¿è¯çº¯ Go ç¨‹åºçš„æ€§èƒ½ã€‚ GC æ€§èƒ½æ”¹è¿› Go è¯­è¨€æ˜¯ä¸€ä¸ªå¸¦è‡ªåŠ¨åƒåœ¾å›æ”¶çš„è¯­è¨€ï¼ˆGarbage Collection ï¼‰ï¼Œç®€ç§° GCï¼ˆæ³¨æ„è¿™æ˜¯å¤§å†™çš„ GCï¼Œå°å†™çš„ gc è¡¨ç¤º Go è¯­è¨€çš„ç¼–è¯‘å™¨ï¼‰ã€‚ä» Go è¯­è¨€è¯ç”Ÿå¼€å§‹ï¼ŒGC çš„å›æ”¶æ€§èƒ½å°±æ˜¯å¤§å®¶å…³æ³¨çš„çƒ­ç‚¹è¯é¢˜ã€‚ Go è¯­è¨€ä¹‹æ‰€ä»¥èƒ½å¤Ÿæ”¯æŒ GC ç‰¹æ€§ï¼Œæ˜¯å› ä¸º Go è¯­è¨€ä¸­æ¯ä¸ªå˜é‡éƒ½æœ‰å®Œå¤‡çš„å…ƒä¿¡æ¯ï¼Œé€šè¿‡è¿™äº›å…ƒä¿¡æ¯å¯ä»¥å¾ˆå®¹æ˜“è·Ÿè¸ªå…¨éƒ¨æŒ‡é’ˆçš„å£°æ˜å‘¨æœŸã€‚åœ¨ Go1.4 ä¹‹å‰ï¼ŒGC é‡‡ç”¨çš„æ˜¯ STW åœæ­¢ä¸–ç•Œçš„æ–¹å¼å›æ”¶å†…å­˜ï¼Œåœé¡¿çš„æ—¶é—´ç»å¸¸æ˜¯å‡ ç§’ç”šè‡³è¾¾åˆ°å‡ åç§’ã€‚å› æ­¤æ—©æœŸç¤¾åŒºæœ‰å¾ˆå¤šå¦‚ä½•è§„é¿æˆ–é™ä½ GC æ“ä½œçš„æŠ€å·§æ–‡ç« ã€‚ ç¬¬ä¸€æ¬¡ GC æ€§èƒ½å˜é©å‘ç”Ÿåœ¨ Go1.5 æ—¶æœŸï¼Œè¿™ä¸ªæ—¶å€™ Go è¯­","date":"2021-08-02","objectID":"/go-abstract/:1:0","tags":null,"title":"Go è¯­è¨€åå¹´è€Œç«‹ï¼ŒGo2 è“„åŠ¿å¾…å‘","uri":"/go-abstract/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šGo é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop ç¿»è¯‘, ä½¿ç”¨æ­£ç¡®çš„å·¥å…·åˆ†æç¨‹åºè¡Œä¸º åŸæ–‡åœ°å€ forked from here ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:0:0","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"Overview æœ¬æ¬¡ç ”è®¨è®²åº§çš„ç›®æ ‡æ˜¯è®©æ‚¨èƒ½å¤Ÿè¯Šæ–­ Go åº”ç”¨ç¨‹åºä¸­çš„æ€§èƒ½é—®é¢˜ï¼Œå¹¶ä¸”ä¿®å¤è¿™äº›é—®é¢˜ã€‚ è¿™ä¸€å¤©ï¼Œæˆ‘ä»¬å°†ä»å°åšèµ· - å­¦ä¹ å¦‚ä½•ç¼–å†™åŸºå‡†æµ‹è¯•ï¼Œç„¶ååˆ†æä¸€å°æ®µä»£ç ã€‚ç„¶åè®¨è®ºä»£ç æ‰§è¡Œè·Ÿè¸ªå™¨ï¼Œåƒåœ¾æ”¶é›†å™¨å’Œè·Ÿè¸ªè¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚æœ€åä¼šæœ‰å‰©ä¸‹çš„æ—¶é—´ï¼Œæ‚¨å¯ä»¥æå‡ºé—®é¢˜ï¼Œå¹¶å°è¯•ç¼–å†™æ‚¨è‡ªå·±çš„ä»£ç ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:1:0","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"Schedule è¿™é‡Œæ˜¯è¿™ä¸€å¤©çš„æ—¶é—´å®‰æ’è¡¨ï¼ˆå¤§æ¦‚ï¼‰ã€‚ å¼€å§‹æ—¶é—´ æè¿° 09:00 æ¬¢è¿ and ä»‹ç» 09:30 Benchmarking 10:45 ä¼‘æ¯ (15 åˆ†é’Ÿ) 11:00 æ€§èƒ½è¯„ä¼°å’Œåˆ†æ 12:00 åˆé¤ (90 åˆ†é’Ÿ) 13:30 ç¼–è¯‘ä¼˜åŒ– 14:30 æ‰§è¡Œè¿½è¸ªå™¨ 15:30 ä¼‘æ¯ (15 åˆ†é’Ÿ) 15:45 å†…å­˜å’Œåƒåœ¾å›æ”¶å™¨ 16:15 æç¤ºå’Œæ—…è¡Œ 16:30 ç»ƒä¹  16:45 æœ€åçš„é—®é¢˜å’Œç»“è®º 17:00 ç»“æŸ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:1:1","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"æ¬¢è¿ ä½ å¥½ï¼Œæ¬¢è¿! ğŸ‰ è¯¥ç ”è®¨çš„ç›®çš„æ˜¯ä¸ºæ‚¨æä¾›è¯Šæ–­å’Œä¿®å¤ Go åº”ç”¨ç¨‹åºä¸­çš„æ€§èƒ½é—®é¢˜æ‰€éœ€çš„å·¥å…·ã€‚ åœ¨è¿™ä¸€å¤©é‡Œï¼Œæˆ‘ä»¬å°†ä»ä¸€å°éƒ¨åˆ†å¼€å§‹ - å­¦ä¹ å¦‚ä½•ç¼–å†™åŸºå‡†æµ‹è¯•ï¼Œç„¶ååˆ†æä¸€å°æ®µä»£ç ã€‚ç„¶åæ‰©å±•åˆ°ï¼Œè®¨è®º æ‰§è¡Œè·Ÿè¸ªå™¨ï¼Œåƒåœ¾æ”¶é›†å™¨ å’Œè·Ÿè¸ªæ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚å‰©ä¸‹çš„å°†æ˜¯æé—®çš„æ—¶é—´ï¼Œå°è¯•è‡ªå·±ä½¿ç”¨ä»£ç æ¥å®è·µã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:2:0","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"è®²å¸ˆ Dave Cheney dave@cheney.net ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:2:1","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"å¼€æºè®¸å¯å’Œææ–™ è¯¥ç ”è®¨ä¼šæ˜¯ David Cheney å’Œ Francesc Campoyã€‚ æ­¤æ–‡ç« ä»¥ Creative Commons Attribution-ShareAlike 4.0 International ä½œä¸ºå¼€æºåè®®ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:2:2","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"é¢„å…ˆå·¥ä½œ ä¸‹é¢æ˜¯æ‚¨ä»Šå¤©éœ€è¦ä¸‹è½½çš„å‡ ä¸ªè½¯ä»¶ è®²ä¹ ä»£ç åº“ å°†æºä»£ç ä¸‹è½½åˆ°æœ¬æ–‡æ¡£ï¼Œå¹¶åœ¨ä»¥ä¸‹ä½ç½®è·å–ä»£ç ç¤ºä¾‹ high-performance-go-workshop ç”µè„‘æ‰§è¡Œç¯å¢ƒ è¯¥é¡¹ç›®å·¥ä½œç¯å¢ƒç›®æ ‡ä¸º Go 1.12ã€‚ Download Go 1.12 å¦‚æœæ‚¨å·²ç»å‡çº§åˆ° Go 1.13ï¼Œä¹Ÿå¯ä»¥äº†ã€‚åœ¨æ¬¡è¦çš„ Go ç‰ˆæœ¬ä¹‹é—´ï¼Œä¼˜åŒ–é€‰æ‹©æ€»æ˜¯ä¼šæœ‰ä¸€äº›å°çš„å˜åŒ–ï¼Œæˆ‘ä¼šåœ¨ç»§ç»­è¿›è¡Œæ—¶æŒ‡å‡ºã€‚ Graphviz åœ¨ pprof çš„éƒ¨åˆ†éœ€è¦ dot ç¨‹åºï¼Œå®ƒé™„å¸¦çš„å·¥å…· graphviz å¥—ä»¶ã€‚ Linux: [sudo] apt-get install graphviz OSX: MacPorts: sudo port install graphviz Homebrew: brew install graphviz Windows (untested) Google Chrome æ‰§è¡Œè·Ÿè¸ªå™¨ä¸Šçš„è¿™ä¸€éƒ¨åˆ†éœ€è¦ä½¿ç”¨ Google Chromeã€‚å®ƒä¸é€‚ç”¨äº Safariï¼ŒEdgeï¼ŒFirefox æˆ– IE 4.01ã€‚ Download Google Chrome æ‚¨çš„ä»£ç ä»¥è¿›è¡Œåˆ†æå’Œä¼˜åŒ– å½“å¤©çš„æœ€åéƒ¨åˆ†å°†æ˜¯å…¬å¼€è®²åº§ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­è¯•éªŒæ‰€å­¦çš„å·¥å…·ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:2:3","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"è¿˜æœ‰ä¸€äº›äº‹ â€¦â€‹ è¿™ä¸æ˜¯æ¼”è®²ï¼Œè€Œæ˜¯å¯¹è¯ã€‚æˆ‘ä»¬å°†æœ‰å¾ˆå¤šæ—¶é—´æ¥æé—®ã€‚ å¦‚æœæ‚¨å¬ä¸æ‡‚æŸäº›å†…å®¹ï¼Œæˆ–è®¤ä¸ºå¬ä¸æ­£ç¡®ï¼Œè¯·æå‡ºè¯¢é—®ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:2:4","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"1. å¾®å¤„ç†å™¨æ€§èƒ½çš„è¿‡å»ï¼Œç°åœ¨å’Œæœªæ¥ è¿™æ˜¯ä¸€ä¸ªæœ‰å…³ç¼–å†™é«˜æ€§èƒ½ä»£ç çš„ç ”è®¨ä¼šã€‚åœ¨å…¶ä»–ç ”è®¨ä¼šä¸Šï¼Œæˆ‘è°ˆåˆ°äº†åˆ†ç¦»çš„è®¾è®¡å’Œå¯ç»´æŠ¤æ€§ï¼Œä½†æ˜¯ä»Šå¤©æˆ‘ä»¬åœ¨è¿™é‡Œè°ˆè®ºæ€§èƒ½ã€‚ ä»Šå¤©ï¼Œæˆ‘æƒ³åšä¸€ä¸ªç®€çŸ­çš„æ¼”è®²ï¼Œå†…å®¹æ˜¯å…³äºæˆ‘å¦‚ä½•æ€è€ƒè®¡ç®—æœºå‘å±•å†å²ä»¥åŠä¸ºä»€ä¹ˆæˆ‘è®¤ä¸ºç¼–å†™é«˜æ€§èƒ½è½¯ä»¶å¾ˆé‡è¦ã€‚ ç°å®æ˜¯è½¯ä»¶åœ¨ç¡¬ä»¶ä¸Šè¿è¡Œï¼Œå› æ­¤è¦è°ˆè®ºç¼–å†™é«˜æ€§èƒ½ä»£ç ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦è°ˆè®ºè¿è¡Œä»£ç çš„ç¡¬ä»¶ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:3:0","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"1.1. Mechanical Sympathy ç›®å‰æœ‰ä¸€ä¸ªå¸¸ç”¨æœ¯è¯­ï¼Œæ‚¨ä¼šå¬åˆ°åƒé©¬ä¸Â·æ±¤æ™®æ£®ï¼ˆMartin Thompsonï¼‰æˆ–æ¯”å°”Â·è‚¯å°¼è¿ªï¼ˆBill Kennedyï¼‰è¿™æ ·çš„äººè°ˆè®º Mechanical Sympathyã€‚ Mechanical Sympathy è¿™ä¸ªåå­—æ¥è‡ªä¼Ÿå¤§çš„èµ›è½¦ æ‰‹æ°åŸºÂ·æ–¯å›¾å°”ç‰¹ï¼ˆJackie Stewartï¼‰ï¼Œä»–æ›¾ä¸‰åº¦è·å¾—ä¸–ç•Œä¸€çº§æ–¹ç¨‹å¼èµ›è½¦å† å†›ã€‚ä»–è®¤ä¸ºï¼Œæœ€å¥½çš„é©¾é©¶å‘˜å¯¹æœºå™¨çš„å·¥ä½œåŸç†æœ‰è¶³å¤Ÿçš„äº†è§£ï¼Œä»¥ä¾¿ä»–ä»¬å¯ä»¥ä¸æœºå™¨å’Œè°åœ°å·¥ä½œã€‚ è¦æˆä¸ºä¸€åå‡ºè‰²çš„èµ›è½¦æ‰‹ï¼Œæ‚¨ä¸éœ€è¦æˆä¸ºä¸€åå‡ºè‰²çš„æœºæ¢°å¸ˆï¼Œä½†æ‚¨éœ€è¦å¯¹æ±½è½¦çš„å·¥ä½œåŸç†æœ‰ä¸€ä¸ªç²—ç•¥çš„äº†è§£ã€‚ æˆ‘ç›¸ä¿¡æˆ‘ä»¬ä½œä¸ºè½¯ä»¶å·¥ç¨‹å¸ˆä¹Ÿæ˜¯å¦‚æ­¤ã€‚æˆ‘è®¤ä¸ºä¼šè®®å®¤ä¸­çš„ä»»ä½•äººéƒ½ä¸ä¼šæ˜¯ä¸“ä¸šçš„ CPU è®¾è®¡äººå‘˜ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å¿½ç•¥ CPU è®¾è®¡äººå‘˜é¢ä¸´çš„é—®é¢˜ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:3:1","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"1.2. å…­ä¸ªæ•°é‡çº§ æœ‰ä¸€ä¸ªå¸¸è§çš„ç½‘ç»œæ¨¡å‹æ˜¯è¿™æ ·çš„ï¼› å½“ç„¶è¿™æ˜¯è’è°¬çš„ï¼Œä½†æ˜¯å®ƒå¼ºè°ƒäº†è®¡ç®—æœºè¡Œä¸šå‘ç”Ÿäº†å¤šå°‘å˜åŒ–ã€‚ ä½œä¸ºè½¯ä»¶ä½œè€…ï¼Œæˆ‘ä»¬è¿™ä¸ªä¼šè®®å®¤çš„æ‰€æœ‰äººéƒ½å—ç›Šäºæ‘©å°”å®šå¾‹ï¼Œå³ 40 å¹´æ¥ï¼Œæ¯ 18 ä¸ªæœˆå°†èŠ¯ç‰‡ä¸Šå¯ç”¨æ™¶ä½“ç®¡çš„æ•°é‡å¢åŠ ä¸€å€ã€‚æ²¡æœ‰å…¶ä»–è¡Œä¸šç»å†è¿‡ å…­ä¸ªæ•°é‡çº§ [1] åœ¨ä¸€ç”Ÿçš„æ—¶é—´å†…æ”¹è¿›å…¶å·¥å…·ã€‚ ä½†è¿™ä¸€åˆ‡éƒ½åœ¨æ”¹å˜ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:3:2","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"1.3. è®¡ç®—æœºè¿˜åœ¨å˜å¿«å—ï¼Ÿ å› æ­¤ï¼Œæœ€åŸºæœ¬çš„é—®é¢˜æ˜¯ï¼Œé¢å¯¹ä¸Šå›¾æ‰€ç¤ºçš„ç»Ÿè®¡æ•°æ®ï¼Œæˆ‘ä»¬åº”è¯¥é—®è¿™ä¸ªé—®é¢˜å— è®¡ç®—æœºè¿˜åœ¨å˜å¿«å— ? å¦‚æœè®¡ç®—æœºçš„é€Ÿåº¦ä»åœ¨æé«˜ï¼Œé‚£ä¹ˆä¹Ÿè®¸æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒä»£ç çš„æ€§èƒ½ï¼Œåªéœ€ç¨ç­‰ä¸€ä¸‹ï¼Œç¡¬ä»¶åˆ¶é€ å•†å°†ä¸ºæˆ‘ä»¬è§£å†³æ€§èƒ½é—®é¢˜ã€‚ 1.3.1. è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ•°æ® è¿™æ˜¯ç»å…¸çš„æ•°æ®ï¼Œæ‚¨å¯ä»¥åœ¨ John L. Hennessy å’Œ David A. Patterson çš„ Computer Architecture, A Quantitative Approach ç­‰æ•™ç§‘ä¹¦ä¸­æ‰¾åˆ°ã€‚è¯¥å›¾æ‘˜è‡ªç¬¬ 5 ç‰ˆ åœ¨ç¬¬ 5 ç‰ˆä¸­ï¼Œè½©å°¼è¯—ï¼ˆHennessyï¼‰å’Œå¸•ç‰¹æ£®ï¼ˆPattersonï¼‰æå‡ºäº†è®¡ç®—æ€§èƒ½çš„ä¸‰ä¸ªæ—¶ä»£ é¦–å…ˆæ˜¯ 1970 å¹´ä»£å’Œ 80 å¹´ä»£åˆæœŸï¼Œè¿™æ˜¯å½¢æˆæ€§çš„å¹´ä»£ã€‚æˆ‘ä»¬ä»Šå¤©æ‰€çŸ¥é“çš„å¾®å¤„ç†å™¨å®é™…ä¸Šå¹¶ä¸å­˜åœ¨ï¼Œè®¡ç®—æœºæ˜¯ç”±åˆ†ç«‹æ™¶ä½“ç®¡æˆ–å°è§„æ¨¡é›†æˆç”µè·¯åˆ¶é€ çš„ã€‚æˆæœ¬ï¼Œå°ºå¯¸ä»¥åŠå¯¹ææ–™ç§‘å­¦ç†è§£çš„é™åˆ¶æ˜¯é™åˆ¶å› ç´ ã€‚ ä» 80 å¹´ä»£ä¸­æœŸåˆ° 2004 å¹´ï¼Œè¶‹åŠ¿çº¿å¾ˆæ˜æ˜¾ã€‚ è®¡ç®—æœºæ•´æ•°æ€§èƒ½æ¯å¹´å¹³å‡æé«˜ 52ï¼…ã€‚ è®¡ç®—æœºèƒ½åŠ›æ¯ä¸¤å¹´ç¿»ä¸€ç•ªï¼Œå› æ­¤äººä»¬å°†æ‘©å°”å®šå¾‹ï¼ˆèŠ¯ç‰‡ä¸Šçš„æ™¶ä½“ç®¡æ•°é‡å¢åŠ ä¸€å€ï¼‰ä¸è®¡ç®—æœºæ€§èƒ½æ··ä¸ºä¸€è°ˆã€‚ ç„¶åæˆ‘ä»¬è¿›å…¥è®¡ç®—æœºæ€§èƒ½çš„ç¬¬ä¸‰ä¸ªæ—¶ä»£ã€‚ äº‹æƒ…å˜æ…¢äº†ã€‚ æ€»å˜åŒ–ç‡ä¸ºæ¯å¹´ 22ï¼…ã€‚ ä¹‹å‰çš„å›¾è¡¨ä»…æŒç»­åˆ° 2012 å¹´ï¼Œä½†å¹¸è¿çš„æ˜¯åœ¨ 2012 å¹´ Jeff Preshing å†™äº† tool to scrape the Spec website and build your own graph. å› æ­¤ï¼Œè¿™æ˜¯ä½¿ç”¨ 1995 å¹´ åˆ° 2017 å¹´ çš„ Spec æ•°æ®çš„åŒä¸€å›¾ã€‚ å¯¹æˆ‘è€Œè¨€ï¼Œä¸å…¶è¯´æˆ‘ä»¬åœ¨ 2012 å¹´ çš„æ•°æ®ä¸­çœ‹åˆ°çš„æ­¥ä¼å˜åŒ–ï¼Œä¸å¦‚è¯´æ˜¯ å•æ ¸ æ€§èƒ½å·²æ¥è¿‘æé™ã€‚ è¿™äº›æ•°å­—å¯¹äºæµ®ç‚¹æ•°æ¥è¯´ç¨å¥½ä¸€äº›ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬åœ¨åšä¸šåŠ¡åº”ç”¨ç¨‹åºçš„æˆ¿é—´ä¸­æ¥è¯´ï¼Œè¿™å¯èƒ½å¹¶ä¸é‡è¦ã€‚ 1.3.2. æ˜¯çš„ï¼Œè®¡ç®—æœºä»åœ¨å˜å¾—è¶Šæ¥è¶Šæ…¢ å…³äºæ‘©å°”å®šå¾‹ç»ˆç»“çš„ç¬¬ä¸€ä»¶äº‹è¦è®°ä½ï¼Œå°±æ˜¯æˆˆç™»Â·æ‘©å°”å‘Šè¯‰æˆ‘çš„äº‹æƒ…ã€‚ä»–è¯´ï¼šâ€œæ‰€æœ‰æŒ‡æ•°éƒ½ç»“æŸäº†â€ã€‚â€‰â€”â€‰John Hennessy è¿™æ˜¯è½©å°¼è¯—åœ¨ Google Next 18 åŠå…¶å›¾çµå¥–æ¼”è®²ä¸­çš„å¼•æ–‡ã€‚ ä»–çš„è§‚ç‚¹æ˜¯è‚¯å®šçš„ï¼ŒCPU æ€§èƒ½ä»åœ¨æé«˜ã€‚ ä½†æ˜¯ï¼Œå•çº¿ç¨‹æ•´æ•°æ€§èƒ½ä»åœ¨æ¯å¹´æé«˜ 2-3ï¼… å·¦å³ã€‚ ä»¥è¿™ç§é€Ÿåº¦ï¼Œå®ƒå°†éœ€è¦ 20 å¹´çš„å¤åˆå¢é•¿æ‰èƒ½ä½¿æ•´æ•°æ€§èƒ½ç¿»å€ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œ90 å¹´ä»£çš„è¡¨ç°æ¯å¤©æ¯ä¸¤å¹´ç¿»ä¸€ç•ªã€‚ ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:3:3","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"1.4. æ—¶é’ˆé€Ÿåº¦ 2015 å¹´çš„è¿™å¼ å›¾å¾ˆå¥½åœ°è¯´æ˜äº†è¿™ä¸€ç‚¹ã€‚ ç¬¬ä¸€è¡Œæ˜¾ç¤ºäº†èŠ¯ç‰‡ä¸Šçš„æ™¶ä½“ç®¡æ•°é‡ã€‚ è‡ª 1970 å¹´ä»£ä»¥æ¥ï¼Œè¿™ç§è¶‹åŠ¿ä¸€ç›´ä»¥å¤§è‡´çº¿æ€§çš„è¶‹åŠ¿çº¿æŒç»­ã€‚ ç”±äºè¿™æ˜¯å¯¹æ•°/æ—çº¿å›¾ï¼Œå› æ­¤è¯¥çº¿æ€§åºåˆ—è¡¨ç¤ºæŒ‡æ•°å¢é•¿ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çœ‹ä¸­çº¿ï¼Œæˆ‘ä»¬çœ‹åˆ°æ—¶é’Ÿé€Ÿåº¦åå¹´æ¥æ²¡æœ‰å¢åŠ ï¼Œæˆ‘ä»¬çœ‹åˆ° CPU é€Ÿåº¦åœ¨ 2004 å¹´å·¦å³åœæ»äº†ã€‚ ä¸‹å›¾æ˜¾ç¤ºäº†æ•£çƒ­åŠŸç‡ï¼› å³å˜æˆç”µèƒ½çš„ç”µèƒ½éµå¾ªç›¸åŒçš„æ¨¡å¼-æ—¶é’Ÿé€Ÿåº¦å’Œ cpu æ•£çƒ­æ˜¯ç›¸å…³çš„ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:3:4","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"1.5. å‘çƒ­ ä¸ºä»€ä¹ˆ CPU ä¼šå‘çƒ­ï¼Ÿ è¿™æ˜¯ä¸€å°å›ºæ€è®¾å¤‡ï¼Œæ²¡æœ‰ç§»åŠ¨ç»„ä»¶ï¼Œå› æ­¤æ­¤å¤„çš„æ‘©æ“¦ç­‰æ•ˆæœå¹¶ä¸ï¼ˆç›´æ¥ï¼‰ç›¸å…³ã€‚ è¯¥å›¾æ‘˜è‡ª data sheet produced by TIã€‚ åœ¨æ­¤æ¨¡å‹ä¸­ï¼ŒN å‹è®¾å¤‡ä¸­çš„å¼€å…³è¢«å¸å¼•åˆ°æ­£ç”µå‹ï¼ŒP å‹è®¾å¤‡è¢«æ­£ç”µå‹å‡»é€€ã€‚ CMOS è®¾å¤‡çš„åŠŸè€—æ˜¯ä¸‰ä¸ªå› ç´ çš„æ€»å’Œï¼ŒCMOS åŠŸè€—æ˜¯æˆ¿é—´ï¼ŒåŠå…¬æ¡Œä¸Šå’Œå£è¢‹ä¸­æ¯ä¸ªæ™¶ä½“ç®¡çš„åŠŸç‡ã€‚ é™æ€åŠŸç‡ã€‚å½“æ™¶ä½“ç®¡æ˜¯é™æ€çš„ï¼Œå³ä¸æ”¹å˜å…¶çŠ¶æ€æ—¶ï¼Œä¼šæœ‰å°‘é‡ç”µæµé€šè¿‡æ™¶ä½“ç®¡æ³„æ¼åˆ°åœ°ã€‚ æ™¶ä½“ç®¡è¶Šå°ï¼Œæ³„æ¼è¶Šå¤šã€‚ æ³„æ¼é‡éšæ¸©åº¦è€Œå¢åŠ ã€‚å½“æ‚¨æ‹¥æœ‰æ•°åäº¿ä¸ªæ™¶ä½“ç®¡æ—¶ï¼Œå³ä½¿æ˜¯å¾ˆå°çš„æ³„æ¼ä¹Ÿä¼šåŠ èµ·æ¥ï¼ åŠ¨æ€åŠŸç‡ã€‚å½“æ™¶ä½“ç®¡ä»ä¸€ç§çŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ç§çŠ¶æ€æ—¶ï¼Œå®ƒå¿…é¡»å¯¹è¿æ¥åˆ°æ …æçš„å„ç§ç”µå®¹è¿›è¡Œå……ç”µæˆ–æ”¾ç”µã€‚ æ¯ä¸ªæ™¶ä½“ç®¡çš„åŠ¨æ€åŠŸç‡æ˜¯ç”µå‹ä¹˜ä»¥ç”µå®¹å’Œå˜åŒ–é¢‘ç‡çš„å¹³æ–¹ã€‚ é™ä½ç”µå‹å¯ä»¥å‡å°‘æ™¶ä½“ç®¡æ¶ˆè€—çš„åŠŸç‡ï¼Œä½†æ˜¯è¾ƒä½çš„ç”µå‹ä¼šä½¿æ™¶ä½“ç®¡çš„å¼€å…³é€Ÿåº¦å˜æ…¢ã€‚ æ’¬æ£æˆ–çŸ­è·¯ç”µæµã€‚æˆ‘ä»¬å–œæ¬¢å°†æ™¶ä½“ç®¡è§†ä¸ºæ•°å­—è®¾å¤‡ï¼Œæ— è®ºå…¶å¤„äºå¼€å¯çŠ¶æ€è¿˜æ˜¯å¤„äºåŸå­çŠ¶æ€ï¼Œéƒ½å æ®ä¸€ç§çŠ¶æ€æˆ–å¦ä¸€ç§çŠ¶æ€ã€‚ å®é™…ä¸Šï¼Œæ™¶ä½“ç®¡æ˜¯æ¨¡æ‹Ÿè®¾å¤‡ã€‚ å½“å¼€å…³æ—¶ï¼Œæ™¶ä½“ç®¡å¼€å§‹å‡ ä¹å…¨éƒ¨æˆªæ­¢ï¼Œå¹¶è½¬å˜æˆ–åˆ‡æ¢åˆ°å‡ ä¹å…¨éƒ¨å¯¼é€šçš„çŠ¶æ€ã€‚ è¿™ç§è½¬æ¢æˆ–åˆ‡æ¢æ—¶é—´éå¸¸å¿«ï¼Œåœ¨ç°ä»£å¤„ç†å™¨ä¸­çº¦ä¸ºçš®ç§’ï¼Œä½†æ˜¯å½“ä» Vcc åˆ°åœ°çš„ç”µé˜»è·¯å¾„å¾ˆä½æ—¶ï¼Œè¿™ä»ç„¶ä»£è¡¨äº†ä¸€æ®µæ—¶é—´ã€‚ æ™¶ä½“ç®¡åˆ‡æ¢çš„é€Ÿåº¦è¶Šå¿«ï¼Œå…¶é¢‘ç‡å°±ä¼šè€—æ•£æ›´å¤šçš„çƒ­é‡ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:3:5","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"1.6. Dennard æ‰©å±•çš„ç»ˆç»“ è¦äº†è§£æ¥ä¸‹æ¥å‘ç”Ÿçš„äº‹æƒ…ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹ Robert H. Dennard äº 1974 å¹´å…±åŒæ’°å†™çš„è®ºæ–‡ã€‚ ä¸¹çº³å¾·çš„ç¼©æ”¾å®šå¾‹å¤§è‡´ä¸ŠæŒ‡å‡ºï¼Œéšç€æ™¶ä½“ç®¡çš„å˜å°ï¼Œå®ƒä»¬çš„ power density ä¿æŒæ’å®šã€‚ è¾ƒå°çš„æ™¶ä½“ç®¡å¯ä»¥åœ¨è¾ƒä½çš„ç”µå‹ä¸‹è¿è¡Œï¼Œå…·æœ‰è¾ƒä½çš„æ …æç”µå®¹ï¼Œå¹¶ä¸”å¼€å…³é€Ÿåº¦æ›´å¿«ï¼Œè¿™æœ‰åŠ©äºå‡å°‘åŠ¨æ€åŠŸç‡ã€‚ é‚£ä¹ˆï¼Œç»“æœå¦‚ä½•å‘¢ï¼Ÿ äº‹å®å¹¶éå¦‚æ­¤ã€‚ å½“æ™¶ä½“ç®¡çš„æ …æé•¿åº¦æ¥è¿‘å‡ ä¸ªç¡…åŸå­çš„å®½åº¦æ—¶ï¼Œæ™¶ä½“ç®¡å°ºå¯¸ï¼Œç”µå‹ä¸é‡è¦çš„æ³„æ¼ä¹‹é—´çš„å…³ç³»å°±ç ´è£‚äº†ã€‚ å®ƒæ˜¯åœ¨ Micro-32 conference in 1999 å‡å®šçš„ï¼Œå¦‚æœæˆ‘ä»¬éµå¾ªäº†æé«˜æ—¶é’Ÿé€Ÿåº¦å’Œç¼©å°æ™¶ä½“ç®¡å°ºå¯¸çš„è¶‹åŠ¿çº¿ï¼Œé‚£ä¹ˆåœ¨å¤„ç†å™¨ä¸€ä»£ä¹‹å†…æ™¶ä½“ç®¡ç»“å°†æ¥è¿‘æ ¸ååº”å †å †èŠ¯çš„æ¸©åº¦ã€‚æ˜¾ç„¶ï¼Œè¿™æ˜¯è’è°¬çš„ã€‚å¥”è…¾ 4 marked the end of the line é€‚ç”¨äºå•æ ¸é«˜é¢‘æ¶ˆè´¹ç±» CPUã€‚ è¿”å›æ­¤å›¾ï¼Œæˆ‘ä»¬çœ‹åˆ°æ—¶é’Ÿé€Ÿåº¦åœæ­¢çš„åŸå› æ˜¯ CPU è¶…å‡ºäº†æˆ‘ä»¬å†·å´æ—¶é’Ÿçš„èƒ½åŠ›ã€‚ åˆ° 2006 å¹´ï¼Œå‡å°æ™¶ä½“ç®¡çš„å°ºå¯¸ä¸å†æé«˜å…¶åŠŸç‡æ•ˆç‡ã€‚ ç°åœ¨æˆ‘ä»¬çŸ¥é“ï¼Œå‡å° CPU åŠŸèƒ½çš„å¤§å°ä¸»è¦æ˜¯ä¸ºäº†é™ä½åŠŸè€—ã€‚ é™ä½åŠŸè€—ä¸ä»…æ„å‘³ç€â€œç»¿è‰²â€ï¼Œä¾‹å¦‚å›æ”¶åˆ©ç”¨ï¼Œè¿˜å¯ä»¥æ‹¯æ•‘åœ°çƒã€‚ ä¸»è¦ç›®æ ‡æ˜¯ä¿æŒåŠŸè€—ï¼Œä»è€Œä¿æŒæ•£çƒ­ï¼Œbelow levels that will damage the CPU. ä½†æ˜¯ï¼Œå›¾ä¸­çš„ä¸€éƒ¨åˆ†åœ¨ä¸æ–­å¢åŠ ï¼Œå³ç®¡èŠ¯ä¸Šçš„æ™¶ä½“ç®¡æ•°é‡ã€‚cpu çš„è¡Œè¿›å…·æœ‰å°ºå¯¸ç‰¹å¾ï¼Œåœ¨ç›¸åŒçš„ç»™å®šé¢ç§¯å†…æœ‰æ›´å¤šçš„æ™¶ä½“ç®¡ï¼Œæ—¢æœ‰æ­£é¢å½±å“ï¼Œä¹Ÿæœ‰è´Ÿé¢å½±å“ã€‚ åŒæ ·ï¼Œå¦‚æ‚¨åœ¨æ’å…¥ç‰©ä¸­æ‰€çœ‹åˆ°çš„ï¼Œç›´åˆ°å¤§çº¦ 5 å¹´å‰ï¼Œæ¯ä¸ªæ™¶ä½“ç®¡çš„æˆæœ¬ä¸€ç›´åœ¨ä¸‹é™ï¼Œç„¶åæ¯ä¸ªæ™¶ä½“ç®¡çš„æˆæœ¬åˆå¼€å§‹å›å‡ã€‚ åˆ¶é€ è¾ƒå°çš„æ™¶ä½“ç®¡ä¸ä»…å˜å¾—è¶Šæ¥è¶Šæ˜‚è´µï¼Œè€Œä¸”å˜å¾—è¶Šæ¥è¶Šå›°éš¾ã€‚ 2016 å¹´ çš„è¿™ä»½æŠ¥å‘Šæ˜¾ç¤ºäº†èŠ¯ç‰‡åˆ¶é€ å•†è®¤ä¸ºåœ¨ 2013 å¹´ ä¼šå‘ç”Ÿä»€ä¹ˆçš„é¢„æµ‹ã€‚ä¸¤å¹´åï¼Œä»–ä»¬é”™è¿‡äº†æ‰€æœ‰é¢„æµ‹ï¼Œå°½ç®¡æˆ‘æ²¡æœ‰æ­¤æŠ¥å‘Šçš„æ›´æ–°ç‰ˆæœ¬ï¼Œä½†æ²¡æœ‰è¿¹è±¡è¡¨æ˜ä»–ä»¬å°†èƒ½å¤Ÿæ‰­è½¬è¿™ä¸€è¶‹åŠ¿ã€‚ è‹±ç‰¹å°”ï¼Œå°ç§¯ç”µï¼ŒAMD å’Œä¸‰æ˜Ÿéƒ½è¦èŠ±è´¹æ•°åäº¿ç¾å…ƒï¼Œå› ä¸ºå®ƒä»¬å¿…é¡»å»ºé€ æ–°çš„æ™¶åœ†å‚ï¼Œè´­ä¹°æ‰€æœ‰æ–°çš„å·¥è‰ºå·¥å…·ã€‚å› æ­¤ï¼Œå°½ç®¡æ¯ä¸ªèŠ¯ç‰‡çš„æ™¶ä½“ç®¡æ•°é‡æŒç»­å¢åŠ ï¼Œä½†å…¶å•ä½æˆæœ¬å´å¼€å§‹å¢åŠ ã€‚ ç”šè‡³ä»¥çº³ç±³ä¸ºå•ä½çš„æœ¯è¯­ æ …æé•¿åº¦ ä¹Ÿå˜å¾—æ¨¡æ£±ä¸¤å¯ã€‚ å„ç§åˆ¶é€ å•†ä»¥ä¸åŒçš„æ–¹å¼æµ‹é‡å…¶æ™¶ä½“ç®¡çš„å°ºå¯¸ï¼Œä»è€Œä½¿å®ƒä»¬åœ¨æ²¡æœ‰äº¤ä»˜çš„æƒ…å†µä¸‹å¯ä»¥å±•ç¤ºæ¯”ç«äº‰å¯¹æ‰‹å°‘çš„æ•°é‡ã€‚è¿™æ˜¯ CPU åˆ¶é€ å•†çš„é GAAP æ”¶ç›ŠæŠ¥å‘Šæ¨¡å‹ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:3:6","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"1.7. æ›´å¤šçš„æ ¸å¿ƒ è¾¾åˆ°æ¸©åº¦å’Œé¢‘ç‡é™åˆ¶åï¼Œä¸å†å¯èƒ½ä½¿å•ä¸ªå†…æ ¸çš„è¿è¡Œé€Ÿåº¦å¿«ä¸¤å€ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ·»åŠ å¦ä¸€ä¸ªå†…æ ¸ï¼Œåˆ™å¯ä»¥æä¾›ä¸¤å€çš„å¤„ç†èƒ½åŠ›-å¦‚æœè½¯ä»¶å¯ä»¥æ”¯æŒçš„è¯ã€‚ å®é™…ä¸Šï¼ŒCPU çš„æ ¸å¿ƒæ•°é‡ä¸»è¦ç”±æ•£çƒ­å†³å®šã€‚ Dennard ç¼©æ”¾çš„æœ«å°¾æ„å‘³ç€ CPU çš„æ—¶é’Ÿé€Ÿåº¦æ˜¯ 1 åˆ° 4 Ghz ä¹‹é—´çš„ä»»æ„æ•°å­—ï¼Œå…·ä½“å–å†³äºå®ƒçš„æ¸©åº¦ã€‚åœ¨è°ˆè®ºåŸºå‡†æµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾ˆå¿«çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:3:7","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"1.8. é˜¿å§†è¾¾å°”å®šå¾‹ CPU å¹¶æ²¡æœ‰å˜å¾—è¶Šæ¥è¶Šå¿«ï¼Œä½†æ˜¯éšç€è¶…çº¿ç¨‹å’Œå¤šæ ¸å®ƒä»¬å˜å¾—è¶Šæ¥è¶Šå®½ã€‚ ç§»åŠ¨éƒ¨ä»¶ä¸ºåŒæ ¸ï¼Œå°å¼æœºéƒ¨ä»¶ä¸ºå››æ ¸ï¼ŒæœåŠ¡å™¨éƒ¨ä»¶ä¸ºæ•°åä¸ªå†…æ ¸ã€‚ è¿™å°†æ˜¯è®¡ç®—æœºæ€§èƒ½çš„æœªæ¥å—ï¼Ÿ ä¸å¹¸çš„æ˜¯æ²¡æœ‰ã€‚ é˜¿å§†è¾¾å°”å®šå¾‹ä»¥ IBM/360 çš„è®¾è®¡è€…å‰å§†Â·é˜¿å§†è¾¾å°”ï¼ˆGene Amdahlï¼‰çš„åå­—å‘½åï¼Œå®ƒæ˜¯ä¸€ä¸ªå…¬å¼ï¼Œå®ƒç»™å‡ºäº†åœ¨å›ºå®šå·¥ä½œè´Ÿè½½ä¸‹ä»»åŠ¡æ‰§è¡Œå»¶è¿Ÿçš„ç†è®ºä¸Šçš„åŠ é€Ÿï¼Œè¿™å¯ä»¥é€šè¿‡æ”¹å–„èµ„æºçš„ç³»ç»Ÿæ¥å®ç°ã€‚ é˜¿å§†è¾¾å°”å®šå¾‹å‘Šè¯‰æˆ‘ä»¬ï¼Œç¨‹åºçš„æœ€å¤§é€Ÿåº¦å—ç¨‹åºé¡ºåºéƒ¨åˆ†çš„é™åˆ¶ã€‚ å¦‚æœæ‚¨ç¼–å†™çš„ç¨‹åºçš„æ‰§è¡ŒåŠ›çš„ 95ï¼… å¯ä»¥å¹¶è¡Œè¿è¡Œï¼Œå³ä½¿æœ‰æˆåƒä¸Šä¸‡çš„å¤„ç†å™¨ï¼Œåˆ™ç¨‹åºæ‰§è¡Œçš„æœ€å¤§é€Ÿåº¦ä¹Ÿå°†é™åˆ¶ä¸º 20 å€ã€‚ è€ƒè™‘ä¸€ä¸‹æ‚¨æ¯å¤©ä½¿ç”¨çš„ç¨‹åºï¼Œå®ƒä»¬çš„æ‰§è¡Œé‡ä¸­æœ‰å¤šå°‘æ˜¯å¯ä»¥è§£æçš„ï¼Ÿ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:3:8","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"1.9. åŠ¨æ€ä¼˜åŒ– ç”±äºæ—¶é’Ÿé€Ÿåº¦åœæ»ä¸å‰ï¼Œå¹¶ä¸”ç”±äºæŠ›å‡ºé¢å¤–çš„å†…æ ¸è€Œäº§ç”Ÿçš„å›æŠ¥æœ‰é™ï¼Œå› æ­¤ï¼Œæé€Ÿæ¥è‡ªä½•å¤„ï¼Ÿ å®ƒä»¬æ¥è‡ªèŠ¯ç‰‡æœ¬èº«çš„ä½“ç³»ç»“æ„æ”¹è¿›ã€‚ è¿™äº›æ˜¯äº”åˆ°ä¸ƒå¹´çš„å¤§å‹é¡¹ç›®ï¼Œåç§°å¦‚ä¸‹ Nehalem, Sandy Bridge, and Skylake. åœ¨è¿‡å»çš„äºŒåå¹´ä¸­ï¼Œæ€§èƒ½çš„æ”¹å–„å¤§éƒ¨åˆ†æ¥è‡ªä½“ç³»ç»“æ„çš„æ”¹å–„: 1.9.1. ä¹±åºæ‰§è¡Œ ä¹±åºï¼Œä¹Ÿç§°ä¸ºè¶…æ ‡é‡ï¼Œæ‰§è¡Œæ˜¯ä¸€ç§ä» CPU æ­£åœ¨æ‰§è¡Œçš„ä»£ç ä¸­æå–æ‰€è°“çš„ æŒ‡ä»¤çº§å¹¶è¡Œæ€§ çš„æ–¹æ³•ã€‚ ç°ä»£ CPU åœ¨ç¡¬ä»¶çº§åˆ«æœ‰æ•ˆåœ°æ‰§è¡Œ SSAï¼Œä»¥è¯†åˆ«æ“ä½œä¹‹é—´çš„æ•°æ®ä¾èµ–æ€§ï¼Œå¹¶åœ¨å¯èƒ½çš„æƒ…å†µä¸‹å¹¶è¡Œè¿è¡Œç‹¬ç«‹çš„æŒ‡ä»¤ã€‚ ä½†æ˜¯ï¼Œä»»ä½•ä¸€æ®µä»£ç å›ºæœ‰çš„å¹¶è¡Œæ€§æ•°é‡æ˜¯æœ‰é™çš„ã€‚å®ƒä¹Ÿéå¸¸è€—ç”µã€‚å¤§å¤šæ•°ç°ä»£ CPU åœ¨æ¯ä¸ªå†…æ ¸ä¸Šéƒ½éƒ¨ç½²äº†å…­ä¸ªæ‰§è¡Œå•å…ƒï¼Œå› ä¸ºåœ¨æµæ°´çº¿çš„æ¯ä¸ªé˜¶æ®µå°†æ¯ä¸ªæ‰§è¡Œå•å…ƒè¿æ¥åˆ°æ‰€æœ‰å…¶ä»–æ‰§è¡Œå•å…ƒçš„æˆæœ¬ä¸º n å¹³æ–¹ã€‚ 1.9.2. é¢„æµ‹æ‰§è¡Œ é™¤æœ€å°çš„å¾®æ§åˆ¶å™¨å¤–ï¼Œæ‰€æœ‰ CPU å‡ä½¿ç”¨ æŒ‡ä»¤ç®¡é“ æ¥é‡å æŒ‡ä»¤ è·å–/è§£ç /æ‰§è¡Œ/æäº¤ å‘¨æœŸä¸­çš„éƒ¨åˆ†ã€‚ æŒ‡ä»¤æµæ°´çº¿çš„é—®é¢˜æ˜¯åˆ†æ”¯æŒ‡ä»¤ï¼Œå¹³å‡æ¯ 5 åˆ° 8 æ¡æŒ‡ä»¤å‡ºç°ä¸€æ¬¡ã€‚å½“ CPU åˆ°è¾¾åˆ†æ”¯æ—¶ï¼Œå®ƒä¸èƒ½åœ¨åˆ†æ”¯ä¹‹å¤–å¯»æ‰¾å…¶ä»–æŒ‡ä»¤æ¥æ‰§è¡Œï¼Œå¹¶ä¸”ç›´åˆ°çŸ¥é“ç¨‹åºè®¡æ•°å™¨ä¹Ÿå°†åœ¨ä½•å¤„åˆ†æ”¯ä¹‹å‰ï¼Œå®ƒæ‰èƒ½å¼€å§‹å¡«å……å…¶ç®¡é“ã€‚æ¨æµ‹æ‰§è¡Œä½¿ CPU å¯ä»¥â€œçŒœæµ‹â€åˆ†æ”¯ä»è¦å¤„ç†çš„è·¯å¾„ï¼ŒåŒæ—¶ä»åœ¨å¤„ç†åˆ†æ”¯æŒ‡ä»¤ï¼ å¦‚æœ CPU æ­£ç¡®é¢„æµ‹äº†åˆ†æ”¯ï¼Œåˆ™å®ƒå¯ä»¥ä¿æŒå…¶æŒ‡ä»¤æµæ°´çº¿æ»¡ã€‚å¦‚æœ CPU æ— æ³•é¢„æµ‹æ­£ç¡®çš„åˆ†æ”¯ï¼Œåˆ™å½“å®ƒæ„è¯†åˆ°é”™è¯¯æ—¶ï¼Œå¿…é¡»å›æ»šå¯¹å…¶ architectural state æ‰€åšçš„ä»»ä½•æ›´æ”¹ã€‚ç”±äºæˆ‘ä»¬éƒ½åœ¨é€šè¿‡ Spectre æ ·å¼æ¼æ´è¿›è¡Œå­¦ä¹ ï¼Œå› æ­¤æœ‰æ—¶è¿™ç§å›æ»šå¹¶æ²¡æœ‰åƒå¸Œæœ›çš„é‚£æ ·æ— ç¼ã€‚ å½“åˆ†æ”¯é¢„æµ‹ç‡è¾ƒä½æ—¶ï¼ŒæŠ•æœºæ‰§è¡Œå¯èƒ½ä¼šéå¸¸è€—ç”µã€‚å¦‚æœåˆ†æ”¯é¢„æµ‹é”™è¯¯ï¼Œä¸ä»… CPU å›æº¯åˆ°é¢„æµ‹é”™è¯¯çš„åœ°æ­¥ï¼Œè€Œä¸”æµªè´¹åœ¨é”™è¯¯åˆ†æ”¯ä¸Šçš„èƒ½é‡ä¹Ÿè¢«æµªè´¹äº†ã€‚ æ‰€æœ‰è¿™äº›ä¼˜åŒ–å¯¼è‡´æˆ‘ä»¬çœ‹åˆ°çš„å•çº¿ç¨‹æ€§èƒ½çš„æé«˜ï¼Œä½†è¦ä»˜å‡ºå¤§é‡æ™¶ä½“ç®¡å’ŒåŠŸç‡çš„ä»£ä»·ã€‚ Cliff Click çš„ ç²¾å½©æ¼”è®² è®¤ä¸ºä¹±åºï¼Œå¹¶ä¸”æ¨æµ‹æ€§æ‰§è¡Œå¯¹äºå°½æ—©å¼€å§‹ç¼“å­˜æœªå‘½ä¸­æœ€æœ‰ç”¨ï¼Œä»è€Œå‡å°‘äº†è§‚å¯Ÿåˆ°çš„ç¼“å­˜å»¶è¿Ÿã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:3:9","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"1.10. ç°ä»£ CPU å·²é’ˆå¯¹æ‰¹é‡æ“ä½œè¿›è¡Œäº†ä¼˜åŒ– ç°ä»£å¤„ç†å™¨å°±åƒæ˜¯ç”±ç¡åŸºç‡ƒæ–™é©±åŠ¨çš„æœ‰è¶£çš„æ±½è½¦ï¼Œå®ƒä»¬åœ¨å››åˆ†ä¹‹ä¸€è‹±é‡Œå¤„è¡¨ç°å‡ºè‰²ã€‚ä¸å¹¸çš„æ˜¯ï¼Œç°ä»£ç¼–ç¨‹è¯­è¨€å°±åƒè’™ç‰¹å¡æ´›ä¸€æ ·ï¼Œå……æ»¡äº†æ›²æŠ˜ã€‚- å¤§å«Â·æ˜‚åŠ ï¼ˆDavid Ungarï¼‰ è¿™æ˜¯æ¥è‡ªæœ‰å½±å“åŠ›çš„è®¡ç®—æœºç§‘å­¦å®¶ï¼ŒSELF ç¼–ç¨‹è¯­è¨€çš„å¼€å‘äººå‘˜ David Ungar çš„å¼•è¨€ï¼Œåœ¨å¾ˆæ—§çš„æ¼”è®²ä¸­å°±å¼•ç”¨äº† I found online. å› æ­¤ï¼Œç°ä»£ CPU å·²é’ˆå¯¹æ‰¹é‡ä¼ è¾“å’Œæ‰¹é‡æ“ä½œè¿›è¡Œäº†ä¼˜åŒ–ã€‚ åœ¨æ¯ä¸ªçº§åˆ«ï¼Œæ“ä½œçš„è®¾ç½®æˆæœ¬éƒ½ä¼šé¼“åŠ±æ‚¨è¿›è¡Œå¤§é‡å·¥ä½œã€‚ ä¸€äº›ä¾‹å­åŒ…æ‹¬ å†…å­˜ä¸æ˜¯æŒ‰å­—èŠ‚åŠ è½½ï¼Œè€Œæ˜¯æŒ‰é«˜é€Ÿç¼“å­˜è¡Œçš„å€æ•°åŠ è½½ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¯¹é½å˜å¾—ä¸å†åƒä»¥å‰çš„è®¡ç®—æœºé‚£æ ·æˆä¸ºé—®é¢˜çš„åŸå› ã€‚ MMX å’Œ SSE ç­‰å‘é‡æŒ‡ä»¤å…è®¸ä¸€æ¡æŒ‡ä»¤åŒæ—¶é’ˆå¯¹å¤šä¸ªæ•°æ®é¡¹æ‰§è¡Œï¼Œå‰ææ˜¯æ‚¨çš„ç¨‹åºå¯ä»¥ä»¥è¿™ç§å½¢å¼è¡¨ç¤ºã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:3:10","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"1.11. ç°ä»£å¤„ç†å™¨å—å†…å­˜å»¶è¿Ÿè€Œä¸æ˜¯å†…å­˜å®¹é‡çš„é™åˆ¶ å¦‚æœ CPU å ç”¨çš„çŠ¶å†µè¿˜ä¸å¤Ÿç³Ÿï¼Œé‚£ä¹ˆä»å†…å­˜æ–¹é¢æ¥çš„æ¶ˆæ¯å°±ä¸ä¼šå¥½å¤šäº†ã€‚ è¿æ¥åˆ°æœåŠ¡å™¨çš„ç‰©ç†å†…å­˜åœ¨å‡ ä½•ä¸Šæœ‰æ‰€å¢åŠ ã€‚ æˆ‘åœ¨ 1980 å¹´ä»£çš„ç¬¬ä¸€å°è®¡ç®—æœºå…·æœ‰æ•°åƒå­—èŠ‚çš„å†…å­˜ã€‚ å½“æˆ‘è¯»é«˜ä¸­æ—¶ï¼Œæˆ‘æ‰€æœ‰çš„è®ºæ–‡éƒ½æ˜¯ç”¨ 3.8 MB çš„ 386 å†™åœ¨ 386 ä¸Šçš„ã€‚ ç°åœ¨ï¼ŒæŸ¥æ‰¾å…·æœ‰æ•°åæˆ–æ•°ç™¾ GB RAM çš„æœåŠ¡å™¨å·²å˜å¾—å¸ç©ºè§æƒ¯ï¼Œè€Œäº‘æä¾›å•†åˆ™å°†å…¶æ¨å‘äº† TB çš„ TBã€‚ ä½†æ˜¯ï¼Œå¤„ç†å™¨é€Ÿåº¦å’Œå†…å­˜è®¿é—®æ—¶é—´ä¹‹é—´çš„å·®è·ç»§ç»­æ‰©å¤§ã€‚ ä½†æ˜¯ï¼Œå°±ä¸¢å¤±å¤„ç†å™¨ç­‰å¾…å†…å­˜çš„å¤„ç†å™¨å‘¨æœŸè€Œè¨€ï¼Œç‰©ç†å†…å­˜ä»ä¸ä»¥å¾€ä¸€æ ·é¥ä¸å¯åŠï¼Œå› ä¸ºå†…å­˜æ— æ³•è·Ÿä¸Š CPU é€Ÿåº¦çš„æé«˜ã€‚ å› æ­¤ï¼Œå¤§å¤šæ•°ç°ä»£å¤„ç†å™¨å—å†…å­˜å»¶è¿Ÿè€Œä¸æ˜¯å®¹é‡çš„é™åˆ¶ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:3:11","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"1.12. ç¼“å­˜æ§åˆ¶ç€æˆ‘ä»¬å‘¨å›´çš„ä¸€åˆ‡ å‡ åå¹´æ¥ï¼Œè§£å†³å¤„ç†å™¨/å†…å­˜ä¸Šé™çš„è§£å†³æ–¹æ¡ˆæ˜¯æ·»åŠ ç¼“å­˜-ä¸€å—è¾ƒå°çš„å¿«é€Ÿå†…å­˜ï¼Œä½ç½®æ›´è¿‘ï¼Œç°åœ¨ç›´æ¥é›†æˆåˆ° CPU ä¸­ã€‚ ä½†; æ•°åå¹´æ¥ï¼ŒL1 ä¸€ç›´åœç•™åœ¨æ¯ä¸ªæ ¸å¿ƒ 32kb L2 åœ¨æœ€å¤§çš„è‹±ç‰¹å°”éƒ¨åˆ†ä¸Šå·²ç¼“æ…¢çˆ¬å‡åˆ° 512kb L3 ç°åœ¨åœ¨ 4-32mb èŒƒå›´å†…ï¼Œä½†å…¶è®¿é—®æ—¶é—´å¯å˜ å—é«˜é€Ÿç¼“å­˜é™åˆ¶çš„å¤§å°æ˜¯å› ä¸ºå®ƒä»¬ physically large on the CPU dieï¼Œä¼šæ¶ˆè€—å¤§é‡åŠŸç‡ã€‚ è¦ä½¿ç¼“å­˜æœªå‘½ä¸­ç‡å‡åŠï¼Œæ‚¨å¿…é¡»å°†ç¼“å­˜å¤§å°æé«˜ å››å€ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:3:12","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"1.13. å…è´¹åˆé¤ç»“æŸäº† 2005 å¹´ï¼ŒC++ å§”å‘˜ä¼šè´Ÿè´£äºº Herb Sutter æ’°å†™äº†ä¸€ç¯‡é¢˜ä¸º å…è´¹åˆé¤ç»“æŸ çš„æ–‡ç« ã€‚ è¨ç‰¹ï¼ˆSutterï¼‰åœ¨ä»–çš„æ–‡ç« ä¸­è®¨è®ºäº†æˆ‘æ¶µç›–çš„æ‰€æœ‰è¦ç‚¹ï¼Œå¹¶æ–­è¨€æœªæ¥çš„ç¨‹åºå‘˜å°†ä¸å†èƒ½å¤Ÿä¾é è¾ƒå¿«çš„ç¡¬ä»¶æ¥ä¿®å¤è¾ƒæ…¢çš„ç¨‹åºæˆ–è¾ƒæ…¢çš„ç¼–ç¨‹è¯­è¨€ã€‚ åå¤šå¹´åçš„ä»Šå¤©ï¼Œæ¯«æ— ç–‘é—®ï¼Œèµ«ä¼¯Â·è¨ç‰¹ï¼ˆHerb Sutterï¼‰æ˜¯æ­£ç¡®çš„ã€‚å†…å­˜å¾ˆæ…¢ï¼Œç¼“å­˜å¤ªå°ï¼ŒCPU æ—¶é’Ÿé€Ÿåº¦å€’é€€äº†ï¼Œå•çº¿ç¨‹ CPU çš„ç®€å•ä¸–ç•Œæ—©å·²ä¸€å»ä¸å¤è¿”äº†ã€‚ æ‘©å°”å®šå¾‹ä»ç„¶æœ‰æ•ˆï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬è¿™ä¸ªæˆ¿é—´é‡Œçš„æ‰€æœ‰äººæ¥è¯´ï¼Œå…è´¹åˆé¤å·²ç»ç»“æŸã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:3:13","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"1.14. ç»“æŸ æˆ‘è¦å¼•ç”¨çš„æ•°å­—æ˜¯åˆ° 2010 å¹´ï¼š30GHzï¼Œ100 äº¿ä¸ªæ™¶ä½“ç®¡å’Œæ¯ç§’ 1 å…†æŒ‡ä»¤ã€‚â€”â€‰Pat Gelsinger, Intel CTO, April 2002 å¾ˆæ˜æ˜¾ï¼Œå¦‚æœæ²¡æœ‰ææ–™ç§‘å­¦æ–¹é¢çš„çªç ´ï¼ŒCPU æ€§èƒ½æ¢å¤åˆ°åŒæ¯” 52ï¼… å¢é•¿çš„å¯èƒ½æ€§å‡ ä¹å¾ˆå°ã€‚æ™®éçš„å…±è¯†æ˜¯ï¼Œæ•…éšœä¸åœ¨äºææ–™ç§‘å­¦æœ¬èº«ï¼Œè€Œåœ¨äºæ™¶ä½“ç®¡çš„ä½¿ç”¨æ–¹å¼ã€‚ç”¨ç¡…è¡¨ç¤ºçš„é¡ºåºæŒ‡ä»¤æµçš„é€»è¾‘æ¨¡å‹å¯¼è‡´äº†è¿™ç§æ˜‚è´µçš„æœ€ç»ˆç»“æœã€‚ åœ¨çº¿ä¸Šæœ‰è®¸å¤šæ¼”ç¤ºæ–‡ç¨¿å¯ä»¥é‡è¿°è¿™ä¸€ç‚¹ã€‚ å®ƒä»¬éƒ½å…·æœ‰ç›¸åŒçš„é¢„æµ‹-å°†æ¥çš„è®¡ç®—æœºå°†ä¸ä¼šåƒä»Šå¤©è¿™æ ·ç¼–ç¨‹ã€‚ æœ‰äººè®¤ä¸ºå®ƒçœ‹èµ·æ¥æ›´åƒæ˜¯å¸¦æœ‰æ•°ç™¾ä¸ªéå¸¸ç¬¨æ‹™ï¼Œéå¸¸ä¸è¿è´¯çš„å¤„ç†å™¨çš„å›¾å½¢å¡ã€‚ å…¶ä»–äººåˆ™è®¤ä¸ºï¼Œè¶…é•¿æŒ‡ä»¤å­—ï¼ˆVLIWï¼‰è®¡ç®—æœºå°†æˆä¸ºä¸»æµã€‚ æ‰€æœ‰äººéƒ½åŒæ„ï¼Œæˆ‘ä»¬å½“å‰çš„é¡ºåºç¼–ç¨‹è¯­è¨€å°†ä¸æ­¤ç±»å¤„ç†å™¨ä¸å…¼å®¹ã€‚ æˆ‘çš„è§‚ç‚¹æ˜¯è¿™äº›é¢„æµ‹æ˜¯æ­£ç¡®çš„ï¼Œæ­¤æ—¶ç¡¬ä»¶åˆ¶é€ å•†æŒ½æ•‘æˆ‘ä»¬çš„å‰æ™¯ä¸¥å³»ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä»Šå¤©æ‹¥æœ‰çš„ç¡¬ä»¶ä¼˜åŒ–å½“å‰ç¨‹åºçš„èŒƒå›´æ˜¯ å·¨å¤§çš„ã€‚ é‡Œå…‹Â·å“ˆå¾·æ£®ï¼ˆRick Hudsonï¼‰åœ¨ GopherCon 2015 å¤§ä¼šä¸Šè°ˆåˆ° ä»¥\"è‰¯å¥½çš„å¾ªç¯\"é‡æ–°å‚ä¸ï¼Œè¯¥è½¯ä»¶å¯ä»¥ä¸æˆ‘ä»¬ä»Šå¤©æ‹¥æœ‰çš„ç¡¬ä»¶ä¸€èµ·å·¥ä½œï¼Œè€Œä¸æ˜¯ä»…é€‚ç”¨äºè¿™ç§ç¡¬ä»¶ ã€‚ æŸ¥çœ‹æˆ‘ä¹‹å‰æ˜¾ç¤ºçš„å›¾è¡¨ï¼Œä» 2015 å¹´åˆ° 2018 å¹´ï¼Œæ•´æ•°æ€§èƒ½æœ€å¤šæé«˜äº† 5-8ï¼…ï¼Œè€Œå†…å­˜å»¶è¿Ÿå´æœ€å¤šï¼ŒGo å›¢é˜Ÿå°†åƒåœ¾æ”¶é›†å™¨çš„æš‚åœæ—¶é—´å‡å°‘äº† ä¸¤ä¸ªæ•°é‡çº§ã€‚ ä¸ä½¿ç”¨ Go 1.6 çš„ç›¸åŒç¡¬ä»¶ä¸Šçš„åŒä¸€ç¨‹åºç›¸æ¯”ï¼ŒGo 1.11 ç¨‹åºå…·æœ‰æ›´å¥½çš„ GC å»¶è¿Ÿã€‚ è¿™äº›éƒ½ä¸æ˜¯æ¥è‡ªç¡¬ä»¶ã€‚ å› æ­¤ï¼Œä¸ºäº†åœ¨å½“ä»Šä¸–ç•Œçš„å½“ä»Šç¡¬ä»¶ä¸Šè·å¾—æœ€ä½³æ€§èƒ½ï¼Œæ‚¨éœ€è¦ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œè¯¥è¯­è¨€åº”ï¼š ä¹‹æ‰€ä»¥ç¼–è¯‘è€Œä¸æ˜¯è§£é‡Šï¼Œæ˜¯å› ä¸ºè§£é‡Šåçš„ç¼–ç¨‹è¯­è¨€ä¸ CPU åˆ†æ”¯é¢„æµ‹å˜é‡å’Œæ¨æµ‹æ€§æ‰§è¡Œä¹‹é—´çš„äº¤äº’ä½œç”¨å¾ˆå·®ã€‚ æ‚¨éœ€è¦ä¸€ç§è¯­è¨€æ¥å…è®¸ç¼–å†™æœ‰æ•ˆçš„ä»£ç ï¼Œå®ƒéœ€è¦èƒ½å¤Ÿè°ˆè®ºä½å’Œå­—èŠ‚ï¼Œå¹¶ä¸”å¿…é¡»æœ‰æ•ˆåœ°è¯´æ˜æ•´æ•°çš„é•¿åº¦ï¼Œè€Œä¸æ˜¯å‡è£…æ¯ä¸ªæ•°å­—éƒ½æ˜¯ç†æƒ³çš„æµ®ç‚¹æ•°ã€‚ æ‚¨éœ€è¦ä¸€ç§ä½¿ç¨‹åºå‘˜èƒ½å¤Ÿæœ‰æ•ˆåœ°è°ˆè®ºå†…å­˜ï¼Œæ€è€ƒç»“æ„ä¸ Java å¯¹è±¡çš„è¯­è¨€ï¼Œå› ä¸ºæ‰€æœ‰çš„æŒ‡é’ˆè¿½é€éƒ½ä¼šç»™ CPU é«˜é€Ÿç¼“å­˜å¸¦æ¥å‹åŠ›ï¼Œè€Œé«˜é€Ÿç¼“å­˜æœªå‘½ä¸­ä¼šæ¶ˆè€—æ•°ç™¾ä¸ªå‘¨æœŸã€‚ éšåº”ç”¨ç¨‹åºçš„æ€§èƒ½è€Œæ‰©å±•åˆ°å¤šä¸ªå†…æ ¸çš„ç¼–ç¨‹è¯­è¨€å–å†³äºå®ƒä½¿ç”¨ç¼“å­˜çš„æ•ˆç‡ä»¥åŠåœ¨å¤šä¸ªå†…æ ¸ä¸Šå¹¶è¡ŒåŒ–å·¥ä½œçš„æ•ˆç‡ã€‚ æ˜¾ç„¶ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè°ˆè®º Goï¼Œæˆ‘ç›¸ä¿¡ Go æ‹¥æœ‰äº†æˆ‘åˆšæ‰æè¿°çš„è®¸å¤šç‰¹å¾ã€‚ 1.14.1. è¿™å¯¹æˆ‘ä»¬æ„å‘³ç€ä»€ä¹ˆï¼Ÿ åªæœ‰ä¸‰ç§ä¼˜åŒ–ï¼šå°‘åšäº›ã€‚å°‘åšä¸€æ¬¡ã€‚æ›´å¿«åœ°åšã€‚ æœ€å¤§çš„æ”¶ç›Šæ¥è‡ª 1ï¼Œä½†æˆ‘ä»¬å°†æ‰€æœ‰æ—¶é—´éƒ½èŠ±åœ¨ 3 ä¸Šã€‚â€‰â€”â€‰Michael Fromberger æœ¬è®²åº§çš„ç›®çš„æ˜¯è¯´æ˜ï¼Œå½“æ‚¨è°ˆè®ºç¨‹åºæˆ–ç³»ç»Ÿçš„æ€§èƒ½æ—¶ï¼Œå®Œå…¨æ˜¯åœ¨è½¯ä»¶ä¸­ã€‚ç­‰å¾…æ›´å¿«çš„ç¡¬ä»¶æ¥æŒ½æ•‘ä¸€å¤©çœŸæ˜¯æ„šè ¢çš„äº‹æƒ…ã€‚ ä½†æ˜¯æœ‰ä¸ªå¥½æ¶ˆæ¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è½¯ä»¶ä¸Šè¿›è¡Œå¤§é‡æ”¹è¿›ï¼Œè€Œè¿™å°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦è®¨è®ºçš„ã€‚ 1.14.2. è¿›ä¸€æ­¥é˜…è¯» The Future of Microprocessors, Sophie Wilson JuliaCon 2018 50 Years of Computer Architecture: From Mainframe CPUs to DNN TPUs, David Patterson The Future of Computing, John Hennessy The future of computing: a conversation with John Hennessy (Google I/O â€˜18) ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:3:14","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"2. Benchmarking æµ‹é‡ä¸¤æ¬¡ï¼Œå–ä¸€æ¬¡ã€‚â€‰â€”â€‰Ancient proverb åœ¨å°è¯•æ”¹å–„ä¸€æ®µä»£ç çš„æ€§èƒ½ä¹‹å‰ï¼Œé¦–å…ˆæˆ‘ä»¬å¿…é¡»äº†è§£å…¶å½“å‰æ€§èƒ½ã€‚ æœ¬èŠ‚é‡ç‚¹ä»‹ç»å¦‚ä½•ä½¿ç”¨ Go æµ‹è¯•æ¡†æ¶æ„å»ºæœ‰ç”¨çš„åŸºå‡†ï¼Œå¹¶æä¾›äº†é¿å…é™·é˜±çš„å®ç”¨æŠ€å·§ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:4:0","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"2.1. æ ‡æ†åŸºå‡†è§„åˆ™ åœ¨è¿›è¡ŒåŸºå‡†æµ‹è¯•ä¹‹å‰ï¼Œå¿…é¡»å…·æœ‰ç¨³å®šçš„ç¯å¢ƒæ‰èƒ½è·å¾—å¯é‡å¤çš„ç»“æœã€‚ æœºå™¨å¿…é¡»å¤„äºé—²ç½®çŠ¶æ€-ä¸è¦åœ¨å…±äº«ç¡¬ä»¶ä¸Šè¿›è¡Œé…ç½®ï¼Œä¸è¦åœ¨ç­‰å¾…è¾ƒé•¿åŸºå‡†æµ‹è¯•è¿è¡Œæ—¶æµè§ˆç½‘ç»œã€‚ æ³¨æ„èŠ‚èƒ½å’Œçƒ­ç¼©æ”¾ã€‚è¿™äº›åœ¨ç°ä»£ç¬”è®°æœ¬ç”µè„‘ä¸Šå‡ ä¹æ˜¯ä¸å¯é¿å…çš„ã€‚ é¿å…ä½¿ç”¨è™šæ‹Ÿæœºå’Œå…±äº«äº‘æ‰˜ç®¡ï¼›å¯¹äºä¸€è‡´çš„æµ‹é‡ï¼Œå®ƒä»¬å¯èƒ½å¤ªå˜ˆæ‚ã€‚ å¦‚æœè´Ÿæ‹…å¾—èµ·ï¼Œè¯·è´­ä¹°ä¸“ç”¨çš„æ€§èƒ½æµ‹è¯•ç¡¬ä»¶ã€‚æœºæ¶å®‰è£…ï¼Œç¦ç”¨æ‰€æœ‰ç”µæºç®¡ç†å’Œçƒ­é‡ç¼©æ”¾åŠŸèƒ½ï¼Œå¹¶ä¸”æ°¸è¿œä¸è¦åœ¨è¿™äº›è®¡ç®—æœºä¸Šæ›´æ–°è½¯ä»¶ã€‚ æœ€åä¸€ç‚¹æ˜¯ä»ç³»ç»Ÿç®¡ç†çš„è§’åº¦æ¥çœ‹ç³Ÿç³•çš„å»ºè®®ï¼Œä½†æ˜¯å¦‚æœè½¯ä»¶æ›´æ–°æ”¹å˜äº†å†…æ ¸æˆ–åº“çš„æ‰§è¡Œæ–¹å¼ -æƒ³æƒ³ Spectre è¡¥ä¸- è¿™å°†ä½¿ä»¥å‰çš„ä»»ä½•åŸºå‡†æµ‹è¯•ç»“æœæ— æ•ˆã€‚ å¯¹äºæˆ‘ä»¬å…¶ä»–äººï¼Œè¯·è¿›è¡Œå‰åé‡‡æ ·ï¼Œç„¶åå¤šæ¬¡è¿è¡Œä»¥è·å–ä¸€è‡´çš„ç»“æœã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:4:1","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"2.2. Using the testing package for benchmarking testing åŒ…å†…ç½®äº†å¯¹ç¼–å†™åŸºå‡†æµ‹è¯•çš„æ”¯æŒã€‚ å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œåƒè¿™æ ·ï¼š func Fib(n int) int { switch n { case 0: return 0 case 1: return 1 default: return Fib(n-1) + Fib(n-2) } } æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ testing åŒ…é€šè¿‡è¿™ç§å½¢å¼ä¸ºå‡½æ•°ç¼–å†™ä¸€ä¸ª åŸºå‡†ã€‚ func BenchmarkFib20(b *testing.B) { for n := 0; n \u003c b.N; n++ { Fib(20) // run the Fib function b.N times } } åŸºå‡†æµ‹è¯•åŠŸèƒ½ä¸æ‚¨çš„æµ‹è¯•ä¸€èµ·å­˜åœ¨äº _test.go æ–‡ä»¶ä¸­ã€‚ Benchmarks are similar to tests, the only real difference is they take a *testing.B rather than a *testing.T. Both of these types implement the testing.TB interface which provides crowd favorites like Errorf(), Fatalf(), and FailNow(). åŸºå‡†æµ‹è¯•ç±»ä¼¼äºæµ‹è¯•ï¼Œå”¯ä¸€çš„ä¸åŒæ˜¯åŸºå‡†æµ‹è¯•é‡‡ç”¨çš„æ˜¯ *testing.Bï¼Œè€Œä¸æ˜¯ *testing.Tã€‚è¿™ä¸¤ç§ç±»å‹éƒ½å®ç°äº† testing.TB æ¥å£ï¼Œè¯¥æ¥å£æä¾›äº†è¯¸å¦‚ Errorf()ï¼ŒFatalf() å’Œ FailNow() ä¹‹ç±»çš„æ–¹æ³•ã€‚ 2.2.1. è¿è¡Œè½¯ä»¶åŒ…çš„åŸºå‡†æµ‹è¯• As benchmarks use the testing package they are executed via the go test subcommand. However, by default when you invoke go test, benchmarks are excluded. å½“åŸºå‡†æµ‹è¯•ä½¿ç”¨ æµ‹è¯• è½¯ä»¶åŒ…æ—¶ï¼Œå®ƒä»¬é€šè¿‡ go test å­å‘½ä»¤æ‰§è¡Œã€‚ ä½†æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ‚¨è°ƒç”¨ go test æ—¶ï¼Œå°†æ’é™¤åŸºå‡†æµ‹è¯•ã€‚ è¦åœ¨åŒ…ä¸­æ˜¾å¼è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼Œè¯·ä½¿ç”¨ -bench æ ‡å¿—ã€‚-bench é‡‡ç”¨ä¸æ‚¨è¦è¿è¡Œçš„åŸºå‡†æµ‹è¯•åç§°åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå› æ­¤è°ƒç”¨åŒ…ä¸­æ‰€æœ‰åŸºå‡†æµ‹è¯•çš„æœ€å¸¸è§æ–¹æ³•æ˜¯ -bench=. è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼š % go test -bench=. ./examples/fib/ goos: darwin goarch: amd64 BenchmarkFib20-8 30000 40865 ns/op PASS ok _/Users/dfc/devel/high-performance-go-workshop/examples/fib 1.671s go test è¿˜å°†åœ¨åŒ¹é…åŸºå‡†ä¹‹å‰è¿è¡Œè½¯ä»¶åŒ…ä¸­çš„æ‰€æœ‰æµ‹è¯•ï¼Œå› æ­¤ï¼Œå¦‚æœè½¯ä»¶åŒ…ä¸­æœ‰å¾ˆå¤šæµ‹è¯•ï¼Œæˆ–è€…å®ƒä»¬èŠ±è´¹å¾ˆé•¿æ—¶é—´ï¼Œåˆ™å¯ä»¥é€šè¿‡ go test æä¾›çš„ -run å‚æ•°æ¥æ’é™¤å®ƒä»¬ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¸åŒ¹é…ï¼› å³ã€‚ go test -run=^$ 2.2.2. åŸºå‡†å¦‚ä½•è¿ä½œ æ¯ä¸ªåŸºå‡†å‡½æ•°è°ƒç”¨çš„ b.N å€¼éƒ½ä¸åŒï¼Œè¿™æ˜¯åŸºå‡†åº”è¿è¡Œçš„è¿­ä»£æ¬¡æ•°ã€‚ å¦‚æœåŸºå‡†åŠŸèƒ½åœ¨ 1 ç§’å†…ï¼ˆé»˜è®¤å€¼ï¼‰åœ¨ 1 ç§’å†…å®Œæˆï¼Œåˆ™ b.N ä» 1 å¼€å§‹ï¼Œç„¶å b.N å¢åŠ ï¼ŒåŸºå‡†åŠŸèƒ½å†æ¬¡è¿è¡Œã€‚ b.N increases in the approximate sequence; 1, 2, 3, 5, 10, 20, 30, 50, 100, and so on. The benchmark framework tries to be smart and if it sees small values of b.N are completing relatively quickly, it will increase the the iteration count faster. b.N ä»¥è¿‘ä¼¼é¡ºåºå¢åŠ ï¼›1, 2, 3, 5, 10, 20, 30, 50, 100 ç­‰ã€‚åŸºå‡†æ¡†æ¶è¯•å›¾å˜å¾—èªæ˜ï¼Œå¦‚æœçœ‹åˆ°è¾ƒå°çš„ b.N å€¼ç›¸å¯¹è¾ƒå¿«åœ°å®Œæˆï¼Œå®ƒå°†æ›´å¿«åœ°å¢åŠ è¿­ä»£æ¬¡æ•°ã€‚ æŸ¥çœ‹ä¸Šé¢çš„ç¤ºä¾‹ï¼ŒBenchmarkFib20-8 å‘ç°å¾ªç¯çš„å¤§çº¦ 30,000 æ¬¡è¿­ä»£èŠ±è´¹äº†è¶…è¿‡ä¸€ç§’é’Ÿçš„æ—¶é—´ã€‚ä»é‚£é‡ŒåŸºå‡†æ¡†æ¶è®¡ç®—å¾—å‡ºï¼Œæ¯æ¬¡æ“ä½œçš„å¹³å‡æ—¶é—´ä¸º 40865nsã€‚ åç¼€ -8 ä¸ç”¨äºè¿è¡Œæ­¤æµ‹è¯•çš„ GOMAXPROCS çš„å€¼æœ‰å…³ã€‚ è¯¥æ•°å­— GOMAXPROCS é»˜è®¤ä¸ºå¯åŠ¨æ—¶ Go è¿›ç¨‹å¯è§çš„ CPU æ•°ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ -cpu æ ‡å¿—æ¥æ›´æ”¹æ­¤å€¼ï¼Œè¯¥æ ‡å¿—å¸¦æœ‰ä¸€ä¸ªå€¼åˆ—è¡¨ä»¥è¿è¡ŒåŸºå‡†æµ‹è¯•ã€‚ % go test -bench=. -cpu=1,2,4 ./examples/fib/ goos: darwin goarch: amd64 BenchmarkFib20 30000 39115 ns/op BenchmarkFib20-2 30000 39468 ns/op BenchmarkFib20-4 50000 40728 ns/op PASS ok _/Users/dfc/devel/high-performance-go-workshop/examples/fib 5.531s è¿™æ˜¾ç¤ºäº†ä»¥ 1ã€2 å’Œ 4 æ ¸è¿è¡ŒåŸºå‡†æµ‹è¯•ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥æ ‡å¿—å¯¹ç»“æœå‡ ä¹æ²¡æœ‰å½±å“ï¼Œå› ä¸ºè¯¥åŸºå‡†æ˜¯å®Œå…¨é¡ºåºçš„ã€‚ 2.2.3. æé«˜åŸºå‡†ç²¾åº¦ fib åŠŸèƒ½æ˜¯ä¸€ä¸ªç¨ä½œè®¾è®¡çš„ç¤ºä¾‹-é™¤éæ‚¨ç¼–å†™ TechPower Web æœåŠ¡å™¨åŸºå‡†æµ‹è¯•-å¦åˆ™æ‚¨çš„ä¸šåŠ¡ä¸å¤ªå¯èƒ½ä¼šå› æ‚¨èƒ½å¤Ÿå¿«é€Ÿè®¡ç®—å‡ºæ–æ³¢é‚£å¥‘åºåˆ—ä¸­çš„ç¬¬ 20 ä¸ªæ•°å­—è€Œå—åˆ°é™åˆ¶ã€‚ä½†æ˜¯ï¼ŒåŸºå‡†ç¡®å®æä¾›äº†æœ‰æ•ˆåŸºå‡†çš„å¿ å®ç¤ºä¾‹ã€‚ å…·ä½“æ¥è¯´ï¼Œæ‚¨å¸Œæœ›åŸºå‡†æµ‹è¯•å¯ä»¥è¿è¡Œæ•°ä¸‡æ¬¡è¿­ä»£ï¼Œä»¥ä¾¿æ¯ä¸ªæ“ä½œè·å¾—è‰¯å¥½çš„å¹³å‡å€¼ã€‚å¦‚æœæ‚¨çš„åŸºå‡†æµ‹è¯•ä»…è¿è¡Œ 100 æˆ– 10 æ¬¡è¿­ä»£ï¼Œåˆ™è¿™äº›è¿è¡Œçš„å¹³å‡å€¼å¯èƒ½ä¼šæœ‰è¾ƒé«˜çš„æ ‡å‡†åå·®ã€‚å¦‚æœæ‚¨çš„åŸºå‡†æµ‹è¯•è¿è¡Œäº†æ•°ç™¾ä¸‡æˆ–æ•°åäº¿æ¬¡è¿­ä»£ï¼Œåˆ™å¹³å‡å€¼å¯èƒ½éå¸¸å‡†ç¡®ï¼Œä½†ä¼šå—åˆ°ä»£ç å¸ƒå±€å’Œå¯¹é½æ–¹å¼çš„å½±å“ã€‚ ä¸ºäº†å¢åŠ è¿­ä»£æ¬¡æ•°ï¼Œå¯ä»¥ä½¿ç”¨ -benchtime æ ‡å¿—æ¥å¢åŠ åŸºå‡†æ—¶é—´ã€‚ ä¾‹å¦‚ï¼š % go test -bench=. -benchtime=10s ./examples/fib/ goos: darwin goarch: amd64 BenchmarkFib20-8 300000 39318 ns/op PASS ok _/Users/dfc/devel/high-performance-go-workshop/examples/fib 20.066s è¿è¡Œç›¸åŒçš„åŸºå‡†ï¼Œç›´åˆ°è¾¾åˆ° b.N çš„å€¼ï¼Œå¹¶èŠ±è´¹äº†è¶…è¿‡ 10 ç§’çš„æ—¶é—´æ‰èƒ½è¿”å›ã€‚ç”±äºæˆ‘ä»¬çš„è¿è¡Œæ—¶é—´å¢åŠ äº† 10 å€ï¼Œå› æ­¤è¿­ä»£çš„æ€»æ•°ä¹Ÿå¢åŠ äº† 10 å€ã€‚ ç»“æœå¹¶æ²¡æœ‰å¤ªå¤§å˜åŒ–ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚ ä¸ºä»€ä¹ˆæŠ¥å‘Šçš„æ€»æ—¶é—´æ˜¯ 20 ç§’ï¼Œè€Œä¸æ˜¯ 10 ç§’ï¼Ÿ å¦‚æœæ‚¨æœ‰ä¸€ä¸ªåŸºå‡†è¿è¡Œæ•°ç™¾ä¸‡æˆ–æ•°åäº¿æ¬¡è¿­ä»£ï¼Œå¯¼è‡´æ¯æ¬¡æ“ä½œçš„æ—¶é—´åœ¨å¾®ç§’æˆ–çº³ç§’èŒƒå›´å†…ï¼Œåˆ™æ‚¨å¯èƒ½ä¼šå‘ç°åŸºå‡†å€¼ä¸ç¨³å®šï¼Œå› ä¸ºçƒ­ç¼©æ”¾ï¼Œå†…å­˜å±€éƒ¨æ€§ï¼Œåå°å¤„ç†ï¼Œgc æ´»åŠ¨ç­‰ã€‚ å¯¹äºæ¯æ¬¡æ“ä½œä»¥ 10 çº³ç§’æˆ–ä¸€ä½æ•°çº³ç§’ä¸ºå•ä½çš„æ—¶é—´ï¼ŒæŒ‡ä»¤é‡æ–°æ’åºå’Œä»£ç å¯¹é½çš„ç›¸å¯¹è®ºæ•ˆåº”å°†å¯¹åŸºå‡†æ—¶é—´äº§ç”Ÿå½±å“ã€‚ è¦ä½¿ç”¨ -count æ ‡å¿—æ¥å¤šæ¬¡è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼š % go test -bench=Fib1 -count=10 ./examples/fib/ goos: darwin goarch: amd64 BenchmarkFib1-8 2000000000 1.99 ns/op BenchmarkFib1-8 1000000000 1.95 ns/op BenchmarkFib1-8 2000000000 1.99 ns/op BenchmarkFib1-8 2000000000 1.97 ns/op BenchmarkFib1-8 2000000000 1.99 ns/op BenchmarkFib1-8 2000000000 1.96 ns/op BenchmarkFib1-8 2000000000 1.99 ns/op BenchmarkFib1-8 2000000000 2.01 ns/op BenchmarkFib1-8 2000000000 1.99 ns/op BenchmarkFib1-8 1000000000 2.00 ns/op Fib(1) åŸºå‡†æµ‹è¯•å¤§çº¦éœ€è¦ 2 çº³ç§’ï¼Œæ–¹å·®ä¸º +/- 2ï¼…ã€‚ Go 1.12 ä¸­çš„æ–°å¢åŠŸèƒ½æ˜¯ -benchtime æ ‡å¿—ï¼Œç°åœ¨éœ€è¦è¿›è¡Œå¤šæ¬¡è¿­ä»£ï¼Œä¾‹å¦‚ã€‚-benchtime=20xï¼Œå®ƒå°†å‡†ç¡®åœ°è¿è¡Œæ‚¨çš„ä»£ç  benchtime çš„æ—¶é—´ã€‚ å°è¯•ä»¥10å€ï¼Œ20å€ï¼Œ50å€ï¼Œ100å€å’Œ300å€çš„ `-benchtime` è¿è¡Œä¸Šé¢çš„ fib æµ‹è¯•ã€‚ ä½ çœ‹åˆ°äº†ä»€ä¹ˆï¼Ÿ If you find that the defaults that go test applies need to be tweaked for a particular package, I suggest codifying those settings in a Makefile so everyone who wants to run your benchmarks can do so with the same settings. å¦‚æœæ‚¨å‘ç°éœ€è¦é’ˆå¯¹ç‰¹å®šçš„è½¯ä»¶åŒ…è°ƒæ•´ go test çš„é»˜è®¤è®¾ç½®ï¼Œæˆ‘å»ºè®®å°†è¿™äº›è®¾ç½®ç¼–å…¥ Makefile ä¸­ï¼Œè¿™æ ·ï¼Œæ¯ä¸ªæƒ³è¦è¿è¡ŒåŸºå‡†æµ‹è¯•çš„äººéƒ½å¯ä»¥ä½¿ç”¨ç›¸åŒçš„è®¾","date":"2020-09-27","objectID":"/high-performance-go-workshop/:4:2","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"2.3. å°†åŸºå‡†ä¸ Benchstat è¿›è¡Œæ¯”è¾ƒ åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘å»ºè®®å¤šæ¬¡è¿è¡ŒåŸºå‡†æµ‹è¯•ä»¥ä½¿æ›´å¤šæ•°æ®å¹³å‡ã€‚ç”±äºæœ¬ç« å¼€å¤´æåˆ°çš„ç”µæºç®¡ç†ï¼Œåå°è¿‡ç¨‹å’Œçƒ­ç®¡ç†çš„å½±å“ï¼Œè¿™å¯¹äºä»»ä½•åŸºå‡†æµ‹è¯•éƒ½æ˜¯å¾ˆå¥½çš„å»ºè®®ã€‚ æˆ‘å°†ä»‹ç» Russ Cox çš„ä¸€ä¸ªå·¥å…· benchstat. % go get golang.org/x/perf/cmd/benchstat Benchstat å¯ä»¥è¿›è¡Œä¸€ç³»åˆ—åŸºå‡†æµ‹è¯•ï¼Œå¹¶å‘Šè¯‰æ‚¨å®ƒä»¬çš„ç¨³å®šæ€§ã€‚ è¿™æ˜¯æœ‰å…³ç”µæ± ä¾›ç”µçš„ Fib(20) ç¤ºä¾‹ã€‚ % go test -bench=Fib20 -count=10 ./examples/fib/ | tee old.txt goos: darwin goarch: amd64 BenchmarkFib20-8 50000 38479 ns/op BenchmarkFib20-8 50000 38303 ns/op BenchmarkFib20-8 50000 38130 ns/op BenchmarkFib20-8 50000 38636 ns/op BenchmarkFib20-8 50000 38784 ns/op BenchmarkFib20-8 50000 38310 ns/op BenchmarkFib20-8 50000 38156 ns/op BenchmarkFib20-8 50000 38291 ns/op BenchmarkFib20-8 50000 38075 ns/op BenchmarkFib20-8 50000 38705 ns/op PASS ok _/Users/dfc/devel/high-performance-go-workshop/examples/fib 23.125s % benchstat old.txt name time/op Fib20-8 38.4Âµs Â± 1% benchstat å‘Šè¯‰æˆ‘ä»¬å¹³å‡å€¼ä¸º 38.8 å¾®ç§’ï¼Œæ ·æœ¬ä¹‹é—´çš„å˜åŒ–ä¸º +/- 2ï¼…ã€‚è¿™å¯¹äºç”µæ± ä¾›ç”µæ¥è¯´ç›¸å½“ä¸é”™ã€‚ ç¬¬ä¸€æ¬¡è¿è¡Œæ˜¯æœ€æ…¢çš„ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿå·²é™ä½ CPU æ—¶é’Ÿä»¥èŠ‚çœç”µé‡ã€‚ æ¥ä¸‹æ¥çš„ä¸¤æ¬¡è¿è¡Œæ˜¯æœ€å¿«çš„ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿç¡®å®šè¿™ä¸æ˜¯å·¥ä½œçš„çŸ­æš‚é«˜å³°ï¼Œå¹¶ä¸”æé«˜äº†æ—¶é’Ÿé€Ÿåº¦ä»¥å°½å¿«å®Œæˆå·¥ä½œï¼Œä»è€Œå¸Œæœ›èƒ½å¤Ÿè¿”å›ç¡è§‰ã€‚ å…¶ä½™è¿è¡Œæ˜¯æ“ä½œç³»ç»Ÿå’Œä¾›çƒ­ç”Ÿäº§çš„ BIOS äº¤äº’åŠŸè€—ã€‚ 2.3.1. Improve Fib ç¡®å®šä¸¤ç»„åŸºå‡†ä¹‹é—´çš„æ€§èƒ½å·®å¼‚å¯èƒ½æ˜¯ä¹å‘³ä¸”å®¹æ˜“å‡ºé”™çš„ã€‚benchstat å¯ä»¥å¸®åŠ©æˆ‘ä»¬ã€‚ Saving the output from a benchmark run is useful, but you can also save the binary that produced it. This lets you rerun benchmark previous iterations. To do this, use the -c flag to save the test binaryâ€”â€‹I often rename this binary from .test to .golden. ä¿å­˜æ¥è‡ªåŸºå‡†è¿è¡Œçš„è¾“å‡ºå¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯æ‚¨ä¹Ÿå¯ä»¥ä¿å­˜äº§ç”Ÿå®ƒçš„ äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ è¿™ä½¿æ‚¨å¯ä»¥é‡æ–°è¿è¡ŒåŸºå‡†æµ‹è¯•ä»¥å‰çš„è¿­ä»£ã€‚ ä¸ºæ­¤ï¼Œè¯·ä½¿ç”¨ -cæ ‡å¿—ä¿å­˜æµ‹è¯•äºŒè¿›åˆ¶æ–‡ä»¶æˆ‘ç»å¸¸å°†æ­¤äºŒè¿›åˆ¶æ–‡ä»¶ä» .test é‡å‘½åä¸º .goldenã€‚ % go test -c % mv fib.test fib.golden å…ˆå‰çš„ Fib åŠŸèƒ½å…·æœ‰æ–æ³¢é‚£å¥‘ç³»åˆ—ä¸­ç¬¬ 0 å’Œç¬¬ 1 ä¸ªæ•°å­—çš„ç¡¬ç¼–ç å€¼ã€‚ä¹‹åï¼Œä»£ç ä»¥é€’å½’æ–¹å¼è°ƒç”¨è‡ªèº«ã€‚ä»Šå¤©æ™šäº›æ—¶å€™ï¼Œæˆ‘ä»¬å°†è®¨è®ºé€’å½’çš„æˆæœ¬ï¼Œä½†æ˜¯ç›®å‰ï¼Œå‡è®¾é€’å½’çš„æˆæœ¬æ˜¯å¾ˆé«˜çš„ï¼Œå°¤å…¶æ˜¯å› ä¸ºæˆ‘ä»¬çš„ç®—æ³•ä½¿ç”¨çš„æ˜¯æŒ‡æ•°æ—¶é—´ã€‚ å¯¹æ­¤çš„ç®€å•è§£å†³æ–¹æ³•æ˜¯å¯¹æ–æ³¢é‚£å¥‘æ•°åˆ—ä¸­çš„å¦ä¸€ä¸ªæ•°å­—è¿›è¡Œç¡¬ç¼–ç ï¼Œä»è€Œå°†æ¯ä¸ªå¯å›æº¯è°ƒç”¨çš„æ·±åº¦å‡å°‘ä¸€ä¸ªã€‚ func Fib(n int) int { switch n { case 0: return 0 case 1: return 1 case 2: return 1 default: return Fib(n-1) + Fib(n-2) } } è¯¥æ–‡ä»¶è¿˜åŒ…å«å¯¹ Fib çš„ç»¼åˆæµ‹è¯•ã€‚å¦‚æœæ²¡æœ‰é€šè¿‡éªŒè¯å½“å‰è¡Œä¸ºçš„æµ‹è¯•ï¼Œè¯·å‹¿å°è¯•æé«˜åŸºå‡†ã€‚ ä¸ºäº†æ¯”è¾ƒæˆ‘ä»¬çš„æ–°ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ç¼–è¯‘äº†ä¸€ä¸ªæ–°çš„æµ‹è¯•äºŒè¿›åˆ¶æ–‡ä»¶å¹¶å¯¹å…¶è¿›è¡Œäº†åŸºå‡†æµ‹è¯•ï¼Œå¹¶ä½¿ç”¨ benchstat æ¥æ¯”è¾ƒè¾“å‡ºã€‚ % go test -c % ./fib.golden -test.bench=. -test.count=10 \u003e old.txt % ./fib.test -test.bench=. -test.count=10 \u003e new.txt % benchstat old.txt new.txt name old time/op new time/op delta Fib20-8 44.3Âµs Â± 6% 25.6Âµs Â± 2% -42.31% (p=0.000 n=10+10) æ¯”è¾ƒåŸºå‡†æ—¶éœ€è¦æ£€æŸ¥ä¸‰ä»¶äº‹ æ—§æ—¶ä»£å’Œæ–°æ—¶æœŸçš„æ–¹å·® Â±ã€‚ 1-2ï¼… æ˜¯å¥½çš„ï¼Œ3-5ï¼… æ˜¯å¯ä»¥çš„ï¼Œå¤§äº 5ï¼…ï¼Œå¹¶ä¸”æ‚¨çš„æŸäº›æ ·æœ¬å°†è¢«è®¤ä¸ºä¸å¯é ã€‚ æ¯”è¾ƒä¸€ä¾§å·®å¼‚è¾ƒå¤§çš„åŸºå‡†æ—¶ï¼Œè¯·æ³¨æ„ä¸è¦æœ‰æ‰€æ”¹å–„ã€‚ p å€¼ã€‚ p å€¼å°äº 0.05 è¡¨ç¤ºè‰¯å¥½ï¼Œå¤§äº 0.05 è¡¨ç¤ºåŸºå‡†å¯èƒ½æ²¡æœ‰ç»Ÿè®¡å­¦æ„ä¹‰ã€‚ ç¼ºå°‘æ ·æœ¬ã€‚benchstat å°†æŠ¥å‘Šå®ƒè®¤ä¸ºæœ‰æ•ˆçš„æ—§æ ·æœ¬å’Œæ–°æ ·æœ¬ä¸­çš„å¤šå°‘ä¸ªï¼Œæœ‰æ—¶å³ä½¿æ‚¨æ‰§è¡Œäº† -count=10ï¼Œä¹Ÿå¯èƒ½åªæŠ¥å‘Šäº† 9 ä¸ªã€‚ 10ï¼… æˆ–æ›´ä½çš„æ‹’ç»ç‡æ˜¯å¯ä»¥çš„ï¼Œé«˜äº 10ï¼… å¯èƒ½è¡¨æ˜æ‚¨çš„è®¾ç½®ä¸ç¨³å®šï¼Œå¹¶ä¸”æ‚¨å¯èƒ½æ¯”è¾ƒçš„æ ·æœ¬å¤ªå°‘ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:4:3","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"2.4. é¿å…åŸºå‡†åŒ–å¯åŠ¨æˆæœ¬ æœ‰æ—¶ï¼Œæ‚¨çš„åŸºå‡†æµ‹è¯•å…·æœ‰ä¸€æ¬¡è¿è¡Œè®¾ç½®æˆæœ¬ã€‚b.ResetTimer() å°†ç”¨äºå¿½ç•¥è®¾ç½®ä¸­çš„æ—¶é—´ã€‚ func BenchmarkExpensive(b *testing.B) { boringAndExpensiveSetup() b.ResetTimer() // (1) for n := 0; n \u003c b.N; n++ { // function under test } } | 1 | é‡ç½®åŸºå‡†è®¡æ—¶å™¨ | å¦‚æœ æ¯ä¸ªå¾ªç¯ è¿­ä»£éƒ½æœ‰ä¸€äº›æ˜‚è´µçš„è®¾ç½®é€»è¾‘ï¼Œè¯·ä½¿ç”¨ b.StopTimer() å’Œ b.StartTimer() æš‚åœåŸºå‡†è®¡æ—¶å™¨ã€‚ func BenchmarkComplicated(b *testing.B) { for n := 0; n \u003c b.N; n++ { b.StopTimer() // (1) complicatedSetup() b.StartTimer() // (2) // function under test } } | 1 | æš‚åœåŸºå‡†æµ‹è¯•è®¡æ—¶å™¨ | | 2 | æ¢å¤è®¡æ—¶å™¨ | ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:4:4","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"2.5. åŸºå‡†åˆ†é… åˆ†é…æ•°é‡å’Œå¤§å°ä¸åŸºå‡†æ—¶é—´å¯†åˆ‡ç›¸å…³ã€‚ æ‚¨å¯ä»¥å‘Šè¯‰ testing æ¡†æ¶è®°å½•è¢«æµ‹ä»£ç åˆ†é…çš„æ•°é‡ã€‚ func BenchmarkRead(b *testing.B) { b.ReportAllocs() for n := 0; n \u003c b.N; n++ { // function under test } } è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ bufio è½¯ä»¶åŒ…åŸºå‡†æµ‹è¯•çš„ç¤ºä¾‹ã€‚ % go test -run=^$ -bench=. bufio goos: darwin goarch: amd64 pkg: bufio BenchmarkReaderCopyOptimal-8 20000000 103 ns/op BenchmarkReaderCopyUnoptimal-8 10000000 159 ns/op BenchmarkReaderCopyNoWriteTo-8 500000 3644 ns/op BenchmarkReaderWriteToOptimal-8 5000000 344 ns/op BenchmarkWriterCopyOptimal-8 20000000 98.6 ns/op BenchmarkWriterCopyUnoptimal-8 10000000 131 ns/op BenchmarkWriterCopyNoReadFrom-8 300000 3955 ns/op BenchmarkReaderEmpty-8 2000000 789 ns/op 4224 B/op 3 allocs/op BenchmarkWriterEmpty-8 2000000 683 ns/op 4096 B/op 1 allocs/op BenchmarkWriterFlush-8 100000000 17.0 ns/op 0 B/op 0 allocs/op You can also use the go test -benchmem flag to force the testing framework to report allocation statistics for all benchmarks run. % go test -run=^$ -bench=. -benchmem bufio goos: darwin goarch: amd64 pkg: bufio BenchmarkReaderCopyOptimal-8 20000000 93.5 ns/op 16 B/op 1 allocs/op BenchmarkReaderCopyUnoptimal-8 10000000 155 ns/op 32 B/op 2 allocs/op BenchmarkReaderCopyNoWriteTo-8 500000 3238 ns/op 32800 B/op 3 allocs/op BenchmarkReaderWriteToOptimal-8 5000000 335 ns/op 16 B/op 1 allocs/op BenchmarkWriterCopyOptimal-8 20000000 96.7 ns/op 16 B/op 1 allocs/op BenchmarkWriterCopyUnoptimal-8 10000000 124 ns/op 32 B/op 2 allocs/op BenchmarkWriterCopyNoReadFrom-8 500000 3219 ns/op 32800 B/op 3 allocs/op BenchmarkReaderEmpty-8 2000000 748 ns/op 4224 B/op 3 allocs/op BenchmarkWriterEmpty-8 2000000 662 ns/op 4096 B/op 1 allocs/op BenchmarkWriterFlush-8 100000000 16.9 ns/op 0 B/op 0 allocs/op PASS ok bufio 20.366s ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:4:5","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"2.6. æ³¨æ„ç¼–è¯‘å™¨çš„ä¼˜åŒ– è¿™ä¸ªä¾‹å­æ¥è‡ª issue 14813. const m1 = 0x5555555555555555 const m2 = 0x3333333333333333 const m4 = 0x0f0f0f0f0f0f0f0f const h01 = 0x0101010101010101 func popcnt(x uint64) uint64 { x -= (x \u003e\u003e 1) \u0026 m1 x = (x \u0026 m2) + ((x \u003e\u003e 2) \u0026 m2) x = (x + (x \u003e\u003e 4)) \u0026 m4 return (x * h01) \u003e\u003e 56 } func BenchmarkPopcnt(b *testing.B) { for i := 0; i \u003c b.N; i++ { popcnt(uint64(i)) } } æ‚¨è®¤ä¸ºè¯¥åŠŸèƒ½å°†ä»¥å¤šå¿«çš„é€Ÿåº¦è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Ÿ è®©æˆ‘ä»¬æ‰¾å‡ºç­”æ¡ˆã€‚ % go test -bench=. ./examples/popcnt/ goos: darwin goarch: amd64 BenchmarkPopcnt-8 2000000000 0.30 ns/op PASS\u003c/pre\u003e 0.3 çº³ç§’ï¼›è¿™åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚å³ä½¿å‡è®¾æ¯ä¸ªæ—¶é’Ÿå‘¨æœŸä¸­ CPU å¯èƒ½æ­£åœ¨è¿è¡Œä¸€äº›æŒ‡ä»¤ï¼Œè¯¥æ•°å­—ä¼¼ä¹ä¹Ÿè¿‡ä½ã€‚å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ To understand what happened, we have to look at the function under benchmake, popcnt. popcnt is a leaf functionâ€‰â€”â€‰it does not call any other functionsâ€‰â€”â€‰so the compiler can inline it. è¦äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬å¿…é¡»æŸ¥çœ‹ benchmake ä¸‹çš„å‡½æ•° popcntã€‚popcnt æ˜¯ å¶å‡½æ•°(å®ƒä¸è°ƒç”¨ä»»ä½•å…¶ä»–å‡½æ•°) å› æ­¤ç¼–è¯‘å™¨å¯ä»¥å†…è”å®ƒã€‚ å› ä¸ºè¯¥å‡½æ•°æ˜¯å†…è”çš„ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ç°åœ¨å¯ä»¥çœ‹åˆ°å®ƒæ²¡æœ‰å‰¯ä½œç”¨ã€‚ popcnt ä¸ä¼šå½±å“ä»»ä½•å…¨å±€å˜é‡çš„çŠ¶æ€ã€‚ å› æ­¤ï¼Œæ¶ˆé™¤äº†è¯¥è°ƒç”¨ã€‚è¿™æ˜¯ç¼–è¯‘å™¨çœ‹åˆ°çš„ï¼š func BenchmarkPopcnt(b *testing.B) { for i := 0; i \u003c b.N; i++ { // optimised away } } åœ¨æˆ‘æµ‹è¯•è¿‡çš„æ‰€æœ‰ Go ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸­ï¼Œä»ç„¶ä¼šç”Ÿæˆå¾ªç¯ã€‚ ä½†æ˜¯è‹±ç‰¹å°” CPU ç¡®å®æ“…é•¿ä¼˜åŒ–å¾ªç¯ï¼Œå°¤å…¶æ˜¯ç©ºå¾ªç¯ã€‚ 2.6.1. ç»ƒä¹ ï¼Œå®è·µ åœ¨ç»§ç»­ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å®è·µä¸€ä¸‹ä»¥ç¡®è®¤æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ % go test -gcflags=-S ä½¿ç”¨ `gcflags=\"-l -S\"` ç¦ç”¨å†…è”ï¼Œè¿™å¯ä»¥å½±å“ç¨‹åºè¾“å‡º è¦æ¶ˆé™¤çš„äº‹æƒ…æ˜¯ä¸é€šè¿‡æ¶ˆé™¤ä¸å¿…è¦çš„è®¡ç®—æ¥ä½¿å®é™…ä»£ç ç›¸åŒçš„ä¼˜åŒ–ï¼Œå³æ¶ˆé™¤äº†æ²¡æœ‰å¯è§‚å¯Ÿåˆ°çš„å‰¯ä½œç”¨çš„åŸºå‡†æµ‹è¯•ã€‚ éšç€ Go ç¼–è¯‘å™¨çš„æ”¹è¿›ï¼Œè¿™åªä¼šå˜å¾—è¶Šæ¥è¶Šæ™®éã€‚ 2.6.2. ä¿®å¤åŸºå‡† ç¦ç”¨å†…è”ä»¥ä½¿åŸºå‡†æµ‹è¯•æœ‰æ•ˆæ˜¯ä¸ç°å®çš„ï¼›æˆ‘ä»¬å¸Œæœ›åœ¨ä¼˜åŒ–çš„åŸºç¡€ä¸Šæ„å»ºä»£ç ã€‚ ä¸ºäº†ä¿®æ­£è¿™ä¸ªåŸºå‡†ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿ç¼–è¯‘å™¨æ— æ³• è¯æ˜ BenchmarkPopcnt çš„ä¸»ä½“ä¸ä¼šå¼•èµ·å…¨å±€çŠ¶æ€çš„æ”¹å˜ã€‚ var Result uint64 func BenchmarkPopcnt(b *testing.B) { var r uint64 for i := 0; i \u003c b.N; i++ { r = popcnt(uint64(i)) } Result = r } è¿™æ˜¯ç¡®ä¿ç¼–è¯‘å™¨æ— æ³•ä¼˜åŒ–å¾ªç¯ä¸»ä½“çš„æ¨èæ–¹æ³•ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡å°†å…¶å­˜å‚¨åœ¨ r ä¸­æ¥ä½¿ç”¨è°ƒç”¨ popcnt çš„ç»“æœã€‚å…¶æ¬¡ï¼Œç”±äºä¸€æ—¦åŸºå‡†æµ‹è¯•ç»“æŸï¼Œr å°±åœ¨ BenchmarkPopcnt çš„èŒƒå›´å†…å±€éƒ¨å£°æ˜ï¼Œæ‰€ä»¥ r çš„ç»“æœå¯¹äºç¨‹åºçš„å¦ä¸€éƒ¨åˆ†æ°¸è¿œæ˜¯ä¸å¯è§çš„ï¼Œå› æ­¤ä½œä¸ºæœ€åçš„åŠ¨ä½œï¼Œæˆ‘ä»¬å°† r çš„å€¼èµ‹å€¼å‚¨å­˜åˆ°åŒ…å…¬å…±å˜é‡ Resultã€‚ Because Result is public the compiler cannot prove that another package importing this one will not be able to see the value of Result changing over time, hence it cannot optimise away any of the operations leading to its assignment. What happens if we assign to Result directly? Does this affect the benchmark time? What about if we assign the result of popcnt to _? ç”±äº Result æ˜¯å…¬å¼€çš„ï¼Œå› æ­¤ç¼–è¯‘å™¨æ— æ³•è¯æ˜å¯¼å…¥è¯¥è½¯ä»¶åŒ…çš„å¦ä¸€ä¸ªåŒ…å°†æ— æ³•çœ‹åˆ° Result çš„å€¼éšæ—¶é—´å˜åŒ–ï¼Œå› æ­¤å®ƒæ— æ³•ä¼˜åŒ–å¯¼è‡´å…¶èµ‹å€¼çš„ä»»ä½•æ“ä½œã€‚ å¦‚æœç›´æ¥åˆ†é…ç»™ Result ä¼šæ€æ ·ï¼Ÿè¿™ä¼šå½±å“åŸºå‡†æ—¶é—´å—ï¼Ÿå¦‚æœå°† popcnt çš„ç»“æœèµ‹ç»™ _ ä¼šæ€ä¹ˆæ ·ï¼Ÿ åœ¨æˆ‘ä»¬ä¹‹å‰çš„ Fib åŸºå‡†æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰é‡‡å–è¿™äº›é¢„é˜²æªæ–½ï¼Œåº”è¯¥è¿™æ ·åšå—ï¼Ÿ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:4:6","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"2.7. åŸºå‡†è¯¯å·® for å¾ªç¯å¯¹äºåŸºå‡†æµ‹è¯•çš„è¿è¡Œè‡³å…³é‡è¦ã€‚ è¿™æ˜¯ä¸¤ä¸ªä¸æ­£ç¡®çš„åŸºå‡†ï¼Œæ‚¨èƒ½è§£é‡Šä¸€ä¸‹å®ƒä»¬æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ func BenchmarkFibWrong(b *testing.B) { Fib(b.N) } func BenchmarkFibWrong2(b *testing.B) { for n := 0; n \u003c b.N; n++ { Fib(n) } } è¿è¡Œè¿™äº›åŸºå‡†æµ‹è¯•ï¼Œæ‚¨ä¼šçœ‹åˆ°ä»€ä¹ˆï¼Ÿ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:4:7","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"2.8. åˆ†æåŸºå‡† testing åŒ…å†…ç½®äº†å¯¹ç”Ÿæˆ CPUï¼Œå†…å­˜å’Œå—é…ç½®æ–‡ä»¶çš„æ”¯æŒã€‚ -cpuprofile=\u003cspan class=\"katex\"\u003e$1$\u003c/span\u003eFILE. -memprofile=\u003cspan class=\"katex\"\u003e$1$\u003c/span\u003eFILE, -memprofilerate=N å°†é…ç½®æ–‡ä»¶é€Ÿç‡è°ƒæ•´ä¸º 1/N. -blockprofile=\u003cspan class=\"katex\"\u003e$1$\u003c/span\u003eFILE. ä½¿ç”¨è¿™äº›æ ‡å¿—ä¸­çš„ä»»ä½•ä¸€ä¸ªä¹Ÿä¼šä¿ç•™äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ % go test -run=XXX -bench=. -cpuprofile=c.p bytes % go tool pprof c.p ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:4:8","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"2.9. è®¨è®º æœ‰æ²¡æœ‰é—®é¢˜ï¼Ÿ ä¹Ÿè®¸æ˜¯æ—¶å€™ä¼‘æ¯ä¸€ä¸‹äº†ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:4:9","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"3. æ€§èƒ½è¯„ä¼°å’Œæ€§èƒ½åˆ†æ åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†å¯¹å•ä¸ªå‡½æ•°è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œè¿™å¯¹æ‚¨æå‰çŸ¥é“ç“¶é¢ˆåœ¨å“ªé‡Œå¾ˆæœ‰ç”¨ã€‚ä½†æ˜¯ï¼Œé€šå¸¸æ‚¨ä¼šå‘ç°è‡ªå·±æœ‰ä¸€ä¸ªé—®é¢˜ ä¸ºä»€ä¹ˆè¯¥ç¨‹åºéœ€è¦è¿™ä¹ˆé•¿æ—¶é—´æ‰èƒ½è¿è¡Œï¼Ÿ å¯¹ æ•´ä¸ª ç¨‹åºè¿›è¡Œæ¦‚è¦åˆ†æï¼Œå¯¹äºå›ç­”è¯¸å¦‚æ­¤ç±»çš„é«˜çº§é—®é¢˜å¾ˆæœ‰ç”¨ã€‚åœ¨æœ¬éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Go å†…ç½®çš„æ€§èƒ½åˆ†æå·¥å…·ä»å†…éƒ¨è°ƒæŸ¥ç¨‹åºçš„è¿è¡Œæƒ…å†µã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:5:0","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"3.1. pprof ä»Šå¤©æˆ‘ä»¬è¦è®¨è®ºçš„ç¬¬ä¸€ä¸ªå·¥å…·æ˜¯ pprof. pprof æ¥è‡ª Google Perf Tools è¿™å¥—å·¥å…·å¥—ä»¶ï¼Œè‡ªæœ€æ—©çš„å…¬å¼€å‘å¸ƒä»¥æ¥å·²é›†æˆåˆ° Go è¿è¡Œæ—¶ä¸­ã€‚ pprof ç”±ä¸¤éƒ¨åˆ†ç»„æˆ: runtime/pprof æ¯ä¸ª Go ç¨‹åºå†…ç½®çš„è½¯ä»¶åŒ… go tool pprof ç”¨äºè°ƒæŸ¥æ€§èƒ½åˆ†æã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:5:1","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"3.2. æ€§èƒ½åˆ†ææ–‡ä»¶ç±»å‹ pprof æ”¯æŒå¤šç§ç±»å‹çš„æ€§èƒ½åˆ†æï¼Œä»Šå¤©æˆ‘ä»¬å°†è®¨è®ºå…¶ä¸­çš„ä¸‰ç§: CPU profiling. Memory profiling. Block (or blocking) profiling. Mutex contention profiling. 3.2.1. CPU åˆ†æ CPU åˆ†ææ–‡ä»¶æ˜¯æœ€å¸¸è§çš„é…ç½®æ–‡ä»¶ç±»å‹ï¼Œä¹Ÿæ˜¯æœ€æ˜æ˜¾çš„é…ç½®æ–‡ä»¶ã€‚ å¯ç”¨ CPU æ€§èƒ½åˆ†æåï¼Œè¿è¡Œæ—¶å°†æ¯ 10 æ¯«ç§’ä¸­æ–­ä¸€æ¬¡ï¼Œå¹¶è®°å½•å½“å‰æ­£åœ¨è¿è¡Œçš„ goroutine çš„å †æ ˆè·Ÿè¸ªã€‚ åˆ†ææ–‡ä»¶å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œåˆ†æä»¥ç¡®å®šæœ€çƒ­é—¨çš„ä»£ç è·¯å¾„ã€‚ å‡½æ•°åœ¨åˆ†ææ–‡ä»¶ä¸­å‡ºç°çš„æ¬¡æ•°è¶Šå¤šï¼Œä»£ç è·¯å¾„èŠ±è´¹çš„æ—¶é—´å°±è¶Šå¤šã€‚ 3.2.2. å†…å­˜åˆ†æ è¿›è¡Œ å † åˆ†é…æ—¶ï¼Œå†…å­˜åˆ†æè®°å½•å †æ ˆè·Ÿè¸ªã€‚ å †æ ˆåˆ†é…å‡å®šä¸ºç©ºé—²ï¼Œå¹¶ä¸”åœ¨å†…å­˜æ€§èƒ½åˆ†ææ–‡ä»¶ä¸­ æœªè·Ÿè¸ªã€‚ åƒ CPU åˆ†æä¸€æ ·ï¼Œå†…å­˜åˆ†æéƒ½æ˜¯åŸºäºæ ·æœ¬çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ 1000 ä¸ªåˆ†é…ä¸­çš„å†…å­˜åˆ†ææ ·æœ¬ä¸º 1ã€‚ æ­¤é€Ÿç‡å¯ä»¥æ›´æ”¹ã€‚ ç”±äºå†…å­˜åˆ†ææ˜¯åŸºäºæ ·æœ¬çš„ï¼Œå¹¶ä¸”ç”±äºå®ƒè·Ÿè¸ªæœª ä½¿ç”¨ çš„ åˆ†é…ï¼Œå› æ­¤å¾ˆéš¾ä½¿ç”¨å†…å­˜åˆ†ææ¥ç¡®å®šåº”ç”¨ç¨‹åºçš„æ•´ä½“å†…å­˜ä½¿ç”¨æƒ…å†µã€‚ ä¸ªäººæƒ³æ³•: æˆ‘å‘ç°å†…å­˜åˆ†æå¯¹å‘ç°å†…å­˜æ³„æ¼æ²¡æœ‰å¸®åŠ©ã€‚æœ‰æ›´å¥½çš„æ–¹æ³•æ¥ç¡®å®šæ‚¨çš„åº”ç”¨ç¨‹åºæ­£åœ¨ä½¿ç”¨å¤šå°‘å†…å­˜ã€‚ æˆ‘ä»¬å°†åœ¨æ¼”ç¤ºæ–‡ç¨¿çš„åé¢è®¨è®ºè¿™äº›ã€‚ 3.2.3. å—æ€§èƒ½åˆ†æ å—åˆ†ææ˜¯ Go ç‰¹æœ‰çš„ã€‚ å—æ¦‚è¦æ–‡ä»¶ç±»ä¼¼äº CPU æ¦‚è¦æ–‡ä»¶ï¼Œä½†æ˜¯å®ƒè®°å½• goroutine ç­‰å¾…å…±äº«èµ„æºæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚ è¿™å¯¹äºç¡®å®šåº”ç”¨ç¨‹åºä¸­çš„ å¹¶å‘ ç“¶é¢ˆå¾ˆæœ‰ç”¨ã€‚ å—æ€§èƒ½åˆ†æå¯ä»¥å‘æ‚¨æ˜¾ç¤ºä½•æ—¶æœ‰å¤§é‡ goroutine å¯ä»¥ å–å¾—è¿›å±•ï¼Œä½†è¢« é˜»å¡ äº†ã€‚åŒ…æ‹¬é˜»æ­¢ åœ¨æ— ç¼“å†²çš„é€šé“ä¸Šå‘é€æˆ–æ¥æ”¶ã€‚ æ­£åœ¨å‘é€åˆ°å®Œæ•´é¢‘é“ï¼Œä»ç©ºé¢‘é“æ¥æ”¶ã€‚ è¯•å›¾ é”å®š è¢«å¦ä¸€ä¸ª goroutine é”å®šçš„ sync.Mutexã€‚ å—åˆ†ææ˜¯ä¸€ç§éå¸¸ä¸“ä¸šçš„å·¥å…·ï¼Œåœ¨æ‚¨ç¡®ä¿¡æ¶ˆé™¤äº†æ‰€æœ‰ CPU å’Œå†…å­˜ä½¿ç”¨ç“¶é¢ˆä¹‹åï¼Œæ‰åº”è¯¥ä½¿ç”¨å®ƒã€‚ 3.2.4. Mutex profiling äº’æ–¥é”æ¦‚è¦åˆ†æä¸å—æ¦‚è¦åˆ†æç±»ä¼¼ï¼Œä½†ä¸“é—¨é’ˆå¯¹å¯¼è‡´äº’æ–¥é”äº‰ç”¨å¯¼è‡´å»¶è¿Ÿçš„æ“ä½œã€‚ æˆ‘å¯¹è¿™ç§ç±»å‹çš„ä¸ªäººèµ„æ–™æ²¡æœ‰å¾ˆå¤šç»éªŒï¼Œä½†æ˜¯æˆ‘å»ºç«‹äº†ä¸€ä¸ªç¤ºä¾‹æ¥æ¼”ç¤ºå®ƒã€‚æˆ‘ä»¬å°†å¾ˆå¿«çœ‹ä¸€ä¸‹è¯¥ç¤ºä¾‹ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:5:2","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"3.3. åŒä¸€æ—¶é—´åªä½¿ç”¨ä¸€ç§æ€§èƒ½åˆ†æ æ€§èƒ½åˆ†æä¸æ˜¯å…è´¹çš„ã€‚ åˆ†æå¯¹ç¨‹åºæ€§èƒ½æœ‰ä¸­ç­‰ä½†å¯æµ‹é‡çš„å½±å“ï¼Œå°¤å…¶æ˜¯å¦‚æœæ‚¨å¢åŠ å†…å­˜é…ç½®æ–‡ä»¶é‡‡æ ·ç‡ã€‚ å¤§å¤šæ•°å·¥å…·ä¸ä¼šé˜»æ­¢æ‚¨ä¸€æ¬¡å¯ç”¨å¤šä¸ªæ€§èƒ½åˆ†æã€‚ ä¸€æ¬¡ä¸è¦å¯ç”¨å¤šç§æ€§èƒ½åˆ†æã€‚ å¦‚æœæ‚¨åŒæ—¶å¯ç”¨å¤šä¸ªä¸ªäººèµ„æ–™ï¼Œä»–ä»¬å°†è§‚å¯Ÿè‡ªå·±çš„äº’åŠ¨å¹¶æ”¾å¼ƒæ‚¨çš„ç»“æœã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:5:3","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"3.4. æ”¶é›†æ€§èƒ½åˆ†æ Go è¿è¡Œæ—¶çš„é…ç½®æ–‡ä»¶ç•Œé¢ä½äº runtime/pprof åŒ…ä¸­ã€‚runtime/pprof æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„å·¥å…·ï¼Œç”±äºå†å²åŸå› ï¼Œä¸å„ç§é…ç½®æ–‡ä»¶çš„æ¥å£å¹¶ä¸ç»Ÿä¸€ã€‚ æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼Œpprof æ¦‚è¦åˆ†æå†…ç½®äº testing åŒ…ä¸­ï¼Œä½†æ˜¯æœ‰æ—¶å°†æ‚¨è¦åˆ†æçš„ä»£ç æ”¾åœ¨ testing.B åŸºå‡†æµ‹è¯•ç¯å¢ƒä¸­æ˜¯ä¸ä¾¿æˆ–å›°éš¾çš„ï¼Œå¹¶ä¸”å¿…é¡»ä½¿ç”¨ç›´æ¥ä½¿ç”¨ runtime/pprof APIã€‚ å‡ å¹´å‰ï¼Œæˆ‘å†™äº†ä¸€ä¸ª small packageï¼Œä»¥ä¾¿æ›´è½»æ¾åœ°æè¿°ç°æœ‰åº”ç”¨ç¨‹åºã€‚ import \"github.com/pkg/profile\" func main() { defer profile.Start().Stop() // ... } åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ profile åŒ…ã€‚ ç¨åï¼Œæˆ‘ä»¬å°†ç›´æ¥ä½¿ç”¨ runtime/pprof æ¥å£ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:5:4","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"3.5. Analysing a profile with pprof æ—¢ç„¶æˆ‘ä»¬å·²ç»è®¨è®ºäº† pprof å¯ä»¥æµ‹é‡çš„å†…å®¹ä»¥åŠå¦‚ä½•ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥è®¨è®ºå¦‚ä½•ä½¿ç”¨ pprof åˆ†æé…ç½®æ–‡ä»¶ã€‚ åˆ†æç”± go pprof å­å‘½ä»¤é©±åŠ¨ % go tool pprof /path/to/your/profile è¯¥å·¥å…·æä¾›äº†æ¦‚è¦æ•°æ®çš„å‡ ç§ä¸åŒè¡¨ç¤ºå½¢å¼ã€‚æ–‡å­—ï¼Œå›¾å½¢ç”šè‡³ç«ç„°å›¾ã€‚ å¦‚æœæ‚¨ä½¿ç”¨ Go å·²æœ‰ä¸€æ®µæ—¶é—´ï¼Œåˆ™å¯èƒ½ä¼šè¢«å‘ŠçŸ¥ pprof æœ‰ä¸¤ä¸ªå‚æ•°ã€‚ä» Go 1.9 å¼€å§‹ï¼Œé…ç½®æ–‡ä»¶åŒ…å«æ¸²æŸ“é…ç½®æ–‡ä»¶æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚æ‚¨ä¸å†éœ€è¦ç”Ÿæˆæ€§èƒ½åˆ†æçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ğŸ‰ 3.5.1. è¿›ä¸€æ­¥é˜…è¯» Profiling Go programs (Go Blog) Debugging performance issues in Go programs 3.5.2. CPU profiling (exercise) è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªè®¡ç®—å•è¯æ•°çš„ç¨‹åº: package main import ( \"fmt\" \"io\" \"log\" \"os\" \"unicode\" ) func readbyte(r io.Reader) (rune, error) { var buf [1]byte _, err := r.Read(buf[:]) return rune(buf[0]), err } func main() { f, err := os.Open(os.Args[1]) if err != nil { log.Fatalf(\"could not open file %q: %v\", os.Args[1], err) } words := 0 inword := false for { r, err := readbyte(f) if err == io.EOF { break } if err != nil { log.Fatalf(\"could not read file %q: %v\", os.Args[1], err) } if unicode.IsSpace(r) \u0026\u0026 inword { words++ inword = false } inword = unicode.IsLetter(r) } fmt.Printf(\"%q: %d words\\n\", os.Args[1], words) } è®©æˆ‘ä»¬çœ‹çœ‹èµ«å°”æ›¼Â·æ¢…å°”ç»´å°”ç»å…¸å°è¯´ä¸­æœ‰å¤šå°‘ä¸ªå•è¯ Moby Dick (æ¥è‡ªå¤è…¾å ¡è®¡åˆ’) % go build \u0026\u0026 time ./words moby.txt \"moby.txt\": 181275 words real 0m2.110s user 0m1.264s sys 0m0.944s è®©æˆ‘ä»¬å°†å…¶ä¸ unix çš„ wc -w è¿›è¡Œæ¯”è¾ƒ % time wc -w moby.txt 215829 moby.txt real 0m0.012s user 0m0.009s sys 0m0.002s æ‰€ä»¥æ•°å­—ä¸ä¸€æ ·ã€‚ wc å¤§çº¦é«˜å‡º 19ï¼…ï¼Œå› ä¸ºå®ƒè®¤ä¸ºå•è¯ä¸æˆ‘çš„ç®€å•ç¨‹åºä¸åŒã€‚è¿™å¹¶ä¸é‡è¦-ä¸¤ä¸ªç¨‹åºéƒ½å°†æ•´ä¸ªæ–‡ä»¶ä½œä¸ºè¾“å…¥ï¼Œå¹¶åœ¨ä¸€æ¬¡é€šè¿‡ä¸­è®¡ç®—ä»å•è¯åˆ°éå•è¯çš„è¿‡æ¸¡æ¬¡æ•°ã€‚ è®©æˆ‘ä»¬ç ”ç©¶ä¸€ä¸‹ä¸ºä»€ä¹ˆä½¿ç”¨ pprof è¿™äº›ç¨‹åºçš„è¿è¡Œæ—¶é—´ä¸åŒã€‚ 3.5.3. æ·»åŠ  CPU åˆ†æ é¦–å…ˆï¼Œç¼–è¾‘ main.go å¹¶å¯ç”¨åˆ†æ import ( \"github.com/pkg/profile\" ) func main() { defer profile.Start().Stop() // ... ç°åœ¨ï¼Œå½“æˆ‘ä»¬è¿è¡Œç¨‹åºæ—¶ï¼Œå°†åˆ›å»ºä¸€ä¸ª cpu.pprof æ–‡ä»¶ã€‚ % go run main.go moby.txt 2018/08/25 14:09:01 profile: cpu profiling enabled, /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile239941020/cpu.pprof \"moby.txt\": 181275 words 2018/08/25 14:09:03 profile: cpu profiling disabled, /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile239941020/cpu.pprof ç°åœ¨æˆ‘ä»¬æœ‰äº†é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ go pprof å·¥å…·å¯¹å…¶è¿›è¡Œåˆ†æã€‚ % go tool pprof /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile239941020/cpu.pprof Type: cpu Time: Aug 25, 2018 at 2:09pm (AEST) Duration: 2.05s, Total samples = 1.36s (66.29%) Entering interactive mode (type \"help\" for commands, \"o\" for options) (pprof) top Showing nodes accounting for 1.42s, 100% of 1.42s total flat flat% sum% cum cum% 1.41s 99.30% 99.30% 1.41s 99.30% syscall.Syscall 0.01s 0.7% 100% 1.42s 100% main.readbyte 0 0% 100% 1.41s 99.30% internal/poll.(*FD).Read 0 0% 100% 1.42s 100% main.main 0 0% 100% 1.41s 99.30% os.(*File).Read 0 0% 100% 1.41s 99.30% os.(*File).read 0 0% 100% 1.42s 100% runtime.main 0 0% 100% 1.41s 99.30% syscall.Read 0 0% 100% 1.41s 99.30% syscall.read top å‘½ä»¤æ˜¯æ‚¨æœ€å¸¸ä½¿ç”¨çš„å‘½ä»¤ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥ç¨‹åºæœ‰ 99ï¼… çš„æ—¶é—´èŠ±è´¹åœ¨ syscall.Syscall ä¸­ï¼Œè€Œä¸€å°éƒ¨åˆ†èŠ±è´¹åœ¨main.readbyte ä¸­ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ web å‘½ä»¤æ¥å¯è§†åŒ–æ­¤è°ƒç”¨ã€‚è¿™å°†ä»é…ç½®æ–‡ä»¶æ•°æ®ç”Ÿæˆæœ‰å‘å›¾ã€‚ åœ¨åå°ï¼Œè¿™ä½¿ç”¨äº† Graphviz çš„ dot å‘½ä»¤ã€‚ ä½†æ˜¯ï¼Œåœ¨ Go 1.10(ä¹Ÿå¯èƒ½æ˜¯ 1.11)ä¸­ï¼ŒGo é™„å¸¦äº†æœ¬èº«æ”¯æŒ HTTP æœåŠ¡å™¨çš„ pprof ç‰ˆæœ¬ % go tool pprof -http=:8080 /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile239941020/cpu.pprof å°†ä¼šæ‰“å¼€ç½‘ç»œæµè§ˆå™¨; å›¾å½¢æ¨¡å¼ ç«ç„°å›¾æ¨¡å¼ åœ¨å›¾å½¢ä¸Šï¼Œå ç”¨ æœ€å¤š CPU æ—¶é—´çš„æ¡†æ˜¯æœ€å¤§çš„æ¡†ï¼Œæˆ‘ä»¬çœ‹åˆ° syscall.Syscall å ç¨‹åºæ€»æ—¶é—´çš„ 99.3ï¼…ã€‚å¯¼è‡´ syscall.Syscall çš„å­—ç¬¦ä¸²è¡¨ç¤ºç«‹å³è°ƒç”¨è€…ï¼Œå¦‚æœå¤šä¸ªä»£ç è·¯å¾„åœ¨åŒä¸€å‡½æ•°ä¸Šæ”¶æ•›ï¼Œåˆ™å¯ä»¥æœ‰å¤šä¸ªã€‚ç®­å¤´çš„å¤§å°ä»£è¡¨åœ¨ä¸€ä¸ªç›’å­çš„å­å…ƒç´ ä¸ŠèŠ±è´¹äº†å¤šå°‘æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä» main.readbyte å¼€å§‹ï¼Œå®ƒä»¬å äº†è¯¥å›¾åˆ†æ”¯ä¸­ 1.41 ç§’æ‰€ç”¨æ—¶é—´çš„æ¥è¿‘ 0ã€‚ é—®é¢˜: è°èƒ½çŒœå‡ºä¸ºä»€ä¹ˆæˆ‘ä»¬çš„ç‰ˆæœ¬æ¯” wc æ…¢å¾—å¤š? 3.5.4. æ”¹è¿› æˆ‘ä»¬çš„ç¨‹åºè¿è¡Œç¼“æ…¢çš„åŸå› ä¸æ˜¯å› ä¸º Go çš„ syscall.Syscall è¿è¡Œç¼“æ…¢ã€‚ è¿™æ˜¯å› ä¸ºç³»ç»Ÿè°ƒç”¨é€šå¸¸æ˜¯æ˜‚è´µçš„æ“ä½œï¼ˆå¹¶ä¸”éšç€å‘ç°æ›´å¤š Spectre ç³»åˆ—æ¼æ´è€Œå˜å¾—è¶Šæ¥è¶Šæ˜‚è´µï¼‰ã€‚ æ¯æ¬¡å¯¹ readbyte çš„è°ƒç”¨éƒ½ä¼šå¯¼è‡´ä¸€ä¸ª syscall.Read çš„ç¼“å†²åŒºå¤§å°ä¸º 1ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ç¨‹åºæ‰§è¡Œçš„ syscall æ•°é‡ç­‰äºè¾“å…¥çš„å¤§å°ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ pprof å›¾ä¸­ï¼Œè¯»å–è¾“å…¥çš„å†…å®¹å ä¸»å¯¼åœ°ä½ã€‚ func main() { defer profile.Start(profile.MemProfile, profile.MemProfileRate(1)).Stop() // defer profile.Start(profile.MemProfile).Stop() f, err := os.Open(os.Args[1]) if err != nil { log.Fatalf(\"could not open file %q: %v\", os.Args[1], err) } b := bufio.NewReader(f) words := 0 inword := false for { r, err := readbyte(b) if err == io.EOF { break } if err != nil { log.Fatalf(\"could not read file %q: %v\", os.Args[1], err) } if unicode.IsSpace(r) \u0026\u0026 inword { words++ inword = false } inword = unicode.IsLetter(r) } fmt.Printf(\"%q: %d words\\n\", os.Args[1], words) } é€šè¿‡åœ¨ readbyte ä¹‹å‰ä½¿ç”¨ bufio.Reader åŒ…è£…è¾“å…¥æ–‡ä»¶ å°†æ­¤ä¿®è®¢ç¨‹åºçš„æ—¶é—´ä¸ `wc` æ¯”è¾ƒã€‚æœ‰å¤šå°‘å·®è·ï¼Ÿè¿›è¡Œæ€§èƒ½åˆ†æï¼Œçœ‹çœ‹è¿˜å‰©ä¸‹ä»€ä¹ˆã€‚ 3.5.5. å†…å­˜åˆ†æ æ–°çš„å•è¯é…ç½®æ–‡ä»¶è¡¨æ˜åœ¨ readbyte å‡½","date":"2020-09-27","objectID":"/high-performance-go-workshop/:5:5","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"4. ç¼–è¯‘ä¼˜åŒ– æœ¬èŠ‚ä»‹ç»äº† Go ç¼–è¯‘å™¨æ‰§è¡Œçš„ä¸€äº›ä¼˜åŒ–ã€‚ ä¾‹å¦‚; é€ƒé€¸åˆ†æ å†…è” æ¶ˆé™¤æ­»ä»£ç  å…¨éƒ¨åœ¨ç¼–è¯‘å™¨çš„å‰ç«¯å¤„ç†ï¼Œè€Œä»£ç ä»ä¸º AST å½¢å¼ï¼› ç„¶åå°†ä»£ç ä¼ é€’ç»™ SSA ç¼–è¯‘å™¨è¿›è¡Œè¿›ä¸€æ­¥ä¼˜åŒ–ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:6:0","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"4.1. History of the Go compiler Go ç¼–è¯‘å™¨å¤§çº¦åœ¨ 2007 æ—¶ä½œä¸º Plan9 ç¼–è¯‘å™¨å·¥å…·é“¾çš„åˆ†æ”¯è€Œå¼€å§‹çš„ã€‚å½“æ—¶çš„ç¼–è¯‘å™¨ä¸ Aho å’Œ Ullman çš„ Dragon Book éå¸¸ç›¸ä¼¼ã€‚ åœ¨ 2015 å¹´ï¼Œå½“æ—¶çš„ Go 1.5 ç¼–è¯‘å™¨ä¸º C è½¬æ¢ä¸º Goã€‚ ä¸€å¹´åï¼ŒGo 1.7 å¼•å…¥äº†ä¸€ç§åŸºäº SSA æŠ€æœ¯çš„ new compiler backend ä»¥å‰çš„ Plan9 æ ·å¼ä»£ç ç”Ÿæˆã€‚è¿™ä¸ªæ–°çš„åç«¯ä¸ºé€šç”¨å’Œç‰¹å®šäºæ¶æ„çš„ä¼˜åŒ–å¼•å…¥äº†è®¸å¤šæœºä¼šã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:6:1","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"4.2. é€ƒé€¸ä¼˜åŒ– æˆ‘ä»¬æ­£åœ¨è®¨è®ºçš„ç¬¬ä¸€ä¸ªä¼˜åŒ–æ˜¯ é€ƒé€¸ä¼˜åŒ–ã€‚ ä¸ºäº†è¯´æ˜é€ƒé€¸åˆ†æçš„ä½œç”¨ï¼Œæˆ‘ä»¬å›æƒ³èµ· Go spec å¹¶æœªæåŠå †æˆ–å †æ ˆã€‚å®ƒä»…æåŠè¯¥è¯­è¨€æ˜¯åœ¨å¼•è¨€ä¸­è¢«åƒåœ¾æ”¶é›†çš„ï¼Œå¹¶æ²¡æœ‰æç¤ºå¦‚ä½•å®ç°è¯¥è¯­è¨€ã€‚ Go è§„èŒƒçš„å…¼å®¹ Go å®ç° å¯ä»¥ å°†æ¯ä¸ªåˆ†é…å­˜å‚¨åœ¨å †ä¸Šã€‚è¿™å°†å¯¹åƒåœ¾æ”¶é›†å™¨æ–½åŠ å¾ˆå¤§å‹åŠ›ï¼Œä½†æ˜¯è¿™ç»ä¸æ˜¯ä¸æ­£ç¡®çš„ã€‚å¤šå¹´æ¥ï¼Œgccgo å¯¹é€ƒé€¸åˆ†æçš„æ”¯æŒéå¸¸æœ‰é™ï¼Œå› æ­¤å¯ä»¥æœ‰æ•ˆåœ°è®¤ä¸ºå®ƒåœ¨è¿™ç§æ¨¡å¼ä¸‹è¿è¡Œã€‚ ä½†æ˜¯ï¼Œgoroutine çš„å †æ ˆä½œä¸ºå­˜å‚¨å±€éƒ¨å˜é‡çš„å»‰ä»·åœºæ‰€è€Œå­˜åœ¨ã€‚æ— éœ€åœ¨å †æ ˆä¸Šè¿›è¡Œåƒåœ¾æ”¶é›†ã€‚å› æ­¤ï¼Œåœ¨å®‰å…¨çš„æƒ…å†µä¸‹ï¼Œæ”¾ç½®åœ¨å †æ ˆä¸Šçš„åˆ†é…å°†æ›´æœ‰æ•ˆã€‚ åœ¨æŸäº›è¯­è¨€ä¸­ï¼Œä¾‹å¦‚ C å’Œ C++ï¼Œé€‰æ‹©åœ¨å †æ ˆä¸Šè¿˜æ˜¯åœ¨å †ä¸Šåˆ†é…æ˜¯ç¨‹åºå‘˜çš„æ‰‹åŠ¨æ“ä½œã€‚å †åˆ†é…æ˜¯é€šè¿‡ malloc å’Œ free è¿›è¡Œçš„ï¼Œæ ˆåˆ†é…æ˜¯é€šè¿‡ alloca è¿›è¡Œçš„ã€‚ä½¿ç”¨è¿™äº›æœºåˆ¶çš„é”™è¯¯æ˜¯å¯¼è‡´å†…å­˜æŸåé”™è¯¯çš„å¸¸è§åŸå› ã€‚ åœ¨ Go ä¸­ï¼Œå¦‚æœå€¼çš„å¯¿å‘½è¶…å‡ºäº†å‡½æ•°è°ƒç”¨çš„å¯¿å‘½ï¼Œåˆ™ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å°†å…¶ç§»åŠ¨åˆ°å †ä¸­ã€‚ è¯´æ˜è¯¥å€¼ é€ƒé€¸ åˆ°å †ã€‚ type Foo struct { a, b, c, d int } func NewFoo() *Foo { return \u0026Foo{a: 3, b: 1, c: 4, d: 7} } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåœ¨ NewFoo ä¸­åˆ†é…çš„ Foo å°†è¢«ç§»åˆ°å †ä¸­ï¼Œå› æ­¤åœ¨ NewFoo è¿”å›åå…¶å†…å®¹ä»ç„¶æœ‰æ•ˆã€‚ è‡ª Go æˆç«‹ä»¥æ¥ï¼Œè¿™ç§æƒ…å†µå°±ä¸€ç›´å­˜åœ¨ã€‚ä¸å…¶è¯´æ˜¯è‡ªåŠ¨çº æ­£åŠŸèƒ½ï¼Œè¿˜ä¸å¦‚è¯´æ˜¯ä¸€ç§ä¼˜åŒ–ã€‚åœ¨ Go ä¸­æ„å¤–è¿”å›å †æ ˆåˆ†é…å˜é‡çš„åœ°å€æ˜¯ä¸å¯èƒ½çš„ã€‚ ä½†æ˜¯ç¼–è¯‘å™¨ä¹Ÿå¯ä»¥åšç›¸åçš„äº‹æƒ…ã€‚å®ƒå¯ä»¥æ‰¾åˆ°å‡å®šåœ¨å †ä¸Šåˆ†é…çš„ä¸œè¥¿ï¼Œå¹¶å°†å®ƒä»¬ç§»åˆ°å †æ ˆä¸­ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ func Sum() int { const count = 100 numbers := make([]int, count) for i := range numbers { numbers[i] = i + 1 } var sum int for _, i := range numbers { sum += i } return sum } func main() { answer := Sum() fmt.Println(answer) } sum å°† 1 ä¸ 100 ä¹‹é—´çš„ int ç›¸åŠ å¹¶è¿”å›ç»“æœã€‚ ç”±äº numbers åˆ‡ç‰‡ä»…åœ¨ Sum å†…éƒ¨å¼•ç”¨ï¼Œå› æ­¤ç¼–è¯‘å™¨å°†å®‰æ’å°†è¯¥åˆ‡ç‰‡çš„ 100 ä¸ªæ•´æ•°å­˜å‚¨åœ¨å †æ ˆä¸­ï¼Œè€Œä¸æ˜¯å †ä¸­ã€‚æ— éœ€åƒåœ¾å›æ”¶ numbersï¼Œå®ƒä¼šåœ¨ Sum è¿”å›æ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚ 4.2.1. è¯æ˜å®ƒ! è¦æ‰“å°ç¼–è¯‘å™¨çš„é€ƒé€¸åˆ†æç»“æœï¼Œè¯·ä½¿ç”¨ -m æ ‡å¿—ã€‚ % go build -gcflags=-m examples/esc/sum.go # command-line-arguments examples/esc/sum.go:22:13: inlining call to fmt.Println examples/esc/sum.go:8:17: Sum make([]int, count) does not escape examples/esc/sum.go:22:13: answer escapes to heap examples/esc/sum.go:22:13: io.Writer(os.Stdout) escapes to heap examples/esc/sum.go:22:13: main []interface {} literal does not escape \u003cautogenerated\u003e:1: os.(*File).close .this does not escape ç¬¬ 8 è¡Œæ˜¾ç¤ºç¼–è¯‘å™¨å·²æ­£ç¡®æ¨æ–­å‡º make([]int, 100) çš„ç»“æœä¸ä¼šé€¸å‡ºåˆ°å †ä¸­ã€‚æ²¡æœ‰çš„åŸå›  ç¬¬ 22 è¡ŒæŠ¥å‘Š answer è½¬å‚¨åˆ°å †ä¸­æ˜¯ fmt.Println æ˜¯ä¸€ä¸ªå¯å˜å‡½æ•°ã€‚å¯å˜å‚æ•°å‡½æ•°çš„å‚æ•°è£…åœ¨åˆ‡ç‰‡ä¸­ï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸º []interface {}ï¼Œå› æ­¤å°† answer æ”¾å…¥æ¥å£å€¼ä¸­ï¼Œå› ä¸ºå®ƒæ˜¯ç”±å¯¹ fmt.Println çš„è°ƒç”¨å¼•ç”¨çš„ã€‚ç”±äº Go 1.6 çš„åƒåœ¾å›æ”¶å™¨è¦æ±‚é€šè¿‡æ¥å£ä¼ é€’çš„æ‰€æœ‰å€¼éƒ½æ˜¯æŒ‡é’ˆï¼Œå› æ­¤ç¼–è¯‘å™¨ä¼˜åŒ–åçš„ä»£ç çš„å¤§è‡´æ˜¯ï¼š var answer = Sum() fmt.Println([]interface{\u0026answer}...) æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ -gcflags=\"-m -m\" æ ‡å¿—æ¥ç¡®è®¤ã€‚åœ¨å“ªè¿”å›äº† % go build -gcflags='-m -m' examples/esc/sum.go 2\u003e\u00261 | grep sum.go:22 examples/esc/sum.go:22:13: inlining call to fmt.Println func(...interface {}) (int, error) { return fmt.Fprintln(io.Writer(os.Stdout), fmt.a...) } examples/esc/sum.go:22:13: answer escapes to heap examples/esc/sum.go:22:13: from ~arg0 (assign-pair) at examples/esc/sum.go:22:13 examples/esc/sum.go:22:13: io.Writer(os.Stdout) escapes to heap examples/esc/sum.go:22:13: from io.Writer(os.Stdout) (passed to call[argument escapes]) at examples/esc/sum.go:22:13 examples/esc/sum.go:22:13: main []interface {} literal does not escape ç®€è€Œè¨€ä¹‹ï¼Œä¸å¿…æ‹…å¿ƒç¬¬ 22 è¡Œçš„é€ƒé€¸ï¼Œè¿™å¯¹æœ¬æ¬¡è®¨è®ºå¹¶ä¸é‡è¦ã€‚ 4.2.2. ç»ƒä¹  è¿™ç§ä¼˜åŒ–å¯¹æ‰€æœ‰ count çš„å€¼éƒ½é€‚ç”¨å—ï¼Ÿ å¦‚æœ count æ˜¯å˜é‡è€Œä¸æ˜¯å¸¸é‡ï¼Œæ­¤ä¼˜åŒ–æ˜¯å¦æˆç«‹ï¼Ÿ å¦‚æœ count æ˜¯ Sum çš„å‚æ•°ï¼Œæ­¤ä¼˜åŒ–æ˜¯å¦æˆç«‹ï¼Ÿ 4.2.3. Escape analysis (continued) è¿™ä¸ªä¾‹å­æ˜¯äººä¸ºé€ çš„ã€‚å®ƒä¸æ—¨åœ¨æˆä¸ºçœŸå®çš„ä»£ç ï¼Œä»…æ˜¯ç¤ºä¾‹ã€‚ type Point struct{ X, Y int } const Width = 640 const Height = 480 func Center(p *Point) { p.X = Width / 2 p.Y = Height / 2 } func NewPoint() { p := new(Point) Center(p) fmt.Println(p.X, p.Y) } NewPoint creates a new *Point value, p. We pass p to the Center function which moves the point to a position in the center of the screen. Finally we print the values of p.X and p.Y. NewPoint åˆ›å»ºä¸€ä¸ªæ–°çš„ *Point å€¼ pã€‚ æˆ‘ä»¬å°† p ä¼ é€’ç»™ Center å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†ç‚¹ç§»åŠ¨åˆ°å±å¹•ä¸­å¿ƒçš„ä½ç½®ã€‚ æœ€åï¼Œæˆ‘ä»¬è¾“å‡º p.X å’Œ p.Y çš„å€¼ã€‚ % go build -gcflags=-m examples/esc/center.go # command-line-arguments examples/esc/center.go:11:6: can inline Center examples/esc/center.go:18:8: inlining call to Center examples/esc/center.go:19:13: inlining call to fmt.Println examples/esc/center.go:11:13: Center p does not escape examples/esc/center.go:19:15: p.X escapes to heap examples/esc/center.go:19:20: p.Y escapes to heap examples/esc/center.go:19:13: io.Writer(os.Stdout) escapes to heap examples/esc/center.go:17:10: NewPoint new(Point) does not escape examples/esc/center.go:19:13: NewPoint []interface {} literal does not escape \u003cautogenerated\u003e:1: os.(*File).close .this does not escape å³ä½¿ä½¿ç”¨æ–°å‡½æ•°åˆ†é…äº† pï¼Œä¹Ÿä¸ä¼šå°†å…¶å­˜å‚¨åœ¨å †ä¸­ï¼Œå› ä¸ºæ²¡æœ‰å¼•ç”¨ p ä¼šé€¸å‡º Center å‡½æ•°ã€‚ é—®é¢˜: é‚£ç¬¬ 19 è¡Œï¼Œå¦‚æœ p ä¸é€ƒé€¸ï¼Œé‚£æ˜¯ä»€ä¹ˆé€ƒé€¸åˆ°äº†å †å‘¢ï¼Ÿ ç¼–å†™ä¸€ä¸ªåŸºå‡†ï¼Œä»¥è§„å®š Sum ä¸åˆ†é…ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:6:2","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"4.3. å†…è” åœ¨ Go å‡½æ•°ä¸­ï¼Œè°ƒç”¨å…·æœ‰å›ºå®šçš„å¼€é”€ï¼›å †æ ˆå’ŒæŠ¢å æ£€æŸ¥ã€‚ ç¡¬ä»¶åˆ†æ”¯é¢„æµ‹å™¨å¯ä»¥æ”¹å–„å…¶ä¸­çš„ä¸€äº›åŠŸèƒ½ï¼Œä½†æ˜¯å°±åŠŸèƒ½å¤§å°å’Œæ—¶é’Ÿå‘¨æœŸè€Œè¨€ï¼Œè¿™ä»ç„¶æ˜¯ä¸€ä¸ªä»£ä»·ã€‚ å†…è”æ˜¯é¿å…è¿™äº›æˆæœ¬çš„ç»å…¸ä¼˜åŒ–æ–¹æ³•ã€‚ ç›´åˆ° Go 1.11 å†…è”ä»…åœ¨ å¶å‡½æ•° ä¸Šèµ·ä½œç”¨ï¼Œè¯¥å‡½æ•°ä¸ä¼šè°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ã€‚è¿™æ ·åšçš„ç†ç”±æ˜¯: å¦‚æœæ‚¨çš„å‡½æ•°åšäº†å¾ˆå¤šå·¥ä½œï¼Œé‚£ä¹ˆå‰å¯¼å¼€é”€å°†å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåŠŸèƒ½è¦è¾¾åˆ°ä¸€å®šçš„å¤§å°ï¼ˆç›®å‰æœ‰ä¸€äº›æŒ‡ä»¤ï¼ŒåŠ ä¸Šä¸€äº›é˜»æ­¢å…¨éƒ¨å†…è”çš„æ“ä½œï¼Œä¾‹å¦‚ï¼Œåœ¨ Go 1.7 ä¹‹å‰è¿›è¡Œåˆ‡æ¢ï¼‰ å¦ä¸€æ–¹é¢ï¼Œå°çš„åŠŸèƒ½ä¸ºæ‰§è¡Œçš„ç›¸å¯¹å°‘é‡çš„æœ‰ç”¨å·¥ä½œæ”¯ä»˜å›ºå®šçš„å¼€é”€ã€‚è¿™äº›æ˜¯å†…è”ç›®æ ‡çš„åŠŸèƒ½ï¼Œå› ä¸ºå®ƒä»¬æœ€å¤§ç¨‹åº¦åœ°å—ç›Šã€‚ å¦ä¸€ä¸ªåŸå› æ˜¯è¿‡å¤šçš„å†…è”ä½¿å †æ ˆè·Ÿè¸ªæ›´éš¾éµå¾ªã€‚ 4.3.1. Inlining (example) func Max(a, b int) int { if a \u003e b { return a } return b } func F() { const a, b = 100, 20 if Max(a, b) == b { panic(b) } } åŒæ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨ -gcflags=-m æ ‡å¿—æ¥æŸ¥çœ‹ç¼–è¯‘å™¨çš„ä¼˜åŒ–å†³ç­–ã€‚ % go build -gcflags=-m examples/inl/max.go # command-line-arguments examples/inl/max.go:4:6: can inline Max examples/inl/max.go:11:6: can inline F examples/inl/max.go:13:8: inlining call to Max examples/inl/max.go:20:6: can inline main examples/inl/max.go:21:3: inlining call to F examples/inl/max.go:21:3: inlining call to Max ç¼–è¯‘å™¨æ‰“å°äº†ä¸¤è¡Œã€‚ ç¬¬ 3 è¡Œä¸­çš„ç¬¬ä¸€ä¸ªæ˜¯ Max çš„å£°æ˜ï¼Œå‘Šè¯‰æˆ‘ä»¬å¯ä»¥å†…è”ã€‚ ç¬¬äºŒä¸ªæŠ¥å‘Šè¯´ï¼ŒMax çš„ä¸»ä½“å·²åœ¨ç¬¬ 12 è¡Œå†…è”åˆ°è°ƒç”¨æ–¹ä¸­ã€‚ åœ¨ä¸ä½¿ç”¨ //go:noinline comment çš„æƒ…å†µä¸‹ï¼Œé‡å†™ Max ä½¿å¾—å®ƒä»ç„¶è¿”å›æ­£ç¡®çš„ç­”æ¡ˆï¼Œä½†æ˜¯ç¼–è¯‘å™¨ä¸å†è®¤ä¸ºå®ƒæ˜¯å¯å†…è”çš„ã€‚ 4.3.2. å†…è”æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ ç¼–è¯‘ max.goï¼Œçœ‹çœ‹ F() çš„ä¼˜åŒ–ç‰ˆæœ¬æ˜¯ä»€ä¹ˆã€‚ % go build -gcflags=-S examples/inl/max.go 2\u003e\u00261 | grep -A5 '\"\".F STEXT' \"\".F STEXT nosplit size=2 args=0x0 locals=0x0 0x0000 00000 (/Users/dfc/devel/high-performance-go-workshop/examples/inl/max.go:11) TEXT \"\".F(SB), NOSPLIT|ABIInternal, $0-0 0x0000 00000 (/Users/dfc/devel/high-performance-go-workshop/examples/inl/max.go:11) FUNCDATA $0, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB) 0x0000 00000 (/Users/dfc/devel/high-performance-go-workshop/examples/inl/max.go:11) FUNCDATA $1, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB) 0x0000 00000 (/Users/dfc/devel/high-performance-go-workshop/examples/inl/max.go:11) FUNCDATA $3, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB) 0x0000 00000 (/Users/dfc/devel/high-performance-go-workshop/examples/inl/max.go:13) PCDATA \u003cspan class=\"katex\"\u003e$1$\u003c/span\u003e0 ä¸€æ—¦å°† Max å†…è”åˆ°å…¶ä¸­ï¼Œå®ƒå°±æ˜¯ F çš„ä¸»ä½“, æ­¤åŠŸèƒ½æ²¡æœ‰ä»»ä½•ååº”ã€‚ æˆ‘çŸ¥é“å±å¹•ä¸Šæœ‰å¾ˆå¤šæ–‡æœ¬ï¼Œä½†æ˜¯ä»€ä¹ˆä¹Ÿæ²¡è¯´ï¼Œä½†è¯·æ‚¨ç›¸ä¿¡ï¼Œå”¯ä¸€å‘ç”Ÿçš„æ˜¯ RETã€‚ å®é™…ä¸Šï¼ŒF å˜ä¸ºï¼š func F() { return } -S çš„è¾“å‡ºä¸æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„æœ€ç»ˆæœºå™¨ä»£ç ã€‚é“¾æ¥å™¨åœ¨æœ€ç»ˆé“¾æ¥é˜¶æ®µè¿›è¡Œä¸€äº›å¤„ç†ã€‚åƒ FUNCDATA å’Œ PCDATA è¿™æ ·çš„è¡Œæ˜¯åƒåœ¾æ”¶é›†å™¨çš„å…ƒæ•°æ®ï¼Œå®ƒä»¬åœ¨é“¾æ¥æ—¶ä¼šç§»åˆ°å…¶ä»–ä½ç½®ã€‚å¦‚æœæ‚¨æ­£åœ¨è¯»å– -S çš„è¾“å‡ºï¼Œåˆ™åªéœ€å¿½ç•¥ FUNCDATA å’Œ PCDATA è¡Œï¼›å®ƒä»¬ä¸æ˜¯æœ€ç»ˆäºŒè¿›åˆ¶æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ã€‚ 4.3.3. è®¨è®º ä¸ºä»€ä¹ˆåœ¨ F() ä¸­å£°æ˜ a å’Œ b ä¸ºå¸¸æ•°ï¼Ÿ å®éªŒè¾“å‡ºä»¥ä¸‹å†…å®¹ï¼šå¦‚æœå°† a å’Œ b å£°æ˜ä¸ºå˜é‡ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ å¦‚æœ a å’Œ b ä½œä¸ºå‚æ•°ä¼ é€’ç»™ F() ä¼šæ€æ ·ï¼Ÿ -gcflags=-S ä¸ä¼šé˜»æ­¢åœ¨æ‚¨çš„å·¥ä½œç›®å½•ä¸­æ„å»ºæœ€ç»ˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å¦‚æœå‘ç°éšåçš„ go build â€¦ è¿è¡Œæ²¡æœ‰è¾“å‡ºï¼Œè¯·åˆ é™¤å·¥ä½œç›®å½•ä¸­çš„ ./max äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ 4.3.4. è°ƒæ•´å†…è”çº§åˆ« è°ƒæ•´ å†…è”çº§åˆ« æ˜¯é€šè¿‡ -gcflags = -l æ ‡å¿—æ‰§è¡Œçš„ã€‚æœ‰äº›ä»¤äººå›°æƒ‘çš„ä¼ é€’å•ä¸ª -l å°†ç¦ç”¨å†…è”ï¼Œè€Œä¸¤ä¸ªæˆ–å¤šä¸ªå°†å¯ç”¨æ›´æ¿€è¿›çš„è®¾ç½®çš„å†…è”ã€‚ -gcflags=-l, ç¦ç”¨å†…è”. æ²¡æœ‰ï¼Œæ­£å¸¸å†…è”ã€‚ -gcflags='-l -l' å†…è”çº§åˆ« 2ï¼Œæ›´å…·æ”»å‡»æ€§ï¼Œå¯èƒ½æ›´å¿«ï¼Œå¯èƒ½ä¼šç”Ÿæˆæ›´å¤§çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ -gcflags='-l -l -l' å†…è” 3 çº§ï¼Œå†æ¬¡æ›´å…·æ”»å‡»æ€§ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶è‚¯å®šæ›´å¤§ï¼Œä¹Ÿè®¸å†æ¬¡æ›´å¿«ï¼Œä½†ä¹Ÿå¯èƒ½æœ‰é—®é¢˜ã€‚ -gcflags=-l=4 Go 1.11 ä¸­çš„ï¼ˆå››ä¸ª -lï¼‰å°†å¯ç”¨å®éªŒæ€§ mid stack inlining optimisationã€‚æˆ‘ç›¸ä¿¡ä» Go 1.12 å¼€å§‹å®ƒæ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚ 4.3.5. ä¸­æ ˆå†…è” ç”±äº Go 1.12 å·²å¯ç”¨æ‰€è°“çš„ ä¸­æ ˆ å†…è”ï¼ˆä»¥å‰åœ¨ Go 1.11 ä¸­çš„é¢„è§ˆä¸­å¸¦æœ‰ -gcflags ='-l -l -l -l' æ ‡å¿—ï¼‰ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­çœ‹åˆ°ä¸­æ ˆå†…è”çš„ç¤ºä¾‹ã€‚åœ¨ Go 1.11 å’Œæ›´æ—©çš„ç‰ˆæœ¬ä¸­ï¼ŒF ä¸ä¼šæ˜¯å¶å­å‡½æ•°ï¼Œå®ƒç§°ä¸º maxã€‚ä½†æ˜¯ç”±äºå†…è”çš„æ”¹è¿›ï¼Œç°åœ¨å°† F å†…è”åˆ°å…¶è°ƒç”¨æ–¹ä¸­ã€‚è¿™æœ‰ä¸¤ä¸ªåŸå› ã€‚å½“å°† max å†…è”åˆ° F ä¸­æ—¶ï¼ŒF ä¸åŒ…å«å…¶ä»–å‡½æ•°è°ƒç”¨ï¼Œå› æ­¤ï¼Œå¦‚æœæœªè¶…è¿‡å…¶å¤æ‚æ€§é¢„ç®—ï¼Œå®ƒå°†æˆä¸ºæ½œåœ¨çš„ å¶å‡½æ•°ã€‚ç”±äº F æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œå†…è”å’Œæ¶ˆé™¤æ­»ä»£ç æ¶ˆé™¤äº†è®¸å¤šå¤æ‚æ€§é¢„ç®—-å®ƒæœ‰èµ„æ ¼è¿›è¡Œ ä¸­æ ˆ å†…è”ï¼Œè€Œä¸è°ƒç”¨maxæ— å…³ã€‚ ä¸­æ ˆå†…è”å¯ç”¨äºå†…è”å‡½æ•°çš„å¿«é€Ÿè·¯å¾„ï¼Œä»è€Œæ¶ˆé™¤äº†å¿«é€Ÿè·¯å¾„ä¸­çš„å‡½æ•°è°ƒç”¨å¼€é”€ã€‚æœ€è¿‘è¿›å…¥ Go 1.13 çš„ CL æ˜¾ç¤ºäº†æ­¤æŠ€æœ¯åº”ç”¨äº sync.RWMutex.Unlock()ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:6:3","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"4.4. æ¶ˆé™¤æ— æ•ˆä»£ç  ä¸ºä»€ä¹ˆ a å’Œ b æ˜¯å¸¸é‡å¾ˆé‡è¦ï¼Ÿ è¦äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ç¼–è¯‘å™¨å°†å…¶ Max å†…è”åˆ° F ä¸­åçœ‹åˆ°çš„å†…å®¹ã€‚æˆ‘ä»¬å¾ˆéš¾ä»ç¼–è¯‘å™¨ä¸­è·å¾—æ­¤ä¿¡æ¯ï¼Œä½†æ˜¯ç›´æ¥æ‰‹åŠ¨å®Œæˆæ˜¯å¾ˆç®€å•çš„ã€‚ Before: func Max(a, b int) int { if a \u003e b { return a } return b } func F() { const a, b = 100, 20 if Max(a, b) == b { panic(b) } } After: func F() { const a, b = 100, 20 var result int if a \u003e b { result = a } else { result = b } if result == b { panic(b) } } å› ä¸º a å’Œ b æ˜¯å¸¸é‡ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å¯ä»¥åœ¨ç¼–è¯‘æ—¶è¯æ˜è¯¥åˆ†æ”¯æ°¸è¿œä¸ä¼šä¸ºå‡ã€‚100 å§‹ç»ˆå¤§äº 20ã€‚ å› æ­¤ï¼Œç¼–è¯‘å™¨å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ– F ä»¥ func F() { const a, b = 100, 20 var result int if true { result = a } else { result = b } if result == b { panic(b) } } ç°åœ¨å·²ç»çŸ¥é“äº†åˆ†æ”¯çš„ç»“æœï¼Œé‚£ä¹ˆ result çš„å†…å®¹ä¹Ÿå°±çŸ¥é“äº†ã€‚è¿™å°±æ˜¯ æ¶ˆé™¤åˆ†æ”¯. func F() { const a, b = 100, 20 const result = a if result == b { panic(b) } } ç°åœ¨æ¶ˆé™¤äº†åˆ†æ”¯ï¼Œæˆ‘ä»¬çŸ¥é“ result æ€»æ˜¯ç­‰äº aï¼Œå¹¶ä¸”å› ä¸º a æ˜¯å¸¸æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“ result æ˜¯å¸¸æ•°ã€‚ç¼–è¯‘å™¨å°†æ­¤è¯æ˜åº”ç”¨äºç¬¬äºŒä¸ªåˆ†æ”¯ func F() { const a, b = 100, 20 const result = a if false { panic(b) } } å†æ¬¡ä½¿ç”¨åˆ†æ”¯æ¶ˆé™¤ï¼Œæœ€ç»ˆå½¢å¼ä¸º Fã€‚ func F() { const a, b = 100, 20 const result = a } æœ€åå°±æ˜¯ func F() { } 4.4.1. æ¶ˆé™¤æ— æ•ˆä»£ç ï¼ˆç»­ï¼‰ åˆ†æ”¯æ¶ˆé™¤æ˜¯ç§°ä¸º æ— æ•ˆä»£ç æ¶ˆé™¤ çš„ä¼˜åŒ–ç±»åˆ«ä¹‹ä¸€ã€‚å®é™…ä¸Šï¼Œä½¿ç”¨é™æ€è¯æ˜æ¥æ˜¾ç¤ºï¼Œæ®µä»£ç æ˜¯æ°¸è¿œæ— æ³•è®¿é—®çš„ï¼Œä¿—ç§° æ— æ•ˆï¼Œå› æ­¤ä¸éœ€è¦åœ¨æœ€ç»ˆäºŒè¿›åˆ¶æ–‡ä»¶ä¸­å¯¹å…¶è¿›è¡Œç¼–è¯‘ï¼Œä¼˜åŒ–æˆ–å‘å‡ºã€‚ æˆ‘ä»¬çœ‹åˆ°äº†æ— æ•ˆä»£ç æ¶ˆé™¤å¦‚ä½•ä¸å†…è”ä¸€èµ·å·¥ä½œï¼Œä»¥å‡å°‘é€šè¿‡åˆ é™¤è¯æ˜æ— æ³•è®¿é—®çš„å¾ªç¯å’Œåˆ†æ”¯è€Œå‡å°‘çš„ä»£ç é‡ã€‚ æ‚¨å¯ä»¥åˆ©ç”¨æ­¤ä¼˜åŠ¿å®æ–½æ˜‚è´µçš„è°ƒè¯•ï¼Œå¹¶å°†å…¶éšè— const debug = false ä¸æ„å»ºæ ‡ç­¾ç»“åˆä½¿ç”¨ï¼Œè¿™å¯èƒ½éå¸¸æœ‰ç”¨ã€‚ 4.4.2. è¿›ä¸€æ­¥é˜…è¯» Using // +build to switch between debug and release builds How to use conditional compilation with the go build tool ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:6:4","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"4.5. ç¼–è¯‘å™¨æ ‡è¯†ç»ƒä¹  % go build -gcflags=$FLAGS ç ”ç©¶ä»¥ä¸‹ç¼–è¯‘å™¨åŠŸèƒ½çš„æ“ä½œï¼š -S æ‰“å°æ­£åœ¨ç¼–è¯‘çš„ç¨‹åºåŒ…çš„ (Go é£æ ¼) ç¨‹åºé›†ã€‚ -l æ§åˆ¶å†…è”çš„è¡Œä¸ºï¼› -l ç¦ç”¨å†…è”ï¼Œ-l -l å¢åŠ å†…è”ï¼ˆæ›´å¤š -l å¢åŠ ç¼–è¯‘å™¨å¯¹å†…è”ä»£ç çš„éœ€æ±‚ï¼‰ã€‚å°è¯•ç¼–è¯‘æ—¶é—´ï¼Œç¨‹åºå¤§å°å’Œè¿è¡Œæ—¶é—´çš„å·®å¼‚ã€‚ -m æ§åˆ¶è¯¸å¦‚å†…è”ï¼Œè½¬ä¹‰åˆ†æä¹‹ç±»çš„ä¼˜åŒ–å†³ç­–çš„æ‰“å°ã€‚-m -m æ‰“å°æœ‰å…³ç¼–è¯‘å™¨æ€æƒ³çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚ -l -N ç¦ç”¨æ‰€æœ‰ä¼˜åŒ–ã€‚ å¦‚æœå‘ç°éšåçš„ go build â€¦â€‹ è¿è¡Œæ²¡æœ‰è¾“å‡ºï¼Œè¯·åˆ é™¤å·¥ä½œç›®å½•ä¸­çš„ ./max äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ 4.5.1 è¿›ä¸€æ­¥é˜…è¯» Codegen Inspection by Jaana Burcu Dogan ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:6:5","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"4.6. è¾¹ç•Œæ£€æŸ¥æ¶ˆé™¤ Go æ˜¯ä¸€ç§è¾¹ç•Œæ£€æŸ¥è¯­è¨€ã€‚è¿™æ„å‘³ç€å°†æ£€æŸ¥æ•°ç»„å’Œåˆ‡ç‰‡ä¸‹æ ‡æ“ä½œï¼Œä»¥ç¡®ä¿å®ƒä»¬åœ¨ç›¸åº”ç±»å‹çš„èŒƒå›´å†…ã€‚ å¯¹äºæ•°ç»„ï¼Œè¿™å¯ä»¥åœ¨ç¼–è¯‘æ—¶å®Œæˆã€‚å¯¹äºåˆ‡ç‰‡ï¼Œè¿™å¿…é¡»åœ¨è¿è¡Œæ—¶å®Œæˆã€‚ var v = make([]int, 9) var A, B, C, D, E, F, G, H, I int func BenchmarkBoundsCheckInOrder(b *testing.B) { for n := 0; n \u003c b.N; n++ { A = v[0] B = v[1] C = v[2] D = v[3] E = v[4] F = v[5] G = v[6] H = v[7] I = v[8] } } ä½¿ç”¨ -gcflags=-S æ¥æ‹†è§£ BenchmarkBoundsCheckInOrderã€‚æ¯ä¸ªå¾ªç¯æ‰§è¡Œå¤šå°‘ä¸ªè¾¹ç•Œæ£€æŸ¥æ“ä½œï¼Ÿ func BenchmarkBoundsCheckOutOfOrder(b *testing.B) { for n := 0; n \u003c b.N; n++ { I = v[8] A = v[0] B = v[1] C = v[2] D = v[3] E = v[4] F = v[5] G = v[6] H = v[7] } } é‡æ–°å®‰æ’æˆ‘ä»¬é€šè¿‡ I åˆ†é… A çš„é¡ºåºæ˜¯å¦ä¼šå½±å“è£…é…ã€‚åˆ†è§£ BenchmarkBoundsCheckOutOfOrder å¹¶æ‰¾å‡ºã€‚ 4.6.1. ç»ƒä¹  é‡æ–°æ’åˆ—ä¸‹æ ‡æ“ä½œçš„é¡ºåºæ˜¯å¦ä¼šå½±å“å‡½æ•°çš„å¤§å°ï¼Ÿå®ƒä¼šå½±å“åŠŸèƒ½çš„é€Ÿåº¦å—ï¼Ÿ å¦‚æœå°† v ç§»å…¥ åŸºå‡† å‡½æ•°å†…éƒ¨ä¼šæ€æ ·ï¼Ÿ å¦‚æœ v è¢«å£°æ˜ä¸ºæ•°ç»„ï¼Œvar v [9] int ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:6:6","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"5. æ‰§è¡Œè¿½è¸ªå™¨ æ‰§è¡Œè·Ÿè¸ªç¨‹åºæ˜¯ç”± Dmitry Vyukov ä¸º Go 1.5 å¼€å‘çš„ï¼Œå¹¶ä¸”ä»å¤„äºè®°å½•å’Œä½¿ç”¨çŠ¶æ€ï¼Œå·²æœ‰å¥½å‡ å¹´äº†ã€‚ ä¸åŸºäºæ ·æœ¬çš„åˆ†æä¸åŒï¼Œæ‰§è¡Œè·Ÿè¸ªå™¨é›†æˆåˆ° Go è¿è¡Œæ—¶ä¸­ï¼Œå› æ­¤å®ƒåªçŸ¥é“ Go ç¨‹ åºåœ¨ç‰¹å®šæ—¶é—´ç‚¹æ­£åœ¨åšä»€ä¹ˆï¼Œä½†æ˜¯ ä¸ºä»€ä¹ˆã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:7:0","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"5.1. ä»€ä¹ˆæ˜¯æ‰§è¡Œè·Ÿè¸ªå™¨ï¼Œä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ æˆ‘è®¤ä¸ºï¼Œé€šè¿‡æŸ¥çœ‹ä¸€æ®µä»£ç  go tool pprof çš„æ•ˆæœä¸å¥½ï¼Œå¯ä»¥æœ€å®¹æ˜“åœ°è§£é‡Šæ‰§è¡Œè·Ÿè¸ªå™¨çš„åŠŸèƒ½ï¼Œä»¥åŠä¸ºä»€ä¹ˆè¿™æ ·åšå¾ˆé‡è¦ã€‚ examples/mandelbrot ç›®å½•åŒ…å«ä¸€ä¸ªç®€å•çš„ mandelbrot ç”Ÿæˆå™¨ã€‚è¯¥ä»£ç æ¥è‡ª Francesc Campoyâ€™s mandelbrot packageã€‚ % cd examples/mandelbrot % go build \u0026\u0026 ./mandelbrot å¦‚æœæˆ‘ä»¬æ„å»ºå®ƒï¼Œç„¶åè¿è¡Œå®ƒï¼Œå®ƒå°†ç”Ÿæˆå¦‚ä¸‹å†…å®¹ 5.1.1. å¤šä¹…æ—¶é—´ï¼Ÿ é‚£ä¹ˆï¼Œæ­¤ç¨‹åºéœ€è¦å¤šé•¿æ—¶é—´æ‰èƒ½ç”Ÿæˆ 1024 * 1024 åƒç´ çš„å›¾åƒï¼Ÿ æˆ‘çŸ¥é“å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œçš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ time(1) ä¹‹ç±»çš„ä¸œè¥¿ã€‚ % time ./mandelbrot real 0m1.654s user 0m1.630s sys 0m0.015s ä¸è¦ä½¿ç”¨ time go run mandebrot.goï¼Œå¦åˆ™æ‚¨å°†èŠ±è´¹ ç¼–è¯‘ ç¨‹åºä»¥åŠè¿è¡Œè¯¥ç¨‹åºæ‰€éœ€çš„æ—¶é—´ã€‚ 5.1.2. è¯¥ç¨‹åºåœ¨åšä»€ä¹ˆï¼Ÿ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œç¨‹åºèŠ±è´¹äº† 1.6 ç§’æ¥ç”Ÿæˆ mandelbrot å¹¶å†™å…¥ pngã€‚ è¿™æ ·å¥½å—ï¼Ÿæˆ‘ä»¬å¯ä»¥åŠ å¿«é€Ÿåº¦å—ï¼Ÿ å›ç­”è¯¥é—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ Go å†…ç½®çš„ pprof æ¥åˆ†æç¨‹åºã€‚ è®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:7:1","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"5.2. ç”Ÿæˆæ€§èƒ½åˆ†æ è¦ç”Ÿæˆæ€§èƒ½åˆ†æï¼Œæˆ‘ä»¬éœ€è¦ ç›´æ¥ä½¿ç”¨ runtime/pprof è½¯ä»¶åŒ…ã€‚ ä½¿ç”¨ç±»ä¼¼ github.com/pkg/profile çš„åŒ…è£…å™¨è‡ªåŠ¨æ‰§è¡Œæ­¤æ“ä½œã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:7:2","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"5.3. ä½¿ç”¨ runtime/pprof ç”Ÿæˆæ€§èƒ½åˆ†æ ä¸ºäº†å‘Šè¯‰æ‚¨æˆ‘æ²¡æœ‰ä½¿ç”¨é»‘ç§‘æŠ€(é­”æ³•)ï¼Œè®©æˆ‘ä»¬ä¿®æ”¹ç¨‹åºä»¥å°† CPU æ€§èƒ½åˆ†æå†™å…¥ os.Stdoutã€‚ import \"runtime/pprof\" func main() { pprof.StartCPUProfile(os.Stdout) defer pprof.StopCPUProfile() By adding this code to the top of the main function, this program will write a profile to os.Stdout. é€šè¿‡å°†æ­¤ä»£ç æ·»åŠ åˆ° main å‡½æ•°çš„é¡¶éƒ¨ï¼Œè¯¥ç¨‹åºä¼šå°†é…ç½®æ–‡ä»¶å†™å…¥ os.Stdoutã€‚ % cd examples/mandelbrot-runtime-pprof % go run mandelbrot.go \u003e cpu.pprof åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ go runï¼Œå› ä¸º cpu é…ç½®æ–‡ä»¶å°†ä»…åŒ…å« mandelbrot.go çš„æ‰§è¡Œï¼Œè€Œä¸åŒ…æ‹¬å…¶ç¼–è¯‘ã€‚ 5.3.1. ä½¿ç”¨ github.com/pkg/profile ç”Ÿæˆæ€§èƒ½åˆ†æ ä¸Šä¸€å¼ å¹»ç¯ç‰‡æ˜¾ç¤ºäº†ä¸€ç§ç”Ÿæˆé…ç½®æ–‡ä»¶çš„è¶…çº§ç®€ä¾¿çš„æ–¹æ³•ï¼Œä½†æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚ å¦‚æœæ‚¨å¿˜è®°äº†å°†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ï¼Œåˆ™ä¼šç ´åè¯¥ç»ˆç«¯ä¼šè¯ã€‚ğŸ˜ï¼ˆæç¤ºï¼šreset(1) æ˜¯æ‚¨çš„æœ‹å‹ï¼‰ å¦‚æœæ‚¨å‘ os.Stdout ä¸­å†™å…¥å…¶ä»–å†…å®¹ (ä¾‹å¦‚ï¼Œfmt.Println)ï¼Œåˆ™ä¼šç ´åè·Ÿè¸ªã€‚ æ¨èä½¿ç”¨ runtime/pprof çš„æ–¹æ³•æ˜¯ å°†è·Ÿè¸ªä¿¡æ¯å†™å…¥æ–‡ä»¶ã€‚ ä½†æ˜¯ï¼Œæ‚¨å¿…é¡»ç¡®ä¿è·Ÿè¸ªå·²åœæ­¢ï¼Œå¹¶ä¸”åœ¨ç¨‹åºåœæ­¢ä¹‹å‰ (åŒ…æ‹¬æœ‰äºº ^C) å…³é—­äº†æ–‡ä»¶ã€‚ å› æ­¤ï¼Œå‡ å¹´å‰ï¼Œæˆ‘å†™äº†ä¸€ä¸ª package æ¥å¤„ç†å®ƒã€‚ import \"github.com/pkg/profile\" func main() { defer profile.Start(profile.CPUProfile, profile.ProfilePath(\".\")).Stop() å¦‚æœè¿è¡Œæ­¤ç‰ˆæœ¬ï¼Œåˆ™å°†é…ç½®æ–‡ä»¶å†™å…¥å½“å‰å·¥ä½œç›®å½• % go run mandelbrot.go 2017/09/17 12:22:06 profile: cpu profiling enabled, cpu.pprof 2017/09/17 12:22:08 profile: cpu profiling disabled, cpu.pprof ä½¿ç”¨ pkg/profile ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä½†æ˜¯å®ƒä¼šå¤„ç†æ”¶é›†å’Œè®°å½•è·Ÿè¸ªä¿¡æ¯çš„è®¸å¤šæ ·æ¿ï¼Œå› æ­¤æˆ‘ä»¬å°†åœ¨æœ¬è®²ä¹ ç­çš„å…¶ä½™éƒ¨åˆ†ä¸­ä½¿ç”¨å®ƒã€‚ 5.3.2. åˆ†ææ€§èƒ½ ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæ€§èƒ½åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ go tool pprof å¯¹å…¶è¿›è¡Œåˆ†æã€‚ % go tool pprof -http=:8080 cpu.pprof åœ¨æ­¤è¿è¡Œä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ç¨‹åºè¿è¡Œäº† 1.81 ç§’ (åˆ†æå¢åŠ äº†å°‘é‡å¼€é”€)ã€‚æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ° pprof ä»…æ•è·äº† 1.53 ç§’çš„æ•°æ®ï¼Œå› ä¸º pprof åŸºäºç¤ºä¾‹ï¼Œå®ƒä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ SIGPROF è®¡æ—¶å™¨ã€‚ ä» 1.9 å¼€å§‹ï¼Œpprof è·Ÿè¸ªåŒ…å«åˆ†æè·Ÿè¸ªæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚æ‚¨ä¸å†éœ€è¦ç”Ÿæˆè·Ÿè¸ªçš„åŒ¹é…äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ğŸ‰ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ top pprof å‡½æ•°å¯¹è·Ÿè¸ªè®°å½•çš„å‡½æ•°è¿›è¡Œæ’åº % go tool pprof cpu.pprof Type: cpu Time: Mar 24, 2019 at 5:18pm (CET) Duration: 2.16s, Total samples = 1.91s (88.51%) Entering interactive mode (type \"help\" for commands, \"o\" for options) (pprof) top Showing nodes accounting for 1.90s, 99.48% of 1.91s total Showing top 10 nodes out of 35 flat flat% sum% cum cum% 0.82s 42.93% 42.93% 1.63s 85.34% main.fillPixel 0.81s 42.41% 85.34% 0.81s 42.41% main.paint 0.11s 5.76% 91.10% 0.12s 6.28% runtime.mallocgc 0.04s 2.09% 93.19% 0.04s 2.09% runtime.memmove 0.04s 2.09% 95.29% 0.04s 2.09% runtime.nanotime 0.03s 1.57% 96.86% 0.03s 1.57% runtime.pthread_cond_signal 0.02s 1.05% 97.91% 0.04s 2.09% compress/flate.(*compressor).deflate 0.01s 0.52% 98.43% 0.01s 0.52% compress/flate.(*compressor).findMatch 0.01s 0.52% 98.95% 0.01s 0.52% compress/flate.hash4 0.01s 0.52% 99.48% 0.01s 0.52% image/png.filter æˆ‘ä»¬çœ‹åˆ°ï¼Œå½“ pprof æ•è·å †æ ˆæ—¶ï¼Œmain.fillPixel å‡½æ•°åœ¨ CPU ä¸Šçš„æ•°é‡æœ€å¤šã€‚ åœ¨å †æ ˆä¸Šæ‰¾åˆ° main.paint å¹¶ä¸å¥‡æ€ªï¼Œè¿™å°±æ˜¯ç¨‹åºçš„ä½œç”¨ã€‚å®ƒç»˜åˆ¶åƒç´ ã€‚ä½†æ˜¯ï¼Œæ˜¯ä»€ä¹ˆå¯¼è‡´ paint èŠ±è´¹å¤§é‡æ—¶é—´å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥é€šè¿‡å°† cummulative æ ‡å¿—è®¾ç½®ä¸º top æ¥è¿›è¡Œæ£€æŸ¥ã€‚ (pprof) top --cum Showing nodes accounting for 1630ms, 85.34% of 1910ms total Showing top 10 nodes out of 35 flat flat% sum% cum cum% 0 0% 0% 1840ms 96.34% main.main 0 0% 0% 1840ms 96.34% runtime.main 820ms 42.93% 42.93% 1630ms 85.34% main.fillPixel 0 0% 42.93% 1630ms 85.34% main.seqFillImg 810ms 42.41% 85.34% 810ms 42.41% main.paint 0 0% 85.34% 210ms 10.99% image/png.(*Encoder).Encode 0 0% 85.34% 210ms 10.99% image/png.Encode 0 0% 85.34% 160ms 8.38% main.(*img).At 0 0% 85.34% 160ms 8.38% runtime.convT2Inoptr 0 0% 85.34% 150ms 7.85% image/png.(*encoder).writeIDATs è¿™æš—ç¤ºç€ main.fillPixed å®é™…ä¸Šæ­£åœ¨å®Œæˆå¤§éƒ¨åˆ†å·¥ä½œã€‚ æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ web å‘½ä»¤æ¥å½¢è±¡åŒ–é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:7:3","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"5.4. è·Ÿè¸ªå’Œæ€§èƒ½åˆ†æ å¸Œæœ›æ­¤ç¤ºä¾‹æ˜¾ç¤ºäº†åˆ†æçš„å±€é™æ€§ã€‚æ€§èƒ½åˆ†æå‘Šè¯‰æˆ‘ä»¬æ¢æŸ¥å™¨çœ‹åˆ°çš„å†…å®¹ï¼›fillPixel æ­£åœ¨å®Œæˆæ‰€æœ‰å·¥ä½œã€‚ä¼¼ä¹æ²¡æœ‰å¾ˆå¤šäº‹æƒ…å¯ä»¥åšã€‚ å› æ­¤ï¼Œç°åœ¨æ˜¯å¼•å…¥æ‰§è¡Œè·Ÿè¸ªç¨‹åºçš„å¥½æ—¶æœºï¼Œè¯¥è·Ÿè¸ªç¨‹åºå¯ä»¥ä¸ºåŒä¸€ç¨‹åºæä¾›ä¸åŒçš„è§†å›¾ã€‚ 5.4.1. ä½¿ç”¨æ‰§è¡Œè·Ÿè¸ªå™¨ ä½¿ç”¨è·Ÿè¸ªç¨‹åºå°±åªéœ€è¦æ”¹å˜ä¸º profile.TraceProfile å³å¯ã€‚ import \"github.com/pkg/profile\" func main() { defer profile.Start(profile.TraceProfile, profile.ProfilePath(\".\")).Stop() å½“æˆ‘ä»¬è¿è¡Œç¨‹åºæ—¶ï¼Œæˆ‘ä»¬åœ¨å½“å‰å·¥ä½œç›®å½•ä¸­å¾—åˆ°ä¸€ä¸ª trace.out æ–‡ä»¶ã€‚ % go build mandelbrot.go % time ./mandelbrot 2017/09/17 13:19:10 profile: trace enabled, trace.out 2017/09/17 13:19:12 profile: trace disabled, trace.out real 0m1.740s user 0m1.707s sys 0m0.020s å°±åƒ pprof ä¸€æ ·ï¼Œgo å‘½ä»¤ä¸­æœ‰ä¸€ä¸ªå·¥å…·å¯ä»¥åˆ†æè·Ÿè¸ªã€‚ % go tool trace trace.out 2017/09/17 12:41:39 Parsing trace... 2017/09/17 12:41:40 Serializing trace... 2017/09/17 12:41:40 Splitting trace... 2017/09/17 12:41:40 Opening browser. Trace viewer s listening on http://127.0.0.1:57842 è¿™ä¸ªå·¥å…·å’Œ go tool pprof æœ‰ç‚¹ä¸åŒã€‚æ‰§è¡Œè·Ÿè¸ªå™¨æ­£åœ¨é‡ç”¨ Chrome å†…ç½®çš„è®¸å¤šé…ç½®æ–‡ä»¶å¯è§†åŒ–åŸºç¡€ç»“æ„ï¼Œå› æ­¤ go tool trace å……å½“æœåŠ¡å™¨å°†åŸå§‹æ‰§è¡Œè·Ÿè¸ªè½¬æ¢ä¸º Chome å¯ä»¥æœ¬åœ°æ˜¾ç¤ºçš„æ•°æ®ã€‚ 5.4.2. åˆ†æè¿½è¸ª ä»è·Ÿè¸ªä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥ç¨‹åºä»…ä½¿ç”¨ä¸€ä¸ª cpuã€‚ func seqFillImg(m *img) { for i, row := range m.m { for j := range row { fillPixel(m, i, j) } } } è¿™å¹¶ä¸å¥‡æ€ªï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œmandelbrot.go ä¼šæŒ‰é¡ºåºä¸ºæ¯ä¸€è¡Œä¸­çš„æ¯ä¸ªåƒç´ è°ƒç”¨ fillPixelã€‚ ç»˜åˆ¶å®Œå›¾åƒåï¼ŒæŸ¥çœ‹æ‰§è¡Œåˆ‡æ¢ä¸ºå†™å…¥ .png æ–‡ä»¶ã€‚è¿™ä¼šåœ¨å †ä¸Šç”Ÿæˆåƒåœ¾ï¼Œå› æ­¤è·Ÿè¸ªåœ¨é‚£æ—¶å‘ç”Ÿäº†å˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åƒåœ¾æ”¶é›†å †çš„ç»å…¸é”¯é½¿æ¨¡å¼ã€‚ è·Ÿè¸ªæ€§èƒ½åˆ†æå¯æä¾›ä½è‡³ æ¯«ç§’ çº§åˆ«çš„æ—¶åºåˆ†è¾¨ç‡ã€‚ è¿™æ˜¯æ‚¨ä½¿ç”¨å¤–éƒ¨æ€§èƒ½åˆ†ææ— æ³•è·å¾—çš„ã€‚ åœ¨ç»§ç»­ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è°ˆè°ˆè·Ÿè¸ªå·¥å…·çš„ç”¨æ³•ã€‚ æŠ±æ­‰ï¼Œè¯¥å·¥å…·ä½¿ç”¨ Chrome å†…ç½®çš„ javascript è°ƒè¯•æ”¯æŒã€‚è·Ÿè¸ªé…ç½®æ–‡ä»¶åªèƒ½åœ¨ Chrome ä¸­æŸ¥çœ‹ï¼Œè€Œä¸èƒ½åœ¨ Firefox, Safari, IE/Edge ä¸­ä½¿ç”¨ã€‚ å› ä¸ºè¿™æ˜¯ Google äº§å“ï¼Œæ‰€ä»¥å®ƒæ”¯æŒé”®ç›˜å¿«æ·é”®ã€‚ä½¿ç”¨ WASD å¯¼èˆªï¼Œä½¿ç”¨ ? è·å–åˆ—è¡¨ã€‚ æŸ¥çœ‹è¿½è¸ªå¯èƒ½ä¼šå ç”¨å¤§é‡å†…å­˜ã€‚ è®¤çœŸåœ°è¯´ï¼Œ4Gb ä¸ä¼šå‰Šå‡å®ƒï¼Œ8Gb å¯èƒ½æ˜¯æœ€å°å€¼ï¼Œæ›´å¤šè‚¯å®šæ›´å¥½ã€‚ å¦‚æœæ‚¨æ˜¯ä» Fedora ä¹‹ç±»çš„ OS å‘è¡Œç‰ˆä¸­å®‰è£… Go çš„ï¼Œåˆ™è·Ÿè¸ªæŸ¥çœ‹å™¨çš„æ”¯æŒæ–‡ä»¶å¯èƒ½ä¸æ˜¯ä¸» golang deb/rpm çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä»¬å¯èƒ½ä½äºæŸäº› -extra è½¯ä»¶åŒ…ä¸­ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:7:4","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"5.5. ä½¿ç”¨å¤šä¸ª CPU ä»å‰é¢çš„è·Ÿè¸ªä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¨‹åºæ­£åœ¨æŒ‰é¡ºåºè¿è¡Œï¼Œå¹¶ä¸”æ²¡æœ‰åˆ©ç”¨è¯¥è®¡ç®—æœºä¸Šçš„å…¶ä»– CPUã€‚ Mandelbrot çš„ç”Ÿæˆç§°ä¸º embarassingly_parallel ã€‚æ¯ä¸ªåƒç´ å½¼æ­¤ç‹¬ç«‹ï¼Œéƒ½å¯ä»¥å¹¶è¡Œè®¡ç®—ã€‚æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ã€‚ % go build mandelbrot.go % time ./mandelbrot -mode px 2017/09/17 13:19:48 profile: trace enabled, trace.out 2017/09/17 13:19:50 profile: trace disabled, trace.out real 0m1.764s user 0m4.031s sys 0m0.865s å› æ­¤ï¼Œè¿è¡Œæ—¶é—´åŸºæœ¬ä¸Šæ˜¯ç›¸åŒçš„ã€‚æˆ‘ä»¬ä½¿ç”¨äº†æ‰€æœ‰ CPUï¼Œå› æ­¤æœ‰æ›´å¤šçš„ç”¨æˆ·æ—¶é—´ï¼Œè¿™æ˜¯æœ‰é“ç†çš„ï¼Œä½†æ˜¯å® é™…(æŒ‚é’Ÿ) æ—¶é—´å¤§è‡´ç›¸åŒã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿½è¸ªã€‚ å¦‚æ‚¨æ‰€è§ï¼Œæ­¤è·Ÿè¸ªç”Ÿæˆäº† æ›´å¤š çš„æ•°æ®ã€‚ ä¼¼ä¹éœ€è¦å®Œæˆå¾ˆå¤šå·¥ä½œï¼Œä½†æ˜¯å¦‚æœæ‚¨æ”¾å¤§æ”¾å¤§ï¼Œå°±ä¼šå‘ç°å·®è·ã€‚æ®ä¿¡è¿™æ˜¯è°ƒåº¦ç¨‹åºã€‚ è™½ç„¶æˆ‘ä»¬ä½¿ç”¨æ‰€æœ‰å››ä¸ªå†…æ ¸ï¼Œä½†æ˜¯ç”±äºæ¯ä¸ª fillPixel çš„å·¥ä½œé‡ç›¸å¯¹è¾ƒå°ï¼Œå› æ­¤æˆ‘ä»¬åœ¨è°ƒåº¦å¼€é”€æ–¹é¢èŠ±è´¹äº†å¤§é‡æ—¶é—´ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:7:5","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"5.6. æ•´ç†å·¥ä½œ æ¯ä¸ªåƒç´ ä½¿ç”¨ä¸€ä¸ª goroutine å¤ªç»†ç²’åº¦ã€‚æ²¡æœ‰è¶³å¤Ÿçš„å·¥ä½œæ¥è¯æ˜ goroutine çš„æˆæœ¬åˆç†ã€‚ ç›¸åï¼Œè®©æˆ‘ä»¬å°è¯•ä¸ºæ¯ä¸ª goroutine å¤„ç†ä¸€è¡Œã€‚ % go build mandelbrot.go % time ./mandelbrot -mode row 2017/09/17 13:41:55 profile: trace enabled, trace.out 2017/09/17 13:41:55 profile: trace disabled, trace.out real 0m0.764s user 0m1.907s sys 0m0.025s è¿™çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªä¸é”™çš„æ”¹è¿›ï¼Œæˆ‘ä»¬å‡ ä¹å°†ç¨‹åºçš„è¿è¡Œæ—¶é—´å‡å°‘äº†ä¸€åŠã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ç—•è¿¹ã€‚ å¦‚æ‚¨æ‰€è§ï¼Œè½¨è¿¹ç°åœ¨æ›´å°ï¼Œæ›´æ˜“äºä½¿ç”¨ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è·¨åº¦çš„æ•´ä¸ªè½¨è¿¹ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸é”™çš„å¥–åŠ±ã€‚ åœ¨ç¨‹åºå¼€å§‹æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ° goroutine çš„æ•°é‡å¤§çº¦ä¸º 1000 è¿™æ˜¯å¯¹ä¸Šä¸€æ¡è·Ÿè¸ªä¸­çœ‹åˆ°çš„ 1 \u003c\u003c 20 çš„æ”¹è¿›ã€‚ æ”¾å¤§åï¼Œæˆ‘ä»¬çœ‹åˆ° onePerRowFillImg è¿è¡Œæ—¶é—´æ›´é•¿ï¼Œå¹¶ä¸”ç”±äº goroutine ç”Ÿäº§ å·¥ä½œå°½æ—©å®Œæˆï¼Œè°ƒåº¦ç¨‹åºæœ‰æ•ˆåœ°å¤„ç†äº†å…¶ä½™å¯è¿è¡Œçš„ goroutineã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:7:6","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"5.7. ä½¿ç”¨ workers mandelbrot.go æ”¯æŒå¦ä¸€ç§æ¨¡å¼ï¼Œè¯·å°è¯•ä¸€ä¸‹ % go build mandelbrot.go % time ./mandelbrot -mode workers 2017/09/17 13:49:46 profile: trace enabled, trace.out 2017/09/17 13:49:50 profile: trace disabled, trace.out real 0m4.207s user 0m4.459s sys 0m1.284s å› æ­¤ï¼Œè¿è¡Œæ—¶æ¯”ä»¥å‰ä»»ä½•æ—¶å€™éƒ½å·®ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿½è¸ªï¼Œçœ‹çœ‹æ˜¯å¦å¯ä»¥å¼„æ¸…æ¥šå‘ç”Ÿäº†ä»€ä¹ˆã€‚ è§‚å¯Ÿç—•è¿¹ï¼Œæ‚¨ä¼šå‘ç°åªæœ‰ä¸€ä¸ª worker å¤„ç†å™¨ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¾€å¾€ä¼šè½®æ¢ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ª worker å¤„ç†å™¨å’Œä¸€ä¸ªæ¶ˆè´¹è€…ã€‚ è®©æˆ‘ä»¬å¢åŠ  worker å¤„ç†å™¨æ•°é‡ % go build mandelbrot.go % time ./mandelbrot -mode workers -workers 4 2017/09/17 13:52:51 profile: trace enabled, trace.out 2017/09/17 13:52:57 profile: trace disabled, trace.out real 0m5.528s user 0m7.307s sys 0m4.311s è¿™æ ·å°±æ›´ç³Ÿäº†ï¼ æ›´å¤šå®æ—¶ï¼Œæ›´å¤š CPU æ—¶é—´ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿½è¸ªï¼Œçœ‹çœ‹å‘ç”Ÿäº†ä»€ä¹ˆã€‚ é‚£æ¡ç—•è¿¹æ˜¯ä¸€å›¢ç³Ÿã€‚ æœ‰æ›´å¤šçš„ worker å¤„ç†å™¨å¯ç”¨ï¼Œä½†æ˜¯ä¼¼ä¹æ‰€æœ‰çš„æ—¶é—´éƒ½èŠ±åœ¨å¤„ç†å™¨æ‰§è¡Œä¸Šã€‚ è¿™æ˜¯å› ä¸ºé€šé“æ˜¯ æ— ç¼“å­˜çš„ã€‚åªæœ‰åœ¨æœ‰äººå‡†å¤‡æ¥æ”¶ä¹‹å‰ï¼Œæ— ç¼“å†²çš„é€šé“æ‰èƒ½å‘é€ã€‚ åœ¨æ²¡æœ‰ worker å¤„ç†å™¨å‡†å¤‡æ¥æ”¶ä¹‹å‰ï¼Œç”Ÿäº§è€…æ— æ³•å‘é€ä½œå“ã€‚ worker å¤„ç†å™¨è¦ç­‰åˆ°æœ‰äººå‡†å¤‡æ´¾é£åæ‰èƒ½æ¥å—å·¥ä½œï¼Œå› æ­¤ä»–ä»¬åœ¨ç­‰å¾…æ—¶ä¼šäº’ç›¸ç«äº‰ã€‚ å‘é€è€…æ²¡æœ‰ç‰¹æƒï¼Œå®ƒä¸èƒ½æ¯”å·²ç»è¿è¡Œçš„å·¥ä½œè€…äº«æœ‰ä¼˜å…ˆæƒã€‚ æˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°çš„æ˜¯æ— ç¼“å†²é€šé“å¸¦æ¥çš„å¤§é‡å»¶è¿Ÿã€‚è°ƒåº¦ç¨‹åºå†…éƒ¨æœ‰å¾ˆå¤šåœæ­¢å’Œå¯åŠ¨ï¼Œå¹¶ä¸”åœ¨ç­‰å¾…å·¥ä½œæ—¶å¯èƒ½ä¼šé”å®šå’Œäº’æ–¥ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬çœ‹åˆ° sys æ—¶é—´æ›´é•¿çš„åŸå› ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:7:7","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"5.8. ä½¿ç”¨ç¼“å†²é€šé“ import \"github.com/pkg/profile\" func main() { defer profile.Start(profile.TraceProfile, profile.ProfilePath(\".\")).Stop() % go build mandelbrot.go % time ./mandelbrot -mode workers -workers 4 2017/09/17 14:23:56 profile: trace enabled, trace.out 2017/09/17 14:23:57 profile: trace disabled, trace.out real 0m0.905s user 0m2.150s sys 0m0.121s è¿™ä¸ä¸Šé¢çš„æ¯è¡Œæ¨¡å¼éå¸¸æ¥è¿‘ã€‚ ä½¿ç”¨ç¼“å†²çš„é€šé“ï¼Œè·Ÿè¸ªæ˜¾ç¤ºå‡ºï¼š ç”Ÿäº§è€…ä¸å¿…ç­‰å¾… worker å¤„ç†å™¨çš„åˆ°æ¥ï¼Œå®ƒå¯ä»¥è¿…é€Ÿå¡«è¡¥æ¸ é“ã€‚ worker å¤„ç†å™¨å¯ä»¥å¿«é€Ÿä»é€šé“ä¸­å–å‡ºä¸‹ä¸€ä¸ªç‰©å“ï¼Œè€Œæ— éœ€ä¼‘çœ ç­‰å¾…ç”Ÿäº§ã€‚ ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬ä½¿ç”¨é€šé“è¿›è¡Œæ¯ä¸ªåƒç´ çš„å·¥ä½œä¼ é€’çš„é€Ÿåº¦å‡ ä¹ä¸ä¹‹å‰åœ¨æ¯è¡Œ goroutine ä¸Šè¿›è¡Œè°ƒåº¦çš„é€Ÿåº¦ç›¸åŒã€‚ ä¿®æ”¹ nWorkersFillImg ä»¥æ¯è¡Œå·¥ä½œã€‚è®¡æ—¶ç»“æœå¹¶åˆ†æè½¨è¿¹ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:7:8","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"5.9. Mandelbrot å¾®æœåŠ¡ åœ¨ 2019 å¹´ï¼Œé™¤éæ‚¨å¯ä»¥å°† Internet ä½œä¸ºæ— æœåŠ¡å™¨å¾®æœåŠ¡æä¾›ï¼Œå¦åˆ™ç”Ÿæˆ Mandelbrots æ¯«æ— æ„ä¹‰ã€‚ å› æ­¤ï¼Œæˆ‘å‘æ‚¨ä»‹ç» Mandelweb % go run examples/mandelweb/mandelweb.go 2017/09/17 15:29:21 listening on http://127.0.0.1:8080/ http://127.0.0.1:8080/mandelbrot 5.9.1. è·Ÿè¸ªæ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åº åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯¹æ•´ä¸ªç¨‹åºè¿›è¡Œäº†è·Ÿè¸ªã€‚ å¦‚æ‚¨æ‰€è§ï¼Œå³ä½¿åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…ï¼Œè·Ÿè¸ªä¹Ÿå¯èƒ½éå¸¸å¤§ï¼Œå› æ­¤ï¼Œè¿ç»­æ”¶é›†è·Ÿè¸ªæ•°æ®å°†äº§ç”Ÿå¤ªå¤šçš„æ•°æ®ã€‚åŒæ ·ï¼Œè·Ÿè¸ªå¯èƒ½ä¼šå½±å“ç¨‹åºçš„é€Ÿåº¦ï¼Œç‰¹åˆ«æ˜¯åœ¨æ´»åŠ¨å¾ˆå¤šçš„æƒ…å†µä¸‹ã€‚ æˆ‘ä»¬æƒ³è¦çš„æ˜¯ä¸€ç§ä»æ­£åœ¨è¿è¡Œçš„ç¨‹åºä¸­æ”¶é›†ç®€çŸ­è·Ÿè¸ªçš„æ–¹æ³•ã€‚ å¹¸è¿çš„æ˜¯ï¼Œnet/http/pprof è½¯ä»¶åŒ…å…·æœ‰è¿™æ ·çš„åŠŸèƒ½ã€‚ 5.9.2. é€šè¿‡ http æ”¶é›†è·Ÿè¸ª å¸Œæœ›æ¯ä¸ªäººéƒ½çŸ¥é“ net/http/pprof è½¯ä»¶åŒ…ã€‚ import _ \"net/http/pprof\" å¯¼å…¥åï¼Œnet/http/pprof å°†å‘ http.DefaultServeMux æ³¨å†Œè·Ÿè¸ªå’Œåˆ†æè·¯ç”±ã€‚ä» Go 1.5 å¼€å§‹ï¼Œè¿™åŒ…æ‹¬è·Ÿè¸ªåˆ†æå™¨ã€‚ net/http/pprof å‘ http.DefaultServeMux æ³¨å†Œã€‚å¦‚æœæ‚¨éšå¼æˆ–æ˜¾å¼åœ°ä½¿ç”¨è¯¥ ServeMuxï¼Œåˆ™å¯èƒ½ä¼šæ— æ„é—´å°† pprof ç«¯ç‚¹å…¬å¼€åˆ° Internetã€‚è¿™å¯èƒ½å¯¼è‡´æºä»£ç æ³„éœ²ã€‚æ‚¨å¯èƒ½ä¸æƒ³è¿™æ ·åšã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ curlï¼ˆæˆ–wgetï¼‰ä» mandelweb ä¸­è·å–äº”ç§’é’Ÿçš„è·Ÿè¸ªè®°å½• % curl -o trace.out http://127.0.0.1:8080/debug/pprof/trace?seconds=5 5.9.3. äº§ç”Ÿä¸€äº›è´Ÿè½½ å‰é¢çš„ç¤ºä¾‹å¾ˆæœ‰è¶£ï¼Œä½†æ˜¯æ ¹æ®å®šä¹‰ï¼Œç©ºé—²çš„ Web æœåŠ¡å™¨æ²¡æœ‰æ€§èƒ½é—®é¢˜ã€‚æˆ‘ä»¬éœ€è¦äº§ç”Ÿä¸€äº›è´Ÿè½½ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ hey by JBDã€‚ % go get -u github.com/rakyll/hey è®©æˆ‘ä»¬ä»æ¯ç§’ä¸€ä¸ªè¯·æ±‚å¼€å§‹ã€‚ % hey -c 1 -n 1000 -q 1 http://127.0.0.1:8080/mandelbrot ç„¶åè¿è¡Œï¼Œåœ¨å¦ä¸€ä¸ªçª—å£ä¸­æ”¶é›†è·Ÿè¸ª % curl -o trace.out http://127.0.0.1:8080/debug/pprof/trace?seconds=5 % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 66169 0 66169 0 0 13233 0 --:--:-- 0:00:05 --:--:-- 17390 % go tool trace trace.out 2017/09/17 16:09:30 Parsing trace... 2017/09/17 16:09:30 Serializing trace... 2017/09/17 16:09:30 Splitting trace... 2017/09/17 16:09:30 Opening browser. Trace viewer is listening on http://127.0.0.1:60301 5.9.4. æ¨¡æ‹Ÿè¿‡è½½ è®©æˆ‘ä»¬å°†é€Ÿç‡æé«˜åˆ°æ¯ç§’ 5 ä¸ªè¯·æ±‚ã€‚ % hey -c 5 -n 1000 -q 5 http://127.0.0.1:8080/mandelbrot ç„¶åè¿è¡Œï¼Œåœ¨å¦ä¸€ä¸ªçª—å£ä¸­æ”¶é›†è·Ÿè¸ª % curl -o trace.out http://127.0.0.1:8080/debug/pprof/trace?seconds=5 % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 66169 0 66169 0 0 13233 0 --:--:-- 0:00:05 --:--:-- 17390 % go tool trace trace.out 2017/09/17 16:09:30 Parsing trace... 2017/09/17 16:09:30 Serializing trace... 2017/09/17 16:09:30 Splitting trace... 2017/09/17 16:09:30 Opening browser. Trace viewer is listening on http://127.0.0.1:60301 5.9.5. é¢å¤–çš„ä¿¡èª‰ï¼ŒEratosthenes çš„ç­›å­ concurrent prime sieve æ˜¯æœ€æ—©ç¼–å†™çš„ Go ç¨‹åºä¹‹ä¸€ã€‚ Ivan Daniluk æ’°å†™äº†ä¸€ç¯‡å…³äºå¯è§†åŒ–çš„å¾ˆæ£’çš„æ–‡ç« ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä½¿ç”¨æ‰§è¡Œè·Ÿè¸ªå™¨çš„æ“ä½œã€‚ 5.9.6. æ›´å¤šèµ„æº Rhys Hiltner, Goâ€™s execution tracer (dotGo 2016) Rhys Hiltner, An Introduction to â€œgo tool traceâ€ (GopherCon 2017) Dave Cheney, Seven ways to profile Go programs (GolangUK 2016) Dave Cheney, High performance Go workshop] Ivan Daniluk, Visualizing Concurrency in Go (GopherCon 2016) Kavya Joshi, Understanding Channels (GopherCon 2017) Francesc Campoy, Using the Go execution tracer ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:7:9","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"6. å†…å­˜å’Œåƒåœ¾æ”¶é›†å™¨ Go æ˜¯ä¸€ç§ gc è¯­è¨€ã€‚è¿™æ˜¯è®¾è®¡åŸåˆ™ï¼Œä¸ä¼šæ”¹å˜ã€‚ ä½œä¸º gc è¯­è¨€ï¼ŒGo ç¨‹åºçš„æ€§èƒ½é€šå¸¸å–å†³äºå®ƒä»¬ä¸ gc çš„äº¤äº’ã€‚ é™¤äº†é€‰æ‹©ç®—æ³•ä¹‹å¤–ï¼Œå†…å­˜æ¶ˆè€—æ˜¯å†³å®šåº”ç”¨ç¨‹åºæ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§çš„æœ€é‡è¦å› ç´ ã€‚ æœ¬èŠ‚è®¨è®ºåƒåœ¾æ”¶é›†å™¨çš„æ“ä½œï¼Œå¦‚ä½•æµ‹é‡ç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µä»¥åŠåœ¨åƒåœ¾æ”¶é›†å™¨æ€§èƒ½æˆä¸ºç“¶é¢ˆçš„æƒ…å†µä¸‹é™ä½å†…å­˜ä½¿ç”¨é‡çš„ç­–ç•¥ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:8:0","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"6.1. gc çš„ä¸–ç•Œè§‚ ä»»ä½•åƒåœ¾æ”¶é›†å™¨çš„ç›®çš„éƒ½æ˜¯ä¸ºäº†ç»™ç¨‹åºä¸€ç§å¹»æƒ³ï¼Œå³å­˜åœ¨æ— é™æ•°é‡çš„å¯ç”¨å†…å­˜ã€‚ æ‚¨å¯èƒ½ä¸åŒæ„æ­¤å£°æ˜ï¼Œä½†è¿™æ˜¯åƒåœ¾æ”¶é›†å™¨è®¾è®¡è€…å¦‚ä½•å·¥ä½œçš„åŸºæœ¬å‡è®¾ã€‚ ä»¤äººéœ‡æƒŠçš„æ˜¯ï¼Œå°±æ€»è¿è¡Œæ—¶é—´è€Œè¨€ï¼Œæ ‡è®°æ‰«æ GC æ˜¯æœ€æœ‰æ•ˆçš„ï¼›å¾ˆå¥½ï¼Œé€‚ç”¨äºæ‰¹å¤„ç†ï¼Œæ¨¡æ‹Ÿç­‰ã€‚ä½†æ˜¯ï¼Œéšç€æ—¶é—´çš„æµé€ï¼ŒGo GC å·²ä»çº¯ç²¹çš„åœæ­¢ä¸–ç•Œæ”¶é›†å™¨è½¬å˜ä¸ºå¹¶å‘çš„éå‹ç¼©æ”¶é›†å™¨ã€‚è¿™æ˜¯å› ä¸º Go GC ä¸“ä¸ºä½å»¶è¿ŸæœåŠ¡å™¨å’Œäº¤äº’å¼åº”ç”¨ç¨‹åºè€Œè®¾è®¡ã€‚ Go GC çš„è®¾è®¡å€¾å‘äºåœ¨ æœ€å¤§ååé‡ ä¸Š é™ä½å»¶è¿Ÿã€‚å®ƒå°†ä¸€äº›åˆ†é…æˆæœ¬ç§»åˆ°äº† mutator ä¸Šï¼Œä»¥å‡å°‘ä»¥åçš„æ¸…ç†æˆæœ¬ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:8:1","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"6.2. åƒåœ¾æ”¶é›†å™¨è®¾è®¡ å¤šå¹´æ¥ï¼ŒGo GC çš„è®¾è®¡å‘ç”Ÿäº†å˜åŒ– Go 1.0, åœæ­¢å¤§é‡åŸºäº tcmalloc çš„ä¸–ç•Œæ ‡è®°æ¸…é™¤æ”¶é›†å™¨ã€‚ Go 1.3, å®Œå…¨ç²¾ç¡®çš„æ”¶é›†å™¨ï¼Œä¸ä¼šå°†å †ä¸Šçš„å¤§æ•°å­—è¯¯è®¤ä¸ºæ˜¯æŒ‡é’ˆï¼Œä»è€Œä¸ä¼šæµªè´¹å†…å­˜ã€‚ Go 1.5, æ–°çš„ GC è®¾è®¡ï¼Œç€é‡äº ååé‡ å»¶è¿Ÿã€‚ Go 1.6, GC çš„æ”¹è¿›ï¼Œä»¥è¾ƒä½çš„å»¶è¿Ÿå¤„ç†è¾ƒå¤§çš„å †ã€‚ Go 1.7, è¾ƒå°çš„ GC æ”¹è¿›ï¼Œä¸»è¦æ˜¯é‡æ„ã€‚ Go 1.8, è¿›ä¸€æ­¥å·¥ä½œä»¥å‡å°‘ STW æ—¶é—´ï¼Œç°åœ¨å·²é™è‡³ 100 å¾®ç§’èŒƒå›´ã€‚ Go 1.10+, æ‘†è„±çº¯ç²¹çš„åˆä½œ Goroutine è°ƒåº¦ ä»¥é™ä½è§¦å‘æ•´ä¸ªGCå‘¨æœŸæ—¶çš„å»¶è¿Ÿã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:8:2","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"6.3. åƒåœ¾æ”¶é›†å™¨ç›‘æ§ ä¸€ç§è·å¾—åƒåœ¾æ”¶é›†å™¨å·¥ä½œé‡çš„æ€»ä½“æ€è·¯çš„ç®€å•æ–¹æ³•æ˜¯å¯ç”¨ GC æ—¥å¿—è®°å½•çš„è¾“å‡ºã€‚ è¿™äº›ç»Ÿè®¡ä¿¡æ¯å§‹ç»ˆä¼šæ”¶é›†ï¼Œä½†é€šå¸¸ä¼šè¢«ç¦æ­¢æ˜¾ç¤ºï¼Œæ‚¨å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ GODEBUG å¯ç”¨å®ƒä»¬ã€‚ % env GODEBUG=gctrace=1 godoc -http=:8080 gc 1 @0.012s 2%: 0.026+0.39+0.10 ms clock, 0.21+0.88/0.52/0+0.84 ms cpu, 4-\u003e4-\u003e0 MB, 5 MB goal, 8 P gc 2 @0.016s 3%: 0.038+0.41+0.042 ms clock, 0.30+1.2/0.59/0+0.33 ms cpu, 4-\u003e4-\u003e1 MB, 5 MB goal, 8 P gc 3 @0.020s 4%: 0.054+0.56+0.054 ms clock, 0.43+1.0/0.59/0+0.43 ms cpu, 4-\u003e4-\u003e1 MB, 5 MB goal, 8 P gc 4 @0.025s 4%: 0.043+0.52+0.058 ms clock, 0.34+1.3/0.64/0+0.46 ms cpu, 4-\u003e4-\u003e1 MB, 5 MB goal, 8 P gc 5 @0.029s 5%: 0.058+0.64+0.053 ms clock, 0.46+1.3/0.89/0+0.42 ms cpu, 4-\u003e4-\u003e1 MB, 5 MB goal, 8 P gc 6 @0.034s 5%: 0.062+0.42+0.050 ms clock, 0.50+1.2/0.63/0+0.40 ms cpu, 4-\u003e4-\u003e1 MB, 5 MB goal, 8 P gc 7 @0.038s 6%: 0.057+0.47+0.046 ms clock, 0.46+1.2/0.67/0+0.37 ms cpu, 4-\u003e4-\u003e1 MB, 5 MB goal, 8 P gc 8 @0.041s 6%: 0.049+0.42+0.057 ms clock, 0.39+1.1/0.57/0+0.46 ms cpu, 4-\u003e4-\u003e1 MB, 5 MB goal, 8 P gc 9 @0.045s 6%: 0.047+0.38+0.042 ms clock, 0.37+0.94/0.61/0+0.33 ms cpu, 4-\u003e4-\u003e1 MB, 5 MB goal, 8 P è·Ÿè¸ªè¾“å‡ºç»™å‡ºäº†GCæ´»æ€§çš„ä¸€èˆ¬åº¦é‡ã€‚the runtime package documentation ä¸­æè¿°äº† gctrace=1 çš„è¾“å‡ºæ ¼å¼ã€‚ DEMO: æ˜¾ç¤ºå¯ç”¨äº† GODEBUG=gctrace=1 çš„ godoc åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ­¤ç¯å¢ƒå˜é‡ï¼Œä¸ä¼šå¯¹æ€§èƒ½äº§ç”Ÿå½±å“ã€‚ å½“æ‚¨çŸ¥é“æœ‰é—®é¢˜æ—¶ï¼Œä½¿ç”¨ GODEBUG=gctrace=1 å¾ˆå¥½ï¼Œä½†æ˜¯å¯¹äºGoåº”ç”¨ç¨‹åºä¸Šçš„å¸¸è§„é¥æµ‹ï¼Œæˆ‘å»ºè®®ä½¿ç”¨ net/http/pprof æ¥å£ã€‚ import _ \"net/http/pprof\" å¯¼å…¥ net/http/pprof è½¯ä»¶åŒ…å°†åœ¨ /debug/pprof æ³¨å†Œä¸€ä¸ªå…·æœ‰å„ç§è¿è¡Œæ—¶æŒ‡æ ‡çš„å¤„ç†ç¨‹åºï¼ŒåŒ…æ‹¬ï¼š A list of all the running goroutines, /debug/pprof/heap?debug=1. A report on the memory allocation statistics, /debug/pprof/heap?debug=1. net/http/pprof å°†ä½¿ç”¨é»˜è®¤çš„ http.ServeMux æ³¨å†Œè‡ªå·±ã€‚ è¯·å°å¿ƒï¼Œå› ä¸ºå¦‚æœæ‚¨ä½¿ç”¨ http.ListenAndServe(address, nil)ï¼Œè¿™å°†æ˜¯å¯è§çš„ã€‚ DEMO: godoc -http=:8080, ä¼šæ˜¾ç¤º /debug/pprofã€‚ 6.3.1. åƒåœ¾æ”¶é›†å™¨è°ƒæ•´ Go è¿è¡Œæ—¶æä¾›äº†ä¸€ä¸ªç”¨äºè°ƒæ•´ GC çš„ç¯å¢ƒå˜é‡ GOGCã€‚ GOGC çš„å…¬å¼æ˜¯ $$ goal = reachabl\\e * (1 + (GOGC)/100) $$ ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å½“å‰æœ‰ä¸€ä¸ª256MBçš„å †ï¼Œå¹¶ä¸” GOGC=100 (é»˜è®¤å€¼)ï¼Œå½“å †å¡«æ»¡æ—¶ï¼Œå®ƒå°†å¢é•¿åˆ° $$ 512MB = 256MB * (1 + 100/100) $$ GOGC çš„å€¼å¤§äº100ä¼šä½¿å †å¢é•¿æ›´å¿«ï¼Œä»è€Œå‡è½»äº† GC çš„å‹åŠ›ã€‚ å°äº 100 çš„ GOGC å€¼ä¼šå¯¼è‡´å †ç¼“æ…¢å¢é•¿ï¼Œä»è€Œå¢åŠ äº† GC çš„å‹åŠ›ã€‚ é»˜è®¤å€¼ 100 ä»…ä½œä¸ºå‚è€ƒã€‚ åœ¨ä½¿ç”¨ç”Ÿäº§è´Ÿè½½å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œæ€§èƒ½åˆ†æ ä¹‹åï¼Œæ‚¨åº”è¯¥é€‰æ‹©è‡ªå·±çš„å€¼ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:8:3","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"6.4. å‡å°‘åˆ†é… ç¡®ä¿æ‚¨çš„ API å…è®¸è°ƒç”¨æ–¹å‡å°‘ç”Ÿæˆçš„åƒåœ¾é‡ã€‚ è€ƒè™‘è¿™ä¸¤ç§è¯»å–æ–¹æ³• func (r *Reader) Read() ([]byte, error) func (r *Reader) Read(buf []byte) (int, error) ç¬¬ä¸€ä¸ª Read æ–¹æ³•ä¸å¸¦ä»»ä½•å‚æ•°ï¼Œå¹¶ä»¥ []byte çš„å½¢å¼è¿”å›ä¸€äº›æ•°æ®ã€‚ç¬¬äºŒä¸ªæ¥æ”¶ä¸€ä¸ª []byte ç¼“å†²åŒºï¼Œå¹¶è¿”å›è¯»å–çš„å­—èŠ‚æ•°ã€‚ ç¬¬ä¸€ä¸ª Read æ–¹æ³•å°† å§‹ç»ˆ åˆ†é…ç¼“å†²åŒºï¼Œä»è€Œç»™GCå¸¦æ¥å‹åŠ›ã€‚ç¬¬äºŒä¸ªå¡«å……å®ƒç»™å®šçš„ç¼“å†²åŒºã€‚ æ‚¨å¯ä»¥åœ¨æ ‡å‡†åº“ä¸­å‘½åéµå¾ªæ­¤æ¨¡å¼çš„ç¤ºä¾‹å—ï¼Ÿ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:8:4","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"6.5. strings å’Œ []bytes åœ¨ Go ä¸­ï¼Œstring çš„å€¼æ˜¯ä¸å¯å˜çš„ï¼Œ[]byte æ˜¯å¯å˜çš„ã€‚ å¤§å¤šæ•°ç¨‹åºéƒ½å–œæ¬¢ä½¿ç”¨ stringï¼Œä½†æ˜¯å¤§å¤šæ•° IO æ˜¯ä½¿ç”¨ []byte æ¥å®Œæˆçš„ã€‚ å°½å¯èƒ½é¿å…å°† []byte è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè¿™é€šå¸¸æ„å‘³ç€é€‰æ‹©ä¸€ç§è¡¨ç¤ºå½¢å¼ï¼Œå³ string æˆ– []byte ä½œä¸ºå€¼ã€‚å¦‚æœæ‚¨ä»ç½‘ç»œæˆ–ç£ç›˜è¯»å–æ•°æ®ï¼Œé€šå¸¸ä¸º []byteã€‚ bytes åŒ…åŒ…å«è®¸å¤šä¸ strings è½¯ä»¶åŒ…ç›¸åŒçš„æ“ä½œ - Split, Compare, HasPrefixï¼ŒTrim ç­‰ã€‚ åœ¨åº•å±‚ï¼Œstrings ä¸ bytesåŒ…ä½¿ç”¨ç›¸åŒçš„æ±‡ç¼–åŸè¯­ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:8:5","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"6.6. ä½¿ç”¨ []byte ä½œä¸º map çš„ key ä½¿ç”¨ string ä½œä¸ºæ˜ å°„é”®æ˜¯å¾ˆå¸¸è§çš„ï¼Œä½†æ˜¯é€šå¸¸æ‚¨ä¼šä½¿ç”¨ []byteã€‚ ç¼–è¯‘å™¨é’ˆå¯¹è¿™ç§æƒ…å†µå®ç°äº†ç‰¹å®šçš„ä¼˜åŒ– var m map[string]string v, ok := m[string(bytes)] è¿™å°†é¿å…å°†å­—èŠ‚åˆ‡ç‰‡è½¬æ¢ä¸ºç”¨äºæ˜ å°„æŸ¥æ‰¾çš„å­—ç¬¦ä¸²ã€‚è¿™æ˜¯éå¸¸å…·ä½“çš„æ“ä½œï¼Œå¦‚æœæ‚¨æ‰§è¡Œä»¥ä¸‹æ“ä½œå°†æ— æ³•æ­£å¸¸å·¥ä½œ key := string(bytes) val, ok := m[key] è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯å¦ä»ç„¶æ­£ç¡®ã€‚ç¼–å†™ä¸€ä¸ªåŸºå‡†ï¼Œæ¯”è¾ƒä½¿ç”¨ []byte ä½œä¸º string æ˜ å°„é”®çš„è¿™ä¸¤ç§æ–¹æ³•ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:8:6","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"6.7. é¿å…å­—ç¬¦ä¸²è¿æ¥ è½¬åˆ°å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ã€‚è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²ä¼šç”Ÿæˆç¬¬ä¸‰ä¸ªå­—ç¬¦ä¸²ã€‚ ä»¥ä¸‹å“ªé¡¹æ˜¯æœ€å¿«çš„ï¼Ÿ s := request.ID s += \" \" + client.Addr().String() s += \" \" + time.Now().String() r = s var b bytes.Buffer fmt.Fprintf(\u0026b, \"%s %v %v\", request.ID, client.Addr(), time.Now()) r = b.String() r = fmt.Sprintf(\"%s %v %v\", request.ID, client.Addr(), time.Now()) b := make([]byte, 0, 40) b = append(b, request.ID...) b = append(b, ' ') b = append(b, client.Addr().String()...) b = append(b, ' ') b = time.Now().AppendFormat(b, \"2006-01-02 15:04:05.999999999 -0700 MST\") r = string(b) var b strings.Builder b.WriteString(request.ID) b.WriteString(\" \") b.WriteString(client.Addr().String()) b.WriteString(\" \") b.WriteString(time.Now().String()) r = b.String() DEMO: go test -bench=. ./examples/concat ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:8:7","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"6.8. å¦‚æœé•¿åº¦å·²çŸ¥ï¼Œåˆ™é¢„åˆ†é…ç‰‡ è¿½åŠ å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å¾ˆæµªè´¹ã€‚ åˆ‡ç‰‡é€šè¿‡å°†å¤šè¾¾ 1024 ä¸ªå…ƒç´ åŠ å€è€Œå¢é•¿ï¼Œç„¶åå¢åŠ çº¦ 25ï¼…ã€‚æˆ‘ä»¬å†è¿½åŠ ä¸€é¡¹åï¼Œb çš„å®¹é‡æ˜¯å¤šå°‘ï¼Ÿ func main() { b := make([]int, 1024) b = append(b, 99) fmt.Println(\"len:\", len(b), \"cap:\", cap(b)) } å¦‚æœä½¿ç”¨ append æ¨¡å¼ï¼Œåˆ™å¯èƒ½ä¼šå¤åˆ¶å¤§é‡æ•°æ®å¹¶åˆ›å»ºå¤§é‡åƒåœ¾ã€‚ å¦‚æœçŸ¥é“äº‹å…ˆçŸ¥é“åˆ‡ç‰‡çš„é•¿åº¦ï¼Œåˆ™å¯ä»¥é¢„å…ˆåˆ†é…ç›®æ ‡ï¼Œä»¥é¿å…å¤åˆ¶å¹¶ç¡®ä¿ç›®æ ‡å¤§å°æ­£ç¡®ã€‚ Before var s []string for _, v := range fn() { s = append(s, v) } return s After vals := fn() s := make([]string, len(vals)) for i, v := range vals { s[i] = v } return s ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:8:8","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"6.9. ä½¿ç”¨ sync.Pool sync è½¯ä»¶åŒ…å¸¦æœ‰ sync.Pool ç±»å‹ï¼Œç”¨äºé‡ç”¨å…¬å…±å¯¹è±¡ã€‚ sync.Pool æ²¡æœ‰å›ºå®šå¤§å°æˆ–æœ€å¤§å®¹é‡ã€‚æ‚¨æ·»åŠ åˆ°å®ƒå¹¶ä»ä¸­å–å‡ºç›´åˆ°å‘ç”Ÿ GCï¼Œç„¶åå°†å…¶æ— æ¡ä»¶æ¸…ç©ºã€‚è¿™æ˜¯ by design: å¦‚æœåœ¨åƒåœ¾å›æ”¶ä¹‹å‰ä¸ºæ—¶è¿‡æ—©è€Œåœ¨åƒåœ¾å›æ”¶ä¹‹åä¸ºæ—¶è¿‡æ™šï¼Œåˆ™æ’ç©ºæ± çš„æ­£ç¡®æ—¶é—´å¿…é¡»åœ¨åƒåœ¾å›æ”¶æœŸé—´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ± ç±»å‹çš„è¯­ä¹‰å¿…é¡»æ˜¯å®ƒåœ¨æ¯ä¸ªåƒåœ¾å›æ”¶æ—¶éƒ½æ¶ˆè€—æ‰ã€‚â€”â€‰Russ Cox ä½¿ç”¨ sync.Pool var pool = sync.Pool{ New: func() interface{} { return make([]byte, 4096) }, } func fn() { buf := pool.Get().([]byte) // takes from pool or calls New // do work pool.Put(buf) // returns buf to the pool } sync.Pool ä¸æ˜¯ç¼“å­˜ã€‚å®ƒå¯ä»¥å¹¶ä¸”å°†åœ¨ä»»ä½•æ—¶é—´æ¸…ç©ºã€‚ ä¸è¦å°†é‡è¦é¡¹ç›®æ”¾åœ¨ sync.Pool ä¸­ï¼Œå®ƒä»¬å°†è¢«ä¸¢å¼ƒã€‚ Go 1.13 ä¸­å¯èƒ½ä¼šæ›´æ”¹åœ¨æ¯ä¸ª GC ä¸Šæ¸…ç©ºçš„ sync.Pool çš„è®¾è®¡ï¼Œè¿™å°†æœ‰åŠ©äºæé«˜å…¶å®ç”¨æ€§ã€‚ æ­¤ CL é€šè¿‡å¼•å…¥å—å®³è€…ç¼“å­˜æœºåˆ¶æ¥è§£å†³æ­¤é—®é¢˜ã€‚ä»£æ›¿æ¸…é™¤æ± ï¼Œå°†åˆ é™¤å—å®³ç¼“å­˜ï¼Œå¹¶å°†ä¸»ç¼“å­˜ç§»è‡³å—å®³ç¼“å­˜ã€‚ ç»“æœï¼Œåœ¨ç¨³å®šçŠ¶æ€ä¸‹ï¼Œï¼ˆå‡ ä¹ï¼‰æ²¡æœ‰æ–°åˆ†é…ï¼Œä½†æ˜¯å¦‚æœ Pool ä½¿ç”¨ç‡ä¸‹é™ï¼Œå¯¹è±¡ä»å°†åœ¨ä¸¤ä¸ª GCï¼ˆè€Œä¸æ˜¯ä¸€ä¸ªï¼‰ä¸­æ”¶é›†ã€‚â€”â€‰Austin Clements https://go-review.googlesource.com/c/go/+/166961/ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:8:9","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"6.10. ç»ƒä¹  ä½¿ç”¨ godocï¼ˆæˆ–å…¶ä»–ç¨‹åºï¼‰è§‚å¯Ÿä½¿ç”¨ GODEBUG=gctrace=1 æ”¹å˜ GOGC çš„ç»“æœã€‚ ä½¿ç”¨ bytes, string ä½œä¸º map key å¹¶æ£€æŸ¥åŸºå‡†ã€‚ ä¸åŒå­—ç¬¦ä¸²è¿æ¥ç­–ç•¥çš„åŸºå‡†åˆ†é…ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:8:10","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"7. æç¤ºå’Œæ—…è¡Œ éšæœºè·å–æç¤ºå’Œå»ºè®® æœ€åä¸€éƒ¨åˆ†åŒ…å«ä¸€äº›å¾®ä¼˜åŒ– Go ä»£ç çš„æŠ€å·§ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:9:0","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"7.1. Goroutines Goroutines æ˜¯ä½¿å…¶éå¸¸é€‚åˆç°ä»£ç¡¬ä»¶çš„å…³é”®åŠŸèƒ½ã€‚ Goroutines æ˜“äºä½¿ç”¨ï¼Œè€Œä¸”åˆ›å»ºæˆæœ¬ä½å»‰ï¼Œæ‚¨å¯ä»¥å°†å®ƒä»¬è§†ä¸º å‡ ä¹ å…è´¹ã€‚ Go è¿è¡Œæ—¶å·²é’ˆå¯¹å…·æœ‰æˆåƒä¸Šä¸‡ä¸ª goroutine ä½œä¸ºæ ‡å‡†çš„ç¨‹åºè€Œç¼–å†™ï¼Œæ•°åä¸‡ä¸ªå¹¶ä¸æ„å¤–ã€‚ ä½†æ˜¯ï¼Œæ¯ä¸ª goroutine ç¡®å®æ¶ˆè€—äº† goroutine å †æ ˆçš„æœ€å°å†…å­˜é‡ï¼Œç›®å‰è‡³å°‘ä¸º2kã€‚ 2048 * 1,000,000 ä¸ª goroutines == 2GB çš„å†…å­˜ï¼Œä»–ä»¬è¿˜æ²¡æœ‰åšä»»ä½•äº‹æƒ…ã€‚ å¯èƒ½å¾ˆå¤šï¼Œä½†æœªæä¾›åº”ç”¨ç¨‹åºçš„å…¶ä»–ç”¨æ³•ã€‚ 7.1.1. çŸ¥é“ä½•æ—¶åœæ­¢ goroutine Goroutine çš„å¯åŠ¨æ–¹ä¾¿ï¼Œè¿è¡Œä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯åœ¨å†…å­˜å ç”¨æ–¹é¢ç¡®å®æœ‰ä¸€å®šçš„æˆæœ¬ã€‚æ‚¨ä¸èƒ½åˆ›å»ºæ— é™æ•°é‡çš„å®ƒä»¬ã€‚ æ¯æ¬¡æ‚¨åœ¨ç¨‹åºä¸­ä½¿ç”¨goå…³é”®å­—å¯åŠ¨ goroutine æ—¶ï¼Œæ‚¨éƒ½å¿…é¡» çŸ¥é“ è¯¥ goroutine å¦‚ä½•ä»¥åŠä½•æ—¶é€€å‡ºã€‚ åœ¨æ‚¨çš„è®¾è®¡ä¸­ï¼ŒæŸäº› goroutine å¯èƒ½ä¼šè¿è¡Œç›´åˆ°ç¨‹åºé€€å‡ºã€‚è¿™äº› goroutine éå¸¸ç½•è§ï¼Œä¸ä¼šæˆä¸ºè§„åˆ™çš„ä¾‹å¤–ã€‚ å¦‚æœæ‚¨ä¸çŸ¥é“ç­”æ¡ˆï¼Œé‚£å°†æ˜¯æ½œåœ¨çš„å†…å­˜æ³„æ¼ï¼Œå› ä¸º goroutine ä¼šå°†å…¶å †æ ˆçš„å†…å­˜ä»¥åŠå¯ä»å †æ ˆè®¿é—®çš„æ‰€æœ‰å †åˆ†é…å˜é‡å›ºå®šåœ¨å †æ ˆä¸Šã€‚ åˆ‡å‹¿åœ¨ä¸çŸ¥é“å¦‚ä½•åœæ­¢ goroutine çš„æƒ…å†µä¸‹å¯åŠ¨å®ƒã€‚ 7.1.2. è¿›ä¸€æ­¥é˜…è¯» Concurrency Made Easy (video) Concurrency Made Easy (slides) Never start a goroutine without knowning when it will stop (Practical Go, QCon Shanghai 2018) ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:9:1","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"7.2. Go å¯¹æŸäº›è¯·æ±‚ä½¿ç”¨æœ‰æ•ˆçš„ç½‘ç»œè½®è¯¢ Go è¿è¡Œæ—¶ä½¿ç”¨æœ‰æ•ˆçš„æ“ä½œç³»ç»Ÿè½®è¯¢æœºåˆ¶ï¼ˆkqueueï¼Œepollï¼Œwindows IOCPç­‰ï¼‰å¤„ç†ç½‘ç»œIOã€‚ä¸€ä¸ªå•ä¸€çš„æ“ä½œç³»ç»Ÿçº¿ç¨‹å°†ä¸ºè®¸å¤šç­‰å¾…çš„ goroutine æä¾›æœåŠ¡ã€‚ ä½†æ˜¯ï¼Œå¯¹äºæœ¬åœ°æ–‡ä»¶ IOï¼ŒGo ä¸ä¼šå®ç°ä»»ä½• IO è½®è¯¢ã€‚ *os.File ä¸Šçš„æ¯ä¸ªæ“ä½œåœ¨è¿›è¡Œä¸­éƒ½ä¼šæ¶ˆè€—ä¸€ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ã€‚ å¤§é‡ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ IO å¯èƒ½ä¼šå¯¼è‡´æ‚¨çš„ç¨‹åºäº§ç”Ÿæ•°ç™¾æˆ–æ•°åƒä¸ªçº¿ç¨‹ã€‚å¯èƒ½è¶…å‡ºæ‚¨çš„æ“ä½œç³»ç»Ÿæ‰€å…è®¸çš„èŒƒå›´ã€‚ æ‚¨çš„ç£ç›˜å­ç³»ç»Ÿä¸å¸Œæœ›èƒ½å¤Ÿå¤„ç†æˆç™¾ä¸Šåƒçš„å¹¶å‘ IO è¯·æ±‚ã€‚ è¦é™åˆ¶å¹¶å‘é˜»å¡ IO çš„æ•°é‡ï¼Œè¯·ä½¿ç”¨å·¥ä½œç¨‹åº goroutine æ± æˆ–ç¼“å†²é€šé“ä½œä¸ºä¿¡å·ç¯ã€‚ var semaphore = make(chan struct{}, 10) func processRequest(work *Work) { semaphore \u003c- struct{}{} // acquire semaphore // process request \u003c-semaphore // release semaphore } ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:9:2","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"7.3. æ³¨æ„æ‚¨çš„åº”ç”¨ç¨‹åºä¸­çš„ IO multipliers å¦‚æœæ‚¨æ­£åœ¨ç¼–å†™æœåŠ¡å™¨è¿›ç¨‹ï¼Œé‚£ä¹ˆå®ƒçš„ä¸»è¦å·¥ä½œæ˜¯å¤šè·¯å¤ç”¨é€šè¿‡ç½‘ç»œè¿æ¥çš„å®¢æˆ·ç«¯å’Œå­˜å‚¨åœ¨åº”ç”¨ç¨‹åºä¸­çš„æ•°æ®ã€‚ å¤§å¤šæ•°æœåŠ¡å™¨ç¨‹åºæ¥å—è¯·æ±‚ï¼Œè¿›è¡Œä¸€äº›å¤„ç†ï¼Œç„¶åè¿”å›ç»“æœã€‚è¿™å¬èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯æ ¹æ®ç»“æœï¼Œå®ƒå¯èƒ½ä¼šä½¿å®¢æˆ·ç«¯æ¶ˆè€—æœåŠ¡å™¨ä¸Šå¤§é‡ï¼ˆå¯èƒ½æ˜¯æ— é™åˆ¶çš„ï¼‰èµ„æºã€‚ è¿™é‡Œæœ‰ä¸€äº›æ³¨æ„äº‹é¡¹: æ¯ä¸ªä¼ å…¥è¯·æ±‚çš„ IO è¯·æ±‚æ•°é‡ï¼›å•ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ç”Ÿæˆå¤šå°‘ä¸ªIOäº‹ä»¶ï¼Ÿå®ƒå¯èƒ½å¹³å‡ä¸º 1ï¼Œæˆ–è€…å¦‚æœä»ç¼“å­˜ä¸­æä¾›äº†è®¸å¤šè¯·æ±‚ï¼Œåˆ™å¯èƒ½å°äºä¸€ä¸ªã€‚ æœåŠ¡æŸ¥è¯¢æ‰€éœ€çš„è¯»å–é‡ï¼›å®ƒæ˜¯å›ºå®šçš„ï¼ŒN + 1è¿˜æ˜¯çº¿æ€§çš„ï¼ˆè¯»å–æ•´ä¸ªè¡¨ä»¥ç”Ÿæˆç»“æœçš„æœ€åä¸€é¡µï¼‰ã€‚ ç›¸å¯¹è€Œè¨€ï¼Œå¦‚æœå†…å­˜å¾ˆæ…¢ï¼Œé‚£ä¹ˆIOå¤ªæ…¢äº†ï¼Œæ‚¨åº”è¯¥ä¸æƒœä¸€åˆ‡ä»£ä»·é¿å…è¿™æ ·åšã€‚æœ€é‡è¦çš„æ˜¯ï¼Œé¿å…åœ¨è¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¸­è¿›è¡ŒIOï¼Œä¸è¦è®©ç”¨æˆ·ç­‰å¾…æ‚¨çš„ç£ç›˜å­ç³»ç»Ÿå†™å…¥ç£ç›˜ç”šè‡³è¯»å–ç£ç›˜ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:9:3","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"7.4. ä½¿ç”¨æµå¼ IO æ¥å£ å°½å¯èƒ½é¿å…å°†æ•°æ®è¯»å–åˆ° []byte ä¸­å¹¶å°†å…¶ä¼ é€’ã€‚ æ ¹æ®è¯·æ±‚ï¼Œæ‚¨å¯èƒ½æœ€ç»ˆå°†å…†å­—èŠ‚ï¼ˆæˆ–æ›´å¤šï¼ï¼‰çš„æ•°æ®è¯»å–åˆ°å†…å­˜ä¸­ã€‚è¿™ç»™ GC å¸¦æ¥äº†å·¨å¤§å‹åŠ›ï¼Œè¿™å°†å¢åŠ åº”ç”¨ç¨‹åºçš„å¹³å‡å»¶è¿Ÿã€‚ è€Œæ˜¯ä½¿ç”¨ io.Reader å’Œ io.Writer æ¥æ„é€ å¤„ç†ç®¡é“ï¼Œä»¥é™åˆ¶æ¯ä¸ªè¯·æ±‚ä½¿ç”¨çš„å†…å­˜é‡ã€‚ ä¸ºäº†æé«˜æ•ˆç‡ï¼Œå¦‚æœæ‚¨ä½¿ç”¨å¤§é‡çš„ io.Copyï¼Œè¯·è€ƒè™‘å®ç° io.ReaderFrom/io.WriterToã€‚ è¿™äº›æ¥å£æ•ˆç‡æ›´é«˜ï¼Œå¹¶ä¸”é¿å…å°†å†…å­˜å¤åˆ¶åˆ°ä¸´æ—¶ç¼“å†²åŒºä¸­ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:9:4","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"7.5. è¶…æ—¶, è¶…æ—¶, è¶…æ—¶ åœ¨ä¸çŸ¥é“æ‰€éœ€çš„æœ€é•¿æ—¶é—´ä¹‹å‰ï¼Œåˆ‡å‹¿å¯åŠ¨ IO æ“ä½œã€‚ æ‚¨éœ€è¦ä½¿ç”¨ SetDeadline, SetReadDeadline, SetWriteDeadline å¯¹æ¯ä¸ªç½‘ç»œè¯·æ±‚è®¾ç½®è¶…æ—¶ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:9:5","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"7.6. defer æ¶ˆè€—å¾ˆå¤§ï¼Œè¿˜æ˜¯ï¼Ÿ defer æ¶ˆè€—å¾ˆé«˜ï¼Œå› ä¸ºå®ƒå¿…é¡»è®°å½•ä¸‹ defer çš„è®ºç‚¹ã€‚ defer mu.Unlock() ç›¸å½“äº defer func() { mu.Unlock() }() å¦‚æœå®Œæˆçš„å·¥ä½œé‡å¾ˆå°ï¼Œåˆ™ defer ä¼šå¾ˆæ˜‚è´µï¼Œç»å…¸çš„ä¾‹å­æ˜¯ defer å›´ç»•ç»“æ„å˜é‡æˆ–æ˜ å°„æŸ¥æ‰¾è¿›è¡Œäº’æ–¥è§£é”ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥é€‰æ‹©é¿å… deferã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºäº†è·å¾—æ€§èƒ½è€Œç‰ºç‰²äº†å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚ å§‹ç»ˆé‡æ–°å®¡è§†è¿™äº›å†³å®šã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:9:6","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"7.7. é¿å… Finalisers Finalisation æ˜¯ä¸€ç§å°†è¡Œä¸ºé™„åŠ åˆ°å³å°†è¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡çš„æŠ€æœ¯ã€‚ å› æ­¤ï¼Œæœ€ç»ˆç¡®å®šæ˜¯ä¸ç¡®å®šçš„ã€‚ è¦è¿è¡Œ finalizerï¼Œè¯¥å¯¹è±¡ä¸å¾—é€šè¿‡ä»»ä½•ç‰©ä½“åˆ°è¾¾ã€‚ å¦‚æœæ‚¨ä¸å°å¿ƒåœ¨åœ°å›¾ä¸Šä¿ç•™äº†å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼Œåˆ™è¯¥å¯¹è±¡ä¸ä¼šè¢«æœ€ç»ˆç¡®å®šã€‚ finalizer æ˜¯ gc å‘¨æœŸçš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä½•æ—¶è¿è¡Œå°†æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œå¹¶ä¸”ä¸å‡å°‘ gc æ“ä½œçš„ç›®æ ‡ç›¸çŸ›ç›¾ã€‚ å¦‚æœå †å¾ˆå¤§å¹¶ä¸”å·²è°ƒæ•´åº”ç”¨ç¨‹åºä»¥åˆ›å»ºæœ€å°‘çš„åƒåœ¾ï¼Œåˆ™ finalizer å¯èƒ½ä¸ä¼šè¿è¡Œå¾ˆé•¿æ—¶é—´ã€‚ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:9:7","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"7.8. å‡å°‘ cgo cgo å…è®¸ Go ç¨‹åºè°ƒç”¨ C åº“ã€‚ C ä»£ç å’Œ Go ä»£ç ç”Ÿæ´»åœ¨ä¸¤ä¸ªä¸åŒçš„ä¸–ç•Œä¸­ï¼Œcgo ç©¿è¶Šäº†å®ƒä»¬ä¹‹é—´çš„è¾¹ç•Œã€‚ è¿™ç§è½¬æ¢ä¸æ˜¯å…è´¹çš„ï¼Œå¹¶ä¸”å–å†³äºå®ƒåœ¨ä»£ç ä¸­çš„ä½ç½®ï¼Œå…¶æˆæœ¬å¯èƒ½å¾ˆé«˜ã€‚ cgo è°ƒç”¨ç±»ä¼¼äºé˜»å¡ IOï¼Œå®ƒä»¬åœ¨æ“ä½œæœŸé—´æ¶ˆè€—çº¿ç¨‹ã€‚ ä¸è¦åœ¨ç´§å¯†å¾ªç¯ä¸­è°ƒç”¨ C ä»£ç ã€‚ 7.8.1. å…¶å®ï¼Œä¹Ÿè®¸é¿å… cgo cgo çš„å¼€é”€å¾ˆé«˜ã€‚ ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½ï¼Œæˆ‘å»ºè®®æ‚¨åœ¨åº”ç”¨ç¨‹åºä¸­é¿å…ä½¿ç”¨ cgoã€‚ å¦‚æœCä»£ç èŠ±è´¹å¾ˆé•¿æ—¶é—´ï¼Œåˆ™ cgo å¼€é”€å¹¶ä¸é‡è¦ã€‚ å¦‚æœæ‚¨ä½¿ç”¨ cgo è°ƒç”¨éå¸¸çŸ­çš„ C å‡½æ•°ï¼ˆå…¶å¼€é”€æœ€æ˜æ˜¾ï¼‰ï¼Œè¯·åœ¨ Go ä¸­é‡å†™è¯¥ä»£ç  - æ ¹æ®å®šä¹‰ï¼Œè¿™å¾ˆçŸ­ã€‚ å¦‚æœæ‚¨åœ¨ç´§å¯†çš„å¾ªç¯ä¸­ä½¿ç”¨äº†å¤§é‡æ˜‚è´µçš„ C ä»£ç ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Goï¼Ÿ æ˜¯å¦æœ‰äººä½¿ç”¨ cgo é¢‘ç¹è°ƒç”¨æ˜‚è´µçš„ C ä»£ç ï¼Ÿ è¿›ä¸€æ­¥é˜…è¯» cgo is not Go ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:9:8","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"7.9. å§‹ç»ˆä½¿ç”¨æœ€æ–°å‘å¸ƒçš„Goç‰ˆæœ¬ æ—§ç‰ˆæœ¬çš„ Go æ°¸è¿œä¸ä¼šå˜å¾—æ›´å¥½ã€‚ä»–ä»¬å°†æ°¸è¿œä¸ä¼šå¾—åˆ°é”™è¯¯ä¿®å¤æˆ–ä¼˜åŒ–ã€‚ Go 1.4 ä¸åº”è¯¥ä½¿ç”¨ã€‚ Go 1.5 å’Œ 1.6 ç¼–è¯‘å™¨é€Ÿåº¦è¾ƒæ…¢ï¼Œä½†ç”Ÿæˆçš„ä»£ç æ›´å¿«ï¼ŒGCæ›´å¿«ã€‚ Go 1.7 ä¸ 1.6 ç›¸æ¯”ï¼Œç¼–è¯‘é€Ÿåº¦æé«˜äº†çº¦ 30ï¼…ï¼Œé“¾æ¥é€Ÿåº¦æé«˜äº† 2 å€ï¼ˆæ¯”ä»»ä½•ä»¥å‰çš„Goç‰ˆæœ¬éƒ½è¦å¥½ï¼‰ã€‚ Go 1.8 ï¼ˆæ­¤æ—¶ï¼‰å°†æä¾›è¾ƒå°çš„ç¼–è¯‘é€Ÿåº¦æ”¹è¿›ï¼Œä½†éè‹±ç‰¹å°”æ¶æ„çš„ä»£ç è´¨é‡å°†å¾—åˆ°æ˜¾ç€æ”¹è¿›ã€‚ Go 1.9-1.12 ç»§ç»­æé«˜æ‰€ç”Ÿæˆä»£ç çš„æ€§èƒ½ï¼Œä¿®å¤é”™è¯¯ï¼Œå¹¶æ”¹å–„å†…è”å’Œæ”¹è¿›è°ƒè¯•ã€‚ æ—§ç‰ˆæœ¬çš„Goæ²¡æœ‰æ›´æ–°ã€‚è¯·å‹¿ä½¿ç”¨ã€‚ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ï¼Œæ‚¨å°†è·å¾—æœ€ä½³æ€§èƒ½ã€‚ 7.9.1. è¿›ä¸€æ­¥é˜…è¯» Go 1.7 toolchain improvements Go 1.8 performance improvements 7.9.2. å°†çƒ­ç‚¹å­—æ®µç§»åŠ¨åˆ° struct é¡¶éƒ¨ ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:9:9","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"7.10. è®¨è®º Any questions? ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:9:10","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"8. æœ€åçš„é—®é¢˜å’Œç»“è®º å¯è¯»æ„å‘³ç€å¯é â€‰â€”â€‰Rob Pike ä»æœ€ç®€å•çš„ä»£ç å¼€å§‹ã€‚ æµ‹é‡ã€‚ åˆ†ææ‚¨çš„ä»£ç ä»¥è¯†åˆ«ç“¶é¢ˆï¼Œè¯·ä¸è¦çŒœæµ‹ã€‚ å¦‚æœæ€§èƒ½è‰¯å¥½ï¼Œè¯· åœæ­¢ã€‚æ‚¨æ— éœ€ä¼˜åŒ–æ‰€æœ‰å†…å®¹ï¼Œåªéœ€ä¼˜åŒ–ä»£ç ä¸­æœ€çƒ­çš„éƒ¨åˆ†ã€‚ éšç€åº”ç”¨ç¨‹åºçš„å¢é•¿æˆ–æµé‡æ¨¡å¼çš„å‘å±•ï¼Œæ€§èƒ½çƒ­ç‚¹å°†å‘ç”Ÿå˜åŒ–ã€‚ ä¸è¦ç•™ä¸‹å¯¹æ€§èƒ½ä¸é‡è¦çš„å¤æ‚ä»£ç ï¼Œå¦‚æœç“¶é¢ˆè½¬ç§»åˆ°å…¶ä»–åœ°æ–¹ï¼Œè¯·ä½¿ç”¨æ›´ç®€å•çš„æ“ä½œå°†å…¶é‡å†™ã€‚ å§‹ç»ˆç¼–å†™æœ€ç®€å•çš„ä»£ç ï¼Œç¼–è¯‘å™¨é’ˆå¯¹ æ­£è§„ ä»£ç è¿›è¡Œäº†ä¼˜åŒ–ã€‚ è¾ƒçŸ­çš„ä»£ç æ˜¯è¾ƒå¿«çš„ä»£ç ï¼› Go ä¸æ˜¯ C++ï¼Œä¸è¦æŒ‡æœ›ç¼–è¯‘å™¨èƒ½å¤Ÿè§£å¼€å¤æ‚çš„æŠ½è±¡ã€‚ ä»£ç è¶ŠçŸ­ï¼Œä»£ç  è¶Šå°ï¼›è¿™å¯¹äºCPUçš„ç¼“å­˜å¾ˆé‡è¦ã€‚ éå¸¸æ³¨æ„åˆ†é…ï¼Œå°½å¯èƒ½é¿å…ä¸å¿…è¦çš„åˆ†é…ã€‚ å¦‚æœäº‹æƒ…ä¸ä¸€å®šæ­£ç¡®ï¼Œæˆ‘å¯ä»¥å°†äº‹æƒ…åšå¾—å¾ˆå¿«ã€‚â€”â€‰Russ Cox æ€§èƒ½å’Œå¯é æ€§åŒæ ·é‡è¦ã€‚ æˆ‘è®¤ä¸ºåˆ¶ä½œä¸€ä¸ªéå¸¸å¿«é€Ÿçš„æœåŠ¡å™¨ä½†æ˜¯å´å®šæœŸ panicsï¼Œæ­»é”æˆ– OOM æ¯«æ— ä»·å€¼ã€‚ ä¸è¦ä¸ºäº†å¯é æ€§è€Œç‰ºç‰²æ€§èƒ½ã€‚ 1. Hennessy et al: 40 å¹´çš„å¹´åº¦ç»©æ•ˆæé«˜äº† 1.4 å€ã€‚ ref https://github.com/davecheney/gophercon2018-performance-tuning-workshop https://dave.cheney.net/high-performance-go-workshop/dotgo-paris.html#avoid_finalisers https://github.com/davecheney/high-performance-go-workshop ","date":"2020-09-27","objectID":"/high-performance-go-workshop/:10:0","tags":["go","profile","ç¿»è¯‘"],"title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","uri":"/high-performance-go-workshop/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šä¸€ç§åŸºäºæµè§ˆå™¨æ¸²æŸ“çš„ç”ŸæˆæŠ¥å‘ŠæŠ€æœ¯æ–¹æ¡ˆ éœ€æ±‚æ˜¯æ— å¤–ç½‘ç¯å¢ƒä¸‹ï¼Œæ±‡æ€»å½“å‰ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ï¼Œéœ€è¦ç»˜åˆ¶å¤§é‡å›¾è¡¨åˆ° word/pdfã€‚ å®ç°è¯­è¨€: golang ","date":"2020-09-21","objectID":"/a-technical-solution-for-generating-reports-based-on-browser-rendering/:0:0","tags":null,"title":"ä¸€ç§åŸºäºæµè§ˆå™¨æ¸²æŸ“çš„ç”ŸæˆæŠ¥å‘ŠæŠ€æœ¯æ–¹æ¡ˆ","uri":"/a-technical-solution-for-generating-reports-based-on-browser-rendering/"},{"categories":null,"content":"å¦‚ä½•æ›´åŠ æ–¹ä¾¿çš„ç®¡ç†æŠ¥å‘Šæ¨¡ç‰ˆ ä¸»è¦æ€è·¯ï¼š æŠ¥å‘Šæ¨¡ç‰ˆä½¿ç”¨ markdown+golang/text/template æ¸²æŸ“ï¼Œå›¾è¡¨ä½¿ç”¨ datauri ç›´æ¥å†…åµŒå…¥ markdownã€‚markdown ç»è¿‡ ast è§£æåç¿»è¯‘æˆå¯¹åº”çš„å…ƒç´ ï¼Œæ¸²æŸ“æˆ report.Report ä¸­é—´æ¥å£ã€‚report.Report æ¥å£ä½œä¸ºä¸­é—´å±‚ï¼Œä¸‹è¾¹å®ç° pdf/word æ¸²æŸ“å®ç°ã€‚ æœ€ç»ˆè¾¾æˆçš„ç›®æ ‡ï¼šæ ·å¼ç”± report.Report çš„å®ç°å†³å®šï¼Œä¸Šå±‚ markdown å…³æ³¨å†…å®¹ã€‚ github.com/yuin/goldmark ","date":"2020-09-21","objectID":"/a-technical-solution-for-generating-reports-based-on-browser-rendering/:1:0","tags":null,"title":"ä¸€ç§åŸºäºæµè§ˆå™¨æ¸²æŸ“çš„ç”ŸæˆæŠ¥å‘ŠæŠ€æœ¯æ–¹æ¡ˆ","uri":"/a-technical-solution-for-generating-reports-based-on-browser-rendering/"},{"categories":null,"content":"æŠ¥è¡¨ä¸­å¤§é‡å›¾è¡¨å¦‚ä½•æ¸²æŸ“ ä½¿ç”¨å‰ç«¯æŠ€æœ¯ç»˜åˆ¶å›¾è¡¨ï¼Œå¯åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è·å¾—ç»“æœ æ¸²æŸ“æœåŠ¡ï¼šæ§åˆ¶æµè§ˆå™¨æ‰“å¼€ç½‘é¡µï¼Œå¹¶æŒ‡å®šæˆªå›¾æŸåŒºåŸŸ. æœ‰ä¸€ä¸ªå…³é”®è®¾è®¡: chromedp æ§åˆ¶æµè§ˆå™¨ï¼Œä¼šæ²¡æœ‰åŸºç¡€çš„ postè¯·æ±‚æ–¹å¼ï¼Œéœ€è¦é€šè¿‡æ§åˆ¶æµè§ˆå™¨æ‰§è¡Œ js, å¯¹ç½‘é¡µè¿›è¡Œæ§åˆ¶ï¼ˆåˆ›å»º dom ï¼Œå¹¶ç”»å‡ºå›¾ï¼‰ æ¸²æŸ“æœåŠ¡æ— çŠ¶æ€ï¼Œéœ€è¦ç®¡ç† chrome headlessã€‚å¯¹å¤–æä¾› openapi golang https://github.com/browserless/chrome/issues/52 github.com/chromedp/chromedp ","date":"2020-09-21","objectID":"/a-technical-solution-for-generating-reports-based-on-browser-rendering/:2:0","tags":null,"title":"ä¸€ç§åŸºäºæµè§ˆå™¨æ¸²æŸ“çš„ç”ŸæˆæŠ¥å‘ŠæŠ€æœ¯æ–¹æ¡ˆ","uri":"/a-technical-solution-for-generating-reports-based-on-browser-rendering/"},{"categories":null,"content":"å¦‚ä½•ä¿å­˜æœ€ç»ˆç”Ÿæˆçš„æŠ¥å‘Š markdown ç›´æ¥å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œä¼˜ç‚¹ä¸éœ€è¦åšå¤§é‡å°æ–‡ä»¶ä¼˜åŒ– ","date":"2020-09-21","objectID":"/a-technical-solution-for-generating-reports-based-on-browser-rendering/:3:0","tags":null,"title":"ä¸€ç§åŸºäºæµè§ˆå™¨æ¸²æŸ“çš„ç”ŸæˆæŠ¥å‘ŠæŠ€æœ¯æ–¹æ¡ˆ","uri":"/a-technical-solution-for-generating-reports-based-on-browser-rendering/"},{"categories":null,"content":"runtime: fatal error: SIGSEGV during C.getaddrinfo è§£å†³æ–¹æ³• ","date":"2020-06-27","objectID":"/go-runtime-fatal-sigsegv-during-c.getaddrinfo/:0:0","tags":null,"title":"golang runtime: fatal error: SIGSEGV during C.getaddrinfo","uri":"/go-runtime-fatal-sigsegv-during-c.getaddrinfo/"},{"categories":null,"content":"ç°è±¡ golang runtime: fatal error: SIGSEGV during C.getaddrinfo fatal error: unexpected signal during runtime execution [signal SIGSEGV: segmentation violation code=0x1 addr=0x63 pc=0x7fd8b41641b9] runtime stack: ... created by net.cgoLookupIP ... /etc/resolv.conf åŒ…å«å‚æ•° options edns0 ","date":"2020-06-27","objectID":"/go-runtime-fatal-sigsegv-during-c.getaddrinfo/:1:0","tags":null,"title":"golang runtime: fatal error: SIGSEGV during C.getaddrinfo","uri":"/go-runtime-fatal-sigsegv-during-c.getaddrinfo/"},{"categories":null,"content":"åŸå›  https://github.com/golang/go/issues/30310 glibc çš„ bug å¯¼è‡´ go ä¸­ net æ¨¡å—é™æ€ç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶ getaddrinfo çš„æ—¶å€™ pinicï¼Œæ— æ³•å¯åŠ¨æœåŠ¡ ","date":"2020-06-27","objectID":"/go-runtime-fatal-sigsegv-during-c.getaddrinfo/:2:0","tags":null,"title":"golang runtime: fatal error: SIGSEGV during C.getaddrinfo","uri":"/go-runtime-fatal-sigsegv-during-c.getaddrinfo/"},{"categories":null,"content":"è§£å†³åŠæ³• æ–¹æ³•1. build ä»£ç çš„æ—¶å€™ï¼Œä½¿ç”¨ go è‡ªå·±çš„ net å®ç° -tags netgo: go build -tags netgo main.go æ–¹æ³•2. å·²ç» build çš„ç¨‹åºä½¿ç”¨ç¯å¢ƒå˜é‡ GODEBUG=netdns=go è¿è¡Œç¨‹åºï¼Œä¸´æ—¶ä½¿ç”¨ goå®ç°çš„ net: GODEBUG=netdns=go main ","date":"2020-06-27","objectID":"/go-runtime-fatal-sigsegv-during-c.getaddrinfo/:3:0","tags":null,"title":"golang runtime: fatal error: SIGSEGV during C.getaddrinfo","uri":"/go-runtime-fatal-sigsegv-during-c.getaddrinfo/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šgolang å„ç§å…ƒç´ æ•´ç† ","date":"2020-05-06","objectID":"/go-compiler-overview/:0:0","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"ç¼–è¯‘åŸç† æ¯”è¾ƒå¥½çš„ä»‹ç» golang çš„ç¼–è¯‘å™¨çœ‹ è¿™é‡Œ ä»£ç ä¸­å¯¹ go compiler çš„æè¿°: src/cmd/compile/README.md what is ssa: wiki IR golang Static Single Assignment: src/cmd/compile/internal/ssa/README.md ","date":"2020-05-06","objectID":"/go-compiler-overview/:1:0","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"ç¼–è¯‘å™¨å…¥å£ src/cmd/compile/internal/gc/main.go ","date":"2020-05-06","objectID":"/go-compiler-overview/:1:1","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"æŠ€å·§ ç”Ÿæˆ SSA æ•´ä¸ªè¿‡ç¨‹ç»“æœå±•ç¤º(html): GOSSAFUNC=hello go build hello/hello.go ç”Ÿæˆ plan9 æ±‡ç¼–ä»£ç  GOOS=linux GOARCH=amd64 go tool compile -S hello/hello.go TODO: ç»™ä¸€ä¸ªä¾‹å­ï¼Œå¹¶è§£é‡Šä¸€ä¸‹(éœ€è¦äº†è§£æ‰€æœ‰æ­¥éª¤) ","date":"2020-05-06","objectID":"/go-compiler-overview/:1:2","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"plan9 ","date":"2020-05-06","objectID":"/go-compiler-overview/:2:0","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"åŸºæœ¬æ•°æ®ç»“æ„ ","date":"2020-05-06","objectID":"/go-compiler-overview/:3:0","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"æ•°ç»„ https://github.com/golang/go/blob/f07059d949057f414dd0f8303f93ca727d716c62/src/cmd/compile/internal/gc/sinit.go#L875-L967 å½“å…ƒç´ æ•°é‡å°äºæˆ–è€…ç­‰äº 4 ä¸ªæ—¶ï¼Œä¼šç›´æ¥å°†æ•°ç»„ä¸­çš„å…ƒç´ æ”¾ç½®åœ¨æ ˆä¸Šï¼› å½“å…ƒç´ æ•°é‡å¤§äº 4 ä¸ªæ—¶ï¼Œä¼šå°†æ•°ç»„ä¸­çš„å…ƒç´ æ”¾ç½®åˆ°é™æ€åŒºå¹¶åœ¨è¿è¡Œæ—¶å–å‡ºï¼› æ— è®ºæ˜¯åœ¨æ ˆä¸Šè¿˜æ˜¯é™æ€å­˜å‚¨åŒºï¼Œæ•°ç»„åœ¨å†…å­˜ä¸­å…¶å®å°±æ˜¯ä¸€è¿ä¸²çš„å†…å­˜ç©ºé—´ï¼Œè¡¨ç¤ºæ•°ç»„çš„æ–¹æ³•å°±æ˜¯ä¸€ä¸ªæŒ‡å‘æ•°ç»„å¼€å¤´çš„æŒ‡é’ˆã€æ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡ä»¥åŠæ•°ç»„ä¸­å…ƒç´ ç±»å‹å çš„ç©ºé—´å¤§å° Go è¯­è¨€ä¸­å¯¹æ•°ç»„è¶Šç•Œçš„åˆ¤æ–­æ˜¯å¯ä»¥åœ¨ç¼–è¯‘æœŸé—´ç”±é™æ€ç±»å‹æ£€æŸ¥å®Œæˆçš„ https://github.com/golang/go/blob/b7d097a4cf6b8a9125e4770b54d33826fa803023/src/cmd/compile/internal/gc/typecheck.go#L327-L2081 ","date":"2020-05-06","objectID":"/go-compiler-overview/:3:1","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"åˆ‡ç‰‡ å›¾è§£ slice NewSlice // [slice](https://github.com/golang/go/blob/4c003f6b780b471afbf032438eb6c7519458855b/src/reflect/value.go#L1973) type SliceHeader struct { Data uintptr Len int Cap int } slice := []int{1, 2, 3} slice := make([]int, 10) [:], a slice referencing the storage of x [:] æ“ä½œæ˜¯åˆ›å»ºåˆ‡ç‰‡æœ€åº•å±‚çš„ä¸€ç§æ–¹æ³• make make å…³é”®è¯ å½“åˆ‡ç‰‡å‘ç”Ÿé€ƒé€¸æˆ–è€…éå¸¸å¤§æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ runtime.makeslice å‡½æ•°åœ¨å †ä¸Šåˆå§‹åŒ–ï¼Œ å¦‚æœå½“å‰çš„åˆ‡ç‰‡ä¸ä¼šå‘ç”Ÿé€ƒé€¸å¹¶ä¸”åˆ‡ç‰‡éå¸¸å°çš„æ—¶å€™ï¼Œmake([]int, 3, 4) ä¼šè¢«ç›´æ¥è½¬æ¢æˆå¦‚ä¸‹æ‰€ç¤ºçš„ä»£ç ï¼š var arr [4]int n := arr[:3] golang å¯¹ slice æ¯”è¾ƒæœ‰æ„ä¹‰çš„ä¼˜åŒ– append runtime.growslice å¦‚æœæœŸæœ›å®¹é‡å¤§äºå½“å‰å®¹é‡çš„ä¸¤å€å°±ä¼šä½¿ç”¨æœŸæœ›å®¹é‡ï¼› å¦‚æœå½“å‰åˆ‡ç‰‡å®¹é‡å°äº 1024 å°±ä¼šå°†å®¹é‡ç¿»å€ï¼› å¦‚æœå½“å‰åˆ‡ç‰‡å®¹é‡å¤§äº 1024 å°±ä¼šæ¯æ¬¡å¢åŠ  25% çš„å®¹é‡ï¼Œç›´åˆ°æ–°å®¹é‡å¤§äºæœŸæœ›å®¹é‡ï¼› ","date":"2020-05-06","objectID":"/go-compiler-overview/:3:2","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"å“ˆå¸Œè¡¨ å“ˆå¸Œå‡½æ•° å†²çªè§£å†³æ–¹æ³• å¼€æ”¾å¯»å€æ³•å’Œæ‹‰é“¾æ³• [hmap](https://github.com/golang/go/blob/ed15e82413c7b16e21a493f5a647f68b46e965ee/src/runtime/map.go#L115-L129) type hmap struct { count int flags uint8 B uint8 noverflow uint16 hash0 uint32 buckets unsafe.Pointer oldbuckets unsafe.Pointer nevacuate uintptr extra *mapextra } åˆ›å»º map runtime.makemap golang é€šè¿‡æ‹‰é“¾æ³•å¤„ç†å†²çª è¯»å†™ å¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹ mapaccess1 æ‰©å®¹ï¼ˆä¸æ˜¯åŸå­æ“ä½œï¼‰ runtime.mapdelete Go è¯­è¨€ä½¿ç”¨æ‹‰é“¾æ³•æ¥è§£å†³å“ˆå¸Œç¢°æ’çš„é—®é¢˜å®ç°äº†å“ˆå¸Œè¡¨ï¼Œå®ƒçš„è®¿é—®ã€å†™å…¥å’Œåˆ é™¤ç­‰æ“ä½œéƒ½åœ¨ç¼–è¯‘æœŸé—´è½¬æ¢æˆäº†è¿è¡Œæ—¶çš„å‡½æ•°æˆ–è€…æ–¹æ³•ã€‚ å“ˆå¸Œåœ¨æ¯ä¸€ä¸ªæ¡¶ä¸­å­˜å‚¨é”®å¯¹åº”å“ˆå¸Œçš„å‰ 8 ä½ï¼Œå½“å¯¹å“ˆå¸Œè¿›è¡Œæ“ä½œæ—¶ï¼Œè¿™äº› tophash å°±æˆä¸ºäº†ä¸€çº§ç¼“å­˜å¸®åŠ©å“ˆå¸Œå¿«é€Ÿéå†æ¡¶ä¸­å…ƒç´ ï¼Œæ¯ä¸€ä¸ªæ¡¶éƒ½åªèƒ½å­˜å‚¨ 8 ä¸ªé”®å€¼å¯¹ï¼Œä¸€æ—¦å½“å‰å“ˆå¸Œçš„æŸä¸ªæ¡¶è¶…å‡º 8 ä¸ªï¼Œæ–°çš„é”®å€¼å¯¹å°±ä¼šè¢«å­˜å‚¨åˆ°å“ˆå¸Œçš„æº¢å‡ºæ¡¶ä¸­ã€‚ éšç€é”®å€¼å¯¹æ•°é‡çš„å¢åŠ ï¼Œæº¢å‡ºæ¡¶çš„æ•°é‡å’Œå“ˆå¸Œçš„è£…è½½å› å­ä¹Ÿä¼šé€æ¸å‡é«˜ï¼Œè¶…è¿‡ä¸€å®šèŒƒå›´å°±ä¼šè§¦å‘æ‰©å®¹ï¼Œæ‰©å®¹ä¼šå°†æ¡¶çš„æ•°é‡ç¿»å€ï¼Œå…ƒç´ å†åˆ†é…çš„è¿‡ç¨‹ä¹Ÿæ˜¯åœ¨è°ƒç”¨å†™æ“ä½œæ—¶å¢é‡è¿›è¡Œçš„ï¼Œä¸ä¼šé€ æˆæ€§èƒ½çš„ç¬æ—¶å·¨å¤§æŠ–åŠ¨ã€‚ ","date":"2020-05-06","objectID":"/go-compiler-overview/:3:3","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"å­—ç¬¦ä¸² ååˆ†é’Ÿææ¸…å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç  type StringHeader struct { Data uintptr Len int } type stringStruct struct { str unsafe.Pointer len int } slicebytetostring ","date":"2020-05-06","objectID":"/go-compiler-overview/:3:4","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"OO ","date":"2020-05-06","objectID":"/go-compiler-overview/:4:0","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"å‡½æ•°è°ƒç”¨ C è¯­è¨€å’Œ Go è¯­è¨€åœ¨è®¾è®¡å‡½æ•°çš„è°ƒç”¨æƒ¯ä¾‹æ—¶é€‰æ‹©ä¹Ÿä¸åŒçš„å®ç°ã€‚C è¯­è¨€åŒæ—¶ä½¿ç”¨å¯„å­˜å™¨å’Œæ ˆä¼ é€’å‚æ•°ï¼Œä½¿ç”¨ eax å¯„å­˜å™¨ä¼ é€’è¿”å›å€¼ï¼›è€Œ Go è¯­è¨€ä½¿ç”¨æ ˆä¼ é€’å‚æ•°å’Œè¿”å›å€¼ã€‚æˆ‘ä»¬å¯ä»¥å¯¹æ¯”ä¸€ä¸‹è¿™ä¸¤ç§è®¾è®¡çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼š C è¯­è¨€çš„æ–¹å¼èƒ½å¤Ÿå‡å°‘å¤§é‡å°å‡½æ•°è°ƒç”¨çš„å¼€é”€ï¼Œä½†æ˜¯ä¹Ÿå¢åŠ äº†å®ç°çš„å¤æ‚åº¦ï¼› CPU è®¿é—®æ ˆ(å†…å­˜)çš„å¼€é”€æ¯”è®¿é—®å¯„å­˜å™¨é«˜å‡ åå€ï¼› éœ€è¦å•ç‹¬å¤„ç†å‡½æ•°å‚æ•°è¿‡å¤šçš„æƒ…å†µï¼› Go è¯­è¨€çš„æ–¹å¼èƒ½å¤Ÿé™ä½å®ç°çš„å¤æ‚åº¦å¹¶æ”¯æŒå¤šè¿”å›å€¼ï¼Œä½†æ˜¯ç‰ºç‰²äº†å‡½æ•°è°ƒç”¨çš„æ€§èƒ½ï¼› ä¸éœ€è¦è€ƒè™‘è¶…è¿‡å¯„å­˜å™¨æ•°é‡çš„å‚æ•°åº”è¯¥å¦‚ä½•ä¼ é€’ï¼› ä¸éœ€è¦è€ƒè™‘ä¸åŒæ¶æ„ä¸Šçš„å¯„å­˜å™¨å·®å¼‚ï¼› å‡½æ•°å…¥å‚å’Œå‡ºå‚çš„å†…å­˜ç©ºé—´éœ€è¦åœ¨æ ˆä¸Šè¿›è¡Œåˆ†é…ï¼› Go è¯­è¨€ä½¿ç”¨æ ˆä½œä¸ºå‚æ•°å’Œè¿”å›å€¼ä¼ é€’çš„æ–¹æ³•æ˜¯ç»¼åˆè€ƒè™‘åçš„è®¾è®¡ï¼Œé€‰æ‹©è¿™ç§è®¾è®¡æ„å‘³ç€ç¼–è¯‘å™¨ä¼šæ›´åŠ ç®€å•ã€æ›´å®¹æ˜“ç»´æŠ¤ã€‚ å‚æ•°ä¼ é€’ golang æ— è®ºæ˜¯ä¼ é€’åŸºæœ¬ç±»å‹ã€ç»“æ„ä½“è¿˜æ˜¯æŒ‡é’ˆï¼Œéƒ½ä¼šå¯¹ä¼ é€’çš„å‚æ•°è¿›è¡Œæ‹·è´ ","date":"2020-05-06","objectID":"/go-compiler-overview/:4:1","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"æ¥å£ ç±»å‹è½¬æ¢ã€ç±»å‹æ–­è¨€ä»¥åŠåŠ¨æ€æ´¾å‘æœºåˆ¶ iface ç»“æ„ä½“ æ˜¯å¸¦æœ‰ä¸€ç»„æ–¹æ³•çš„æ¥å£ eface ç»“æ„ä½“ ä¸å¸¦ä»»ä½•æ–¹æ³•çš„ interface{} type eface struct { // 16 bytes _type *_type data unsafe.Pointer } type iface struct { // 16 bytes tab *itab data unsafe.Pointer } åŠ¨æ€æ´¾å‘çš„è¿‡ç¨‹åªæ˜¯æ”¾å¤§äº†å‚æ•°æ‹·è´å¸¦æ¥çš„å½±å“,\u0008\u0008 ç”¨ç»“æ„ä½“å®ç°æ¥å£ä¼šæœ‰æ›´å¤šæ¶ˆè€—(125%) ","date":"2020-05-06","objectID":"/go-compiler-overview/:4:2","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"åå°„ ","date":"2020-05-06","objectID":"/go-compiler-overview/:4:3","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"å¸¸ç”¨å…³é”®å­— ","date":"2020-05-06","objectID":"/go-compiler-overview/:5:0","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"for å’Œ range ä¸€äº› golang buildin func æ˜¯ç”±åŸå§‹çš„æ±‡ç¼–å†™æˆï¼Œæ¯”å¦‚runtimeÂ·memclrNoHeapPointers ","date":"2020-05-06","objectID":"/go-compiler-overview/:5:1","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"select å½“ select ä¸­çš„ä¸¤ä¸ª case åŒæ—¶è¢«è§¦å‘æ—¶ï¼Œå°±ä¼šéšæœºé€‰æ‹©ä¸€ä¸ª case æ‰§è¡Œã€‚ select èƒ½åœ¨ Channel ä¸Šè¿›è¡Œéé˜»å¡çš„æ”¶å‘æ“ä½œï¼› select åœ¨é‡åˆ°å¤šä¸ª Channel åŒæ—¶å“åº”æ—¶ä¼šéšæœºæŒ‘é€‰ case æ‰§è¡Œï¼›(å¦‚æœæˆ‘ä»¬æŒ‰ç…§é¡ºåºä¾æ¬¡åˆ¤æ–­ï¼Œé‚£ä¹ˆåé¢çš„æ¡ä»¶æ°¸è¿œéƒ½ä¼šå¾—ä¸åˆ°æ‰§è¡Œï¼Œè€Œéšæœºçš„å¼•å…¥å°±æ˜¯ä¸ºäº†é¿å…é¥¥é¥¿é—®é¢˜çš„å‘ç”Ÿ) éé˜»å¡çš„æ”¶å‘: select { case err := \u003c-errCh: return err default: return nil } scase type scase struct { c *hchan // chan elem unsafe.Pointer // data element kind uint16 pc uintptr // race pc (for race detector / msan) releasetime int64 } ","date":"2020-05-06","objectID":"/go-compiler-overview/:5:2","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"defer ","date":"2020-05-06","objectID":"/go-compiler-overview/:5:3","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"panic å’Œ recover Defer, Panic, and Recover panic åªä¼šè§¦å‘å½“å‰ Goroutine çš„å»¶è¿Ÿå‡½æ•°è°ƒç”¨ï¼› recover åªæœ‰åœ¨ defer å‡½æ•°ä¸­è°ƒç”¨æ‰ä¼šç”Ÿæ•ˆï¼› panic å…è®¸åœ¨ defer ä¸­åµŒå¥—å¤šæ¬¡è°ƒç”¨ï¼› è·¨åç¨‹å¤±æ•ˆ é¦–å…ˆè¦å±•ç¤ºçš„ä¾‹å­å°±æ˜¯ panic åªä¼šè§¦å‘å½“å‰ Goroutine çš„å»¶è¿Ÿå‡½æ•°è°ƒç”¨ å¤šä¸ª Goroutine ä¹‹é—´æ²¡æœ‰å¤ªå¤šçš„å…³è” runtime._panic ","date":"2020-05-06","objectID":"/go-compiler-overview/:5:4","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"æ€»ç»“ ç¼–è¯‘å™¨ä¼šè´Ÿè´£åšè½¬æ¢å…³é”®å­—çš„å·¥ä½œï¼› å°† panic å’Œ recover åˆ†åˆ«è½¬æ¢æˆ runtime.gopanic å’Œ runtime.gorecoverï¼› å°† defer è½¬æ¢æˆ deferproc å‡½æ•°ï¼› åœ¨è°ƒç”¨ defer çš„å‡½æ•°æœ«å°¾è°ƒç”¨ deferreturn å‡½æ•°ï¼› åœ¨è¿è¡Œè¿‡ç¨‹ä¸­é‡åˆ° gopanic æ–¹æ³•æ—¶ï¼Œä¼šä» Goroutine çš„é“¾è¡¨ä¾æ¬¡å–å‡º _defer ç»“æ„ä½“å¹¶æ‰§è¡Œï¼› å¦‚æœè°ƒç”¨å»¶è¿Ÿæ‰§è¡Œå‡½æ•°æ—¶é‡åˆ°äº† gorecover å°±ä¼šå°† _panic.recovered æ ‡è®°æˆ true å¹¶è¿”å› panic çš„å‚æ•°ï¼› åœ¨è¿™æ¬¡è°ƒç”¨ç»“æŸä¹‹åï¼Œgopanic ä¼šä» _defer ç»“æ„ä½“ä¸­å–å‡ºç¨‹åºè®¡æ•°å™¨ pc å’Œæ ˆæŒ‡é’ˆ sp å¹¶è°ƒç”¨ recovery å‡½æ•°è¿›è¡Œæ¢å¤ç¨‹åºï¼› recovery ä¼šæ ¹æ®ä¼ å…¥çš„ pc å’Œ sp è·³è½¬å› deferprocï¼› ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç ä¼šå‘ç° deferproc çš„è¿”å›å€¼ä¸ä¸º 0ï¼Œè¿™æ—¶ä¼šè·³å› deferreturn å¹¶æ¢å¤åˆ°æ­£å¸¸çš„æ‰§è¡Œæµç¨‹ï¼› å¦‚æœæ²¡æœ‰é‡åˆ° gorecover å°±ä¼šä¾æ¬¡éå†æ‰€æœ‰çš„ _defer ç»“æ„ï¼Œå¹¶åœ¨æœ€åè°ƒç”¨ fatalpanic ä¸­æ­¢ç¨‹åºã€æ‰“å° panic çš„å‚æ•°å¹¶è¿”å›é”™è¯¯ç  2ï¼› ","date":"2020-05-06","objectID":"/go-compiler-overview/:5:5","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"make å’Œ new make å…³é”®å­—çš„ä½œç”¨æ˜¯åˆ›å»ºåˆ‡ç‰‡ã€å“ˆå¸Œè¡¨å’Œ Channel ç­‰å†…ç½®çš„æ•°æ®ç»“æ„ï¼Œè€Œ new çš„ä½œç”¨æ˜¯ä¸ºç±»å‹ç”³è¯·ä¸€ç‰‡å†…å­˜ç©ºé—´ï¼Œå¹¶è¿”å›æŒ‡å‘è¿™ç‰‡å†…å­˜çš„æŒ‡é’ˆã€‚ ","date":"2020-05-06","objectID":"/go-compiler-overview/:5:6","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"è¿è¡Œæ—¶ ","date":"2020-05-06","objectID":"/go-compiler-overview/:6:0","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"å¹¶å‘ ä¸Šä¸‹æ–‡ Context Deadline â€” è¿”å› context.Context è¢«å–æ¶ˆçš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯å®Œæˆå·¥ä½œçš„æˆªæ­¢æ—¥æœŸï¼› Done â€” è¿”å›ä¸€ä¸ª Channelï¼Œè¿™ä¸ª Channel ä¼šåœ¨å½“å‰å·¥ä½œå®Œæˆæˆ–è€…ä¸Šä¸‹æ–‡è¢«å–æ¶ˆä¹‹åå…³é—­ï¼Œå¤šæ¬¡è°ƒç”¨ Done æ–¹æ³•ä¼šè¿”å›åŒä¸€ä¸ª Channelï¼› Err â€” è¿”å› context.Context ç»“æŸçš„åŸå› ï¼Œå®ƒåªä¼šåœ¨ Done è¿”å›çš„ Channel è¢«å…³é—­æ—¶æ‰ä¼šè¿”å›éç©ºçš„å€¼ï¼› å¦‚æœ context.Context è¢«å–æ¶ˆï¼Œä¼šè¿”å› Canceled é”™è¯¯ï¼› å¦‚æœ context.Context è¶…æ—¶ï¼Œä¼šè¿”å› DeadlineExceeded é”™è¯¯ï¼› Value â€” ä» context.Context ä¸­è·å–é”®å¯¹åº”çš„å€¼ï¼Œå¯¹äºåŒä¸€ä¸ªä¸Šä¸‹æ–‡æ¥è¯´ï¼Œå¤šæ¬¡è°ƒç”¨ Value å¹¶ä¼ å…¥ç›¸åŒçš„ Key ä¼šè¿”å›ç›¸åŒçš„ç»“æœï¼Œè¯¥æ–¹æ³•å¯ä»¥ç”¨æ¥ä¼ é€’è¯·æ±‚ç‰¹å®šçš„æ•°æ®ï¼› Go Concurrency Patterns: Context åŒæ­¥åŸè¯­ä¸é” Mutexã€RWMutesã€WaitGroupã€Once x/sync/errgroup.Groupã€x/sync/semaphore.Weightedã€x/sync/singleflight.Group å’Œ x/sync/syncmap.Map sync.Mutex type Mutex struct { state int32 sema uint32 } æ­£å¸¸æ¨¡å¼ =\u003e åœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œé”çš„ç­‰å¾…è€…ä¼šæŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºè·å–é”ã€‚ä½†æ˜¯åˆšè¢«å”¤èµ·çš„ Goroutine ä¸æ–°åˆ›å»ºçš„ Goroutine ç«äº‰æ—¶ï¼Œå¤§æ¦‚ç‡ä¼šè·å–ä¸åˆ°é”ï¼Œä¸ºäº†å‡å°‘è¿™ç§æƒ…å†µçš„å‡ºç°ï¼Œä¸€æ—¦ Goroutine è¶…è¿‡ 1ms æ²¡æœ‰è·å–åˆ°é”ï¼Œå®ƒå°±ä¼šå°†å½“å‰äº’æ–¥é”åˆ‡æ¢é¥¥é¥¿æ¨¡å¼ï¼Œé˜²æ­¢éƒ¨åˆ† Goroutine è¢«ã€é¥¿æ­»ã€ã€‚ é¥¥é¥¿æ¨¡å¼ =\u003e åœ¨é¥¥é¥¿æ¨¡å¼ä¸­ï¼Œäº’æ–¥é”ä¼šç›´æ¥äº¤ç»™ç­‰å¾…é˜Ÿåˆ—æœ€å‰é¢çš„ Goroutineã€‚æ–°çš„ Goroutine åœ¨è¯¥çŠ¶æ€ä¸‹ä¸èƒ½è·å–é”ã€ä¹Ÿä¸ä¼šè¿›å…¥è‡ªæ—‹çŠ¶æ€ï¼Œå®ƒä»¬åªä¼šåœ¨é˜Ÿåˆ—çš„æœ«å°¾ç­‰å¾…ã€‚å¦‚æœä¸€ä¸ª Goroutine è·å¾—äº†äº’æ–¥é”å¹¶ä¸”å®ƒåœ¨é˜Ÿåˆ—çš„æœ«å°¾æˆ–è€…å®ƒç­‰å¾…çš„æ—¶é—´å°‘äº 1msï¼Œé‚£ä¹ˆå½“å‰çš„äº’æ–¥é”å°±ä¼šè¢«åˆ‡æ¢å›æ­£å¸¸æ¨¡å¼ã€‚ ç›¸æ¯”äºé¥¥é¥¿æ¨¡å¼ï¼Œæ­£å¸¸æ¨¡å¼ä¸‹çš„äº’æ–¥é”èƒ½å¤Ÿæä¾›æ›´å¥½åœ°æ€§èƒ½ï¼Œé¥¥é¥¿æ¨¡å¼çš„èƒ½é¿å… Goroutine ç”±äºé™·å…¥ç­‰å¾…æ— æ³•è·å–é”è€Œé€ æˆçš„é«˜å°¾å»¶æ—¶ã€‚ Go è¯­è¨€è¿˜åœ¨å­ä»“åº“ sync ä¸­æä¾›äº†å››ç§æ‰©å±•åŸè¯­ï¼Œx/sync/errgroup.Groupã€x/sync/semaphore.Weightedã€x/sync/singleflight.Group å’Œ x/sync/syncmap.Mapï¼Œå…¶ä¸­çš„ x/sync/syncmap.Map åœ¨ 1.9 ç‰ˆæœ¬ä¸­è¢«ç§»æ¤åˆ°äº†æ ‡å‡†åº“ä¸­ã€‚ å®šæ—¶å™¨ è€Œåœ¨ 10ms çš„è¿™ä¸ªç²’åº¦ä¸‹ï¼Œä½œè€…åœ¨ç¤¾åŒºä¸­ä¹Ÿæ²¡æœ‰æ‰¾åˆ°èƒ½å¤Ÿä½¿ç”¨çš„è®¡æ—¶å™¨å®ç°ï¼Œä¸€äº›ä½¿ç”¨æ—¶é—´è½®ç®—æ³•çš„å¼€æºåº“ä¹Ÿä¸èƒ½å¾ˆå¥½åœ°å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚ Channel åˆ›å»ºã€å‘é€ã€æ¥æ”¶å’Œå…³é—­ ä¸è¦é€šè¿‡å…±äº«å†…å­˜çš„æ–¹å¼è¿›è¡Œé€šä¿¡ï¼Œè€Œæ˜¯åº”è¯¥é€šè¿‡é€šä¿¡çš„æ–¹å¼å…±äº«å†…å­˜ CSP æ— é”ï¼ˆlock-freeï¼‰é˜Ÿåˆ—æ›´å‡†ç¡®çš„æè¿°æ˜¯ä½¿ç”¨ä¹è§‚å¹¶å‘æ§åˆ¶çš„é˜Ÿåˆ— runtime.hchan impl lock free è®ºæ–‡ ç¤¾åŒº lock free chan send runtime.chansend1 å½“å­˜åœ¨ç­‰å¾…çš„æ¥æ”¶è€…æ—¶ï¼Œé€šè¿‡ runtime.send ç›´æ¥å°†æ•°æ®å‘é€ç»™é˜»å¡çš„æ¥æ”¶è€…ï¼› å½“ç¼“å†²åŒºå­˜åœ¨ç©ºä½™ç©ºé—´æ—¶ï¼Œå°†å‘é€çš„æ•°æ®å†™å…¥ Channel çš„ç¼“å†²åŒºï¼› å½“ä¸å­˜åœ¨ç¼“å†²åŒºæˆ–è€…ç¼“å†²åŒºå·²æ»¡æ—¶ï¼Œç­‰å¾…å…¶ä»– Goroutine ä» Channel æ¥æ”¶æ•°æ®ï¼› recv å¦‚æœ Channel ä¸ºç©ºï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥è°ƒç”¨ runtime.gopark æŒ‚èµ·å½“å‰ Goroutineï¼› å¦‚æœ Channel å·²ç»å…³é—­å¹¶ä¸”ç¼“å†²åŒºæ²¡æœ‰ä»»ä½•æ•°æ®ï¼Œruntime.chanrecv å‡½æ•°ä¼šç›´æ¥è¿”å›ï¼› å¦‚æœ Channel çš„ sendq é˜Ÿåˆ—ä¸­å­˜åœ¨æŒ‚èµ·çš„ Goroutineï¼Œå°±ä¼šå°† recvx ç´¢å¼•æ‰€åœ¨çš„æ•°æ®æ‹·è´åˆ°æ¥æ”¶å˜é‡æ‰€åœ¨çš„å†…å­˜ç©ºé—´ä¸Šå¹¶å°† sendq é˜Ÿåˆ—ä¸­ Goroutine çš„æ•°æ®æ‹·è´åˆ°ç¼“å†²åŒºï¼› å¦‚æœ Channel çš„ç¼“å†²åŒºä¸­åŒ…å«æ•°æ®å°±ä¼šç›´æ¥è¯»å– recvx ç´¢å¼•å¯¹åº”çš„æ•°æ®ï¼› åœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šæŒ‚èµ·å½“å‰çš„ Goroutineï¼Œå°† runtime.sudog ç»“æ„åŠ å…¥ recvq é˜Ÿåˆ—å¹¶é™·å…¥ä¼‘çœ ç­‰å¾…è°ƒåº¦å™¨çš„å”¤é†’ï¼› è°ƒåº¦å™¨ æ¯ä¸€æ¬¡çº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢éƒ½éœ€è¦æ¶ˆè€— ~1us å·¦å³çš„æ—¶é—´ï¼šMeasuring context switching and memory overheads for Linux threads Go è°ƒåº¦å™¨å¯¹ Goroutine çš„ä¸Šä¸‹æ–‡åˆ‡æ¢çº¦ä¸º ~0.2usï¼Œå‡å°‘äº† 80% çš„é¢å¤–å¼€é”€ ç½‘ç»œè½®è¯¢å™¨ ç³»ç»Ÿç›‘æ§ ","date":"2020-05-06","objectID":"/go-compiler-overview/:6:1","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"å†…å­˜ç®¡ç† å†…å­˜åˆ†é…å™¨ TCMalloc éš”ç¦»é€‚åº” åƒåœ¾æ”¶é›†å™¨ æ ‡è®°æ¸…é™¤ ä¸‰è‰²æŠ½è±¡ ä»ç°è‰²å¯¹è±¡çš„é›†åˆä¸­é€‰æ‹©ä¸€ä¸ªç°è‰²å¯¹è±¡å¹¶å°†å…¶æ ‡è®°æˆé»‘è‰²ï¼› å°†é»‘è‰²å¯¹è±¡æŒ‡å‘çš„æ‰€æœ‰å¯¹è±¡éƒ½æ ‡è®°æˆç°è‰²ï¼Œä¿è¯è¯¥å¯¹è±¡å’Œè¢«è¯¥å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡éƒ½ä¸ä¼šè¢«å›æ”¶ï¼› é‡å¤ä¸Šè¿°ä¸¤ä¸ªæ­¥éª¤ç›´åˆ°å¯¹è±¡å›¾ä¸­ä¸å­˜åœ¨ç°è‰²å¯¹è±¡ï¼› å±éšœæŠ€æœ¯ æ ˆå†…å­˜ç®¡ç† ","date":"2020-05-06","objectID":"/go-compiler-overview/:6:2","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"å…¶ä»– ","date":"2020-05-06","objectID":"/go-compiler-overview/:7:0","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"unsafe ","date":"2020-05-06","objectID":"/go-compiler-overview/:7:1","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"é€ƒé€¸åˆ†æ ","date":"2020-05-06","objectID":"/go-compiler-overview/:7:2","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"build comment //go:nosplit //go:linkname //go:noescape //go:notinheap *(*int)(nil) = 0 // not reached ","date":"2020-05-06","objectID":"/go-compiler-overview/:8:0","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"reference","date":"2020-05-06","objectID":"/go-compiler-overview/:9:0","tags":[],"title":"Go Overview","uri":"/go-compiler-overview/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šæºç å±‚é¢åˆ†æ Opentracing ä¸€ä¸ªå®ç° jaeger çš„å·¥ä½œåŸç† ","date":"2020-04-24","objectID":"/opentracing-jaeger-agent-src-code-introduce/:0:0","tags":["opentracing","jaeger","æºç åˆ†æ","go"],"title":"Opentracing - jaeger æºç åˆ†æ","uri":"/opentracing-jaeger-agent-src-code-introduce/"},{"categories":null,"content":"agent Agent å¤„äº jaeger-client å’Œ collector ä¹‹é—´ï¼Œå±äºä»£ç†çš„ä½œç”¨ï¼Œä¸»è¦æ˜¯æŠŠ client å‘é€è¿‡æ¥çš„æ•°æ®ä» thrift è½¬ä¸º Batchï¼Œå¹¶é€šè¿‡ RPC æ‰¹é‡æäº¤åˆ° collector jaegertracing/jaeger/cmd/agent/app/flags.go#L62 var defaultProcessors = []struct { model Model protocol Protocol port int }{ {model: \"zipkin\", protocol: \"compact\", port: 5775}, {model: \"jaeger\", protocol: \"compact\", port: 6831}, {model: \"jaeger\", protocol: \"binary\", port: 6832}, } jaegertracing/jaeger/cmd/agent/app/servers/tbuffered_server.go#L82 // Serve initiates the readers and starts serving traffic func (s *TBufferedServer) Serve() { atomic.StoreUint32(\u0026s.serving, 1) for s.IsServing() { readBuf := s.readBufPool.Get().(*ReadBuf) n, err := s.transport.Read(readBuf.bytes) if err == nil { readBuf.n = n s.metrics.PacketSize.Update(int64(n)) select { case s.dataChan \u003c- readBuf: s.metrics.PacketsProcessed.Inc(1) s.updateQueueSize(1) default: s.metrics.PacketsDropped.Inc(1) } } else { s.metrics.ReadError.Inc(1) } } } jaegertracing/jaeger/blob/master/cmd/agent/app/processors/thrift_processor.go#L114 // processBuffer reads data off the channel and puts it into a custom transport for // the processor to process func (s *ThriftProcessor) processBuffer() { for readBuf := range s.server.DataChan() { protocol := s.protocolPool.Get().(thrift.TProtocol) payload := readBuf.GetBytes() protocol.Transport().Write(payload) s.logger.Debug(\"Span(s) received by the agent\", zap.Int(\"bytes-received\", len(payload))) if ok, err := s.handler.Process(protocol, protocol); !ok { s.logger.Error(\"Processor failed\", zap.Error(err)) s.metrics.HandlerProcessError.Inc(1) } s.protocolPool.Put(protocol) s.server.DataRecd(readBuf) // acknowledge receipt and release the buffer } } jaegertracing/jaeger/thrift-gen/agent/agent.go#L187 func (p *agentProcessorEmitBatch) Process(seqId int32, iprot, oprot thrift.TProtocol) (success bool, err thrift.TException) { args := AgentEmitBatchArgs{} if err = args.Read(iprot); err != nil { iprot.ReadMessageEnd() return false, err } iprot.ReadMessageEnd() var err2 error if err2 = p.handler.EmitBatch(args.Batch); err2 != nil { return true, err2 } return true, nil } jaegertracing/jaeger/thrift-gen/jaeger/tchan-jaeger.go#L39 ","date":"2020-04-24","objectID":"/opentracing-jaeger-agent-src-code-introduce/:1:0","tags":["opentracing","jaeger","æºç åˆ†æ","go"],"title":"Opentracing - jaeger æºç åˆ†æ","uri":"/opentracing-jaeger-agent-src-code-introduce/"},{"categories":null,"content":"Collector ","date":"2020-04-24","objectID":"/opentracing-jaeger-agent-src-code-introduce/:2:0","tags":["opentracing","jaeger","æºç åˆ†æ","go"],"title":"Opentracing - jaeger æºç åˆ†æ","uri":"/opentracing-jaeger-agent-src-code-introduce/"},{"categories":null,"content":"æ¥æ”¶ Agent çš„æ•°æ® jaegertracing/jaeger/cmd/collector/app/handler/thrift_span_handler.go#L60 æ¯”è¾ƒèˆ’æœçš„ç»´æŠ¤metricsçš„åœºæ™¯ ","date":"2020-04-24","objectID":"/opentracing-jaeger-agent-src-code-introduce/:2:1","tags":["opentracing","jaeger","æºç åˆ†æ","go"],"title":"Opentracing - jaeger æºç åˆ†æ","uri":"/opentracing-jaeger-agent-src-code-introduce/"},{"categories":null,"content":"references jaeger ","date":"2020-04-24","objectID":"/opentracing-jaeger-agent-src-code-introduce/:3:0","tags":["opentracing","jaeger","æºç åˆ†æ","go"],"title":"Opentracing - jaeger æºç åˆ†æ","uri":"/opentracing-jaeger-agent-src-code-introduce/"},{"categories":null,"content":"æ•´ç†ä¸€ä¸‹ ElasticSearch çŸ¥è¯†ç‚¹ ElasticSearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œåº•å±‚ä½¿ç”¨ Lucene æ¥å®ç°å…¶æ ¸å¿ƒæœç´¢åŠŸèƒ½.å…¶æ ¸å¿ƒæ˜¯å…¨æ–‡æ£€ç´¢. ","date":"2020-04-16","objectID":"/how-elastic-works/:0:0","tags":["es"],"title":"ElasticSearch æ˜¯å¦‚ä½•å·¥ä½œçš„","uri":"/how-elastic-works/"},{"categories":null,"content":"å…¨æ–‡æ£€ç´¢ å€’æ’ç´¢å¼• + TF-IDFä¸ºå…¨æ–‡æœç´¢çš„åŸºçŸ³ã€‚ ","date":"2020-04-16","objectID":"/how-elastic-works/:1:0","tags":["es"],"title":"ElasticSearch æ˜¯å¦‚ä½•å·¥ä½œçš„","uri":"/how-elastic-works/"},{"categories":null,"content":"ElasticSearch è¯ç”Ÿçš„èƒŒæ™¯ ","date":"2020-04-16","objectID":"/how-elastic-works/:2:0","tags":["es"],"title":"ElasticSearch æ˜¯å¦‚ä½•å·¥ä½œçš„","uri":"/how-elastic-works/"},{"categories":null,"content":"å¤§è§„æ¨¡æ•°æ®å¦‚ä½•æ£€ç´¢ å½“ç³»ç»Ÿæ•°æ®é‡ä¸Šäº† 10 äº¿ã€100 äº¿æ¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨åšç³»ç»Ÿæ¶æ„çš„æ—¶å€™é€šå¸¸ä¼šä»ä»¥ä¸‹è§’åº¦å»è€ƒè™‘é—®é¢˜ï¼š ç”¨ä»€ä¹ˆæ•°æ®åº“å¥½ï¼Ÿ(mysqlã€postgresã€sybaseã€oracleã€è¾¾æ¢¦ã€ç¥é€šã€mongodbã€hbaseâ€¦) å¦‚ä½•è§£å†³å•ç‚¹æ•…éšœï¼›(lvsã€F5ã€A10ã€Zookeepã€MQ) å¦‚ä½•ä¿è¯æ•°æ®å®‰å…¨æ€§ï¼›(çƒ­å¤‡ã€å†·å¤‡ã€å¼‚åœ°å¤šæ´») å¦‚ä½•è§£å†³æ£€ç´¢éš¾é¢˜ï¼›(æ•°æ®åº“ä»£ç†ä¸­é—´ä»¶ï¼šmysql-proxyã€Cobarã€MaxScale ç­‰;) å¦‚ä½•è§£å†³ç»Ÿè®¡åˆ†æé—®é¢˜ï¼›(ç¦»çº¿ã€è¿‘å®æ—¶) ","date":"2020-04-16","objectID":"/how-elastic-works/:2:1","tags":["es"],"title":"ElasticSearch æ˜¯å¦‚ä½•å·¥ä½œçš„","uri":"/how-elastic-works/"},{"categories":null,"content":"ä¼ ç»Ÿæ•°æ®åº“çš„åº”å¯¹è§£å†³æ–¹æ¡ˆ å¯¹äºå…³ç³»å‹æ•°æ®ï¼Œæˆ‘ä»¬é€šå¸¸é‡‡ç”¨ä»¥ä¸‹æˆ–ç±»ä¼¼æ¶æ„å»è§£å†³æŸ¥è¯¢ç“¶é¢ˆå’Œå†™å…¥ç“¶é¢ˆï¼š é€šè¿‡ä¸»ä»å¤‡ä»½è§£å†³æ•°æ®å®‰å…¨æ€§é—®é¢˜ï¼› é€šè¿‡æ•°æ®åº“ä»£ç†ä¸­é—´ä»¶å¿ƒè·³ç›‘æµ‹ï¼Œè§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼› é€šè¿‡ä»£ç†ä¸­é—´ä»¶å°†æŸ¥è¯¢è¯­å¥åˆ†å‘åˆ°å„ä¸ª slave èŠ‚ç‚¹è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶æ±‡æ€»ç»“æœ ","date":"2020-04-16","objectID":"/how-elastic-works/:2:2","tags":["es"],"title":"ElasticSearch æ˜¯å¦‚ä½•å·¥ä½œçš„","uri":"/how-elastic-works/"},{"categories":null,"content":"éå…³ç³»å‹æ•°æ®åº“çš„è§£å†³æ–¹æ¡ˆ å¯¹äº Nosql æ•°æ®åº“ï¼ŒåŸºæœ¬åŸç†ç±»ä¼¼ï¼š é€šè¿‡å‰¯æœ¬å¤‡ä»½ä¿è¯æ•°æ®å®‰å…¨æ€§ï¼› é€šè¿‡èŠ‚ç‚¹ç«é€‰æœºåˆ¶è§£å†³å•ç‚¹é—®é¢˜ï¼› å…ˆä»é…ç½®åº“æ£€ç´¢åˆ†ç‰‡ä¿¡æ¯ï¼Œç„¶åå°†è¯·æ±‚åˆ†å‘åˆ°å„ä¸ªèŠ‚ç‚¹ï¼Œæœ€åç”±è·¯ç”±èŠ‚ç‚¹åˆå¹¶æ±‡æ€»ç»“æœ ","date":"2020-04-16","objectID":"/how-elastic-works/:2:3","tags":["es"],"title":"ElasticSearch æ˜¯å¦‚ä½•å·¥ä½œçš„","uri":"/how-elastic-works/"},{"categories":null,"content":"Elastic ç†è®ºçŸ¥è¯† ","date":"2020-04-16","objectID":"/how-elastic-works/:3:0","tags":["es"],"title":"ElasticSearch æ˜¯å¦‚ä½•å·¥ä½œçš„","uri":"/how-elastic-works/"},{"categories":null,"content":"Elasticsearch vs mysql Mysql -\u003e database -\u003e table -\u003e rows -\u003e columns Elasticsearch -\u003e index -\u003e type -\u003e documents -\u003e fields elastic åœ¨ 7.x ä¹‹åå°†å»æ‰ types, æ›¿ä»£æ–¹æ¡ˆï¼šindex per document type / custom type field ","date":"2020-04-16","objectID":"/how-elastic-works/:3:1","tags":["es"],"title":"ElasticSearch æ˜¯å¦‚ä½•å·¥ä½œçš„","uri":"/how-elastic-works/"},{"categories":null,"content":"ES çš„ CRUD èµ„æ–™ ç´¢å¼•æ–°æ–‡æ¡£ å½“ç”¨æˆ·å‘ä¸€ä¸ªèŠ‚ç‚¹æäº¤äº†ä¸€ä¸ªç´¢å¼•æ–°æ–‡æ¡£çš„è¯·æ±‚ï¼ŒèŠ‚ç‚¹ä¼šè®¡ç®—æ–°æ–‡æ¡£åº”è¯¥åŠ å…¥åˆ°å“ªä¸ªåˆ†ç‰‡ï¼ˆshardï¼‰ä¸­ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½å­˜å‚¨æœ‰æ¯ä¸ªåˆ†ç‰‡å­˜å‚¨åœ¨å“ªä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå› æ­¤åè°ƒèŠ‚ç‚¹ä¼šå°†è¯·æ±‚å‘é€ç»™å¯¹åº”çš„èŠ‚ç‚¹ã€‚æ³¨æ„è¿™ä¸ªè¯·æ±‚ä¼šå‘é€ç»™ä¸»åˆ†ç‰‡ï¼Œç­‰ä¸»åˆ†ç‰‡å®Œæˆç´¢å¼•ï¼Œä¼šå¹¶è¡Œå°†è¯·æ±‚å‘é€åˆ°å…¶æ‰€æœ‰å‰¯æœ¬åˆ†ç‰‡ï¼Œä¿è¯æ¯ä¸ªåˆ†ç‰‡éƒ½æŒæœ‰æœ€æ–°æ•°æ®ã€‚ æ¯æ¬¡å†™å…¥æ–°æ–‡æ¡£æ—¶ï¼Œéƒ½ä¼šå…ˆå†™å…¥å†…å­˜ä¸­ï¼Œå¹¶å°†è¿™ä¸€æ“ä½œå†™å…¥ä¸€ä¸ª translog æ–‡ä»¶ï¼ˆtransaction logï¼‰ä¸­ï¼Œæ­¤æ—¶å¦‚æœæ‰§è¡Œæœç´¢æ“ä½œï¼Œè¿™ä¸ªæ–°æ–‡æ¡£è¿˜ä¸èƒ½è¢«ç´¢å¼•åˆ°ã€‚ ES ä¼šæ¯éš” 1 ç§’æ—¶é—´ï¼ˆè¿™ä¸ªæ—¶é—´å¯ä»¥ä¿®æ”¹ï¼‰è¿›è¡Œä¸€æ¬¡åˆ·æ–°æ“ä½œï¼ˆrefreshï¼‰ï¼Œæ­¤æ—¶åœ¨è¿™ 1 ç§’æ—¶é—´å†…å†™å…¥å†…å­˜çš„æ–°æ–‡æ¡£éƒ½ä¼šè¢«å†™å…¥ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼ˆfilesystem cacheï¼‰ä¸­ï¼Œå¹¶æ„æˆä¸€ä¸ªåˆ†æ®µï¼ˆsegmentï¼‰ã€‚æ­¤æ—¶è¿™ä¸ª segment é‡Œçš„æ–‡æ¡£å¯ä»¥è¢«æœç´¢åˆ°ï¼Œä½†æ˜¯å°šæœªå†™å…¥ç¡¬ç›˜ï¼Œå³å¦‚æœæ­¤æ—¶å‘ç”Ÿæ–­ç”µï¼Œåˆ™è¿™äº›æ–‡æ¡£å¯èƒ½ä¼šä¸¢å¤±ã€‚ ä¸æ–­æœ‰æ–°çš„æ–‡æ¡£å†™å…¥ï¼Œåˆ™è¿™ä¸€è¿‡ç¨‹å°†ä¸æ–­é‡å¤æ‰§è¡Œã€‚æ¯éš”ä¸€ç§’å°†ç”Ÿæˆä¸€ä¸ªæ–°çš„ segmentï¼Œè€Œ translog æ–‡ä»¶å°†è¶Šæ¥è¶Šå¤§ã€‚æ¯éš” 30 åˆ†é’Ÿæˆ–è€… translog æ–‡ä»¶å˜å¾—å¾ˆå¤§ï¼Œåˆ™æ‰§è¡Œä¸€æ¬¡ fsync æ“ä½œã€‚æ­¤æ—¶æ‰€æœ‰åœ¨æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ä¸­çš„ segment å°†è¢«å†™å…¥ç£ç›˜ï¼Œè€Œ translog å°†è¢«åˆ é™¤ï¼ˆæ­¤åä¼šç”Ÿæˆæ–°çš„ translogï¼‰ã€‚ ç”±ä¸Šé¢çš„æµç¨‹å¯ä»¥çœ‹å‡ºï¼Œåœ¨ä¸¤æ¬¡ fsync æ“ä½œä¹‹é—´ï¼Œå­˜å‚¨åœ¨å†…å­˜å’Œæ–‡ä»¶ç³»ç»Ÿç¼“å­˜ä¸­çš„æ–‡æ¡£æ˜¯ä¸å®‰å…¨çš„ï¼Œä¸€æ—¦å‡ºç°æ–­ç”µè¿™äº›æ–‡æ¡£å°±ä¼šä¸¢å¤±ã€‚æ‰€ä»¥ ES å¼•å…¥äº† translog æ¥è®°å½•ä¸¤æ¬¡ fsync ä¹‹é—´æ‰€æœ‰çš„æ“ä½œï¼Œè¿™æ ·æœºå™¨ä»æ•…éšœä¸­æ¢å¤æˆ–è€…é‡æ–°å¯åŠ¨ï¼ŒES ä¾¿å¯ä»¥æ ¹æ® translog è¿›è¡Œè¿˜åŸã€‚ æ­¤å¤–ï¼Œç”±äºæ¯ä¸€ç§’å°±ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ segmentï¼Œå¾ˆå¿«å°†ä¼šæœ‰å¤§é‡çš„ segmentã€‚å¯¹äºä¸€ä¸ªåˆ†ç‰‡è¿›è¡ŒæŸ¥è¯¢è¯·æ±‚ï¼Œå°†ä¼šè½®æµæŸ¥è¯¢åˆ†ç‰‡ä¸­çš„æ‰€æœ‰ segmentï¼Œè¿™å°†é™ä½æœç´¢çš„æ•ˆç‡ã€‚å› æ­¤ ES ä¼šè‡ªåŠ¨å¯åŠ¨åˆå¹¶ segment çš„å·¥ä½œï¼Œå°†ä¸€éƒ¨åˆ†ç›¸ä¼¼å¤§å°çš„ segment åˆå¹¶æˆä¸€ä¸ªæ–°çš„å¤§ segmentã€‚åˆå¹¶çš„è¿‡ç¨‹å®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ segmentï¼Œå½“æ–° segment è¢«å†™å…¥ç£ç›˜ï¼Œæ‰€æœ‰è¢«åˆå¹¶çš„æ—§ segment è¢«æ¸…é™¤ã€‚ æ›´æ–°ï¼ˆUpdateï¼‰å’Œåˆ é™¤ï¼ˆDeleteï¼‰æ–‡æ¡£ ES çš„ç´¢å¼•æ˜¯ä¸èƒ½ä¿®æ”¹çš„ï¼Œå› æ­¤æ›´æ–°å’Œåˆ é™¤æ“ä½œå¹¶ä¸æ˜¯ç›´æ¥åœ¨åŸç´¢å¼•ä¸Šç›´æ¥æ‰§è¡Œã€‚æ¯ä¸€ä¸ªç£ç›˜ä¸Šçš„ segment éƒ½ä¼šç»´æŠ¤ä¸€ä¸ª del æ–‡ä»¶ï¼Œç”¨æ¥è®°å½•è¢«åˆ é™¤çš„æ–‡ä»¶ã€‚æ¯å½“ç”¨æˆ·æå‡ºä¸€ä¸ªåˆ é™¤è¯·æ±‚ï¼Œæ–‡æ¡£å¹¶æ²¡æœ‰è¢«çœŸæ­£åˆ é™¤ï¼Œç´¢å¼•ä¹Ÿæ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œè€Œæ˜¯åœ¨ del æ–‡ä»¶ä¸­æ ‡è®°è¯¥æ–‡æ¡£å·²è¢«åˆ é™¤ã€‚å› æ­¤ï¼Œè¢«åˆ é™¤çš„æ–‡æ¡£ä¾ç„¶å¯ä»¥è¢«æ£€ç´¢åˆ°ï¼Œåªæ˜¯åœ¨è¿”å›æ£€ç´¢ç»“æœæ—¶è¢«è¿‡æ»¤æ‰äº†ã€‚æ¯æ¬¡åœ¨å¯åŠ¨ segment åˆå¹¶å·¥ä½œæ—¶ï¼Œé‚£äº›è¢«æ ‡è®°ä¸ºåˆ é™¤çš„æ–‡æ¡£æ‰ä¼šè¢«çœŸæ­£åˆ é™¤ã€‚ æ›´æ–°æ–‡æ¡£ä¼šé¦–å…ˆæŸ¥æ‰¾åŸæ–‡æ¡£ï¼Œå¾—åˆ°è¯¥æ–‡æ¡£çš„ç‰ˆæœ¬å·ã€‚ç„¶åå°†ä¿®æ”¹åçš„æ–‡æ¡£å†™å…¥å†…å­˜ï¼Œæ­¤è¿‡ç¨‹ä¸å†™å…¥ä¸€ä¸ªæ–°æ–‡æ¡£ç›¸åŒã€‚åŒæ—¶ï¼Œæ—§ç‰ˆæœ¬æ–‡æ¡£è¢«æ ‡è®°ä¸ºåˆ é™¤ï¼ŒåŒç†ï¼Œè¯¥æ–‡æ¡£å¯ä»¥è¢«æœç´¢åˆ°ï¼Œåªæ˜¯æœ€ç»ˆè¢«è¿‡æ»¤æ‰ã€‚ è¯»æ“ä½œï¼ˆReadï¼‰ï¼šæŸ¥è¯¢è¿‡ç¨‹ æŸ¥è¯¢é˜¶æ®µ å½“ä¸€ä¸ªèŠ‚ç‚¹æ¥æ”¶åˆ°ä¸€ä¸ªæœç´¢è¯·æ±‚ï¼Œåˆ™è¿™ä¸ªèŠ‚ç‚¹å°±å˜æˆäº†åè°ƒèŠ‚ç‚¹ã€‚ç¬¬ä¸€æ­¥æ˜¯å¹¿æ’­è¯·æ±‚åˆ°ç´¢å¼•ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„åˆ†ç‰‡æ‹·è´ã€‚ æŸ¥è¯¢è¯·æ±‚å¯ä»¥è¢«æŸä¸ªä¸»åˆ†ç‰‡æˆ–æŸä¸ªå‰¯æœ¬åˆ†ç‰‡å¤„ç†ï¼Œåè°ƒèŠ‚ç‚¹å°†åœ¨ä¹‹åçš„è¯·æ±‚ä¸­è½®è¯¢æ‰€æœ‰çš„åˆ†ç‰‡æ‹·è´æ¥åˆ†æ‘Šè´Ÿè½½ã€‚ æ¯ä¸ªåˆ†ç‰‡å°†ä¼šåœ¨æœ¬åœ°æ„å»ºä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚å¦‚æœå®¢æˆ·ç«¯è¦æ±‚è¿”å›ç»“æœæ’åºä¸­ä»ç¬¬ from åå¼€å§‹çš„æ•°é‡ä¸º size çš„ç»“æœé›†ï¼Œåˆ™æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦ç”Ÿæˆä¸€ä¸ª from+size å¤§å°çš„ç»“æœé›†ï¼Œå› æ­¤ä¼˜å…ˆçº§é˜Ÿåˆ—çš„å¤§å°ä¹Ÿæ˜¯ from+sizeã€‚åˆ†ç‰‡ä»…ä¼šè¿”å›ä¸€ä¸ªè½»é‡çº§çš„ç»“æœç»™åè°ƒèŠ‚ç‚¹ï¼ŒåŒ…å«ç»“æœé›†ä¸­çš„æ¯ä¸€ä¸ªæ–‡æ¡£çš„ ID å’Œè¿›è¡Œæ’åºæ‰€éœ€è¦çš„ä¿¡æ¯ã€‚ åè°ƒèŠ‚ç‚¹ä¼šå°†æ‰€æœ‰åˆ†ç‰‡çš„ç»“æœæ±‡æ€»ï¼Œå¹¶è¿›è¡Œå…¨å±€æ’åºï¼Œå¾—åˆ°æœ€ç»ˆçš„æŸ¥è¯¢æ’åºç»“æœã€‚æ­¤æ—¶æŸ¥è¯¢é˜¶æ®µç»“æŸã€‚ å–å›é˜¶æ®µ æŸ¥è¯¢è¿‡ç¨‹å¾—åˆ°çš„æ˜¯ä¸€ä¸ªæ’åºç»“æœï¼Œæ ‡è®°å‡ºå“ªäº›æ–‡æ¡£æ˜¯ç¬¦åˆæœç´¢è¦æ±‚çš„ï¼Œæ­¤æ—¶ä»ç„¶éœ€è¦è·å–è¿™äº›æ–‡æ¡£è¿”å›å®¢æˆ·ç«¯ã€‚ åè°ƒèŠ‚ç‚¹ä¼šç¡®å®šå®é™…éœ€è¦è¿”å›çš„æ–‡æ¡£ï¼Œå¹¶å‘å«æœ‰è¯¥æ–‡æ¡£çš„åˆ†ç‰‡å‘é€ get è¯·æ±‚ï¼›åˆ†ç‰‡è·å–æ–‡æ¡£è¿”å›ç»™åè°ƒèŠ‚ç‚¹ï¼›åè°ƒèŠ‚ç‚¹å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ ","date":"2020-04-16","objectID":"/how-elastic-works/:3:2","tags":["es"],"title":"ElasticSearch æ˜¯å¦‚ä½•å·¥ä½œçš„","uri":"/how-elastic-works/"},{"categories":null,"content":"åˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç† èµ„æºï¼Œæœ‰æºç åˆ†æ ","date":"2020-04-16","objectID":"/how-elastic-works/:4:0","tags":["es"],"title":"ElasticSearch æ˜¯å¦‚ä½•å·¥ä½œçš„","uri":"/how-elastic-works/"},{"categories":null,"content":"ES é›†ç¾¤æ„æˆ node.master node.data ä¸¤ä¸¤ç»„åˆæˆä¸åŒçš„èŠ‚ç‚¹ ","date":"2020-04-16","objectID":"/how-elastic-works/:4:1","tags":["es"],"title":"ElasticSearch æ˜¯å¦‚ä½•å·¥ä½œçš„","uri":"/how-elastic-works/"},{"categories":null,"content":"èŠ‚ç‚¹å‘ç° ","date":"2020-04-16","objectID":"/how-elastic-works/:4:2","tags":["es"],"title":"ElasticSearch æ˜¯å¦‚ä½•å·¥ä½œçš„","uri":"/how-elastic-works/"},{"categories":null,"content":"Master é€‰ä¸¾ å¤šæ•°æ´¾åŸåˆ™ é€‰ä¸» ","date":"2020-04-16","objectID":"/how-elastic-works/:4:3","tags":["es"],"title":"ElasticSearch æ˜¯å¦‚ä½•å·¥ä½œçš„","uri":"/how-elastic-works/"},{"categories":null,"content":"references elasticsearch cheatsheet Elasticsearch Reference Elasticsearchï¼åŸºç¡€ä»‹ç»åŠç´¢å¼•åŸç†åˆ†æ Choosing a fast unique identifier (UUID) for Lucene Elasticsearchæ¶æ„åŸç† Elasticsearchæ€§èƒ½ä¼˜åŒ– ElasticSearchè¯»å†™åº•å±‚åŸç†åŠæ€§èƒ½è°ƒä¼˜ ","date":"2020-04-16","objectID":"/how-elastic-works/:5:0","tags":["es"],"title":"ElasticSearch æ˜¯å¦‚ä½•å·¥ä½œçš„","uri":"/how-elastic-works/"},{"categories":null,"content":"epoll é«˜æ€§èƒ½ network io æ¨¡å‹ ç”±äºå¤ªå¤š blog å·²ç»è®² epollï¼Œå†æ­¤å¼•ç”¨çœ‹çš„blogï¼Œä»¥åŠé¡¹ç›®ã€‚å¹¶æ ¹æ®è‡ªå·±çš„ç†è§£ï¼Œå®ç°å‡ºä¸€ä¸ª epoll å®ç°çš„ serverã€‚ TODO: éœ€è¦è·Ÿä¸€æ­¥è®¾è®¡å®ç°è·¨å¹³å°çš„åºåˆ—åŒ–ååºåˆ—åŒ–æ–¹æ¡ˆï¼Œè¿›ä¸€æ­¥å®ç°åº”ç”¨å±‚éœ€æ±‚ã€‚ ","date":"2020-04-06","objectID":"/linux_epoll/:0:0","tags":["epoll","linux"],"title":"Linux epoll","uri":"/linux_epoll/"},{"categories":null,"content":"epoll é«˜æ€§èƒ½ å¼‚æ­¥io æ¨¡å‹ï¼Œåœ¨ Linux æ˜¯ epollï¼Œmac kqueueï¼Œwindows IOCP. App: nginx, redis ","date":"2020-04-06","objectID":"/linux_epoll/:1:0","tags":["epoll","linux"],"title":"Linux epoll","uri":"/linux_epoll/"},{"categories":null,"content":"camel ä½¿ç”¨ linux epoll å®ç°çš„ socket server. ","date":"2020-04-06","objectID":"/linux_epoll/:2:0","tags":["epoll","linux"],"title":"Linux epoll","uri":"/linux_epoll/"},{"categories":null,"content":"references EPOLLçš„LINUXå†…æ ¸å·¥ä½œæœºåˆ¶ https://blog.lucode.net/linux/epoll-tutorial.html https://github.com/millken/c-example/blob/master/epoll-example.c https://www.suchprogramming.com/epoll-in-3-easy-steps/ https://medium.com/@copyconstruct/the-method-to-epolls-madness-d9d2d6378642 https://github.com/angrave/SystemProgramming/wiki/Networking,-Part-7:-Nonblocking-I-O,-select(),-and-epoll https://github.com/angrave/SystemProgramming/wiki https://jvns.ca/blog/2017/06/03/async-io-on-linux--select--poll--and-epoll simple http server base on epoll https://github.com/cloudwu/cstring ","date":"2020-04-06","objectID":"/linux_epoll/:3:0","tags":["epoll","linux"],"title":"Linux epoll","uri":"/linux_epoll/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šLatency numbers every programmer should know L1 cache reference ......................... 0.5 ns Branch mispredict ............................ 5 ns L2 cache reference ........................... 7 ns Mutex lock/unlock ........................... 25 ns Main memory reference ...................... 100 ns Compress 1K bytes with Zippy ............. 3,000 ns = 3 Âµs Send 2K bytes over 1 Gbps network ....... 20,000 ns = 20 Âµs SSD random read ........................ 150,000 ns = 150 Âµs Read 1 MB sequentially from memory ..... 250,000 ns = 250 Âµs Round trip within same datacenter ...... 500,000 ns = 0.5 ms Read 1 MB sequentially from SSD* ..... 1,000,000 ns = 1 ms Disk seek ........................... 10,000,000 ns = 10 ms Read 1 MB sequentially from disk .... 20,000,000 ns = 20 ms Send packet CA-\u003eNetherlands-\u003eCA .... 150,000,000 ns = 150 ms src 2001å¹´å¤å¤©å…¸å‹çš„1GHz PCçš„å„ç§æ“ä½œè¦èŠ±çš„æ—¶é—´ æ‰§è¡Œä¸€æ¡æŒ‡ä»¤ 1 nsec = (1/1,000,000,000) sec ä»L1 cache memory ä¸­å–ä¸€ä¸ªå­— 2 nsec ä»å†…å­˜ä¸­å–ä¸€ä¸ªå­— 10 nsec ä»ç£ç›˜çš„è¿ç»­ä½ç½®å–ä¸€ä¸ªå­— 200 nsec ä»ç£ç›˜çš„æ–°ä½ç½®å–ä¸€ä¸ªå­—(seek) 8,000,000nsec = 8msec ","date":"2019-11-30","objectID":"/how-fast-the-read-write/:0:0","tags":["os","cs"],"title":"è¯»å†™æ“ä½œåˆ°åº•æœ‰å¤šæ…¢, æ“ä½œç³»ç»Ÿç›¸å…³ä¸€äº›å‚æ•°","uri":"/how-fast-the-read-write/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šè‡ªå·±çš„ dotfiles ä¾›è‡ªå·±ä½¿ç”¨ï¼Œå‡ ä¹ä¸€é”®æ¢æœº ç®€ä»‹ ä½¿ç”¨æ–¹æ³• git clone https://github.com/exfly/dotfiles.git ~/.dotfiles cd ~/.dotfiles make preinstall-arch make bootstrap make install ","date":"2019-09-28","objectID":"/exfly-dotfiles/:0:0","tags":["tools","dev","docker"],"title":"æ•´ç†äº†ä¸€å¥— dotfiles è‡ªç”¨","uri":"/exfly-dotfiles/"},{"categories":null,"content":"å¤‡æ³¨ å¯¹äºæ‰€æœ‰çš„ *.zsh éƒ½ä¼šåŠ è½½åˆ° .zshrc ä¸­ï¼Œæ‰€æœ‰çš„ *.symlink éƒ½ä¼šå¯¹åº”çš„åœ¨$HOMEç”Ÿæˆä¸€ä¸ªè½¯è¿æ¥ .*, æ–‡ä»¶å¤¹ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡ŒåŠ è½½ã€‚ æ¯”å¦‚ zsh/zshrc.symlink ä¼šç”Ÿæˆè½¯è¿æ¥ $HOME/.zshrc,å…·ä½“å¦‚ä½•å·¥ä½œå¯ä»¥çœ‹ä¸€ä¸‹ script/bootstrap references my dotfiles ","date":"2019-09-28","objectID":"/exfly-dotfiles/:1:0","tags":["tools","dev","docker"],"title":"æ•´ç†äº†ä¸€å¥— dotfiles è‡ªç”¨","uri":"/exfly-dotfiles/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šDocker Cgroup , Namespace , union fs è¿è¡Œæœºåˆ¶ Namespaces å‘½åç©ºé—´ (namespaces) æ˜¯ Linux ä¸ºæˆ‘ä»¬æä¾›çš„ç”¨äºåˆ†ç¦»è¿›ç¨‹æ ‘ã€ç½‘ç»œæ¥å£ã€æŒ‚è½½ç‚¹ä»¥åŠè¿›ç¨‹é—´é€šä¿¡ç­‰èµ„æºçš„æ–¹æ³•. Linux çš„å‘½åç©ºé—´æœºåˆ¶æä¾›äº†ä»¥ä¸‹ä¸ƒç§ä¸åŒçš„å‘½åç©ºé—´ï¼ŒåŒ…æ‹¬ CLONE_NEWCGROUPã€CLONE_NEWIPCã€CLONE_NEWNETã€CLONE_NEWNSã€CLONE_NEWPIDã€CLONE_NEWUSER å’Œ CLONE_NEWUTS(åˆ†åˆ«å¯¹åº” Cgroup, IPC, Network, Mount, PID, User, UTS)ï¼Œé€šè¿‡è¿™ä¸ƒä¸ªé€‰é¡¹æˆ‘ä»¬èƒ½åœ¨åˆ›å»ºæ–°çš„è¿›ç¨‹æ—¶è®¾ç½®æ–°è¿›ç¨‹åº”è¯¥åœ¨å“ªäº›èµ„æºä¸Šä¸å®¿ä¸»æœºå™¨è¿›è¡Œéš”ç¦»ã€‚ the Network namespace encapsulates system resources related to networking such as network interfaces (e.g wlan0, eth0), route tables etc, the Mount namespace encapsulates files and directories in the system, PID contains process IDs and so on. So two instances of a Network namespace A and B (corresponding to two boxes of the same type in our analogy) can contain different resources - maybe A contains wlan0 while B contains eth0 and a different route table copy â€“ related $ ls -l /proc/$$/ns total 0 lrwxrwxrwx 1 vagrant vagrant 0 Sep 19 00:46 cgroup -\u003e 'cgroup:[4026531835]' lrwxrwxrwx 1 vagrant vagrant 0 Sep 19 00:46 ipc -\u003e 'ipc:[4026531839]' lrwxrwxrwx 1 vagrant vagrant 0 Sep 19 00:46 mnt -\u003e 'mnt:[4026531840]' lrwxrwxrwx 1 vagrant vagrant 0 Sep 19 00:46 net -\u003e 'net:[4026531992]' lrwxrwxrwx 1 vagrant vagrant 0 Sep 19 00:46 pid -\u003e 'pid:[4026531836]' lrwxrwxrwx 1 vagrant vagrant 0 Sep 19 00:46 pid_for_children -\u003e 'pid:[4026531836]' lrwxrwxrwx 1 vagrant vagrant 0 Sep 19 00:46 user -\u003e 'user:[4026531837]' lrwxrwxrwx 1 vagrant vagrant 0 Sep 19 00:46 uts -\u003e 'uts:[4026531838]' $ sudo unshare -u bash $ ls -l /proc/$$/ns total 0 lrwxrwxrwx 1 root root 0 Sep 19 01:00 cgroup -\u003e 'cgroup:[4026531835]' lrwxrwxrwx 1 root root 0 Sep 19 01:00 ipc -\u003e 'ipc:[4026531839]' lrwxrwxrwx 1 root root 0 Sep 19 01:00 mnt -\u003e 'mnt:[4026531840]' lrwxrwxrwx 1 root root 0 Sep 19 01:00 net -\u003e 'net:[4026531992]' lrwxrwxrwx 1 root root 0 Sep 19 01:00 pid -\u003e 'pid:[4026531836]' lrwxrwxrwx 1 root root 0 Sep 19 01:00 pid_for_children -\u003e 'pid:[4026531836]' lrwxrwxrwx 1 root root 0 Sep 19 01:00 user -\u003e 'user:[4026531837]' lrwxrwxrwx 1 root root 0 Sep 19 01:00 uts -\u003e 'uts:[4026532239]' unshare ä¼šåœ¨ä¸€ä¸ªæ–°çš„ namespace æ‰§è¡Œæ–°çš„ç¨‹åºï¼Œflag -u æŒ‡å®šæ–°çš„ UTS namespace, sudo unshare -u bashå³æ˜¯åœ¨æ–°çš„UTSå‘½åç©ºé—´æ‰§è¡Œ bash linux ä»¥é»˜è®¤çš„ namespace å¯åŠ¨æ–°çš„ç¨‹åºï¼Œé™¤éæ˜ç¡®çš„æŒ‡å®š ","date":"2019-09-17","objectID":"/comtainerd-cgroup-namespace/:0:0","tags":["cgroup","namespace"],"title":"Comtainerd Cgroup Namespace","uri":"/comtainerd-cgroup-namespace/"},{"categories":null,"content":"user namespace P$ Q$ ä¸åŒçš„å­—æ¯ä»£è¡¨ä¸åŒçš„ user namespace P$ whoami vagrant P$ id uid=1000(vagrant) gid=1000(vagrant) groups=1000(vagrant),977(docker) P$ unshare -U bash # Enter a new shell that runs within a nested user namespace, the shell is bash which is your cmd shell C$ id uid=65534(nobody) gid=65534(nobody) groups=65534(nobody) C$ ls -l ","date":"2019-09-17","objectID":"/comtainerd-cgroup-namespace/:1:0","tags":["cgroup","namespace"],"title":"Comtainerd Cgroup Namespace","uri":"/comtainerd-cgroup-namespace/"},{"categories":null,"content":"/proc/$pid/uid_map the map file /proc/$pid/uid_map returns a mapping from UIDs in the user namespace to which the process pid belongsï¼Œ user_namespace linux man page æ¯ä¸€è¡Œçš„æ ¼å¼ä¸º $fromID $toID $lengthï¼Œ C$ echo $$ 8683 # æ–°çš„ PID P$ echo $$ 7898 # åŸå§‹ PID C$ cat /proc/8683/uid_map C$ cat /proc/7898/uid_map 0 0 4294967295 P$ id uid=1000(vagrant) gid=1000(vagrant) groups=1000(vagrant),977(docker) P$ ip link add type veth RTNETLINK answers: Operation not permitted # åœ¨ä¸€ä¸ªä¸åŒçš„username å’Œ net namespaceä¸­å°è¯• P$ unshare -nU bash C$ ip link add type veth RTNETLINK answers: Operation not permitted C$ echo $$ 9078 P$ echo \"0 1000 1\" \u003e /proc/9078/uid_map C$ id uid=0(root) gid=65534(nobody) groups=65534(nobody) C$ ip link add type veth # Success! P$ echo deny \u003e /proc/9078/setgroups P$ echo \"0 1000 1\" \u003e /proc/9078/gid_map C$ id uid=0(root) gid=0(root) groups=0(root),65534(nobody) ","date":"2019-09-17","objectID":"/comtainerd-cgroup-namespace/:1:1","tags":["cgroup","namespace"],"title":"Comtainerd Cgroup Namespace","uri":"/comtainerd-cgroup-namespace/"},{"categories":null,"content":"mount namespace cat /proc/$$/mounts proc /proc proc rw,nosuid,nodev,noexec,relatime 0 0 sys /sys sysfs rw,nosuid,nodev,noexec,relatime 0 0 dev /dev devtmpfs rw,nosuid,relatime,size=496792k,nr_inodes=124198,mode=755 0 0 run /run tmpfs rw,nosuid,nodev,relatime,mode=755 0 0 /dev/sda2 / btrfs rw,relatime,space_cache,subvolid=5,subvol=/ 0 0 securityfs /sys/kernel/security securityfs rw,nosuid,nodev,noexec,relatime 0 0 tmpfs /dev/shm tmpfs rw,nosuid,nodev 0 0 devpts /dev/pts devpts rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000 0 0 tmpfs /sys/fs/cgroup tmpfs ro,nosuid,nodev,noexec,mode=755 0 0 cgroup2 /sys/fs/cgroup/unified cgroup2 rw,nosuid,nodev,noexec,relatime,nsdelegate 0 0 cgroup /sys/fs/cgroup/systemd cgroup rw,nosuid,nodev,noexec,relatime,xattr,name=systemd 0 0 pstore /sys/fs/pstore pstore rw,nosuid,nodev,noexec,relatime 0 0 bpf /sys/fs/bpf bpf rw,nosuid,nodev,noexec,relatime,mode=700 0 0 cgroup /sys/fs/cgroup/cpuset cgroup rw,nosuid,nodev,noexec,relatime,cpuset 0 0 cgroup /sys/fs/cgroup/pids cgroup rw,nosuid,nodev,noexec,relatime,pids 0 0 cgroup /sys/fs/cgroup/perf_event cgroup rw,nosuid,nodev,noexec,relatime,perf_event 0 0 cgroup /sys/fs/cgroup/net_cls,net_prio cgroup rw,nosuid,nodev,noexec,relatime,net_cls,net_prio 0 0 cgroup /sys/fs/cgroup/rdma cgroup rw,nosuid,nodev,noexec,relatime,rdma 0 0 cgroup /sys/fs/cgroup/freezer cgroup rw,nosuid,nodev,noexec,relatime,freezer 0 0 cgroup /sys/fs/cgroup/cpu,cpuacct cgroup rw,nosuid,nodev,noexec,relatime,cpu,cpuacct 0 0 cgroup /sys/fs/cgroup/devices cgroup rw,nosuid,nodev,noexec,relatime,devices 0 0 cgroup /sys/fs/cgroup/blkio cgroup rw,nosuid,nodev,noexec,relatime,blkio 0 0 cgroup /sys/fs/cgroup/memory cgroup rw,nosuid,nodev,noexec,relatime,memory 0 0 cgroup /sys/fs/cgroup/hugetlb cgroup rw,nosuid,nodev,noexec,relatime,hugetlb 0 0 hugetlbfs /dev/hugepages hugetlbfs rw,relatime,pagesize=2M 0 0 configfs /sys/kernel/config configfs rw,nosuid,nodev,noexec,relatime 0 0 systemd-1 /proc/sys/fs/binfmt_misc autofs rw,relatime,fd=46,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pipe_ino=10711 0 0 mqueue /dev/mqueue mqueue rw,nosuid,nodev,noexec,relatime 0 0 debugfs /sys/kernel/debug debugfs rw,nosuid,nodev,noexec,relatime 0 0 tmpfs /tmp tmpfs rw,nosuid,nodev 0 0 tmpfs /run/user/1000 tmpfs rw,nosuid,nodev,relatime,size=100836k,mode=700,uid=1000,gid=1000 0 0 vagrant /vagrant vboxsf rw,relatime 0 0 mount point $ unshare -m bash $ cat /proc/$$/mounts /dev/sda2 / btrfs rw,relatime,space_cache,subvolid=5,subvol=/ 0 0 dev /dev devtmpfs rw,nosuid,relatime,size=496792k,nr_inodes=124198,mode=755 0 0 tmpfs /dev/shm tmpfs rw,nosuid,nodev 0 0 devpts /dev/pts devpts rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000 0 0 hugetlbfs /dev/hugepages hugetlbfs rw,relatime,pagesize=2M 0 0 mqueue /dev/mqueue mqueue rw,nosuid,nodev,noexec,relatime 0 0 proc /proc proc rw,nosuid,nodev,noexec,relatime 0 0 systemd-1 /proc/sys/fs/binfmt_misc autofs rw,relatime,fd=46,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pipe_ino=10711 0 0 sys /sys sysfs rw,nosuid,nodev,noexec,relatime 0 0 securityfs /sys/kernel/security securityfs rw,nosuid,nodev,noexec,relatime 0 0 tmpfs /sys/fs/cgroup tmpfs ro,nosuid,nodev,noexec,mode=755 0 0 cgroup2 /sys/fs/cgroup/unified cgroup2 rw,nosuid,nodev,noexec,relatime,nsdelegate 0 0 cgroup /sys/fs/cgroup/systemd cgroup rw,nosuid,nodev,noexec,relatime,xattr,name=systemd 0 0 cgroup /sys/fs/cgroup/cpuset cgroup rw,nosuid,nodev,noexec,relatime,cpuset 0 0 cgroup /sys/fs/cgroup/pids cgroup rw,nosuid,nodev,noexec,relatime,pids 0 0 cgroup /sys/fs/cgroup/perf_event cgroup rw,nosuid,nodev,noexec,relatime,perf_event 0 0 cgroup /sys/fs/cgroup/net_cls,net_prio cgroup rw,nosuid,nodev,noexec,relatime,net_cls,net_prio 0 0 cgroup /sys/fs/cgroup/rdma cgroup rw,nosuid,nodev,noexec,relatime,rdma 0 0 cgroup /sys/fs/cgroup/freezer cgroup rw,nosuid,nodev,noexec,relatime,freezer 0 0 cgroup /sys/fs/cgroup/cpu,cpuacct cgroup rw,nosuid,nodev,noexec,relatime,cpu,cpuacct 0 0 cgroup /sys/fs/cgroup/devices cgroup rw,nos","date":"2019-09-17","objectID":"/comtainerd-cgroup-namespace/:1:2","tags":["cgroup","namespace"],"title":"Comtainerd Cgroup Namespace","uri":"/comtainerd-cgroup-namespace/"},{"categories":null,"content":"è¿›ç¨‹ $ ps -ef UID PID PPID C STIME TTY TIME CMD root 1 0 0 01:17 ? 00:00:00 /sbin/init root 2 0 0 01:17 ? 00:00:00 [kthreadd] root 3 2 0 01:17 ? 00:00:00 [rcu_gp] root 4 2 0 01:17 ? 00:00:00 [rcu_par_gp] root 5 2 0 01:17 ? 00:00:00 [kworker/0:0-events] root 6 2 0 01:17 ? 00:00:00 [kworker/0:0H-kblockd] root 7 2 0 01:17 ? 00:00:00 [kworker/u4:0-btrfs-endio-write] root 8 2 0 01:17 ? 00:00:00 [mm_percpu_wq] æœ‰ä¸¤ä¸ªè¿›ç¨‹å¾ˆç‰¹æ®Šï¼Œpid={1,2}, è¿™ä¸¤ä¸ªè¿›ç¨‹éƒ½æ˜¯è¢« Linux ä¸­çš„ä¸Šå¸è¿›ç¨‹ idle åˆ›å»ºå‡ºæ¥çš„ pid=1 çš„ /sbin/init, æ‰§è¡Œå†…æ ¸çš„ä¸€éƒ¨åˆ†åˆå§‹åŒ–å·¥ä½œå’Œç³»ç»Ÿé…ç½®ï¼Œä¹Ÿä¼šåˆ›å»ºä¸€äº›ç±»ä¼¼ getty çš„æ³¨å†Œè¿›ç¨‹ pid=2 çš„kthreadd, ç®¡ç†å’Œè°ƒåº¦å…¶ä»–çš„å†…æ ¸è¿›ç¨‹ ","date":"2019-09-17","objectID":"/comtainerd-cgroup-namespace/:2:0","tags":["cgroup","namespace"],"title":"Comtainerd Cgroup Namespace","uri":"/comtainerd-cgroup-namespace/"},{"categories":null,"content":"ç½‘ç»œ åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸€ä¸ªå®¹å™¨åœ¨åˆ›å»ºæ—¶éƒ½ä¼šåˆ›å»ºä¸€å¯¹è™šæ‹Ÿç½‘å¡ï¼Œä¸¤ä¸ªè™šæ‹Ÿç½‘å¡ç»„æˆäº†æ•°æ®çš„é€šé“ï¼Œå…¶ä¸­ä¸€ä¸ªä¼šæ”¾åœ¨åˆ›å»ºçš„å®¹å™¨ä¸­ï¼Œä¼šåŠ å…¥åˆ°åä¸º docker0 ç½‘æ¡¥ä¸­ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ç½‘æ¡¥çš„æ¥å£ï¼š $ brctl show bridge name bridge id STP enabled interfaces br-43ee5ed53f84 8000.024297630322 no docker0 8000.0242bf0282f8 no docker0 ä¼šä¸ºæ¯ä¸€ä¸ªå®¹å™¨åˆ†é…ä¸€ä¸ªæ–°çš„ IP åœ°å€å¹¶å°† docker0 çš„ IP åœ°å€è®¾ç½®ä¸ºé»˜è®¤çš„ç½‘å…³ã€‚ç½‘æ¡¥ docker0 é€šè¿‡ iptables ä¸­çš„é…ç½®ä¸å®¿ä¸»æœºå™¨ä¸Šçš„ç½‘å¡ç›¸è¿ï¼Œæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è¯·æ±‚éƒ½ä¼šé€šè¿‡ iptables è½¬å‘åˆ° docker0 å¹¶ç”±ç½‘æ¡¥åˆ†å‘ç»™å¯¹åº”çš„æœºå™¨ã€‚ $ iptables -t nat -L Chain PREROUTING (policy ACCEPT) target prot opt source destination DOCKER all -- anywhere anywhere ADDRTYPE match dst-type LOCAL Chain DOCKER (2 references) target prot opt source destination RETURN all -- anywhere anywhere ip $ ip link list 1: lo: \u003cLOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 2: eth0: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000 link/ether 08:00:27:d4:b6:c8 brd ff:ff:ff:ff:ff:ff 3: eth1: \u003cBROADCAST,MULTICAST\u003e mtu 1500 qdisc fq_codel state DOWN mode DEFAULT group default qlen 1000 link/ether 08:00:27:b7:f5:14 brd ff:ff:ff:ff:ff:ff $ ip netns add coke $ ip netns list coke ip netns list åªæ˜¾ç¤ºå‘½åçš„ netnsï¼Œåˆå§‹ netns æ˜¯éå‘½å netnsã€‚å¹¶ä¸”æ¯ä¸€ä¸ªå‘½å netns éƒ½ä¼šåœ¨/var/run/netnsåˆ›å»ºåŒåæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥è®©è¿›ç¨‹åˆ‡æ¢åˆ°æ­¤ netns C$ ä»£è¡¨åœ¨ä¸€ä¸ªå­å‘½åç©ºé—´ä¸­æ‰§è¡Œ $ ip netns exec coke bash C$ ip link list 1: lo: \u003cLOOPBACK\u003e mtu 65536 qdisc noop state DOWN mode DEFAULT group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 C$ ping 127.0.0.1 connect: Network is unreachable C$ ip link set dev lo up C$ ip link list 1: lo: \u003cLOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 C$ ping 127.0.0.1 # OK ç°åœ¨åœ¨æ­¤ netns ä¸­åªå¯ä»¥ä¸åŒ netns çš„è¿›ç¨‹è¿›è¡Œæ²Ÿé€š(localhost),æˆ‘ä»¬å¯ä»¥å°è¯•ä¸ init netns çš„ç¨‹åºè¿›è¡Œæ²Ÿé€š ","date":"2019-09-17","objectID":"/comtainerd-cgroup-namespace/:3:0","tags":["cgroup","namespace"],"title":"Comtainerd Cgroup Namespace","uri":"/comtainerd-cgroup-namespace/"},{"categories":null,"content":"Veth Devices $ ip link add veth0 type veth peer name veth1 # # Create a veth pair (veth0 \u003c=\u003e veth1) $ ip link set veth1 netns coke # # Move the veth1 end to the new namespace C$ ip link list 1: lo: \u003cLOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 7: veth1@if5: \u003cBROADCAST,MULTICAST\u003e mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000 link/ether ee:16:0c:23:f3:af brd ff:ff:ff:ff:ff:ff link-netnsid 0 $ ip addr add 10.1.1.1/24 dev veth0 ç°åœ¨ veth1 è®¾å¤‡å·²ç»å¯ä»¥åœ¨ä¸¤ä¸ª netns ä¸­çœ‹åˆ°ï¼Œä¸ºäº†æ˜¯ä»–ä»¬éƒ½å¯ä»¥å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦ç»™å®ƒä»¬ä¸¤ä¸ªip addresses å’Œè®©interface up $ ip addr add 10.1.1.1/24 dev veth0 # In the initial namespace $ ip link set dev veth0 up C$ ip addr add 10.1.1.2/24 dev veth1 # # In the coke namespace C$ ip link set dev veth1 up C$ ip addr show veth1 4: veth1@if5: \u003cBROADCAST,MULTICAST,UP,LOWER_UP\u003e mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 1a:e7:9f:4e:d4:db brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 10.1.1.2/24 scope global veth1 valid_lft forever preferred_lft forever inet6 fe80::18e7:9fff:fe4e:d4db/64 scope link valid_lft forever preferred_lft forever ç°åœ¨ veth0 å’Œ veth1 å·²ç» up å’Œèµ‹äºˆäº† ip address 10.1.1.1 10.1.1.2 $ ping -I veth0 10.1.1.2 C$ ping 10.1.1.1 ","date":"2019-09-17","objectID":"/comtainerd-cgroup-namespace/:3:1","tags":["cgroup","namespace"],"title":"Comtainerd Cgroup Namespace","uri":"/comtainerd-cgroup-namespace/"},{"categories":null,"content":"netlink ","date":"2019-09-17","objectID":"/comtainerd-cgroup-namespace/:3:2","tags":["cgroup","namespace"],"title":"Comtainerd Cgroup Namespace","uri":"/comtainerd-cgroup-namespace/"},{"categories":null,"content":"libnetwork ","date":"2019-09-17","objectID":"/comtainerd-cgroup-namespace/:3:3","tags":["cgroup","namespace"],"title":"Comtainerd Cgroup Namespace","uri":"/comtainerd-cgroup-namespace/"},{"categories":null,"content":"chroot https://www.ibm.com/developerworks/cn/linux/l-cn-chroot/index.html CGroups https://www.ibm.com/developerworks/cn/linux/1506_cgroup/index.html UnionFS docker export $(docker create busybox) | tar -C rootfs -xvf - AUFS overlay2 æŸ¥çœ‹ç³»ç»Ÿæ˜¯å¦æ”¯æŒç›¸åº”çš„æ–‡ä»¶ç³»ç»Ÿ $ uname -a Linux archlinux 5.1.15-arch1-1-ARCH #1 SMP PREEMPT Tue Jun 25 04:49:39 UTC 2019 x86_64 GNU/Linux $ grep btrfs /proc/filesystems btrfs æœ‰ä¸€äº›ç³»ç»Ÿè¿™ç§æ–¹å¼æ‰¾ä¸åˆ°å¯¹åº”çš„ç³»ç»Ÿï¼Œä½†æ˜¯åŒæ ·æ”¯æŒæ­¤æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚ archlinux å‘è¡Œç‰ˆï¼ŒOverlay_filesystem, overlay-docker-doc $ mkdir b0 b1 b2 upper work merged $ mount -t overlay overlay -o lowerdir=./b0:./b1:./b2,upperdir=./upper,workdir=./work ./merged overlay2 å°† lowerdirã€upperdirã€workdir è”åˆæŒ‚è½½ï¼Œå½¢æˆæœ€ç»ˆçš„ merged æŒ‚è½½ç‚¹ï¼Œå…¶ä¸­ lowerdir æ˜¯é•œåƒåªè¯»å±‚ï¼Œupperdir æ˜¯å®¹å™¨å¯è¯»å¯å†™å±‚ï¼Œworkdir æ˜¯æ‰§è¡Œæ¶‰åŠä¿®æ”¹ lowerdir æ‰§è¡Œ copy_up æ“ä½œçš„ä¸­è½¬å±‚ï¼ˆä¾‹å¦‚ï¼Œupperdir ä¸­ä¸å­˜åœ¨ï¼Œéœ€è¦ä» lowerdir ä¸­è¿›è¡Œå¤åˆ¶ï¼Œè¯¥è¿‡ç¨‹æš‚æœªè¯¦ç»†äº†è§£ï¼Œé‡åˆ°äº†å†åˆ†æï¼‰ $ tree . â”œâ”€â”€ b0 â”œâ”€â”€ b1 â”œâ”€â”€ b2 â”œâ”€â”€ merged â”œâ”€â”€ README.md â”œâ”€â”€ upper â””â”€â”€ work â”œâ”€â”€ index â””â”€â”€ work è·å¾—çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯æœ‰å±‚æ¬¡çš„ï¼Œå½“å‰çš„å±‚æ¬¡å…³ç³»ä¸ºï¼š /upper /b0 /b1 /b2 $ echo '192.168.0.1' \u003e b0/ip.txt $ tree . â”œâ”€â”€ b0 â”‚Â â””â”€â”€ ip.txt â”œâ”€â”€ b1 â”œâ”€â”€ b2 â”œâ”€â”€ merged â”‚Â â””â”€â”€ ip.txt â”œâ”€â”€ README.md â”œâ”€â”€ upper â””â”€â”€ work â”œâ”€â”€ index â””â”€â”€ work $ cat merged/ip.txt 192.168.0.1 $ echo '192.168.0.2' \u003e merged/ip.txt $ tree . â”œâ”€â”€ b0 â”‚Â â””â”€â”€ ip.txt â”œâ”€â”€ b1 â”œâ”€â”€ b2 â”œâ”€â”€ merged â”‚Â â””â”€â”€ ip.txt â”œâ”€â”€ README.md â”œâ”€â”€ upper â”‚Â â””â”€â”€ ip.txt â””â”€â”€ work â”œâ”€â”€ index â””â”€â”€ work $ cat upper/ip.txt 192.168.0.2 $ echo '192.168.0.3' \u003e upper/ip.txt $ cat merged/ip.txt 192.168.0.3 $ rm -rf merged/ip.txt $ tree . â”œâ”€â”€ b0 â”‚Â â””â”€â”€ ip.txt â”œâ”€â”€ b1 â”‚Â â””â”€â”€ ip.txt â”œâ”€â”€ b2 â”œâ”€â”€ merged â”œâ”€â”€ README.md â”œâ”€â”€ upper â”‚Â â””â”€â”€ ip.txt â””â”€â”€ work â”œâ”€â”€ index â””â”€â”€ work $ ls upper/ip.txt c--------- 1 root root 0, 0 Sep 18 04:35 upper/ip.txt references container-lab https://draveness.me/docker è°ƒè¯•ç½‘ç»œ docker run -it --net container:vibrant_blackburn nicolaka/netshoot https://www.kernel.org/doc/Documentation/filesystems/overlayfs.txt overlayfsçš„ä¸€äº›é™åˆ¶/å…¼å®¹æ€§é—®é¢˜ linux-namespace-isolate-programing æœ‰ä¸€ä¸ªä¾‹å­ç¨‹åº Namespaces in operation cgroup/linux-man-page user-namespace/linum-man-page mount namespaces proc special filesystem management ip netns ip command cheatsheet veth Netlink-doc man netlink A deep dive into Linux namespaces 100 ä¸ªå®¹å™¨å‘¨è¾¹é¡¹ç›®ï¼Œç‚¹äº®ä½ çš„å®¹å™¨é›†ç¾¤æŠ€èƒ½æ ‘ ","date":"2019-09-17","objectID":"/comtainerd-cgroup-namespace/:4:0","tags":["cgroup","namespace"],"title":"Comtainerd Cgroup Namespace","uri":"/comtainerd-cgroup-namespace/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šæ•´ç† Git å­¦ä¹ èµ„æº TODO references å›¾è§£ Git Git äº¤äº’å¼å­¦ä¹ ç¯å¢ƒ-æ¼”ç¤º Git äº¤äº’å¼å­¦ä¹ ç¯å¢ƒ-å­¦ä¹ ä¸­ä½¿ç”¨ Google Engineering Practices Documentation Conventional Commits æœ‰å·¥å…·å¯ä»¥ç”Ÿæˆ changelog ","date":"2019-09-09","objectID":"/share-git-resources/:0:0","tags":["å·¥å…·","ç”Ÿäº§åŠ›"],"title":"æ•´ç† Git å­¦ä¹ èµ„æº","uri":"/share-git-resources/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¸­éœ€è¦è§£å†³çš„é—®é¢˜ ç½‘ç»œé€šä¿¡å¯èƒ½ä¼šåŒ…å«ï¼ŒæˆåŠŸã€å¤±è´¥ä»¥åŠè¶…æ—¶ä¸‰ç§æƒ…å†µ ","date":"2019-07-29","objectID":"/problems-mq-need-to-be-solved/:0:0","tags":["æ¶ˆæ¯é˜Ÿåˆ—","Architecture","Distributed"],"title":"æ¶ˆæ¯é˜Ÿåˆ—ä¸­éœ€è¦è§£å†³çš„é—®é¢˜","uri":"/problems-mq-need-to-be-solved/"},{"categories":null,"content":"æ¶ˆæ¯æŠ•é€’è¯­ä¹‰ æœ€å¤šä¸€æ¬¡ï¼ˆAt-Most Onceï¼‰ã€æœ€å°‘ä¸€æ¬¡ï¼ˆAt-Least Onceï¼‰ä»¥åŠæ°å¥½ä¸€æ¬¡ï¼ˆExactly Onceï¼‰ æœ€å¤šä¸€æ¬¡åœ¨ TCP/UDP ä¼ è¾“å±‚åè®®å°±æ˜¯ä¿è¯æœ€å¤šä¸€æ¬¡æ¶ˆæ¯æŠ•é€’ï¼Œæ¶ˆæ¯çš„å‘é€è€…åªä¼šå°è¯•å‘é€è¯¥æ¶ˆæ¯ä¸€æ¬¡ï¼Œå¹¶ä¸ä¼šå…³å¿ƒè¯¥æ¶ˆæ¯æ˜¯å¦å¾—åˆ°äº†è¿œç¨‹èŠ‚ç‚¹çš„å“åº”ã€‚ æœ€å°‘ä¸€æ¬¡å¼•å…¥è¶…æ—¶é‡è¯•çš„æœºåˆ¶ã€‚åŒæ—¶å¼•å…¥æ–°çš„é—®é¢˜ï¼Œæ¶ˆæ¯é‡å¤ã€‚ æ°å¥½ä¸€æ¬¡ä»ç†è®ºä¸Šæ¥è¯´ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æƒ³è¦è§£å†³æ¶ˆæ¯é‡å¤çš„é—®é¢˜æ˜¯ä¸å¯èƒ½çš„ï¼Œå¾ˆå¤šæ¶ˆæ¯æœåŠ¡æä¾›äº†æ­£å¥½ä¸€æ¬¡çš„ QoS å…¶å®æ˜¯åœ¨æ¥æ”¶ç«¯è¿›è¡Œäº†å»é‡ã€‚ ","date":"2019-07-29","objectID":"/problems-mq-need-to-be-solved/:1:0","tags":["æ¶ˆæ¯é˜Ÿåˆ—","Architecture","Distributed"],"title":"æ¶ˆæ¯é˜Ÿåˆ—ä¸­éœ€è¦è§£å†³çš„é—®é¢˜","uri":"/problems-mq-need-to-be-solved/"},{"categories":null,"content":"æŠ•é€’é¡ºåº ç”±äºä¸€äº›ç½‘ç»œçš„é—®é¢˜ï¼Œæ¶ˆæ¯åœ¨æŠ•é€’æ—¶å¯èƒ½ä¼šå‡ºç°é¡ºåºä¸ä¸€è‡´æ€§çš„æƒ…å†µï¼Œåœ¨ç½‘ç»œæ¡ä»¶éå¸¸ä¸ç¨³å®šæ—¶ï¼Œæˆ‘ä»¬å°±å¯èƒ½ä¼šé‡åˆ°æ¥æ”¶æ–¹å¤„ç†æ¶ˆæ¯çš„é¡ºåºå’Œç”Ÿäº§è€…æŠ•é€’çš„ä¸ä¸€è‡´ï¼›æ¶ˆè´¹è€…å°±éœ€è¦å¯¹é¡ºåºä¸ä¸€è‡´çš„æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œå¸¸è§çš„ä¸¤ç§æ–¹å¼å°±æ˜¯ä½¿ç”¨åºåˆ—å·æˆ–è€…çŠ¶æ€æœºã€‚ ","date":"2019-07-29","objectID":"/problems-mq-need-to-be-solved/:2:0","tags":["æ¶ˆæ¯é˜Ÿåˆ—","Architecture","Distributed"],"title":"æ¶ˆæ¯é˜Ÿåˆ—ä¸­éœ€è¦è§£å†³çš„é—®é¢˜","uri":"/problems-mq-need-to-be-solved/"},{"categories":null,"content":"åºåˆ—å· ç”¨é˜»å¡çš„æ–¹å¼ä¿è¯åºåˆ—å·çš„é€’å¢æˆ–è€…å¿½ç•¥éƒ¨åˆ†ã€è¿‡æœŸã€çš„æ¶ˆæ¯ã€‚ ","date":"2019-07-29","objectID":"/problems-mq-need-to-be-solved/:2:1","tags":["æ¶ˆæ¯é˜Ÿåˆ—","Architecture","Distributed"],"title":"æ¶ˆæ¯é˜Ÿåˆ—ä¸­éœ€è¦è§£å†³çš„é—®é¢˜","uri":"/problems-mq-need-to-be-solved/"},{"categories":null,"content":"çŠ¶æ€æœº è™½ç„¶æ¶ˆæ¯æŠ•é€’çš„é¡ºåºæ˜¯ä¹±åºçš„ï¼Œä½†æ˜¯èµ„æºæœ€ç»ˆè¿˜æ˜¯é€šè¿‡çŠ¶æ€æœºè¾¾åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„æ­£ç¡®çŠ¶æ€ï¼Œä¸ä¼šå‡ºç°ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ ","date":"2019-07-29","objectID":"/problems-mq-need-to-be-solved/:2:2","tags":["æ¶ˆæ¯é˜Ÿåˆ—","Architecture","Distributed"],"title":"æ¶ˆæ¯é˜Ÿåˆ—ä¸­éœ€è¦è§£å†³çš„é—®é¢˜","uri":"/problems-mq-need-to-be-solved/"},{"categories":null,"content":"åè®® AMQPï¼š StormMQã€RabbitMQï¼Œ æ”¯æŒæœ€å¤šä¸€æ¬¡å’Œæœ€å°‘ä¸€æ¬¡çš„æŠ•é€’è¯­ä¹‰ï¼Œå½“æˆ‘ä»¬é€‰æ‹©æœ€å°‘ä¸€æ¬¡æ—¶ï¼Œéœ€è¦å¹‚ç­‰æˆ–è€…é‡å…¥æœºåˆ¶ä¿è¯æ¶ˆæ¯é‡å¤ä¸ä¼šå‡ºç°é—®é¢˜ã€‚ MQTT ","date":"2019-07-29","objectID":"/problems-mq-need-to-be-solved/:3:0","tags":["æ¶ˆæ¯é˜Ÿåˆ—","Architecture","Distributed"],"title":"æ¶ˆæ¯é˜Ÿåˆ—ä¸­éœ€è¦è§£å†³çš„é—®é¢˜","uri":"/problems-mq-need-to-be-solved/"},{"categories":null,"content":"reference åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°åŸç† åˆ†å¸ƒå¼ç³»ç»Ÿä¸æ¶ˆæ¯çš„æŠ•é€’ æµ…è°ˆæ•°æ®åº“å¹¶å‘æ§åˆ¶ - é”å’Œ MVCC æ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡çš„ç²¾é«“åŸºæœ¬éƒ½è—åœ¨æœ¬æ–‡é‡Œäº† æ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡ç²¾è¦ æ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡ç²¾è¦ ","date":"2019-07-29","objectID":"/problems-mq-need-to-be-solved/:4:0","tags":["æ¶ˆæ¯é˜Ÿåˆ—","Architecture","Distributed"],"title":"æ¶ˆæ¯é˜Ÿåˆ—ä¸­éœ€è¦è§£å†³çš„é—®é¢˜","uri":"/problems-mq-need-to-be-solved/"},{"categories":null,"content":"ã€Šå¾®æœåŠ¡è®¾è®¡ã€‹å­¦ä¹ ç¬”è®°ï¼šé«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡ï¼Œæœ‰å“ªäº›é—®é¢˜éœ€è¦è§£å†³ ","date":"2019-07-07","objectID":"/microservicedesign/:0:0","tags":["Architecture","å¾®æœåŠ¡","åˆ†å¸ƒå¼","ç¬”è®°"],"title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","uri":"/microservicedesign/"},{"categories":null,"content":"ä»€ä¹ˆæ˜¯é«˜å¯ç”¨ç³»ç»Ÿ å…³äºé«˜å¯ç”¨çš„ç³»ç»Ÿ ","date":"2019-07-07","objectID":"/microservicedesign/:1:0","tags":["Architecture","å¾®æœåŠ¡","åˆ†å¸ƒå¼","ç¬”è®°"],"title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","uri":"/microservicedesign/"},{"categories":null,"content":"é«˜å¯ç”¨ç³»ç»Ÿéœ€è¦è§£å†³çš„é—®é¢˜ ","date":"2019-07-07","objectID":"/microservicedesign/:2:0","tags":["Architecture","å¾®æœåŠ¡","åˆ†å¸ƒå¼","ç¬”è®°"],"title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","uri":"/microservicedesign/"},{"categories":null,"content":"æŒ‘æˆ˜ æˆå€çš„ API æ•°é‡ å¼•å…¥ç½‘ç»œå»¶è¿Ÿ CAP ç†è®ºï¼Œå¤„ç†è·¨å¤šä¸ªæœåŠ¡çš„äº‹åŠ¡å¤æ‚ è°ƒè¯•åˆ†å¸ƒå¼ç³»ç»Ÿååˆ†å¤æ‚ æœåŠ¡é›ªå´© å¤§é‡è¯·æ±‚å †ç§¯ï¼Œæ•…éšœæ¢å¤æ…¢ å¾®æœåŠ¡æŠ€æœ¯é€‰å‹ API ç‰ˆæœ¬ç®¡ç†æ··ä¹± TCCã€äº‹åŠ¡æ¶ˆæ¯é˜Ÿåˆ— ","date":"2019-07-07","objectID":"/microservicedesign/:2:1","tags":["Architecture","å¾®æœåŠ¡","åˆ†å¸ƒå¼","ç¬”è®°"],"title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","uri":"/microservicedesign/"},{"categories":null,"content":"éœ€è¦åšçš„äº‹ å¯æ‰©å±•ï¼šæ°´å¹³æ‰©å±•ã€å‚ç›´æ‰©å±•ã€‚ é€šè¿‡å†—ä½™éƒ¨ç½²ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚ éš”ç¦»ï¼šé¿å…å•ä¸€ä¸šåŠ¡å ç”¨å…¨éƒ¨èµ„æºã€‚é¿å…ä¸šåŠ¡ä¹‹é—´çš„ç›¸äº’å½±å“ 2. æœºæˆ¿éš”ç¦»é¿å…å•ç‚¹æ•…éšœã€‚ è§£è€¦ï¼šé™ä½ç»´æŠ¤æˆæœ¬ï¼Œé™ä½è€¦åˆé£é™©ã€‚å‡å°‘ä¾èµ–ï¼Œå‡å°‘ç›¸äº’é—´çš„å½±å“ã€‚ é™æµï¼šæ»‘åŠ¨çª—å£è®¡æ•°æ³•ã€æ¼æ¡¶ç®—æ³•ã€ä»¤ç‰Œæ¡¶ç®—æ³•ç­‰ç®—æ³•ã€‚é‡åˆ°çªå‘æµé‡æ—¶ï¼Œä¿è¯ç³»ç»Ÿç¨³å®šã€‚ é™çº§ï¼šç´§æ€¥æƒ…å†µä¸‹é‡Šæ”¾éæ ¸å¿ƒåŠŸèƒ½çš„èµ„æºã€‚ç‰ºç‰²éæ ¸å¿ƒä¸šåŠ¡ï¼Œä¿è¯æ ¸å¿ƒä¸šåŠ¡çš„é«˜å¯ç”¨ã€‚ ç†”æ–­ï¼šå¼‚å¸¸æƒ…å†µè¶…å‡ºé˜ˆå€¼è¿›å…¥ç†”æ–­çŠ¶æ€ï¼Œå¿«é€Ÿå¤±è´¥ã€‚å‡å°‘ä¸ç¨³å®šçš„å¤–éƒ¨ä¾èµ–å¯¹æ ¸å¿ƒæœåŠ¡çš„å½±å“ã€‚ ç³»ç»Ÿç›‘æ§ï¼šå¯¹ CPU åˆ©ç”¨ç‡ï¼Œloadï¼Œå†…å­˜ï¼Œå¸¦å®½ï¼Œç³»ç»Ÿè°ƒç”¨é‡ï¼Œåº”ç”¨é”™è¯¯é‡ï¼ŒPVï¼ŒUV å’Œä¸šåŠ¡é‡è¿›è¡Œç›‘æ§ è‡ªåŠ¨åŒ–æµ‹è¯•ï¼šé€šè¿‡å®Œå–„çš„æµ‹è¯•ï¼Œå‡å°‘å‘å¸ƒå¼•èµ·çš„æ•…éšœã€‚ ç°åº¦å‘å¸ƒ(+å›æ»š)ï¼šç°åº¦å‘å¸ƒæ˜¯é€Ÿåº¦ä¸å®‰å…¨æ€§ä½œä¸ºå¦¥åï¼Œèƒ½å¤Ÿæœ‰æ•ˆå‡å°‘å‘å¸ƒæ•…éšœã€‚ å¼‚æ­¥æ¶ˆæ¯ç³»ç»Ÿ ","date":"2019-07-07","objectID":"/microservicedesign/:2:2","tags":["Architecture","å¾®æœåŠ¡","åˆ†å¸ƒå¼","ç¬”è®°"],"title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","uri":"/microservicedesign/"},{"categories":null,"content":"éœ€è¦æ·±å…¥çš„æŠ€æœ¯æ ˆ åˆ†å¸ƒå¼ç³»ç»Ÿã€DevOpsã€åŸºç¡€æ¶æ„å³ä»£ç (IaC)ã€ä¸åŒç±»å‹çš„æ•°æ®åº“ã€å‰ç«¯ç»„ä»¶åŒ–å’Œå¤åˆåŒ–ã€å•å…ƒæµ‹è¯•ã€å…¨è‡ªåŠ¨å‘å¸ƒã€è¿­ä»£ã€å°ç‰ˆæœ¬å‘å¸ƒè®¡åˆ’ã€æµ‹è¯•å·¥å…·ã€å¤šç‰ˆæœ¬ç®¡ç† ","date":"2019-07-07","objectID":"/microservicedesign/:2:3","tags":["Architecture","å¾®æœåŠ¡","åˆ†å¸ƒå¼","ç¬”è®°"],"title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","uri":"/microservicedesign/"},{"categories":null,"content":"åˆ†å¸ƒå¼ä¸€è‡´æ€§ä¸å…±è¯†ç®—æ³• Consensus from wiki, æ€»ç»“ä¸‹æ¥ä¸€è‡´æ€§å°±æ˜¯ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåœ¨ç»™å®šçš„ä¸€ç³»åˆ—æ“ä½œï¼Œå³ä½¿ç³»ç»Ÿå†…éƒ¨å‡ºé”™ï¼Œæœ€ç»ˆæ•´ä¸ªç³»ç»Ÿå¯¹å¤–æä¾›çš„æ•°æ®éƒ½æ˜¯å¯é çš„ã€‚åœ¨åè°ƒä¸€è‡´æ€§çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹äºä¸€ä¸ª Proposal æ•´ä¸ªç³»ç»Ÿè¾¾æˆå…±è¯†ï¼Œå…±è¯†ç®—æ³•èµ·ç€å¾ˆé‡è¦çš„ä½œç”¨ã€‚ ","date":"2019-07-07","objectID":"/microservicedesign/:3:0","tags":["Architecture","å¾®æœåŠ¡","åˆ†å¸ƒå¼","ç¬”è®°"],"title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","uri":"/microservicedesign/"},{"categories":null,"content":"CAP åŠ å·ä¼¯å…‹åˆ©å¤§å­¦çš„æ•™æˆ Eric Brewer è®ºæ–‡Brewerâ€™s Conjecture and the Feasibility of Consistent, Available, Partition-Tolerant Web Services é˜è¿°äº† CAP ç†è®º CAP from wiki, è®ºæ–‡ä¸­æå‡ºçš„è§‚ç‚¹ï¼šåœ¨å¼‚æ­¥çš„ç½‘ç»œæ¨¡å‹ä¸­ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹ç”±äºæ²¡æœ‰æ—¶é’Ÿä»…ä»…èƒ½æ ¹æ®æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä½œå‡ºåˆ¤æ–­ï¼Œè¿™æ—¶å®Œå…¨ä¸èƒ½åŒæ—¶ä¿è¯ä¸€è‡´æ€§(Consistency)ã€å¯ç”¨æ€§(Availability)å’Œåˆ†åŒºå®¹é”™æ€§(Partition tolerance)ï¼Œæ¯ä¸€ä¸ªç³»ç»Ÿåªèƒ½åœ¨è¿™ä¸‰ç§ç‰¹æ€§ä¸­é€‰æ‹©ä¸¤ç§ã€‚ ç”±äºç½‘ç»œæœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œå¹¶ä¸èƒ½åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ—¶å€™é‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§çš„æ–¹å¼ï¼Œå®¹å¿ä¸€å®šæ—¶é—´å†…æ•°æ®ä¸ä¸€è‡´ï¼Œåœ¨ä¸€å®šçš„æ—¶é—´å†…ç³»ç»Ÿå†…éƒ¨å„èŠ‚ç‚¹å¯ä»¥åœ¨æœ‰é™çš„æ—¶é—´å†…è§£å†³å†²çªï¼Œä½¿æ•°æ®æ¢å¤å‡†ç¡®çš„çŠ¶æ€ã€‚ ","date":"2019-07-07","objectID":"/microservicedesign/:3:1","tags":["Architecture","å¾®æœåŠ¡","åˆ†å¸ƒå¼","ç¬”è®°"],"title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","uri":"/microservicedesign/"},{"categories":null,"content":"æ‹œå åº­å°†å†›é—®é¢˜ æ‹œå åº­å°†å†›é—®é¢˜è®ºæ–‡ æ‹œå åº­å°†å†›é—®é¢˜æ˜¯å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿå®¹é”™çš„æœ€é«˜è¦æ±‚ï¼Œç„¶è€Œè¿™ä¸æ˜¯æ—¥å¸¸å·¥ä½œä¸­ä½¿ç”¨çš„å¤§å¤šæ•°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¼šé¢å¯¹çš„é—®é¢˜ï¼Œæˆ‘ä»¬é‡åˆ°æ›´å¤šçš„è¿˜æ˜¯èŠ‚ç‚¹æ•…éšœå®•æœºæˆ–è€…ä¸å“åº”ç­‰æƒ…å†µï¼Œè¿™å°±å¤§å¤§ç®€åŒ–äº†ç³»ç»Ÿå¯¹å®¹é”™çš„è¦æ±‚ ","date":"2019-07-07","objectID":"/microservicedesign/:3:2","tags":["Architecture","å¾®æœåŠ¡","åˆ†å¸ƒå¼","ç¬”è®°"],"title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","uri":"/microservicedesign/"},{"categories":null,"content":"FLP FLP ä¸å¯èƒ½å®šç†æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸæœ€é‡è¦çš„å®šç†ä¹‹ä¸€ï¼Œå®ƒç»™å‡ºäº†ä¸€ä¸ªéå¸¸é‡è¦çš„ç»“è®ºï¼šåœ¨ç½‘ç»œå¯é å¹¶ä¸”å­˜åœ¨èŠ‚ç‚¹å¤±æ•ˆçš„å¼‚æ­¥æ¨¡å‹ç³»ç»Ÿä¸­ï¼Œä¸å­˜åœ¨ä¸€ä¸ªå¯ä»¥è§£å†³ä¸€è‡´æ€§é—®é¢˜çš„ç¡®å®šæ€§ç®—æ³•ã€‚ In this paper, we show the surprising result that no completely asynchronous consensus protocol can tolerate even a single unannounced process death. We do not consider Byzantine failures, and we assume that the message system is reliable it delivers all messages correctly and exactly once. ç›¸å…³è®ºæ–‡ ","date":"2019-07-07","objectID":"/microservicedesign/:3:3","tags":["Architecture","å¾®æœåŠ¡","åˆ†å¸ƒå¼","ç¬”è®°"],"title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","uri":"/microservicedesign/"},{"categories":null,"content":"å…±è¯†ç®—æ³• ","date":"2019-07-07","objectID":"/microservicedesign/:4:0","tags":["Architecture","å¾®æœåŠ¡","åˆ†å¸ƒå¼","ç¬”è®°"],"title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","uri":"/microservicedesign/"},{"categories":null,"content":"paxos, raft åŒ…æ‹¬ Paxosã€Raft The Raft Consensus Algorithm raft å·¥ä½œåŸç†åŠ¨å›¾ Paxos ç®—æ³•éš¾ä»¥ç†è§£ã€éš¾ä»¥å®ç°ï¼Œéš¾é“ä»€ä¹ˆç¨‹åº¦å‘¢ï¼Ÿåœ¨ raft çš„è®ºæ–‡ä¸­æœ‰æåŠã€‚æ¯”å¦‚ zookeeper çš„ zab å°±æ˜¯åœ¨ paxos çš„åŸºç¡€ä¸Šè¿›è¡Œè®¾è®¡çš„ã€‚æ¯ä¸€ç§ Paxos çš„å®ç°ï¼Œéƒ½éœ€è¦é‡æ–°è®¾è®¡å®ç°ä¸€å¥—ç®—æ³•ã€‚è€Œ raft ç›¸å¯¹éš¾åº¦é™ä½å¾ˆå¤šã€‚ åŸºäº raft çš„ etcdï¼Œconsul ç­‰ã€‚ ","date":"2019-07-07","objectID":"/microservicedesign/:4:1","tags":["Architecture","å¾®æœåŠ¡","åˆ†å¸ƒå¼","ç¬”è®°"],"title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","uri":"/microservicedesign/"},{"categories":null,"content":"POW(Proof-of-Work) æ— è®ºæ˜¯ Paxos è¿˜æ˜¯ Raft å…¶å®éƒ½åªèƒ½è§£å†³éæ‹œå åº­å°†å†›å®¹é”™çš„ä¸€è‡´æ€§é—®é¢˜ï¼Œä¸èƒ½å¤Ÿåº”å¯¹åˆ†å¸ƒå¼ç½‘ç»œä¸­å‡ºç°çš„æç«¯æƒ…å†µï¼Œä½†æ˜¯è¿™åœ¨ä¼ ç»Ÿçš„åˆ†å¸ƒå¼ç³»ç»Ÿéƒ½ä¸æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œæ— è®ºæ˜¯åˆ†å¸ƒå¼æ•°æ®åº“è¿˜æ˜¯æ¶ˆæ¯é˜Ÿåˆ—é›†ç¾¤ï¼Œå®ƒä»¬å†…éƒ¨çš„èŠ‚ç‚¹å¹¶ä¸ä¼šæ•…æ„çš„å‘é€é”™è¯¯ä¿¡æ¯ï¼Œåœ¨ç±»ä¼¼ç³»ç»Ÿä¸­ï¼Œæœ€å¸¸è§çš„é—®é¢˜å°±æ˜¯èŠ‚ç‚¹å¤±å»å“åº”æˆ–è€…å¤±æ•ˆï¼Œæ‰€ä»¥å®ƒä»¬åœ¨è¿™ç§å‰æä¸‹æ˜¯æœ‰æ•ˆå¯è¡Œçš„ï¼Œä¹Ÿæ˜¯å……åˆ†çš„ã€‚ å·¥ä½œé‡è¯æ˜æ˜¯ä¸€ä¸ªç”¨äºé˜»æ­¢æ‹’ç»æœåŠ¡æ”»å‡»å’Œç±»ä¼¼åƒåœ¾é‚®ä»¶ç­‰æœåŠ¡é”™è¯¯é—®é¢˜çš„åè®® ","date":"2019-07-07","objectID":"/microservicedesign/:4:2","tags":["Architecture","å¾®æœåŠ¡","åˆ†å¸ƒå¼","ç¬”è®°"],"title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","uri":"/microservicedesign/"},{"categories":null,"content":"POS(Proof-of-Stake) æƒç›Šè¯æ˜æ˜¯åŒºå—é“¾ç½‘ç»œä¸­çš„ä½¿ç”¨çš„å¦ä¸€ç§å…±è¯†ç®—æ³•ï¼Œåœ¨åŸºäºæƒç›Šè¯æ˜çš„å¯†ç è´§å¸ä¸­ï¼Œä¸‹ä¸€ä¸ªåŒºå—çš„é€‰æ‹©æ˜¯æ ¹æ®ä¸åŒèŠ‚ç‚¹çš„è‚¡ä»½å’Œæ—¶é—´è¿›è¡Œéšæœºé€‰æ‹©çš„ã€‚ ","date":"2019-07-07","objectID":"/microservicedesign/:4:3","tags":["Architecture","å¾®æœåŠ¡","åˆ†å¸ƒå¼","ç¬”è®°"],"title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","uri":"/microservicedesign/"},{"categories":null,"content":"DPOS(Delegated Proof-of-Stake) ","date":"2019-07-07","objectID":"/microservicedesign/:4:4","tags":["Architecture","å¾®æœåŠ¡","åˆ†å¸ƒå¼","ç¬”è®°"],"title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","uri":"/microservicedesign/"},{"categories":null,"content":"ã€Šå¾®æœåŠ¡è®¾è®¡ã€‹è„‘å›¾ è„‘å›¾å¦‚ä¸‹ï¼š è„‘å›¾åœ°å€ ","date":"2019-07-07","objectID":"/microservicedesign/:5:0","tags":["Architecture","å¾®æœåŠ¡","åˆ†å¸ƒå¼","ç¬”è®°"],"title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","uri":"/microservicedesign/"},{"categories":null,"content":"references åç«¯æ¶æ„å¸ˆæŠ€æœ¯å›¾è°± hystrix bilibili/kratos Go Microservices blog series microservices-in-golang shippy-demo 20 ä¸ªå¥½ç”¨çš„ Go è¯­è¨€å¾®æœåŠ¡å¼€å‘æ¡†æ¶ micro/micro micro/go-micro CAP theorem grpc-example åˆ†å¸ƒå¼ä¸€è‡´æ€§ä¸å…±è¯†ç®—æ³• ","date":"2019-07-07","objectID":"/microservicedesign/:6:0","tags":["Architecture","å¾®æœåŠ¡","åˆ†å¸ƒå¼","ç¬”è®°"],"title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","uri":"/microservicedesign/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šä¸­æ–‡ç¿»è¯‘ The Log: What every software engineer should know about real-time dataâ€™s unifying abstraction ","date":"2019-07-04","objectID":"/the-log-every-software-engineer-should-know-about-real-time-data-unifying-abstraction/:0:0","tags":["database","distributed","log","ç¿»è¯‘"],"title":"The Log: What every software engineer should know about real-time data's unifying abstraction ä¸­æ–‡ç¿»è¯‘","uri":"/the-log-every-software-engineer-should-know-about-real-time-data-unifying-abstraction/"},{"categories":null,"content":"æ­£æ–‡ å…­å¹´å‰æˆ‘åœ¨ä¸€ä¸ªç‰¹åˆ«æœ‰è¶£çš„æ—¶é—´åŠ å…¥äº† LinkedInã€‚ æˆ‘ä»¬åˆšåˆšå¼€å§‹é‡åˆ°å•ä½“é›†ä¸­å¼æ•°æ®åº“çš„æé™ï¼Œéœ€è¦å¼€å§‹å‘åˆ†å¸ƒå¼ç³»ç»Ÿè¿‡æ¸¡ã€‚ è¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„ç»å†ï¼šæˆ‘ä»¬æ„å»ºï¼Œéƒ¨ç½²å¹¶è¿è¡Œåˆ†å¸ƒå¼å›¾å½¢æ•°æ®åº“ï¼Œåˆ†å¸ƒå¼æœç´¢åç«¯ï¼ŒHadoop å®‰è£…ä»¥åŠç¬¬ä¸€ä»£å’Œç¬¬äºŒä»£é”®å€¼å­˜å‚¨ä¸€ç›´åˆ°ä»Šå¤©ã€‚ æˆ‘åœ¨è¿™ä¸€åˆ‡ä¸­å­¦åˆ°çš„æœ€æœ‰ç”¨çš„ä¸œè¥¿ä¹‹ä¸€å°±æ˜¯æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„è®¸å¤šä¸œè¥¿éƒ½æœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„æ¦‚å¿µï¼šæ—¥å¿—ã€‚ æœ‰æ—¶ç§°ä¸ºé¢„å†™æ—¥å¿—æˆ–æäº¤æ—¥å¿—æˆ–äº‹åŠ¡æ—¥å¿—ï¼Œæ—¥å¿—å‡ ä¹ä¸è®¡ç®—æœºä¸€æ ·é•¿ï¼Œå¹¶ä¸”æ˜¯è®¸å¤šåˆ†å¸ƒå¼æ•°æ®ç³»ç»Ÿå’Œå®æ—¶åº”ç”¨ç¨‹åºä½“ç³»ç»“æ„çš„æ ¸å¿ƒã€‚ åœ¨ä¸äº†è§£æ—¥å¿—çš„æƒ…å†µä¸‹ï¼Œæ‚¨æ— æ³•å®Œå…¨ç†è§£æ•°æ®åº“ï¼ŒNoSQL å­˜å‚¨ï¼Œé”®å€¼å­˜å‚¨ï¼Œå¤åˆ¶ï¼Œpaxosï¼Œhadoopï¼Œç‰ˆæœ¬æ§åˆ¶æˆ–å‡ ä¹ä»»ä½•è½¯ä»¶ç³»ç»Ÿ; ç„¶è€Œï¼Œå¤§å¤šæ•°è½¯ä»¶å·¥ç¨‹å¸ˆå¹¶ä¸ç†Ÿæ‚‰å®ƒä»¬ã€‚ æˆ‘æƒ³æ”¹å˜è¿™ä¸€ç‚¹ã€‚ åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å‘æ‚¨ä»‹ç»æœ‰å…³æ—¥å¿—çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ—¥å¿—ä»¥åŠå¦‚ä½•ä½¿ç”¨æ—¥å¿—è¿›è¡Œæ•°æ®é›†æˆï¼Œå®æ—¶å¤„ç†å’Œç³»ç»Ÿæ„å»ºã€‚ ","date":"2019-07-04","objectID":"/the-log-every-software-engineer-should-know-about-real-time-data-unifying-abstraction/:1:0","tags":["database","distributed","log","ç¿»è¯‘"],"title":"The Log: What every software engineer should know about real-time data's unifying abstraction ä¸­æ–‡ç¿»è¯‘","uri":"/the-log-every-software-engineer-should-know-about-real-time-data-unifying-abstraction/"},{"categories":null,"content":"Part One: What is Log A log is perhaps the simplest possible storage abstraction. It is an append-only, totally-ordered sequence of records ordered by time. è®°å½•é™„åŠ åˆ°æ—¥å¿—çš„æœ«å°¾ï¼Œè¯»å–ä»å·¦åˆ°å³è¿›è¡Œã€‚ æ¯ä¸ªæ¡ç›®éƒ½åˆ†é…æœ‰å”¯ä¸€çš„é¡ºåºæ—¥å¿—æ¡ç›®å·ã€‚ è®°å½•çš„é¡ºåºå®šä¹‰äº†â€œæ—¶é—´â€çš„æ¦‚å¿µï¼Œå› ä¸ºå·¦è¾¹çš„æ¡ç›®è¢«å®šä¹‰ä¸ºæ¯”å³è¾¹çš„æ¡ç›®æ›´æ—§ã€‚ æ—¥å¿—æ¡ç›®å·å¯ä»¥è¢«è®¤ä¸ºæ˜¯æ¡ç›®çš„â€œæ—¶é—´æˆ³â€ã€‚ å°†è¿™ç§æ’åºæè¿°ä¸ºæ—¶é—´æ¦‚å¿µèµ·åˆçœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼Œä½†å®ƒå…·æœ‰ä¸ä»»ä½•ç‰¹å®šç‰©ç†æ—¶é’Ÿåˆ†ç¦»çš„ä¾¿åˆ©ç‰¹æ€§ã€‚ å½“æˆ‘ä»¬è¿›å…¥åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œæ­¤å±æ€§å°†å˜å¾—è‡³å…³é‡è¦ã€‚ å‡ºäºæœ¬è®¨è®ºçš„ç›®çš„ï¼Œè®°å½•çš„å†…å®¹å’Œæ ¼å¼å¹¶ä¸é‡è¦ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬ä¸èƒ½åªæ˜¯ç»§ç»­å‘æ—¥å¿—æ·»åŠ è®°å½•ï¼Œå› ä¸ºæˆ‘ä»¬æœ€ç»ˆå°†è€—å°½ç©ºé—´ã€‚ æˆ‘ä¼šç¨å¾®å›è¿‡å¤´æ¥çœ‹çœ‹ã€‚ å› æ­¤ï¼Œæ—¥å¿—ä¸æ–‡ä»¶æˆ–è¡¨æ ¼å®Œå…¨ä¸åŒã€‚ æ–‡ä»¶æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œä¸€ä¸ªè¡¨æ˜¯ä¸€ä¸ªè®°å½•æ•°ç»„ï¼Œä¸€ä¸ªæ—¥å¿—å®é™…ä¸Šåªæ˜¯ä¸€ç§è¡¨æˆ–æ–‡ä»¶ï¼Œå…¶ä¸­è®°å½•æŒ‰æ—¶é—´æ’åºã€‚ åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæ‚¨å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆå€¼å¾—è°ˆè®ºè¿™ä¹ˆç®€å•çš„äº‹æƒ…ï¼Ÿ å¦‚ä½•ä»¥ä»…é™„åŠ çš„è®°å½•åºåˆ—ä¸æ•°æ®ç³»ç»Ÿç›¸å…³è”ï¼Ÿ ç­”æ¡ˆæ˜¯æ—¥å¿—æœ‰ä¸€ä¸ªç‰¹å®šçš„ç›®çš„ï¼šå®ƒä»¬è®°å½•å‘ç”Ÿçš„äº‹æƒ…å’Œæ—¶é—´ã€‚ å¯¹äºåˆ†å¸ƒå¼æ•°æ®ç³»ç»Ÿï¼Œè¿™åœ¨è®¸å¤šæ–¹é¢éƒ½æ˜¯é—®é¢˜çš„æ ¸å¿ƒã€‚ ä½†åœ¨æˆ‘ä»¬èµ°å¾—å¤ªè¿œä¹‹å‰ï¼Œè®©æˆ‘æ¾„æ¸…ä¸€äº›æœ‰ç‚¹ä»¤äººå›°æƒ‘çš„äº‹æƒ…ã€‚ æ¯ä¸ªç¨‹åºå‘˜éƒ½ç†Ÿæ‚‰å¦ä¸€ä¸ªæ—¥å¿—è®°å½•å®šä¹‰ - åº”ç”¨ç¨‹åºå¯èƒ½ä½¿ç”¨ syslog æˆ– log4j å†™å…¥æœ¬åœ°æ–‡ä»¶çš„éç»“æ„åŒ–é”™è¯¯æ¶ˆæ¯æˆ–è·Ÿè¸ªä¿¡æ¯ã€‚ ä¸ºæ¸…æ¥šèµ·è§ï¼Œæˆ‘å°†å…¶ç§°ä¸ºâ€œåº”ç”¨ç¨‹åºæ—¥å¿—è®°å½•â€ã€‚ åº”ç”¨ç¨‹åºæ—¥å¿—æ˜¯æˆ‘æè¿°çš„æ—¥å¿—æ¦‚å¿µçš„é€€åŒ–å½¢å¼ã€‚ æœ€å¤§çš„åŒºåˆ«æ˜¯æ–‡æœ¬æ—¥å¿—ä¸»è¦æ˜¯ä¾›äººé˜…è¯»ï¼Œè€Œæˆ‘æ‰€æè¿°çš„â€œæ—¥å¿—â€æˆ–â€œæ•°æ®æ—¥å¿—â€æ˜¯ä¸ºç¼–ç¨‹è®¿é—®è€Œæ„å»ºçš„ã€‚ ï¼ˆå®é™…ä¸Šï¼Œå¦‚æœä½ å¯¹å®ƒè¿›è¡Œæ·±å…¥çš„æ€è€ƒï¼Œé‚£ä¹ˆäººä»¬è¯»å–æŸä¸ªæœºå™¨ä¸Šçš„æ—¥å¿—è¿™ç§ç†å¿µæœ‰äº›ä¸é¡ºåº”æ—¶ä»£ã€‚å½“æ¶‰åŠåˆ°è®¸å¤šæœåŠ¡å’ŒæœåŠ¡å™¨çš„æ—¶å€™ï¼Œè¿™ç§æ–¹æ³•å¾ˆå¿«å°±å˜æˆä¸€ä¸ªéš¾äºç®¡ç†çš„æ–¹å¼ï¼Œè€Œä¸”ä¸ºäº†è®¤è¯†å¤šä¸ªæœºå™¨çš„è¡Œä¸ºï¼Œæ—¥å¿—çš„ç›®æ ‡å¾ˆå¿«å°±å˜æˆæŸ¥è¯¢å’Œå›¾å½¢åŒ–è¿™äº›è¡Œä¸ºçš„è¾“å…¥äº†-å¯¹å¤šä¸ªæœºå™¨çš„æŸäº›è¡Œä¸ºè€Œè¨€ï¼Œæ–‡ä»¶é‡Œçš„è‹±æ–‡å½¢å¼çš„æ–‡æœ¬åŒè¿™å„¿æ‰€æè¿°çš„è¿™ç§ç»“æ„åŒ–çš„æ—¥å¿—ç›¸æ¯”å‡ ä¹å°±ä¸é€‚åˆäº†ã€‚ï¼‰ Logs in databases æˆ‘ä¸çŸ¥é“æ—¥å¿—æ¦‚å¿µçš„èµ·æº - å¯èƒ½æ˜¯äºŒå…ƒæœç´¢è¿™æ ·çš„äº‹æƒ…ä¹‹ä¸€ï¼Œå¯¹äºå‘æ˜è€…æ¥è¯´å¤ªç®€å•äº†ï¼Œä¸èƒ½å‘ç°å®ƒæ˜¯ä¸€é¡¹å‘æ˜ã€‚ å®ƒæ—©åœ¨ IBM çš„ System R å°±å·²å­˜åœ¨ã€‚æ•°æ®åº“ä¸­çš„ä½¿ç”¨ä¸åœ¨å‡ºç°å´©æºƒæ—¶ä¿æŒåŒæ­¥çš„å„ç§æ•°æ®ç»“æ„å’Œç´¢å¼•æœ‰å…³ã€‚ ä¸ºäº†ä½¿è¿™ç§åŸå­æ€§å’ŒæŒä¹…æ€§ï¼Œæ•°æ®åº“ä½¿ç”¨æ—¥å¿—æ¥å†™å‡ºæœ‰å…³ä»–ä»¬å°†è¦ä¿®æ”¹çš„è®°å½•çš„ä¿¡æ¯ï¼Œç„¶åå°†æ›´æ”¹åº”ç”¨äºå®ƒç»´æŠ¤çš„æ‰€æœ‰å„ç§æ•°æ®ç»“æ„ã€‚ æ—¥å¿—æ˜¯å‘ç”Ÿçš„äº‹ä»¶çš„è®°å½•ï¼Œæ¯ä¸ªè¡¨æˆ–ç´¢å¼•æ˜¯å°†è¯¥å†å²è®°å½•æŠ•å½±åˆ°ä¸€äº›æœ‰ç”¨çš„æ•°æ®ç»“æ„æˆ–ç´¢å¼•ä¸­ã€‚ ç”±äºæ—¥å¿—ä¼šç«‹å³ä¿ç•™ï¼Œå› æ­¤åœ¨å´©æºƒæ—¶å°†å…¶ç”¨ä½œæ¢å¤æ‰€æœ‰å…¶ä»–æŒä¹…æ€§ç»“æ„çš„æƒå¨æ¥æºã€‚ éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ—¥å¿—çš„ä½¿ç”¨ä» ACID çš„å®ç°ç»†èŠ‚å‘å±•åˆ°åœ¨æ•°æ®åº“ä¹‹é—´å¤åˆ¶æ•°æ®çš„æ–¹æ³•ã€‚ äº‹å®è¯æ˜ï¼Œæ•°æ®åº“ä¸Šå‘ç”Ÿçš„æ›´æ”¹é¡ºåºæ­£æ˜¯ä¿æŒè¿œç¨‹å‰¯æœ¬æ•°æ®åº“åŒæ­¥æ‰€éœ€çš„ã€‚ Oracleï¼ŒMySQL å’Œ PostgreSQL åŒ…æ‹¬æ—¥å¿—ä¼ é€åè®®ï¼Œç”¨äºå°†éƒ¨åˆ†æ—¥å¿—ä¼ è¾“åˆ°å……å½“ä»å±æœåŠ¡å™¨çš„å‰¯æœ¬æ•°æ®åº“ã€‚ Oracle å·²å°†æ—¥å¿—äº§å“åŒ–ä¸ºé oracle æ•°æ®è®¢é˜…è€…çš„é€šç”¨æ•°æ®è®¢é˜…æœºåˆ¶ï¼Œå…¶XStreamå’ŒGoldenGateä»¥åŠ MySQL å’Œ PostgreSQL ä¸­çš„ç±»ä¼¼å·¥å…·æ˜¯è®¸å¤šæ•°æ®æ¶æ„çš„å…³é”®ç»„ä»¶ã€‚ ç”±äºè¿™ä¸ªèµ·æºï¼Œæœºå™¨å¯è¯»æ—¥å¿—çš„æ¦‚å¿µä¸»è¦å±€é™äºæ•°æ®åº“å†…éƒ¨ã€‚ ä½¿ç”¨æ—¥å¿—ä½œä¸ºæ•°æ®è®¢é˜…çš„æœºåˆ¶ä¼¼ä¹å‡ ä¹æ˜¯å¶ç„¶å‡ºç°çš„ã€‚ ä½†è¿™ç§æŠ½è±¡æ˜¯æ”¯æŒå„ç§æ¶ˆæ¯ä¼ é€’ï¼Œæ•°æ®æµå’Œå®æ—¶æ•°æ®å¤„ç†çš„ç†æƒ³é€‰æ‹©ã€‚ Logs in distributed systems æ—¥å¿—è§£å†³çš„ä¸¤ä¸ªé—®é¢˜ - æ’åºæ›´æ”¹(ordering changes)å’Œåˆ†å‘æ•°æ®(distributing data) - åœ¨åˆ†å¸ƒå¼æ•°æ®ç³»ç»Ÿä¸­æ›´ä¸ºé‡è¦ã€‚ åŒæ„è®¢è´­æ›´æ–°ï¼ˆæˆ–åŒæ„ä¸åŒæ„å’Œåº”å¯¹å‰¯ä½œç”¨ï¼‰æ˜¯è¿™äº›ç³»ç»Ÿçš„æ ¸å¿ƒè®¾è®¡é—®é¢˜ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä»¥æ—¥å¿—ä¸ºä¸­å¿ƒçš„æ–¹æ³•æºäºä¸€ä¸ªç®€å•çš„è®¨è®ºï¼Œæˆ‘ç§°ä¹‹ä¸ºçŠ¶æ€æœºå¤åˆ¶åŸåˆ™ï¼š If two identical, deterministic processes begin in the same state and get the same inputs in the same order, they will produce the same output and end in the same state. å¦‚æœä¸¤ä¸ªç›¸åŒçš„ç¡®å®šæ€§è¿‡ç¨‹ä»¥ç›¸åŒçš„çŠ¶æ€å¼€å§‹å¹¶ä»¥ç›¸åŒçš„é¡ºåºè·å¾—ç›¸åŒçš„è¾“å…¥ï¼Œåˆ™å®ƒä»¬å°†äº§ç”Ÿç›¸åŒçš„è¾“å‡ºå¹¶ä»¥ç›¸åŒçš„çŠ¶æ€ç»“æŸã€‚ è¿™å¯èƒ½çœ‹èµ·æ¥æœ‰ç‚¹éš¾æ‡‚çš„(obtuse)ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬æ·±å…¥äº†è§£å®ƒçš„å«ä¹‰ã€‚ Deterministic(ç¡®å®šæ€§)æ„å‘³ç€å¤„ç†ä¸ä¾èµ–äºæ—¶é—´ï¼Œå¹¶ä¸”ä¸å…è®¸ä»»ä½•å…¶ä»–â€œå¤–éƒ¨çš„â€è¾“å…¥å½±å“å…¶ç»“æœã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªç¨‹åºçš„è¾“å‡ºå—åˆ°çº¿ç¨‹æ‰§è¡Œçš„ç‰¹å®šé¡ºåºçš„å½±å“ï¼Œæˆ–è€…é€šè¿‡è°ƒç”¨ gettimeofday æˆ–å…¶ä»–ä¸€äº›ä¸å¯é‡å¤çš„ä¸œè¥¿ï¼Œé€šå¸¸è¢«è®¤ä¸ºæ˜¯éç¡®å®šæ€§çš„ã€‚ è¿›ç¨‹çš„ state çŠ¶æ€æ˜¯å¤„ç†ç»“æŸæ—¶æœºå™¨ä¸Šçš„ä»»ä½•æ•°æ®ï¼Œæ— è®ºæ˜¯åœ¨å†…å­˜ä¸­è¿˜æ˜¯åœ¨ç£ç›˜ä¸Šã€‚ ä»¥ç›¸åŒçš„é¡ºåºè·å¾—ç›¸åŒè¾“å…¥çš„åœ°æ–¹åº”å½“å¼•èµ·æ³¨æ„-è¿™å°±æ˜¯å¼•å…¥æ—¥å¿—çš„åœ°æ–¹ã€‚è¿™å„¿æœ‰ä¸€ä¸ªé‡è¦çš„å¸¸è¯†ï¼šå¦‚æœç»™ä¸¤æ®µç¡®å®šæ€§ä»£ç ç›¸åŒçš„æ—¥å¿—è¾“å…¥ï¼Œé‚£ä¹ˆå®ƒä»¬å°±ä¼šç”Ÿæˆç›¸åŒçš„è¾“å‡ºã€‚ åˆ†å¸ƒå¼è®¡ç®—è¿™æ–¹é¢çš„åº”ç”¨å°±æ ¼å¤–æ˜æ˜¾ã€‚ä½ å¯ä»¥æŠŠç”¨å¤šå°æœºå™¨ä¸€èµ·æ‰§è¡ŒåŒä¸€ä»¶äº‹æƒ…çš„é—®é¢˜ç¼©å‡ä¸ºå®ç°åˆ†å¸ƒå¼ä¸€è‡´æ€§æ—¥å¿—ä¸ºè¿™äº›è¿›ç¨‹è¾“å…¥çš„é—®é¢˜ã€‚è¿™æ—¥å¿—çš„ç›®çš„æ˜¯æŠŠæ‰€æœ‰éç¡®å®šæ€§çš„ä¸œè¥¿æ’é™¤åœ¨è¾“å…¥æµä¹‹å¤–ï¼Œæ¥ç¡®ä¿æ¯ä¸ªå¤åˆ¶è¿›ç¨‹èƒ½å¤ŸåŒæ­¥åœ°å¤„ç†è¾“å…¥ã€‚ å½“ä½ ç†è§£äº†è¿™ä¸ªä»¥åï¼ŒçŠ¶æ€æœºå¤åˆ¶åŸç†å°±ä¸å†å¤æ‚æˆ–è€…è¯´ä¸å†æ·±å¥¥äº†ï¼šè¿™æˆ–å¤šæˆ–å°‘çš„æ„å‘³ç€\"deterministic processing is deterministic\"(ç¡®å®šæ€§çš„å¤„ç†è¿‡ç¨‹å°±æ˜¯ç¡®å®šæ€§çš„)ã€‚ä¸ç®¡æ€æ ·ï¼Œæˆ‘éƒ½è®¤ä¸ºå®ƒæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡é‡Œè¾ƒå¸¸ç”¨çš„å·¥å…·ä¹‹ä¸€ã€‚ è¿™ç§æ–¹å¼çš„ä¸€ä¸ªç¾å¦™ä¹‹å¤„å°±åœ¨äºç´¢å¼•æ—¥å¿—çš„æ—¶é—´æˆ³å°±åƒæ—¶é’ŸçŠ¶æ€çš„ä¸€ä¸ªå‰¯æœ¬â€”â€”ä½ å¯ä»¥ç”¨ä¸€ä¸ªå•ç‹¬çš„æ•°å­—æè¿°æ¯ä¸€ä¸ªå‰¯æœ¬ï¼Œè¿™å°±æ˜¯ç»è¿‡å¤„ç†çš„æ—¥å¿—çš„æ—¶é—´æˆ³ã€‚æ—¶é—´æˆ³ä¸æ—¥å¿—ä¸€ä¸€å¯¹åº”ç€æ•´ä¸ªå‰¯æœ¬çš„çŠ¶æ€ã€‚ ç”±äºå†™è¿›æ—¥å¿—çš„å†…å®¹çš„ä¸åŒï¼Œä¹Ÿå°±æœ‰è®¸å¤šåœ¨ç³»ç»Ÿä¸­åº”ç”¨è¿™ä¸ªåŸåˆ™çš„ä¸åŒæ–¹å¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è®°å½•ä¸€ä¸ªæœåŠ¡çš„è¯·æ±‚ï¼Œæˆ–è€…æœåŠ¡ä»è¯·æ±‚åˆ°å“åº”çš„çŠ¶æ€å˜åŒ–ï¼Œæˆ–è€…å®ƒæ‰§è¡Œå‘½ä»¤çš„è½¬æ¢ã€‚ç†è®ºä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ä¸ºæ¯ä¸€ä¸ªå‰¯æœ¬è®°å½•ä¸€ç³»åˆ—è¦æ‰§è¡Œçš„æœºå™¨æŒ‡ä»¤æˆ–è€…è°ƒç”¨çš„æ–¹æ³•åå’Œå‚æ•°ã€‚åªè¦ä¸¤ä¸ªè¿›ç¨‹ç”¨ç›¸åŒçš„æ–¹å¼å¤„ç†è¿™äº›è¾“å…¥ï¼Œè¿™äº›è¿›ç¨‹å°±ä¼šä¿æŒå‰¯æœ¬çš„ä¸€è‡´æ€§ã€‚ ä¸€åƒä¸ªäººçœ¼ä¸­æœ‰ä¸€åƒç§æ—¥å¿—çš„ç”¨æ³•ã€‚æ•°æ®åº“å·¥ä½œè€…é€šå¸¸åŒºåˆ†ç‰©ç†æ—¥å¿—å’Œé€»è¾‘æ—¥å¿—ã€‚ç‰©ç†æ—¥å¿—å°±æ˜¯è®°å½•æ¯ä¸€è¡Œè¢«æ”¹å˜çš„å†…å®¹ã€‚é€»è¾‘æ—¥å¿—è®°å½•çš„ä¸æ˜¯æ”¹å˜çš„è¡Œè€Œæ˜¯é‚£äº›å¼•èµ·è¡Œçš„å†…å®¹è¢«æ”¹å˜çš„ SQL è¯­å¥ï¼ˆinsertï¼Œupdate å’Œ delete è¯­å¥ï¼‰ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿé€šå¸¸å¯ä»¥å®½æ³›åˆ†ä¸ºä¸¤ç§æ–¹æ³•æ¥å¤„ç†æ•°æ®å’Œå®Œæˆå“åº”ã€‚â€œçŠ¶æ€æœºå™¨æ¨¡å‹â€é€šå¸¸å¼•ç”¨ä¸€ä¸ªä¸»åŠ¨-ä¸»åŠ¨çš„æ¨¡å‹â€”â€”ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸ºä¹‹è®°å½•è¯·æ±‚å’Œå“åº”çš„å¯¹è±¡ã€‚å¯¹æ­¤è¿›è¡Œä¸€ä¸ªç»†å¾®çš„æ›´æ”¹ï¼Œç§°ä¹‹ä¸ºâ€œä¸»å¤‡æ¨¡å‹â€ï¼Œå°±æ˜¯é€‰å‡ºä¸€ä¸ªå‰¯æœ¬åšä¸º leaderï¼Œå¹¶å…è®¸å®ƒæŒ‰ç…§è¯·æ±‚åˆ°è¾¾çš„æ—¶é—´æ¥è¿›è¡Œå¤„ç†å¹¶ä»å¤„ç†è¿‡ç¨‹ä¸­è¾“å‡ºè®°å½•å…¶çŠ¶æ€æ”¹å˜çš„æ—¥å¿—ã€‚å…¶ä»–çš„å‰¯æœ¬æŒ‰ç…§ leader çŠ¶æ€æ”¹å˜çš„é¡ºåºè€Œåº”ç”¨é‚£äº›æ”¹å˜ï¼Œè¿™æ ·ä»–ä»¬ä¹‹é—´è¾¾åˆ°åŒæ­¥ï¼Œå¹¶èƒ½å¤Ÿåœ¨ leader å¤±è´¥çš„æ—¶å€™æ¥æ›¿ leader çš„å·¥ä½œã€‚ ä¸ºäº†ç†è§£ä¸¤ç§æ–¹å¼çš„ä¸åŒï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¸å¤ªä¸¥è°¨çš„ä¾‹å­ã€‚å‡å®šæœ‰ä¸€ä¸ªç®—æ³•æœåŠ¡çš„å‰¯æœ¬ï¼Œä¿æŒä¸€ä¸ªç‹¬ç«‹çš„æ•°å­—ä½œä¸ºå®ƒçš„çŠ¶æ€ï¼ˆåˆå§‹å€¼ä¸º 0ï¼‰ï¼Œå¹¶å¯¹è¿™ä¸ªå€¼è¿›è¡ŒåŠ æ³•å’Œä¹˜æ³•è¿ç®—ã€‚ä¸»åŠ¨-ä¸»åŠ¨æ–¹å¼åº”è¯¥ä¼šè¾“å‡ºæ‰€è¿›è¡Œçš„å˜æ¢ï¼Œæ¯”å¦‚â€œ+1â€ï¼Œâ€œ*2â€ç­‰ã€‚æ¯ä¸€ä¸ªå‰¯æœ¬éƒ½ä¼šåº”ç”¨è¿™äº›å˜æ¢ï¼Œä»è€Œå¾—åˆ°åŒæ ·çš„è§£é›†ã€‚ä¸»åŠ¨-è¢«åŠ¨æ–¹å¼å°†ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„ä¸»ä½“æ‰§è¡Œè¿™äº›å˜æ¢å¹¶è¾“å‡ºç»“æœæ—¥å¿—ï¼Œæ¯”å¦‚â€œ1â€ï¼Œâ€œ3â€ï¼Œâ€œ6â€ç­‰ã€‚è¿™ä¸ªä¾‹å­ä¹Ÿæ¸…æ¥šçš„å±•ç¤ºäº†ä¸ºä»€ä¹ˆè¯´é¡ºåºæ˜¯ä¿è¯å„å‰¯æœ¬é—´ä¸€è‡´æ€§çš„å…³é”®ï¼šä¸€æ¬¡åŠ æ³•å’Œä¹˜æ³•çš„é¡ºåºçš„æ”¹å˜å°†ä¼šå¯¼è‡´ä¸åŒçš„ç»“æœã€‚ åˆ†å¸ƒå¼æ—¥å¿—å¯ä»¥ç†è§£ä¸ºä¸€è‡´æ€§é—®é¢˜æ¨¡å‹çš„æ•°æ®ç»“æ„ã€‚å› ä¸ºæ—¥å¿—ä»£è¡¨äº†åç»­è¿½åŠ å€¼çš„ä¸€ç³»åˆ—å†³ç­–ã€‚ä½ éœ€è¦é‡æ–°å®¡è§† Paxos ç®—æ³•ç°‡ï¼Œå°½ç®¡æ—¥å¿—æ¨¡å—æ˜¯ä»–ä»¬æœ€å¸¸è§çš„åº”ç”¨ã€‚ åœ¨ Paxos ç®—æ³•ä¸­ï¼Œå®ƒé€šå¸¸é€šè¿‡ä½¿ç”¨ç§°ä¹‹ä¸ºå¤š paxos çš„åè®®ï¼Œè¿™ç§åè®®å°†æ—¥å¿—å»ºæ¨¡ä¸ºä¸€ç³»åˆ—çš„é—®é¢˜ï¼Œåœ¨æ—¥å¿—ä¸­æ¯ä¸ªé—®é¢˜éƒ½æœ‰å¯¹åº”çš„éƒ¨åˆ†ã€‚åœ¨ZABï¼Œ Raftç­‰å…¶å®ƒçš„åè®®ä¸­ï¼Œæ—¥å¿—çš„ä½œç”¨å°¤ä¸ºçªå‡ºï¼Œå®ƒç›´æ¥å¯¹ç»´æŠ¤åˆ†å¸ƒå¼çš„ã€ä¸€è‡´æ€§çš„æ—¥å¿—çš„é—®é¢˜å»ºæ¨¡ã€‚ æˆ‘æ€€ç–‘çš„æ˜¯ï¼Œæˆ‘ä»¬å°±å†å²å‘å±•çš„è§‚ç‚¹æ˜¯æœ‰åå·®çš„ï¼Œå¯èƒ½æ˜¯ç”±äºè¿‡å»çš„å‡ åå¹´ä¸­ï¼Œåˆ†å¸ƒå¼è®¡ç®—çš„ç†è®ºè¿œè¶…è¿‡äº†å…¶å®é™…åº”ç”¨ã€‚åœ¨ç°å®ä¸­ï¼Œå…±è¯†çš„é—®é¢˜æ˜¯æœ‰ç‚¹å¤ªç®€å•äº†ã€‚è®¡ç®—æœºç³»ç»Ÿå¾ˆå°‘éœ€è¦å†³å®šå•ä¸ªå€¼ï¼Œä»–ä»¬å‡ ä¹æ€»æ˜¯å¤„ç†æˆåºåˆ—çš„è¯·æ±‚ã€‚è¿™æ ·çš„è®°å½•ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç®€å•çš„å•å€¼å¯„å­˜å™¨ï¼Œè‡ªç„¶æ˜¯æ›´åŠ æŠ½è±¡ã€‚ æ­¤å¤–ï¼Œä¸“æ³¨äºç®—æ³•æ©ç›–äº† æŠ½è±¡ç³»ç»Ÿéœ€è¦çš„åº•å±‚çš„æ—¥å¿—ã€‚æˆ‘æ€€ç–‘ï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šæŠŠæ—¥å¿—ä¸­æ›´æ³¨é‡ä½œä¸ºä¸€ä¸ªå•†å“åŒ–çš„åŸºçŸ³ï¼Œä¸è®ºå…¶æ˜¯å¦ä»¥åŒæ ·çš„æ–¹å¼ å®æ–½çš„ï¼Œæˆ‘ä»¬ç»å¸¸è°ˆè®ºä¸€ä¸ªå“ˆå¸Œè¡¨è€Œä¸æ˜¯çº ç»“æˆ‘ä»¬ å¾—åˆ°æ˜¯ä¸æ˜¯å…·ä½“æŸä¸ªç»†èŠ‚çš„å“ˆå¸Œè¡¨ï¼Œä¾‹å¦‚çº¿æ€§æˆ–è€…å¸¦æœ‰ä»€ä¹ˆä»€ä¹ˆå…¶å®ƒå˜ä½“å“ˆå¸Œè¡¨ã€‚æ—¥å¿—å°†æˆä¸ºä¸€ç§å¤§ä¼—åŒ–çš„æ¥å£ï¼Œä¸ºå¤§å¤šæ•°ç®—æ³•å’Œå…¶å®ç°æå‡æä¾›æœ€å¥½çš„ä¿è¯å’Œæœ€ä½³çš„æ€§èƒ½ã€‚ Changelog 101: Tables and Events are Dual è®©æˆ‘ä»¬ç»§ç»­èŠæ•°æ®åº“ã€‚æ•°æ®åº“ä¸­å­˜åœ¨ç€å¤§é‡å˜æ›´æ—¥å¿—å’Œè¡¨ä¹‹é—´çš„äºŒç›¸æ€§ã€‚è¿™äº›æ—¥å¿—æœ‰ç‚¹ç±»ä¼¼å€Ÿè´·æ¸…å•å’Œé“¶è¡Œçš„æµç¨‹ï¼Œæ•°æ®åº“è¡¨å°±æ˜¯å½“å‰çš„ç›ˆä½™è¡¨ã€‚å¦‚æœä½ æœ‰å¤§é‡çš„å˜æ›´æ—¥å¿—ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨è¿™äº›å˜æ›´ç”¨ä»¥åˆ›å»ºæ•è·å½“å‰çŠ¶æ€çš„è¡¨ã€‚è¿™å¼ è¡¨å°†è®°å½•æ¯ä¸ªå…³é”®ç‚¹ï¼ˆæ—¥å¿—ä¸­ä¸€ä¸ªç‰¹åˆ«çš„æ—¶é—´ç‚¹ï¼‰çš„çŠ¶æ€ä¿¡æ¯ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ—¥å¿—æ˜¯éå¸¸åŸºæœ¬çš„æ•°æ®ç»“æ„çš„æ„ä¹‰æ‰€åœ¨ï¼šæ—¥å¿—å¯ç”¨æ¥åˆ›å»ºåŸºæœ¬è¡¨ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥åˆ›å»ºå„ç±»è¡ç”Ÿè¡¨ã€‚åŒæ—¶æ„å‘³ç€å¯ä»¥å­˜å‚¨éå…³ç³»å‹çš„å¯¹è±¡ã€‚ è¿™ä¸ªæµç¨‹ä¹Ÿæ˜¯å¯é€†çš„ï¼šå¦‚æœä½ æ­£åœ¨å¯¹ä¸€å¼ è¡¨è¿›è¡Œæ›´æ–°ï¼Œä½ å¯ä»¥è®°å½•è¿™äº›å˜æ›´ï¼Œ","date":"2019-07-04","objectID":"/the-log-every-software-engineer-should-know-about-real-time-data-unifying-abstraction/:1:1","tags":["database","distributed","log","ç¿»è¯‘"],"title":"The Log: What every software engineer should know about real-time data's unifying abstraction ä¸­æ–‡ç¿»è¯‘","uri":"/the-log-every-software-engineer-should-know-about-real-time-data-unifying-abstraction/"},{"categories":null,"content":"Part Two: Data Integration è¯·è®©æˆ‘é¦–å…ˆè§£é‡Š ä¸€ä¸‹â€œæ•°æ®é›†æˆâ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Œè¿˜æœ‰ä¸ºä»€ä¹ˆæˆ‘è§‰å¾—å®ƒå¾ˆé‡è¦ï¼Œä¹‹åæˆ‘ä»¬å†æ¥çœ‹çœ‹å®ƒå’Œæ—¥å¿—æœ‰ä»€ä¹ˆå…³ç³»ã€‚ Data integration is making all the data an organization has available in all its services and systems. æ•°æ®é›†æˆå°±æ˜¯å°†æ•°æ®ç»„ç»‡èµ·æ¥ï¼Œä½¿å¾—åœ¨ä¸å…¶æœ‰å…³çš„æœåŠ¡å’Œç³»ç»Ÿä¸­å¯ä»¥è®¿é—®å®ƒä»¬ è€Œæ›´å¸¸è§çš„æœ¯è¯­ ETL é€šå¸¸åªæ˜¯è¦†ç›–äº†æ•°æ®é›†æˆçš„ä¸€ä¸ªæœ‰é™å­é›†(è¯‘æ³¨ï¼šETLï¼ŒExtraction-Transformation-Loading çš„ç¼©å†™ï¼Œå³æ•°æ®æå–ã€è½¬æ¢å’ŒåŠ è½½)â€”â€”ç›¸å¯¹äºå…³ç³»å‹æ•°æ®ä»“åº“ã€‚ä½†æˆ‘æè¿°çš„ä¸œè¥¿å¾ˆå¤§ç¨‹åº¦ä¸Šå¯ä»¥ç†è§£ä¸ºï¼Œå°† ETL æ¨å¹¿è‡³å®æ—¶ç³»ç»Ÿå’Œå¤„ç†æµç¨‹ã€‚ å¯¹æ•°æ®çš„é«˜æ•ˆä½¿ç”¨éµå¾ªä¸€ç§ é©¬æ–¯æ´›çš„éœ€è¦å±‚æ¬¡ç†è®º ã€‚é‡‘å­—å¡”çš„åŸºç¡€éƒ¨åˆ†åŒ…æ‹¬æ•è·æ‰€æœ‰ç›¸å…³æ•°æ®ï¼Œèƒ½å¤Ÿå°†å®ƒä»¬å…¨éƒ¨æ”¾åˆ°é€‚å½“çš„å¤„ç†ç¯å¢ƒï¼ˆé‚£ä¸ªç¯å¢ƒåº”è¯¥æ˜¯ä¸€ä¸ªå¥‡å¦™çš„å®æ—¶æŸ¥è¯¢ç³»ç»Ÿï¼Œæˆ–è€…ä»…ä»…æ˜¯æ–‡æœ¬æ–‡ä»¶å’Œ python è„šæœ¬ï¼‰ã€‚è¿™äº›æ•°æ®éœ€è¦ä»¥ç»Ÿä¸€çš„æ–¹å¼å»ºæ¨¡ï¼Œè¿™æ ·å°±å¯ä»¥æ–¹ä¾¿è¯»å–å’Œæ•°æ®å¤„ç†ã€‚å¦‚æœè¿™ç§ä»¥ç»Ÿä¸€çš„æ–¹å¼æ•è·æ•°æ®çš„åŸºæœ¬éœ€æ±‚å¾—åˆ°æ»¡è¶³ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨åŸºç¡€è®¾æ–½ä¸Šä»¥è‹¥å¹²ç§æ–¹æ³•å¤„ç†è¿™äº›æ•°æ®â€”â€”æ˜ å°„åŒ–ç®€ï¼ˆMapReduceï¼‰ï¼Œå®æ—¶æŸ¥è¯¢ç³»ç»Ÿï¼Œç­‰ç­‰ã€‚ å¾ˆæ˜æ˜¾ï¼Œæœ‰ä¸€ç‚¹å€¼å¾—æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰å¯é çš„ã€å®Œæ•´çš„æ•°æ®æµï¼ŒHadoop é›†ç¾¤é™¤äº†è±¡æ˜‚è´µçš„ä¸”éš¾äºå®‰è£…çš„ç©ºé—´å–æš–å™¨å“ªæ ·å¤–ä¸ä¼šåšæ›´å¤šäº‹æƒ…äº†ã€‚ä¸€æ—¦æ•°æ®å’Œå¤„ç†å¯ç”¨ï¼Œäººä»¬å°±ä¼šå…³å¿ƒè‰¯å¥½æ•°æ®æ¨¡å‹å’Œä¸€è‡´åœ°æ˜“äºç†è§£çš„è¯­æ³•å“ªäº›æ›´ç»†è‡´çš„é—®é¢˜ã€‚æœ€åï¼Œäººä»¬æ‰ä¼šå…³æ³¨æ›´åŠ é«˜çº§çš„å¤„ç†-æ›´å¥½çš„å¯è§†åŒ–ã€æŠ¥è¡¨ä»¥åŠå¤„ç†å’Œé¢„æµ‹ç®—æ³•ã€‚ ä»¥æˆ‘çš„ç»éªŒï¼Œå¤§å¤šæ•°æœºæ„åœ¨æ•°æ®é‡‘å­—å¡”çš„åº•éƒ¨å­˜åœ¨å·¨å¤§çš„æ¼æ´-å®ƒä»¬ç¼ºä¹å¯é çš„ã€å®Œæ•´çš„æ•°æ®æµ-è€Œæ˜¯æ‰“ç®—ç›´æ¥è·³åˆ°é«˜çº§æ•°æ®æ¨¡å‹æŠ€æœ¯ä¸Šã€‚è¿™æ ·åšå®Œå…¨æ˜¯åç€æ¥åšçš„ã€‚ å› æ­¤ï¼Œé—®é¢˜æ˜¯æˆ‘ä»¬å¦‚ä½•æ„å»ºé€šè¿‡æœºæ„å†…æ‰€æœ‰æ•°æ®ç³»ç»Ÿçš„å¯é çš„æ•°æ®æµã€‚ Data Integration: Two complications ä¸¤ç§è¶‹åŠ¿ä½¿æ•°æ®é›†æˆå˜å¾—æ›´å›°éš¾ã€‚ ç¬¬ä¸€ä¸ªè¶‹åŠ¿æ˜¯å¢é•¿çš„äº‹ä»¶æ•°æ®(event data)ã€‚äº‹ä»¶æ•°æ®è®°å½•çš„æ˜¯å‘ç”Ÿçš„äº‹æƒ…ï¼Œè€Œä¸æ˜¯å­˜åœ¨çš„ä¸œè¥¿ã€‚åœ¨ web ç³»ç»Ÿä¸­ï¼Œè¿™å°±æ„å‘³ç€ç”¨æˆ·æ´»åŠ¨æ—¥å¿—ï¼Œè¿˜æœ‰ä¸ºäº†å¯é çš„æ“ä½œä»¥åŠç›‘æ§æ•°æ®ä¸­å¿ƒçš„æœºå™¨çš„ç›®çš„ï¼Œæ‰€éœ€è¦è®°å½•çš„æœºå™¨çº§åˆ«çš„äº‹ä»¶å’Œç»Ÿè®¡æ•°å­—ã€‚äººä»¬å€¾å‘ç§°å®ƒä»¬ä¸ºâ€œæ—¥å¿—æ•°æ®â€ï¼Œå› ä¸ºå®ƒä»¬ç»å¸¸è¢«å†™åˆ°åº”ç”¨çš„æ—¥å¿—ä¸­ï¼Œä½†æ˜¯è¿™æ··æ·†äº†å½¢å¼ä¸åŠŸèƒ½ã€‚è¿™ç§æ•°æ®ä½äºç°ä»£ web çš„ä¸­å¿ƒï¼šå½’æ ¹ç»“åº•ï¼ŒGoogle çš„èµ„äº§æ˜¯ç”±è¿™æ ·ä¸€äº›å»ºç«‹åœ¨ç‚¹å‡»å’Œæ˜ åƒåŸºç¡€ä¹‹ä¸Šçš„ç›¸å…³ç®¡é“æ‰€ç”Ÿæˆçš„â€”â€”é‚£ä¹Ÿå°±æ˜¯äº‹ä»¶ã€‚ è¿™äº›ä¸œè¥¿å¹¶ä¸æ˜¯ä»…é™äºç½‘ç»œå…¬å¸ï¼Œåªæ˜¯ç½‘ç»œå…¬å¸å·²ç»å®Œå…¨æ•°å­—åŒ–ï¼Œæ‰€ä»¥å®ƒä»¬æ›´å®¹æ˜“ç”¨è®¾å¤‡è®°å½•ã€‚è´¢åŠ¡æ•°æ®ä¸€ç›´æ˜¯é¢å‘äº‹ä»¶çš„ã€‚RFID(æ— çº¿å°„é¢‘è¯†åˆ«)å°†è¿™ç§è·Ÿè¸ªèƒ½åŠ›èµ‹äºˆç‰©ç†å¯¹è±¡ã€‚æˆ‘è®¤ä¸ºè¿™ç§è¶‹åŠ¿ä»å°†ç»§ç»­ï¼Œä¼´éšç€è¿™ä¸ªè¿‡ç¨‹çš„æ˜¯ä¼ ç»Ÿå•†åŠ¡æ´»åŠ¨çš„æ•°å­—åŒ–ã€‚ è¿™ç§ç±»å‹çš„äº‹ä»¶æ•°æ®è®°å½•ä¸‹å‘ç”Ÿçš„äº‹æƒ…ï¼Œè€Œä¸”å¾€å¾€æ¯”ä¼ ç»Ÿæ•°æ®åº“åº”ç”¨è¦å¤§å¥½å‡ ä¸ªæ•°é‡çº§ã€‚è¿™å¯¹äºå¤„ç†æå‡ºäº†é‡å¤§æŒ‘æˆ˜ã€‚ TThe explosion of specialized data systems ç¬¬äºŒä¸ªè¶‹åŠ¿æ¥è‡ªäºä¸“é—¨çš„æ•°æ®ç³»ç»Ÿçš„çˆ†å‘ï¼Œé€šå¸¸è¿™äº›æ•°æ®ç³»ç»Ÿåœ¨æœ€è¿‘çš„äº”å¹´ä¸­å¼€å§‹å˜å¾—æµè¡Œï¼Œå¹¶ä¸”å¯ä»¥å…è´¹è·å¾—ã€‚ä¸“é—¨çš„æ•°æ®ç³»ç»Ÿæ˜¯ä¸ºOLAP, æœç´¢, ç®€å• åœ¨çº¿ å­˜å‚¨, æ‰¹å¤„ç†, å›¾åƒåˆ†æ, ç­‰ ç­‰ è€Œå­˜åœ¨çš„ã€‚ æ›´å¤šçš„ä¸åŒç±»å‹æ•°æ®çš„ç»„åˆï¼Œä»¥åŠå°†è¿™äº›æ•°æ®å­˜æ”¾åˆ°æ›´å¤šçš„ç³»ç»Ÿä¸­çš„æ„¿æœ›ï¼Œå¯¼è‡´äº†ä¸€ä¸ªå·¨å¤§çš„æ•°æ®é›†æˆé—®é¢˜ã€‚ Log-structured data flow ä¸ºäº†å¤„ç†ç³»ç»Ÿä¹‹é—´çš„æ•°æ®æµï¼Œæ—¥å¿—æ˜¯æœ€è‡ªç„¶çš„æ•°æ®ç»“æ„ã€‚å…¶ä¸­çš„ç§˜è¯€å¾ˆç®€å•ï¼š å°†æ‰€æœ‰ç»„ç»‡çš„æ•°æ®æå–å‡ºæ¥ï¼Œå¹¶å°†å®ƒä»¬æ”¾åˆ°ä¸€ä¸ªä¸­å¿ƒæ—¥å¿—ï¼Œä»¥ä¾¿å®æ—¶æŸ¥é˜…ã€‚ æ¯ä¸ªé€»è¾‘æ•°æ®æºéƒ½å¯ä»¥å»ºæ¨¡ä¸ºå®ƒè‡ªå·±çš„æ—¥å¿—ã€‚ä¸€ä¸ªæ•°æ®æºå¯ä»¥æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„äº‹ä»¶æ—¥å¿—ï¼ˆå¦‚ç‚¹å‡»é‡æˆ–è€…é¡µé¢æµè§ˆé‡ï¼‰ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæ¥å—ä¿®æ”¹çš„æ•°æ®åº“è¡¨ã€‚æ¯ä¸ªè®¢é˜…æ¶ˆæ¯çš„ç³»ç»Ÿéƒ½å°½å¯èƒ½å¿«çš„ä»æ—¥å¿—è¯»å–ä¿¡æ¯ï¼Œå°†æ¯æ¡æ–°çš„è®°å½•ä¿å­˜åˆ°è‡ªå·±çš„å­˜å‚¨ï¼Œå¹¶ä¸”æå‡å…¶åœ¨æ—¥å¿—ä¸­çš„åœ°ä½ã€‚è®¢é˜…æ–¹å¯ä»¥æ˜¯ä»»æ„ä¸€ç§æ•°æ®ç³»ç»Ÿ â€”â€” ä¸€ä¸ªç¼“å­˜ï¼ŒHadoopï¼Œå¦ä¸€ä¸ªç½‘ç«™ä¸­çš„å¦ä¸€ä¸ªæ•°æ®åº“ï¼Œä¸€ä¸ªæœç´¢ç³»ç»Ÿï¼Œç­‰ç­‰ã€‚ ä¾‹å¦‚ï¼Œæ—¥å¿—é’ˆå¯¹æ¯ä¸ªæ›´æ”¹ç»™å‡ºäº†é€»è¾‘æ—¶é’Ÿçš„æ¦‚å¿µï¼Œè¿™æ ·æ‰€æœ‰çš„è®¢é˜…æ–¹éƒ½å¯ä»¥è¢«æµ‹é‡ã€‚æ¨å¯¼ä¸åŒçš„è®¢é˜…ç³»ç»Ÿçš„çŠ¶æ€ä¹Ÿå› æ­¤å˜å¾—ç›¸å¯¹ç®€å•çš„å¤šï¼Œå› ä¸ºæ¯ä¸ªç³»ç»Ÿéƒ½æœ‰ä¸€ä¸ªè¯»å–åŠ¨ä½œçš„â€œæ—¶é—´ç‚¹â€ã€‚ ä¸ºäº†è®©è¿™ä¸ªæ˜¾å¾—æ›´å…·ä½“ï¼Œæˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹ï¼Œæœ‰ä¸€ä¸ªæ•°æ®åº“å’Œä¸€ç»„ç¼“å­˜æœåŠ¡å™¨é›†ç¾¤ã€‚æ—¥å¿—æä¾›äº†ä¸€ç§åŒæ­¥æ›´æ–°æ‰€æœ‰è¿™äº›ç³»ç»Ÿï¼Œå¹¶æ¨å¯¼å‡ºæ¯ä¸€ä¸ªç³»ç»Ÿçš„æ¥è§¦æ—¶é—´ç‚¹çš„æ–¹æ³•ã€‚æˆ‘ä»¬å‡è®¾å†™äº†ä¸€æ¡æ—¥å¿— Xï¼Œç„¶åéœ€è¦ä»ç¼“å­˜åšä¸€æ¬¡è¯»å–ã€‚å¦‚æœæˆ‘ä»¬æƒ³ä¿è¯çœ‹åˆ°çš„ä¸æ˜¯é™ˆæ—§çš„æ•°æ®ï¼Œæˆ‘ä»¬åªéœ€ä¿è¯æ²¡æœ‰ä»ä»»ä½•å°šæœªå¤åˆ¶ X çš„ç¼“å­˜ä¸­è¯»å–å³å¯ã€‚ æ—¥å¿—ä¹Ÿèµ·åˆ°ç¼“å­˜çš„ä½œç”¨ï¼Œä½¿æ•°æ®ç”Ÿäº§ä¸æ•°æ®æ¶ˆè´¹ç›¸åŒæ­¥ã€‚ç”±äºè®¸å¤šåŸå› è¿™ä¸ªåŠŸèƒ½å¾ˆé‡è¦ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šä¸ªè®¢é˜…æ–¹æ¶ˆè´¹æ•°æ®çš„é€Ÿåº¦å„ä¸ç›¸åŒçš„æ—¶å€™ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªè®¢é˜…æ•°æ®ç³»ç»Ÿå¯ä»¥å®•æœºï¼Œæˆ–è€…ä¸‹çº¿ç»´æŠ¤ï¼Œä¹‹åé‡æ–°ä¸Šçº¿ä»¥åå†èµ¶ä¸Šæ¥ï¼šè®¢é˜…æ–¹æŒ‰ç…§è‡ªå·±æ§åˆ¶çš„èŠ‚æ‹æ¥æ¶ˆè´¹æ•°æ®ã€‚æ‰¹å¤„ç†ç³»ç»Ÿï¼Œå¦‚ Hadoop æˆ–è€…æ˜¯ä¸€ä¸ªæ•°æ®ä»“åº“ï¼Œæˆ–è®¸åªæ˜¯æ¯å°æ—¶æˆ–è€…æ¯å¤©æ¶ˆè´¹ä¸€æ¬¡æ•°æ®ï¼Œè€Œå®æ—¶æŸ¥è¯¢ç³»ç»Ÿå¯èƒ½éœ€è¦åŠæ—¶åˆ°ç§’ã€‚ç”±äºæ— è®ºæ˜¯åŸå§‹æ•°æ®æºè¿˜æ˜¯æ—¥å¿—ï¼Œéƒ½æ²¡æœ‰å„ç§ç›®æ ‡æ•°æ®ç³»ç»Ÿçš„ç›¸å…³çŸ¥è¯†ï¼Œå› æ­¤æ¶ˆè´¹æ–¹ç³»ç»Ÿå¯ä»¥è¢«æ·»åŠ å’Œåˆ é™¤ï¼Œè€Œæ— éœ€ä¼ è¾“ç®¡é“çš„å˜åŒ–ã€‚ Eache working data pipeline is designed like a log; each broken data pipeline is broken is its own way â€“ Anna Karenina principle ç‰¹åˆ«é‡è¦çš„æ˜¯ï¼šç›®æ ‡ç³»ç»ŸåªçŸ¥é“æ—¥å¿—è€Œä¸çŸ¥é“åŸå§‹ç³»ç»Ÿçš„ä»»ä½•ç»†èŠ‚ã€‚ æ¶ˆè´¹è€…ç³»ç»Ÿä¸éœ€è¦å…³å¿ƒæ•°æ®æ˜¯æ¥è‡ª RDBMSï¼Œæ–°çš„é”®å€¼å­˜å‚¨ï¼Œè¿˜æ˜¯æ²¡æœ‰ä»»ä½•ç±»å‹çš„å®æ—¶æŸ¥è¯¢ç³»ç»Ÿã€‚ è¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªå°é—®é¢˜ï¼Œä½†å®é™…ä¸Šæ˜¯éœ€è¦ä»”ç»†é‰´åˆ«çš„(critical)ã€‚ è¿™é‡Œæˆ‘ä½¿ç”¨æœ¯è¯­â€œæ—¥å¿—â€å–ä»£äº†â€œæ¶ˆæ¯ç³»ç»Ÿâ€æˆ–è€…â€œå‘å¸ƒ-è®¢é˜…â€ï¼Œå› ä¸ºå®ƒåœ¨è¯­ä¹‰ä¸Šæ›´æ˜ç¡®ï¼Œå¹¶ä¸”å¯¹æ”¯æŒæ•°æ®å¤åˆ¶çš„å®é™…å®ç°è¿™æ ·çš„éœ€æ±‚ï¼Œæœ‰ç€æ›´æ¥è¿‘çš„æè¿°ã€‚æˆ‘å‘ç°â€œå‘å¸ƒè®¢é˜…â€å¹¶ä¸æ¯”é—´æ¥å¯»å€çš„æ¶ˆæ¯å…·æœ‰æ›´å¤šçš„å«ä¹‰â€”â€”å¦‚æœä½ æ¯”è¾ƒä»»ä½•ä¸¤ä¸ªå‘å¸ƒ-è®¢é˜…çš„æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿçš„è¯ï¼Œä½ ä¼šå‘ç°ä»–ä»¬æ‰¿è¯ºçš„æ˜¯å®Œå…¨ä¸åŒçš„ä¸œè¥¿ï¼Œè€Œä¸”å¤§å¤šæ•°æ¨¡å‹åœ¨è¿™ä¸€é¢†åŸŸéƒ½ä¸æ˜¯æœ‰ç”¨çš„ã€‚ä½ å¯ä»¥è®¤ä¸ºæ—¥å¿—æ˜¯ä¸€ç§æ¶ˆæ¯ç³»ç»Ÿï¼Œå®ƒå…·æœ‰æŒä¹…æ€§ä¿è¯å’Œå¼ºå¤§çš„è®¢é˜…è¯­ä¹‰ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªé€šä¿¡æ¨¡å‹æœ‰æ—¶æœ‰ä¸ª(æœ‰äº›å¯æ€•çš„)åå­—å«åšatomic broadcastã€‚ å€¼å¾—å¼ºè°ƒçš„æ˜¯ï¼Œæ—¥å¿—ä»ç„¶åªæ˜¯åŸºç¡€è®¾æ–½ã€‚è¿™å¹¶ä¸æ˜¯ç®¡ç†æ•°æ®æµè¿™ä¸ªæ•…äº‹çš„ç»“æŸï¼šæ•…äº‹çš„å…¶ä½™éƒ¨åˆ†å›´ç»•ç€å…ƒæ•°æ®ï¼Œæ¨¡å¼ï¼Œå…¼å®¹æ€§ï¼Œä»¥åŠå¤„ç†æ•°æ®ç»“æ„çš„æ‰€æœ‰ç»†èŠ‚åŠå…¶æ¼”åŒ–ã€‚é™¤éæœ‰ä¸€ç§å¯é çš„ï¼Œä¸€èˆ¬çš„æ–¹æ³•æ¥å¤„ç†æ•°æ®æµè¿ä½œï¼Œè¯­ä¹‰åœ¨å…¶ä¸­æ€»æ˜¯æ¬¡è¦çš„ç»†èŠ‚ã€‚ At LinkedIn åœ¨ LinkedIn ä»é›†ä¸­å¼å…³ç³»æ•°æ®åº“å‘åˆ†å¸ƒå¼ç³»ç»Ÿé›†åˆè½¬åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘çœ‹åˆ°è¿™ä¸ªæ•°æ®é›†æˆé—®é¢˜è¿…é€Ÿæ¼”å˜ã€‚ ä¸»è¦çš„æ•°æ®ç³»ç»ŸåŒ…æ‹¬ï¼š Search Social Graph Voldemort (key-value store) Espresso (document store) Recommendation engine OLAP query engine Hadoop Terradata Ingraphs (monitoring graphs and metrics services) è¿™ç§ä½¿ç”¨æ—¥å¿—ä½œä¸ºæ•°æ®æµçš„æ€æƒ³ï¼Œç”šè‡³åœ¨æˆ‘åˆ°è¿™é‡Œä¹‹å‰å°±å·²ç»ä¸ LinkedIn ç›¸ä¼´äº†ã€‚æˆ‘ä»¬å¼€å‘çš„ä¸€ä¸ªæœ€æ—©çš„åŸºç¡€è®¾æ–½ä¹‹ä¸€ï¼Œæ˜¯ä¸€ç§ç§°ä¸º databus çš„æœåŠ¡ï¼Œå®ƒåœ¨æˆ‘ä»¬æ—©æœŸçš„ Oracle è¡¨ä¸Šæä¾›äº†ä¸€ç§æ—¥å¿—ç¼“å­˜æŠ½è±¡ï¼Œå¯ä¼¸ç¼©è®¢é˜…æ•°æ®åº“ä¿®æ”¹,è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾ˆå¥½æ”¯æŒæˆ‘ä»¬çš„ç¤¾äº¤ç½‘ç»œå’Œæœç´¢ç´¢å¼•ã€‚ æˆ‘ä¼šç»™å‡ºä¸€äº›å†å²å¹¶äº¤ä»£ä¸€ä¸‹ä¸Šä¸‹æ–‡ã€‚æˆ‘é¦–æ¬¡å‚ä¸åˆ°è¿™äº›å¤§çº¦æ˜¯åœ¨ 2008 å¹´å·¦å³ï¼Œåœ¨æˆ‘ä»¬è½¬ç§»é”®å€¼å­˜å‚¨ä¹‹åã€‚æˆ‘çš„ä¸‹ä¸€ä¸ªé¡¹ç›®æ˜¯è®©ä¸€ä¸ªå·¥ä½œä¸­çš„ Hadoop é…ç½®æ¼”è¿›ï¼Œå¹¶ç»™å…¶å¢åŠ ä¸€äº›æˆ‘ä»¬çš„æ¨èæµç¨‹ã€‚ç”±äºç¼ºä¹è¿™æ–¹é¢çš„ç»éªŒï¼Œæˆ‘ä»¬è‡ªç„¶è€Œç„¶çš„å®‰æ’äº†æ•°å‘¨è®¡åˆ’åœ¨æ•°æ®çš„å¯¼å…¥å¯¼å‡ºæ–¹é¢ï¼Œå‰©ä¸‹çš„æ—¶é—´åˆ™ç”¨æ¥å®ç°å¥‡å¦™çš„é¢„æµ‹ç®—æ³•ã€‚è¿™æ ·æˆ‘ä»¬å°±å¼€å§‹äº†é•¿é€”è·‹æ¶‰ã€‚ æˆ‘ä»¬æœ¬æ¥è®¡åˆ’æ˜¯ä»…ä»…å°†æ•°æ®ä»ç°å­˜çš„ Oracle æ•°æ®ä»“åº“ä¸­å‰–ç¦»ã€‚ä½†æ˜¯æˆ‘ä»¬é¦–å…ˆå‘ç°å°†æ•°æ®ä» Oracle ä¸­è¿…é€Ÿå–å‡ºæ˜¯ä¸€ç§é»‘æš—è‰ºæœ¯ã€‚æ›´ç³Ÿçš„æ˜¯ï¼Œæ•°æ®ä»“åº“çš„å¤„ç†è¿‡ç¨‹ä¸æˆ‘ä»¬ä¸º Hadoop è€Œè®¡åˆ’çš„æ‰¹å¤„ç†ç”Ÿäº§è¿‡ç¨‹ä¸é€‚åˆâ€”â€”å…¶å¤§éƒ¨åˆ†å¤„ç†éƒ½æ˜¯ä¸å¯é€†è½¬çš„ï¼Œå¹¶ä¸”ä¸å³å°†ç”Ÿæˆçš„æŠ¥å‘Šå…·ä½“ç›¸å…³ã€‚æœ€ç»ˆæˆ‘ä»¬é‡‡å–çš„åŠæ³•æ˜¯ï¼Œé¿å…ä½¿ç”¨æ•°æ®ä»“åº“ï¼Œç›´æ¥è®¿é—®æºæ•°æ®åº“å’Œæ—¥å¿—æ–‡ä»¶ã€‚æœ€åï¼Œæˆ‘ä»¬ä¸ºäº†åŠ è½½æ•°æ®åˆ°é”®å€¼å­˜å‚¨ å¹¶ç”Ÿæˆç»“æœï¼Œå®ç°äº†å¦å¤–ä¸€ç§ç®¡é“ã€‚ è¿™ç§æ™®é€šçš„æ•°æ®å¤åˆ¶æœ€ç»ˆæˆä¸ºåŸå§‹å¼€å‘é¡¹ç›®çš„ä¸»è¦å†…å®¹ä¹‹ä¸€ã€‚ç³Ÿç³•çš„æ˜¯ï¼Œåœ¨ä»»ä½•æ—¶é—´ä»»æ„ç®¡é“éƒ½æœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒHadoop ç³»ç»Ÿå¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯æ— ç”¨çš„â€”â€”åœ¨é”™è¯¯çš„æ•°æ®åŸºç¡€ä¸Šè¿è¡Œå¥‡ç‰¹çš„(fancy)ç®—æ³•ï¼Œåªä¼šäº§ç”Ÿæ›´å¤šçš„é”™è¯¯æ•°æ®ã€‚ è™½ç„¶æˆ‘ä»¬å·²ç»ä»¥ä¸€ç§é€šç”¨çš„æ–¹å¼åˆ›å»ºäº‹ç‰©ï¼Œä½†æ˜¯æ¯ä¸ªæ•°æ®æºéƒ½éœ€è¦è‡ªå®šä¹‰é…ç½®å®‰è£…ã€‚è¿™ä¹Ÿè¢«è¯æ˜æ˜¯å·¨é‡é”™è¯¯ä¸å¤±è´¥çš„æ ¹æºã€‚æˆ‘ä»¬åœ¨ Hadoop ä¸Šå®ç°çš„ç½‘ç«™åŠŸèƒ½å·²ç»å¼€å§‹æµè¡Œèµ·æ¥ï¼ŒåŒæ—¶æˆ‘ä»¬å‘ç°æˆ‘ä»¬æœ‰ä¸€é•¿ä¸²æ„Ÿå…´è¶£çš„å·¥ç¨‹å¸ˆã€‚æ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä»–ä»¬æƒ³è¦é›†æˆçš„ä¸€ç³»åˆ—ç³»ç»Ÿï¼Œä»–ä»¬æƒ³è¦çš„ä¸€ç³»åˆ—æ–°æ•°æ®æºã€‚ ETL in Ancient Greece. Not much has changed. æœ‰äº›ä¸œè¥¿åœ¨æˆ‘é¢å‰å¼€å§‹æ¸æ¸æ¸…æ™°èµ·æ¥ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å·²å»ºæˆçš„é€šé“è™½ç„¶æœ‰ä¸€äº›æ‚ä¹±ï¼Œä½†å®è´¨ä¸Šå®ƒä»¬æ˜¯å¾ˆæœ‰ä»·å€¼çš„ã€‚åœ¨é‡‡ç”¨è¯¸å¦‚ Hadoop çš„æ–°çš„å¤„ç†ç³»ç»Ÿç”Ÿæˆå¯ç”¨æ•°æ®çš„è¿‡ç¨‹ï¼Œå®ƒè§£é”äº†å¤§é‡çš„å¯èƒ½æ€§ã€‚ åŸºäºè¿™äº›æ•°æ®è¿‡å»å¾ˆéš¾å®ç°çš„è®¡ç®—ï¼Œå¦‚ä»Šå˜ä¸ºå¯èƒ½ã€‚ è®¸å¤šæ–°çš„äº§å“å’Œåˆ†ææŠ€æœ¯éƒ½æ¥æºäºæŠŠåˆ†ç‰‡çš„æ•°æ®æ”¾åœ¨ä¸€èµ·ï¼Œè¿™äº›æ•°æ®è¢«é”å®šåœ¨ç‰¹å®šçš„ç³»ç»Ÿä¸­ã€‚ ç¬¬äºŒï¼Œ ä¼—æ‰€å‘¨çŸ¥ï¼Œå¯é çš„æ•°","date":"2019-07-04","objectID":"/the-log-every-software-engineer-should-know-about-real-time-data-unifying-abstraction/:1:2","tags":["database","distributed","log","ç¿»è¯‘"],"title":"The Log: What every software engineer should know about real-time data's unifying abstraction ä¸­æ–‡ç¿»è¯‘","uri":"/the-log-every-software-engineer-should-know-about-real-time-data-unifying-abstraction/"},{"categories":null,"content":"Part Three: Logs \u0026 Real-time Stream Processing åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘åªæ˜¯æè¿°ä»ç«¯åˆ°ç«¯æ•°æ®å¤åˆ¶çš„ç†æƒ³æœºåˆ¶ã€‚ä½†æ˜¯åœ¨å­˜å‚¨ç³»ç»Ÿä¸­æ¬è¿å­—èŠ‚ä¸æ˜¯æ‰€è¦è®²è¿°å†…å®¹çš„å…¨éƒ¨ã€‚æœ€ç»ˆæˆ‘ä»¬å‘ç°æ—¥å¿—æ˜¯æµçš„å¦ä¸€ç§è¯´æ³•ï¼Œæ—¥å¿—æ˜¯æµå¤„ç†çš„æ ¸å¿ƒã€‚ ä½†æ˜¯ï¼Œç­‰ç­‰ï¼Œä»€ä¹ˆæ˜¯æµå¤„ç†å‘¢ï¼Ÿ å¦‚æœä½ æ˜¯ 90 å¹´ä»£æ™šæœŸæˆ–è€… 21 ä¸–çºªåˆæ•°æ®åº“æ–‡åŒ–æˆ–è€…æ•°æ®åŸºç¡€æ¶æ„äº§å“çš„çˆ±å¥½è€…ï¼Œé‚£ä¹ˆä½ å°±å¯èƒ½ä¼šæŠŠæµå¤„ç†ä¸å»ºåˆ› SQL å¼•æ“æˆ–è€…åˆ›å»ºâ€œç®±å­å’Œç®­å¤´â€æ¥å£ç”¨äºäº‹ä»¶é©±åŠ¨çš„å¤„ç†ç­‰è”ç³»èµ·æ¥ã€‚ å¦‚æœä½ å…³æ³¨å¼€æºæ•°æ®åº“ç³»ç»Ÿçš„å¤§é‡å‡ºç°ï¼Œä½ å°±å¯èƒ½æŠŠæµå¤„ç†å’Œä¸€äº›å¼€æºæ•°æ®åº“ç³»ç»Ÿå…³è”èµ·æ¥ï¼Œè¿™äº›ç³»ç»ŸåŒ…æ‹¬äº†ï¼šStorm,Akka,S4å’ŒSamza.ä½†æ˜¯å¤§éƒ¨åˆ†äººä¼šæŠŠè¿™äº›ç³»ç»Ÿä½œä¸ºå¼‚æ­¥æ¶ˆæ¯å¤„ç†ç³»ç»Ÿï¼Œè¿™äº›ç³»ç»Ÿä¸æ”¯æŒç¾¤é›†çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨å±‚çš„åº”ç”¨æ²¡ä»€ä¹ˆå·®åˆ«ï¼ˆè€Œäº‹å®ä¸Šåœ¨å¼€æºæ•°æ®åº“ç³»ç»Ÿé¢†åŸŸæŸäº›æ–¹é¢ç¡®å®å¦‚æ­¤ï¼‰ã€‚ è¿™äº›è§†å›¾éƒ½æœ‰ä¸€äº›å±€é™æ€§ã€‚æµå¤„ç†ä¸ SQL æ˜¯æ— å…³çš„ã€‚å®ƒä¹Ÿå±€é™äºå®æ—¶æµå¤„ç†ã€‚ä¸å­˜åœ¨å†…åœ¨çš„åŸå› é™åˆ¶ä½ ä¸èƒ½å¤„ç†æ˜¨å¤©çš„æˆ–è€…ä¸€ä¸ªæœˆä¹‹å‰çš„æµæ•°æ®ï¼Œä¸”ä½¿ç”¨å¤šç§ä¸åŒçš„è¯­è¨€è¡¨è¾¾è®¡ç®—ã€‚ æˆ‘æŠŠæµå¤„ç†è§†ä¸ºæ›´å¹¿æ³›çš„æ¦‚å¿µï¼šæŒç»­æ•°æ®æµå¤„ç†çš„åŸºç¡€æ¶æ„ã€‚æˆ‘è®¤ä¸ºè®¡ç®—æ¨¡å‹å¯ä»¥åƒ MapReduce æˆ–è€…åˆ†å¸ƒå¼å¤„ç†æ¶æ„ä¸€æ ·æ™®éï¼Œä½†æ˜¯æœ‰èƒ½åŠ›å¤„ç†ä½æ—¶å»¶çš„ç»“æœã€‚ å¤„ç†æ¨¡å‹çš„å®æ—¶é©±åŠ¨æ˜¯æ•°æ®æ”¶é›†æ–¹æ³•ã€‚æˆæ‰¹æ”¶é›†çš„æ•°æ®æ˜¯åˆ†æ‰¹å¤„ç†çš„ã€‚æ•°æ®æ˜¯ä¸æ–­æ”¶é›†çš„ï¼Œå®ƒä¹Ÿæ˜¯æŒ‰é¡ºåºä¸æ–­å¤„ç†çš„ã€‚ ç¾å›½çš„ç»Ÿè®¡è°ƒæŸ¥å°±æ˜¯æˆæ‰¹æ”¶é›†æ•°æ®çš„è‰¯å¥½å…¸èŒƒã€‚ç»Ÿè®¡è°ƒæŸ¥å‘¨æœŸæ€§çš„å¼€å±•ï¼Œé€šè¿‡æŒ¨é—¨æŒ¨æˆ·çš„èµ°è®¿ï¼Œä½¿ç”¨è›®åŠ›å‘ç°å’Œç»Ÿè®¡ç¾å›½çš„å…¬æ°‘ä¿¡æ¯ã€‚1790 å¹´ç»Ÿè®¡è°ƒæŸ¥åˆšåˆšå¼€å§‹æ—¶è¿™ç§æ–¹å¼æ˜¯å¥æ•ˆçš„ã€‚é‚£æ—¶çš„æ•°æ®æ”¶é›†æ˜¯æ‰¹å¤„ç†çš„ï¼Œå®ƒåŒ…æ‹¬äº†éª‘ç€é©¬æ‚ é—²çš„è¡Œè¿›ï¼ŒæŠŠä¿¡æ¯å†™åœ¨çº¸ä¸Šï¼Œç„¶åæŠŠæˆæ‰¹çš„è®°å½•ä¼ é€åˆ°äººä»¬ç»Ÿè®¡æ•°æ®çš„ä¸­å¿ƒç«™ç‚¹ã€‚ç°åœ¨ï¼Œåœ¨æè¿°è¿™ä¸ªç»Ÿè®¡è¿‡ç¨‹æ—¶ï¼Œäººä»¬ç«‹å³ä¼šæƒ³åˆ°ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ä¿ç•™å‡ºç”Ÿå’Œæ­»äº¡çš„è®°å½•ï¼Œè¿™æ ·å°±å¯ä»¥äº§ç”Ÿäººå£ç»Ÿè®¡ä¿¡æ¯è¿™äº›ä¿¡æ¯æˆ–æ˜¯æŒç»­çš„æˆ–è€…æ˜¯å…¶å®ƒç»´åº¦çš„ã€‚ è¿™æ˜¯ä¸€ä¸ªæç«¯çš„ä¾‹å­ï¼Œä½†æ˜¯å¤§é‡çš„æ•°æ®ä¼ é€å¤„ç†ä»ç„¶ä¾èµ–äºå‘¨æœŸæ€§çš„è½¬å‚¨ï¼Œæ‰¹é‡è½¬åŒ–å’Œé›†æˆã€‚å¤„ç†å¤§å®¹é‡è½¬å‚¨çš„å”¯ä¸€æ–¹æ³•å°±æ˜¯æ‰¹é‡çš„å¤„ç†ã€‚ä½†æ˜¯éšç€è¿™äº›æ‰¹å¤„ç†è¢«æŒç»­çš„ä¾›ç»™æ‰€å–ä»£ï¼Œäººä»¬è‡ªç„¶è€Œç„¶çš„å¼€å§‹ä¸é—´æ–­çš„å¤„ç†ä»¥å¹³æ»‘çš„å¤„ç†æ‰€éœ€èµ„æºå¹¶ä¸”æ¶ˆé™¤å»¶è¿Ÿã€‚ ä¾‹å¦‚ LinkedIn å‡ ä¹æ²¡æœ‰æ‰¹é‡æ•°æ®æ”¶é›†ã€‚å¤§éƒ¨åˆ†çš„æ•°æ®æˆ–è€…æ˜¯æ´»åŠ¨æ•°æ®æˆ–è€…æ˜¯æ•°æ®åº“å˜æ›´ï¼Œè¿™ä¸¤è€…éƒ½æ˜¯ä¸é—´æ–­å‘ç”Ÿçš„ã€‚äº‹å®ä¸Šï¼Œä½ å¯ä»¥æƒ³åˆ°çš„ä»»ä½•å•†ä¸šï¼Œæ­£å¦‚ï¼šJack Bauer å‘Šè¯‰æˆ‘ä»¬çš„ï¼Œä½å±‚çš„æœºåˆ¶éƒ½æ˜¯å®æ—¶å‘ç”Ÿçš„ä¸é—´æ–­çš„æµç¨‹äº‹ä»¶ã€‚æ•°æ®æ˜¯æˆæ‰¹æ”¶é›†çš„ï¼Œå®ƒæ€»æ˜¯ä¼šä¾èµ–äºä¸€äº›äººä¸ºçš„æ­¥éª¤ï¼Œæˆ–è€…ç¼ºå°‘æ•°å­—åŒ–æˆ–è€…æ˜¯ä¸€äº›è‡ªåŠ¨åŒ–çš„éæ•°å­—åŒ–æµç¨‹å¤„ç†çš„é—ç•™ä¿¡æ¯ã€‚å½“ä¼ é€å’Œå¤„ç†è¿™äº›æ•°æ®çš„æœºåˆ¶æ˜¯é‚®ä»¶æˆ–è€…äººå·¥çš„å¤„ç†æ—¶ï¼Œè¿™ä¸€è¿‡ç¨‹æ˜¯éå¸¸ç¼“æ…¢çš„ã€‚é¦–è½®è‡ªåŠ¨åŒ–æ€»æ˜¯ä¿æŒç€æœ€åˆçš„å¤„ç†å½¢å¼ï¼Œå®ƒå¸¸å¸¸ä¼šæŒç»­ç›¸å½“é•¿çš„æ—¶é—´ã€‚ æ¯å¤©è¿è¡Œçš„æ‰¹é‡å¤„ç†ä½œä¸šå¸¸å¸¸æ˜¯æ¨¡æ‹Ÿäº†ä¸€ç§ä¸€å¤©çš„çª—å£å¤§å°çš„ä¸é—´æ–­è®¡ç®—ã€‚å½“ç„¶ï¼Œä½å±‚çš„æ•°æ®ä¹Ÿç»å¸¸å˜åŒ–ã€‚åœ¨ LinkedIn,è¿™äº›æ˜¯å¸ç©ºè§è´¯çš„ï¼Œå¹¶ä¸”ä½¿å¾—å®ƒä»¬åœ¨ Hadoop è¿è½¬çš„æœºåˆ¶æ˜¯æœ‰æŠ€å·§çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å®æ–½äº†ä¸€æ•´å¥—ç®¡ç†å¢é‡çš„ Hadoop å·¥ä½œæµçš„æ¶æ„ã€‚ ç”±æ­¤çœ‹æ¥ï¼Œå¯¹äºæµå¤„ç†å¯ä»¥æœ‰ä¸åŒçš„è§‚ç‚¹ã€‚æµå¤„ç†åŒ…æ‹¬äº†åœ¨åº•å±‚æ•°æ®å¤„ç†çš„æ—¶é—´æ¦‚å¿µï¼Œå®ƒä¸éœ€è¦æ•°æ®çš„é™æ€å¿«ç…§ï¼Œå®ƒå¯ä»¥äº§ç”Ÿç”¨æˆ·å¯æ§é¢‘ç‡çš„è¾“å‡ºï¼Œè€Œä¸ç”¨ç­‰å¾…æ•°æ®é›†çš„å…¨éƒ¨åˆ°è¾¾ã€‚ä»è¿™ä¸ªè§’åº¦ä¸Šè®²ï¼Œæµå¤„ç†å°±æ˜¯å¹¿ä¹‰ä¸Šçš„æ‰¹å¤„ç†ï¼Œéšç€å®æ—¶æ•°æ®çš„æµè¡Œï¼Œä¼šå„¿æ›´åŠ æ™®éã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä»ä¼ ç»Ÿçš„è§†è§’çœ‹æ¥æµå¤„ç†æ˜¯åˆ©åŸºåº”ç”¨ã€‚æˆ‘ä¸ªäººè®¤ä¸ºæœ€å¤§çš„åŸå› æ˜¯ç¼ºå°‘å®æ—¶æ•°æ®æ”¶é›†ä½¿å¾—ä¸é—´æ–­çš„å¤„ç†æˆä¸ºäº†å­¦æœ¯æ€§çš„æ¦‚å¿µã€‚ æˆ‘æƒ³ç¼ºå°‘å®æ—¶æ•°æ®æ”¶é›†å°±åƒæ˜¯å•†ç”¨æµå¤„ç†ç³»ç»Ÿæ³¨å®šçš„å‘½è¿ã€‚ä»–ä»¬çš„å®¢æˆ·ä»ç„¶éœ€è¦å¤„ç†é¢å‘æ–‡ä»¶çš„ã€æ¯æ—¥æ‰¹é‡å¤„ç† ETL å’Œæ•°æ®é›†æˆã€‚å…¬å¸å»ºè®¾æµå¤„ç†ç³»ç»Ÿå…³æ³¨çš„æ˜¯æä¾›é™„ç€åœ¨å®æ—¶æ•°æ®æµçš„å¤„ç†å¼•æ“ï¼Œä½†æ˜¯æœ€ç»ˆå½“æ—¶æå°‘æ•°äººçœŸæ­£ä½¿ç”¨äº†å®æ—¶æ•°æ®æµã€‚äº‹å®ä¸Šï¼Œåœ¨æˆ‘åœ¨ LinkedIn å·¥ä½œçš„åˆæœŸï¼Œæœ‰ä¸€å®¶å…¬å¸è¯•å›¾æŠŠä¸€ä¸ªéå¸¸æ£’çš„æµå¤„ç†ç³»ç»Ÿé”€å”®ç»™æˆ‘ä»¬ï¼Œä½†æ˜¯å› ä¸ºå½“æ—¶æˆ‘ä»¬çš„å…¨éƒ¨æ•°æ®éƒ½æŒ‰å°æ—¶æ”¶é›†åœ¨çš„æ–‡ä»¶é‡Œï¼Œå½“æ—¶æˆ‘ä»¬æå‡ºçš„æœ€å¥½çš„åº”ç”¨å°±æ˜¯åœ¨æ¯å°æ—¶çš„æœ€åæŠŠè¿™äº›æ–‡ä»¶è¾“å…¥åˆ°æµå¤„ç†ç³»ç»Ÿä¸­ã€‚ä»–ä»¬æ³¨æ„åˆ°è¿™æ˜¯ä¸€ä¸ªæ™®éæ€§çš„é—®é¢˜ã€‚è¿™äº›å¼‚å¸¸è¯æ˜äº†å¦‚ä¸‹è§„åˆ™ï¼šæµå¤„ç†ç³»ç»Ÿè¦æ»¡è¶³çš„é‡è¦å•†ä¸šç›®æ ‡ä¹‹ä¸€æ˜¯ï¼šè´¢åŠ¡ï¼Œ å®ƒæ˜¯å®æ—¶æ•°æ®æµå·²å…·å¤‡çš„åŸºå‡†ï¼Œå¹¶ä¸”æµå¤„ç†å·²ç»æˆä¸ºäº†ç“¶é¢ˆã€‚ ç”šè‡³äºåœ¨ä¸€ä¸ªå¥åº·çš„æ‰¹å¤„ç†ç³»ç»Ÿä¸­ï¼Œæµå¤„ç†ä½œä¸ºä¸€ç§åŸºç¡€æ¶æ„çš„å®é™…åº”ç”¨èƒ½åŠ›æ˜¯ç›¸å½“å¹¿æ³›çš„ã€‚å®ƒè·¨è¶Šäº†å®æ—¶æ•°æ®è¯·æ±‚-åº”ç­”æœåŠ¡å’Œç¦»çº¿æ‰¹é‡å¤„ç†ä¹‹é—´çš„é¸¿æ²Ÿã€‚ç°åœ¨çš„äº’è”ç½‘å…¬å¸ï¼Œå¤§çº¦ 25%çš„ä»£ç å¯ä»¥åˆ’åˆ†åˆ°è¿™ä¸ªç±»å‹ä¸­ã€‚ æœ€ç»ˆè¿™äº›æ—¥å¿—è§£å†³äº†æµå¤„ç†ä¸­ç»å¤§éƒ¨åˆ†å…³é”®çš„æŠ€æœ¯é—®é¢˜ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œå®ƒæ‰€è§£å†³çš„æœ€å¤§çš„é—®é¢˜æ˜¯å®ƒä½¿å¾—å¤šè®¢é˜…è€…å¯ä»¥è·å¾—å®æ—¶æ•°æ®ã€‚å¯¹è¿™äº›æŠ€æœ¯ç»†èŠ‚æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¼€æºçš„ Samza,å®ƒæ˜¯åŸºäºè¿™äº›ç†å¿µå»ºè®¾çš„ä¸€ä¸ªæµå¤„ç†ç³»ç»Ÿã€‚è¿™äº›åº”ç”¨çš„æ›´å¤šæŠ€æœ¯ç»†èŠ‚æˆ‘ä»¬åœ¨æ­¤æ–‡æ¡£ä¸­æœ‰è¯¦ç»†çš„æè¿°ã€‚ Data flow graphs æµå¤„ç†æœ€æœ‰è¶£çš„è§’åº¦æ˜¯å®ƒä¸æµå¤„ç†ç³»ç»Ÿå†…éƒ¨æ— å…³ï¼Œä½†æ˜¯ä¸ä¹‹å¯†åˆ‡ç›¸å…³çš„æ˜¯å¦‚ä½•æ‰©å±•äº†æˆ‘ä»¬è°ˆåˆ°çš„æ—©æœŸæ•°æ®é›†æˆçš„æ•°æ®è·å–çš„ç†å¿µã€‚æˆ‘ä»¬ä¸»è¦è®¨è®ºäº†åŸºç¡€æ•°æ®çš„è·å–æˆ–æ—¥å¿—â€“äº‹ä»¶å’Œå„ç±»ç³»ç»Ÿæ‰§è¡Œä¸­äº§ç”Ÿçš„æ•°æ®ç­‰ã€‚ä½†æ˜¯æµå¤„ç†å…è®¸æˆ‘ä»¬åŒ…æ‹¬äº†è®¡ç®—å…¶å®ƒæ•°æ®çš„æ•°æ®ã€‚è¿™äº›è¡ç”Ÿçš„æ•°æ®åœ¨æ¶ˆè´¹è€…çœ‹æ¥ä¸ä»–ä»¬è®¡ç®—çš„åŸå§‹æ•°æ®æ²¡ä»€ä¹ˆå·®åˆ«ã€‚è¿™äº›è¡ç”Ÿçš„æ•°æ®å¯ä»¥æŒ‰ä»»æ„çš„å¤æ‚åº¦è¿›è¡Œå‹ç¼©ã€‚ è®©æˆ‘ä»¬å†æ·±å…¥ä¸€æ­¥ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ï¼šæµå¤„ç†ä½œä¸šå¯ä»¥è¯»å–ä»»æ„çš„æ—¥å¿—å¹¶æŠŠæ—¥å¿—å†™å…¥åˆ°æ—¥å¿—æˆ–è€…å…¶å®ƒçš„ç³»ç»Ÿä¸­ã€‚ä»–ä»¬ç”¨äºè¾“å…¥è¾“å‡ºçš„æ—¥å¿—æŠŠè¿™äº›å¤„ç†å…³è”åˆ°ä¸€ç»„å¤„ç†è¿‡ç¨‹ä¸­ã€‚äº‹å®ä¸Šï¼Œä½¿ç”¨è¿™ç§æ ·å¼çš„é›†ä¸­æ—¥å¿—ï¼Œä½ å¯ä»¥æŠŠç»„ç»‡å…¨éƒ¨çš„æ•°æ®æŠ“å–ã€è½¬åŒ–å’Œå·¥ä½œæµçœ‹æˆæ˜¯ä¸€ç³»åˆ—çš„æ—¥å¿—å’Œå†™å…¥å®ƒä»¬çš„å¤„ç†è¿‡ç¨‹ã€‚ æµå¤„ç†å™¨æ ¹æœ¬ä¸éœ€è¦ç†æƒ³çš„æ¡†æ¶ï¼šå®ƒå¯èƒ½æ˜¯è¯»å†™æ—¥å¿—çš„ä»»ä½•å¤„ç†å™¨æˆ–è€…å¤„ç†å™¨é›†åˆï¼Œä½†æ˜¯é¢å¤–çš„åŸºç¡€è®¾æ–½å’Œè¾…åŠ©å¯ä»¥æä¾›å¸®åŠ©ç®¡ç†å¤„ç†ä»£ç ã€‚ æ—¥å¿—é›†æˆçš„ç›®æ ‡æ˜¯åŒé‡çš„ï¼š é¦–å…ˆï¼Œå®ƒç¡®ä¿æ¯ä¸ªæ•°æ®é›†éƒ½æœ‰å¤šä¸ªè®¢é˜…è€…å’Œæœ‰åºçš„ã€‚è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹çŠ¶æ€å¤åˆ¶åŸåˆ™æ¥è®°ä½é¡ºåºçš„é‡è¦æ€§ã€‚ä¸ºäº†ä½¿è¿™ä¸ªæ›´åŠ å…·ä½“ï¼Œè®¾æƒ³ä¸€ä¸‹ä»æ•°æ®åº“ä¸­æ›´æ–°æ•°æ®æµâ€“å¦‚æœåœ¨å¤„ç†è¿‡ç¨‹ä¸­æˆ‘ä»¬æŠŠå¯¹åŒä¸€è®°å½•çš„ä¸¤æ¬¡æ›´æ–°é‡æ–°æ’åºï¼Œå¯èƒ½ä¼šäº§ç”Ÿé”™è¯¯çš„è¾“å‡ºã€‚ TCP ä¹‹ç±»çš„é“¾æ¥ä»…ä»…å±€é™äºå•ä¸€çš„ç‚¹å¯¹ç‚¹é“¾æ¥ï¼Œè¿™ä¸€é¡ºåºçš„æŒä¹…æ€§è¦ä¼˜äº TCP ä¹‹ç±»çš„é“¾æ¥ï¼Œå®ƒå¯ä»¥åœ¨æµç¨‹å¤„ç†å¤±è´¥å’Œé‡è¿æ—¶ä»ç„¶å­˜åœ¨ã€‚ ç¬¬äºŒï¼Œæ—¥å¿—æä¾›äº†æµç¨‹çš„ç¼“å†²ã€‚è¿™æ˜¯éå¸¸åŸºç¡€çš„ã€‚å¦‚æœå¤„ç†æµç¨‹æ˜¯éåŒæ­¥çš„ï¼Œé‚£ä¹ˆä¸Šè¡Œç”Ÿæˆæµæ•°æ®çš„ä½œä¸šæ¯”ä¸‹è¡Œæ¶ˆè´¹æµæ•°æ®çš„ä½œä¸šè¿è¡Œçš„æ›´å¿«ã€‚è¿™å°†ä¼šå¯¼è‡´å¤„ç†æµç¨‹é˜»å¡ï¼Œæˆ–è€…ç¼“å†²æ•°æ®ï¼Œæˆ–è€…ä¸¢å¼ƒæ•°æ®ã€‚ä¸¢å¼ƒæ•°æ®å¹¶ä¸æ˜¯å¯è¡Œçš„æ–¹æ³•ï¼Œé˜»å¡å°†ä¼šå¯¼è‡´æ•´ä¸ªæµç¨‹å›¾ç«‹å³åœæ­¢ã€‚ æ—¥å¿—å®é™…ä¸Šæ˜¯ä¸€ä¸ªéå¸¸å¤§çš„ç¼“å†²ï¼Œå®ƒå…è®¸æµç¨‹é‡å¯æˆ–è€…åœæ­¢ä½†ä¸ä¼šå½±å“æµç¨‹å›¾å…¶å®ƒéƒ¨åˆ†çš„å¤„ç†é€Ÿåº¦ã€‚å¦‚æœè¦æŠŠæ•°æ®æµæ‰©å±•åˆ°æ›´å¤§è§„æ¨¡çš„ç»„ç»‡ï¼Œå¦‚æœå¤„ç†ä½œä¸šæ˜¯ç”±å¤šä¸ªä¸åŒçš„å›¢é˜Ÿæä¾›çš„ï¼Œè¿™ç§éš”ç¦»æ€§æ˜¯æå…¶é‡çš„ã€‚æˆ‘ä»¬ä¸èƒ½å®¹å¿ä¸€ä¸ªé”™è¯¯çš„ä½œä¸šå¼•å‘åå°çš„å‹åŠ›ï¼Œè¿™ç§å‹åŠ›ä¼šä½¿å¾—æ•´ä¸ªå¤„ç†æµç¨‹åœæ­¢ã€‚ Stormå’ŒSamaè¿™ä¸¤è€…éƒ½æ˜¯æŒ‰éåŒæ­¥æ–¹å¼è®¾è®¡çš„ï¼Œå¯ä»¥ä½¿ç”¨ Kafka æˆ–è€…å…¶å®ƒç±»ä¼¼çš„ç³»ç»Ÿä½œä¸ºå®ƒä»¬çš„æ—¥å¿—ã€‚ Stateful Real-Time Processing ä¸€äº›å®æ—¶æµå¤„ç†åœ¨è½¬åŒ–æ—¶æ˜¯æ— çŠ¶æ€çš„è®°å½•ã€‚åœ¨æµå¤„ç†ä¸­å¤§éƒ¨åˆ†çš„åº”ç”¨ä¼šæ˜¯ç›¸å½“å¤æ‚çš„ç»Ÿè®¡ã€èšåˆã€ä¸åŒçª—å£ä¹‹é—´çš„å…³è”ã€‚ä¾‹å¦‚æœ‰æ—¶äººä»¬æƒ³æ‰©å¤§åŒ…å«ç”¨æˆ·æ“ä½œä¿¡æ¯çš„äº‹ä»¶æµï¼ˆä¸€ç³»åˆ—çš„å•å‡»åŠ¨ä½œï¼‰â€“å®é™…ä¸Šå…³è”äº†ç”¨æˆ·çš„å•å‡»åŠ¨ä½œæµä¸ç”¨æˆ·çš„è´¦æˆ·ä¿¡æ¯æ•°æ®åº“ã€‚ä¸å˜çš„æ˜¯è¿™ç±»æµç¨‹æœ€ç»ˆä¼šéœ€è¦ç”±å¤„ç†å™¨ç»´æŠ¤çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ã€‚ä¾‹å¦‚æ•°æ®ç»Ÿè®¡æ—¶ï¼Œä½ éœ€è¦ç»Ÿè®¡åˆ°ç›®å‰ä¸ºæ­¢éœ€è¦ç»´æŠ¤çš„è®¡æ•°å™¨ã€‚å¦‚æœå¤„ç†å™¨æœ¬èº«å¤±è´¥äº†ï¼Œå¦‚ä½•æ­£ç¡®çš„ç»´æŠ¤è¿™äº›çŠ¶æ€ä¿¡æ¯å‘¢ï¼Ÿ æœ€ç®€å•çš„æ›¿æ¢æ–¹æ¡ˆæ˜¯æŠŠè¿™äº›çŠ¶æ€ä¿¡æ¯ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚ä½†æ˜¯å¦‚æœæµç¨‹å´©æºƒï¼Œå®ƒå°±ä¼šä¸¢å¤±ä¸­é—´çŠ¶æ€ã€‚å¦‚æœçŠ¶æ€æ˜¯æŒ‰çª—å£ç»´æŠ¤çš„ï¼Œæµç¨‹å°±ä¼šå›é€€åˆ°æ—¥å¿—ä¸­çª—å£å¼€å§‹çš„æ—¶é—´ç‚¹ä¸Šã€‚ä½†æ˜¯ï¼Œå¦‚æœç»Ÿè®¡æ˜¯æŒ‰å°æ—¶è¿›è¡Œçš„ï¼Œé‚£ä¹ˆè¿™ç§æ–¹å¼å°±ä¼šå˜å¾—ä¸å¯è¡Œã€‚ å¦ä¸€ä¸ªæ›¿æ¢æ–¹æ¡ˆæ˜¯ç®€å•çš„å­˜å‚¨æ‰€æœ‰çš„çŠ¶æ€ä¿¡æ¯åˆ°è¿œç¨‹çš„å­˜å‚¨ç³»ç»Ÿï¼Œé€šè¿‡ç½‘ç»œä¸è¿™äº›å­˜å‚¨å…³è”èµ·æ¥ã€‚è¿™ç§æœºåˆ¶çš„é—®é¢˜æ˜¯æ²¡æœ‰æœ¬åœ°æ•°æ®å’Œå¤§é‡çš„ç½‘ç»œé—´é€šä¿¡ã€‚ æˆ‘ä»¬å¦‚ä½•æ”¯æŒå¤„ç†è¿‡ç¨‹å¯ä»¥åƒè¡¨ä¸€æ ·åˆ†åŒºçš„æ•°æ®å‘¢? å›é¡¾ä¸€ä¸‹å…³äºè¡¨å’Œæ—¥å¿—äºŒç›¸æ€§çš„è®¨è®ºã€‚è¿™ä¸€æœºåˆ¶æä¾›äº†å·¥å…·æŠŠæ•°æ®æµè½¬åŒ–ä¸ºä¸å¤„ç†è¿‡ç¨‹ååŒå®šä½çš„è¡¨ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†è¿™äº›è¡¨çš„å®¹é”™å¤„ç†çš„æœºåˆ¶ã€‚ æµå¤„ç†å™¨å¯ä»¥æŠŠå®ƒçš„çŠ¶æ€ä¿å­˜åœ¨æœ¬åœ°çš„è¡¨æˆ–ç´¢å¼•â€“bdb,æˆ–è€…leveldb,ç”šè‡³äºç±»ä¼¼äº Lucene æˆ– fastbit ä¸€æ ·ä¸å¸¸è§çš„ç´¢å¼•ã€‚è¿™äº›å†…å®¹å­˜å‚¨åœ¨å®ƒçš„è¾“å…¥æµä¸­ï¼ˆæˆ–è®¸æ˜¯ä½¿ç”¨ä»»æ„çš„è½¬åŒ–ï¼‰ã€‚ç”Ÿæˆçš„å˜æ›´æ—¥å¿—è®°å½•äº†æœ¬åœ°çš„ç´¢å¼•ï¼Œå®ƒå…è®¸å­˜å‚¨äº‹ä»¶å´©æºƒã€é‡å¯ç­‰çš„çŠ¶æ€ä¿¡æ¯ã€‚æµå¤„ç†æä¾›äº†é€šç”¨çš„æœºåˆ¶ç”¨äºåœ¨æœ¬åœ°è¾“å…¥æµæ•°æ®çš„éšæœºç´¢å¼•ä¸­ä¿å­˜å…±åŒåˆ†ç‰‡çš„çŠ¶æ€ã€‚ å½“æµç¨‹è¿è¡Œå¤±è´¥æ—¶ï¼Œå®ƒä¼šä»å˜æ›´æ—¥å¿—ä¸­æ¢å¤å®ƒçš„ç´¢å¼•ã€‚æ¯æ¬¡å¤‡ä»½æ—¶ï¼Œæ—¥å¿—æŠŠæœ¬åœ°çŠ¶æ€è½¬åŒ–æˆä¸€ç³»åˆ—çš„å¢é‡è®°å½•ã€‚ è¿™ç§çŠ¶æ€ç®¡ç†çš„æ–¹æ³•æœ‰ä¸€ä¸ªä¼˜åŠ¿æ˜¯æŠŠå¤„ç†å™¨çš„çŠ¶æ€ä¹Ÿåšä¸ºæ—¥å¿—è¿›è¡Œç»´æŠ¤ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›æ—¥å¿—çœ‹æˆä¸æ•°æ®åº“è¡¨ç›¸å¯¹åº”çš„å˜æ›´æ—¥å¿—ã€‚äº‹å®ä¸Šï¼Œè¿™äº›å¤„ç†å™¨åŒæ—¶ç»´æŠ¤ç€åƒå…±åŒåˆ†ç‰‡è¡¨ä¸€æ ·çš„è¡¨ã€‚å› ä¸ºè¿™äº›çŠ¶æ€å®ƒæœ¬èº«å°±æ˜¯æ—¥å¿—ï¼Œå…¶å®ƒçš„å¤„ç†å™¨å¯ä»¥è®¢é˜…å®ƒã€‚å¦‚æœæµç¨‹å¤„ç†çš„ç›®æ ‡æ˜¯æ›´æ–°ç»“ç‚¹çš„æœ€åçŠ¶æ€ï¼Œè¿™ç§çŠ¶æ€åˆæ˜¯æµç¨‹çš„è¾“å‡ºï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ³•å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚ ä¸ºäº†æ•°æ®é›†æˆï¼Œä¸æ¥è‡ªæ•°æ®åº“çš„æ—¥å¿—å…³è”ï¼Œæ—¥å¿—å’Œæ•°æ®åº“è¡¨çš„äºŒè±¡æ€§å°±æ›´åŠ æ¸…æ™°äº†ã€‚å˜æ›´æ—¥å¿—å¯ä»¥ä»æ•°æ®åº“ä¸­æŠ½å–å‡ºæ¥ï¼Œæ—¥å¿—å¯ä»¥ç”±ä¸åŒçš„æµå¤„ç†å™¨ï¼ˆæµå¤„ç†å™¨ç”¨äºå…³è”ä¸åŒçš„äº‹ä»¶æµï¼‰æŒ‰ä¸åŒçš„æ–¹å¼è¿›è¡Œç´¢å¼•ã€‚ æˆ‘ä»¬å¯ä»¥åˆ—ä¸¾åœ¨ Samza ä¸­æœ‰çŠ¶æ€æµå¤„ç†ç®¡ç†çš„æ›´å¤šç»†èŠ‚å’Œå¤§é‡å®ç”¨çš„ä¾‹å­ã€‚ Log Compaction å½“ç„¶ï¼Œæˆ‘ä»¬ä¸èƒ½å¥¢æœ›ä¿å­˜å…¨éƒ¨å˜æ›´çš„å®Œæ•´æ—¥å¿—ã€‚é™¤éæƒ³è¦ä½¿ç”¨æ— é™ç©ºé—´ï¼Œæ—¥å¿—ä¸å¯èƒ½å®Œå…¨æ¸…é™¤ã€‚ä¸ºäº†æ¾„æ¸…å®ƒï¼Œæˆ‘ä»¬å†æ¥èŠèŠ Kafka çš„å®ç°ã€‚åœ¨ Kafka ä¸­,æ¸…ç†æœ‰ä¸¤ç§é€‰æ‹©ï¼Œè¿™å–å†³äºæ•°æ®æ˜¯å¦åŒ…æ‹¬å…³é”®æ›´æ–°å’Œäº‹ä»¶æ•°æ®ã€‚å¯¹äºäº‹ä»¶æ•°æ®ï¼ŒKafka æ”¯æŒä»…ç»´æŠ¤ä¸€ä¸ªçª—å£çš„æ•°æ®ã€‚é€šå¸¸ï¼Œé…ç½®éœ€è¦ä¸€äº›æ—¶é—´ï¼Œçª—å£å¯ä»¥æŒ‰æ—¶é—´æˆ–ç©ºé—´å®šä¹‰ã€‚è™½ç„¶å¯¹äº","date":"2019-07-04","objectID":"/the-log-every-software-engineer-should-know-about-real-time-data-unifying-abstraction/:1:3","tags":["database","distributed","log","ç¿»è¯‘"],"title":"The Log: What every software engineer should know about real-time data's unifying abstraction ä¸­æ–‡ç¿»è¯‘","uri":"/the-log-every-software-engineer-should-know-about-real-time-data-unifying-abstraction/"},{"categories":null,"content":"Part Four: System Building æˆ‘ä»¬æœ€åè¦è®¨è®ºçš„æ˜¯åœ¨çº¿æ•°æ®ç³»ç»Ÿè®¾è®¡ä¸­æ—¥å¿—çš„è§’è‰²ã€‚ åœ¨åˆ†å¸ƒå¼æ•°æ®åº“æ•°æ®æµä¸­æ—¥å¿—çš„è§’è‰²å’Œåœ¨å¤§å‹ç»„ç»‡æœºæ„æ•°æ®å®Œæ•´ä¸­æ—¥å¿—çš„è§’è‰²æ˜¯ç›¸ä¼¼çš„ã€‚åœ¨è¿™ä¸¤ä¸ªåº”ç”¨åœºæ™¯ä¸­ï¼Œæ—¥å¿—æ˜¯å¯¹äºæ•°æ®æºæ˜¯å¯é çš„ï¼Œä¸€è‡´çš„å’Œå¯æ¢å¤çš„ã€‚ç»„ç»‡å¦‚æœä¸æ˜¯ä¸€ä¸ªå¤æ‚çš„åˆ†å¸ƒå¼æ•°æ®ç³»ç»Ÿå‘¢ï¼Œå®ƒç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿ åˆ†ç±»è®¡ä»·å—ï¼Ÿ(Unbundling) å¦‚æœæ¢ä¸ªè§’åº¦ï¼Œä½ å¯ä»¥çœ‹åˆ°æŠŠæ•´ä¸ªç»„ç»‡ç³»ç»Ÿå’Œæ•°æ®æµçœ‹åšæ˜¯å•ä¸€çš„åˆ†å¸ƒå¼æ•°æ®ç³»ç»Ÿã€‚ä½ å¯ä»¥æŠŠæ‰€æœ‰çš„å­æŸ¥è¯¢ç³»ç»Ÿï¼ˆè¯¸å¦‚ Redis, SOLR,Hive è¡¨ç­‰ï¼‰çœ‹æˆæ˜¯æ•°æ®çš„ç‰¹å®šç´¢å¼•ã€‚ä½ å¯ä»¥æŠŠ Storm æˆ– Samza ä¸€æ ·çš„æµå¤„ç†ç³»ç»Ÿçœ‹æˆæ˜¯å‘å±•è‰¯å¥½çš„è§¦å‘å™¨å’Œè§†å›¾å…·ä½“åŒ–æœºåˆ¶ã€‚æˆ‘å·²ç»æ³¨æ„åˆ°ï¼Œä¼ ç»Ÿçš„æ•°æ®åº“ç®¡ç†äººå‘˜éå¸¸å–œæ¬¢è¿™æ ·çš„è§†å›¾ï¼Œå› ä¸ºå®ƒæœ€ç»ˆè§£é‡Šäº†è¿™äº›ä¸åŒçš„æ•°æ®ç³»ç»Ÿåˆ°åº•æ˜¯åšä»€ä¹ˆç”¨çš„â€“å®ƒä»¬åªæ˜¯ä¸åŒçš„ç´¢å¼•ç±»å‹è€Œå·²ã€‚ ä¸å¯å¦è®¤è¿™ç±»æ•°æ®åº“ç³»ç»Ÿç°åœ¨å¤§é‡çš„å‡ºç°ï¼Œä½†æ˜¯äº‹å®ä¸Šï¼Œè¿™ç§å¤æ‚æ€§ä¸€ç›´éƒ½å­˜åœ¨ã€‚å³ä½¿æ˜¯åœ¨å…³ç³»æ•°æ®åº“ç³»ç»Ÿçš„é¼ç››æ—¶æœŸï¼Œç»„ç»‡ä¸­æœ‰å¤§é‡çš„å…³ç³»æ•°æ®åº“ç³»ç»Ÿã€‚æˆ–è®¸è‡ªå¤§å‹æœºæ—¶ä»£å¼€å§‹ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½å­˜å‚¨åœ¨ç›¸åŒçš„ä½ç½®ï¼ŒçœŸæ­£çš„é›†æˆæ˜¯æ ¹æœ¬ä¸å­˜åœ¨çš„ã€‚å­˜åœ¨å¤šç§å¤–åœ¨éœ€æ±‚ï¼Œéœ€è¦æŠŠæ•°æ®åˆ†è§£æˆå¤šä¸ªç³»ç»Ÿï¼Œè¿™äº›å¤–åœ¨éœ€æ±‚åŒ…æ‹¬ï¼šè§„æ¨¡ã€åœ°ç†å› ç´ ã€å®‰å…¨æ€§ï¼Œæ€§èƒ½éš”ç¦»æ˜¯æœ€å¸¸è§çš„å› ç´ ã€‚è¿™äº›éœ€æ±‚éƒ½å¯ä»¥ç”±ä¸€ä¸ªä¼˜è´¨çš„ç³»ç»Ÿå®ç°ï¼šä¾‹å¦‚ï¼Œç»„ç»‡å¯ä»¥ä½¿ç”¨å•ä¸€çš„ Hadoop èšç°‡ï¼Œå®ƒåŒ…æ‹¬äº†å…¨éƒ¨çš„æ•°æ®ï¼Œå¯ä»¥æœåŠ¡äºå¤§å‹çš„å’Œå¤šæ ·æ€§çš„å®¢æˆ·ã€‚ å› æ­¤åœ¨å‘åˆ†å¸ƒå¼ç³»ç»Ÿå˜è¿çš„è¿‡ç¨‹ä¸­ï¼Œå·²ç»å­˜åœ¨ä¸€ç§å¤„ç†æ•°æ®çš„ç®€ä¾¿çš„æ–¹æ³•ï¼šæŠŠå¤§é‡çš„ä¸åŒç³»ç»Ÿçš„å°çš„å®ä¾‹èšåˆæˆä¸ºå¤§çš„èšç°‡ã€‚è®¸å¤šçš„ç³»ç»Ÿè¿˜ä¸è¶³ä»¥æ”¯æŒè¿™ä¸€æ–¹æ³•ï¼šå› ä¸ºå®ƒä»¬ä¸å¤Ÿå®‰å…¨ï¼Œæˆ–è€…æ€§èƒ½éš”ç¦»æ€§å¾—ä¸åˆ°ä¿è¯ï¼Œæˆ–è€…è§„æ¨¡ä¸ç¬¦åˆè¦æ±‚ã€‚ä¸è¿‡è¿™äº›é—®é¢˜éƒ½æ˜¯å¯ä»¥è§£å†³çš„ã€‚ ä¾æˆ‘ä¹‹è§ï¼Œä¸åŒç³»ç»Ÿå¤§é‡å‡ºç°çš„åŸå› æ˜¯å»ºè®¾åˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿå¾ˆå›°éš¾ã€‚é€šè¿‡å‰Šå‡åˆ°å•ä¸€çš„æŸ¥è¯¢æˆ–è€…ç”¨ä¾‹ï¼Œæ¯ä¸ªç³»ç»Ÿéƒ½å¯ä»¥æŠŠè§„æ¨¡æ§åˆ¶åˆ°æ˜“äºå®ç°çš„ç¨‹åº¦ã€‚ä½†æ˜¯è¿è¡Œè¿™äº›ç³»ç»Ÿäº§ç”Ÿçš„å¤æ‚åº¦ä¾ç„¶å¾ˆé«˜ã€‚ æœªæ¥è¿™ç±»é—®é¢˜å¯èƒ½çš„å‘å±•è¶‹åŠ¿æœ‰ä¸‰ç§ï¼š ç¬¬ä¸€ç§å¯èƒ½æ˜¯ä¿æŒç°çŠ¶ï¼šå­¤ç«‹çš„ç³»ç»Ÿè¿˜ä¼šæˆ–é•¿æˆ–çŸ­çš„æŒç»­ä¸€æ®µæ—¶é—´ã€‚è¿™æ˜¯å› ä¸ºå»ºè®¾åˆ†å¸ƒå¼ç³»ç»Ÿçš„å›°éš¾å¾ˆéš¾å…‹æœï¼Œæˆ–è€…å› ä¸ºå­¤ç«‹ç³»ç»Ÿçš„ç‹¬ç‰¹æ€§å’Œä¾¿æ·æ€§å¾ˆéš¾è¾¾åˆ°ã€‚åŸºäºè¿™äº›åŸå› ï¼Œæ•°æ®é›†æˆçš„æ ¸å¿ƒé—®é¢˜ä»ç„¶æ˜¯å¦‚ä½•æ°å½“çš„ä½¿ç”¨æ•°æ®ã€‚å› æ­¤ï¼Œé›†æˆæ•°æ®çš„å¤–éƒ¨æ—¥å¿—éå¸¸çš„é‡è¦ã€‚ ç¬¬äºŒç§å¯èƒ½æ˜¯é‡æ„ï¼šå…·å¤‡é€šç”¨æ€§çš„å•ä¸€çš„ç³»ç»Ÿé€æ­¥èåˆå¤šä¸ªåŠŸèƒ½å½¢æˆè¶…æç³»ç»Ÿã€‚è¿™ä¸ªè¶…çº§ç³»ç»Ÿè¡¨é¢çœ‹èµ·æ¥ç±»ä¼¼å…³ç³»æ•°æ®åº“ç³»ç»Ÿï¼Œä½†æ˜¯åœ¨ç»„ç»‡ä¸­ä½ ä½¿ç”¨æ—¶æœ€å¤§çš„ä¸åŒæ˜¯ä½ åªéœ€è¦ä¸€ä¸ªå¤§çš„ç³»ç»Ÿè€Œä¸æ˜¯æ— æ•°ä¸ªå°ç³»ç»Ÿã€‚åœ¨è¿™ä¸ªä¸–ç•Œé‡Œï¼Œé™¤äº†åœ¨ç³»ç»Ÿå†…å·²è§£å†³çš„è¿™ä¸ªé—®é¢˜ä¸å­˜åœ¨ä»€ä¹ˆçœŸæ­£çš„æ•°æ®é›†æˆé—®é¢˜ã€‚æˆ‘æƒ³è¿™æ˜¯å› ä¸ºå»ºè®¾è¿™æ ·çš„ç³»ç»Ÿçš„å®é™…å›°éš¾ã€‚ è™½ç„¶å¦ä¸€ç§å¯èƒ½çš„ç»“æœå¯¹äºå·¥ç¨‹å¸ˆæ¥è¯´æ˜¯å¾ˆæœ‰å¸å¼•åŠ›çš„ã€‚æ–°ä¸€ä»£æ•°æ®åº“ç³»ç»Ÿçš„ç‰¹å¾ä¹‹ä¸€æ˜¯å®ƒä»¬æ˜¯å®Œå…¨å¼€æºçš„ã€‚å¼€æºæä¾›äº†ä¸€ç§å¯èƒ½æ€§ï¼šæ•°æ®åŸºç¡€æ¶æ„ä¸å¿…æ‰“åŒ…æˆæœåŠ¡é›†æˆ–è€…é¢å‘åº”ç”¨çš„ç³»ç»Ÿæ¥å£ã€‚åœ¨ Java æ ˆä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°åœ¨ä¸€å®šç¨‹åº¦ä¸Šï¼Œè¿™ç§çŠ¶å†µå·²ç»å‘ç”Ÿäº†ã€‚ Zookeeperç”¨äºå¤„ç†å¤šä¸ªç³»ç»Ÿä¹‹é—´çš„åè°ƒï¼Œæˆ–è®¸ä¼šä»è¯¸å¦‚Helix æˆ–è€…Curatorç­‰é«˜çº§åˆ«çš„æŠ½è±¡ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ã€‚ Mesoså’ŒYARNç”¨äºå¤„ç†æµç¨‹å¯è§†åŒ–å’Œèµ„æºç®¡ç†ã€‚ Luceneå’ŒLevelDBç­‰åµŒå…¥å¼ç±»åº“åšä¸ºç´¢å¼•ã€‚ Netty,Jettyå’ŒFinagle,rest.liç­‰å°è£…æˆé«˜çº§åˆ«çš„ç”¨äºå¤„ç†è¿œç¨‹é€šä¿¡ã€‚ Avro,Protocol Buffers,Thriftå’Œumpteen zillionç­‰å…¶å®ƒç±»åº“ç”¨äºå¤„ç†åºåˆ—åŒ–ã€‚ Kafkaå’ŒBookeeperæä¾›æ”¯æŒæ—¥å¿—ã€‚ å¦‚æœä½ æŠŠè¿™äº›å †æ”¾åœ¨ä¸€èµ·ï¼Œæ¢ä¸ªè§’åº¦çœ‹ï¼Œå®ƒæœ‰ç‚¹åƒæ˜¯ç®€åŒ–ç‰ˆçš„åˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿå·¥ç¨‹ã€‚ä½ å¯ä»¥æŠŠè¿™äº›æ‹¼è£…åœ¨ä¸€èµ·ï¼Œåˆ›å»ºå¤§é‡çš„å¯èƒ½çš„ç³»ç»Ÿã€‚æ˜¾è€Œæ˜“è§ï¼Œç°åœ¨æ¢è®¨çš„ä¸æ˜¯æœ€ç»ˆç”¨æˆ·æ‰€å…³å¿ƒçš„ API æˆ–è€…å¦‚ä½•å®ç°ï¼Œè€Œæ˜¯åœ¨ä¸æ–­å¤šæ ·åŒ–å’Œæ¨¡å—åŒ–çš„è¿‡ç¨‹ä¸­å¦‚ä½•è®¾è®¡å®ç°å•ä¸€ç³»ç»Ÿçš„é€”å¾„ã€‚å› ä¸ºéšç€å¯é çš„ã€çµæ´»çš„æ¨¡å—çš„å‡ºç°ï¼Œå®æ–½åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ—¶é—´å‘¨æœŸç”±å¹´ç¼©å‡ä¸ºå‘¨ï¼Œèšåˆå½¢æˆå¤§å‹æ•´ä½“ç³»ç»Ÿçš„å‹åŠ›é€æ­¥æ¶ˆå¤±ã€‚ The place of the log in system architecture é‚£äº›æä¾›å¤–éƒ¨æ—¥å¿—çš„ç³»ç»Ÿå¦‚ä»Šå·²å…è®¸ä¸ªäººç”µè„‘æŠ›å¼ƒä»–ä»¬è‡ªèº«å¤æ‚çš„æ—¥å¿—ç³»ç»Ÿè½¬è€Œä½¿ç”¨å…±äº«æ—¥å¿—ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œæ—¥å¿—å¯ä»¥åšåˆ°ä»¥ä¸‹äº‹æƒ…ï¼š é€šè¿‡å¯¹èŠ‚ç‚¹çš„å¹¶å‘æ›´æ–°çš„æ’åºå¤„ç†æ•°æ®çš„ä¸€è‡´æ€§ï¼ˆæ— è®ºåœ¨åŠæ—¶è¿˜æ˜¯æœ€ç»ˆæƒ…å†µä¸‹ï¼‰ æä¾›èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®å¤åˆ¶ æä¾›â€commitâ€œè¯­æ³•ï¼ˆåªæœ‰å½“å†™å…¥å™¨ç¡®ä¿æ•°æ®ä¸ä¼šä¸¢å¤±æ—¶æ‰ä¼šå†™å…¥ï¼‰ ä½ç³»ç»Ÿæä¾›å¤–éƒ¨çš„æ•°æ®è®¢é˜…èµ„æº æä¾›å­˜å‚¨å¤±è´¥çš„å¤åˆ¶æ“ä½œå’Œå¼•å¯¼æ–°çš„å¤åˆ¶æ“ä½œçš„èƒ½åŠ› å¤„ç†èŠ‚ç‚¹é—´çš„æ•°æ®å¹³è¡¡ è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°æ®åˆ†å‘ç³»ç»Ÿæœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå‰©ä¸‹çš„å¤§éƒ¨åˆ†å†…å®¹ä¸ç»ˆç«¯è°ƒç”¨çš„ API å’Œç´¢å¼•ç­–ç•¥ç›¸å…³ã€‚è¿™æ­£æ˜¯ä¸åŒç³»ç»Ÿé—´çš„å·®å¼‚æ‰€åœ¨ï¼Œä¾‹å¦‚ï¼šä¸€ä¸ªå…¨æ–‡æœ¬æŸ¥è¯¢è¯­å¥éœ€è¦æŸ¥è¯¢æ‰€æœ‰çš„åˆ†åŒºï¼Œè€Œä¸€ä¸ªä¸»é”®æŸ¥è¯¢åªéœ€è¦æŸ¥è¯¢è´Ÿè´£é”®æ•°æ®çš„å•ä¸ªèŠ‚ç‚¹å°±å¯ä»¥äº†ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹è¯¥ç³»ç»Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ç³»ç»Ÿè¢«åˆ†ä¸ºä¸¤ä¸ªé€»è¾‘åŒºåŸŸï¼šæ—¥å¿—å’ŒæœåŠ¡å±‚ã€‚æ—¥å¿—æŒ‰é¡ºåºæ•è·çŠ¶æ€å˜åŒ–ï¼ŒæœåŠ¡èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•æä¾›æŸ¥è¯¢æœåŠ¡éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ï¼ˆé”®-å€¼çš„å­˜å‚¨å¯èƒ½ä»¥ B-tree æˆ– SSTable çš„æ–¹å¼è¿›è¡Œï¼Œè€Œæœç´¢ç³»ç»Ÿå¯èƒ½å­˜åœ¨ä¸ä¹‹ç›¸åçš„ç´¢å¼•ï¼‰ã€‚å†™å…¥å™¨å¯ä»¥ç›´æ¥è®¿é—®æ—¥å¿—ï¼Œå°½ç®¡éœ€è¦é€šè¿‡æœåŠ¡å±‚ä»£ç†ã€‚åœ¨å†™å…¥æ—¥å¿—çš„æ—¶å€™ä¼šäº§ç”Ÿé€»è¾‘æ—¶é—´æˆ³ï¼ˆå³ log ä¸­çš„ç´¢å¼•ï¼‰ï¼Œå¦‚æœç³»ç»Ÿæ˜¯åˆ†æ®µå¼çš„ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿä¸æ®µæ•°ç›®ç›¸åŒæ•°é‡çš„æ—¥å¿—æ–‡ä»¶å’ŒæœåŠ¡èŠ‚ç‚¹ï¼Œè¿™é‡Œçš„æ•°é‡å’Œæœºå™¨æ•°é‡å¯èƒ½ä¼šæœ‰è¾ƒå¤§å·®è·ã€‚ æœåŠ¡èŠ‚ç‚¹è®¢é˜…æ—¥å¿—ä¿¡æ¯å¹¶å°†å†™å…¥å™¨æŒ‰ç…§æ—¥å¿—å­˜å‚¨çš„é¡ºåºå°½å¿«åº”ç”¨åˆ°å®ƒçš„æœ¬åœ°ç´¢å¼•ä¸Šã€‚ å®¢æˆ·ç«¯åªè¦åœ¨æŸ¥è¯¢è¯­å¥ä¸­æä¾›å¯¹åº”çš„å†™å…¥å™¨çš„æ—¶é—´æˆ³ï¼Œå®ƒå°±å¯ä»¥ä»ä»»ä½•èŠ‚ç‚¹ä¸­è·å–â€è¯»å†™â€œè¯­ä¹‰ã€‚æœåŠ¡èŠ‚ç‚¹æ”¶åˆ°è¯¥æŸ¥è¯¢è¯­å¥åä¼šå°†å…¶ä¸­çš„æ—¶é—´æˆ³ä¸è‡ªèº«çš„ç´¢å¼•æ¯”è¾ƒï¼Œå¦‚æœå¿…è¦ï¼ŒæœåŠ¡èŠ‚ç‚¹ä¼šå»¶è¿Ÿè¯·æ±‚ç›´åˆ°å¯¹åº”æ—¶é—´çš„ç´¢å¼•å»ºç«‹å®Œæ¯•ï¼Œä»¥å…æä¾›æ—§æ•°æ®ã€‚ æœåŠ¡èŠ‚ç‚¹æˆ–è®¸æ ¹æœ¬æ— éœ€çŸ¥é“â€æ§åˆ¶â€œæˆ–â€lerder é€‰ä¸¾ï¼ˆleader electionï¼‰â€œçš„æ¦‚å¿µï¼Œå¯¹å¾ˆå¤šç®€å•çš„æ“ä½œï¼ŒæœåŠ¡èŠ‚ç‚¹å¯ä»¥çˆ±å®Œå…¨è„±ç¦»é¢†å¯¼çš„æƒ…å†µä¸‹æä¾›æœåŠ¡ï¼Œæ—¥å¿—å³æ˜¯ä¿¡æ¯çš„æ¥æºã€‚ åˆ†å‘ç³»ç»Ÿæ‰€éœ€è¦åšçš„å…¶ä¸­ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„å·¥ä½œï¼Œå°±æ˜¯ä¿®å¤å¤±è´¥èŠ‚ç‚¹å¹¶ç§»é™¤å‡ ç‚¹ä¹‹é—´çš„éš”ç¦»ã€‚ä¿ç•™ä¿®å¤çš„æ•°æ®å¹¶ç»“åˆä¸Šå„åŒºåŸŸå†…çš„æ•°æ®å¿«ç…§æ˜¯ä¸€ç§è¾ƒä¸ºå…¸å‹çš„åšæ³•ï¼Œå®ƒä¸ä¿ç•™å®Œæ•´çš„æ•°æ®å¤‡ä»½å¹¶ä»åƒåœ¾ç®±å†…å›æ”¶æ—¥å¿—çš„åšæ³•å‡ ä¹ç­‰ä»·ã€‚è¿™å°±ä½¿å¾—æœåŠ¡å±‚ç®€å•äº†å¾ˆå¤šï¼Œæ—¥å¿—ç³»ç»Ÿä¹Ÿæ›´æœ‰é’ˆå¯¹æ€§ã€‚ æœ‰äº†è¿™ä¸ªæ—¥å¿—ç³»ç»Ÿï¼Œä½ å¯ä»¥è®¢é˜…åˆ° APIï¼Œè¿™ä¸ª API æä¾›äº†æŠŠ ETL æä¾›ç»™å…¶å®ƒç³»ç»Ÿçš„æ•°æ®å†…å®¹ã€‚äº‹å®ä¸Šï¼Œè®¸å¤šç³»ç»Ÿéƒ½å¯ä»¥å…±äº«ç›¸åŒçš„æ—¥å¿—åŒæ—¶æä¾›ä¸åŒçš„ç´¢å¼•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š è¿™ä¸ªç³»ç»Ÿçš„è§†å›¾å¯ä»¥æ¸…æ™°çš„åˆ†è§£åˆ°æ—¥å¿—å’ŒæŸ¥è¯¢ API,å› ä¸ºå®ƒå…è®¸ä½ ä»ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œä¸€è‡´æ€§è§’åº¦åˆ†è§£æŸ¥è¯¢çš„ç‰¹å¾ã€‚è¿™å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¯¹ç³»ç»Ÿè¿›è¡Œåˆ†è§£ï¼Œå¹¶ç†è§£é‚£äº›å¹¶æ²¡æŒ‰è¿™ç§æ–¹å¼è®¾è®¡å®æ–½çš„ç³»ç»Ÿã€‚ è™½ç„¶ Kafka å’Œ Bookeeper éƒ½æ˜¯ä¸€è‡´æ€§æ—¥å¿—ï¼Œä½†è¿™ä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿæ²¡ä»€ä¹ˆæ„ä¹‰ã€‚ä½ å¯ä»¥è½»æ¾çš„æŠŠ Dynamo ä¹‹ç±»çš„æ•°æ®æ„åˆ†è§£ä¸ºä¸€è‡´æ€§çš„ AP æ—¥å¿—å’Œé”®å€¼å¯¹æœåŠ¡å±‚ã€‚è¿™æ ·çš„æ—¥å¿—ä½¿ç”¨èµ·æ¥çµæ´»ï¼Œå› ä¸ºå®ƒé‡ä¼ äº†æ—§æ¶ˆæ¯ï¼Œåƒ Dynamo ä¸€æ ·ï¼Œè¿™æ ·çš„å¤„ç†å–å†³äºæ¶ˆæ¯çš„è®¢é˜…è€…ã€‚ åœ¨å¾ˆå¤šäººçœ‹æ¥ï¼Œåœ¨æ—¥å¿—ä¸­å¦å¤–ä¿å­˜ä¸€ä»½æ•°æ®çš„å®Œæ•´å¤æœ¬æ˜¯ä¸€ç§æµªè´¹ã€‚äº‹å®ä¸Šï¼Œè™½ç„¶æœ‰å¾ˆå¤šå› ç´ ä½¿å¾—è¿™ä»¶äº‹å¹¶ä¸å›°éš¾ã€‚é¦–å…ˆï¼Œæ—¥å¿—å¯ä»¥æ˜¯ä¸€ç§æœ‰æ•ˆçš„å­˜å‚¨æœºåˆ¶ã€‚æˆ‘ä»¬åœ¨ Kafka ç”Ÿäº§ç¯å¢ƒçš„æœåŠ¡å™¨ä¸Šå­˜å‚¨äº† 5 TB çš„æ•°æ®ã€‚åŒæ—¶æœ‰è®¸å¤šçš„æœåŠ¡ç³»ç»Ÿéœ€è¦æ›´å¤šçš„å†…å­˜æ¥æä¾›æœ‰æ•ˆçš„æ•°æ®æœåŠ¡ï¼Œä¾‹å¦‚æ–‡æœ¬æœç´¢ï¼Œå®ƒé€šå¸¸æ˜¯åœ¨å†…å­˜ä¸­çš„ã€‚æœåŠ¡ç³»ç»ŸåŒæ ·ä¹Ÿéœ€æ ·ç¡¬ç›˜çš„ä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„å®æ—¶æ•°æ®ç³»ç»Ÿæˆ–è€…åœ¨å†…å­˜å¤–æä¾›æœåŠ¡æˆ–è€…ä½¿ç”¨å›ºæ€ç¡¬ç›˜ã€‚ç›¸åï¼Œæ—¥å¿—ç³»ç»Ÿåªéœ€è¦çº¿æ€§çš„è¯»å†™ï¼Œå› æ­¤ï¼Œå®ƒå¾ˆä¹äºä½¿ç”¨ TB é‡çº§çš„ç¡¬ç›˜ã€‚æœ€ç»ˆï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç”±å¤šä¸ªç³»ç»Ÿæä¾›çš„æ•°æ®ï¼Œæ—¥å¿—çš„æˆæœ¬åˆ†æ‘Šåˆ°å¤šä¸ªç´¢å¼•ä¸Šï¼Œè¿™ç§èšåˆä½¿å¾—å¤–éƒ¨æ—¥å¿—çš„æˆæœ¬é™åˆ°äº†æœ€ä½ç‚¹ã€‚ LinkedIn å°±æ˜¯ä½¿ç”¨äº†è¿™ç§æ–¹å¼å®ç°å®ƒçš„å¤šä¸ªå®æ—¶æŸ¥è¯¢ç³»ç»Ÿçš„ã€‚è¿™äº›ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªæ•°æ®åº“ï¼ˆä½¿ç”¨æ•°æ®æ€»çº¿åšä¸ºæ—¥å¿—æ‘˜è¦ï¼Œæˆ–è€…ä» Kafka å»æ‰ä¸“ç”¨çš„æ—¥å¿—ï¼‰ï¼Œè¿™äº›ç³»ç»Ÿåœ¨é¡¶å±‚æ•°æ®æµä¸Šè¿˜æä¾›äº†ç‰¹æ®Šçš„åˆ†ç‰‡ã€ç´¢å¼•å’ŒæŸ¥è¯¢åŠŸèƒ½ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å®æ–½æœç´¢ã€ç¤¾äº¤ç½‘ç»œå’Œ OLAP æŸ¥è¯¢ç³»ç»Ÿçš„æ–¹å¼ã€‚äº‹å®ä¸Šè¿™ç§æ–¹å¼æ˜¯ç›¸å½“æ™®éçš„ï¼šä¸ºå¤šä¸ªç”¨äºå®æ—¶æœåŠ¡çš„æœåŠ¡ç³»ç»Ÿæä¾›å•ä¸€çš„æ•°æ®ï¼ˆè¿™äº›æ¥è‡ª Hadoop çš„æ•°æ®æˆ–æ˜¯å®æ—¶çš„æˆ–æ˜¯è¡ç”Ÿçš„ï¼‰ã€‚è¿™ç§æ–¹å¼å·²è¢«è¯å®æ˜¯ç›¸å½“ç®€æ´çš„ã€‚è¿™äº›ç³»ç»Ÿæ ¹æœ¬ä¸éœ€è¦å¤–éƒ¨å¯å†™å…¥çš„ APIï¼ŒKafka å’Œæ•°æ®åº“è¢«ç”¨åšç³»ç»Ÿçš„è®°å½•å’Œå˜æ›´æµï¼Œé€šè¿‡æ—¥å¿—ä½ å¯ä»¥æŸ¥è¯¢ç³»ç»Ÿã€‚æŒæœ‰ç‰¹å®šåˆ†ç‰‡çš„ç»“ç‚¹åœ¨æœ¬åœ°å®Œæˆå†™æ“ä½œã€‚è¿™äº›ç»“ç‚¹ç›²ç›®çš„æŠŠæ—¥å¿—æä¾›çš„æ•°æ®è½¬å½•åˆ°å®ƒä»¬è‡ªå·±çš„å­˜å‚¨ç©ºé—´ä¸­ã€‚é€šè¿‡å›æ”¾ä¸Šè¡Œæµæ—¥å¿—å¯ä»¥æ¢å¤è½¬å½•å¤±è´¥çš„ç»“ç‚¹ã€‚ è¿™äº›ç³»ç»Ÿçš„ç¨‹åº¦åˆ™å–å†³äºæ—¥å¿—çš„å¤šæ ·æ€§ã€‚ä¸€ä¸ªå®Œå…¨å¯é çš„ç³»ç»Ÿå¯ä»¥ç”¨æ—¥å¿—æ¥å¯¹æ•°æ®åˆ†ç‰‡ã€å­˜å‚¨ç»“ç‚¹ã€å‡è¡¡è´Ÿè½½ï¼Œä»¥åŠç”¨äºæ•°æ®ä¸€è‡´æ€§å’Œæ•°æ®å¤åˆ¶ç­‰å¤šæ–¹é¢ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å±‚å®é™…ä¸Šåªä¸è¿‡æ˜¯ä¸€ç§ç¼“å­˜æœºåˆ¶ï¼Œè¿™ç§ç¼“å­˜æœºåˆ¶å…è®¸ç›´æ¥å†™å…¥æ—¥å¿—çš„æµå¤„ç†ã€‚ ","date":"2019-07-04","objectID":"/the-log-every-software-engineer-should-know-about-real-time-data-unifying-abstraction/:1:4","tags":["database","distributed","log","ç¿»è¯‘"],"title":"The Log: What every software engineer should know about real-time data's unifying abstraction ä¸­æ–‡ç¿»è¯‘","uri":"/the-log-every-software-engineer-should-know-about-real-time-data-unifying-abstraction/"},{"categories":null,"content":"ç»“æŸè¯­ å¦‚æœä½ å¯¹äºæœ¬æ–‡ä¸­æ‰€è°ˆåˆ°çš„å…³äºæ—¥å¿—çš„å¤§éƒ¨å†…å®¹ï¼Œå¦‚ä¸‹å†…å®¹æ˜¯æ‚¨å¯ä»¥å‚è€ƒçš„å…¶å®ƒèµ„æ–™ã€‚å¯¹äºåŒä¸€äº‹åŠ¡äººä»¬ä¼šç”¨ä¸åŒçš„æœ¯è¯­ï¼Œè¿™ä¼šè®©äººæœ‰ä¸€äº›å›°æƒ‘ï¼Œä»æ•°æ®åº“ç³»ç»Ÿåˆ°åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä»å„ç±»ä¼ä¸šçº§åº”ç”¨è½¯ä»¶åˆ°å¹¿é˜”çš„å¼€æºä¸–ç•Œã€‚æ— è®ºå¦‚ä½•ï¼Œåœ¨å¤§æ–¹å‘ä¸Šè¿˜æ˜¯æœ‰ä¸€äº›å…±åŒä¹‹å¤„ã€‚ ","date":"2019-07-04","objectID":"/the-log-every-software-engineer-should-know-about-real-time-data-unifying-abstraction/:1:5","tags":["database","distributed","log","ç¿»è¯‘"],"title":"The Log: What every software engineer should know about real-time data's unifying abstraction ä¸­æ–‡ç¿»è¯‘","uri":"/the-log-every-software-engineer-should-know-about-real-time-data-unifying-abstraction/"},{"categories":null,"content":"references å‚è€ƒç¿»è¯‘ éƒ¨åˆ†è‡ªå·±ç¿»è¯‘ï¼Œå¤§æ®µçš„æŠ„è¿™é‡Œçš„ç¿»è¯‘ï½ å‚è€ƒæ–‡çŒ®è§æ­¤ ","date":"2019-07-04","objectID":"/the-log-every-software-engineer-should-know-about-real-time-data-unifying-abstraction/:2:0","tags":["database","distributed","log","ç¿»è¯‘"],"title":"The Log: What every software engineer should know about real-time data's unifying abstraction ä¸­æ–‡ç¿»è¯‘","uri":"/the-log-every-software-engineer-should-know-about-real-time-data-unifying-abstraction/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šç®€å•ä»‹ç»æœ€è¿‘è‡ªå·±æœ€è¿‘è®¾è®¡å®ç° newdb çš„å·¥ä½œ é¡¹ç›®åœ°å€ anydemo/newdb æœ€è¿‘ä¸€æ®µæ—¶é—´èŠ±äº†å¾ˆå¤§çš„åŠ›æ°”å­¦ä¹ æ•°æ®åº“çš„çŸ¥è¯†ï¼Œè®¾è®¡å®ç°äº†ç®€å•çš„ RDBMS, æ”¶è·æ¯”è¾ƒä¸°å¯Œ å¼€å§‹å…ˆä»æ•°æ®åº“åº•å±‚çš„æ•°æ®æŒä¹…åŒ–å¼€å§‹ã€‚å†æ­¤è®¾è®¡çš„æ•°æ®åº“ä¸»è¦æ˜¯å›ºå®šç±»å‹å¤§å°çš„å…³ç³»å‹æ•°æ®åº“ã€‚ä¸€ä¸ª table ä¸­æœ‰å›ºå®šå¤§å°çš„ä¸€å®šæ•°é‡çš„æ•°æ®åˆ—ï¼Œæ¯ä¸€ä¸ª tuple çš„å¤§å°æ˜¯å›ºå®šä¸å˜çš„ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ª page çš„å¯ä»¥å®¹çº³çš„ tuple æ˜¯ä¸€å®šçš„ï¼Œè¿™æ ·å¾ˆå®¹æ˜“åœ¨è®°å½•æŸä¸€ä¸ª tuple çš„ä½ç½®ã€ä»¥åŠå…¶åœ¨æ–‡ä»¶ä¸­çš„ä½ç½®ã€‚åœ¨è¿™è¿‡ç¨‹ä¸­æ”¶è·æœ€å¤§çš„éƒ¨åˆ†å°±æ˜¯å¯¹äº Marshal äº Unmarshal çš„ç†è§£æ›´è¿›ä¸€æ­¥ï¼ŒçŸ¥é“æ•°æ®å¦‚ä½•åœ¨æ•°æ®åº“ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Œä»¥åŠäº‹åŠ¡çš„æœ¬è´¨ã€‚ æœ€åé€šè¿‡ä¸€ä¸ª Sequences Scan çš„ä¾‹å­ï¼Œæ‰‹å†™ä¸€ä¸ªç‰©ç†æ‰§è¡Œè®¡åˆ’ï¼Œæ‰§è¡Œä¸€æ¬¡å…¨è¡¨æ‰«æã€‚ æœªæ¥è¿˜æœ‰å¾ˆå¤šçš„å†…å®¹å¯ä»¥åšï¼Œæš‚æ—¶å‘Šä¸€æ®µè½ï¼Œæœ€è¿‘æŠ½æ—¶é—´æ²‰æ·€ä¸€ä¸‹ï¼Œæ€è€ƒä¸€ä¸‹æœªæ¥ï¼Œå›å¤´æœ‰æ—¶é—´äº†å†å›å¤´ç»§ç»­åŠ æ–°çš„å†…å®¹ã€‚æ¯•ç«Ÿissuesç§¯æ”’äº†å¤ªå¤šã€‚ ","date":"2019-06-29","objectID":"/go-simple-db-storage-engine/:0:0","tags":["db","wheel","go"],"title":"ä¸€ä¸ªç®€å•çš„æ•°æ®å­˜å‚¨å¼•æ“","uri":"/go-simple-db-storage-engine/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šæ¢³ç† k8s scheduler å·¥ä½œåŸç† office scheduler info code pkg/scheduler/scheduler.go#scheduleOne çœŸæ­£çš„æ‰§è¡Œé€»è¾‘ ç»„ä»¶ ","date":"2019-05-10","objectID":"/k8s-scheduler-introduce/:0:0","tags":["k8s","architecture"],"title":"K8s Scheduler","uri":"/k8s-scheduler-introduce/"},{"categories":null,"content":"scheduler è°ƒåº¦ä¼š binding åˆ° apiserverï¼Œå¼‚æ­¥çš„ç­‰å¾… pods å¯åŠ¨pkg/scheduler/scheduler.go#bind é»˜è®¤ pod è°ƒåº¦ç®—æ³•ï¼špkg/scheduler/core/generic_scheduler.go#genericScheduler ","date":"2019-05-10","objectID":"/k8s-scheduler-introduce/:1:0","tags":["k8s","architecture"],"title":"K8s Scheduler","uri":"/k8s-scheduler-introduce/"},{"categories":null,"content":"å¦‚ä½•è°ƒåº¦ â€œComputing predicatesâ€ â€œComputing predicatesâ€ï¼šè°ƒç”¨ findNodesThatFit()æ–¹æ³•ï¼› predicates.FitPredicate implement: NoDiskConflict â€œPrioritizingâ€ â€œPrioritizingâ€ï¼šè°ƒç”¨ PrioritizeNodes()æ–¹æ³•ï¼› â€œSelecting hostâ€ â€œSelecting hostâ€ï¼šè°ƒç”¨ selectHost()æ–¹æ³•ã€‚ List-Watch Informer ","date":"2019-05-10","objectID":"/k8s-scheduler-introduce/:1:1","tags":["k8s","architecture"],"title":"K8s Scheduler","uri":"/k8s-scheduler-introduce/"},{"categories":null,"content":"æŠ¢å è°ƒåº¦ pkg/scheduler/scheduler.go#preempt æ€»ç»“ kube-scheduler å·¥ä½œæµç¨‹ å¯¹ç»™å®šçš„ podï¼Œå…ˆåˆ—ä¸¾æ‰€æœ‰å¯è°ƒåº¦çš„ nodesï¼Œæ ¹æ®èµ„æºæ˜¯å¦å……è¶³åˆæ­¥è¿‡æ»¤ï¼›ä½¿ç”¨ä¼˜å…ˆçº§ç®—æ³•å¯¹ nodes è¿›è¡Œè®¡ç®—æ’åºï¼›æœ€ç»ˆé€‰æ‹©åˆ†æ•°æœ€é«˜çš„ä¸€ä¸ª node æ€»çš„å·¥ä½œæµç¨‹å›¾ï¼š referenced from here Reference kube-scheduler workflow ","date":"2019-05-10","objectID":"/k8s-scheduler-introduce/:1:2","tags":["k8s","architecture"],"title":"K8s Scheduler","uri":"/k8s-scheduler-introduce/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šæ­å»º vscode + k8s æœ¬åœ°å¼€å‘ç¯å¢ƒ ","date":"2019-05-10","objectID":"/k8s-vscode-dev-env-prepare/:0:0","tags":["k8s"],"title":"vscode æ­å»º k8s æœ¬åœ°å¼€å‘ç¯å¢ƒ","uri":"/k8s-vscode-dev-env-prepare/"},{"categories":null,"content":"vagrant env Linux ubuntu-bionic 4.15.0-47-generic #50-Ubuntu SMP Wed Mar 13 10:44:52 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux ","date":"2019-05-10","objectID":"/k8s-vscode-dev-env-prepare/:1:0","tags":["k8s"],"title":"vscode æ­å»º k8s æœ¬åœ°å¼€å‘ç¯å¢ƒ","uri":"/k8s-vscode-dev-env-prepare/"},{"categories":null,"content":"install golang wget https://dl.google.com/go/go1.12.5.linux-amd64.tar.gz tar -C /usr/local -xzf go$VERSION.$OS-$ARCH.tar.gz export GOPATH=$HOME/go export GOROOT=/usr/local/go export PATH=$PATH:$GOROOT/bin:\\$GOPATH/bin ","date":"2019-05-10","objectID":"/k8s-vscode-dev-env-prepare/:2:0","tags":["k8s"],"title":"vscode æ­å»º k8s æœ¬åœ°å¼€å‘ç¯å¢ƒ","uri":"/k8s-vscode-dev-env-prepare/"},{"categories":null,"content":"install docker ","date":"2019-05-10","objectID":"/k8s-vscode-dev-env-prepare/:3:0","tags":["k8s"],"title":"vscode æ­å»º k8s æœ¬åœ°å¼€å‘ç¯å¢ƒ","uri":"/k8s-vscode-dev-env-prepare/"},{"categories":null,"content":"disabled swap swapoff -a echo \"vm.swappiness = 0\"\u003e\u003e /etc/sysctl.conf sysctl -p ","date":"2019-05-10","objectID":"/k8s-vscode-dev-env-prepare/:4:0","tags":["k8s"],"title":"vscode æ­å»º k8s æœ¬åœ°å¼€å‘ç¯å¢ƒ","uri":"/k8s-vscode-dev-env-prepare/"},{"categories":null,"content":"k8s ","date":"2019-05-10","objectID":"/k8s-vscode-dev-env-prepare/:5:0","tags":["k8s"],"title":"vscode æ­å»º k8s æœ¬åœ°å¼€å‘ç¯å¢ƒ","uri":"/k8s-vscode-dev-env-prepare/"},{"categories":null,"content":"clone k8s source code mkdir -p $GOPATH/src/k8s.io cd $GOPATH/src/k8s.io/ git clone https://github.com/kubernetes/kubernetes.git ","date":"2019-05-10","objectID":"/k8s-vscode-dev-env-prepare/:5:1","tags":["k8s"],"title":"vscode æ­å»º k8s æœ¬åœ°å¼€å‘ç¯å¢ƒ","uri":"/k8s-vscode-dev-env-prepare/"},{"categories":null,"content":"startup local cluster hack/install-etcd.sh export PATH=\"$GOPATH/src/github.com/kubernetes/kubernetes/third_party/etcd:${PATH}\" hack/local-up-cluster.sh [-0] open another cmd tag export KUBECONFIG=/var/run/kubernetes/admin.kubeconfig cluster/kubectl.sh make WHAT=cmd/{\\$package_you_want} ","date":"2019-05-10","objectID":"/k8s-vscode-dev-env-prepare/:5:2","tags":["k8s"],"title":"vscode æ­å»º k8s æœ¬åœ°å¼€å‘ç¯å¢ƒ","uri":"/k8s-vscode-dev-env-prepare/"},{"categories":null,"content":"see k8s office dev guide https://github.com/kubernetes/community/blob/master/contributors/devel/development.md GO111MODULE=on GOPROXY=https://goproxy.io go get github.com/go-delve/delve ","date":"2019-05-10","objectID":"/k8s-vscode-dev-env-prepare/:6:0","tags":["k8s"],"title":"vscode æ­å»º k8s æœ¬åœ°å¼€å‘ç¯å¢ƒ","uri":"/k8s-vscode-dev-env-prepare/"},{"categories":null,"content":"others vscode, git ","date":"2019-05-10","objectID":"/k8s-vscode-dev-env-prepare/:7:0","tags":["k8s"],"title":"vscode æ­å»º k8s æœ¬åœ°å¼€å‘ç¯å¢ƒ","uri":"/k8s-vscode-dev-env-prepare/"},{"categories":null,"content":"debug by dlv åŒ golang + dlv + vscode æœ¬åœ°å¼€å‘ ","date":"2019-05-10","objectID":"/k8s-vscode-dev-env-prepare/:8:0","tags":["k8s"],"title":"vscode æ­å»º k8s æœ¬åœ°å¼€å‘ç¯å¢ƒ","uri":"/k8s-vscode-dev-env-prepare/"},{"categories":null,"content":"related links https://farmer-hutao.github.io/k8s-source-code-analysis/prepare/get-code.html æ¯”è¾ƒè€å¾—ç¬”è®° iptable ç³»åˆ—æ–‡ç«  ","date":"2019-05-10","objectID":"/k8s-vscode-dev-env-prepare/:9:0","tags":["k8s"],"title":"vscode æ­å»º k8s æœ¬åœ°å¼€å‘ç¯å¢ƒ","uri":"/k8s-vscode-dev-env-prepare/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šk8s æ¶æ„æè¿° https://kubernetes.io/docs/concepts/ ","date":"2019-05-10","objectID":"/k8s-architecture-introduce/:0:0","tags":["k8s","architecture"],"title":"K8s æ¶æ„ä»‹ç»","uri":"/k8s-architecture-introduce/"},{"categories":null,"content":"æ¶æ„å›¾ ","date":"2019-05-10","objectID":"/k8s-architecture-introduce/:1:0","tags":["k8s","architecture"],"title":"K8s æ¶æ„ä»‹ç»","uri":"/k8s-architecture-introduce/"},{"categories":null,"content":"ç»„ä»¶ etcd + docker/rkt/containerd + Kubernetes + kubelet + kube-proxy + kube-apiserver + kube-controller-manager + kube-scheduler ","date":"2019-05-10","objectID":"/k8s-architecture-introduce/:2:0","tags":["k8s","architecture"],"title":"K8s æ¶æ„ä»‹ç»","uri":"/k8s-architecture-introduce/"},{"categories":null,"content":"åŸºæœ¬æ¦‚å¿µ copied from here Cluster : é›†ç¾¤æ˜¯æŒ‡ç”± Kubernetes ä½¿ç”¨ä¸€ç³»åˆ—çš„ç‰©ç†æœºã€è™šæ‹Ÿæœºå’Œå…¶ä»–åŸºç¡€èµ„æºæ¥è¿è¡Œä½ çš„åº”ç”¨ç¨‹åºã€‚ Node : ä¸€ä¸ª node å°±æ˜¯ä¸€ä¸ªè¿è¡Œç€ Kubernetes çš„ç‰©ç†æœºæˆ–è™šæ‹Ÿæœºï¼Œå¹¶ä¸” pod å¯ä»¥åœ¨å…¶ä¸Šé¢è¢«è°ƒåº¦ã€‚. Pod : ä¸€ä¸ª pod å¯¹åº”ä¸€ä¸ªç”±ç›¸å…³å®¹å™¨å’Œå·ç»„æˆçš„å®¹å™¨ç»„ ï¼ˆäº†è§£ Pod è¯¦æƒ…ï¼‰ Label : ä¸€ä¸ª label æ˜¯ä¸€ä¸ªè¢«é™„åŠ åˆ°èµ„æºä¸Šçš„é”®/å€¼å¯¹ï¼Œè­¬å¦‚é™„åŠ åˆ°ä¸€ä¸ª Pod ä¸Šï¼Œä¸ºå®ƒä¼ é€’ä¸€ä¸ªç”¨æˆ·è‡ªå®šçš„å¹¶ä¸”å¯è¯†åˆ«çš„å±æ€§.Label è¿˜å¯ä»¥è¢«åº”ç”¨æ¥ç»„ç»‡å’Œé€‰æ‹©å­ç½‘ä¸­çš„èµ„æºï¼ˆäº†è§£ Label è¯¦æƒ…ï¼‰ selector: æ˜¯ä¸€ä¸ªé€šè¿‡åŒ¹é… labels æ¥å®šä¹‰èµ„æºä¹‹é—´å…³ç³»å¾—è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ä¸ºä¸€ä¸ªè´Ÿè½½å‡è¡¡çš„ service æŒ‡å®šæ‰€ç›®æ ‡ Pod.ï¼ˆäº†è§£ selector è¯¦æƒ…ï¼‰ Replication Controller : replication controller æ˜¯ä¸ºäº†ä¿è¯ä¸€å®šæ•°é‡è¢«æŒ‡å®šçš„ Pod çš„å¤åˆ¶å“åœ¨ä»»ä½•æ—¶é—´éƒ½èƒ½æ­£å¸¸å·¥ä½œ.å®ƒä¸ä»…å…è®¸å¤åˆ¶çš„ç³»ç»Ÿæ˜“äºæ‰©å±•ï¼Œè¿˜ä¼šå¤„ç†å½“ pod åœ¨æœºå™¨åœ¨é‡å¯æˆ–å‘ç”Ÿæ•…éšœçš„æ—¶å€™å†æ¬¡åˆ›å»ºä¸€ä¸ªï¼ˆäº†è§£ Replication Controller è¯¦æƒ…ï¼‰ Service : ä¸€ä¸ª service å®šä¹‰äº†è®¿é—® pod çš„æ–¹å¼ï¼Œå°±åƒå•ä¸ªå›ºå®šçš„ IP åœ°å€å’Œä¸å…¶ç›¸å¯¹åº”çš„ DNS åä¹‹é—´çš„å…³ç³»ã€‚ï¼ˆäº†è§£ Service è¯¦æƒ…ï¼‰ Volume: ä¸€ä¸ª volume æ˜¯ä¸€ä¸ªç›®å½•ï¼Œå¯èƒ½ä¼šè¢«å®¹å™¨ä½œä¸ºæœªè§ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†æ¥è®¿é—®ã€‚ï¼ˆäº†è§£ Volume è¯¦æƒ…ï¼‰ Kubernetes volume æ„å»ºåœ¨ Docker Volumes ä¹‹ä¸Š,å¹¶ä¸”æ”¯æŒæ·»åŠ å’Œé…ç½® volume ç›®å½•æˆ–è€…å…¶ä»–å­˜å‚¨è®¾å¤‡ã€‚ Secret : Secret å­˜å‚¨äº†æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚èƒ½å…è®¸å®¹å™¨æ¥æ”¶è¯·æ±‚çš„æƒé™ä»¤ç‰Œã€‚ Name : ç”¨æˆ·ä¸º Kubernetes ä¸­èµ„æºå®šä¹‰çš„åå­— Namespace : Namespace å¥½æ¯”ä¸€ä¸ªèµ„æºåå­—çš„å‰ç¼€ã€‚å®ƒå¸®åŠ©ä¸åŒçš„é¡¹ç›®ã€å›¢é˜Ÿæˆ–æ˜¯å®¢æˆ·å¯ä»¥å…±äº« cluster,ä¾‹å¦‚é˜²æ­¢ç›¸äº’ç‹¬ç«‹çš„å›¢é˜Ÿé—´å‡ºç°å‘½åå†²çª Annotation : ç›¸å¯¹äº label æ¥è¯´å¯ä»¥å®¹çº³æ›´å¤§çš„é”®å€¼å¯¹ï¼Œå®ƒå¯¹æˆ‘ä»¬æ¥è¯´å¯èƒ½æ˜¯ä¸å¯è¯»çš„æ•°æ®ï¼Œåªæ˜¯ä¸ºäº†å­˜å‚¨ä¸å¯è¯†åˆ«çš„è¾…åŠ©æ•°æ®ï¼Œå°¤å…¶æ˜¯ä¸€äº›è¢«å·¥å…·æˆ–ç³»ç»Ÿæ‰©å±•ç”¨æ¥æ“ä½œçš„æ•°æ® ","date":"2019-05-10","objectID":"/k8s-architecture-introduce/:2:1","tags":["k8s","architecture"],"title":"K8s æ¶æ„ä»‹ç»","uri":"/k8s-architecture-introduce/"},{"categories":null,"content":"related links Kubernetes è®¾è®¡æ¶æ„-å®Œæ•´æ–‡æ¡£ ","date":"2019-05-10","objectID":"/k8s-architecture-introduce/:3:0","tags":["k8s","architecture"],"title":"K8s æ¶æ„ä»‹ç»","uri":"/k8s-architecture-introduce/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šGo ç¨‹åºå¯åŠ¨ RPC å­è¿›ç¨‹ï¼Œé€šè¿‡ pipe è¿›è¡Œäº¤äº’ï¼Œä»¥åŠé€šè¿‡ RPC äº¤äº’ ä»£ç è§ exfly/go-ipc å¼•è¨€ ä¸ºä»€ä¹ˆè¦å†™è¿™ç¯‡æ–‡ç« ã€‚æœ€è¿‘çœ‹äº†ä¸€äº› Docker æºç ã€‚dockerd çš„æ¶æ„é•¿è¿™ä¸ªæ ·å­ã€‚ ä¸€æ¡ docker å‘½ä»¤çš„æ‰§è¡Œï¼Œæ¯”å¦‚docker runï¼Œæ˜¯å…ˆç”± containerd æ‰§è¡Œï¼Œcontainerd ä¹ŸåŒæ ·ä¸æ˜¯çœŸæ­£è¿è¡Œå®¹å™¨ï¼Œä»–ä¼šå°†æ‰§è¡Œè¯·æ±‚å‘ç»™ runcï¼Œæœ‰ runc çœŸæ­£å»æ‰§è¡Œã€‚dockerdã€containderdã€runc åˆ†åˆ«æ˜¯ä¸‰ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä»–ä»¬æ˜¯é€šè¿‡ ç®¡é“ï¼ˆIPCï¼‰ä»¥åŠ restã€RPC è¿›è¡Œäº¤äº’çš„ã€‚ ä¸ºäº†å±•ç¤ºä¸‰è€…äº¤äº’æ–¹å¼æ˜¯å¦‚ä½•è¿›è¡Œçš„ï¼Œè¿™é‡Œå†™ä¸€ä¸ªç®€å•çš„ demo æ¥è§£é‡Šã€‚ æ­£æ–‡ ","date":"2019-05-05","objectID":"/go-rpc-ipc-demo/:0:0","tags":["go","IPC","RPC"],"title":"Go å¯åŠ¨å¤šä¸ªç¨‹åºï¼ŒåŠ IPC å’Œ RPC äº¤äº’ä¾‹å­,ä»¥åŠ Gracefully Shutdown","uri":"/go-rpc-ipc-demo/"},{"categories":null,"content":"RPC é¦–å…ˆè¯´ä¸€ä¸‹ RPCã€‚Go æ ‡å‡†åº“ä¾¿æœ‰net/rpcï¼Œå†™ä¸€ä¸ª Go çš„ rpc å¾ˆç®€å•ï¼š package main import ( \"log\" \"net\" \"net/http\" \"net/rpc\" ) type Task []string type Todo {ID string} func (t Task) Get(id string, reply *Todo) error { *reply=Todo{ID:id} return nil } func main() { task := new(Task) // Publish the receivers methods err := rpc.Register(task) if err != nil { log.Fatal(\"Format of service Task isn't correct. \", err) } // Register a HTTP handler rpc.HandleHTTP() listener, e := net.Listen(\"unix\", \"rpc.sock\") if e != nil { log.Fatal(\"Listen error: \", e) } err = http.Serve(listener, nil) if err != nil { log.Fatal(\"Error serving: \", err) } } // client client, err := rpc.DialHTTP(\"unix\", \"rpc.sock\") reply := TODO{} err = client.Call(\"Task.Get\", \"new_id\", \u0026reply) ","date":"2019-05-05","objectID":"/go-rpc-ipc-demo/:1:0","tags":["go","IPC","RPC"],"title":"Go å¯åŠ¨å¤šä¸ªç¨‹åºï¼ŒåŠ IPC å’Œ RPC äº¤äº’ä¾‹å­,ä»¥åŠ Gracefully Shutdown","uri":"/go-rpc-ipc-demo/"},{"categories":null,"content":"å¦‚ä½•è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ IPC å‘¢ é¦–å…ˆ linux ä¸‹çš„ FIFOï¼ˆæœ‰åç®¡é“ï¼‰æ˜¯ä»€ä¹ˆæ ·å­çš„ mkfifo tpipe ll # total 8 # drwx------ 2 vagrant vagrant 4096 May 18 17:28 ./ # drwxrwxrwt 10 root root 4096 May 18 17:28 ../ # prw-rw-r-- 1 vagrant vagrant 0 May 18 17:28 tpipe| # ç°åœ¨ä¸€ä¸ªterminal cat tpipe # å¦ä¸€ä¸ªterminal echo tttttttttt \u003e tpipe æ­¤æ—¶ç¬¬ä¸€ä¸ª terminal ä¼šè¾“å‡º ttttttttttï¼Œå¦ä¸€ä¸ªå‘½ä»¤è¡Œä¼šè¿”å› åœ¨ Go ä¸­åº”è¯¥å¦‚ä½•ä½¿ç”¨ rpcSvrCmd := exec.Command(conf.RPCSvrBinPath) rpcSvrStdinPipe, err := rpcSvrCmd.StdinPipe() rpcSvrStdoutPipe, err := rpcSvrCmd.StdoutPipe() rpcSvrStderrPipe, err := rpcSvrCmd.StderrPipe() rpcSvrCmd.Start() å¦‚æ­¤å³å¯è·å¾—å­è¿›ç¨‹çš„å„ç§ FIFO å®Œæ•´ä¾‹å­ ä»£ç è§ exfly/go-ipc make task rpc \u0026\u0026 ./bin/task # â–¶ running gofmtâ€¦ # â–¶ running golintâ€¦ # â–¶ building executableâ€¦ # â–¶ building executableâ€¦ # 2019/05/19 01:33:12 sleep 1s to wait rpc server startup # 2019/05/19 01:33:13 2019/05/19 01:33:12 Serving RPC server on {unix rpc.sock} # 2019/05/19 01:33:13 Finish App: {Finish App Started} # 2019/05/19 01:33:13 2019/05/19 01:33:13 stop the server # 2019/05/19 01:33:13 2019/05/19 01:33:13 deleted socket file: rpc.sock # 2019/05/19 01:33:13 pipe rpc_srv_stderr has Closed # 2019/05/19 01:33:13 pipe rpc_srv_stdout has Closed # 2019/05/19 01:33:13 stop subproc ./bin/task-rpc success å½“å‰æ›´æ–°ä¸»è¦ä»¥å‘å¸ƒä»£ç ä¸ºä¸»ï¼Œæ²¡æœ‰è¯¦ç»†è§£é‡Šï¼Œè¯¦ç»†è§ä»£ç  exfly/go-ipc ","date":"2019-05-05","objectID":"/go-rpc-ipc-demo/:2:0","tags":["go","IPC","RPC"],"title":"Go å¯åŠ¨å¤šä¸ªç¨‹åºï¼ŒåŠ IPC å’Œ RPC äº¤äº’ä¾‹å­,ä»¥åŠ Gracefully Shutdown","uri":"/go-rpc-ipc-demo/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šæè¿° docker volume çš„åŸç† docker å­˜å‚¨åŸºäº UnionFS å®ç°ï¼Œæ‰€æœ‰å®¹å™¨å­˜å‚¨æ˜¯å°†å¤šä¸ª layout å±‚é€šè¿‡ç±»ä¼¼ aufs æˆ–è€… overlay2 å°†å¤šä¸ªå±‚è”åˆåˆ°ä¸€èµ·ï¼Œmount æˆæ–°çš„ç›®å½•ï¼Œåœ¨é€šè¿‡ namespaces å°†æ–°çš„æ–‡ä»¶ç›®å½• chroot è¿›å…¥æ–°å¯åŠ¨çš„è¿›ç¨‹ï¼Œè¾¾åˆ°æ–‡ä»¶éš”ç¦»çš„ç›®çš„ã€‚ å¯¹äºè¯»è¯·æ±‚ï¼Œç”±äºå†™å®å¤åˆ¶æŠ€æœ¯ï¼Œä¼šç›´æ¥è¯»å–åº•å±‚æ–‡ä»¶ å¯¹äºå†™è¯·æ±‚ï¼Œä¼šå…ˆå°†æ–‡ä»¶å¤åˆ¶åˆ°è¯»å†™å±‚ï¼Œç„¶åè¿›è¡Œä¿®æ”¹æ–‡ä»¶ å¯¹äºåˆ é™¤ï¼Œæ²¡æœ‰çœŸæ­£åˆ é™¤æ–‡ä»¶ï¼Œåªæ˜¯è®²æ–‡ä»¶æ ‡è®°åˆ é™¤ï¼Œæ²¡æœ‰çœŸæ­£åˆ é™¤ä¸‹å±‚æ–‡ä»¶ã€‚ å‘½ä»¤ docker volume create volume-for-testå¯ä»¥åˆ›å»ºæ–°çš„ volume docker volume ls æŸ¥çœ‹æ–°åˆ›å»ºçš„ volume docker volume inspect volume-for-test docker run -d --name devtest --mount source=volume-for-test,target=/app alpine /bin/sh docker inspect \u003ccontainer_id\u003e| grap Mounts å¯ä»¥çœ‹åˆ°åˆšåˆš mount è¿›å»çš„ volume /var/lib/docker/volumes/volume-for-test/_data related links Manage data in Docker Use volumes docker å­˜å‚¨åŸºç¡€ ","date":"2019-05-05","objectID":"/docker-volume/:0:0","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Docker Volume","uri":"/docker-volume/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šdocker build æºç é˜…è¯» é˜…è¯»æºç é¡ºåº api/server/router/build/build_routes.go#postBuild api/server/backend/build/backend.go#Build builder/builder-next/builder.go#Build builder/dockerfile/builder.go#Build builder/dockerfile/builder.go#dispatchDockerfileWithCancellation builder/dockerfile/evaluator.go#dispatchï¼Œåœ¨è¿™é‡Œï¼Œæœ‰æ‰€æœ‰å‘½ä»¤çš„æ‰§è¡Œæ–¹å¼ï¼Œå¯ä»¥ä»”ç»†ç ”ç©¶ä¸€ä¸‹ åœ¨dispatchä¸­æœ‰ dockerfile æ”¯æŒçš„æŒ‡ä»¤ï¼Œå¦‚RUNç­‰ã€‚ä»¥ RUN ä¸ºä¾‹ï¼Œdockerd ä¼šè¯»å– CLI å‘æ¥çš„ dockerfileï¼Œè§£æåã€‚å¦‚æœä¸º RUNï¼Œåˆ™ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„ container,ç„¶ååœ¨å®¹å™¨ä¸­æ‰§è¡Œï¼Œæ‰§è¡Œç»“æŸåå°†å½“å‰å±‚ commitï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæŒ‡ä»¤. å…¶ä»– ä» v18.09å¼€å§‹ï¼Œdocker build ä¾èµ–äº buildkit ","date":"2019-05-05","objectID":"/docker-build/:0:0","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Docker Build","uri":"/docker-build/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šé€šè¿‡åˆ†æ docker run å‘½ä»¤ï¼Œç†è§£ Docker çš„å·¥ä½œåŸç† docker runæ‰§è¡Œæµç¨‹åˆ†æ æ•´ä½“æ‰§è¡Œæµç¨‹: ä»æœ¬åœ°é•œåƒä¸­å¯»æ‰¾æ˜¯å¦å­˜åœ¨å‘½ä»¤æŒ‡å®šé•œåƒï¼Œå¦‚æœå­˜åœ¨åˆ™æ­£å¸¸è¿”å›ï¼Œæ‰§è¡Œæ¥ä¸‹æ¥æµç¨‹ã€‚å¦‚æœä¸å­˜åœ¨é•œåƒï¼Œdeamon è¿”å›é”™è¯¯ï¼Œç”± cli é‡æ–°å‘èµ· pull è¯·æ±‚ï¼Œä¹‹åé‡è¯•ã€‚ ","date":"2019-04-29","objectID":"/docker-run/:0:0","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Docker Run","uri":"/docker-run/"},{"categories":null,"content":"æ€»ä½“æè¿° createContainer cli é€šè¿‡ rest æ¥å£è¯·æ±‚ dockerd åˆ›å»ºå®¹å™¨ï¼Œdockerd è®¾ç½®åŸºç¡€é…ç½®åè®°å½•åˆ›å»ºçš„å®¹å™¨ ContainerStart cli é€šè¿‡ rest æ¥å£è¯·æ±‚ dockerd è¿è¡Œå®¹å™¨ï¼Œdockerd ä½¿ç”¨ rpc é“¾æ¥ containnerd è¿›è¡Œè¿è¡Œå®¹å™¨ ä»£ç  lanything/code-read forked moby/moby, lanything/cli forked docker/cli ","date":"2019-04-29","objectID":"/docker-run/:0:1","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Docker Run","uri":"/docker-run/"},{"categories":null,"content":"createContainer docker/cli cli/command/container/run.go#NewRunCommand docker/cli cli/command/container/run.go#runContainer // cli/command/container/create.go#createContainer func createContainer(ctx context.Context, dockerCli command.Cli, containerConfig *containerConfig, opts *createOptions) (*container.ContainerCreateCreatedBody, error) { config := containerConfig.Config hostConfig := containerConfig.HostConfig networkingConfig := containerConfig.NetworkingConfig stderr := dockerCli.Err() warnOnOomKillDisable(*hostConfig, stderr) warnOnLocalhostDNS(*hostConfig, stderr) var ( trustedRef reference.Canonical namedRef reference.Named ) containerIDFile, err := newCIDFile(hostConfig.ContainerIDFile) if err != nil { return nil, err } defer containerIDFile.Close() ref, err := reference.ParseAnyReference(config.Image) if err != nil { return nil, err } if named, ok := ref.(reference.Named); ok { namedRef = reference.TagNameOnly(named) if taggedRef, ok := namedRef.(reference.NamedTagged); ok \u0026\u0026 !opts.untrusted { var err error trustedRef, err = image.TrustedReference(ctx, dockerCli, taggedRef, nil) if err != nil { return nil, err } config.Image = reference.FamiliarString(trustedRef) } } //create the container response, err := dockerCli.Client().ContainerCreate(ctx, config, hostConfig, networkingConfig, opts.name) //if image not found try to pull it if err != nil { if apiclient.IsErrNotFound(err) \u0026\u0026 namedRef != nil { fmt.Fprintf(stderr, \"Unable to find image '%s' locally\\n\", reference.FamiliarString(namedRef)) // we don't want to write to stdout anything apart from container.ID if err := pullImage(ctx, dockerCli, config.Image, opts.platform, stderr); err != nil { return nil, err } if taggedRef, ok := namedRef.(reference.NamedTagged); ok \u0026\u0026 trustedRef != nil { if err := image.TagTrusted(ctx, dockerCli, trustedRef, taggedRef); err != nil { return nil, err } } // Retry var retryErr error response, retryErr = dockerCli.Client().ContainerCreate(ctx, config, hostConfig, networkingConfig, opts.name) if retryErr != nil { return nil, retryErr } } else { return nil, err } } for _, warning := range response.Warnings { fmt.Fprintf(stderr, \"WARNING: %s\\n\", warning) } err = containerIDFile.Write(response.ID) return \u0026response, err } docker/cli cli/command/container/create.go#createContainer è°ƒç”¨ ContainerCreate moby/moby api/server/router/container/container.go#initRoutes.postContainersCreate moby/moby api/server/router/container/container_routes.go#postContainersCreate moby/moby daemon/create.go#ContainerCreate ","date":"2019-04-29","objectID":"/docker-run/:0:2","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Docker Run","uri":"/docker-run/"},{"categories":null,"content":"containerCreate // `moby/moby` daemon/create.go#containerCreate func (daemon *Daemon) containerCreate(opts createOpts) (containertypes.ContainerCreateCreatedBody, error) { start := time.Now() if opts.params.Config == nil { return containertypes.ContainerCreateCreatedBody{}, errdefs.InvalidParameter(errors.New(\"Config cannot be empty in order to create a container\")) } os := runtime.GOOS if opts.params.Config.Image != \"\" { img, err := daemon.imageService.GetImage(opts.params.Config.Image) if err == nil { os = img.OS } } else { // This mean scratch. On Windows, we can safely assume that this is a linux // container. On other platforms, it's the host OS (which it already is) if runtime.GOOS == \"windows\" \u0026\u0026 system.LCOWSupported() { os = \"linux\" } } warnings, err := daemon.verifyContainerSettings(os, opts.params.HostConfig, opts.params.Config, false) if err != nil { return containertypes.ContainerCreateCreatedBody{Warnings: warnings}, errdefs.InvalidParameter(err) } err = verifyNetworkingConfig(opts.params.NetworkingConfig) if err != nil { return containertypes.ContainerCreateCreatedBody{Warnings: warnings}, errdefs.InvalidParameter(err) } if opts.params.HostConfig == nil { opts.params.HostConfig = \u0026containertypes.HostConfig{} } err = daemon.adaptContainerSettings(opts.params.HostConfig, opts.params.AdjustCPUShares) if err != nil { return containertypes.ContainerCreateCreatedBody{Warnings: warnings}, errdefs.InvalidParameter(err) } container, err := daemon.create(opts) if err != nil { return containertypes.ContainerCreateCreatedBody{Warnings: warnings}, err } containerActions.WithValues(\"create\").UpdateSince(start) if warnings == nil { warnings = make([]string, 0) // Create an empty slice to avoid https://github.com/moby/moby/issues/38222 } return containertypes.ContainerCreateCreatedBody{ID: container.ID, Warnings: warnings}, nil } ","date":"2019-04-29","objectID":"/docker-run/:0:3","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Docker Run","uri":"/docker-run/"},{"categories":null,"content":"GetImages // GetImage returns an image corresponding to the image referred to by refOrID. func (i *ImageService) GetImage(refOrID string) (*image.Image, error) { ref, err := reference.ParseAnyReference(refOrID) if err != nil { return nil, errdefs.InvalidParameter(err) } namedRef, ok := ref.(reference.Named) if !ok { digested, ok := ref.(reference.Digested) if !ok { return nil, ErrImageDoesNotExist{ref} } id := image.IDFromDigest(digested.Digest()) if img, err := i.imageStore.Get(id); err == nil { return img, nil } return nil, ErrImageDoesNotExist{ref} } if digest, err := i.referenceStore.Get(namedRef); err == nil { // Search the image stores to get the operating system, defaulting to host OS. id := image.IDFromDigest(digest) if img, err := i.imageStore.Get(id); err == nil { return img, nil } } // Search based on ID if id, err := i.imageStore.Search(refOrID); err == nil { img, err := i.imageStore.Get(id) if err != nil { return nil, ErrImageDoesNotExist{ref} } return img, nil } return nil, ErrImageDoesNotExist{ref} } ImageService.imageStore åœ¨mobydaemon/daemon.go#NewDaemon ä¸­æœ‰è®¾ç½® ImageService.imageStore åœ¨mobyimage/store.go#NewImageStore æœ‰åˆå§‹åŒ– ","date":"2019-04-29","objectID":"/docker-run/:0:4","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Docker Run","uri":"/docker-run/"},{"categories":null,"content":"ContainerStart moby daemon/start.go#ContainerStart func (daemon *Daemon) ContainerStart(name string, hostConfig *containertypes.HostConfig, checkpoint string, checkpointDir string) error { if checkpoint != \"\" \u0026\u0026 !daemon.HasExperimental() { return errdefs.InvalidParameter(errors.New(\"checkpoint is only supported in experimental mode\")) } container, err := daemon.GetContainer(name) if err != nil { return err } validateState := func() error { container.Lock() defer container.Unlock() if container.Paused { return errdefs.Conflict(errors.New(\"cannot start a paused container, try unpause instead\")) } if container.Running { return containerNotModifiedError{running: true} } if container.RemovalInProgress || container.Dead { return errdefs.Conflict(errors.New(\"container is marked for removal and cannot be started\")) } return nil } if err := validateState(); err != nil { return err } // Windows does not have the backwards compatibility issue here. if runtime.GOOS != \"windows\" { // This is kept for backward compatibility - hostconfig should be passed when // creating a container, not during start. if hostConfig != nil { logrus.Warn(\"DEPRECATED: Setting host configuration options when the container starts is deprecated and has been removed in Docker 1.12\") oldNetworkMode := container.HostConfig.NetworkMode if err := daemon.setSecurityOptions(container, hostConfig); err != nil { return errdefs.InvalidParameter(err) } if err := daemon.mergeAndVerifyLogConfig(\u0026hostConfig.LogConfig); err != nil { return errdefs.InvalidParameter(err) } if err := daemon.setHostConfig(container, hostConfig); err != nil { return errdefs.InvalidParameter(err) } newNetworkMode := container.HostConfig.NetworkMode if string(oldNetworkMode) != string(newNetworkMode) { // if user has change the network mode on starting, clean up the // old networks. It is a deprecated feature and has been removed in Docker 1.12 container.NetworkSettings.Networks = nil if err := container.CheckpointTo(daemon.containersReplica); err != nil { return errdefs.System(err) } } container.InitDNSHostConfig() } } else { if hostConfig != nil { return errdefs.InvalidParameter(errors.New(\"Supplying a hostconfig on start is not supported. It should be supplied on create\")) } } // check if hostConfig is in line with the current system settings. // It may happen cgroups are umounted or the like. if _, err = daemon.verifyContainerSettings(container.OS, container.HostConfig, nil, false); err != nil { return errdefs.InvalidParameter(err) } // Adapt for old containers in case we have updates in this function and // old containers never have chance to call the new function in create stage. if hostConfig != nil { if err := daemon.adaptContainerSettings(container.HostConfig, false); err != nil { return errdefs.InvalidParameter(err) } } return daemon.containerStart(container, checkpoint, checkpointDir, true) } moby daemon/start.go#containerStart // containerStart prepares the container to run by setting up everything the // container needs, such as storage and networking, as well as links // between containers. The container is left waiting for a signal to // begin running. func (daemon *Daemon) containerStart(container *container.Container, checkpoint string, checkpointDir string, resetRestartManager bool) (err error) { start := time.Now() container.Lock() defer container.Unlock() if resetRestartManager \u0026\u0026 container.Running { // skip this check if already in restarting step and resetRestartManager==false return nil } if container.RemovalInProgress || container.Dead { return errdefs.Conflict(errors.New(\"container is marked for removal and cannot be started\")) } if checkpointDir != \"\" { // TODO(mlaventure): how would we support that? return errdefs.Forbidden(errors.New(\"custom checkpointdir is not supported\")) } // if we encounter an error during start we need to ensure that any other // setup has been cleaned up properly defer func() { if err != nil { container.SetError(err) // if no one else has set it, make","date":"2019-04-29","objectID":"/docker-run/:0:5","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Docker Run","uri":"/docker-run/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šä»‹ç» docker å¼€å‘ç¯å¢ƒæ­å»º docker å®˜æ–¹çš„è´¡çŒ®å¼•å¯¼: moby/docs/contributing/README.md æ­¥éª¤ moby/docs/contributing/set-up-dev-env.mdå®Œæ•´çš„æè¿°äº†å¼€å‘ç¯å¢ƒå¦‚ä½•æ­å»º ","date":"2019-04-23","objectID":"/docker-source-dev-install/:0:0","tags":["docker","container","æºç "],"title":"Docker æºç é˜…è¯»: å¼€å‘ç¯å¢ƒæ­å»º","uri":"/docker-source-dev-install/"},{"categories":null,"content":"å¼€å‘ç¯å¢ƒæ­å»º å› ä¸ºç½‘ç»œé—®é¢˜ï¼Œéœ€è¦å°½å¿«çš„æé€Ÿå®‰è£… dev ç¯å¢ƒï¼Œéœ€è¦é…ç½® Dockerfile ä¸­çš„é…ç½® APT_MIRROR=mirrors.163.com è¿è¡Œmake --just-print BIND_DIR=. shellç®€å•çš„çœ‹ä¸€ä¸‹ make éƒ½åšäº†é‚£äº›äº‹æƒ… è¿è¡Œmake BIND_DIR=. shellå¼€å§‹å®‰è£…å¼€å‘ç¯å¢ƒ ","date":"2019-04-23","objectID":"/docker-source-dev-install/:0:1","tags":["docker","container","æºç "],"title":"Docker æºç é˜…è¯»: å¼€å‘ç¯å¢ƒæ­å»º","uri":"/docker-source-dev-install/"},{"categories":null,"content":"ç¼–è¯‘ ä¸Šä¸€èŠ‚å·²ç»è¿›å…¥ docker ä¸­ï¼Œå¯ä»¥å¼€å§‹ç¼–è¯‘ dockerd hack/make.sh binary make installcopy binary to containerâ€™s /usr/local/bin/ dockerd -D \u0026 ","date":"2019-04-23","objectID":"/docker-source-dev-install/:0:2","tags":["docker","container","æºç "],"title":"Docker æºç é˜…è¯»: å¼€å‘ç¯å¢ƒæ­å»º","uri":"/docker-source-dev-install/"},{"categories":null,"content":"æ—¥å¸¸å·¥ä½œæµ ä¿®æ”¹ä»£ç  hack/make.sh binary install-binary ","date":"2019-04-23","objectID":"/docker-source-dev-install/:0:3","tags":["docker","container","æºç "],"title":"Docker æºç é˜…è¯»: å¼€å‘ç¯å¢ƒæ­å»º","uri":"/docker-source-dev-install/"},{"categories":null,"content":"å¸¸ç”¨ç›®å½•/å‘½ä»¤ docker inspect æŸ¥çœ‹é•œåƒæˆ–å®¹å™¨è¿è¡Œé…ç½®ä¿¡æ¯ï¼ŒGraphDriver ä¸ºå®¹å™¨æŒ‚è½½ä¿¡æ¯ /var/lib/docker/overlay2/\u003cimage_id\u003e/{merged, diff, work} /var/lib/docker/containerså½“å‰è¿è¡Œä¸­çš„å®¹å™¨é…ç½®ä¿¡æ¯ /var/lib/docker/imageé•œåƒåº“ /var/lib/docker/volumesvolumes å‚¨å­˜ä½ç½® è°ƒè¯• ","date":"2019-04-23","objectID":"/docker-source-dev-install/:0:4","tags":["docker","container","æºç "],"title":"Docker æºç é˜…è¯»: å¼€å‘ç¯å¢ƒæ­å»º","uri":"/docker-source-dev-install/"},{"categories":null,"content":"è°ƒè¯• makefile make --just-print BIND_DIR=. shell ","date":"2019-04-23","objectID":"/docker-source-dev-install/:1:0","tags":["docker","container","æºç "],"title":"Docker æºç é˜…è¯»: å¼€å‘ç¯å¢ƒæ­å»º","uri":"/docker-source-dev-install/"},{"categories":null,"content":"è°ƒè¯• shell bash -x hack/make.sh binary ","date":"2019-04-23","objectID":"/docker-source-dev-install/:2:0","tags":["docker","container","æºç "],"title":"Docker æºç é˜…è¯»: å¼€å‘ç¯å¢ƒæ­å»º","uri":"/docker-source-dev-install/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šdockeråŸºæœ¬æ¶æ„ï¼Œä»¥åŠåœ¨ moby å¼€æºé¡¹ç›®ç›¸å…³çš„ä¸€äº›ç»„ä»¶ä¹‹é—´å¦‚ä½•ååŒå·¥ä½œçš„ Docker? ","date":"2019-04-22","objectID":"/docker-architecture/:0:0","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Dockeræ¶æ„ä»‹ç»","uri":"/docker-architecture/"},{"categories":null,"content":"æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Docker åšä»€ä¹ˆ å¿«é€Ÿï¼Œä¸€è‡´åœ°äº¤ä»˜æ‚¨çš„åº”ç”¨ç¨‹åº Docker å…è®¸å¼€å‘äººå‘˜ä½¿ç”¨æä¾›åº”ç”¨ç¨‹åºå’ŒæœåŠ¡çš„æœ¬åœ°å®¹å™¨åœ¨æ ‡å‡†åŒ–ç¯å¢ƒä¸­å·¥ä½œï¼Œä»è€Œç®€åŒ–äº†å¼€å‘ç”Ÿå‘½å‘¨æœŸã€‚ å®¹å™¨éå¸¸é€‚åˆæŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ï¼ˆCI / CDï¼‰å·¥ä½œæµç¨‹ã€‚ docker å…¨å±€æ¶æ„ CLI ä½¿ç”¨ Docker REST API é€šè¿‡è„šæœ¬æˆ–ç›´æ¥ CLI å‘½ä»¤æ§åˆ¶ Docker å®ˆæŠ¤ç¨‹åºæˆ–ä¸ Docker å®ˆæŠ¤ç¨‹åºäº¤äº’ã€‚ è®¸å¤šå…¶ä»– Docker åº”ç”¨ç¨‹åºä½¿ç”¨åº•å±‚ API å’Œ CLIã€‚ Docker daemon åˆ›å»ºå’Œç®¡ç† Docker å¯¹è±¡ï¼Œä¾‹å¦‚ imagesï¼Œcontainersï¼Œnetworks å’Œ volumesã€‚ ","date":"2019-04-22","objectID":"/docker-architecture/:1:0","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Dockeræ¶æ„ä»‹ç»","uri":"/docker-architecture/"},{"categories":null,"content":"The Docker daemon Docker daemonï¼ˆdockerdï¼‰ç›‘å¬ Docker API è¯·æ±‚å¹¶ç®¡ç† Docker å¯¹è±¡ï¼Œä¾‹å¦‚ imagesï¼Œcontainersï¼Œnetworks å’Œ volumesã€‚ Docker daemon è¿˜å¯ä»¥ä¸å…¶ä»–å®ˆæŠ¤ç¨‹åºé€šä¿¡ä»¥ç®¡ç† Docker æœåŠ¡ã€‚ Note: ä¾‹å¦‚ dockerd é€šè¿‡ rest æ¥å£ä¸ containnerd è¿›è¡Œäº¤äº’ï¼Œcontainerd ä¸ runc é€šè¿‡ grpc è¿›è¡Œé€šä¿¡ ","date":"2019-04-22","objectID":"/docker-architecture/:2:0","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Dockeræ¶æ„ä»‹ç»","uri":"/docker-architecture/"},{"categories":null,"content":"The Docker client Docker å®¢æˆ·ç«¯ï¼ˆdockerï¼‰æ˜¯è®¸å¤š Docker ç”¨æˆ·ä¸ Docker äº¤äº’çš„ä¸»è¦æ–¹å¼ã€‚ å½“æ‚¨ä½¿ç”¨è¯¸å¦‚ docker run ä¹‹ç±»çš„å‘½ä»¤æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šå°†è¿™äº›å‘½ä»¤å‘é€åˆ° dockerdï¼Œdockerd å°†å…¶æ‰§è¡Œã€‚ docker (CLI) å‘½ä»¤è°ƒç”¨ REST é£æ ¼çš„ Docker APIã€‚ Docker å®¢æˆ·ç«¯å¯ä»¥ä¸å¤šä¸ªå®ˆæŠ¤è¿›ç¨‹é€šä¿¡ã€‚ Note: docker å¯ä»¥é€šè¿‡é…ç½®ç¯å¢ƒå˜é‡ DOCKER_HOSTæˆ–è€…ä¿®æ”¹é…ç½®å˜é‡ï¼Œæˆ–è€…å‘½ä»¤è¡Œå‚æ•°çš„æ–¹å¼è¿æ¥ dockerd ","date":"2019-04-22","objectID":"/docker-architecture/:3:0","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Dockeræ¶æ„ä»‹ç»","uri":"/docker-architecture/"},{"categories":null,"content":"Docker registries Docker registry å­˜å‚¨ Docker é•œåƒã€‚ Docker Hub æ˜¯ä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨çš„å…¬å…±æ³¨å†Œä¸­å¿ƒï¼ŒDocker é…ç½®ä¸ºé»˜è®¤åœ¨ Docker Hub ä¸ŠæŸ¥æ‰¾ imagesã€‚ æ‚¨ç”šè‡³å¯ä»¥è¿è¡Œè‡ªå·±çš„ç§äºº registryã€‚ å¦‚æœæ‚¨ä½¿ç”¨ Docker Datacenterï¼ˆDDCï¼‰ï¼Œå®ƒåŒ…å« Docker Trusted Registryï¼ˆDTRï¼‰ã€‚ Note: å¯ä»¥é€šè¿‡é…ç½®ä¸åŒçš„ Docker registry ä½œä¸º images ä¸‹è½½æºï¼Œæ¯”å¦‚å…¬å¸å†…éƒ¨æ­å»º registry ç§æœï¼Œåœ¨å¹³æ—¶ CI/CD ä¸­æé«˜å·¥ä½œé€Ÿåº¦ã€‚ ","date":"2019-04-22","objectID":"/docker-architecture/:4:0","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Dockeræ¶æ„ä»‹ç»","uri":"/docker-architecture/"},{"categories":null,"content":"Docker objects ä½¿ç”¨ Docker æ—¶ï¼Œæ‚¨æ­£åœ¨åˆ›å»ºå’Œä½¿ç”¨ imagesï¼Œcontainersï¼Œnetworks å’Œ volumesï¼Œplugins å’Œå…¶ä»–å¯¹è±¡ã€‚ æœ¬èŠ‚ç®€è¦ä»‹ç»å…¶ä¸­ä¸€äº›å¯¹è±¡ã€‚ ","date":"2019-04-22","objectID":"/docker-architecture/:5:0","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Dockeræ¶æ„ä»‹ç»","uri":"/docker-architecture/"},{"categories":null,"content":"IMAGES images æ˜¯ä¸€ä¸ªåªè¯»æ¨¡æ¿ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³åˆ›å»º Docker å®¹å™¨çš„è¯´æ˜ã€‚ é€šå¸¸ï¼Œimages åŸºäºå¦ä¸€ä¸ª imagesï¼Œå¹¶å¸¦æœ‰ä¸€äº›é¢å¤–çš„è‡ªå®šä¹‰ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ„å»ºåŸºäº ubuntu images çš„ imagesï¼Œä½†å®‰è£… Apache Web æœåŠ¡å™¨å’Œåº”ç”¨ç¨‹åºï¼Œä»¥åŠè¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„é…ç½®è¯¦ç»†ä¿¡æ¯ã€‚ æ‚¨å¯ä»¥åˆ›å»ºè‡ªå·±çš„ imagesï¼Œä¹Ÿå¯ä»¥åªä½¿ç”¨å…¶ä»–äººåˆ›å»ºçš„ images å¹¶åœ¨ registries ä¸­å‘å¸ƒã€‚ è¦æ„å»ºè‡ªå·±çš„ imagesï¼Œå¯ä»¥ä½¿ç”¨ç®€å•çš„è¯­æ³•åˆ›å»º Dockerfileï¼Œä»¥å®šä¹‰åˆ›å»º images å¹¶è¿è¡Œ images æ‰€éœ€çš„æ­¥éª¤ã€‚ Dockerfile ä¸­çš„æ¯æ¡æŒ‡ä»¤éƒ½åœ¨ images ä¸­åˆ›å»ºä¸€ä¸ª layerã€‚ æ›´æ”¹ Dockerfile å¹¶é‡å»º images æ—¶ï¼Œä»…é‡å»ºå·²æ›´æ”¹çš„é‚£äº›å±‚ã€‚ ä¸å…¶ä»–è™šæ‹ŸåŒ–æŠ€æœ¯ç›¸æ¯”ï¼Œè¿™æ˜¯ä½¿ images å¦‚æ­¤è½»é‡ï¼Œå°å·§å’Œå¿«é€Ÿçš„éƒ¨åˆ†åŸå› ã€‚ Note: æ¯”è¾ƒè¯¦ç»†çš„å·¥ä½œåŸç†å¯ä»¥çœ‹ä¸‹æ–‡ Union file systemséƒ¨åˆ† ","date":"2019-04-22","objectID":"/docker-architecture/:5:1","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Dockeræ¶æ„ä»‹ç»","uri":"/docker-architecture/"},{"categories":null,"content":"CONTAINERS CONTAINERS æ˜¯ images çš„å¯è¿è¡Œå®ä¾‹ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ Docker API æˆ– CLI åˆ›å»ºï¼Œå¯åŠ¨ï¼Œåœæ­¢ï¼Œç§»åŠ¨æˆ–åˆ é™¤å®¹å™¨ã€‚ æ‚¨å¯ä»¥å°†å®¹å™¨è¿æ¥åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªç½‘ç»œï¼Œå°†å­˜å‚¨è¿æ¥åˆ°å®ƒï¼Œç”šè‡³å¯ä»¥æ ¹æ®å…¶å½“å‰çŠ¶æ€åˆ›å»ºæ–° imagesã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒCONTAINERS ä¸å…¶ä»– CONTAINERS åŠå…¶ä¸»æœºç›¸å¯¹éš”ç¦»ã€‚ æ‚¨å¯ä»¥æ§åˆ¶ CONTAINERS çš„ç½‘ç»œï¼Œå­˜å‚¨æˆ–å…¶ä»–åŸºç¡€å­ç³»ç»Ÿä¸å…¶ä»– CONTAINERS æˆ–ä¸»æœºçš„éš”ç¦»ç¨‹åº¦ã€‚ CONTAINERS ç”±å…¶ images ä»¥åŠæ‚¨åœ¨åˆ›å»ºæˆ–å¯åŠ¨æ—¶ä¸ºå…¶æä¾›çš„ä»»ä½•é…ç½®é€‰é¡¹å®šä¹‰ã€‚ åˆ é™¤ containers åï¼Œå¯¹å…¶çŠ¶æ€çš„ä»»ä½•æœªå­˜å‚¨åœ¨æŒä¹…å­˜å‚¨ä¸­çš„æ›´æ”¹éƒ½å°†æ¶ˆå¤±ã€‚ ","date":"2019-04-22","objectID":"/docker-architecture/:5:2","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Dockeræ¶æ„ä»‹ç»","uri":"/docker-architecture/"},{"categories":null,"content":"SERVICES services å…è®¸æ‚¨è·¨å¤šä¸ª Docker å®ˆæŠ¤ç¨‹åºæ‰©å±•å®¹å™¨ï¼Œè¿™äº›å®ˆæŠ¤ç¨‹åºä¸€èµ·ä½œä¸ºå…·æœ‰å¤šä¸ªç®¡ç†å™¨å’Œå·¥ä½œç¨‹åºçš„ç¾¤ç»„ä¸€èµ·å·¥ä½œã€‚ swarm çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ Docker å®ˆæŠ¤ç¨‹åºï¼Œå®ˆæŠ¤è¿›ç¨‹éƒ½ä½¿ç”¨ Docker API è¿›è¡Œé€šä¿¡ã€‚ æœåŠ¡å…è®¸æ‚¨å®šä¹‰æ‰€éœ€çš„çŠ¶æ€ï¼Œä¾‹å¦‚åœ¨ä»»ä½•ç»™å®šæ—¶é—´å¿…é¡»å¯ç”¨çš„æœåŠ¡çš„å‰¯æœ¬æ•°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡åœ¨æ‰€æœ‰å·¥ä½œèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œè´Ÿè½½å¹³è¡¡ã€‚ å¯¹äºæ¶ˆè´¹è€…æ¥è¯´ï¼ŒDocker æœåŠ¡ä¼¼ä¹æ˜¯ä¸€ä¸ªå•ç‹¬çš„åº”ç”¨ç¨‹åºã€‚ Docker Engine æ”¯æŒ Docker 1.12 åŠæ›´é«˜ç‰ˆæœ¬ä¸­çš„ swarm æ¨¡å¼ã€‚ Docker åº•å±‚æŠ€æœ¯ Docker æ˜¯ç”¨ Go ç¼–å†™çš„ï¼Œå®ƒåˆ©ç”¨ Linux å†…æ ¸çš„å‡ ä¸ªåŠŸèƒ½æ¥æä¾›å…¶åŠŸèƒ½ã€‚ä½¿ç”¨åˆ°çš„å†…æ ¸ç‰¹æ€§åŒ…æ‹¬ namespacesã€cgroupsã€Union file systems ","date":"2019-04-22","objectID":"/docker-architecture/:5:3","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Dockeræ¶æ„ä»‹ç»","uri":"/docker-architecture/"},{"categories":null,"content":"namespaces Docker ä½¿ç”¨ç§°ä¸º namespaces çš„æŠ€æœ¯æ¥æä¾›ç§°ä¸ºå®¹å™¨çš„éš”ç¦»å·¥ä½œç©ºé—´ã€‚ è¿è¡Œå®¹å™¨æ—¶ï¼ŒDocker ä¼šä¸ºè¯¥å®¹å™¨åˆ›å»ºä¸€ç»„ namespacesã€‚ è¿™äº› namespaces æä¾›äº†ä¸€å±‚éš”ç¦»ã€‚ å®¹å™¨çš„æ¯ä¸ªæ–¹é¢éƒ½åœ¨ä¸€ä¸ªå•ç‹¬çš„å‘½åç©ºé—´ä¸­è¿è¡Œï¼Œå…¶è®¿é—®æƒé™ä»…é™äºè¯¥ namespacesã€‚ Docker Engine åœ¨ Linux ä¸Šä½¿ç”¨ä»¥ä¸‹å‘½åç©ºé—´ï¼š pid å‘½åç©ºé—´ï¼šè¿›ç¨‹éš”ç¦»ï¼ˆPIDï¼šè¿›ç¨‹ IDï¼‰ã€‚ net å‘½åç©ºé—´ï¼šç®¡ç†ç½‘ç»œæ¥å£ï¼ˆNETï¼šNetworkingï¼‰ã€‚ ipc åç§°ç©ºé—´ï¼šç®¡ç†å¯¹ IPC èµ„æºçš„è®¿é—®ï¼ˆIPCï¼šè¿›ç¨‹é—´é€šä¿¡ï¼‰ã€‚ mnt åç§°ç©ºé—´ï¼šç®¡ç†æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹ï¼ˆMNTï¼šMountï¼‰ã€‚ uts å‘½åç©ºé—´ï¼šéš”ç¦»å†…æ ¸å’Œç‰ˆæœ¬æ ‡è¯†ç¬¦ã€‚ ï¼ˆæ‚‰å°¼ç§‘æŠ€å¤§å­¦ï¼šUnix åˆ†æ—¶ç³»ç»Ÿï¼‰ã€‚ ","date":"2019-04-22","objectID":"/docker-architecture/:6:0","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Dockeræ¶æ„ä»‹ç»","uri":"/docker-architecture/"},{"categories":null,"content":"cgroups Linux ä¸Šçš„ Docker Engine è¿˜ä¾èµ–äºå¦ä¸€ç§ç§°ä¸ºæ§åˆ¶ç»„ï¼ˆcgroupsï¼‰çš„æŠ€æœ¯ã€‚ cgroup å°†åº”ç”¨ç¨‹åºé™åˆ¶ä¸ºç‰¹å®šçš„èµ„æºé›†ã€‚ cgroups å…è®¸ Docker Engine å°†å¯ç”¨çš„ç¡¬ä»¶èµ„æºå…±äº«ç»™å®¹å™¨ï¼Œå¹¶å¯é€‰æ‹©å¼ºåˆ¶æ‰§è¡Œé™åˆ¶å’Œçº¦æŸã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥é™åˆ¶ç‰¹å®šå®¹å™¨çš„å¯ç”¨å†…å­˜ã€‚ ","date":"2019-04-22","objectID":"/docker-architecture/:7:0","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Dockeræ¶æ„ä»‹ç»","uri":"/docker-architecture/"},{"categories":null,"content":"Union file systems è”åˆæ–‡ä»¶ç³»ç»Ÿæˆ– UnionFS æ˜¯é€šè¿‡åˆ›å»º layers æ¥æ“ä½œçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä½¿å®ƒä»¬éå¸¸è½»é‡å’Œå¿«é€Ÿã€‚ Docker Engine ä½¿ç”¨ UnionFS ä¸ºå®¹å™¨æä¾›æ„å»ºå—ã€‚ Docker Engine å¯ä»¥ä½¿ç”¨å¤šç§ UnionFS å˜ä½“ï¼ŒåŒ…æ‹¬ AUFSï¼Œbtrfsï¼Œvfs å’Œ DeviceMapperã€‚ Note: Docker é»˜è®¤ä¸º overylay2 ","date":"2019-04-22","objectID":"/docker-architecture/:8:0","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Dockeræ¶æ„ä»‹ç»","uri":"/docker-architecture/"},{"categories":null,"content":"Container format Docker Engine å°† namespacesï¼Œcgroups å’Œ UnionFS ç»„åˆæˆä¸€ä¸ªç§°ä¸ºå®¹å™¨æ ¼å¼çš„åŒ…è£…å™¨ã€‚ é»˜è®¤å®¹å™¨æ ¼å¼æ˜¯ libcontainerã€‚ å°†æ¥ï¼ŒDocker å¯ä»¥é€šè¿‡ä¸ BSD Jails æˆ– Solaris Zones ç­‰æŠ€æœ¯é›†æˆæ¥æ”¯æŒå…¶ä»–å®¹å™¨æ ¼å¼ã€‚ Note: å¦‚ä¸Šéƒ¨åˆ†ç¿»è¯‘è‡ª docker overviewï¼ŒåŒæ—¶æ·»åŠ è‡ªå·±æœ¬äººç†è§£ã€‚ moby ç­‰ä»£ç çš„ä¾èµ–ä»‹ç»ï¼Œç›¸å…³è°ƒç”¨æ–¹å¼ï¼Œæ¶æ„ Docker ä»ä¸€ä¸ªå•ä¸€çš„è½¯ä»¶è½¬ç§»åˆ°ä¸€ç»„ç‹¬ç«‹çš„ç»„ä»¶å’Œé¡¹ç›®ã€‚ ","date":"2019-04-22","objectID":"/docker-architecture/:9:0","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Dockeræ¶æ„ä»‹ç»","uri":"/docker-architecture/"},{"categories":null,"content":"Docker å¦‚ä½•è¿è¡Œå®¹å™¨ï¼Ÿ Docker å¼•æ“åˆ›å»º imagesï¼Œ æŠŠ images ä¼ é€’ç»™ containerdï¼Œ containerd è°ƒç”¨ containerd-shimï¼Œ containerd-shim ä½¿ç”¨ runC æ¥è¿è¡Œ containerï¼Œ containerd-shim å…è®¸è¿è¡Œæ—¶ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º runCï¼‰åœ¨å¯åŠ¨å®¹å™¨åé€€å‡º ","date":"2019-04-22","objectID":"/docker-architecture/:10:0","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Dockeræ¶æ„ä»‹ç»","uri":"/docker-architecture/"},{"categories":null,"content":"è¿™ä¸ªæ¨¡å‹çš„ä¸¤ä¸ªä¸»è¦å¥½å¤„æ˜¯ deamon è¿è¡Œè¾ƒå°‘çš„å®¹å™¨ èƒ½å¤Ÿåœ¨ä¸ç ´åæ­£åœ¨è¿è¡Œçš„å®¹å™¨çš„æƒ…å†µä¸‹é‡å¯æˆ–å‡çº§å¼•æ“ ","date":"2019-04-22","objectID":"/docker-architecture/:11:0","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Dockeræ¶æ„ä»‹ç»","uri":"/docker-architecture/"},{"categories":null,"content":"containerd containerd æ¶æ„ related link moby libnetwork containerd runc Visualizing Docker Containers and Images ","date":"2019-04-22","objectID":"/docker-architecture/:12:0","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: Dockeræ¶æ„ä»‹ç»","uri":"/docker-architecture/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šèµ„æ–™æ±‡æ€»ä»¥åŠæºç é˜…è¯»ç›®å½• Contents Docker æ¶æ„ä»‹ç» Docker ç¼–è¯‘å¼€å‘ç¯å¢ƒæ­å»º Docker Run Docker Build Docker Volume todo docker network èµ„æ–™æ±‡æ€» Visualizing Docker Containers and Imageså®¹å™¨ã€é•œåƒå¯è§†åŒ– Docker æ ¸å¿ƒæŠ€æœ¯ä¸å®ç°åŸç† docker-debug related links Visualizing Docker Containers and Images ","date":"2019-04-22","objectID":"/docker-contents/:0:0","tags":["docker","æºç "],"title":"Docker æºç é˜…è¯»: ç›®å½•","uri":"/docker-contents/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šå¦‚ä½•å‚ä¸å¼€æºé¡¹ç›®ã€‚åœ¨è¿™é‡Œåˆ†äº«ä¸€äº›æ€è·¯å’Œå¼€æºèµ„æºã€‚ ","date":"2019-04-21","objectID":"/contribute-to-opensource/:0:0","tags":["howto"],"title":"å¦‚ä½•å‚ä¸å¼€æºé¡¹ç›®","uri":"/contribute-to-opensource/"},{"categories":null,"content":"ç®€ä»‹ è‡ªä»å­¦ä¹ è®¡ç®—æœºå¼€å§‹ï¼Œå¾ˆå¤šæ—¶å€™å¸Œæœ›è‡ªå·±èƒ½å¤Ÿä¹Ÿä¸º opensource è´¡çŒ®ä¸€äº›ä»€ä¹ˆã€‚è¿™é‡Œä¼šæ€»ç»“ä¸€äº›æ€è·¯ä¸ºå¼€æºåšäº›ä»€ä¹ˆã€‚ ","date":"2019-04-21","objectID":"/contribute-to-opensource/:1:0","tags":["howto"],"title":"å¦‚ä½•å‚ä¸å¼€æºé¡¹ç›®","uri":"/contribute-to-opensource/"},{"categories":null,"content":"æ€è·¯ Start Your Open Source Careerè¿™é‡Œç®€è¿°äº†å¦‚ä½•å‚ä¸å¼€æºé¡¹ç›®ã€‚å¯¹è‡ªå·±æœ‰å¾ˆå¤šå¯ç¤ºã€‚æˆ‘ä»¬åœ¨å·¥ä½œå­¦ä¹ ä¸­ä¹Ÿä¼šæœ‰ä¸€äº›è‡ªå·±æ„Ÿè§‰å¾ˆå¥½çš„å¯¹æŸä¸ªæŠ€æœ¯é—®é¢˜çš„è§£å†³æ–¹å¼,å¸Œæœ›å¯ä»¥åˆ†äº«ç»™å¤§å®¶ï¼Œæˆ–è€…å¸Œæœ›å­¦ä¹ æ–°çš„çŸ¥è¯†ï¼Œæˆä¸ºæŸä¸ªå·¥å…·çš„æ ¸å¿ƒç»´æŠ¤è€…ã€‚ è¿™é‡Œä¼šæ€»ç»“ä¸€äº›æ¯”è¾ƒå¥½çš„å‚ä¸å¼€æºé¡¹ç›®çš„æ€è·¯ã€‚ ","date":"2019-04-21","objectID":"/contribute-to-opensource/:2:0","tags":["howto"],"title":"å¦‚ä½•å‚ä¸å¼€æºé¡¹ç›®","uri":"/contribute-to-opensource/"},{"categories":null,"content":"good first issue or help wanted å¾ˆå¤šå¼€æºé¡¹ç›®çš„issueä¸­å·²ç»æ ‡è®°å‡ºå¾ˆå¤šç±»ä¼¼good first issue or help wantedçš„ labelï¼Œè¿™äº› label è¡¨ç¤ºæ–°äººå¯ä»¥æ¥å¸®å¿™ã€‚å¯ä»¥é€šè¿‡ä¸€äº›ç½‘ç«™æ‰¾åˆ°æ‰“ç›¸åº” label çš„é¡¹ç›®ï¼Œè¿™å¯èƒ½æˆä¸ºä½ è´¡çŒ®å¼€æºé¡¹ç›®çš„å¼€ç«¯ã€‚ æˆ–è®¸è¿™äº›ç½‘ç«™å¯ä»¥å¸®åˆ°ä½ (æ¥è‡ª github)ï¼š å¼€æºæ˜ŸæœŸäº” - opensourcefriday ç»Ÿè®¡è‡ªå·±å‚ä¸çš„é¡¹ç›®ï¼ŒåŒæ—¶æ¨èå¦‚ä½•å¼€å§‹ github-explore github ä¼šä¸ºä½ æ¨èä¸€äº›ä½ æ„Ÿå…´è¶£çš„é¡¹ç›® project-based-learning Curated list of project-based tutorials first timers only è´¡çŒ® pr éœ€è¦çš„ git çŸ¥è¯†ï¼Œlabel æœç´¢ï¼Œç›¸å…³è®¢é˜…æé†’ç­‰ codetriage è®¢é˜… github ä¸­çš„é¡¹ç›®ï¼Œissue ç­‰ï¼Œæ–¹ä¾¿é€šçŸ¥è‡ªå·±æ„Ÿå…´è¶£çš„é¡¹ç›® issuehub æŒ‰ç…§æ ‡ç­¾æœç´¢é¡¹ç›® pullrequestroulette æ£€ç´¢éœ€è¦ reviews çš„ pr up-for-grabs.net æ ¹æ® label ç­‰æ£€ç´¢é¡¹ç›® how-to-contribute/#a-checklist-before-you-contribute ","date":"2019-04-21","objectID":"/contribute-to-opensource/:2:1","tags":["howto"],"title":"å¦‚ä½•å‚ä¸å¼€æºé¡¹ç›®","uri":"/contribute-to-opensource/"},{"categories":null,"content":"æ€è·¯ æ„å»ºä¸€äº›å·¥å…· æ¯”å¦‚æ„å»ºä¸€äº›é¡¹ç›®æ¨¡ç‰ˆï¼Œæ¯”å¦‚graphql+mongoboilerplate. æ¯”å¦‚ç¼–å†™ä¸€äº›å¹³æ—¶å¯ä»¥æé«˜å·¥ä½œæ•ˆç‡çš„å·¥å…·ï¼Œalibaba/arthas æˆä¸ºæ–°çš„ç»´æŠ¤è€… æœ‰å¾ˆå¤šæœ‰ä»·å€¼çš„é¡¹ç›®å› ä¸ºæ²¡æœ‰ç»´æŠ¤è€…æ¸æ¸è¢«äººé—å¼ƒã€‚ä½ æ˜¯å¦å¯ä»¥æˆä¸ºæ–°çš„ç»´æŠ¤è€…å‘¢ï¼Ÿå¯ä»¥é€šè¿‡é‚®ä»¶ã€twiter ç­‰è”ç³»åŸä½œè€…ï¼Œæˆä¸ºé¡¹ç›®ç»´æŠ¤è€…æ˜¯ä¸æ˜¯å¾ˆæ£’ï¼Ÿ åˆ›å»ºè‡ªå·±çš„é¡¹ç›® å¦‚æœè‡ªå·±æœ‰å¯¹æ–°çš„æŠ€æœ¯é—®é¢˜çš„è§£å†³åŠæ³•ï¼Œå¯ä»¥å¼€æºå‡ºæ¥ï¼Œåˆ†äº«è‡ªå·±æ˜¯å¦‚ä½•è§£å†³çš„ å‘å¸ƒï¼Œæ¨å¹¿ï¼Œåˆ†äº« ä¸ºäº†ç¡®ä¿æ¯ä¸ªæœ‰éœ€è¦çš„äººéƒ½ä¹æ„æ¥æ‰¾åˆ°ä½ çš„æ¨¡å—ï¼Œä½ å¿…é¡»ï¼š æ’°å†™ readme ç­‰ license README ç‰ˆæœ¬å¾½ç«  è´¡çŒ®æŒ‡å— æä¾›ISSUE_TEMPLATE ä½¿ç”¨æœ¬é¡¹ç›®çš„äº§å“ ä¸ºé¡¹ç›®æ’°å†™ç²¾å¿ƒè®¾è®¡çš„åœ¨çº¿ç½‘ç«™ï¼Œå’Œæ–‡æ¡£ï¼Œå¯ä»¥ä½¿ç”¨é™æ€ç½‘ç«™å·¥å…·ç”Ÿæˆï¼Œå¦‚vuepress åœ¨ StackOverflow å’Œ GitHub ç­‰ç¤¾äº¤åª’ä½“ä¸­å¯»æ‰¾ç›¸å…³é—®é¢˜å¹¶è´´å‡ºä½ çš„é¡¹ç›®ï¼Œå¹¶è§£ç­” å°†é¡¹ç›®å‘å¸ƒåˆ°æ±‡é›†å¼€æºé¡¹ç›®çš„ç¤¾åŒºä¸­ï¼Œå¦‚HackerNewsã€redditã€producthuntã€hashnode å‚ä¸ä¸€äº›çº¿ä¸‹åˆ†äº«ã€è®¨è®ºä¼šã€æ¼”è®²ç­‰ä¸­ä»‹ç»ä½ çš„é¡¹ç›® ","date":"2019-04-21","objectID":"/contribute-to-opensource/:2:2","tags":["howto"],"title":"å¦‚ä½•å‚ä¸å¼€æºé¡¹ç›®","uri":"/contribute-to-opensource/"},{"categories":null,"content":"é“¾æ¥ octobox å°†ä½ çš„ GitHub é€šçŸ¥è½¬æˆé‚®ä»¶çš„å½¢å¼ï¼Œè¿™æ˜¯é¿å…å› å †ç§¯ã€Œå¤ªå¤šé—®é¢˜ã€ä»¥è‡³äºå½±å“å…³æ³¨é‡è¦é—®é¢˜çš„å¾ˆå¥½çš„æ–¹æ³• probot GitHub App å¯ä»¥è‡ªåŠ¨åŒ–å’Œæ”¹å–„ä½ çš„å·¥ä½œæµç¨‹ refined-github æµè§ˆå™¨æ‰©å±•ï¼Œç®€åŒ–äº† GitHub ç•Œé¢å¹¶æ·»åŠ äº†æœ‰ç”¨çš„åŠŸèƒ½ Start Your Open Source Career mattermost-server project-based-learning#go awesome-for-beginners merging-vs-rebasing ","date":"2019-04-21","objectID":"/contribute-to-opensource/:3:0","tags":["howto"],"title":"å¦‚ä½•å‚ä¸å¼€æºé¡¹ç›®","uri":"/contribute-to-opensource/"},{"categories":null,"content":"swagger and openapi ä»£ç ç”Ÿæˆå’Œæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆä¸€äº›ä½“ä¼š è¯´åœ¨å‰é¢ å¹³æ—¶ä½¿ç”¨gqlgenï¼Œä¸€èˆ¬çš„ workflow æ˜¯å…ˆå†™ graphql çš„ schemaï¼Œç„¶å code generate å¯¹åº”çš„ model å’Œ api çš„å®ç°çš„ç©ºæ¥å£ï¼Œè‡ªå·±å¯¹åº”å®ç°å¯¹åº”çš„ resolver å³å¯ã€‚ä½¿ç”¨èµ·æ¥å¾ˆæµç¨‹ã€‚æœ€è¿‘è°ƒç ”ä¸€ä¸‹ java ä¸‹ç±»ä¼¼çš„å·¥å…·ã€‚æ‰¾åˆ°åœ¨ java ä¸‹ star æœ€å¤šçš„é¡¹ç›®graphql-javaï¼Œä½†å¹¶ä¸æ˜¯è¿™é‡Œè®¨è®ºçš„ã€‚ è¿™é‡Œè®¨è®ºçš„æ˜¯åŸºäº spring çš„ openapi çš„å®ç°å’Œ code generate æ–¹æ¡ˆã€‚ åŸºäº openapi çš„ code generate æ–¹æ¡ˆ é¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ openapiï¼Œä»–æ˜¯è¯­è¨€æ— å…³çš„ restful æè¿°è¯­è¨€ï¼Œå¯ä»¥ä½¿ç”¨ yaml è¿›è¡Œç¼–å†™æ¥å£æ–‡æ¡£ï¼Œé€šè¿‡ generateï¼Œç”Ÿæˆä¸åŒè¯­è¨€çš„ client å’Œ serverã€‚è¿™é‡Œæœ‰å®˜æ–¹çš„ç®€ä»‹ã€‚è‡ªå·±æ¯”è¾ƒå…³æ³¨çš„è¯­è¨€æ˜¯ pythonã€javaã€goã€rustï¼Œjsã€‚ è¸©åˆ°çš„ä¸€äº›å‘ï¼Œè¿™é‡Œç®€å•è¯•ç”¨äº†ä¸€ä¸‹ generate javaã€‚é¦–å…ˆï¼Œmaven ä¸‹æœ‰å¯¹åº”çš„ openapi çš„ pluginï¼Œopenapi-generator-maven-plugin, ä½†æ¯æ¬¡ compile éƒ½ä¼šè¿›è¡Œ generateï¼Œå¹¶ä¸æ˜¯æˆ‘æ‰€å¸Œæœ›çš„ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨äº†åŸºäº docker çš„ä½¿ç”¨æ–¹æ¡ˆã€‚ä»£ç è§exfly:gorgestar/isn,ä½¿ç”¨generator.shç”Ÿæˆå¯¹åº”çš„ä»£ç ï¼Œé…ç½®æ–‡ä»¶å¯ä»¥çœ‹generator.jsonï¼Œ æˆ‘çš„ä½¿ç”¨ç­–ç•¥æ˜¯ï¼Œå…ˆä¿®æ”¹openapi.yamlï¼Œåˆ›å»ºæˆ–è€…ä¿®æ”¹ restful apiï¼Œç„¶å bash ./generator.shï¼Œç”Ÿæˆå¯¹åº”æ¥å£é»˜è®¤ç©ºå®ç°ï¼Œä¹‹åç”±æˆ‘ä»¬å¯¹åº”çš„å®ç°æ¥å£å³å¯ã€‚ ä¸€äº›è‡ªå·±æ²¡æœ‰è¿›è¡Œæ“ä½œçš„æ–¹æ¡ˆï¼š å¦‚ä½•ä¿è¯ api å’Œæ¥å£æ–‡æ¡£ä¸€è‡´ï¼šå¯ä»¥å¯¹åº”çš„ä½¿ç”¨ swagger çš„ api-doc json è¿›è¡Œè½¬æ¢ä¸º yamlï¼Œå¯¹åŸæœ¬æ‰‹å†™çš„openapi.yamlè¿›è¡Œæ¯”è¾ƒï¼Œç¡®è®¤æ–‡æ¡£çš„ä¸€è‡´æ€§ è¿™ä¸ªç‰ˆæœ¬çš„ generate æ¯æ¬¡éƒ½ä¼šå°†æ‰€æœ‰çš„æ–‡ä»¶è¦†ç›–ï¼Œéœ€è¦ç¼–è¾‘.openapi-generator-ignoreï¼Œç±»ä¼¼ gitignore çš„ä¸œè¥¿ï¼Œç±»æ¯”ä¿®æ”¹å³å¯ã€‚è¢«å¿½ç•¥çš„æ–‡ä»¶ï¼Œå³ä½¿è¢«åˆ é™¤ï¼Œä¹Ÿä¸ä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”æ–‡ä»¶ï¼Œç”Ÿæˆé€»è¾‘çœ‹èµ·æ¥æ¯”è¾ƒå‚»ã€‚ å…¶ä»–èµ„æº exfly:gorgestar/isn,æœ¬æ–‡é¡¹ç›®ä»£ç  swagger raml OpenAPI-Specification openapi-generator openapi generator maven plugin spring rest docs ","date":"2019-02-04","objectID":"/openapi-gen-server-client/:0:0","tags":["openapi","codegen"],"title":"Openapi ä»£ç ç”Ÿæˆ server/client ä»£ç ","uri":"/openapi-gen-server-client/"},{"categories":null,"content":"win å­ç³»ç»Ÿå®‰è£…ä¸ cmder+zsh å¼€å‘ç¯å¢ƒæ­å»º ","date":"2018-12-08","objectID":"/window-install-wsl-and-usages/:0:0","tags":["å·¥å…·","wsl","windows"],"title":"WSL(windows subsystem for linux) win å­ç³»ç»Ÿå®‰è£…ä¸åŸºæœ¬ä½¿ç”¨æ³¨æ„äº‹é¡¹","uri":"/window-install-wsl-and-usages/"},{"categories":null,"content":"è¯´åœ¨å‰é¢ è¿™é‡Œåªå±•ç¤ºå¯ä»¥åšåˆ°ä»€ä¹ˆç¨‹åº¦ï¼Œå…·ä½“æ€ä¹ˆåšï¼Œç½‘ä¸Šæ•™ç¨‹å¾ˆå¤šï¼Œåè¾¹ä¼šè´´å‡ºè‡ªå·±æ„Ÿè§‰æ¯”è¾ƒå¥½çš„ç½‘å€ ","date":"2018-12-08","objectID":"/window-install-wsl-and-usages/:1:0","tags":["å·¥å…·","wsl","windows"],"title":"WSL(windows subsystem for linux) win å­ç³»ç»Ÿå®‰è£…ä¸åŸºæœ¬ä½¿ç”¨æ³¨æ„äº‹é¡¹","uri":"/window-install-wsl-and-usages/"},{"categories":null,"content":"å¤§è‡´æ“ä½œæ€è·¯ å…ˆåœ¨ windows ä¸‹æ‰“å¼€ win subsystem for linux åŠŸèƒ½ï¼Œä¹‹åå» win store ä¸­ä¸‹è½½å¯¹åº”çš„ linux å‘è¡Œç‰ˆ.ä¹‹åå°±æ˜¯æ‰“å¼€å¯¹åº”çš„ linux å‘è¡Œç‰ˆçš„ bashã€é…ç½® zsh äº†ï¼Œè¯¦ç»†æ­¥éª¤è§è¿™é‡Œã€‚å…·ä½“ zsh æ€ä¹ˆæŠ˜è…¾ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹è¿™é‡Œ è´´ä¸€å¼ è‡ªå·±é…ç½®ä¹‹åï¼Œä½¿ç”¨ zsh å’Œ tmux ä¹‹åçš„æˆªå›¾ ç»™æˆ‘çš„ä½“éªŒæ˜¯ï¼ŒåŸºæœ¬å¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†æ—¥å¸¸å¼€å‘å·¥ä½œ ","date":"2018-12-08","objectID":"/window-install-wsl-and-usages/:2:0","tags":["å·¥å…·","wsl","windows"],"title":"WSL(windows subsystem for linux) win å­ç³»ç»Ÿå®‰è£…ä¸åŸºæœ¬ä½¿ç”¨æ³¨æ„äº‹é¡¹","uri":"/window-install-wsl-and-usages/"},{"categories":null,"content":"å…¶ä»– win ä¸‹çš„ CDEF ç›˜è¢«æŒ‚è½½åˆ°/mntä¸‹ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå¯ä»¥å°†ä»–ä»¬ln -s /mnt/d $HOME/windirï¼Œè¿™æ ·æ–¹ä¾¿è‡ªå·±ä½¿ç”¨ å› ä¸ºä¹‹å‰å®‰è£…è¿‡ vscodeï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨code filename æ‰“å¼€ç³»ç»Ÿä¸­çš„æ–‡ä»¶ ç±»ä¼¼ jdk è¿™ç§éœ€è¦åœ¨ subsystem ä¸­é‡æ–°å®‰è£…æ‰å¯ä»¥åœ¨ wsl ä¸­ä½¿ç”¨ å›¾ä¸­ä½¿ç”¨çš„ Cmder æ˜¯éå¸¸è¿œå¤çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥è¯·å¿½ç•¥ cmd ä¹‹å‰çš„æ¡† ","date":"2018-12-08","objectID":"/window-install-wsl-and-usages/:2:1","tags":["å·¥å…·","wsl","windows"],"title":"WSL(windows subsystem for linux) win å­ç³»ç»Ÿå®‰è£…ä¸åŸºæœ¬ä½¿ç”¨æ³¨æ„äº‹é¡¹","uri":"/window-install-wsl-and-usages/"},{"categories":null,"content":"é“¾æ¥ Windows10 ç»ˆç«¯ä¼˜åŒ–æ–¹æ¡ˆï¼šUbuntu å­ç³»ç»Ÿ+cmder+oh-my-zsh ","date":"2018-12-08","objectID":"/window-install-wsl-and-usages/:3:0","tags":["å·¥å…·","wsl","windows"],"title":"WSL(windows subsystem for linux) win å­ç³»ç»Ÿå®‰è£…ä¸åŸºæœ¬ä½¿ç”¨æ³¨æ„äº‹é¡¹","uri":"/window-install-wsl-and-usages/"},{"categories":null,"content":"ä½¿ç”¨ Vue å‰åç«¯+Go åç«¯ï¼ŒåŸºäº webpack ä»£ç†è½¬å‘ï¼Œé…ç½®å‰åç«¯åˆ†ç¦»æ¶æ„å¼€å‘ç¯å¢ƒ åŸæ–‡åœ°å€ Web ç ”å‘æ¨¡å¼æ¼”å˜ æœ€è¿‘ç ”ç©¶ä¸€ä¸‹å‰åç«¯çš„å¼€å‘æ¨¡å¼ï¼Œçœ‹åˆ°ä¸€ä¸ªå¾ˆå¥½çš„å…¥é—¨è·¯å¾„developer-roadmap: frontend backend DevOps,å¯ä»¥çœ‹ä¸€ä¸‹ï¼Œæ•ˆæœè¿˜æ˜¯ä¸é”™çš„ã€‚ ä¹‹å‰çœ‹åˆ°ä¸€ä¸ªè¯´web ç ”å‘æ¼”è¿›è¿™é‡Œæ€»ç»“ä¸€ä¸‹ã€‚ å¾ˆä¹…ä¹‹å‰ï¼Œå‰åç«¯çš„åˆ†å·¥æ˜¯ï¼Œå‰ç«¯ä»è®¾è®¡å¸ˆé‚£é‡Œæ‹¿åˆ°è®¾è®¡å›¾çº¸ï¼Œè½¬åŒ–é™æ€é¡µé¢æ¨¡æ¿ï¼Œç”±åç«¯å·¥ç¨‹å¸ˆè¿›è¡Œæ•°æ®åº“è®¾è®¡ç­‰ä¸€ç³»åˆ—è®¾è®¡ä¹‹åï¼Œå¥—å‰ç«¯ç»™çš„æ¨¡æ¿ã€‚å¦‚ä¸Šä¹Ÿå³åç«¯æ¸²æŸ“ã€‚ ä½†æ˜¯è¿™æ ·çš„æµç¨‹ï¼Œæ‰€æœ‰å·¥ä½œçš„ Block åœ¨åç«¯ï¼Œæƒ³è¿›ä¸€æ­¥æé«˜ç ”å‘é€Ÿåº¦ï¼Œåº”è¯¥å¦‚ä½•åˆ†å·¥ï¼Ÿåˆ°å¦‚ä»Šç»™å‡ºçš„ç­”æ¡ˆæ˜¯åŸºäº Nodejs çš„å‰åç«¯åˆ†ç¦»æ¶æ„ã€‚è¿™æ—¶å‰åç«¯åˆ†å·¥æ˜¯è¿™æ ·çš„ï¼š ","date":"2018-10-28","objectID":"/front-end-separation-architecture-environment-construction/:0:0","tags":["å‰åç«¯åˆ†ç¦»","Vue"],"title":"å‰åç«¯åˆ†ç¦»æ¶æ„çš„Vueç¯å¢ƒæ­å»ºæŒ‡å—","uri":"/front-end-separation-architecture-environment-construction/"},{"categories":null,"content":"å‰ç«¯çš„å·¥ä½œ UI è®¾è®¡ å‰ç«¯è·¯ç”±è®¾è®¡ å¤„ç†æµè§ˆå™¨å±‚çš„å±•ç°é€»è¾‘ é€šè¿‡ CSS æ¸²æŸ“æ ·å¼ï¼Œé€šè¿‡ JavaScript æ·»åŠ äº¤äº’åŠŸèƒ½ï¼ŒHTML çš„ç”Ÿæˆä¹Ÿå¯ä»¥æ”¾åœ¨è¿™å±‚ï¼Œå…·ä½“çœ‹åº”ç”¨åœºæ™¯ ","date":"2018-10-28","objectID":"/front-end-separation-architecture-environment-construction/:1:0","tags":["å‰åç«¯åˆ†ç¦»","Vue"],"title":"å‰åç«¯åˆ†ç¦»æ¶æ„çš„Vueç¯å¢ƒæ­å»ºæŒ‡å—","uri":"/front-end-separation-architecture-environment-construction/"},{"categories":null,"content":"åç«¯çš„å·¥ä½œ ä¸šåŠ¡é€»è¾‘å’Œ API çš„è®¾è®¡å’Œå®ç° æ•°æ®åº“è®¾è®¡å’Œç»´æŠ¤ åç«¯ç¼“å­˜è®¾è®¡ ","date":"2018-10-28","objectID":"/front-end-separation-architecture-environment-construction/:2:0","tags":["å‰åç«¯åˆ†ç¦»","Vue"],"title":"å‰åç«¯åˆ†ç¦»æ¶æ„çš„Vueç¯å¢ƒæ­å»ºæŒ‡å—","uri":"/front-end-separation-architecture-environment-construction/"},{"categories":null,"content":"å‰åç«¯åˆ†ç¦»ä¸‹åä½œä½“ç³» å‰åç«¯åˆ†ç¦»ä¸‹çš„åä½œæ–¹å¼ä¸€èˆ¬æ˜¯ï¼Œå‰åç«¯å„å¸å…¶èŒï¼Œäº’ä¸å½±å“ã€‚ é¦–å…ˆï¼Œå¯¹äºåç«¯æ¥è¯´ï¼Œåç«¯çš„ä¸»è¦å·¥ä½œä¾ç„¶æ˜¯ä¼ ç»Ÿçš„æ•°æ®åº“è®¾è®¡ã€ä¸šåŠ¡é€»è¾‘è®¾è®¡ï¼Œä½†ä¸éœ€è¦å¥—æ¨¡æ¿äº†ï¼Œè€Œæ˜¯ä¸ºå‰ç«¯æä¾›æ•°æ®æ¥å£ å…¶æ¬¡ï¼Œå¯¹äºå‰ç«¯æ¥è¯´ï¼Œå‰ç«¯çš„ä¸»è¦å·¥ä½œæ˜¯ï¼Œå‰ç«¯çš„ uiï¼Œä»¥åŠè·å–æ•°æ®ï¼Œåœ¨å‰ç«¯æ¸²æŸ“ã€‚ å·¥ä½œæµç¨‹æ˜¯ï¼Œå…ˆè¿›è¡Œ API è®¾è®¡ã€‚å‰åç«¯ä¸€èµ·è®¾è®¡æ•°æ®æ¥å£ä»¥åŠæ•°æ®è¿”å›çš„æ ¼å¼ï¼Œç°åœ¨æ¯”è¾ƒå¸¸è§çš„æ˜¯ json æ•°æ®ã€‚å¯ä»¥æ ¹æ®æ¥å£ç”Ÿæˆä¸€äº› mock ç”¨çš„ json æ•°æ®æ–‡ä»¶ï¼Œä¾›å‰ç«¯å¼€å‘ä½¿ç”¨ã€‚åç«¯æ ¹æ®è¿™ä¸ª API è§„èŒƒå®ç°çœŸæ­£çš„æ¥å£ã€‚ä¸¤ç«¯åˆ†åˆ«å¹¶è¡Œå¼€å‘ã€‚å¼€å‘ç»“æŸæ—¶å€™è”è°ƒï¼Œæ‰“é€šå‰åç«¯ä¹‹åè¿›è¡Œè°ƒè¯•ã€‚ å…·ä½“ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ç½‘æ˜“å‰åç«¯åˆ†ç¦»å®è·µ. åŸºäº Vue å‰åç«¯åˆ†ç¦»ç¯å¢ƒæ­å»º è¿™é‡Œå¯¹å‰åç«¯åˆ†ç¦» Vue çš„å¼€å‘ç¯å¢ƒè¿›è¡Œæ¼”ç¤ºã€‚æ€è·¯æ˜¯ï¼Œå‰åç«¯åˆ†ç¦»ï¼Œåç«¯å¯ä»¥è®¾ç½® cookieï¼Œå‰ç«¯å¯ä»¥æ¥æ”¶åˆ°é…ç½®çš„ cookie ","date":"2018-10-28","objectID":"/front-end-separation-architecture-environment-construction/:3:0","tags":["å‰åç«¯åˆ†ç¦»","Vue"],"title":"å‰åç«¯åˆ†ç¦»æ¶æ„çš„Vueç¯å¢ƒæ­å»ºæŒ‡å—","uri":"/front-end-separation-architecture-environment-construction/"},{"categories":null,"content":"node ç¯å¢ƒå®‰è£… å®‰è£…æ–¹æ³•è§è¿™é‡Œ ","date":"2018-10-28","objectID":"/front-end-separation-architecture-environment-construction/:3:1","tags":["å‰åç«¯åˆ†ç¦»","Vue"],"title":"å‰åç«¯åˆ†ç¦»æ¶æ„çš„Vueç¯å¢ƒæ­å»ºæŒ‡å—","uri":"/front-end-separation-architecture-environment-construction/"},{"categories":null,"content":"Vue å®‰è£… npm config set registry 'https://registry.npm.taobao.org' npm install -g @vue/cli vue init webpack demo cd demo npm dev run å³å¯åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°æ•ˆæœï¼Œç†Ÿæ‚‰çš„ vue é¡µé¢ ","date":"2018-10-28","objectID":"/front-end-separation-architecture-environment-construction/:3:2","tags":["å‰åç«¯åˆ†ç¦»","Vue"],"title":"å‰åç«¯åˆ†ç¦»æ¶æ„çš„Vueç¯å¢ƒæ­å»ºæŒ‡å—","uri":"/front-end-separation-architecture-environment-construction/"},{"categories":null,"content":"å®‰è£… axiosï¼Œå®ç°å‰åç«¯äº¤äº’ï¼Œå¹¶å®ç°åç«¯è®¾ç½® cookieï¼Œåœ¨å‰ç«¯å¯ä»¥ç”Ÿæ•ˆ å®‰è£… axios npm install axios ä¿®æ”¹/src/components/HelloWorld.vue ä¸­å¯¹åº”çš„ srcipt \u003cscript\u003e import axios from 'axios' axios.get('/sc') // ä½¿ç”¨ajax export default { name: 'HelloWorld', data () { return { msg: 'Welcome to Your Vue.js App' } } } \u003c/script\u003e æœ€ç»ˆå®Œæˆçš„æ—¶å€™ï¼Œè®¿é—® â€˜/â€™ï¼Œå¯ä»¥çœ‹åˆ° cookie æ·»åŠ äº†ä¸€ä¸ª kv å¯¹ã€‚ç°åœ¨æš‚æ—¶çœ‹ä¸åˆ°æ•ˆæœï¼Œå› ä¸ºæ¥å£åç«¯æ²¡æœ‰å®ç°ã€‚ åç«¯æ¥å£å®ç°,è¿™é‡Œä½¿ç”¨çš„ goï¼Œå…·ä½“ go ç¼–è¯‘å™¨çš„å®‰è£…æ–¹æ³•è§è¿™é‡Œ package main import ( \"log\" \"net/http\" \"time\" ) func LoggingMiddleware(next http.Handler) http.Handler { return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { log.Println(\"-\u003e\", r.URL) next.ServeHTTP(w, r) log.Println(\"\u003c-\") }) } func main() { http.Handle(\"/sc\", LoggingMiddleware(http.HandlerFunc(indexHandler))) port := \":8081\" log.Println(\"starting on http://localhost\" + port) log.Fatal(http.ListenAndServe(port, nil)) } func indexHandler(w http.ResponseWriter, req *http.Request) { expire := time.Now().AddDate(0, 0, 1) cookie := http.Cookie{Name: \"csrftoken\", Value: expire.String(), Expires: expire} http.SetCookie(w, \u0026cookie) } æ­¤æ—¶å‰åç«¯éƒ½å·²ç»å®ç°äº†ï¼Œä½†æ˜¯å› ä¸ºå‰ç«¯å¼€åœ¨äº†ç«¯å£ 8080ï¼Œåç«¯å¼€åœ¨äº† 8081ï¼Œæ¶‰åŠåˆ°è·¨åŸŸï¼Œç›¸äº’æ²¡æ³•è®¿é—®ã€‚éœ€è¦é…ç½®ä¸€ä¸‹ webpack çš„é…ç½®æ‰å¯ä»¥ã€‚ // ä¿®æ”¹ä¸€ä¸‹æ–‡ä»¶/config/index.js: 13 line proxyTable: { '/': { target: 'http://localhost:8081', changeOrigin: true } }, ä¹‹åï¼Œå¼€å¯å‰åç«¯æœåŠ¡ï¼š npm dev run go run server.go ä¹‹åè®¿é—®å‰ç«¯é¡µé¢ï¼Œlocalhost:8080ï¼ŒæŒ‰ F12 -\u003e Application -\u003e Cookiesï¼Œ å³å¯çœ‹åˆ°æ¯æ¬¡åˆ·æ–°éƒ½ä¼šæ”¹å˜çš„ csrftoken çš„ cookie æœ€ç»ˆçš„ç½‘ç«™è§ExFly/FrontBackSep åè®° æ—¢ç„¶åœ¨å‰åç«¯åˆ†ç¦»åçš„åç«¯å¯ä»¥é…ç½®cookieï¼Œå…¶ä»–çš„æ‰€æœ‰æ“ä½œéƒ½å¯ä»¥è¿›è¡Œäº†ã€‚è¿›ä¸€æ­¥å¯ä»¥å®ç°å…¶ä»–çš„æ“ä½œã€‚å¦‚ä¸Šã€‚ ","date":"2018-10-28","objectID":"/front-end-separation-architecture-environment-construction/:3:3","tags":["å‰åç«¯åˆ†ç¦»","Vue"],"title":"å‰åç«¯åˆ†ç¦»æ¶æ„çš„Vueç¯å¢ƒæ­å»ºæŒ‡å—","uri":"/front-end-separation-architecture-environment-construction/"},{"categories":null,"content":"å¼•ç”¨ developer-roadmap: frontend backend DevOps web ç ”å‘æ¼”è¿› ç½‘æ˜“å‰åç«¯åˆ†ç¦»å®è·µ ","date":"2018-10-28","objectID":"/front-end-separation-architecture-environment-construction/:4:0","tags":["å‰åç«¯åˆ†ç¦»","Vue"],"title":"å‰åç«¯åˆ†ç¦»æ¶æ„çš„Vueç¯å¢ƒæ­å»ºæŒ‡å—","uri":"/front-end-separation-architecture-environment-construction/"},{"categories":null,"content":"æ€»ç»“ä¸€ä¸‹æ•°æ®åº“ã€åˆ†å¸ƒå¼ç­‰æŠ€æœ¯äº§ç”Ÿçš„åœºæ™¯çš„ä½¿ç”¨åœºæ™¯ã€‚åŒ…æ‹¬æ•°æ®åº“ã€ç¼“å­˜ã€åˆ†å¸ƒå¼ã€å®¹å™¨ ä»ä½¿ç”¨åˆ°çš„æŠ€æœ¯æ¥è¯´ï¼Œå¦‚ä»Šå„å¤§ç½‘ç«™å¹³å°è¶‹å‘äºä½¿ç”¨ç»è¿‡é•¿æœŸæ£€éªŒè¿‡çš„æŠ€æœ¯ï¼ŒåŒ…æ‹¬ä¸é™äºåŠ¨æ€ç½‘ç«™æŠ€æœ¯ã€æ•°æ®åº“æŠ€æœ¯ã€é«˜é€Ÿç¼“å­˜æŠ€æœ¯ã€è´Ÿè½½å‡è¡¡ã€åˆ†å¸ƒå¼ç›¸å…³æŠ€æœ¯ã€‚ é¦–å…ˆåŠ¨æ€ç½‘ç«™æŠ€æœ¯ï¼Œå¼€å§‹æ²¡æœ‰åŠ¨æ€ç½‘ç«™æ—¶æœŸï¼Œå¤§éƒ¨åˆ† BBS ä½¿ç”¨åŸºäº Telnet åè®®ä¸ºåŸºç¡€çš„ BBS è¿›è¡Œäº¤æµã€‚HTTP åè®®çš„å‡ºç°ï¼Œä½¿å¾— BS æ¶æ„çš„ç½‘ç«™èƒ½å¤Ÿå±•ç°å¤šåª’ä½“ç­‰ä¿¡æ¯å¦‚è§†é¢‘ã€éŸ³ä¹ç­‰ã€‚èµ·åˆ HTTP åè®®ä¸€èˆ¬ä»…å±•ç¤ºä¸€äº›é™æ€æ•°æ®ï¼Œå…¶è¡¨ç°èƒ½åŠ›ä¸å¼ºï¼Œä¸èƒ½æ›´å¥½çš„åŠ¨æ€çš„ä¸ºç”¨æˆ·äº¤äº’ã€‚ä¹‹ååŠ¨æ€ç½‘ç«™æŠ€æœ¯å¦‚ CGI çš„å‡ºç°ï¼Œä½¿å¾—ç½‘ç«™æ‹¥æœ‰çš„æ›´åŠ ä¸°å¯Œçš„äº¤äº’åŠŸèƒ½ã€‚ç»è¿‡æ•°åå¹´çš„æŠ€æœ¯ç§¯ç´¯ï¼ŒåŠ¨æ€ç½‘ç«™æŠ€æœ¯å·²ç»èƒ½å¤Ÿæ”¯æ’‘èµ·ç°å¦‚ä»Šçš„å¤§éƒ¨åˆ†ä¿¡æ¯çš„è·å–ã€‚ å…¶æ¬¡æ˜¯å­˜å‚¨æŠ€æœ¯ã€‚å¼€å§‹çš„æ—¶å€™æ•°æ®ä»…ä»…ä½¿ç”¨æœ¬åœ°æ–‡ä»¶è¿›è¡Œå­˜å‚¨ã€‚æ–‡ä»¶çš„è¯»å†™æ•ˆç‡å¾ˆé«˜ï¼Œä½†æ˜¯éœ€è¦ç¨‹åºå‘˜é‡å¤çš„ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„è¾ƒåº•å±‚çš„æ“ä½œæ¥æ“ä½œæ–‡ä»¶ï¼Œå¯¹ç¨‹åºå‘˜çš„è¦æ±‚å¤ªå¤§ã€‚è€Œä¸”å¯¹è¿™ç§ç»“æ„åŒ–çš„æ•°æ®æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ¨¡å¼è¿›è¡Œæ“ä½œã€‚æ‰€ä»¥æœ‰äº†æ•°æ®åº“å…³ç³»ç³»ç»Ÿï¼Œå°¤å…¶å…³ç³»å‹æ•°æ®åº“ã€‚ä»æ­¤ï¼Œå¯¹äºä¸€äº›ç»“æ„åŒ–çš„æ•°æ®åªéœ€è¦ä½¿ç”¨ SQL è¿™ç§æ•°æ®æ“ä½œè¯­è¨€ï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ“ä½œæ•°æ®ï¼Œè€ŒçœŸæ­£çš„æ•°æ®ç®¡ç†ç»´æŠ¤å·¥ä½œç”±æ•°æ®åº“ç®¡ç†ç³»ç»Ÿè¿›è¡Œç»´æŠ¤ï¼Œäººå¯ä»¥é€šè¿‡é…ç½®æ•°æ®åº“ï¼Œä½¿æ•°æ®åº“è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚å½“ç”¨æˆ·é‡å¾ˆå¤§æ—¶å€™ï¼Œå•æœºå“åº”å‡ºç°ç“¶é¢ˆï¼Œå•å°æ•°æ®åº“ä¸èƒ½å¤Ÿæ»¡è¶³è¿™æ ·çš„è¯·æ±‚ã€‚å¯ä»¥é€šè¿‡å¤åˆ¶çš„æ–¹å¼ï¼Œå°†ç›¸åŒçš„æ•°æ®å¤åˆ¶åˆ°å¤šå°æœºå™¨ä¸Šï¼Œå¤šå°æœºå™¨ä¸ºç”¨æˆ·æä¾›æ•°æ®ï¼Œå¯¹äºè¯»æ“ä½œè¿›è¡Œæ‰©å±•ã€‚å¯¹äºè¯»å¤šå†™å°‘çš„ç½‘ç«™ï¼Œè¿™ç§æ–¹å¼åŸºæœ¬å¯ä»¥å®ç°çº¿æ€§çš„æ€§èƒ½æå‡ã€‚æ•°æ®é‡å†å¤§ä¸€äº›ï¼Œä½¿ç”¨åˆ†åº“åˆ†è¡¨æ–¹å¼ï¼ŒæŠŠä¸€ä»½æ•°æ®åˆ‡ç‰‡ï¼Œåˆ†å¸ƒåˆ°å¤šå°æœºå™¨ä¸Šæé«˜æ€§èƒ½ã€‚è¿›è€Œä½¿ç”¨å¤åˆ¶ä¸åˆ†åº“åˆ†è¡¨çš„æ–¹å¼ï¼Œè¿›ä¸€æ­¥å‹æ¦¨å•æœºçš„æ€§èƒ½æ½œåŠ›ã€‚å•æœºæ•°æ®åº“å¾ˆå¼ºå¤§ï¼Œä½†æ•°æ®é‡è¾¾åˆ°ä¸€å®šçš„æ•°é‡çº§ï¼Œæ•°æ®åº“çš„æ€§èƒ½å®Œå…¨ä¸èƒ½æ»¡è¶³éœ€æ±‚ã€‚å¤§æ•°æ®æ—¶ä»£ï¼Œæ•°æ®é‡è¾¾åˆ° PBã€TB çº§åˆ«ã€‚è€Œæ¯ä¸€å—ç¡¬ç›˜ä»…ä»…å‡  Tï¼Œå•æœºå®Œå…¨ä¸å¯èƒ½å°†æ‰€æœ‰çš„æ•°æ®éƒ½å­˜å‚¨ä¸‹æ¥ã€‚å¦‚ä¸Šåˆ†åº“åˆ†è¡¨çš„æ–¹å¼åŸºæœ¬å·²ç»ä¸èƒ½å®Œå…¨è§£å†³å¦‚ä¸Šçš„é—®é¢˜ï¼Œæ‰€ä»¥å‡ºç°äº†åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œæ¯”å¦‚ MySQL Cluster ç­‰é€šè¿‡ä¸¤é˜¶æ®µæäº¤ç­‰æ–¹å¼ï¼Œç»´æŠ¤çº¿ä¸Šæ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œæ¯”å¦‚ Google ç ”å‘çš„ GFSï¼Œç°å¦‚ä»Šæ­£ç«çƒ­çš„ HDFS ç­‰ï¼ŒåŸºæœ¬å¯ä»¥æ»¡è¶³æµ·é‡æ•°æ®çš„å­˜å‚¨ã€‚ é«˜é€Ÿç¼“å­˜æŠ€æœ¯ï¼Œå¦‚ä¸€äº›åœºæ™¯é‡å¤è¯»çš„åœºæ™¯ï¼Œæ•°æ®åº“çš„æŸ¥è¯¢å¾ˆæ˜‚è´µï¼Œå¦‚ä½•å‡å°‘æ•°æ®åº“çš„è®¿é—®æ¬¡æ•°ï¼Ÿä½¿ç”¨ç±»ä¼¼ Redis çš„ç¼“å­˜ã€‚redis çš„æ•°æ®å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå†…å­˜çš„é€Ÿåº¦è¿œè¿œè¶…è¿‡æ•°æ®åº“çš„æŸ¥è¯¢é€Ÿåº¦ã€‚ç»´æŠ¤ redis ä¸­çš„ç¼“å­˜æ•°æ®ä¸€è‡´æ€§ï¼Œé˜²æ­¢ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©çš„é—®é¢˜ï¼Œä»¥åŠå¦‚ä½•æ­£ç¡®çš„ä½¿ç”¨ç¼“å­˜ç­‰ä¸€ç³»åˆ—é—®é¢˜ï¼Œç°å¦‚ä»Šå·²ç»åŸºæœ¬æœ‰äº†å¾ˆå¥½çš„è§£å†³åŠæ³•ã€‚ è´Ÿè½½å‡è¡¡ä¸åå‘ä»£ç†ï¼Œä¼ ç»Ÿä¸­ä½¿ç”¨ nginx ä½œä¸ºç½‘å…³ï¼Œæ¥å—çš„è¯·æ±‚åˆ†å‘åˆ°å¤šå°æœåŠ¡å™¨ä¸­ï¼Œä¸€å®šç¨‹åº¦ä¸Šåˆ†æ‹…å•å°æœåŠ¡å™¨çš„å‹åŠ›ã€‚ å¯¹äºåˆ†å¸ƒå¼æŠ€æœ¯ã€‚é¦–å…ˆæ˜¯ Google ç ”å‘å¹¶ä½¿ç”¨çš„ GFS ä»¥åŠæ­å»ºåœ¨ GFS åŸºç¡€ä¸Šçš„ BigTableï¼Œä»¥åŠ MapReduce ç®—æ³•ï¼Œä½¿å¾—åˆ†å¸ƒå¼å­˜å‚¨ä¸åˆ†å¸ƒå¼è®¡ç®—æˆä¸ºäº†å¯èƒ½ã€‚å¯¹åº”çš„å¼€æºç‰ˆæœ¬ä¸º HDFSã€Hadoopã€Spark ç­‰ä¸€ç³»åˆ—åˆ†å¸ƒå¼åŸºç¡€è®¾æ–½ã€‚å­˜å‚¨çš„åˆ†å¸ƒå¼ï¼Œä¹Ÿå¯¹åº”ç€åº”ç”¨éƒ¨ç½²çš„åˆ†å¸ƒå¼ï¼Œä¹Ÿå°±æ˜¯ç°å¦‚ä»Šä½¿ç”¨æ¯”è¾ƒå¹¿æ³›çš„å¾®æœåŠ¡ï¼ˆå°†ä¸€ä¸ªæ•´ä½“çš„åº”ç”¨æ‹†åˆ†æˆä¸åŒçš„æœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´åˆ†åˆ«å¼€å‘å’Œéƒ¨ç½²ï¼Œé€šè¿‡ç»Ÿä¸€çš„æ¥å£è¿›è¡Œåä½œï¼‰ã€‚å¾®æœåŠ¡éƒ¨ç½²å°‘åˆ™å‡ ä¸ªï¼Œå¤šåˆ™æˆç™¾ä¸Šåƒï¼Œå¦‚æ­¤å¤šçš„æœåŠ¡éœ€è¦å¼€å‘éƒ¨ç½²å·¥ä½œé‡å·¨å¤§ã€‚åŒæ—¶å¾ˆå¸¸è§çš„é—®é¢˜æ˜¯å¼€å‘ç¯å¢ƒå¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä¸Šçº¿å´æ— æ³•å·¥ä½œã€‚è¿™ä¸ªé—®é¢˜ç°å¦‚ä»Šçš„è§£å†³åŠæ³•æ˜¯ä½¿ç”¨ dockerã€‚é¦–å…ˆ docker æ˜¯ä¸€ç§ä½¿ç”¨ Linux å†…æ ¸æä¾›çš„ cgroup å’Œ namespace åŠŸèƒ½ï¼Œå®ƒå¯ä»¥å°†è®¡ç®—æœºçš„èµ„æºè¿›è¡Œéš”ç¦»ã€‚ä½¿ç”¨åœºæ™¯æ˜¯é€šè¿‡å®¹å™¨ç¼–æ’å·¥å…·ï¼Œå°†æœåŠ¡æ‰€ä¾èµ–çš„èµ„æºé€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œå®šä¹‰ï¼Œç”±ç¼–æ’å·¥å…·ç»Ÿä¸€å¯¹æ‰€æœ‰çš„æœåŠ¡è¿›è¡Œå¯åŠ¨éƒ¨ç½²ã€‚ç°å¦‚ä»Šå®è´¨ä¸Šçš„å®¹å™¨ç¼–æ’æ ‡å‡† Kubernetesï¼Œå·²ç»è¢«ä¸é™äº Googleã€ç™¾åº¦ã€é˜¿é‡Œå·´å·´ã€äº¬ä¸œç­‰ä½¿ç”¨ã€‚å¯¹äº Google ç­‰åŸºæœ¬å®ç°å®¹å™¨åŒ–ã€Kubernetes åŒ–ã€‚ ","date":"2018-10-25","objectID":"/overview-distributed-technology-and-the-problems-it-solves/:0:0","tags":["bigdata","æ€»ç»“"],"title":"åˆ†å¸ƒå¼æŠ€æœ¯äº§ç”Ÿçš„èƒŒæ™¯åŠå…¶è§£å†³çš„é—®é¢˜æ¦‚è¿°","uri":"/overview-distributed-technology-and-the-problems-it-solves/"},{"categories":null,"content":"realize ä»£ç åˆ†æ Realize realize æ˜¯ Go å†™çš„ workfloaw å·¥å…·ï¼Œå¯ä»¥é…ç½®è‡ªå·±çš„å·¥ä½œæµã€‚é¡¹ç›®åœ¨ä¿®æ”¹ä¹‹åéœ€è¦è¿›è¡Œç¼–è¯‘ã€æµ‹è¯•ï¼Œå¯ä»¥è¿˜æœ‰å…¶ä»–çš„ä¸€ç³»åˆ—æµç¨‹éœ€è¦èµ°ï¼Œå¯ä»¥ä½¿ç”¨ realize è¿›è¡Œè‡ªåŠ¨åŒ–ã€‚æŠ½ç‚¹æ—¶é—´ç ”ç©¶äº†ä¸€ä¸‹æºç ã€‚è¿™é‡Œæ€»ç»“ä¸€ä¸‹æ€è·¯ï¼Œä¸æ˜¯å¾ˆå®Œæ•´çš„è§£é‡Šï¼Œç®€å•è¯´ä¸€ä¸‹æ€è·¯ã€‚ ","date":"2018-10-11","objectID":"/realize/:0:0","tags":["å·¥å…·","Go"],"title":"Realizeä»£ç åˆ†æ","uri":"/realize/"},{"categories":null,"content":"åŸç† ä» Linux 2.6.13 å†…æ ¸å¼€å§‹ï¼ŒLinux å°±æ¨å‡ºäº† inotifyï¼Œå…è®¸ç›‘æ§ç¨‹åºæ‰“å¼€ä¸€ä¸ªç‹¬ç«‹æ–‡ä»¶æè¿°ç¬¦ï¼Œå¹¶é’ˆå¯¹äº‹ä»¶é›†ç›‘æ§ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–‡ä»¶ï¼Œä¾‹å¦‚æ‰“å¼€ã€å…³é—­ã€ç§»åŠ¨/é‡å‘½åã€åˆ é™¤ã€åˆ›å»ºæˆ–è€…æ”¹å˜å±æ€§ã€‚glib å¯¹å¯¹æ­¤è¿›è¡Œäº†å°è£…glib/inotify.h,åŒæ—¶å„ä¸ªæ“ä½œç³»ç»Ÿéƒ½æœ‰å¯¹åº”çš„å®ç°ï¼Œwin ä¸‹çš„ ReadDirectoryChangesWï¼Œmac ä¸‹çš„ FSEventsã€‚åŒæ—¶ go ä¸‹å·²ç»æœ‰å†™å¥½çš„å°è£…åº“fsnotify/fsnotifyï¼Œå¯¹ä¸åŒçš„å¹³å°è¿›è¡Œäº†å°è£…ã€‚ ç®€å•æ¥è®²ï¼Œå†…æ ¸ä¸ºåº”ç”¨ç¨‹åºæä¾›äº†ç³»ç»Ÿçº§æ–‡ä»¶ä¿®æ”¹äº‹ä»¶çš„ç›‘è§†å™¨ã€‚å½“æ–‡ä»¶è¿›è¡Œä¿®æ”¹åï¼Œä¼šé€šçŸ¥åº”ç”¨ç¨‹åºç›‘è§†çš„æ–‡ä»¶å·²ç»ä¿®æ”¹äº†ï¼Œä¹‹åæœ‰realizeè¿›è¡Œäº‹ä»¶çš„å¤„ç†å³å¯ã€‚ æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ï¼Œyamlæ–‡ä»¶çš„marshalå’Œunmarshalã€‚ä¹‹åå¯ä»¥ç ”ç©¶ä¸€ä¸‹ã€‚ ","date":"2018-10-11","objectID":"/realize/:1:0","tags":["å·¥å…·","Go"],"title":"Realizeä»£ç åˆ†æ","uri":"/realize/"},{"categories":null,"content":"æ ¸å¿ƒä»£ç  // github.com/oxequa/realize/realize/projects.go func (p *Project) Watch(wg *sync.WaitGroup) { var err error // change channel p.stop = make(chan bool) // init a new watcher p.watcher, err = NewFileWatcher(p.parent.Settings.Legacy) if err != nil { log.Fatal(err) } defer func() { close(p.stop) p.watcher.Close() }() // before start checks p.Before() // start watcher go p.Reload(\"\", p.stop) L: for { select { case event := \u003c-p.watcher.Events(): if p.parent.Settings.Recovery.Events { log.Println(\"File:\", event.Name, \"LastFile:\", p.last.file, \"Time:\", time.Now(), \"LastTime:\", p.last.time) } if time.Now().Truncate(time.Second).After(p.last.time) { // switch event type switch event.Op { case fsnotify.Chmod: case fsnotify.Remove: p.watcher.Remove(event.Name) if p.Validate(event.Name, false) \u0026\u0026 ext(event.Name) != \"\" { // stop and restart close(p.stop) p.stop = make(chan bool) p.Change(event) go p.Reload(\"\", p.stop) } default: if p.Validate(event.Name, true) { fi, err := os.Stat(event.Name) if err != nil { continue } if fi.IsDir() { filepath.Walk(event.Name, p.walk) } else { // stop and restart close(p.stop) p.stop = make(chan bool) p.Change(event) go p.Reload(event.Name, p.stop) p.last.time = time.Now().Truncate(time.Second) p.last.file = event.Name } } } } case err := \u003c-p.watcher.Errors(): p.Err(err) case \u003c-p.exit: p.After() break L } } wg.Done() } Reference ç”¨ inotify ç›‘æ§ Linux æ–‡ä»¶ç³»ç»Ÿäº‹ä»¶ oxequa/realize fsnotify/fsnotify ","date":"2018-10-11","objectID":"/realize/:2:0","tags":["å·¥å…·","Go"],"title":"Realizeä»£ç åˆ†æ","uri":"/realize/"},{"categories":null,"content":"æ¯”è¾ƒ SparkStream ç±»ä¼¼äº§å“å¦‚ Samzaã€Stormï¼Œä»‹ç» Spark å’Œ Spark Stream å®‰è£…å’Œç®€å•ä½¿ç”¨æ–¹æ³• sparkstream-related-product-selection-spark-installation-use ","date":"2018-07-04","objectID":"/sparkstream-related-product-selection-spark-installation-use/:0:0","tags":["BigData","Spark","Stream","æŠ€æœ¯é€‰å‹"],"title":"SparkStreamç­‰ç›¸å…³äº§å“é€‰å‹ä»¥åŠSparkå®‰è£…ä¸ç®€å•ä½¿ç”¨","uri":"/sparkstream-related-product-selection-spark-installation-use/"},{"categories":null,"content":"å„äº§å“æ¯”è¾ƒ ","date":"2018-07-04","objectID":"/sparkstream-related-product-selection-spark-installation-use/:1:0","tags":["BigData","Spark","Stream","æŠ€æœ¯é€‰å‹"],"title":"SparkStreamç­‰ç›¸å…³äº§å“é€‰å‹ä»¥åŠSparkå®‰è£…ä¸ç®€å•ä½¿ç”¨","uri":"/sparkstream-related-product-selection-spark-installation-use/"},{"categories":null,"content":"Samza Samza æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æµå¼æ•°æ®å¤„ç†æ¡†æ¶ï¼ˆstreaming processingï¼‰ï¼ŒLinkedin å¼€æºçš„äº§å“ï¼Œ å®ƒæ˜¯åŸºäº Kafka æ¶ˆæ¯é˜Ÿåˆ—æ¥å®ç°ç±»å®æ—¶çš„æµå¼æ•°æ®å¤„ç†çš„ã€‚æ›´ä¸ºå‡†ç¡®çš„è¯´æ³•æ˜¯ï¼ŒSamza æ˜¯é€šè¿‡æ¨¡å—åŒ–çš„å½¢å¼æ¥ä½¿ç”¨ Apache Kafka çš„ï¼Œå› æ­¤å¯ä»¥æ„æ¶åœ¨å…¶ä»–æ¶ˆæ¯é˜Ÿåˆ—æ¡†æ¶ä¸Šï¼Œä½†å‡ºå‘ç‚¹å’Œé»˜è®¤å®ç°æ˜¯åŸºäº Apache Kafkaã€‚ æœ¬è´¨ä¸Šè¯´ï¼ŒSamza æ˜¯åœ¨æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿä¸Šçš„æ›´é«˜å±‚çš„æŠ½è±¡ï¼Œæ˜¯ä¸€ç§åº”ç”¨æµå¼å¤„ç†æ¡†æ¶åœ¨æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿä¸Šçš„ä¸€ç§åº”ç”¨æ¨¡å¼çš„å®ç°ã€‚ æ€»çš„æ¥è¯´ï¼ŒSamza ä¸ Storm ç›¸æ¯”ï¼Œä¼ è¾“ä¸Šå®Œå…¨åŸºäº Apache Kafkaï¼Œé›†ç¾¤ç®¡ç†åŸºäº Hadoop YARNï¼Œå³ Samza åªè´Ÿè´£å¤„ç†è¿™ä¸€å—å…·ä½“ä¸šåŠ¡ï¼Œå†åŠ ä¸ŠåŸºäº RocksDB çš„çŠ¶æ€ç®¡ç†ã€‚ç”±äºå—é™äº Kafka å’Œ YARNï¼Œæ‰€ä»¥å®ƒçš„æ‹“æ‰‘ç»“æ„ä¸å¤Ÿçµæ´»ã€‚ ","date":"2018-07-04","objectID":"/sparkstream-related-product-selection-spark-installation-use/:1:1","tags":["BigData","Spark","Stream","æŠ€æœ¯é€‰å‹"],"title":"SparkStreamç­‰ç›¸å…³äº§å“é€‰å‹ä»¥åŠSparkå®‰è£…ä¸ç®€å•ä½¿ç”¨","uri":"/sparkstream-related-product-selection-spark-installation-use/"},{"categories":null,"content":"Storm Storm æ¡†æ¶ä¸å…¶ä»–å¤§æ•°æ®è§£å†³æ–¹æ¡ˆçš„ä¸åŒä¹‹å¤„ï¼Œåœ¨äºå®ƒçš„å¤„ç†æ–¹å¼ã€‚Apcahe Hadoop æœ¬è´¨ä¸Šæ¥è¯´æ˜¯ä¸€ä¸ªæ‰¹å¤„ç†ç³»ç»Ÿï¼Œå³ç›®æ ‡åº”ç”¨æ¨¡å¼æ˜¯é’ˆå¯¹ç¦»çº¿åˆ†æä¸ºä¸»ã€‚æ•°æ®è¢«å¼•å…¥ Hadoop çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ (HDFS)ï¼Œå¹¶è¢«å‡åŒ€åœ°åˆ†å‘åˆ°å„ä¸ªèŠ‚ç‚¹è¿›è¡Œå¤„ç†ï¼ŒHDFS çš„æ•°æ®å¹³è¡¡è§„åˆ™å¯ä»¥å‚ç…§æœ¬æ–‡ä½œè€…å‘è¡¨äº IBM çš„æ–‡ç« ã€ŠHDFS æ•°æ®å¹³è¡¡è§„åˆ™åŠå®éªŒä»‹ç»ã€‹ï¼Œè¿›è¡Œæ·±å…¥äº†è§£ã€‚å½“å¤„ç†å®Œæˆæ—¶ï¼Œç»“æœæ•°æ®è¿”å›åˆ° HDFSï¼Œç„¶åå¯ä»¥ä¾›å¤„ç†å‘èµ·è€…ä½¿ç”¨ã€‚Storm åˆ™æ”¯æŒåˆ›å»ºæ‹“æ‰‘ç»“æ„æ¥è½¬æ¢æ²¡æœ‰ç»ˆç‚¹çš„æ•°æ®æµã€‚ä¸åŒäº Hadoop ä½œä¸šï¼Œè¿™äº›è½¬æ¢ä»ä¸ä¼šè‡ªåŠ¨åœæ­¢ï¼Œå®ƒä»¬ä¼šæŒç»­å¤„ç†åˆ°è¾¾çš„æ•°æ®ï¼Œå³ Storm çš„æµå¼å®æ—¶å¤„ç†æ–¹å¼ã€‚ ","date":"2018-07-04","objectID":"/sparkstream-related-product-selection-spark-installation-use/:1:2","tags":["BigData","Spark","Stream","æŠ€æœ¯é€‰å‹"],"title":"SparkStreamç­‰ç›¸å…³äº§å“é€‰å‹ä»¥åŠSparkå®‰è£…ä¸ç®€å•ä½¿ç”¨","uri":"/sparkstream-related-product-selection-spark-installation-use/"},{"categories":null,"content":"Spark Streaming Spark Streaming ç±»ä¼¼äº Apache Stormï¼Œç”¨äºæµå¼æ•°æ®çš„å¤„ç†ã€‚æ ¹æ®å…¶å®˜æ–¹æ–‡æ¡£ä»‹ç»ï¼ŒSpark Streaming æœ‰é«˜ååé‡å’Œå®¹é”™èƒ½åŠ›å¼ºè¿™ä¸¤ä¸ªç‰¹ç‚¹ã€‚Spark Streaming æ”¯æŒçš„æ•°æ®è¾“å…¥æºå¾ˆå¤šï¼Œä¾‹å¦‚ï¼šKafkaã€Flumeã€Twitterã€ZeroMQ å’Œç®€å•çš„ TCP å¥—æ¥å­—ç­‰ç­‰ã€‚æ•°æ®è¾“å…¥åå¯ä»¥ç”¨ Spark çš„é«˜åº¦æŠ½è±¡åŸè¯­å¦‚ï¼šmapã€reduceã€joinã€window ç­‰è¿›è¡Œè¿ç®—ã€‚è€Œç»“æœä¹Ÿèƒ½ä¿å­˜åœ¨å¾ˆå¤šåœ°æ–¹ï¼Œå¦‚ HDFSï¼Œæ•°æ®åº“ç­‰ã€‚å¦å¤– Spark Streaming ä¹Ÿèƒ½å’Œ MLlibï¼ˆæœºå™¨å­¦ä¹ ï¼‰ä»¥åŠ Graphx å®Œç¾èåˆã€‚ åœ¨ Spark Streaming ä¸­ï¼Œå¤„ç†æ•°æ®çš„å•ä½æ˜¯ä¸€æ‰¹è€Œä¸æ˜¯å•æ¡ï¼Œè€Œæ•°æ®é‡‡é›†å´æ˜¯é€æ¡è¿›è¡Œçš„ï¼Œå› æ­¤ Spark Streaming ç³»ç»Ÿéœ€è¦è®¾ç½®é—´éš”ä½¿å¾—æ•°æ®æ±‡æ€»åˆ°ä¸€å®šçš„é‡åå†ä¸€å¹¶æ“ä½œï¼Œè¿™ä¸ªé—´éš”å°±æ˜¯æ‰¹å¤„ç†é—´éš”ã€‚æ‰¹å¤„ç†é—´éš”ï¼ˆ0.2s-2sï¼‰æ˜¯ Spark Streaming çš„æ ¸å¿ƒæ¦‚å¿µå’Œå…³é”®å‚æ•°ï¼Œå®ƒå†³å®šäº† Spark Streaming æäº¤ä½œä¸šçš„é¢‘ç‡å’Œæ•°æ®å¤„ç†çš„å»¶è¿Ÿï¼ŒåŒæ—¶ä¹Ÿå½±å“ç€æ•°æ®å¤„ç†çš„ååé‡å’Œæ€§èƒ½ã€‚ ","date":"2018-07-04","objectID":"/sparkstream-related-product-selection-spark-installation-use/:1:3","tags":["BigData","Spark","Stream","æŠ€æœ¯é€‰å‹"],"title":"SparkStreamç­‰ç›¸å…³äº§å“é€‰å‹ä»¥åŠSparkå®‰è£…ä¸ç®€å•ä½¿ç”¨","uri":"/sparkstream-related-product-selection-spark-installation-use/"},{"categories":null,"content":"Kafka Sreeam Kafka Streams æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†å’Œåˆ†ææ•°æ®çš„å®¢æˆ·ç«¯åº“ã€‚å®ƒå…ˆæŠŠå­˜å‚¨åœ¨ Kafka ä¸­çš„æ•°æ®è¿›è¡Œå¤„ç†å’Œåˆ†æï¼Œç„¶åå°†æœ€ç»ˆæ‰€å¾—çš„æ•°æ®ç»“æœå›å†™åˆ° Kafka æˆ–å‘é€åˆ°å¤–éƒ¨ç³»ç»Ÿå»ã€‚å®ƒå»ºç«‹åœ¨ä¸€äº›éå¸¸é‡è¦çš„æµå¼å¤„ç†æ¦‚å¿µä¹‹ä¸Šï¼Œä¾‹å¦‚é€‚å½“åŒºåˆ†äº‹ä»¶æ—¶é—´å’Œå¤„ç†æ—¶é—´ã€çª—å£æ”¯æŒï¼Œä»¥åŠåº”ç”¨ç¨‹åºçŠ¶æ€çš„ç®€å•ï¼ˆé«˜æ•ˆï¼‰ç®¡ç†ã€‚åŒæ—¶ï¼Œå®ƒä¹ŸåŸºäº Kafka ä¸­çš„è®¸å¤šæ¦‚å¿µï¼Œä¾‹å¦‚é€šè¿‡åˆ’åˆ†ä¸»é¢˜è¿›è¡Œæ‰©å±•ã€‚æ­¤å¤–ï¼Œç”±äºè¿™ä¸ªåŸå› ï¼Œå®ƒä½œä¸ºä¸€ä¸ªè½»é‡çº§çš„åº“å¯ä»¥é›†æˆåˆ°åº”ç”¨ç¨‹åºä¸­å»ã€‚è¿™ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®éœ€è¦ç‹¬ç«‹è¿è¡Œã€åœ¨åº”ç”¨ç¨‹åºæœåŠ¡å™¨ä¸­è¿è¡Œã€ä½œä¸º Docker å®¹å™¨ï¼Œæˆ–é€šè¿‡èµ„æºç®¡ç†å™¨ï¼ˆå¦‚ Mesosï¼‰è¿›è¡Œæ“ä½œã€‚ Kafka Sreeam ç›´æ¥è§£å†³äº†æµå¼å¤„ç†ä¸­çš„å¾ˆå¤šå›°éš¾é—®é¢˜:æ¯«ç§’çº§å»¶è¿Ÿçš„é€ä¸ªäº‹ä»¶å¤„ç†ã€‚æœ‰çŠ¶æ€çš„å¤„ç†ï¼ŒåŒ…æ‹¬åˆ†å¸ƒå¼è¿æ¥å’Œèšåˆã€‚æ–¹ä¾¿çš„ DSLã€‚ä½¿ç”¨ç±»ä¼¼ DataFlow çš„æ¨¡å‹å¯¹æ— åºæ•°æ®è¿›è¡Œçª—å£åŒ–ã€‚å…·æœ‰å¿«é€Ÿæ•…éšœåˆ‡æ¢çš„åˆ†å¸ƒå¼å¤„ç†å’Œå®¹é”™èƒ½åŠ›ã€‚æ— åœæœºæ»šåŠ¨éƒ¨ç½²ã€‚ ","date":"2018-07-04","objectID":"/sparkstream-related-product-selection-spark-installation-use/:1:4","tags":["BigData","Spark","Stream","æŠ€æœ¯é€‰å‹"],"title":"SparkStreamç­‰ç›¸å…³äº§å“é€‰å‹ä»¥åŠSparkå®‰è£…ä¸ç®€å•ä½¿ç”¨","uri":"/sparkstream-related-product-selection-spark-installation-use/"},{"categories":null,"content":"ä¸»è¦æ¯”è¾ƒ Spark Stream å’Œ Storm å’Œé€‰æ‹© æ¯”è¾ƒé¡¹ SparkStream Storm è¡€ç»Ÿ UC Berkeley AMP lab Twitter å¼€æºæ—¶é—´ 2011.05 2011.09 ä¾èµ–ç¯å¢ƒ Java Zookeeper Java Python å¼€å‘è¯­è¨€ Scala Java Clojure æ”¯æŒè¯­è¨€ Scala Java Python R Any ç¡¬ç›˜ IO å°‘ ä¸€èˆ¬ é›†ç¾¤æ”¯æŒ è¶…è¿‡ 1000 èŠ‚ç‚¹ å¥½ ååé‡ å¥½ è¾ƒå¥½ ä½¿ç”¨å…¬å¸ intel è…¾è®¯ æ·˜å® ä¸­ç§»åŠ¨ Goole æ·˜å® ç™¾åº¦ Twitter é›…è™ é€‚ç”¨åœºæ™¯ è¾ƒå¤§æ•°æ®å—\u0026éœ€è¦é«˜æ—¶æ•ˆæ€§çš„å°æ‰¹é‡è®¡ç®— å®æ—¶å°æ•°æ®å—çš„åˆ†æè®¡ç®— å»¶æ—¶ å‡†å®æ—¶ï¼šä¸€æ¬¡å¤„ç†ä¸€ä¸ªå³å°†åˆ°è¾¾çš„äº‹ä»¶ å®æ—¶ï¼šå¤„ç†åœ¨ä¸€å®šçš„æ—¶é—´å†…ï¼ˆæ—¶é—´é—´éš”å¯è‡ªå·±è®¾ç½®ï¼‰åœ¨çª—å£ä¸­æ”¶åˆ°çš„ä¸€æ‰¹äº‹ä»¶ å®¹é”™ åœ¨æ‰¹å¤„ç†çº§åˆ«è¿›è¡Œè·Ÿè¸ªå¤„ç†ï¼Œå› æ­¤å³ä½¿å‘ç”ŸèŠ‚ç‚¹æ•…éšœç­‰æ•…éšœï¼Œä¹Ÿå¯ä»¥æœ‰æ•ˆåœ°ä¿è¯æ¯ä¸ªå°æ‰¹é‡éƒ½èƒ½å¤Ÿè¢«ç²¾ç¡®å¤„ç†ä¸€æ¬¡ æ¯ä¸ªå•ç‹¬çš„è®°å½•å¿…é¡»åœ¨å…¶é€šè¿‡ç³»ç»Ÿæ—¶è¢«è·Ÿè¸ªï¼Œå› æ­¤ Storm ä»…ä¿è¯æ¯ä¸ªè®°å½•è‡³å°‘è¢«å¤„ç†ä¸€æ¬¡ï¼Œä½†æ˜¯ä»æ•…éšœä¸­æ¢å¤æœŸé—´å…è®¸å‡ºç°é‡å¤ã€‚ è¿™æ„å‘³ç€å¯å˜çŠ¶æ€å¯èƒ½ä¸æ­£ç¡®åœ°æ›´æ–°äº†ä¸¤æ¬¡ 1.å¤„ç†æ¨¡å‹ä»¥åŠå»¶è¿Ÿ è™½ç„¶è¿™ä¸¤ä¸ªæ¡†æ¶éƒ½æä¾›å¯æ‰©å±•æ€§(Scalability)å’Œå¯å®¹é”™æ€§(Fault Tolerance),ä½†æ˜¯å®ƒä»¬çš„å¤„ç†æ¨¡å‹ä»æ ¹æœ¬ä¸Šè¯´æ˜¯ä¸ä¸€æ ·çš„ã€‚Storm å¤„ç†çš„æ˜¯æ¯æ¬¡ä¼ å…¥çš„ä¸€ä¸ªäº‹ä»¶ï¼Œè€Œ Spark Streaming æ˜¯å¤„ç†æŸä¸ªæ—¶é—´æ®µçª—å£å†…çš„äº‹ä»¶æµã€‚å› æ­¤ï¼ŒStorm å¤„ç†ä¸€ä¸ªäº‹ä»¶å¯ä»¥è¾¾åˆ°äºšç§’çº§çš„å»¶è¿Ÿï¼Œè€Œ Spark Streaming åˆ™æœ‰ç§’çº§çš„å»¶è¿Ÿã€‚ 2.å®¹é”™å’Œæ•°æ®ä¿è¯ åœ¨å®¹é”™æ•°æ®ä¿è¯æ–¹é¢çš„æƒè¡¡æ–¹é¢ï¼ŒSpark Streaming æä¾›äº†æ›´å¥½çš„æ”¯æŒå®¹é”™çŠ¶æ€è®¡ç®—ã€‚åœ¨ Storm ä¸­ï¼Œå½“æ¯æ¡å•ç‹¬çš„è®°å½•é€šè¿‡ç³»ç»Ÿæ—¶å¿…é¡»è¢«è·Ÿè¸ªï¼Œæ‰€ä»¥ Storm èƒ½å¤Ÿè‡³å°‘ä¿è¯æ¯æ¡è®°å½•å°†è¢«å¤„ç†ä¸€æ¬¡ï¼Œä½†æ˜¯åœ¨ä»é”™è¯¯ä¸­æ¢å¤è¿‡æ¥æ—¶å€™å…è®¸å‡ºç°é‡å¤è®°å½•ï¼Œè¿™æ„å‘³ç€å¯å˜çŠ¶æ€å¯èƒ½ä¸æ­£ç¡®åœ°è¢«æ›´æ–°ä¸¤æ¬¡ã€‚è€Œ Spark Streaming åªéœ€è¦åœ¨æ‰¹å¤„ç†çº§åˆ«å¯¹è®°å½•è¿›è¡Œè·Ÿè¸ªå¤„ç†ï¼Œå› æ­¤å¯ä»¥æœ‰æ•ˆåœ°ä¿è¯æ¯æ¡è®°å½•å°†å®Œå…¨è¢«å¤„ç†ä¸€æ¬¡ï¼Œå³ä¾¿ä¸€ä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœã€‚è™½ç„¶ Storm çš„ Trident library åº“ä¹Ÿæä¾›äº†å®Œå…¨ä¸€æ¬¡å¤„ç†çš„åŠŸèƒ½ã€‚ä½†æ˜¯å®ƒä¾èµ–äºäº‹åŠ¡æ›´æ–°çŠ¶æ€ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ˆæ…¢çš„ï¼Œå¹¶ä¸”é€šå¸¸å¿…é¡»ç”±ç”¨æˆ·å®ç°ã€‚ ç®€è€Œè¨€ä¹‹,å¦‚æœä½ éœ€è¦äºšç§’çº§çš„å»¶è¿Ÿï¼ŒStorm æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œè€Œä¸”æ²¡æœ‰æ•°æ®ä¸¢å¤±ã€‚å¦‚æœä½ éœ€è¦æœ‰çŠ¶æ€çš„è®¡ç®—ï¼Œè€Œä¸”è¦å®Œå…¨ä¿è¯æ¯ä¸ªäº‹ä»¶åªè¢«å¤„ç†ä¸€æ¬¡ï¼ŒSpark Streaming åˆ™æ›´å¥½ã€‚Spark Streaming ç¼–ç¨‹é€»è¾‘ä¹Ÿå¯èƒ½æ›´å®¹æ˜“ï¼Œå› ä¸ºå®ƒç±»ä¼¼äºæ‰¹å¤„ç†ç¨‹åºï¼Œç‰¹åˆ«æ˜¯åœ¨ä½ ä½¿ç”¨æ‰¹æ¬¡(å°½ç®¡æ˜¯å¾ˆå°çš„)æ—¶ã€‚ 3.å®ç°å’Œç¼–ç¨‹ API Storm ä¸»è¦æ˜¯ç”± Clojure è¯­è¨€å®ç°ï¼ŒSpark Streaming æ˜¯ç”± Scala å®ç°ã€‚å¦‚æœä½ æƒ³çœ‹çœ‹è¿™ä¸¤ä¸ªæ¡†æ¶æ˜¯å¦‚ä½•å®ç°çš„æˆ–è€…ä½ æƒ³è‡ªå®šä¹‰ä¸€äº›ä¸œè¥¿ä½ å°±å¾—è®°ä½è¿™ä¸€ç‚¹ã€‚Storm æ˜¯ç”± BackType å’Œ Twitter å¼€å‘ï¼Œè€Œ Spark Streaming æ˜¯åœ¨ UC Berkeley å¼€å‘çš„ã€‚ Storm æä¾›äº† Java APIï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå…¶ä»–è¯­è¨€çš„ APIã€‚ Spark Streaming æ”¯æŒ Scala å’Œ Java è¯­è¨€(å…¶å®ä¹Ÿæ”¯æŒ Python)ã€‚å¦å¤– Spark Streaming çš„ä¸€ä¸ªå¾ˆæ£’çš„ç‰¹æ€§å°±æ˜¯å®ƒæ˜¯åœ¨ Spark æ¡†æ¶ä¸Šè¿è¡Œçš„ã€‚è¿™æ ·ä½ å°±å¯ä»¥æƒ³ä½¿ç”¨å…¶ä»–æ‰¹å¤„ç†ä»£ç ä¸€æ ·æ¥å†™ Spark Streaming ç¨‹åºï¼Œæˆ–è€…æ˜¯åœ¨ Spark ä¸­äº¤äº’æŸ¥è¯¢ã€‚è¿™å°±å‡å°‘äº†å•ç‹¬ç¼–å†™æµæ‰¹é‡å¤„ç†ç¨‹åºå’Œå†å²æ•°æ®å¤„ç†ç¨‹åºã€‚ 4.ç”Ÿäº§æ”¯æŒ Storm å·²ç»å‡ºç°å¥½å¤šå¹´äº†ï¼Œè€Œä¸”è‡ªä» 2011 å¹´å¼€å§‹å°±åœ¨ Twitter å†…éƒ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›å…¬å¸ã€‚è€Œ Spark Streaming æ˜¯ä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œå¹¶ä¸”åœ¨ 2013 å¹´ä»…ä»…è¢« Sharethrough ä½¿ç”¨(æ®ä½œè€…äº†è§£)ã€‚ Storm æ˜¯ Hortonworks Hadoop æ•°æ®å¹³å°ä¸­æµå¤„ç†çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œ Spark Streaming å‡ºç°åœ¨ MapR çš„åˆ†å¸ƒå¼å¹³å°å’Œ Cloudera çš„ä¼ä¸šæ•°æ®å¹³å°ä¸­ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒDatabricks æ˜¯ä¸º Spark æä¾›æŠ€æœ¯æ”¯æŒçš„å…¬å¸ï¼ŒåŒ…æ‹¬äº† Spark Streamingã€‚ 5.é›†ç¾¤ç®¡ç†é›†æˆ å°½ç®¡ä¸¤ä¸ªç³»ç»Ÿéƒ½è¿è¡Œåœ¨å®ƒä»¬è‡ªå·±çš„é›†ç¾¤ä¸Šï¼ŒStorm ä¹Ÿèƒ½è¿è¡Œåœ¨ Mesosï¼Œè€Œ Spark Streaming èƒ½è¿è¡Œåœ¨ YARN å’Œ Mesos ä¸Šã€‚ è¿™é‡Œæ€»ç»“äº† Kafka Stream-Spark Streaming-Storm æµå¼è®¡ç®—æ¡†æ¶æ¯”è¾ƒé€‰å‹çš„ç›¸å…³èµ„æ–™ã€‚ è¿™é‡Œç”±æ›´å¤šçš„ç›¸å…³äº§å“çš„å·®å¼‚æ¯”è¾ƒèµ„æºï¼š Storm ä»‹ç» Spark Streaming vs. Kafka Stream å“ªä¸ªæ›´é€‚åˆä½ ï¼Ÿ å¤§æ•°æ®æ¡†æ¶å¯¹æ¯”ï¼šHadoopã€Stormã€Samzaã€Spark å’Œ Flink Spark Streaming ä¸ Storm çš„å¯¹æ¯”åˆ†æ Storm å’Œ Spark Streaming çš„æ¨ªå‘æ¯”è¾ƒ Spark Streaming å’Œ Storm å¦‚ä½•é€‰æ‹©ï¼Ÿæ­å»ºæµå¼å®æ—¶è®¡ç®—å¹³å°ï¼Œå¹¿å‘Šæ—¥å¿—å®æ—¶èŠ±è´¹ Spark Streaming æ–°æ‰‹æŒ‡å— ","date":"2018-07-04","objectID":"/sparkstream-related-product-selection-spark-installation-use/:2:0","tags":["BigData","Spark","Stream","æŠ€æœ¯é€‰å‹"],"title":"SparkStreamç­‰ç›¸å…³äº§å“é€‰å‹ä»¥åŠSparkå®‰è£…ä¸ç®€å•ä½¿ç”¨","uri":"/sparkstream-related-product-selection-spark-installation-use/"},{"categories":null,"content":"Spark ä»‹ç» Spark ç”Ÿæ€ Spark å®˜ç½‘ç®€å•ä»‹ç»äº† spark çš„çš„ä¼˜åŠ¿ã€‚ è¿™é‡Œéå¸¸è¯¦ç»†äº†ä»‹ç» Spark ç”Ÿæ€ã€å„å¤§å‚åº”ç”¨åœºæ™¯ã€Spark åŸºæœ¬åŸç†ã€‚ ","date":"2018-07-04","objectID":"/sparkstream-related-product-selection-spark-installation-use/:3:0","tags":["BigData","Spark","Stream","æŠ€æœ¯é€‰å‹"],"title":"SparkStreamç­‰ç›¸å…³äº§å“é€‰å‹ä»¥åŠSparkå®‰è£…ä¸ç®€å•ä½¿ç”¨","uri":"/sparkstream-related-product-selection-spark-installation-use/"},{"categories":null,"content":"Spark å’Œ Spark Stream çš„å®‰è£…å’Œä½¿ç”¨ ","date":"2018-07-04","objectID":"/sparkstream-related-product-selection-spark-installation-use/:4:0","tags":["BigData","Spark","Stream","æŠ€æœ¯é€‰å‹"],"title":"SparkStreamç­‰ç›¸å…³äº§å“é€‰å‹ä»¥åŠSparkå®‰è£…ä¸ç®€å•ä½¿ç”¨","uri":"/sparkstream-related-product-selection-spark-installation-use/"},{"categories":null,"content":"Spark ä»‹ç» Spark Streaming æ˜¯ Spark Core API çš„æ‰©å±•, å®ƒæ”¯æŒå¼¹æ€§çš„, é«˜ååçš„, å®¹é”™çš„å®æ—¶æ•°æ®æµçš„å¤„ç†. æ•°æ®å¯ä»¥é€šè¿‡å¤šç§æ•°æ®æºè·å–, ä¾‹å¦‚ Kafka, Flume, Kinesis ä»¥åŠ TCP sockets, ä¹Ÿå¯ä»¥é€šè¿‡ä¾‹å¦‚ map, reduce, join, window ç­‰çš„é«˜çº§å‡½æ•°ç»„æˆçš„å¤æ‚ç®—æ³•å¤„ç†. æœ€ç»ˆ, å¤„ç†åçš„æ•°æ®å¯ä»¥è¾“å‡ºåˆ°æ–‡ä»¶ç³»ç»Ÿ, æ•°æ®åº“ä»¥åŠå®æ—¶ä»ªè¡¨ç›˜ä¸­.äº‹å®ä¸Š,ä½ è¿˜å¯ä»¥åœ¨ data streamsï¼ˆæ•°æ®æµï¼‰ä¸Šä½¿ç”¨æœºå™¨å­¦ä¹ ä»¥åŠå›¾è®¡ç®— ç®—æ³• åœ¨å†…éƒ¨, å®ƒå·¥ä½œåŸç†å¦‚ä¸‹, Spark Streaming æ¥æ”¶å®æ—¶è¾“å…¥æ•°æ®æµå¹¶å°†æ•°æ®åˆ‡åˆ†æˆå¤šä¸ª batchï¼ˆæ‰¹ï¼‰æ•°æ®, ç„¶åç”± Spark å¼•æ“å¤„ç†å®ƒä»¬ä»¥ç”Ÿæˆæœ€ç»ˆçš„ stream of results in batchesï¼ˆåˆ†æ‰¹æµç»“æœï¼‰. Spark Streaming æä¾›äº†ä¸€ä¸ªåä¸º discretized stream æˆ– DStream çš„é«˜çº§æŠ½è±¡, å®ƒä»£è¡¨ä¸€ä¸ªè¿ç»­çš„æ•°æ®æµ. DStream å¯ä»¥ä»æ•°æ®æºçš„è¾“å…¥æ•°æ®æµåˆ›å»º, ä¾‹å¦‚ Kafka, Flume ä»¥åŠ Kinesis, æˆ–è€…åœ¨å…¶ä»– DStream ä¸Šè¿›è¡Œé«˜å±‚æ¬¡çš„æ“ä½œä»¥åˆ›å»º. åœ¨å†…éƒ¨, ä¸€ä¸ª DStream æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„ RDDs æ¥è¡¨ç¤º. ä½ å¯ä»¥ä½¿ç”¨ Scala , Java æˆ–è€… Pythonï¼ˆSpark 1.2 ç‰ˆæœ¬åå¼•è¿›ï¼‰æ¥ç¼–å†™ Spark Streaming ç¨‹åº. è¿™é‡Œæ˜¯ä¸€ç¯‡å®˜æ–¹ç¼–ç¨‹æŒ‡å— ","date":"2018-07-04","objectID":"/sparkstream-related-product-selection-spark-installation-use/:4:1","tags":["BigData","Spark","Stream","æŠ€æœ¯é€‰å‹"],"title":"SparkStreamç­‰ç›¸å…³äº§å“é€‰å‹ä»¥åŠSparkå®‰è£…ä¸ç®€å•ä½¿ç”¨","uri":"/sparkstream-related-product-selection-spark-installation-use/"},{"categories":null,"content":"Spark å®‰è£… æ–¹å¼ 1 wget http://mirror.bit.edu.cn/apache/spark/spark-2.3.1/spark-2.3.1-bin-hadoop2.7.tgz tar -xzf spark-2.3.1-bin-hadoop2.7.tgz # è¿è¡Œä¸€ä¸ªä¾‹å­ cd spark-2.3.1-bin-hadoop2.7 ./bin/run-example SparkPi æ–¹å¼äºŒ æ¨èè¿™ç§æ–¹å¼è¿™é‡Œæ€»ç»“äº†è‡ªå·±æ­å»ºå„ç§å¼€å‘ç¯å¢ƒçš„å°±è‡ªåŠ¨åŒ–å®‰è£…è„šæœ¬ã€‚ç¬¬ä¸€æ¬¡å®‰è£…ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œä¹‹åå®ç°ä¸€æ¡å‘½ä»¤è‡ªåŠ¨å®‰è£…ã€‚éœ€è¦ vagrant\u0026virtualã€‚æœ‰ä¸€äº›ä¾èµ– docker git clone https://github.com/ExFly/ComputSciLab.git cd ComputSciLab vagrant up vagrant ssh cd /vagrant/Java source install-small.sh cd /vagrant/Spark ./install.sh cd /vagrant/.softwenv/spark-2.3.1-bin-hadoop2.7 ./bin/run-example SparkPi ç»“æœå›¾ï¼š spark é›†ç¾¤ æ‰¾åˆ°ä¸€ä¸ªä¸­æ–‡çš„æ–‡æ¡£,å¯ä»¥çœ‹ä¸€ä¸‹ï¼Œéƒ¨ç½²å¾ˆç®€å• æ€»ç»“ å¦‚ä¸Š ","date":"2018-07-04","objectID":"/sparkstream-related-product-selection-spark-installation-use/:4:2","tags":["BigData","Spark","Stream","æŠ€æœ¯é€‰å‹"],"title":"SparkStreamç­‰ç›¸å…³äº§å“é€‰å‹ä»¥åŠSparkå®‰è£…ä¸ç®€å•ä½¿ç”¨","uri":"/sparkstream-related-product-selection-spark-installation-use/"},{"categories":null,"content":"å•ä½“åº”ç”¨ï¼Œéœ€è¦å€ŸåŠ©åˆ†åº“åˆ†è¡¨ã€å¤åˆ¶æŠ€æœ¯ã€è¯»å†™åˆ†ç¦»æé«˜æœåŠ¡å¹¶å‘è®¿é—®é‡ã€‚å¾®æœåŠ¡ä¸ºä»£è¡¨çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå…¶é«˜å¹¶å‘å’Œå¾®æœåŠ¡äº‹åŠ¡ä¸€è‡´æ€§è¯¥å¦‚ä½•ä¿è¯ï¼Ÿ ","date":"2018-06-28","objectID":"/summary-of-theories-methods-for-consistency-of-distributed-data/:0:0","tags":["Architecture","Distributed"],"title":"åˆ†å¸ƒå¼æ•°æ®çš„ä¸€è‡´æ€§çš„ä¸€äº›ç†è®ºåŠæ–¹æ³•æ€»ç»“","uri":"/summary-of-theories-methods-for-consistency-of-distributed-data/"},{"categories":null,"content":"ç®€ä»‹ ç”±äºè‡ªå·±åˆšåˆšæ¥è§¦ï¼Œè‡ªå·±ç†è§£çš„ä¹Ÿä¸æ·±ã€‚åœ¨è¿™é‡Œï¼ŒæŠŠæˆ‘æ•´ç†çš„ä¸€äº›èµ„æ–™æ±‡æ€»ä¸‹æ¥ã€‚ ","date":"2018-06-28","objectID":"/summary-of-theories-methods-for-consistency-of-distributed-data/:1:0","tags":["Architecture","Distributed"],"title":"åˆ†å¸ƒå¼æ•°æ®çš„ä¸€è‡´æ€§çš„ä¸€äº›ç†è®ºåŠæ–¹æ³•æ€»ç»“","uri":"/summary-of-theories-methods-for-consistency-of-distributed-data/"},{"categories":null,"content":"å¾®æœåŠ¡æ¶æ„ å¾®æœåŠ¡æ¶æ„å°†å•åº”ç”¨æ”¾åœ¨å¤šä¸ªç›¸äº’ç‹¬ç«‹çš„æœåŠ¡ï¼Œè¿™ä¸ªæ¯ä¸ªæœåŠ¡èƒ½å¤ŸæŒç»­ç‹¬ç«‹çš„å¼€å‘å’Œéƒ¨ç½²ï¼Œéš¾é¢˜æ˜¯æ•°æ®è¯¥å¦‚ä½•å­˜å‚¨ï¼Ÿ ","date":"2018-06-28","objectID":"/summary-of-theories-methods-for-consistency-of-distributed-data/:2:0","tags":["Architecture","Distributed"],"title":"åˆ†å¸ƒå¼æ•°æ®çš„ä¸€è‡´æ€§çš„ä¸€äº›ç†è®ºåŠæ–¹æ³•æ€»ç»“","uri":"/summary-of-theories-methods-for-consistency-of-distributed-data/"},{"categories":null,"content":"å¤šä¸ªåº”ç”¨ä½¿ç”¨åŒä¸€æ•°æ®åº“ ä¼ ç»Ÿçš„å•ä½“åº”ç”¨ä¸€èˆ¬é‡‡ç”¨çš„æ˜¯æ•°æ®åº“æä¾›çš„äº‹åŠ¡ä¸€è‡´æ€§ï¼Œé€šè¿‡æ•°æ®åº“æä¾›çš„æäº¤ä»¥åŠå›æ»šæœºåˆ¶æ¥ä¿è¯ç›¸å…³æ“ä½œçš„ ACIDï¼Œè¿™äº›æ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚å„ä¸ªæœåŠ¡çœ‹åˆ°æ•°æ®åº“ä¸­çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼ŒåŒæ—¶æ•°æ®åº“çš„æ“ä½œä¹Ÿæ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œæœ€åæ•°æ®ä¹Ÿæ˜¯åœ¨æ•°æ®åº“ä¸­æŒä¹…å­˜å‚¨çš„ã€‚è¿™æ ·çš„æ¶æ„ä¸å…·å¤‡æ¨ªå‘æ‰©å±•èƒ½åŠ›ï¼ŒæœåŠ¡ä¹‹é—´çš„è€¦åˆç¨‹åº¦ä¹Ÿæ¯”è¾ƒé«˜ï¼Œä¼šå­˜åœ¨å•ç‚¹æ•…éšœã€‚ ","date":"2018-06-28","objectID":"/summary-of-theories-methods-for-consistency-of-distributed-data/:2:1","tags":["Architecture","Distributed"],"title":"åˆ†å¸ƒå¼æ•°æ®çš„ä¸€è‡´æ€§çš„ä¸€äº›ç†è®ºåŠæ–¹æ³•æ€»ç»“","uri":"/summary-of-theories-methods-for-consistency-of-distributed-data/"},{"categories":null,"content":"å…¸å‹å¾®æœåŠ¡æ¶æ„ åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œ æœ‰ä¸€ä¸ª database per service çš„æ¨¡å¼ï¼Œ è¿™ä¸ªæ¨¡å¼å°±æ˜¯æ¯ä¸€ä¸ªæœåŠ¡ä¸€ä¸ªæ•°æ®åº“ã€‚ è¿™æ ·å¯ä»¥ä¿è¯å¾®æœåŠ¡ç‹¬ç«‹å¼€å‘ï¼Œç‹¬ç«‹æ¼”è¿›ï¼Œç‹¬ç«‹éƒ¨ç½²ï¼Œ ç‹¬ç«‹å›¢é˜Ÿã€‚ ç”±äºä¸€ä¸ªåº”ç”¨æ˜¯ç”±ä¸€ç»„ç›¸äº’åä½œçš„å¾®æœåŠ¡æ‰€ç»„æˆï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ç”±äºå„ä¸ªæœåŠ¡è®¿é—®çš„æ•°æ®æ˜¯ç›¸äº’åˆ†ç¦»çš„ï¼Œ æœåŠ¡ä¹‹é—´ä¸èƒ½é æ•°æ®åº“æ¥ä¿è¯äº‹åŠ¡ä¸€è‡´æ€§ã€‚ è¿™å°±éœ€è¦åœ¨åº”ç”¨å±‚é¢æä¾›ä¸€ä¸ªåè°ƒæœºåˆ¶ï¼Œæ¥ä¿è¯ä¸€ç»„äº‹åŠ¡æ‰§è¡Œè¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚ ","date":"2018-06-28","objectID":"/summary-of-theories-methods-for-consistency-of-distributed-data/:2:2","tags":["Architecture","Distributed"],"title":"åˆ†å¸ƒå¼æ•°æ®çš„ä¸€è‡´æ€§çš„ä¸€äº›ç†è®ºåŠæ–¹æ³•æ€»ç»“","uri":"/summary-of-theories-methods-for-consistency-of-distributed-data/"},{"categories":null,"content":"CAP å®šå¾‹ ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰å’Œåˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰è¿™ä¸‰é¡¹ä¸­çš„ä¸¤é¡¹ã€‚ é€šè¿‡ CAP ç†è®ºï¼Œæˆ‘ä»¬çŸ¥é“æ— æ³•åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ã€å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªç‰¹æ€§ï¼Œé‚£è¦èˆå¼ƒå“ªä¸ªå‘¢ï¼Ÿ CA without Pï¼šå¦‚æœä¸è¦æ±‚ Pï¼ˆä¸å…è®¸åˆ†åŒºï¼‰ï¼Œåˆ™ Cï¼ˆå¼ºä¸€è‡´æ€§ï¼‰å’Œ Aï¼ˆå¯ç”¨æ€§ï¼‰æ˜¯å¯ä»¥ä¿è¯çš„ã€‚ä½†å…¶å®åˆ†åŒºä¸æ˜¯ä½ æƒ³ä¸æƒ³çš„é—®é¢˜ï¼Œè€Œæ˜¯å§‹ç»ˆä¼šå­˜åœ¨ï¼Œå› æ­¤ CA çš„ç³»ç»Ÿæ›´å¤šçš„æ˜¯å…è®¸åˆ†åŒºåå„å­ç³»ç»Ÿä¾ç„¶ä¿æŒ CAã€‚ CP without Aï¼šå¦‚æœä¸è¦æ±‚ Aï¼ˆå¯ç”¨ï¼‰ï¼Œç›¸å½“äºæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦åœ¨ Server ä¹‹é—´å¼ºä¸€è‡´ï¼Œè€Œ Pï¼ˆåˆ†åŒºï¼‰ä¼šå¯¼è‡´åŒæ­¥æ—¶é—´æ— é™å»¶é•¿ï¼Œå¦‚æ­¤ CP ä¹Ÿæ˜¯å¯ä»¥ä¿è¯çš„ã€‚å¾ˆå¤šä¼ ç»Ÿçš„æ•°æ®åº“åˆ†å¸ƒå¼äº‹åŠ¡éƒ½å±äºè¿™ç§æ¨¡å¼ã€‚ AP wihtout Cï¼šè¦é«˜å¯ç”¨å¹¶å…è®¸åˆ†åŒºï¼Œåˆ™éœ€æ”¾å¼ƒä¸€è‡´æ€§ã€‚ä¸€æ—¦åˆ†åŒºå‘ç”Ÿï¼ŒèŠ‚ç‚¹ä¹‹é—´å¯èƒ½ä¼šå¤±å»è”ç³»ï¼Œä¸ºäº†é«˜å¯ç”¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªèƒ½ç”¨æœ¬åœ°æ•°æ®æä¾›æœåŠ¡ï¼Œè€Œè¿™æ ·ä¼šå¯¼è‡´å…¨å±€æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚ç°åœ¨ä¼—å¤šçš„ NoSQL éƒ½å±äºæ­¤ç±»ã€‚ å¯¹äºå¤šæ•°å¤§å‹äº’è”ç½‘åº”ç”¨çš„åœºæ™¯ï¼Œä¸»æœºä¼—å¤šã€éƒ¨ç½²åˆ†æ•£ï¼Œè€Œä¸”ç°åœ¨çš„é›†ç¾¤è§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œæ‰€ä»¥èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œæ•…éšœæ˜¯å¸¸æ€ï¼Œè€Œä¸”è¦ä¿è¯æœåŠ¡å¯ç”¨æ€§è¾¾åˆ° N ä¸ª 9ï¼Œå³ä¿è¯ P å’Œ Aï¼Œèˆå¼ƒ Cï¼ˆé€€è€Œæ±‚å…¶æ¬¡ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼‰ã€‚è™½ç„¶æŸäº›åœ°æ–¹ä¼šå½±å“å®¢æˆ·ä½“éªŒï¼Œä½†æ²¡è¾¾åˆ°é€ æˆç”¨æˆ·æµç¨‹çš„ä¸¥é‡ç¨‹åº¦ã€‚ å¯¹äºæ¶‰åŠåˆ°é’±è´¢è¿™æ ·ä¸èƒ½æœ‰ä¸€ä¸è®©æ­¥çš„åœºæ™¯ï¼ŒC å¿…é¡»ä¿è¯ã€‚ç½‘ç»œå‘ç”Ÿæ•…éšœå®å¯åœæ­¢æœåŠ¡ï¼Œè¿™æ˜¯ä¿è¯ CAï¼Œèˆå¼ƒ Pã€‚è²Œä¼¼è¿™å‡ å¹´å›½å†…é“¶è¡Œä¸šå‘ç”Ÿäº†ä¸ä¸‹ 10 èµ·äº‹æ•…ï¼Œä½†å½±å“é¢ä¸å¤§ï¼ŒæŠ¥åˆ°ä¹Ÿä¸å¤šï¼Œå¹¿å¤§ç¾¤ä¼—çŸ¥é“çš„å°‘ã€‚è¿˜æœ‰ä¸€ç§æ˜¯ä¿è¯ CPï¼Œèˆå¼ƒ Aã€‚ä¾‹å¦‚ç½‘ç»œæ•…éšœäº‹åªè¯»ä¸å†™ã€‚ ","date":"2018-06-28","objectID":"/summary-of-theories-methods-for-consistency-of-distributed-data/:3:0","tags":["Architecture","Distributed"],"title":"åˆ†å¸ƒå¼æ•°æ®çš„ä¸€è‡´æ€§çš„ä¸€äº›ç†è®ºåŠæ–¹æ³•æ€»ç»“","uri":"/summary-of-theories-methods-for-consistency-of-distributed-data/"},{"categories":null,"content":"å¸¸ç”¨çš„è§£å†³æ–¹æ³• è¿™é‡Œæ€»ç»“äº†ä¸€äº›åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§çš„è§£å†³æ–¹æ³•ã€‚åˆ†å¸ƒå¼äº‹åŠ¡ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œä½†ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæ”¾å¼ƒäº†ä¸€äº›ç³»ç»Ÿæ€§èƒ½ã€‚å¦ä¸€ç§ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œæ”¾å¼ƒäº†æ—¶æ—¶æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä½†å¤„ç†æ•ˆç‡æœ€å¥½ã€‚ è¿™é‡Œæœ‰ä¸€äº›ä¾‹å­å¦‚ä½•è§£å†³çš„ã€‚ ","date":"2018-06-28","objectID":"/summary-of-theories-methods-for-consistency-of-distributed-data/:3:1","tags":["Architecture","Distributed"],"title":"åˆ†å¸ƒå¼æ•°æ®çš„ä¸€è‡´æ€§çš„ä¸€äº›ç†è®ºåŠæ–¹æ³•æ€»ç»“","uri":"/summary-of-theories-methods-for-consistency-of-distributed-data/"},{"categories":null,"content":"BASE è¿™é‡Œå®éªŒäº†ä¸€ä¸ªåŸºäº BASE åè®®çš„æœ€ç»ˆä¸€è‡´æ€§ demoã€‚æ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨åˆ°äº† Kafkaï¼Œéœ€è¦è‡ªå·±åœ¨æœ¬åœ°å¼€ Kafka æœåŠ¡ã€‚ ","date":"2018-06-28","objectID":"/summary-of-theories-methods-for-consistency-of-distributed-data/:3:2","tags":["Architecture","Distributed"],"title":"åˆ†å¸ƒå¼æ•°æ®çš„ä¸€è‡´æ€§çš„ä¸€äº›ç†è®ºåŠæ–¹æ³•æ€»ç»“","uri":"/summary-of-theories-methods-for-consistency-of-distributed-data/"},{"categories":null,"content":"å…¶ä»–èµ„æ–™ ä¹¦ï¼šå¤§è§„æ¨¡åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼šåŸç†è§£æä¸æ¶æ„å®ç° ä¹¦ï¼šå¾®æœåŠ¡è®¾è®¡ åˆ†å¸ƒå¼äº‹åŠ¡ï¼ŸNo, æœ€ç»ˆä¸€è‡´æ€§ åˆ†å¸ƒå¼äº‹åŠ¡å®è·µ -èŠ±é’±çš„ï¼Œä½œä¸ºç›®å½•ä½¿ç”¨ å¤šç ”ç©¶äº›æ¶æ„ï¼Œå°‘è°ˆäº›æ¡†æ¶ï¼ˆ3ï¼‰â€“ å¾®æœåŠ¡å’Œäº‹ä»¶é©±åŠ¨ æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆä¸€ï¼‰åˆ†å¸ƒå¼ç³»ç»Ÿäº‹åŠ¡ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆå¤§å¯¹æ¯”ï¼Œè°æœ€å¥½ä½¿ï¼Ÿ Saga åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆä¸å®è·µ è§£å†³ä¸šåŠ¡ä»£ç é‡Œçš„åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜ åˆ†å¸ƒå¼äº‹åŠ¡å®è·µ å®æˆ˜åŸºäº Kafka æ¶ˆæ¯é©±åŠ¨æœ€ç»ˆä¸€è‡´äº‹åŠ¡ï¼ˆäºŒï¼‰ ","date":"2018-06-28","objectID":"/summary-of-theories-methods-for-consistency-of-distributed-data/:3:3","tags":["Architecture","Distributed"],"title":"åˆ†å¸ƒå¼æ•°æ®çš„ä¸€è‡´æ€§çš„ä¸€äº›ç†è®ºåŠæ–¹æ³•æ€»ç»“","uri":"/summary-of-theories-methods-for-consistency-of-distributed-data/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼š 1.æ€»ç»“ gradle å’Œ maven æ­£ç¡®ä½¿ç”¨æ–¹æ³• 2.å¼€ç®±å³ç”¨ maven\u0026gradle åŒæ—¶æ”¯æŒçš„é¡¹ç›®é…ç½®ã€‚ Gradle å’Œ Maven ä½¿ç”¨èµ·æ¥éƒ½æ¯”è¾ƒæ–¹ä¾¿ï¼Œè€Œ Gradle ä½¿ç”¨æ›´çµæ´»ï¼Œé…ç½®æ›´æ–¹ä¾¿ã€‚è€Œå…¬å¸ç¯å¢ƒä¸€èˆ¬ä½¿ç”¨ Mavenã€‚å› æ­¤å°±æœ‰äº†å–èˆï¼Œæ˜¯è¿ç§»åˆ° Gradleï¼Œè¿˜æ˜¯ç»§ç»­ä½¿ç”¨ Mavenï¼Ÿå…¶å®ä¸éœ€è¦çº ç»“ï¼Œè°è¯´å¿…é¡»å–èˆçš„ï¼Œä¸¤ä¸ªéƒ½ç”¨èµ·æ¥å°±æ˜¯äº†ï¼ï¼ï¼ è¯´åœ¨å‰é¢ Gradle å’Œ Maven éƒ½æ˜¯é¡¹ç›®è‡ªåŠ¨æ„å»ºå·¥å…·ï¼Œç¼–è¯‘æºä»£ç åªæ˜¯æ•´ä¸ªè¿‡ç¨‹çš„ä¸€ä¸ªæ–¹é¢ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œä½ è¦æŠŠä½ çš„è½¯ä»¶å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒä¸­æ¥äº§ç”Ÿå•†ä¸šä»·å€¼ï¼Œæ‰€ä»¥ï¼Œä½ è¦è¿è¡Œæµ‹è¯•ï¼Œæ„å»ºåˆ†å¸ƒã€åˆ†æä»£ç è´¨é‡ã€ç”šè‡³ä¸ºä¸åŒç›®æ ‡ç¯å¢ƒæä¾›ä¸åŒç‰ˆæœ¬ï¼Œç„¶åéƒ¨ç½²ã€‚æ•´ä¸ªè¿‡ç¨‹è¿›è¡Œè‡ªåŠ¨åŒ–æ“ä½œæ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ æ•´ä¸ªè¿‡ç¨‹å¯ä»¥åˆ†æˆä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š ç¼–è¯‘æºä»£ç  è¿è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯• æ‰§è¡Œé™æ€ä»£ç åˆ†æã€ç”Ÿæˆåˆ†ææŠ¥å‘Š åˆ›å»ºå‘å¸ƒç‰ˆæœ¬ éƒ¨ç½²åˆ°ç›®æ ‡ç¯å¢ƒ éƒ¨ç½²ä¼ é€’è¿‡ç¨‹ æ‰§è¡Œå†’çƒŸæµ‹è¯•å’Œè‡ªåŠ¨åŠŸèƒ½æµ‹è¯• ä¸¤è€…éƒ½æ˜¯é¡¹ç›®å·¥å…·ï¼Œä½†æ˜¯ maven ä½¿ç”¨çš„æœ€å¤šï¼ŒGradle æ˜¯åèµ·ä¹‹ç§€ï¼Œæƒ³ spring ç­‰éƒ½æ˜¯ä½¿ç”¨ gradle æ„å»ºçš„ã€‚Gradle æŠ›å¼ƒäº† Maven çš„åŸºäº XML çš„ç¹çé…ç½®ï¼Œé‡‡ç”¨äº†é¢†åŸŸç‰¹å®šè¯­è¨€ Groovy çš„é…ç½®ï¼Œå¤§å¤§ç®€åŒ–äº†æ„å»ºä»£ç çš„è¡Œæ•°ã€‚ æ¯”å¦‚ maven è¦ è¿™ä¹ˆå†™ \u003cdependency\u003e \u003cgroupId\u003eorg.springframework\u003c/groupId\u003e \u003cartifactId\u003espring-core\u003c/artifactId\u003e \u003cversion\u003e${spring.version}\u003c/version\u003e \u003c/dependency\u003e gradle è¿™ä¹ˆå†™ compile('org.springframework:spring-core:2.5.6') è¯¦ç»†çš„ Gradle å’Œ Maven æ¯”è¾ƒçœ‹è¿™é‡Œè®²çš„å¾ˆå¥½äº†ã€‚gradle å®˜æ–¹ä¹Ÿå¯¹ä¸¤ä¸ªå·¥å…·è¿›è¡Œäº†æ¯”è¾ƒã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªï¼Œæˆ–è€…ä¸¤ä¸ªä¸€èµ·ä½¿ç”¨ï¼ï¼ï¼è¿™æ˜¯å¯è¡Œçš„ï¼Œå½“ç„¶å‰ææ˜¯ï¼Œæœ‰ä¸€ä¸ªäººåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ç»´æŠ¤ç›¸åŒåŠŸèƒ½çš„ä¸¤ä»½é…ç½®ã€‚å®é™…ä¸Šå¹¶ä¸éš¾ã€‚æŠ½ä¸€ä¸ªå‘¨æœ«ç©ºä½™æ—¶é—´ï¼Œè‡ªå·±æŠŠè¿™ä¸¤ä¸ªéƒ½ç†Ÿæ‚‰äº†ä¸€ä¸‹ï¼Œæ•´ç†äº†ä¸€å¥— Gradle\u0026Maven æ—¥å¸¸å¼€å‘ä¸­å¸¸ç”¨çš„åŒ…å’Œæ’ä»¶çš„é›†åˆï¼Œä½œä¸ºé¡¹ç›®çš„å¼€å§‹ã€‚æ¯”è¾ƒé€šç”¨ï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®å…¬å¸æˆ–ä¸ªäººé¡¹ç›®å®é™…æƒ…å†µåŠ å…¥ç§æœçš„é…ç½®ï¼Œä»¥åŠä½ æƒ³ä½¿ç”¨çš„jar åŒ…ï¼Œå¦‚æ­¤ç®€å•ã€‚å¦‚æœä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œè¯·è”ç³»æˆ‘ã€‚åˆ«å¿˜äº†ï¼Œå¸®æˆ‘ star ä¸€ä¸‹ã€‚ æ¥ä¸‹æ¥æ¶‰åŠåˆ°çš„å†…å®¹ï¼š maven æ­£ç¡®ä½¿ç”¨æ–¹æ³• gradle æ­£ç¡®ä½¿ç”¨æ–¹æ³• gradle é¡¹ç›®å’Œ maven é¡¹ç›®ç›¸äº’è½¬åŒ– ä¸€ä¸ªé¡¹ç›®åŒæ—¶æ”¯æŒ maven å’Œ gradle é…ç½®ï¼šä¸€ä¸ªå¥½çš„å¼€å§‹ maven æ­£ç¡®ä½¿ç”¨æ–¹æ³• ","date":"2018-06-24","objectID":"/gradle_maven-introduce/:0:0","tags":["Java"],"title":"Gradleå’ŒMavenä½¿ç”¨æ–¹æ³•æ€»ç»“","uri":"/gradle_maven-introduce/"},{"categories":null,"content":"maven ç‰ˆæœ¬ä¸ç›¸åŒé—®é¢˜ æˆ‘ä»¬å¤§éƒ¨åˆ†æ—¶å€™ä½¿ç”¨ IDE è¿›è¡Œé¡¹ç›®å¼€å‘çš„æ—¶å€™ï¼Œå¤§éƒ¨åˆ†æ—¶å€™ä¼šç›´æ¥ä½¿ç”¨ IDE åˆ›å»º MAVEN é¡¹ç›®ï¼Œè¿™æ˜¯æ­£ç¡®çš„ã€‚å¯æ˜¯ï¼Œæ‚¨æœ‰æ²¡æœ‰å‘ç°ï¼Œå¤§å®¶åˆä½œçš„æ—¶å€™ï¼Œç”±äº maven ç‰ˆæœ¬ä¸ç›¸åŒï¼Œå“ªæ€•æ˜¯ 3.5.1 å’Œ 3.5.2 çš„åŒºåˆ«ï¼Œéƒ½ä¼šå¼•å‘ä¸€åœºè¡€æ¡ˆï¼æˆ‘çš„å¯ä»¥æ­£å¸¸æ‰“å¼€é¡¹ç›®ï¼Œè€Œå…¶ä»–äººå´ä¼šå‡ºç°é—®é¢˜ã€‚é™¤äº† IDE ä¸‹è½½åŒ…æŸåå¤–ï¼Œå°±æ˜¯ maven çš„ç‰ˆæœ¬ä¸ç›¸åŒã€‚å…¶å®é€šè¿‡ä¸€äº›å·¥å…·ï¼Œå·²ç»å¯ä»¥è®©è¿™ç§æƒ…å†µä¸åœ¨å‘ç”Ÿï¼Œé‚£å°±æ˜¯Wrapperã€‚è¯·çœ‹å¦‚ä¸‹å›¾(å›¾æ²¡é…é”™ï¼Œmaven çš„ wrapper å’Œ gradle çš„ wrapper æµç¨‹ä¸Šå®Œå…¨ç›¸åŒ) å‰ææ¡ä»¶ï¼š é¡¹ç›®åˆ›å»ºè€…ç³»ç»Ÿä¸­å·²ç»ç”± maven çš„å‘½ä»¤ å…¶ä»–äººæ²¡æœ‰è¦æ±‚ï¼Œmvn å¯æœ‰å¯æ— ï¼ˆåŸå› ä¹‹åè¯´ï¼‰ å…·ä½“å¦‚ä½•åšï¼š é¡¹ç›®åˆ›å»ºè€…æ‰§è¡Œ mvn -N io.takari:maven:wrapper -Dmaven=3.5.3 æ­¤æ—¶ï¼Œé¡¹ç›®ç›®å½•ä¼šç”Ÿæˆmvnw.cmdå’Œmvnwï¼Œä¹‹åçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸºäºæ­¤ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé¡¹ç›®å¼€å‘è€…ä¸éœ€è¦ç”±ä»»ä½•ä¾èµ–ï¼Œé™¤äº† jdk-_!!! é¡¹ç›®åˆ›å»ºè€…æ‰§è¡Œ mvnw archetype:generate æ­¤æ­¥æ˜¯è‡ªåŠ¨ç”Ÿæˆé¡¹ç›®ç›®å½•ç»“æ„ã€‚åŒæ—¶ï¼Œé¡¹ç›®ç®¡ç†è€…éœ€è¦æ­å»ºå¥½åŸºç¡€çš„ä»£ç æ¡†æ¶ã€‚ä¹‹åå¯ä»¥å¼€å‘äº† é¡¹ç›®å¼€å‘è€… mvnw.cmd compiler:compile mvnw.cmd exec:java -Dexec.mainClass=\"org.exfly.LombokL.LombokLApplication\" -q mvn.cmd clean mvn.cmd test ã€‚ã€‚ã€‚ æ³¨æ„: å½“ç¬¬ä¸€æ¬¡æ‰§è¡Œmvnw.cmdæ—¶å€™ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ Mavenï¼Œmaven çš„$HOME/.m2/wrapper/dists/\u003cversion\u003e/ä¸‹ã€‚ åˆç½‘ç»œé—®é¢˜ï¼Œå¦‚æœå‡ºç°é”™è¯¯ï¼Œä¾èµ–åŒ…å·²ç»ä¸‹å¥½ï¼Œåªéœ€è¦åˆ°1æ‰€è¯´çš„ä½ç½®å»æ‰åç¼€.packï¼Œé‡æ–°è¿è¡Œå³å¯ã€‚ ","date":"2018-06-24","objectID":"/gradle_maven-introduce/:1:0","tags":["Java"],"title":"Gradleå’ŒMavenä½¿ç”¨æ–¹æ³•æ€»ç»“","uri":"/gradle_maven-introduce/"},{"categories":null,"content":"ä½¿ç”¨dependencyManagementé›†ä¸­ç®¡ç†ç‰ˆæœ¬ä¾èµ– dependencyManagementè¿™é‡Œå·²ç»å¾ˆå¥½çš„è§£é‡Šå¦‚ä½•åšã€‚åŒæ—¶å¯ä»¥å€Ÿé‰´ springboot-parent ","date":"2018-06-24","objectID":"/gradle_maven-introduce/:2:0","tags":["Java"],"title":"Gradleå’ŒMavenä½¿ç”¨æ–¹æ³•æ€»ç»“","uri":"/gradle_maven-introduce/"},{"categories":null,"content":"å¤šæ¨¡å—é¡¹ç›®ç®¡ç†æ–¹æ³• å¤šæ¨¡å—é¡¹ç›®çš„ POM é‡æ„ é€šè¿‡ parent çš„æ–¹å¼ï¼Œå°†å¤šæ¨¡å—ä¾èµ–é›†ä¸­ç®¡ç†ï¼Œ ","date":"2018-06-24","objectID":"/gradle_maven-introduce/:3:0","tags":["Java"],"title":"Gradleå’ŒMavenä½¿ç”¨æ–¹æ³•æ€»ç»“","uri":"/gradle_maven-introduce/"},{"categories":null,"content":"å¦‚ä½•æ›´å¥½çš„ä½¿ç”¨ maven è¿›è¡Œé¡¹ç›®ç®¡ç† å‡ ç‚¹å»ºè®® å°½é‡ä½¿ç”¨ wapper å¤š ä½¿ç”¨dependencyManagementé›†ä¸­ç®¡ç†ç‰ˆæœ¬ä¾èµ– bin ä¸‹æœ‰ mvn å’Œ mvnDebug(è¿è¡Œ mvn æ—¶å¼€å§‹ debug) M2_HOME maven ä¸»ç¨‹åºçš„å®‰è£…ç›®å½• ~/.m2 æœ¬åœ°åŒ…ä¸‹è½½ä½ç½® http ä»£ç† setting.xml ä¸­çš„ proxies MAVEN_OPTS è¿è¡Œ mvn æ—¶å€™ç›¸å½“äºè¿è¡Œ java å‘½ä»¤ï¼ŒMAVEN_OPTS å¯ä»¥é…ç½®ä¸ºä»»ä½• java çš„å‘½ä»¤å‚æ•° è®¾ç½® MAVEN_OPTS ç¯å¢ƒå˜é‡ é…ç½®ç”¨æˆ·èŒƒå›´ settings.xml %M2_HOME%/conf/settings.xml ä¸ºå…¨å±€é…ç½®æ–‡ä»¶ ~/.m2/settings.xml ä¸ºç”¨æˆ·é…ç½®æ–‡ä»¶ ä¸è¦ä½¿ç”¨ IDE å†…åµŒçš„ Mavenï¼Œåº”è¯¥é…ç½® IDE ä¸­ä¸ºè‡ªå·±å®‰è£…çš„ maven æ˜¾ç¤ºå£°æ˜æ‰€æœ‰ç”¨åˆ°çš„ä¾èµ– ","date":"2018-06-24","objectID":"/gradle_maven-introduce/:4:0","tags":["Java"],"title":"Gradleå’ŒMavenä½¿ç”¨æ–¹æ³•æ€»ç»“","uri":"/gradle_maven-introduce/"},{"categories":null,"content":"æˆ‘çš„ maven å¸¸ç”¨å‘½ä»¤ç¬”è®° æˆ‘çš„ maven å¸¸ç”¨å‘½ä»¤ç¬”è®° gradle æ­£ç¡®ä½¿ç”¨æ–¹æ³• ç†ç”±åŒä¸ŠèŠ‚ï¼Œç›´æ¥è¯´ä½¿ç”¨æ–¹æ³•ã€‚å¯ä»¥å¯¹ç…§æˆ‘çš„ç¬”è®°æŸ¥çœ‹ã€‚ gradle init â€“type java-library è¿™é‡Œè‡ªåŠ¨ç”Ÿæˆ gradlewï¼Œå¹¶åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„ ä¹‹åæ‰€æœ‰å‘½ä»¤ä½¿ç”¨ gradlew å³å¯ gradle é¡¹ç›®å’Œ maven é¡¹ç›®ç›¸äº’è½¬åŒ– gradle å’Œ maven å¯ä»¥ç›¸äº’è½¬åŒ–ï¼Œæ„å‘³ç€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ gradle ä¸ºä¸»çš„å¼€å‘ï¼Œä¹‹åå¯¼å‡ºä¸º maven é¡¹ç›®ï¼Œä¾›ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚å‰æï¼Œä½ è¶³å¤Ÿäº†è§£ gradle å’Œ mavenã€‚ ","date":"2018-06-24","objectID":"/gradle_maven-introduce/:5:0","tags":["Java"],"title":"Gradleå’ŒMavenä½¿ç”¨æ–¹æ³•æ€»ç»“","uri":"/gradle_maven-introduce/"},{"categories":null,"content":"maven -\u003e gradle cd /path/to/mavenproject gradle init gradle wrapper ","date":"2018-06-24","objectID":"/gradle_maven-introduce/:6:0","tags":["Java"],"title":"Gradleå’ŒMavenä½¿ç”¨æ–¹æ³•æ€»ç»“","uri":"/gradle_maven-introduce/"},{"categories":null,"content":"gradle -\u003e maven cd /path/to/gradleproject gradlew install å°†é¡¹ç›®è½¬æ¢ä¸º maven å’Œ gradle é¡¹ç›®åï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š ä¹‹åï¼Œæˆ‘ä»¬ä¹ æƒ¯ä½¿ç”¨ mavnw æˆ–è€… gradlewï¼Œéƒ½å¯ä»¥ã€‚å¦‚æ­¤ï¼Œåšåˆ°äº†å…±å­˜ã€‚ ä¸€ä¸ªé¡¹ç›®åŒæ—¶æ”¯æŒ maven å’Œ gradle é…ç½®ï¼šä¸€ä¸ªå¥½çš„å¼€å§‹ æŠ½æ—¶é—´ï¼Œåšäº†å¸¸ç”¨ jar åŒ…å’Œæ’ä»¶æ•´åˆåŒ…ï¼Œä¸€ä¸ªé¡¹ç›®åŒæ—¶æ”¯æŒ maven å’Œ gradleã€‚ å…±åŒçš„ä¾èµ–ï¼š å†…å®¹åŒ…æ‹¬ï¼š æ—¥å¿—ã€é€šç”¨å·¥å…·åº“ã€å•å…ƒæµ‹è¯•ã€ä»£ç è´¨é‡åº¦é‡ã€æ–‡æ¡£ç”Ÿæˆç­‰ jar: slf4jã€logbackã€lombokã€guavaã€junitã€mockito é…ç½®ä¸­æ•´åˆçš„å·¥å…·ï¼š ä»£ç è´¨é‡åˆ†ææŠ¥å‘Šå·¥å…·ï¼špmdã€findbugsã€checkstyleã€jdepend å•å…ƒæµ‹è¯•æŠ¥å‘Šå·¥å…·ã€javadocã€ä¾èµ–ç®¡ç†ã€é¡¹ç›®ä¿¡æ¯æ±‡æ€»ç­‰å¯è§†åŒ–ä¿¡æ¯ maven å…·ä½“å†…å®¹ maven-compiler-pluginã€maven-javadoc-pluginã€cobertura-maven-pluginã€maven-checkstyle-pluginã€findbugs-maven-pluginã€maven-pmd-pluginã€jdepend-maven-pluginã€maven-jar-pluginã€maven-surefire-pluginã€maven-surefire-report-plugin gradle å…·ä½“å†…å®¹ javaã€mavenã€checkstyleã€pmdã€findbugsã€jdependã€eclipseã€ideaã€javadoc é¦–å…ˆ maven é…ç½®è§æ­¤æ–‡ä»¶ å…¶æ¬¡ gradle é…ç½®è§æ­¤æ–‡ä»¶ èµ„æ–™æ±‡æ€» å®Œæ•´çš„æ•´åˆé¡¹ç›®ï¼Œæ”¯æŒ maven å’Œ gradleï¼Œç‚¹æˆ‘ä¸‹è½½ æˆ‘çš„ Gradle ç¬”è®°ï¼Œç‚¹æˆ‘æŸ¥çœ‹ æˆ‘çš„ maven ç¬”è®°ï¼Œç‚¹æˆ‘æŸ¥çœ‹ ","date":"2018-06-24","objectID":"/gradle_maven-introduce/:7:0","tags":["Java"],"title":"Gradleå’ŒMavenä½¿ç”¨æ–¹æ³•æ€»ç»“","uri":"/gradle_maven-introduce/"},{"categories":null,"content":"å¦‚æœä½ æ­£åœ¨å­¦ Lua ä¸ openrestyï¼Œé‚£ä½ å°±ä¸€å®šçŸ¥é“åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè°ƒè¯•ä»£ç ã€å•å…ƒæµ‹è¯•æ˜¯å¤šä¹ˆçš„éº»çƒ¦ã€‚è¿™é‡Œæ•´ç†äº†ä¸€äº› lua å¼€å‘çš„æœ€ä½³å®è·µã€‚ ç®€ä»‹ openresty ä¸­ lua ide è°ƒè¯•ï¼Œå•å…ƒæµ‹è¯•æ¯”è¾ƒéº»çƒ¦ï¼›lua å¯¹åº“çš„ç®¡ç†æ¯”è¾ƒæ•£æ¼«ã€‚åœ¨å…¬å¸ç”Ÿäº§ç¯å¢ƒï¼Œä¸€èˆ¬æ²¡æœ‰å¤–ç½‘ç¯å¢ƒï¼ŒOpenResty çš„å®‰è£…å’Œ lua é¡¹ç›®çš„éƒ¨ç½²éƒ½æ¯”è¾ƒéº»çƒ¦ã€‚ ç»“åˆ Python çš„ä¸€äº›ç»éªŒï¼Œåœ¨è¿™é‡Œæ•´ç†ä¸€ä¸‹è‡ªå·±å¯¹ Lua çš„ç†è§£ï¼Œä»¥åŠ Lua æœ€ä½³å®è·µã€‚ OpenResty å®‰è£… å¯¹äºè½¯ä»¶ï¼Œä½¿ç”¨ç¼–è¯‘æ–¹å¼å®‰è£…æ¯”è¾ƒå¥½ï¼Œæ¯”å¦‚ Ubuntuï¼Œapt-get å®‰è£…çš„åŒ…ä¸€èˆ¬éƒ½ä¼šæ¯”è¾ƒæ—§ã€‚å¦‚ä¸‹ä»‹ç»æˆ‘çš„ç¼–è¯‘å‚æ•°ã€‚è¿™é‡Œéœ€è¦è‡ªå·±ä¸‹è½½è‡ªå·±çš„ä¾èµ–åŒ…ï¼šnaxsi, nginx-goodies-nginx-sticky-module-ngï¼Œpcreï¼Œopensslï¼Œzlibï¼Œå¹¶æ ¹æ®æˆ‘çš„é…ç½®è¿›è¡Œä¿®æ”¹ç›¸åº”å‚æ•° ./configure --prefix=$HOME/openresty \\ --add-module=$HOME/openresty/setupfile/third/naxsi-0.55.3/naxsi_src \\ --add-module=$HOME/openresty/setupfile/third/nginx-goodies-nginx-sticky-module-ng \\ --with-pcre=$HOME/openresty/setupfile/depency/pcre-8.41 \\ --with-openssl=$HOME/openresty/setupfile/depency/openssl-1.0.2k \\ --with-zlib=$HOME/openresty/setupfile/depency/zlib-1.2.11 \\ --with-http_v2_module \\ --with-http_sub_module \\ --with-http_stub_status_module \\ --with-http_realip_module \\ --with-cc-opt=-O2 \\ --with-luajit è¿™é‡Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ nginx çš„ç¬”è®°ï¼Œå¯ä»¥è¿‡ä¸€é æˆ‘åœ¨å­¦ä¹ çš„æ—¶å€™ï¼Œçœ‹äº†è¿™æœ¬ä¹¦æ·±å…¥ç†è§£ Nginx æ¨¡å—å¼€å‘ä¸æ¶æ„è§£æ,æ¯•ç«Ÿè®²çš„æ¯”è¾ƒç³»ç»Ÿï¼Œå¯ä»¥å€Ÿé‰´ä¸€ä¸‹ æœ‰é—®é¢˜ï¼ŒçŸ¥ä¹ï¼Œæœç´¢å¼•æ“ ","date":"2018-06-12","objectID":"/openresty-best-practice/:0:0","tags":["Lua","OpenResty"],"title":"OpenRestyæœ€ä½³å®è·µ","uri":"/openresty-best-practice/"},{"categories":null,"content":"å®‰è£… luarocks ä¸‹è½½åœ°å€ http://luarocks.github.io/luarocks/releases/ ç¼–è¯‘å®‰è£… ./configure --prefix=$HOME/openresty/luajit \\ --with-lua=$HOME/openresty/luajit \\ --lua-suffix=jit \\ --with-lua-include=$HOME/openresty/luajit/include/luajit-2.1 --prefix è®¾å®š luarocks çš„å®‰è£…ç›®å½• --with-lua åˆ™æ˜¯ç³»ç»Ÿä¸­å®‰è£…çš„ lua çš„æ ¹ç›®å½• --lua-suffix ç‰ˆæœ¬åç¼€ï¼Œæ­¤å¤„å› ä¸ºopenresytçš„luaè§£é‡Šå™¨ä½¿ç”¨çš„æ˜¯ luajit ,æ‰€ä»¥æ­¤å¤„å¾—å†™ jit --with-lua-include è®¾ç½® lua å¼•å…¥ä¸€äº›å¤´æ–‡ä»¶å¤´æ–‡ä»¶çš„ç›®å½• make build \u0026\u0026 make install lua é¢å‘å¯¹è±¡ lua å€ŸåŠ© table ä»¥åŠ metatable çš„æ¦‚å¿µè¿›è¡Œ oo çš„ã€‚è¿™é‡Œæ‘˜äº†ä¸€ä¸ªåšå®¢çš„ä»£ç ï¼Œçœ‹èµ·æ¥è¿˜å¯ä»¥ã€‚ä»¥åå¯ä»¥ä½¿ç”¨è¿™ä¸ªã€‚Lua ä¸­å®ç°é¢å‘å¯¹è±¡ã€‚ è¿™é‡Œè¦è¯´ä¸€ä¸‹ lua ä¸­.è¿ç®—å’Œ:çš„åŒºåˆ«ï¼Œa={};a.fun(a, arg) ç­‰ä»·äº a:fun(arg)ï¼Œå…¶å®å°±æ˜¯:å¯ä»¥çœç•¥ self å‚æ•°ã€‚ local _class={} function class(super) local class_type={} class_type.ctor=false class_type.super=super class_type.new=function(...) local obj={} do local create create = function(c,...) if c.super then create(c.super,...) end if c.ctor then c.ctor(obj,...) end end create(class_type,...) end setmetatable(obj,{ __index=_class[class_type] }) return obj end local vtbl={} _class[class_type]=vtbl setmetatable(class_type,{__newindex= function(t,k,v) vtbl[k]=v end }) if super then setmetatable(vtbl,{__index= function(t,k) local ret=_class[super][k] vtbl[k]=ret return ret end }) end return class_type end åŸºæœ¬ç¼–ç è§„èŒƒ è®¾è®¡ å¯ä»¥å‚è€ƒ OpenResty çš„æœ€ä½³å®è·µï¼Œå¹³æ—¶ç”¨èµ·æ¥ï¼Œå¤§éƒ¨åˆ†è·Ÿ c çš„é£æ ¼å·®ä¸å¤šå§ã€‚ä¸»è¦æ˜¯æ‰€ä½¿ç”¨çš„ä»£ç é£æ ¼è¦ç»Ÿä¸€ã€‚ åŒ…ç®¡ç† lua ä¸‹æœ‰ä¸¤ä¸ªåŒ…ç®¡ç†ç³»ç»Ÿï¼ŒLuaDist å’Œ LuaRocks å•å…ƒæµ‹è¯• é‡ç‚¹ å¦‚ä¸‹æ–¹æ³•è¯·åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ç±»ä¼¼curl localhost/unittestè¿›è¡Œæµ‹è¯•ï¼Œæµè§ˆå™¨ä¸­çœ‹ä¼šå¾ˆç—›è‹¦ OpenResty æœ€ä½³å®è·µ-å•å…ƒæµ‹è¯•ç»™å‡ºä¸€ç§æ–¹æ³•ã€‚æˆ‘çš„å¤„ç†æ–¹æ³•æ˜¯ï¼Œåœ¨ nginx.conf ä¸­çš„ server ä¸­å»ºä¸€ä¸ªå•ç‹¬çš„ locationï¼Œcontent_by_lua_file è®¾ç½® unittest.luaã€‚å…¬å¸ç”¨çš„ verynginxï¼Œæ‰€ä»¥æˆ‘æŠŠæ­¤é…ç½®æ”¾åˆ°äº† router.lua ä¸­(å½“ç„¶é…ç½®æ–¹æ³•ç±»ä¼¼ï¼Œè¿™ä¸ªå¾ˆå®¹æ˜“ç ”ç©¶ï¼Œå°±ä¸æ”¾åˆ°è¿™é‡Œäº†)ã€‚ -- file: unittest.lua local _M = {} local csrf_test = require(\"test.test_csrf\") local tmp_test = require(\"test.tmp_test\") function _M:run_unittest() csrf_test:run() end return _M -- file: test_csrf.lua local iresty_test = require(\"resty.iresty_test\") local json = require(\"json\") local config = require(\"config\") local csrf_config = require(\"csrf_config\") local token = require(\"token\") local tabletls = require(\"tabletls\") local tb = iresty_test.new({unit_name=\"test_csrf\"}) local function assert_eq(wanted, real, msg) if wanted ~= real then error(msg or \"error\", 2) -- è¯·æ³¨æ„å‚æ•° 2 end end local function assert_not_eq(wanted, real, msg) if wanted == real then error(msg or \"error\", 2) end end function tb:test_geturl() assert_eq(\"/unittest\", ngx.var.uri, \"the unittest url changed\") end function tb:run_unittest() tb:run() end return tb å¦‚ä¸Šæœ‰ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„åœ°æ–¹ï¼Œerror(msg or \"error\", 2),å…¶ä¸­çš„ 2 æœ‰äº›è®²ç©¶ï¼Œè¡¨ç¤ºè¿”å›è°ƒç”¨å‡½æ•°æ‰€åœ¨è¡Œï¼Œè¿˜æœ‰ 0ï¼ˆå¿½ç•¥è¡Œå·ï¼‰ï¼Œ1ï¼ˆerror è°ƒç”¨ä½ç½®è¡Œå·ï¼‰ æ€§èƒ½æµ‹è¯• ä»£ç è¦†ç›–ç‡ API æµ‹è¯•ç­‰ï¼Œéƒ½å¯ä»¥å»OpenResty æœ€ä½³å®è·µä¸­æ‰¾ï¼Œé…ç½®å¾ˆç®€å•ã€‚ è¿œç¨‹è°ƒè¯• OpenResty å¯¹äºæ­¤éƒ¨åˆ†ï¼Œå¯¹äºæœ‰äº›äººæ¥è¯´ï¼Œä½¿ç”¨æ—¥å¿—å°±å·²ç»è¶³å¤Ÿäº†ã€‚å¯å¯¹äºæœ‰äº›æ—¶å€™ï¼Œåœ¨ä»£ç ä¸­å¤ªå¤šçš„æ—¥å¿—æœ‰ä¸åˆ©äºç»´æŠ¤ã€‚è¿™é‡Œè‡ªå·±è¦å°½åŠ›åšå¥½æ—¥å¿—å’Œè°ƒè¯•çš„å¹³è¡¡å§ã€‚ æ­¤è°ƒè¯•æ–¹æ³•é€‚ç”¨äº win linux osx å…ˆè´´è¿™é‡Œç”¨åˆ°çš„ luaIDE åœ°å€ï¼šZeroBraneStudio å¦‚ä¸‹ä¸ºå®‰è£…æ­¥éª¤ï¼š ä¸‹è½½è¿™ä¸ªé¡¹ç›®ï¼ŒZeroBraneStudioï¼Œè§£å‹å¯ä»¥ç›´æ¥ç”¨ã€è°ƒè¯•æ–¹æ³•åœ¨ä¸‹è½½å¥½çš„æ–‡ä»¶ä¸­ README.md ä¸­æœ‰ç›¸åº”çš„é“¾æ¥ã€‘ å¯åŠ¨ ZBSï¼ŒProject -\u003e Start Debugger Server å¤åˆ¶/lualibs/mobdebug/mobdebug.lua -\u003e nginx lua path, å¤åˆ¶/lualibs/socket.lua -\u003e nginx lua pathï¼Œ å¤åˆ¶/bin/clibs/socket/core -\u003e socket è®¾ä¸º nginx lua cpathï¼ˆè°ƒè¯•æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯ require(â€œsocket.coreâ€)å½¢å¼å¯¼å…¥åŒ…ã€‚è¿™é‡Œéœ€è¦æ³¨æ„ core æ–‡ä»¶åç¼€ï¼Œwin æ˜¯ dllï¼Œlinux æ˜¯ soï¼Œï¼‰ nginx é…ç½®å¥½,å°†å¦‚ä¸Šä¾èµ–åŠ åˆ° nginx.conf ä¸­ï¼Œè®© lua å¯ä»¥æ‰¾åˆ°è¿™äº›æ–‡ä»¶å³å¯ åˆ›å»ºéœ€è¦è°ƒè¯•çš„ lua æ–‡ä»¶ require('mobdebug').start('192.168.1.22') local name = ngx.var.arg_name or \"Anonymous\" ngx.say(\"Hello, \", name, \"!\") ngx.say(\"Done debugging.\") require('mobdebug').done() æ³¨ï¼šstart()å‘¼å«éœ€è¦è¿è¡Œ IDE çš„è®¡ç®—æœºçš„ IP ã€‚é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨â€œlocalhostâ€ï¼Œä½†æ˜¯ç”±äºæ‚¨çš„ nginx å®ä¾‹æ­£åœ¨è¿è¡Œï¼Œå› æ­¤æ‚¨éœ€è¦æŒ‡å®šè¿è¡Œ IDE çš„è®¡ç®—æœºçš„ IP åœ°å€ï¼ˆåœ¨æˆ‘çš„ä¾‹å­ä¸­ 192.168.1.22ï¼‰ åœ¨ ide ä¸­æ‰“å¼€éœ€è¦è°ƒè¯•çš„å¦‚ä¸Š lua æ–‡ä»¶ Project -\u003e Project Directory -\u003e Set From Current Fileã€‚ æ­¤æ—¶ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®éœ€è¦æ­¤æ–‡ä»¶å¤„ç†çš„é“¾æ¥ æ­¤æ—¶å¼€å§‹è°ƒè¯• æ³¨ï¼šåœ¨æœ€ä¸‹ä¾§æœ‰ Remote consoleï¼Œåœ¨è¿™é‡Œå¯ä»¥æ‰§è¡Œä»»ä½• ngx lua è¯­å¥ å¦‚ä¸Šæµç¨‹æ²¡æœ‰æˆªå›¾ï¼Œæˆ–è€…æ²¡æœ‰è¯´æ¸…æ¥šï¼Œå¯ä»¥æ¥è¿™é‡Œ nginx ä¸€äº›æŠ€å·§ çœ‹æˆ‘é…ç½®çš„ nginx.conf lua_package_path '$prefix/lua_script/?.lua;;'; æˆ‘çš„ç¬”è®° èµ„æ–™ ç« äº¦æ˜¥ OpenResty OpenResty æœ€ä½³å®è·µ Lua 5.1 å‚è€ƒæ‰‹å†Œ Lua 5.3 å‚è€ƒæ‰‹å†Œ äº‘é£ github awesome-lua awesome-resty Nginx-Lua-OpenResty-ResourcesA collection of resources covering Nginx, Nginx + Lua, OpenResty and Tengine ","date":"2018-06-12","objectID":"/openresty-best-practice/:1:0","tags":["Lua","OpenResty"],"title":"OpenRestyæœ€ä½³å®è·µ","uri":"/openresty-best-practice/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šspring ä¸­ bean çš„è£…é…æœ‰ä¸€å®šè§„åˆ™ï¼Œåœ¨è¿™é‡Œè¿›è¡Œæ€»ç»“ã€‚æœ¬æ–‡ä¸»è¦è®²è§£ä¸€äº›æ¦‚å¿µå’Œ java é…ç½®æ–¹æ³•ã€‚demo ä»£ç è§æ–‡æœ«ã€‚ ç›®å½• æ‰‹åŠ¨è£…é… ä½¿ç”¨@Bean è‡ªåŠ¨è£…é… ä½¿ç”¨@ComponentScan è‡ªåŠ¨è£…é…çš„æ­§ä¹‰æ€§ æ¡ä»¶ç”Ÿæ•ˆ Bean profile bean ä½œç”¨åŸŸ ","date":"2018-05-20","objectID":"/sprint-beans-waire-notebook/:0:0","tags":["Spring","SSM"],"title":"Spring Beansçš„è£…é…è§„åˆ™æ€»ç»“","uri":"/sprint-beans-waire-notebook/"},{"categories":null,"content":"æ‰‹åŠ¨è£…é… æ‰‹åŠ¨è£…é…å¯ä»¥é€šè¿‡å£°æ˜ xml æ–‡ä»¶å’Œ java é…ç½®æ–‡ä»¶ä¸¤ç§æ‰‹æ®µã€‚åœ¨è¿™ä¸¤ç§æ–¹å¼ä¸­ï¼Œæ›´åŠ æ¨èä½¿ç”¨ java é…ç½®çš„æ–¹å¼ã€‚ä¸¤ç§é…ç½®ä¸æ˜¯ç›¸äº’æ›¿ä»£çš„å…³ç³»ï¼Œä¸€èˆ¬å°†ä¸šåŠ¡ç›¸å…³çš„é…ç½®æ”¾åˆ° java é…ç½®ä¸­ï¼Œå¯¹äºéä¸šåŠ¡ï¼Œå¦‚æ•°æ®åº“ç­‰ï¼Œå¯ä»¥æ”¾åˆ° xml ä¸­ã€‚ é€šè¿‡ä½¿ç”¨@Bean æ³¨è§£æ–¹æ³•ï¼Œå¯ä»¥å£°æ˜å¹¶æ³¨å†Œä¸€ä¸ªä»¥æ–¹æ³•åä¸º name çš„ beanã€‚@Bean(name= {â€œsayAndPlayServiceNewNameâ€, â€œsayAndPlayServiceâ€}) public interface SayAndPlayService { String say(); String play(); } public class PeopleSayAndPlayServiceImpl implements SayAndPlayService { @Override public String say() { return \"People Service implements say.\"; } @Override public String play() { return \"People Service implements play.\"; } } @Configuration public class SimpleManualwireConfig { @Bean public SayAndPlayService sayAndPlayService() { return new PeopleSayAndPlayServiceImpl(); } } @RunWith(SpringRunner.class) @ContextConfiguration(classes= {org.exfly.demo.config.SimpleManualwireConfig.class}) public class SimpleBeanManualwireTest { @Autowired private SayAndPlayService service; @Test public void testTestOneAutowiredService() { Assert.assertEquals(\"People Service implements say.\", service.say()); } @Test public void testAnnotationConfigAppContext() { ApplicationContext context = new AnnotationConfigApplicationContext(org.exfly.demo.config.SimpleManualwireConfig.class); SayAndPlayService service = (SayAndPlayService) context.getBean(\"sayAndPlayService\"); Assert.assertEquals(\"People Service implements say.\", service.say()); } } ","date":"2018-05-20","objectID":"/sprint-beans-waire-notebook/:1:0","tags":["Spring","SSM"],"title":"Spring Beansçš„è£…é…è§„åˆ™æ€»ç»“","uri":"/sprint-beans-waire-notebook/"},{"categories":null,"content":"è‡ªåŠ¨è£…é… ä½¿ç”¨@ComponentScan å¯ä»¥è‡ªåŠ¨æ‰«æï¼Œ@ComponentScan å‘Šè¯‰ Spring å“ªä¸ª packages çš„ç”¨æ³¨è§£æ ‡è¯†çš„ç±» ä¼šè¢« spring è‡ªåŠ¨æ‰«æå¹¶ä¸”è£…å…¥ bean å®¹å™¨ã€‚è‡ªåŠ¨æ‰«æï¼Œä¼šæ‰«æç›¸åº”åŒ…ä»¥åŠå­åŒ…ï¼Œå¹¶ä¸ºæ‰€æœ‰ bean ç”Ÿæˆ nameï¼Œname å‘½åè§„åˆ™ä¸ºå…¶ç±»é¦–å­—æ¯å˜å°å†™ï¼Œå¦‚ interface UserService è¢«å”¯ä¸€çš„ UserServiceImpl å®ç°ï¼Œåˆ™ç»è¿‡æ‰«æï¼Œbean è¢«å£°æ˜ä¸º name ä¸º userServiceImplã€‚å¦‚æœæ¥å£è¢«å¤šå„ç±»å®ç°ï¼Œéœ€è¦è½¬åˆ°ä¸‹æ–‡æ¶ˆé™¤æ­§ä¹‰éƒ¨åˆ†è¿›è¡Œäº†è§£ã€‚ public interface SpeakService { String speak(); } @Service public class PeopleSpeakServiceImpl implements SpeakService { @Override public String speak() { return \"People speak\"; } } @Configuration @ComponentScan(basePackageClasses={org.exfly.demo.service.SpeakService.class}) public class SimpleConfigScanConfig {} @RunWith(SpringRunner.class) @ContextConfiguration(classes= {org.exfly.demo.config.SimpleManualwireConfig.class}) public class SimpleBeanManualwireTest { @Test public void testAnnotationConfigAppContextAutoScan() { ApplicationContext context = new AnnotationConfigApplicationContext(org.exfly.demo.config.SimpleConfigScanConfig.class); SpeakService service = (SpeakService) context.getBean(\"peopleSpeakServiceImpl\"); Assert.assertEquals(\"People speak\", service.speak()); } } //å¦‚æœå¸Œæœ›ä½¿ç”¨@Autowiredè‡ªåŠ¨è£…é…ï¼Œ @RunWith(SpringRunner.class) @ContextConfiguration(classes= {org.exfly.demo.config.SimpleConfigScanConfig.class}) public class SimpleAutoScanTest { @Autowired //æ ¹æ®ç±»å‹è¿›è¡Œè‡ªåŠ¨æ³¨å…¥ private SpeakService sservice; @Test public void testAnnotationConfigAppContextAutoScanAutoWire() { Assert.assertEquals(\"People speak\", sservice.speak()); } } ","date":"2018-05-20","objectID":"/sprint-beans-waire-notebook/:2:0","tags":["Spring","SSM"],"title":"Spring Beansçš„è£…é…è§„åˆ™æ€»ç»“","uri":"/sprint-beans-waire-notebook/"},{"categories":null,"content":"@Autowired å¯ä»¥åœ¨å±æ€§ã€æ„é€ æ–¹æ³•ã€set å‡½æ•°ä¸­è¿›è¡Œè‡ªåŠ¨æ³¨å…¥ ","date":"2018-05-20","objectID":"/sprint-beans-waire-notebook/:2:1","tags":["Spring","SSM"],"title":"Spring Beansçš„è£…é…è§„åˆ™æ€»ç»“","uri":"/sprint-beans-waire-notebook/"},{"categories":null,"content":"æ¶ˆé™¤æ­§ä¹‰ é€šè¿‡ä½¿ç”¨@Bean æ³¨è§£æ–¹æ³•ï¼Œå¯ä»¥å£°æ˜å¹¶æ³¨å†Œä¸€ä¸ªä»¥æ–¹æ³•åä¸º name çš„ beanã€‚å¦‚æœä½¿ç”¨@Bean(name= {â€œsayAndPlayServiceNewNameâ€, â€œsayAndPlayServiceâ€})å¯¹ bean è¿›è¡Œå‘½åï¼Œå¯ä»¥ç”¨ä¸åŒçš„åå­—å–ç”¨ï¼ˆåœ¨@Autowired å¤„å†åŠ ä¸€ä¸ª@Qualifier(â€œsayAndPlayServiceNewNameâ€)ï¼‰; å¦‚æœä½¿ç”¨@ComponentScanï¼Œç›¸åº”çš„ Bean å®šä¹‰éœ€è¦ä½¿ç”¨ Component ç­‰è¿›è¡Œæ³¨è§£ï¼ŒåŒæ—¶ä½¿ç”¨@Qualifier(â€œBeanIdâ€)é™å®šç¬¦ï¼Œå¦‚ä¸‹ @Configuration public class SimpleManualwireConfig { @Bean(name={\"sayAndPlayServiceNewName\", \"sayAndPlayService\"}) public SayAndPlayService sayAndPlayService() { return new PeopleSayAndPlayServiceImpl(); } } @Service @Qualifier(\"peopleSayServ\") public class PeopleSayServiceImpl implements SayService {} //or @Service(\"peopleSayServ\") public class PeopleSayServiceImpl implements SayService {} //å¦‚ä½•ä½¿ç”¨ @Autowired @Qualifier(\"peopleSayServ\") SayService service; ","date":"2018-05-20","objectID":"/sprint-beans-waire-notebook/:3:0","tags":["Spring","SSM"],"title":"Spring Beansçš„è£…é…è§„åˆ™æ€»ç»“","uri":"/sprint-beans-waire-notebook/"},{"categories":null,"content":"æ¡ä»¶ç”Ÿæ•ˆ å¦‚ä¸‹çš„è§£é‡Šï¼šåœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­ï¼Œå¦‚æœ Conditional æ³¨è§£ä¸­çš„ MagitExistsCondition.matches æ–¹æ³•è¿”å› trueï¼Œåˆ™å½“å‰ beanï¼šmagicBean ç”Ÿæ•ˆã€‚@Profile å’Œ springboot è‡ªåŠ¨é…ç½®éƒ½æ˜¯åŸºäºæ­¤ç§åŸç†å®ç°çš„ã€‚ @Bean @Conditional(MagitExistsCondition.class) public MagicBean magicBean(){ return new MagitBean(); } public class MagitExistsCondition implements Condition { boolean matches(ConditionContext ctxt, AnnotatedTypeMetadat metadate){ Environment env = ctxt.getEnvironment(); return env.containsProperty(\"magic\"); } } ","date":"2018-05-20","objectID":"/sprint-beans-waire-notebook/:4:0","tags":["Spring","SSM"],"title":"Spring Beansçš„è£…é…è§„åˆ™æ€»ç»“","uri":"/sprint-beans-waire-notebook/"},{"categories":null,"content":"@Profile ","date":"2018-05-20","objectID":"/sprint-beans-waire-notebook/:5:0","tags":["Spring","SSM"],"title":"Spring Beansçš„è£…é…è§„åˆ™æ€»ç»“","uri":"/sprint-beans-waire-notebook/"},{"categories":null,"content":"bean ä½œç”¨åŸŸ Singleton é»˜è®¤ åªåˆ›å»ºä¸€ä¸ªå®ä¾‹ Prototype æ¯æ¬¡åˆ›å»ºæ–°çš„å®ä¾‹ Session æ¯ä¸ªä¼šè¯åˆ›å»ºä¸€ä¸ªå®ä¾‹ Request æ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªå®ä¾‹ ä½¿ç”¨@Scope è¿›è¡Œé…ç½®å³å¯ @Component @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE) public class Notepad{} ","date":"2018-05-20","objectID":"/sprint-beans-waire-notebook/:6:0","tags":["Spring","SSM"],"title":"Spring Beansçš„è£…é…è§„åˆ™æ€»ç»“","uri":"/sprint-beans-waire-notebook/"},{"categories":null,"content":"è¿è¡Œæ—¶å€¼æ³¨å…¥ ä»¥åè¡¥å…… ","date":"2018-05-20","objectID":"/sprint-beans-waire-notebook/:7:0","tags":["Spring","SSM"],"title":"Spring Beansçš„è£…é…è§„åˆ™æ€»ç»“","uri":"/sprint-beans-waire-notebook/"},{"categories":null,"content":"å…¶ä»– é¡¹ç›®ä»£ç  ","date":"2018-05-20","objectID":"/sprint-beans-waire-notebook/:8:0","tags":["Spring","SSM"],"title":"Spring Beansçš„è£…é…è§„åˆ™æ€»ç»“","uri":"/sprint-beans-waire-notebook/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šå­¦Java Collectionsé›†åˆï¼Œå¯¹å…¶ä¸­ä¸€äº›çŸ¥è¯†è¿›è¡Œæ•´ç† Collectionsç»“æ„ ","date":"2018-03-24","objectID":"/learn-java-collections/:0:0","tags":["Java"],"title":"CollectionsçŸ¥è¯†æ•´ç†","uri":"/learn-java-collections/"},{"categories":null,"content":"ä½¿ç”¨ä¾‹å­ ","date":"2018-03-24","objectID":"/learn-java-collections/:1:0","tags":["Java"],"title":"CollectionsçŸ¥è¯†æ•´ç†","uri":"/learn-java-collections/"},{"categories":null,"content":"Iterator public void testIterator(){ //åˆ›å»ºä¸€ä¸ªé›†åˆ Collection books = new HashSet(); books.add(\"è½»é‡çº§J2EEä¼ä¸šåº”ç”¨å®æˆ˜\"); books.add(\"Struts2æƒå¨æŒ‡å—\"); books.add(\"åŸºäºJ2EEçš„Ajaxå®å…¸\"); //è·å–booksé›†åˆå¯¹åº”çš„è¿­ä»£å™¨ Iterator\u003cString\u003e it = books.iterator(); while(it.hasNext()) { String book = it.next(); System.out.println(book); if (book.equals(\"Struts2æƒå¨æŒ‡å—\")) { it.remove(); //ä½¿ç”¨Iteratorè¿­ä»£è¿‡ç¨‹ä¸­ï¼Œä¸å¯ä¿®æ”¹é›†åˆå…ƒç´ ,ä¸‹é¢ä»£ç å¼•å‘å¼‚å¸¸ //books.remove(book); } //å¯¹bookå˜é‡èµ‹å€¼ï¼Œä¸ä¼šæ”¹å˜é›†åˆå…ƒç´ æœ¬èº« book = \"æµ‹è¯•å­—ç¬¦ä¸²\"; } System.out.println(books); } ","date":"2018-03-24","objectID":"/learn-java-collections/:1:1","tags":["Java"],"title":"CollectionsçŸ¥è¯†æ•´ç†","uri":"/learn-java-collections/"},{"categories":null,"content":"List å®ç°Listæ¥å£çš„å¸¸ç”¨ç±»æœ‰LinkedListï¼ŒArrayList List\u003cString\u003e list = new LinkedList\u003c\u003e(); ","date":"2018-03-24","objectID":"/learn-java-collections/:1:2","tags":["Java"],"title":"CollectionsçŸ¥è¯†æ•´ç†","uri":"/learn-java-collections/"},{"categories":null,"content":"Set Setæ¥å£æœ‰ä»¥ä¸‹å‡ ç§å®ç°ï¼š HashSet : ä¸ºå¿«é€ŸæŸ¥æ‰¾è®¾è®¡çš„Setï¼Œä¸»è¦çš„ç‰¹ç‚¹æ˜¯ï¼šä¸èƒ½å­˜æ”¾é‡å¤å…ƒç´ ï¼Œè€Œä¸”é‡‡ç”¨æ•£åˆ—çš„å­˜å‚¨æ–¹æ³•ï¼Œæ‰€ä»¥æ²¡æœ‰é¡ºåºã€‚è¿™é‡Œæ‰€è¯´çš„æ²¡æœ‰é¡ºåºæ˜¯æŒ‡å…ƒç´ æ’å…¥çš„é¡ºåºä¸è¾“å‡ºçš„é¡ºåºä¸ä¸€è‡´ã€‚ TreeSet : ä¿å­˜æ¬¡åºçš„Set, åº•å±‚ä¸ºæ ‘ç»“æ„ã€‚ä½¿ç”¨å®ƒå¯ä»¥ä»Setä¸­æå–æœ‰åºçš„åºåˆ—ã€‚ LinkedHashSet : å…·æœ‰HashSetçš„æŸ¥è¯¢é€Ÿåº¦ï¼Œä¸”å†…éƒ¨ä½¿ç”¨é“¾è¡¨ç»´æŠ¤å…ƒç´ çš„é¡ºåº(æ’å…¥çš„æ¬¡åº)ã€‚äºæ˜¯åœ¨ä½¿ç”¨è¿­ä»£å™¨éå†Setæ—¶ï¼Œç»“æœä¼šæŒ‰å…ƒç´ æ’å…¥çš„æ¬¡åºæ˜¾ç¤ºã€‚ Set\u003cString\u003e hs = new HashSet\u003c\u003e(); ","date":"2018-03-24","objectID":"/learn-java-collections/:1:3","tags":["Java"],"title":"CollectionsçŸ¥è¯†æ•´ç†","uri":"/learn-java-collections/"},{"categories":null,"content":"Map Mapæ¥å£æœ‰ä»¥ä¸‹å‡ ç§å®ç°ï¼š HashMapã€LinkedHashMapã€HashTableå’ŒTreeMap Map\u003cString, String\u003e m1 = new HashMap\u003c\u003e(); m1.put(\"Zara\", \"8\"); m1.get(\"Zara\"); // 8 m1.containsKey(\"Zara\"); // true Java8çš„HashMapè¯¦è§£ï¼ˆå­˜å‚¨ç»“æ„ï¼ŒåŠŸèƒ½å®ç°ï¼Œæ‰©å®¹ä¼˜åŒ–ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œéå†æ–¹æ³•ï¼‰ ","date":"2018-03-24","objectID":"/learn-java-collections/:1:4","tags":["Java"],"title":"CollectionsçŸ¥è¯†æ•´ç†","uri":"/learn-java-collections/"},{"categories":null,"content":"Queue Queue\u003cString\u003e queue = new LinkedList\u003cString\u003e(); //æ·»åŠ å…ƒç´  queue.offer(\"a\"); queue.offer(\"b\"); queue.offer(\"c\"); queue.offer(\"d\"); queue.offer(\"e\"); for(String q : queue){ System.out.println(q); } System.out.println(\"===\"); System.out.println(\"poll=\"+queue.poll()); //è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶åœ¨é˜Ÿåˆ—ä¸­åˆ é™¤ for(String q : queue){ System.out.println(q); } System.out.println(\"===\"); System.out.println(\"element=\"+queue.element()); //è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´  for(String q : queue){ System.out.println(q); } System.out.println(\"===\"); System.out.println(\"peek=\"+queue.peek()); //è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´  for(String q : queue){ System.out.println(q); } /* a b c d e === poll=a b c d e === element=b b c d e === peek=b b c d e */ ","date":"2018-03-24","objectID":"/learn-java-collections/:1:5","tags":["Java"],"title":"CollectionsçŸ¥è¯†æ•´ç†","uri":"/learn-java-collections/"},{"categories":null,"content":"è½¬æˆçº¿ç¨‹å®‰å…¨ List\u003cString\u003e list = Collections.synchronizedList(new LinkedList\u003c\u003e()); èµ„æº å®˜æ–¹ Collections Api reference Javaé›†åˆæ¡†æ¶é¢è¯•é¢˜ æ¯”è¾ƒç»†è‡´çš„è®²è§£ é¢è¯•æ•´ç†-Javaç»¼åˆé«˜çº§ç¯‡ï¼ˆåè¡€æ•´ç†ï¼‰ æœ€å…¨çš„BATå¤§å‚é¢è¯•é¢˜æ•´ç† ","date":"2018-03-24","objectID":"/learn-java-collections/:2:0","tags":["Java"],"title":"CollectionsçŸ¥è¯†æ•´ç†","uri":"/learn-java-collections/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šä½ å¯ä»¥å°† Wox çœ‹ä½œä¸€ä¸ªé«˜æ•ˆçš„æœ¬åœ°å¿«é€Ÿæœç´¢æ¡†ï¼Œé€šè¿‡å¿«æ·é”®å‘¼å‡ºï¼ˆé»˜è®¤ alt+ç©ºæ ¼ï¼‰ï¼Œç„¶åè¾“å…¥å…³é”®å­—ï¼ˆæ”¯æŒæ‹¼éŸ³æ¨¡ç³ŠæŸ¥è¯¢ï¼‰æ¥æœç´¢ç¨‹åºè¿›è¡Œå¿«é€Ÿå¯åŠ¨ï¼Œæˆ–è€…æœç´¢æœ¬åœ°ç¡¬ç›˜çš„æ–‡ä»¶ï¼Œæ‰“å¼€ç™¾åº¦ã€Google è¿›è¡Œæœç´¢ï¼Œç”šè‡³æ˜¯é€šè¿‡ä¸€äº›æ’ä»¶çš„åŠŸèƒ½å®ç°å•è¯ç¿»è¯‘ã€å…³é—­å±å¹•ã€æŸ¥è¯¢å‰ªè´´æ¿å†å²ã€æŸ¥è¯¢ç¼–ç¨‹æ–‡æ¡£ã€æŸ¥è¯¢å¤©æ°”ç­‰æ›´å¤šåŠŸèƒ½ã€‚ ","date":"2018-02-24","objectID":"/wox_everything_production/:0:0","tags":["å·¥å…·","ç”Ÿäº§åŠ›","windows"],"title":"Wox+Everythingæ”¹å˜æ—¥å¸¸ä½¿ç”¨ç”µè„‘çš„æµç¨‹ç¥å™¨ï¼Œå¢™è£‚æ¨è","uri":"/wox_everything_production/"},{"categories":null,"content":"è½¯ä»¶å‡†å¤‡ everything wox ","date":"2018-02-24","objectID":"/wox_everything_production/:1:0","tags":["å·¥å…·","ç”Ÿäº§åŠ›","windows"],"title":"Wox+Everythingæ”¹å˜æ—¥å¸¸ä½¿ç”¨ç”µè„‘çš„æµç¨‹ç¥å™¨ï¼Œå¢™è£‚æ¨è","uri":"/wox_everything_production/"},{"categories":null,"content":"ä»‹ç»ä¸€äº›è½¯ä»¶çš„ç‰¹æ€§ ç›´æ¥ä½¿ç”¨æœç´¢å¼•æ“æœç´¢ å¯ä»¥æœç´¢è½¯ä»¶ï¼Œç›´æ¥å›è½¦å³å¯è¿è¡Œ æœç´¢æ–‡ä»¶ã€æ–‡ä»¶å¤¹ï¼Œå›è½¦åä½¿ç”¨ç³»ç»Ÿé»˜è®¤è½¯ä»¶æ‰“å¼€ é…ç½®ç³»ç»Ÿå‘½ä»¤ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œ(ç±»ä¼¼ Win+R) é€šè¿‡æ’ä»¶å¯ä»¥å®ç°å•è¯ç¿»è¯‘ç­‰åŠŸèƒ½ ","date":"2018-02-24","objectID":"/wox_everything_production/:2:0","tags":["å·¥å…·","ç”Ÿäº§åŠ›","windows"],"title":"Wox+Everythingæ”¹å˜æ—¥å¸¸ä½¿ç”¨ç”µè„‘çš„æµç¨‹ç¥å™¨ï¼Œå¢™è£‚æ¨è","uri":"/wox_everything_production/"},{"categories":null,"content":"å®‰è£…æ–¹æ³• é“¾æ¥ä¸­æœ‰å…·ä½“çš„ä½¿ç”¨æ–¹æ³•ã€‚æˆ‘æ›´å–œæ¬¢ç»¿è‰²è½¯ä»¶ï¼Œä¸‹è½½ä¸‹æ¥ç›´æ¥å¯ä»¥ä½¿ç”¨ã€‚ ","date":"2018-02-24","objectID":"/wox_everything_production/:3:0","tags":["å·¥å…·","ç”Ÿäº§åŠ›","windows"],"title":"Wox+Everythingæ”¹å˜æ—¥å¸¸ä½¿ç”¨ç”µè„‘çš„æµç¨‹ç¥å™¨ï¼Œå¢™è£‚æ¨è","uri":"/wox_everything_production/"},{"categories":null,"content":"å®‰è£…ä¹‹å çœ‹ä¸€ä¸‹ä½¿ç”¨æ•ˆæœï¼š ","date":"2018-02-24","objectID":"/wox_everything_production/:4:0","tags":["å·¥å…·","ç”Ÿäº§åŠ›","windows"],"title":"Wox+Everythingæ”¹å˜æ—¥å¸¸ä½¿ç”¨ç”µè„‘çš„æµç¨‹ç¥å™¨ï¼Œå¢™è£‚æ¨è","uri":"/wox_everything_production/"},{"categories":null,"content":"å¼•ç”¨ Wox ä¸€æ¬¾å›½äº§å¼€æºçš„å¿«æ·å¯åŠ¨å™¨è¾…åŠ©å·¥å…·ç¥å™¨ å…·ä½“æ€ä¹ˆé…ç½®å¯ä»¥çœ‹è¿™ä¸ª wox ç¨‹åºå¼€æºåœ°å€ ","date":"2018-02-24","objectID":"/wox_everything_production/:5:0","tags":["å·¥å…·","ç”Ÿäº§åŠ›","windows"],"title":"Wox+Everythingæ”¹å˜æ—¥å¸¸ä½¿ç”¨ç”µè„‘çš„æµç¨‹ç¥å™¨ï¼Œå¢™è£‚æ¨è","uri":"/wox_everything_production/"},{"categories":null,"content":"æ–‡ç« ç®€ä»‹ï¼šä¸ºäº†å†™è®ºæ–‡ï¼Œä½¿ç”¨ gensim è®­ç»ƒ word2vec æ¨¡å‹ï¼Œå¦‚ä¸‹è®°å½•äº†è¿›è¡Œè®­ç»ƒçš„è¿‡ç¨‹ ","date":"2018-02-14","objectID":"/wiki_zh_practice_word2vec/:0:0","tags":["word2vec","jieba","python","ç®—æ³•","NLP"],"title":"ä½¿ç”¨gensimè®­ç»ƒword2vecæ¨¡å‹--ä¸­æ–‡ç»´åŸºç™¾ç§‘è¯­æ–™","uri":"/wiki_zh_practice_word2vec/"},{"categories":null,"content":"å‡†å¤‡ ä¸­æ–‡ç»´åŸºç™¾ç§‘é¢„æ–™ï¼šzhwiki-latest-pages-articles.xml.bz2 python3 wiki_zh_word2vec ç¹ä½“è½¬ç®€ä½“ï¼šopenccä¸€å®šè¦ä¸‹*-win32.7z,win64 çš„åœ¨æˆ‘ç”µè„‘ä¸Šæ— æ³•è¿è¡Œã€‚å¦‚æœä½¿ç”¨æˆ‘çš„wiki_zh_word2vec,åˆ™é¡¹ç›®ä¸­åŒ…å«å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ opencc ","date":"2018-02-14","objectID":"/wiki_zh_practice_word2vec/:1:0","tags":["word2vec","jieba","python","ç®—æ³•","NLP"],"title":"ä½¿ç”¨gensimè®­ç»ƒword2vecæ¨¡å‹--ä¸­æ–‡ç»´åŸºç™¾ç§‘è¯­æ–™","uri":"/wiki_zh_practice_word2vec/"},{"categories":null,"content":"TODO ","date":"2018-02-14","objectID":"/wiki_zh_practice_word2vec/:2:0","tags":["word2vec","jieba","python","ç®—æ³•","NLP"],"title":"ä½¿ç”¨gensimè®­ç»ƒword2vecæ¨¡å‹--ä¸­æ–‡ç»´åŸºç™¾ç§‘è¯­æ–™","uri":"/wiki_zh_practice_word2vec/"},{"categories":null,"content":"ä¾èµ–å‡†å¤‡ ä¸‹è½½ä¸­æ–‡ç»´åŸºç™¾ç§‘é¢„æ–™ git clone https://github.com/ExFly/wiki_zh_word2vec.git å°† zhwiki-latest-pages-articles.xml.bz2 æ”¾åˆ° build æ–‡ä»¶å¤¹ä¸‹ cd path/to/wiki_zh_word2vec pip install pipenv pipenv install â€“dev ","date":"2018-02-14","objectID":"/wiki_zh_practice_word2vec/:2:1","tags":["word2vec","jieba","python","ç®—æ³•","NLP"],"title":"ä½¿ç”¨gensimè®­ç»ƒword2vecæ¨¡å‹--ä¸­æ–‡ç»´åŸºç™¾ç§‘è¯­æ–™","uri":"/wiki_zh_practice_word2vec/"},{"categories":null,"content":"å°† XML çš„ Wiki æ•°æ®è½¬æ¢ä¸º text æ ¼å¼ pipenv run python 1_process.py build/zhwiki-latest-pages-articles.xml.bz2 build/wiki.zh.txt 31 åˆ†é’Ÿè¿è¡Œå®Œæˆ 282855 ç¯‡æ–‡ç« ï¼Œå¾—åˆ°ä¸€ä¸ª 931M çš„ txt æ–‡ä»¶ ","date":"2018-02-14","objectID":"/wiki_zh_practice_word2vec/:2:2","tags":["word2vec","jieba","python","ç®—æ³•","NLP"],"title":"ä½¿ç”¨gensimè®­ç»ƒword2vecæ¨¡å‹--ä¸­æ–‡ç»´åŸºç™¾ç§‘è¯­æ–™","uri":"/wiki_zh_practice_word2vec/"},{"categories":null,"content":"ä¸­æ–‡ç¹ä½“æ›¿æ¢æˆç®€ä½“ opencc-1.0.1-win32/opencc -i build/wiki.zh.txt -o build/wiki.zh.simp.txt -c opencc-1.0.1-win32/t2s.json å¤§çº¦ä½¿ç”¨äº† 15 åˆ†é’Ÿ ","date":"2018-02-14","objectID":"/wiki_zh_practice_word2vec/:2:3","tags":["word2vec","jieba","python","ç®—æ³•","NLP"],"title":"ä½¿ç”¨gensimè®­ç»ƒword2vecæ¨¡å‹--ä¸­æ–‡ç»´åŸºç™¾ç§‘è¯­æ–™","uri":"/wiki_zh_practice_word2vec/"},{"categories":null,"content":"ç»“å·´åˆ†è¯ pipenv run python 2_jieba_participle.py å¤§çº¦ä½¿ç”¨äº† 30 åˆ†é’Ÿ ","date":"2018-02-14","objectID":"/wiki_zh_practice_word2vec/:2:4","tags":["word2vec","jieba","python","ç®—æ³•","NLP"],"title":"ä½¿ç”¨gensimè®­ç»ƒword2vecæ¨¡å‹--ä¸­æ–‡ç»´åŸºç™¾ç§‘è¯­æ–™","uri":"/wiki_zh_practice_word2vec/"},{"categories":null,"content":"Word2Vec æ¨¡å‹è®­ç»ƒ pipenv run python 3_train_word2vec_model.py å¤§çº¦ä½¿ç”¨äº† 30 åˆ†é’Ÿï¼Œä¸”å…¨ç¨‹ cpu ä½¿ç”¨ç‡è¾¾åˆ° 90%+ ","date":"2018-02-14","objectID":"/wiki_zh_practice_word2vec/:2:5","tags":["word2vec","jieba","python","ç®—æ³•","NLP"],"title":"ä½¿ç”¨gensimè®­ç»ƒword2vecæ¨¡å‹--ä¸­æ–‡ç»´åŸºç™¾ç§‘è¯­æ–™","uri":"/wiki_zh_practice_word2vec/"},{"categories":null,"content":"æ¨¡å‹æµ‹è¯• pipenv run python 4_model_match.py d:\\Project\\wiki_zh_word2vec (develop) Î» pipenv run python 4_model_match.py å›½é™…è¶³çƒ 0.5256255865097046 è¶³çƒé˜Ÿ 0.5234458446502686 ç¯®çƒ 0.5108680725097656 è¶³çƒè¿åŠ¨ 0.5033905506134033 å›½å®¶è¶³çƒé˜Ÿ 0.494105726480484 è¶³çƒæ¯”èµ› 0.4919792115688324 ç”·å­ç¯®çƒ 0.48382389545440674 è¶³çƒè”èµ› 0.4837716817855835 ä½“è‚² 0.4835757911205292 football 0.47945135831832886 ","date":"2018-02-14","objectID":"/wiki_zh_practice_word2vec/:2:6","tags":["word2vec","jieba","python","ç®—æ³•","NLP"],"title":"ä½¿ç”¨gensimè®­ç»ƒword2vecæ¨¡å‹--ä¸­æ–‡ç»´åŸºç™¾ç§‘è¯­æ–™","uri":"/wiki_zh_practice_word2vec/"},{"categories":null,"content":"æŸ¥çœ‹ç»“æœ å¯ä»¥ä½¿ç”¨ linux çš„ head æˆ–è€… tail å‘½ä»¤æŸ¥çœ‹è¿è¡Œçš„ç»“æœã€‚ head -n 100 wiki.zh.simp.txt \u003e wiki.zh.simp_head_100.txt,ç›´æ¥æŸ¥çœ‹ wiki.zh.simp_head_100.txt å³å¯ æ²¡æœ‰ head å‘½ä»¤ï¼Œå¯ä»¥å®‰è£…gowï¼Œæˆ–è€…ç›´æ¥ä¸‹è½½cmder,è¿›å…¥å°±å¯ä»¥ä½¿ç”¨ head å‘½ä»¤äº† ","date":"2018-02-14","objectID":"/wiki_zh_practice_word2vec/:2:7","tags":["word2vec","jieba","python","ç®—æ³•","NLP"],"title":"ä½¿ç”¨gensimè®­ç»ƒword2vecæ¨¡å‹--ä¸­æ–‡ç»´åŸºç™¾ç§‘è¯­æ–™","uri":"/wiki_zh_practice_word2vec/"},{"categories":null,"content":"ç»“æœ è‡³æ­¤ï¼Œä½¿ç”¨ python å¯¹ä¸­æ–‡ wiki è¯­æ–™çš„è¯å‘é‡å»ºæ¨¡å°±å…¨éƒ¨ç»“æŸäº†ï¼Œwiki.zh.text.vector ä¸­æ˜¯æ¯ä¸ªè¯å¯¹åº”çš„è¯å‘é‡ï¼Œå¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šä½œæ–‡æœ¬ç‰¹å¾çš„æå–ä»¥åŠåˆ†ç±»ã€‚æ‰€æœ‰ä»£ç éƒ½å·²ä¸Šä¼ è‡³æœ¬äºº GitHubä¸­ï¼Œæ¬¢è¿æŒ‡æ•™ï¼ æ„Ÿè°¢AimeeLee77,å…¶ä»£ç ä¸º Python2ï¼Œæˆ‘çš„é¡¹ç›®exfly/wiki_zh_word2vecå·²ç»å®Œå…¨è¿ç§»åˆ° python3,å¹¶å‘AimeeLee77æäº¤äº† pull request wiki_zh_word2vec ","date":"2018-02-14","objectID":"/wiki_zh_practice_word2vec/:3:0","tags":["word2vec","jieba","python","ç®—æ³•","NLP"],"title":"ä½¿ç”¨gensimè®­ç»ƒword2vecæ¨¡å‹--ä¸­æ–‡ç»´åŸºç™¾ç§‘è¯­æ–™","uri":"/wiki_zh_practice_word2vec/"},{"categories":null,"content":"è®°å½• vim å­¦ä¹ èµ„æº ","date":"2018-01-10","objectID":"/share-vim-resources/:0:0","tags":["linux","å·¥å…·","èµ„æº","ç”Ÿäº§åŠ›"],"title":"è®°å½• Vim å­¦ä¹ èµ„æº","uri":"/share-vim-resources/"},{"categories":null,"content":"å¼•è¨€ æƒ³å­¦ä¸€ä¸‹ Vim çš„é”®ä½ï¼Œç»“åˆ sublime text å’Œ vscode çš„ vim æ’ä»¶åŠ å¿«ç¼–ç é€Ÿåº¦ç¼–ç  ","date":"2018-01-10","objectID":"/share-vim-resources/:1:0","tags":["linux","å·¥å…·","èµ„æº","ç”Ÿäº§åŠ›"],"title":"è®°å½• Vim å­¦ä¹ èµ„æº","uri":"/share-vim-resources/"},{"categories":null,"content":"æ­£æ–‡ ","date":"2018-01-10","objectID":"/share-vim-resources/:2:0","tags":["linux","å·¥å…·","èµ„æº","ç”Ÿäº§åŠ›"],"title":"è®°å½• Vim å­¦ä¹ èµ„æº","uri":"/share-vim-resources/"},{"categories":null,"content":"èµ„æº ","date":"2018-01-10","objectID":"/share-vim-resources/:3:0","tags":["linux","å·¥å…·","èµ„æº","ç”Ÿäº§åŠ›"],"title":"è®°å½• Vim å­¦ä¹ èµ„æº","uri":"/share-vim-resources/"},{"categories":null,"content":"ä½¿ç”¨æ–¹æ³• Vim ç®€ä½“ä¸­æ–‡ ","date":"2018-01-10","objectID":"/share-vim-resources/:3:1","tags":["linux","å·¥å…·","èµ„æº","ç”Ÿäº§åŠ›"],"title":"è®°å½• Vim å­¦ä¹ èµ„æº","uri":"/share-vim-resources/"},{"categories":null,"content":"cheatsheet vim_cheat_sheet vim_è¡¨æ ¼å½¢å¼ vim_è„‘å›¾å½¢å¼ vim_ä¸­æ–‡å½¢å¼ ","date":"2018-01-10","objectID":"/share-vim-resources/:3:2","tags":["linux","å·¥å…·","èµ„æº","ç”Ÿäº§åŠ›"],"title":"è®°å½• Vim å­¦ä¹ èµ„æº","uri":"/share-vim-resources/"},{"categories":null,"content":"åˆ†äº«è‡ªå·±çš„å¯†ç ç®¡ç†ä½“ç³»:keepass+åšæœäº‘+keepass2Androidï¼Œä»¥åŠä½¿ç”¨å®¹å™¨ï¼Œæ­å»ºé˜²æ­¢æ‰‹æœºè¶Šç”¨è¶Šå¡çš„æ—¥å¸¸ä½¿ç”¨ app ä½“ç³»ï¼Œè¯¥åº”ç”¨ä¸éœ€è¦ rootã€‚ ","date":"2017-12-19","objectID":"/2017.12.19-%E4%B8%AA%E4%BA%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86-android%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/:0:0","tags":["å®‰å…¨"],"title":"ä¸ªäººå¯†ç ç®¡ç†+Androidè£…æœºæŒ‡å—","uri":"/2017.12.19-%E4%B8%AA%E4%BA%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86-android%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/"},{"categories":null,"content":"ä¸ªäººå¯†ç ç®¡ç† ","date":"2017-12-19","objectID":"/2017.12.19-%E4%B8%AA%E4%BA%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86-android%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/:1:0","tags":["å®‰å…¨"],"title":"ä¸ªäººå¯†ç ç®¡ç†+Androidè£…æœºæŒ‡å—","uri":"/2017.12.19-%E4%B8%AA%E4%BA%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86-android%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/"},{"categories":null,"content":"å‡†å¤‡ win:keepass è‡ªåŠ©äº‘å­˜å‚¨:åšæœäº‘è´¦å· Android:keepass2Android ","date":"2017-12-19","objectID":"/2017.12.19-%E4%B8%AA%E4%BA%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86-android%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/:1:1","tags":["å®‰å…¨"],"title":"ä¸ªäººå¯†ç ç®¡ç†+Androidè£…æœºæŒ‡å—","uri":"/2017.12.19-%E4%B8%AA%E4%BA%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86-android%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/"},{"categories":null,"content":"å¼€å§‹ å·¥å…·å‡†å¤‡å¥½å°±å¼€å§‹å§ï¼ŒæŒ‰å¦‚ä¸‹æ­¥éª¤ï¼š ç”µè„‘ç«¯ keepass æœ¬åœ°å»ºä¸€ä¸ªå¯†ç æ–‡ä»¶ï¼ˆéœ€è¦ä¸€ä¸ªä¸»å¯†ç ï¼Œä»¥åå¯ä»¥ä¿®æ”¹ï¼Œä¸»å¯†ç ä¸€å®šè¦å¤æ‚ï¼‰ï¼Œåä¸Šä¼ åˆ°åšæœäº‘é‡Œï¼Œï¼ˆè¿™æ—¶å€™å°±å¯ä»¥åˆ é™¤æœ¬åœ°çš„å¯†ç æ–‡ä»¶äº†ï¼‰ï¼› åšæœäº‘ä¸­é…ç½®ç¬¬ä¸‰æ–¹åº”ç”¨æˆæƒã€‚ï¼ˆåšæœäº‘è®°å¾—å¼€äºŒæ­¥éªŒè¯ï¼Œè¿™æ ·æ¯æ¬¡ç™»é™†éœ€è¦å¾®ä¿¡æ¥æ”¶éªŒè¯ç æ‰å¯ä»¥ç™»é™†ï¼Œæ›´å®‰å…¨ä¸€äº›ï¼‰ï¼› ç”µè„‘ keepass æ‰“å¼€ urlï¼Œä»¥åŠ Android æ‰‹æœº keepass2Android æ‰“å¼€ urlï¼› å®Œã€‚ å…·ä½“å¦‚ä½•åˆ›å»ºè¯·çœ‹è¿™ä¸ªé“¾æ¥ï¼Œ å¦‚æˆ‘è¿™èˆ¬å»ºå¯†ç ç»´æŠ¤åŸºæœ¬ä¸ä¼šå‡ºç°é—®é¢˜ã€‚ åˆ°è¿™é‡Œå¯†ç ç®¡ç†ä½“ç³»åŸºæœ¬å®Œæˆäº†ã€‚å¯æ˜¯å¯¹äºä¸€ä¸ªæ–°æ‰‹æœºï¼Œç”¨å¥½ä¹…å°±ä¼šå¡ï¼Œå¾ˆå¡ï¼Œè¶…çº§å¡ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±è¦è€ä¸€äº›å°æ‰‹æ®µï¼Œå…·ä½“å¦‚ä¸‹ã€‚ ","date":"2017-12-19","objectID":"/2017.12.19-%E4%B8%AA%E4%BA%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86-android%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/:1:2","tags":["å®‰å…¨"],"title":"ä¸ªäººå¯†ç ç®¡ç†+Androidè£…æœºæŒ‡å—","uri":"/2017.12.19-%E4%B8%AA%E4%BA%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86-android%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/"},{"categories":null,"content":"Android è£…æœºæŒ‡å— ","date":"2017-12-19","objectID":"/2017.12.19-%E4%B8%AA%E4%BA%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86-android%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/:2:0","tags":["å®‰å…¨"],"title":"ä¸ªäººå¯†ç ç®¡ç†+Androidè£…æœºæŒ‡å—","uri":"/2017.12.19-%E4%B8%AA%E4%BA%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86-android%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/"},{"categories":null,"content":"å‡†å¤‡ å®¹å™¨å¼€æºäº§å“ï¼ŒåŸºäº virtualapp æ¡†æ¶ï¼Œæœ‰ç‚¹åƒ Dockerï¼›åˆæ˜¯åŒå¼€å·¥å…·ï¼Œä»–è‡ªå·±æœ‰è‡ªå·±çš„è¿è¡Œç¯å¢ƒï¼›åˆå¯ä»¥è¯´æ˜¯ Android ä¸‹çš„å…å®‰è£…åº”ç”¨çš„è¿è¡Œå¹³å°ã€‚ä¹‹åä¼šå‘Šè¯‰ä½ æ€ä¹ˆç”¨ï¼Œè¶…çº§æ£’ é…·å®‰åº”ç”¨å•†åº— apkpure.comä¸‹è½½ä¸­å›½ä¸‹è½½ä¸äº†çš„åº”ç”¨ï¼Œæœ‰ä¸€ä¸ªæ²¡è¢«å¢™çš„ç½‘å€ï¼Œä¸‹è½½å¥½ app åï¼Œapp ä¸éœ€è¦ vpnï¼Œæ‡‚äº†æ²¡ï¼ŸåŸŸåæ²¡æ‰¾åˆ°ï¼Œæ‡’å¾—æ‰¾äº†ã€‚google å•†åº—é‡Œæ‰€æœ‰çš„åº”ç”¨è¿™é‡Œéƒ½å¯ä»¥ä¸‹ï¼Œè‡ªå·±æƒ³åƒå§ ","date":"2017-12-19","objectID":"/2017.12.19-%E4%B8%AA%E4%BA%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86-android%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/:2:1","tags":["å®‰å…¨"],"title":"ä¸ªäººå¯†ç ç®¡ç†+Androidè£…æœºæŒ‡å—","uri":"/2017.12.19-%E4%B8%AA%E4%BA%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86-android%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/"},{"categories":null,"content":"å¼€å§‹ å…ˆæˆªä¸ªå›¾ï¼Œçœ‹ä¸€çœ‹ æœ€å±Œç‚¸å¤©çš„æ˜¯ï¼Œæˆ‘æŠŠæ·˜å®ã€ç‹è€…è£è€€å’Œåƒé¸¡éƒ½æ”¾åˆ°å®¹å™¨äº†ï¼Œè€Œä¸”å®Œå…¨æ²¡æœ‰æ€§èƒ½æŸå¤± åŸºæœ¬æ€è·¯ï¼šæŠŠå¿…é¡»è£…åˆ°æ‰‹æœºé‡Œçš„ï¼ˆæ¯”å¦‚æ”¯ä»˜å®ï¼Œå¾®ä¿¡ç­‰ï¼‰è£…åˆ°æ‰‹æœºé‡Œï¼Œéå¿…éœ€ï¼ˆæ¯”å¦‚æ·˜å®ï¼Œç™¾åº¦äº‘ç­‰ï¼‰ï¼Œéƒ½è£…å®¹å™¨é‡Œã€‚ ç±»æ¯”çœŸæœºï¼Œè½¯ä»¶éœ€è¦æœ‰ä¸€ä¸ªæ‰§è¡Œç¯å¢ƒå’Œä¸´æ—¶æ–‡ä»¶ï¼Œå®¹å™¨é‡Œçš„è½¯ä»¶æ–‡ä»¶éƒ½å­˜åˆ°äº†/virtual ä¸­çš„ã€‚ ä½¿ç”¨æ€è·¯ï¼šå¹³æ—¶æŠŠå¯ä»¥æ”¾åˆ°å®¹å™¨ä¸­çš„è½¯ä»¶æ”¾åˆ°é‡Œè¾¹ï¼Œä¸ç”¨çš„æ—¶å€™ç›´æ¥å…³é—­å®¹å™¨ï¼Œå®¹å™¨é‡Œæ‰€æœ‰çš„è½¯ä»¶ä¼šå…³é—­ã€‚è¿™æ ·å°±é˜²æ­¢è½¯ä»¶çš„åå°è‡ªåŠ¨å¯åŠ¨ï¼Œæµªè´¹å†…å­˜ï¼Œæ‰‹æœºè¶Šç”¨è¶Šæ…¢çš„ç°è±¡ã€‚ å…·ä½“çœ‹æˆ‘å¹³æ—¶å¸¸ç”¨çš„ä¸€äº›è½¯ä»¶ï¼Œæˆ‘æŠŠä»–ä»¬åˆ†ä¸ºä¸»æœºï¼ˆå°±æ˜¯å®‰è£…åˆ°çœŸæœºä¸­ï¼‰å’Œå®¹å™¨ä¸­çš„ã€‚åœ°å€åˆ†åˆ«å¦‚ä¸‹ çœŸæœº å®¹å™¨ ","date":"2017-12-19","objectID":"/2017.12.19-%E4%B8%AA%E4%BA%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86-android%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/:2:2","tags":["å®‰å…¨"],"title":"ä¸ªäººå¯†ç ç®¡ç†+Androidè£…æœºæŒ‡å—","uri":"/2017.12.19-%E4%B8%AA%E4%BA%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86-android%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/"},{"categories":null,"content":"æœ€å æœ‰ä»€ä¹ˆé—®é¢˜è¯·ç›´æ¥åœ¨æˆ‘çš„é…·å®‰@æˆ‘ï¼Œæˆ–è€…é‚®ç®±æˆ‘ï¼šexflycat@gmail.comã€‚ Enjoy!!! ","date":"2017-12-19","objectID":"/2017.12.19-%E4%B8%AA%E4%BA%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86-android%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/:3:0","tags":["å®‰å…¨"],"title":"ä¸ªäººå¯†ç ç®¡ç†+Androidè£…æœºæŒ‡å—","uri":"/2017.12.19-%E4%B8%AA%E4%BA%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86-android%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/"},{"categories":null,"content":"çœ‹äº†ä½™å¼¦å¤§å¤§çš„çŸ¥ä¹ live åï¼Œå‘ç°çœŸçš„éœ€è¦å¯¹è‡ªå·±çš„éšç§å®‰å…¨åšç‚¹ä»€ä¹ˆäº†ã€‚ä¸€æ¿€åŠ¨ï¼Œæ·˜å® 500 å¤§æ´‹ä¹°äº†ä¸€éƒ¨ oneplus oneï¼Œåˆ· kaliã€‚ è¿™é‡Œè®°å½•ä½¿ç”¨ oneplus one æ‰‹æœºæ‰“é€ é»‘æ‰‹å…¨è¿‡ç¨‹ï¼Œä»¥åŠä¸€äº›ä½¿ç”¨åˆ°çš„èµ„æºï¼Œä»¥åŠç»éªŒæ±‡æ€»ã€‚ ","date":"2017-09-17","objectID":"/2017.09.17-black-phone/:0:0","tags":["å®‰å…¨","kali","åˆ·æœº"],"title":"oneplus one åˆ·Kali Linux NetHunter","uri":"/2017.09.17-black-phone/"},{"categories":null,"content":"ä¸€ ä½¿ç”¨ oneplus one æ­å»ºé»‘æ‰‹è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå› ä¸ºå¯¹ Android å¹³å°ä¸ç†Ÿæ‚‰ï¼Œåˆ· kali è¿‡ç¨‹ä¸­è¸©äº†è®¸å¤šå‘ã€‚æ¯”å¦‚äºŒæ¸…ã€ä¸‰æ¸…ã€å››æ¸…ç­‰ç­‰ã€‚å¦‚ä¸‹ä¸€æ­¥ä¸€æ­¥çš„è¯´å¦‚ä½•åˆ·ã€‚ ","date":"2017-09-17","objectID":"/2017.09.17-black-phone/:1:0","tags":["å®‰å…¨","kali","åˆ·æœº"],"title":"oneplus one åˆ·Kali Linux NetHunter","uri":"/2017.09.17-black-phone/"},{"categories":null,"content":"äºŒ ","date":"2017-09-17","objectID":"/2017.09.17-black-phone/:2:0","tags":["å®‰å…¨","kali","åˆ·æœº"],"title":"oneplus one åˆ·Kali Linux NetHunter","uri":"/2017.09.17-black-phone/"},{"categories":null,"content":"åˆ·æœºå››æ­¥èµ° ç¬¬ä¸€æ­¥ï¼Œ ä»”ç»†é˜…è¯»å®˜æ–¹ Wiki ä»”ç»†ç ”è¯»ä»”ç»†é˜…è¯»å®˜æ–¹ Wikiï¼Œå¯ä»¥å‡å°‘åˆ·æœºè¿‡ç¨‹ä¸­å„ç§å‘ã€‚ ç¬¬äºŒæ­¥ï¼Œ åˆ·TWRP-oneplus1 ä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼šè§£é”ã€åˆ·è¿›å¯¹åº”çš„ twrp.imgã€‚æ•´ä¸ªè¿‡ç¨‹æœ¬è´¨æ˜¯ä¸€åŠ  3T å¼€å¯äº†å¼€å‘è€…æ¨¡å¼ï¼ŒåŒæ—¶ç”µè„‘ä¸ŠåŸºäºé¢„é…ç½®å¥½çš„ adbã€fastboot å‘½ä»¤å®Œæˆè¿™ä¸€ç³»åˆ—æ“ä½œã€‚è¿™ä¸ª\"é¢„é…ç½®\"åœ¨ Windows ä¸‹ï¼Œä¹Ÿå¯ä»¥å‚è€ƒ\"Bacon Root Toolkit\"ï¼ˆè¿™æ˜¯ä¸“ä¸ºä¸€åŠ æ‰“é€ çš„ GUI å·¥å…·é›†ï¼Œå½“æ—¶è¿˜æ˜¯ä¸€åŠ  1 æ—¶ï¼Œç”¨è¿™ä¸ªå¾ˆæ–¹ä¾¿ï¼Œè™½ç„¶å¾ˆä¹…æ²¡æ›´æ–°äº†ï¼Œä½†ä½œä¸ºå‚è€ƒè¿˜æ˜¯å¾ˆå¥½çš„ï¼‰ã€‚ ç¬¬ä¸‰æ­¥ï¼Œä¸‹è½½æœ€æ–°çš„ NetHunterï¼Œå¹¶è¿›å…¥ TWRP çš„ recovery æ¨¡å¼åˆ·å…¥ kali kernel-nethunter-[device]-[os]-*.zip nethunter-generic-[arch]-kalifs-*.zip å¯¹äº oneplus1 æ‰‹æœºæ¥è¯´ï¼Œå…¶å¯¹åº”çš„[arch]ä¸º armhfã€‚ éšåè¿›è¡Œåˆ·å…¥æ“ä½œã€‚è¿›å…¥ TWRPï¼Œé€‰æ‹©å®‰è£…ã€‚å…ˆæ‰¾åˆ° CM13.0 åˆ·åˆ° oneplus ä¸­ï¼Œåè¿›è¡Œé»˜è®¤çš„ WIPEã€‚ä¹‹åå† TWRP å®‰è£…ä¸­é€‰æ‹© kernel-nethunter-[device]-[os]-*.zipï¼Œå®‰è£…ç»“æŸåï¼Œåœ¨é€‰æ‹© nethunter-generic-[arch]-kalifs-*.zipï¼Œæœ€åè¿™ä¸ªæ–‡ä»¶å®‰è£…è¯è´¹çš„æ—¶é—´æ¯”è¾ƒä¹…ï¼Œå¤§çº¦ 10 å¤šåˆ†é’Ÿçš„æ ·å­ã€‚ ç¬¬å››æ­¥ï¼Œéƒ½åˆ·é¡ºåˆ©åï¼Œå¼€æœºè¿›å…¥ kali ï¼Œç”¨å·²ç»â€œé¢„è£…â€ä¸Šçš„ SuperSU App æ¥å®Œæˆä¹‹åä¸€ç³»åˆ—çš„ Root æˆæƒå³å¯ã€‚ ","date":"2017-09-17","objectID":"/2017.09.17-black-phone/:2:1","tags":["å®‰å…¨","kali","åˆ·æœº"],"title":"oneplus one åˆ·Kali Linux NetHunter","uri":"/2017.09.17-black-phone/"},{"categories":null,"content":"ä¸‰ å¦‚æœå®‰è£… Kali Linux NetHunter,éœ€è¦ä¸‹è½½çš„æ–‡ä»¶å¦‚ä¸‹ï¼š CM13.0 TWRPï¼šç¬¬ä¸‰æ–¹ recovery brtï¼šoneplus çš„è§£é”ã€root å·¥å…· Kali Linux NetHunterï¼šå¦‚æœåˆ·å…¶ä»–ç³»ç»Ÿï¼Œå¯èƒ½éœ€è¦çš„æ–‡ä»¶å¦‚ä¸‹ï¼š TWRPï¼šç¬¬ä¸‰æ–¹ recovery lineageos romï¼šcm çš„é‡ç”Ÿ supersuï¼šroot å·¥å…· ","date":"2017-09-17","objectID":"/2017.09.17-black-phone/:3:0","tags":["å®‰å…¨","kali","åˆ·æœº"],"title":"oneplus one åˆ·Kali Linux NetHunter","uri":"/2017.09.17-black-phone/"},{"categories":null,"content":"å›› Enjoyï¼ ","date":"2017-09-17","objectID":"/2017.09.17-black-phone/:4:0","tags":["å®‰å…¨","kali","åˆ·æœº"],"title":"oneplus one åˆ·Kali Linux NetHunter","uri":"/2017.09.17-black-phone/"},{"categories":null,"content":"æœ€å å®‰è£…äº† Kali Linux NetHunterï¼Œæ‰‹æœºä¾¿æœ‰äº†å®Œæ•´çš„ python ç¯å¢ƒã€‚å‰©ä¸‹çš„ï¼Œä½ æ‡‚çš„ã€‚ ","date":"2017-09-17","objectID":"/2017.09.17-black-phone/:5:0","tags":["å®‰å…¨","kali","åˆ·æœº"],"title":"oneplus one åˆ·Kali Linux NetHunter","uri":"/2017.09.17-black-phone/"},{"categories":null,"content":"æ€»ç»“ä¸€äº›å¸¸ç”¨çš„æ’åºç®—æ³•ï¼Œå¦‚å†’æ³¡æ’åºã€æ’å…¥æ’åºã€å¿«é€Ÿæ’åºã€è®¡æ•°æ’åºã€äºŒåˆ†æ’åºã€å½’å¹¶æ’åºç­‰ã€‚ Source æ’åºç®—æ³•æ¯”è¾ƒ-wiki visualgo æ’åºç®—æ³•çš„åŠ¨æ€å›¾ æ’åºç®—æ³•å¤æ‚åº¦ å†’æ³¡æ’åº ","date":"2017-09-16","objectID":"/sort-algorithm-compare-and-impl/:0:0","tags":["ç®—æ³•","æ’åº","å®ç°"],"title":"å„ç§æ’åºç®—æ³•å®ç°æ–¹æ³•","uri":"/sort-algorithm-compare-and-impl/"},{"categories":null,"content":"ä¼ªä»£ç  function bubble_sort (array, length) { var i, j; for(i from 0 to length-1){ for(j from 0 to length-1-i){ if (array[j] \u003e array[j+1]) swap(array[j], array[j+1]) } } } å‡½æ•° å†’æ³¡æ’åº è¾“å…¥ ä¸€ä¸ªæ•°ç»„åç§°ä¸ºarray å…¶é•¿åº¦ä¸ºlength i ä» 0 åˆ° (length - 1) j ä» 0 åˆ° (length - 1 - i) å¦‚æœ array[j] \u003e array[j + 1] äº¤æ¢ array[j] å’Œ array[j + 1] çš„å€¼ å¦‚æœç»“æŸ jå¾ªç¯ç»“æŸ iå¾ªç¯ç»“æŸ å‡½æ•°ç»“æŸ ","date":"2017-09-16","objectID":"/sort-algorithm-compare-and-impl/:1:0","tags":["ç®—æ³•","æ’åº","å®ç°"],"title":"å„ç§æ’åºç®—æ³•å®ç°æ–¹æ³•","uri":"/sort-algorithm-compare-and-impl/"},{"categories":null,"content":"pythonå®ç° def bubble(List): for j in range(len(List)-1,0,-1): for i in range(0, j): if List[i] \u003e List[i+1]: List[i], List[i+1] = List[i+1], List[i] return List æ’å…¥æ’åº ","date":"2017-09-16","objectID":"/sort-algorithm-compare-and-impl/:2:0","tags":["ç®—æ³•","æ’åº","å®ç°"],"title":"å„ç§æ’åºç®—æ³•å®ç°æ–¹æ³•","uri":"/sort-algorithm-compare-and-impl/"},{"categories":null,"content":"pythonå®ç° def insert_sort(lst): n=len(lst) if n==1: return lst for i in range(1,n): for j in range(i,0,-1): if lst[j] \u003c lst[j-1]: lst[j], lst[j-1] = lst[j-1], lst[j] return lst å¿«é€Ÿæ’åº ","date":"2017-09-16","objectID":"/sort-algorithm-compare-and-impl/:3:0","tags":["ç®—æ³•","æ’åº","å®ç°"],"title":"å„ç§æ’åºç®—æ³•å®ç°æ–¹æ³•","uri":"/sort-algorithm-compare-and-impl/"},{"categories":null,"content":"pythonå®ç° def quicksort(a): if len(a) == 1: return a[0] if len(a) \u003c 1: return 0 return quicksort([x for x in a[1:] if x \u003c a[0]]), [a[0]], quicksort([x for x in a[1:] if x \u003e a[0]]) ","date":"2017-09-16","objectID":"/sort-algorithm-compare-and-impl/:4:0","tags":["ç®—æ³•","æ’åº","å®ç°"],"title":"å„ç§æ’åºç®—æ³•å®ç°æ–¹æ³•","uri":"/sort-algorithm-compare-and-impl/"},{"categories":null,"content":"Cè¯­è¨€å®ç° int partition(int arr[], int low, int high){ int key; key = arr[low]; while(low \u003c high){ while(low \u003c high \u0026\u0026 arr[high]\u003e= key ) high--; if(low \u003c high) arr[low++] = arr[high]; while( low \u003c high \u0026\u0026 arr[low]\u003c=key ) low++; if(low \u003c high) arr[high--] = arr[low]; } arr[low] = key; return low; } void quick_sort(int arr[], int start, int end){ int pos; if (start \u003c end){ pos = partition(arr, start, end); quick_sort(arr,start,pos-1); quick_sort(arr,pos+1,end); } return; } å½’å¹¶æ’åº ","date":"2017-09-16","objectID":"/sort-algorithm-compare-and-impl/:5:0","tags":["ç®—æ³•","æ’åº","å®ç°"],"title":"å„ç§æ’åºç®—æ³•å®ç°æ–¹æ³•","uri":"/sort-algorithm-compare-and-impl/"},{"categories":null,"content":"pythonå®ç° from collections import deque def merge_sort(lst): if len(lst) \u003c= 1: return lst def merge(left, right): merged,left,right = deque(),deque(left),deque(right) while left and right: merged.append(left.popleft() if left[0] \u003c= right[0] else right.popleft()) # deque popleft is also O(1) merged.extend(right if right else left) return list(merged) middle = int(len(lst) // 2) left = merge_sort(lst[:middle]) right = merge_sort(lst[middle:]) return merge(left, right) è®¡æ•°æ’åº ","date":"2017-09-16","objectID":"/sort-algorithm-compare-and-impl/:6:0","tags":["ç®—æ³•","æ’åº","å®ç°"],"title":"å„ç§æ’åºç®—æ³•å®ç°æ–¹æ³•","uri":"/sort-algorithm-compare-and-impl/"},{"categories":null,"content":"Cå®ç° void counting_sort(int *ini_arr, int *sorted_arr, int n) { int *count_arr = (int *) malloc(sizeof(int) * 100); int i, j, k; for (k = 0; k \u003c 100; k++) count_arr[k] = 0; for (i = 0; i \u003c n; i++) count_arr[ini_arr[i]]++; for (k = 1; k \u003c 100; k++) count_arr[k] += count_arr[k - 1]; for (j = n; j \u003e 0; j--) sorted_arr[--count_arr[ini_arr[j - 1]]] = ini_arr[j - 1]; free(count_arr); } äºŒåˆ†æŸ¥æ‰¾ int binary_search(int array[],int n,int value){ int left=0; int right=n-1; while (left\u003c=right){ int middle=left + ((right-left)\u003e\u003e1); //é˜²æ­¢æº¢å‡ºï¼Œç§»ä½ä¹Ÿæ›´é«˜æ•ˆã€‚åŒæ—¶ï¼Œæ¯æ¬¡å¾ªç¯éƒ½éœ€è¦æ›´æ–°ã€‚ if (array[middle] \u003e value) { right =middle-1; } else if(array[middle] \u003c value) { left=middle+1; } else { return middle; } } return -1; } ","date":"2017-09-16","objectID":"/sort-algorithm-compare-and-impl/:7:0","tags":["ç®—æ³•","æ’åº","å®ç°"],"title":"å„ç§æ’åºç®—æ³•å®ç°æ–¹æ³•","uri":"/sort-algorithm-compare-and-impl/"},{"categories":null,"content":"å¯¹ 2016 å¹´å…¨å¹´çš„æ€»ç»“ï¼Œå¹¶ä¸ºæœªæ¥åšä¸€äº›å®‰æ’ã€‚ å¹´å‰ä¸€å¤©ï¼Œä¾æ—§å¿™ç¢Œ ","date":"2017-01-01","objectID":"/2017.01.01-2016-holiday-summary/:0:0","tags":["æ€»ç»“"],"title":"2016å¹´ç»ˆæ€»ç»“ï¼Œæœªæ¥è§„åˆ’","uri":"/2017.01.01-2016-holiday-summary/"},{"categories":null,"content":"å¾€äº‹ 14 å¹´åæœˆè‡³ä»Šå¤©ï¼Œä» 0 åˆ° 1 çš„è½¬å˜ã€‚ å¼€å§‹çš„æ—¶å€™ï¼Œä¸æ–­çš„å­¦ä¹ å„ç§è½¯ä»¶çš„ä½¿ç”¨ï¼Œåƒä»€ä¹ˆ PS ä¹‹ç±»çš„ä¸œè¥¿ç©äº†ä¸ªéï¼Œæ€»æ„Ÿè§‰è¿™äº›ä¸œè¥¿éƒ½æ˜¯åˆ«äººåšå‡ºæ¥çš„ä¸œè¥¿ï¼Œä¾¿ç”Ÿå‡ºè‡ªå·±ä¹Ÿæå‡ºä¸€äº›æƒ³è¿™ç±»è½¯ä»¶ã€‚ç„¶è€Œç»§ç»­çš„çæã€‚ ä¸çŸ¥ä»€ä¹ˆæ—¶å€™ï¼ŒçŸ¥é“é€šè¿‡å­¦ä¹  c å¯ä»¥åšå‡ºæ¥å¥½å¤šæœ‰æ„æ€çš„å°ç©æ„ï¼Œæ¯”å¦‚è´ªåƒè›‡ï¼Œä¾¿å¼€å§‹å­¦ä¹ é«˜çº§è¯­è¨€ã€‚ ä¹‹åï¼ŒçŸ¥é“åŸæ¥å­¦ä¹ è®¡ç®—æœºï¼Œéœ€è¦ç³»ç»Ÿçš„å­¦ä¹ è®¡ç®—æœºçš„ç†è®ºçŸ¥è¯†ï¼Œä»æ­¤å…¥å‘ï¼Œä¸€å‘ä¸å¯æ”¶æ‹¾ã€‚ ç½‘æ˜“äº‘è¯¾å ‚æ˜¯è‡ªå·±è®¡ç®—æœºå¯è’™è¯¾ç¨‹ã€‚è·Ÿç€ä¸Šè¾¹çš„è¯¾ç¨‹å­¦äº†å¥½ä¹…ï¼Œæ‡‚äº†è®¡ç®—æœºéœ€è¦å¦‚ä½•å…¥é—¨ã€‚å­¦äº†å¯¼è®ºã€è®¡ç»„ã€C è¯­è¨€ã€ç®—æ³•å’Œæ•°æ®ç»“æ„ã€æ“ä½œç³»ç»Ÿã€è®¡ç®—æœºç½‘ç»œã€æ•°æ®åº“åŸç†ç­‰ç­‰ã€‚è‡ªå·±æ‰¾è§†é¢‘çœ‹äº† Linuxï¼Œè¯»äº†é¸Ÿå“¥çš„ linux ä¹¦ï¼Œç”šè‡³ç›´æ¥å§è‡ªå·±çš„ç”µè„‘ç³»ç»Ÿæ¢æˆäº† Ubuntu/linuxmintï¼ŒçœŸæ­£ä½“ä¼šåˆ° Linux è¯¥å¦‚ä½•ä½¿ç”¨ã€‚ å‡æœŸç”¨ Flask å®Œæˆäº†åŠ¨æ€ç½‘ç«™ï¼Œéƒ¨ç½²åˆ°æœåŠ¡å™¨é‡Œä¸€æ®µæ—¶é—´ï¼Œåæ¥å› ä¸ºç½‘ç«™å¤ªç®€å•ï¼Œç»™æ’¤äº†ã€‚ åæ¥æ·±å…¥ webï¼Œç”¨äº†ä¸¤ä¸ªæœˆçš„æ—¶é—´ï¼ŒæŠŠå‰ç«¯å­¦äº†ä¸€ä¸‹ï¼ŒåŒæ—¶å®Œæˆäº†è‡ªå·±ç¬¬ä¸€ä¸ªç½‘é¡µã€‚å­¦äº† Tornado,é‡æ„äº†å‡ æ¬¡ Project Generatorï¼Œä¹Ÿç®—åˆæ­¥æŒæ¡å…¨æ ˆå¼€å‘ã€‚åŒå­¦ç§‘ç ”è®­ç»ƒï¼Œæ‰¾äº†ä¸€ä¸ª Tornado å¼€æºé¡¹ç›®ï¼Œæ”¹æˆäº†è®ºå›ç³»ç»Ÿï¼Œè¿˜å¸®è¿™ä¸ªé¡¹ç›®ä¿®äº†å‡ ä¸ª bugã€‚ å­¦äº†äº›ä¸œè¥¿ã€‚ ","date":"2017-01-01","objectID":"/2017.01.01-2016-holiday-summary/:1:0","tags":["æ€»ç»“"],"title":"2016å¹´ç»ˆæ€»ç»“ï¼Œæœªæ¥è§„åˆ’","uri":"/2017.01.01-2016-holiday-summary/"},{"categories":null,"content":"å¦‚ä»Š å¦‚ä»Šï¼Œè¶ç€å‡æœŸï¼Œä¹Ÿæ˜¯å‡†å¤‡è€ƒç ”å‰çš„æœ€åä¸€ä¸ªå¯ä»¥è‡ªç”±æ”¯é…çš„å‡æœŸï¼Œå‡†å¤‡äº†äº›ä¸œè¥¿å›æ¥å­¦ã€‚æ¯å¤©å®Œæˆä¸€ä¸ªæ±‡ç¼–çš„é¡¹ç›®ï¼Œ( å‡æœŸæ±‡ç¼– )ã€‚å‡†å¤‡å¥½å¥½å­¦å­¦æ•°æ®ç»“æ„å’Œç®—æ³•å¯¼è®º. ","date":"2017-01-01","objectID":"/2017.01.01-2016-holiday-summary/:2:0","tags":["æ€»ç»“"],"title":"2016å¹´ç»ˆæ€»ç»“ï¼Œæœªæ¥è§„åˆ’","uri":"/2017.01.01-2016-holiday-summary/"},{"categories":null,"content":"è¶ŠåŠªåŠ›è¶Šè¿·èŒ« è¶ŠåŠªåŠ›ï¼ŒçŸ¥é“çš„è¶Šå¤šï¼Œä¸çŸ¥åˆ°çš„æ›´å¤šã€‚ä¸ºäº†é€‰æ‹©è‡ªå·±çš„æŠ€æœ¯æ–¹å‘ï¼Œè¶Šæ¥è§¦è¶Šä¸çŸ¥é“è¯¥å­¦ä»€ä¹ˆï¼Œè¶Šç€æ€¥ï¼Œè¶Šæ€¥èºã€‚ åŒæ—¶è¿˜æœ‰ä¸€äº›å…¶ä»–çš„äº‹è®©æˆ‘çƒ¦å¿ƒã€‚æ…¢æ…¢æ¥å§ï¼Œæ€¥ä¸æ¥ã€‚ ","date":"2017-01-01","objectID":"/2017.01.01-2016-holiday-summary/:3:0","tags":["æ€»ç»“"],"title":"2016å¹´ç»ˆæ€»ç»“ï¼Œæœªæ¥è§„åˆ’","uri":"/2017.01.01-2016-holiday-summary/"},{"categories":null,"content":"æœªæ¥ ä»¥åè¯¥æ€ä¹ˆå¦‚ä½•è¿›æ­¥ï¼Ÿ ","date":"2017-01-01","objectID":"/2017.01.01-2016-holiday-summary/:4:0","tags":["æ€»ç»“"],"title":"2016å¹´ç»ˆæ€»ç»“ï¼Œæœªæ¥è§„åˆ’","uri":"/2017.01.01-2016-holiday-summary/"},{"categories":null,"content":"å…¶ä»– ç»§ç»­å­¦ä¹ ï¼Œå…±å‹‰ï¼ ","date":"2017-01-01","objectID":"/2017.01.01-2016-holiday-summary/:5:0","tags":["æ€»ç»“"],"title":"2016å¹´ç»ˆæ€»ç»“ï¼Œæœªæ¥è§„åˆ’","uri":"/2017.01.01-2016-holiday-summary/"},{"categories":null,"content":"è®°å½•å­¦ä¹ Linuxæ“ä½œç³»ç»Ÿå®ç°æ—¶å€™ä½¿ç”¨è¿‡çš„èµ„æºï¼Œä¸€éƒ¨åˆ†ç¬”è®°ï¼Œä»¥åŠè°ƒè¯•ä¸­ç”¨åˆ°çš„æŠ€å·§ã€‚å†…å®¹æœ‰ç‚¹ä¹±ï¼Œä»…ä¾›ä¸ªäººä½¿ç”¨ã€‚ linux history linux 0.11 linux 0.95 å®ç°è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ linux 0.96 å®ç°ç½‘ç»œæ¥å£ linux linuxé‡‡ç”¨åˆ†æ®µ+åˆ†é¡µæœºåˆ¶ç»“åˆç®¡ç†å†…å­˜ linux è°ƒè¯•æ–¹æ³• linux0.11 è°ƒè¯•æ–¹æ³• gdb tools/system target remote localhost:1234 gdbå¸¸ç”¨å‘½ä»¤ b: ä¸‹ä¸­æ–·é» info b :u åˆ—å‡ºç›®å‰ä¸­æ–­ç‚¹ï¼Œä¹Ÿå¯ç®€å†™æˆ\"i b\" continue(c) ç»§ç»­æ‰§è¡Œç›´åˆ°ä¸‹ä¸€ä¸ªä¸­æ–­ç‚¹æˆ–ç»“æŸ list(l): åˆ—å‡ºç›®å‰ä¸Šä¸‹æ–‡ step(s): å•æ­¥ (ä¼šè¿›å…¥ funciton) next(n) : å•æ­¥ (ä¸ä¼šè¿›å…¥ funciton) until(u) è·³ç¦»ä¸€ä¸ª while for å¾ªç¯ print(p): æ˜¾ç¤ºæŸå˜é‡ï¼Œå¦‚ p str info register(i r) : æ˜¾ç¤º CPU çš„ register GDB æ‰“å°å‡ºå†…å­˜ä¸­çš„å…§å®¹ï¼Œæ ¼å¼ç‚º x/nyzï¼Œå…¶ä¸­ n: è¦å°å‡ºçš„æ•¸é‡ y: æ˜¾ç¤ºçš„æ ¼å¼ï¼Œå¯ä¸ºC( char), d(æ•´æ•°), x(hex) z: å•ä½ï¼Œå¯ä¸º b(byte), h(16bit), w(32bit) cgdb å¯æ˜¾ç¤ºä¸ºä¸ŠåŠéƒ¨åˆ†ä¸ºä»£ç ï¼Œä¸‹åŠéƒ¨åˆ†å‘½ä»¤éƒ¨åˆ† cgdb tools/system* [linux-0.11å¯åŠ¨è¿‡ç¨‹æè¿°](http://labrick.cc/2015/08/13/linux-0-11-boot/) * [Linux0.11å¯åŠ¨è¿‡ç¨‹](http://linux.chinaunix.net/techdoc/install/2007/04/10/954810.shtml) * [80386ä¿æŠ¤æ¨¡å¼çš„æœ¬è´¨](http://www.jianshu.com/p/1cea7dc5d6b7) * [linuxè™šæ‹Ÿåœ°å€åˆ°çº¿æ€§åœ°å€çš„è½¬åŒ–](http://luodw.cc/2016/02/17/address/) * [Linuxå†…å­˜å¯»å€ä¹‹åˆ†æ®µæœºåˆ¶-linuxå›é¿äº†åˆ†æ®µæœºåˆ¶](http://blog.xiaohansong.com/2015/10/03/Linux%E5%86%85%E5%AD%98%E5%AF%BB%E5%9D%80%E4%B9%8B%E5%88%86%E6%AE%B5%E6%9C%BA%E5%88%B6/) * [Linuxå†…å­˜å¯»å€ä¹‹åˆ†é¡µæœºåˆ¶/](http://blog.xiaohansong.com/2015/10/05/Linux%E5%86%85%E5%AD%98%E5%AF%BB%E5%9D%80%E4%B9%8B%E5%88%86%E9%A1%B5%E6%9C%BA%E5%88%B6/) * [é€»è¾‘åœ°å€ã€çº¿æ€§åœ°å€ã€ç‰©ç†åœ°å€å’Œè™šæ‹Ÿåœ°å€](http://www.voidcn.com/blog/will130/article/p-5705051.html) * [Intel 80386 ç¨‹åºå‘˜å‚è€ƒæ‰‹å†Œ](http://www.kancloud.cn/wizardforcel/intel-80386-ref-manual/123838) * [linux0.11å†…æ ¸ä¹‹æ–‡ä»¶ç³»ç»Ÿ](http://harpsword.leanote.com/post/Untitled-563d6103ab6441584f000164) source 80386å†…å­˜è®¿é—®å…¬å¼ 32ä½çº¿æ€§åœ°å€ = æ®µåŸºåœ°å€(32ä½) + æ®µå†…åç§»(32ä½) 48bit = 16 + 32 16ä½åœ°æ®µé€‰æ‹©å­ + 32è™šæ‹Ÿåœ°å€ -\u003e 32çº¿æ€§åœ°å€ 32çº¿æ€§åœ°å€ -\u003e ç‰©ç†åœ°å€ ","date":"2016-10-30","objectID":"/linux0.11-src-code-dev-env/:0:0","tags":["Linux","èµ„æº"],"title":"Linux0.11æºç å­¦ä¹ ç¯å¢ƒé…ç½®ä¸ç›¸å…³èµ„æºæ±‡æ€»","uri":"/linux0.11-src-code-dev-env/"},{"categories":null,"content":"bitnami-pg-upgrade This is a PoC for using pg_upgrade inside bitnami/postgres-ha from 14 to 15 â€“ learn from it, adapt it for your needs; donâ€™t expect it to work as-is! (Source for this image is available at https://github.com/exfly/bitnami-pg-upgrade .) ref blog ","date":"0001-01-01","objectID":"/readme/:0:0","tags":null,"title":"","uri":"/readme/"},{"categories":null,"content":"Usage Dependense on kind docker bash test.sh ","date":"0001-01-01","objectID":"/readme/:1:0","tags":null,"title":"","uri":"/readme/"},{"categories":null,"content":"Ref Better documentation needed on major version upgrades ","date":"0001-01-01","objectID":"/readme/:2:0","tags":null,"title":"","uri":"/readme/"}]