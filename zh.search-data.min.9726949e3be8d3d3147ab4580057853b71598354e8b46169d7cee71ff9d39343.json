[{"id":0,"href":"/docs/section/","title":"home","section":"Docs","content":" home # å½“å‰åšå®¢åœ°å€ -\u0026gt; Exfly blog\n"},{"id":1,"href":"/links/","title":"å‹é“¾","section":"","content":" draveness # Draveness\u0026rsquo;s Blogé¢å‘ä¿¡ä»°ç¼–ç¨‹ docker k8s\nèƒ¡ä¼Ÿç…Œ # èƒ¡ä¼Ÿç…Œ k8s\nzhile.io # zhile.io\n"},{"id":2,"href":"/about/","title":"å…³äº","section":"","content":" ExFly Keep It Simple \u0026amp; Stupid.\nDescription # Focusing on computer technology, has basic operating system, computer network, data structure and algorithm knowledge, good at back-end, distributed, master certain data analysis knowledge, understand basic Linux server maintenance, understand the basic maintenance of the database, understand Basic network security, convinced that technology changes the world, and hopes to have a place in the computer industry.\nSkills # Golang \u0026gt; Java \u0026gt; Python \u0026gt; others Distribution, Microservice Linux Docker DevOps k8s Project # newdb # Implement RDBMS\nwiki wor2vec # DistributedSystems-MIT6.824 # pubsub # gracefully # money # jsonrpc boilerplate # dockerc # container-lab # go-mod-helper # ucore æ“ä½œç³»ç»Ÿ # ghttp a http server written by pure c # awesome blog springboot-ssm # graphql-mongo-boilerplate # openapi boilerplate # go cache in mem # "},{"id":3,"href":"/posts/db/postgres-internal/","title":"Postgres Internal","section":"Blog","content":"Postgres å†…éƒ¨å·¥ä½œæœºåˆ¶\nä»‹ç» # TODO: Postgres ä»‹ç»\nDatabase å’Œ Tables # ä¸€ä¸ª Postgres server ä¸­ä¼šæœ‰å¤šä¸ª databaseï¼Œæ¯ä¸ª database ä¸­ä¼šæœ‰å¤šå¼  tableï¼Œæ¯ä¸ª table ä¸­ä¼šæœ‰å¤šæ¡æ•°æ®è®°å½• (tuple), æ¯ä¸ªæ•°æ®è®°å½•ä¼šæœ‰å¤šä¸ªå­—æ®µã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ¯ä¸ª database ä¸­è¿˜ä¼šæœ‰å¾ˆå¤šå…¶ä»–è¢«ç®¡ç†çš„å¯¹è±¡.\nå¤šæœ‰çš„æ•°æ®åº“å¯¹è±¡å¤šæœ‰å”¯ä¸€çš„ OID, å„æ•°æ®åº“å¯¹è±¡è¢«ä¿å­˜åœ¨å„è‡ªçš„ system catalogs ä¸­. ä¾‹å¦‚ database å’Œ heap tuple è¢«ä¿å­˜åœ¨ pg_database å’Œ pg_class ä¸­, æ‰€ä»¥å¯ä»¥é€šè¿‡å¦‚ä¸‹ sql æŸ¥è¯¢åˆ°\npostgres=# select datname, oid from pg_database where datname = \u0026#39;postgres\u0026#39;; postgres | 5 postgres=# select relname, oid from pg_class where relname=\u0026#39;actor\u0026#39;; actor | 16475 ç‰©ç†ç»“æ„ # å½“å‰æˆ‘ä»¬ä»‹ç» æ–‡ä»¶ç›®å½•å­˜å‚¨ç»“æ„ã€‚ Postgres çš„ä¸€ä¸ªæ•°æ®åº“å®ä¾‹çš„æ•°æ®å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ PGDATA ä¸­ï¼Œé€šå¸¸ PGDATA çš„å€¼ä¸º /var/lib/pgsql/dataã€‚åŒä¸€å°æœºå™¨ä¸­å¯ä»¥éƒ¨ç½²å¤šä¸ª Postgres æœåŠ¡å®ä¾‹ï¼Œä¸åŒçš„æœåŠ¡å®ä¾‹å¯ä»¥ä½¿ç”¨ä¸åŒçš„ PGDATA ä»¥åŠä¸åŒçš„ç«¯å£. PGDATA å­ç›®å½•ä¸‹åŒ…å«æ•°æ®åº“æ§åˆ¶é…ç½®æ–‡ä»¶åŠæ•°æ®æ–‡ä»¶ã€‚æ§åˆ¶æ•°æ®åº“æœåŠ¡å®ä¾‹è¿è¡Œçš„é…ç½®æ–‡ä»¶ postgresql.confã€pg_hba.conf å’Œ and pg_ident.conf é€šå¸¸æƒ…å†µä¸‹ä¹Ÿå­˜å‚¨åœ¨ PGDATA ä¸­ï¼Œä¹Ÿå¯ä»¥æŠŠå®ƒä»¬æ”¾åˆ°å…¶ä»–çš„åœ°æ–¹(å…·ä½“å¯ä»¥çœ‹ postgres å‘½ä»¤çš„å¯åŠ¨å‚æ•°æˆ–è€… pg_ctl çš„å¯åŠ¨å‚æ•°) PGDATA ä¸­çš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹:\n# tree -L 2 $PGDATA . â”œâ”€â”€ PG_VERSION â”œâ”€â”€ base â”‚ â”œâ”€â”€ 1 â”‚ â””â”€â”€ pgsql_tmp â”œâ”€â”€ global â”‚ â”œâ”€â”€ 1213 â”‚ â”œâ”€â”€ 1213_fsm â”‚ â”œâ”€â”€ 1213_vm â”‚ â”œâ”€â”€ pg_control â”‚ â”œâ”€â”€ pg_filenode.map â”‚ â””â”€â”€ pg_internal.init â”œâ”€â”€ pg_commit_ts â”œâ”€â”€ pg_dynshmem â”œâ”€â”€ pg_hba.conf â”œâ”€â”€ pg_ident.conf â”œâ”€â”€ pg_logical â”‚ â”œâ”€â”€ mappings â”‚ â”œâ”€â”€ replorigin_checkpoint â”‚ â””â”€â”€ snapshots â”œâ”€â”€ pg_multixact â”‚ â”œâ”€â”€ members â”‚ â””â”€â”€ offsets â”œâ”€â”€ pg_notify â”œâ”€â”€ pg_replslot â”œâ”€â”€ pg_serial â”œâ”€â”€ pg_snapshots â”œâ”€â”€ pg_stat â”œâ”€â”€ pg_stat_tmp â”œâ”€â”€ pg_subtrans â”‚ â””â”€â”€ 0000 â”œâ”€â”€ pg_tblspc â”œâ”€â”€ pg_twophase â”œâ”€â”€ pg_wal â”‚ â”œâ”€â”€ 000000010000000000000004 â”‚ â”œâ”€â”€ 000000010000000000000005 â”‚ â””â”€â”€ archive_status â”œâ”€â”€ pg_xact â”‚ â””â”€â”€ 0000 â”œâ”€â”€ postgresql.auto.conf â”œâ”€â”€ postgresql.conf â”œâ”€â”€ postmaster.opts â””â”€â”€ postmaster.pid https://www.postgresql.org/docs/devel/storage-file-layout.html\nItem Description PG_VERSION PostgreSQL ä¸»è¦ç‰ˆæœ¬å·çš„æ–‡ä»¶ base æ¯ä¸ªæ•°æ®åº“çš„å­ç›®å½• global ç³»ç»Ÿè¡¨, æ¯”å¦‚ pg_database pg_commit_ts äº‹åŠ¡æäº¤æ—¶é—´æˆ³æ•°æ®, Version 9.5 or later. pg_dynshmem dynamic shared memory subsystem ä½¿ç”¨çš„æ–‡ä»¶, Version 9.4 or later. pg_logical status data for logical decoding pg_multixact multitransaction status data (used for shared row locks) pg_notify LISTEN/NOTIFY status data pg_replslot replication slot data pg_serial information about committed serializable transactions pg_snapshots exported snapshots pg_stat permanent files for the statistics subsystem pg_stat_tmp temporary files for the statistics subsystem pg_subtrans subtransaction status data pg_tblspc symbolic links to tablespaces pg_twophase state files for prepared transactions pg_wal WAL (Write Ahead Log) files. It is renamed from pg_xlog in Version 10. pg_xact transaction commit status data, It is renamed from pg_clog in Version 10. postgresql.auto.conf A file used for storing configuration parameters that are set by ALTER SYSTEM postmaster.opts A file recording the command-line options the server was last started with postmaster.pid A lock file recording the current postmaster process ID (PID), cluster data directory path, postmaster start timestamp, port number, Unix-domain socket directory path (could be empty), first valid listen_address (IP address or *, or empty if not listening on TCP), and shared memory segment ID (this file is not present after server shutdown) æ•°æ®åº“å¯¹è±¡åœ¨æ–‡ä»¶å­˜å‚¨ä¸­çš„å¸ƒå±€ # è¡¨ç»“æ„å¦‚ä¸‹:\ncreate database test; CREATE TABLE sal_emp ( id int primary key, name text, pay_by_quarter integer[], schedule text[][] ); INSERT INTO sal_emp VALUES ( 1, \u0026#39;Bill\u0026#39;, \u0026#39;{10000, 10000, 10000, 10000}\u0026#39;, \u0026#39;{{\u0026#34;meeting\u0026#34;, \u0026#34;lunch\u0026#34;}, {\u0026#34;training\u0026#34;, \u0026#34;presentation\u0026#34;}}\u0026#39; ); create index sal_emp_btree ON sal_emp (pay_by_quarter); create index sal_emp_gin ON sal_emp USING gin(pay_by_quarter); databaseã€tablesã€index ç­‰æ–‡ä»¶å¸ƒå±€ # åœ¨ 9.0 ç‰ˆæœ¬ä¹‹åï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰ç™»å½•æ•°æ®åº“çš„æ•°æ®ç›®å½•\ntest=# show data_directory; data_directory --------------------------- /home/vagrant/pgdata/data (1 row) æ•°æ®åº“ä½äº base å­ç›®å½•ä¸‹ï¼Œæ•°æ®åº“ç›®å½•åå­—æ˜¯å…¶ oidã€‚ä¾‹å¦‚ test çš„ oid ä¸º 16966ï¼Œä»–çš„ç›®å½•åå­—ä¸º 16966.\ntest=# select oid,datname from pg_database; oid | datname -------+----------- 5 | postgres 16966 | test 1 | template1 4 | template0 $ ls -ld base/16966/ drwx------ 2 vagrant vagrant 12288 Sep 16 01:59 base/16966/ æ¯ä¸ªä¸è¶…è¿‡ 1GB çš„ table æˆ–è€… index å­˜å‚¨åœ¨å…¶æ‰€å±çš„ database ç›®å½•ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶ä¸‹.\ntest=# SELECT relname, oid, relfilenode FROM pg_class WHERE relname = \u0026#39;sal_emp\u0026#39;; relname | oid | relfilenode ---------+-------+------------- sal_emp | 16967 | 16967 test=# select * from pg_relation_filepath(\u0026#39;sal_emp\u0026#39;); pg_relation_filepath ---------------------- base/16966/16967 $ ls -alh base/16966/16967 -rw------- 1 vagrant vagrant 8.0K Sep 16 02:03 base/16966/16967 å½“ä¸€ä¸ª table æˆ–è€… index çš„æ–‡ä»¶å¤§å°è¶…è¿‡ 1GBï¼ŒPostgreSQL ä¼šåˆ›å»ºåå­—ç±»ä¼¼äº relfilenode.1, å¹¶ä½¿ç”¨å®ƒã€‚å¦‚æœæ–°çš„æ–‡ä»¶è¢«å¡«æ»¡äº†ï¼Œä¸‹ä¸€ä¸ªæ–°çš„æ–‡ä»¶ relfilenode.2 å°†è¢«åˆ›å»ºï¼Œä»¥æ­¤ç±»æ¨ã€‚\nls -alh base/16966/16967* -rw------- 1 vagrant vagrant 1.0G Sep 16 02:03 base/16966/16967 -rw------- 1 vagrant vagrant 1M Sep 16 02:03 base/16966/16967.1 å•ä¸ª table/index ç´¢å¼•æ–‡ä»¶å¤§å°æ˜¯å¯ä»¥é…ç½®çš„, PostgreSQL ç¼–è¯‘é€‰é¡¹æ˜¯ \u0026ndash;with-segsize.\nä»”ç»†çœ‹æ•°æ®åº“å­ç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°ä¸€äº›æ–‡ä»¶çš„åç¼€æ˜¯ _fsm å’Œ _vm. å®ƒä»¬åˆ†åˆ«æ˜¯å¯¹åº”æ–‡ä»¶çš„ free space map visibility map, åˆ†åˆ«å­˜å‚¨ç€æ¯ä¸ªæ–‡ä»¶ä¸­æ¯ä¸ª page çš„ ç©ºé—²ç©ºé—´åŠæ˜¯å¦å¯è§ã€‚indexs åªæœ‰ fsmï¼Œæ²¡æœ‰ vm.\nå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åå‘æŸ¥çœ‹æ–‡ä»¶å¯¹åº”çš„æ•°æ®åº“å¯¹è±¡\ntest=# SELECT pg_filenode_relation(0, 16967); pg_filenode_relation ---------------------- sal_emp (1 row) Tablespaces # PostgreSQL ä¸­çš„ Tablespaces æ˜¯ base ç›®å½•ä¹‹å¤–çš„é™„åŠ æ•°æ®åŒºåŸŸã€‚ è¯¥åŠŸèƒ½å·²åœ¨ 8.0 ç‰ˆæœ¬ä¸­å®ç°ã€‚\nTODO: è¡¥å……æ›´å¤šç»†èŠ‚\nHeap Table File çš„å†…éƒ¨æ–‡ä»¶æ ¼å¼ # storage-page-layout\næ•°æ®æ–‡ä»¶å†…éƒ¨å­˜å‚¨ç€å¤§é‡çš„ pages, æ¯ä¸ª page çš„å›ºå®šå¤§å°ä¸º 8192 byte(8KB)ã€‚æ¯ä¸ªæ•°æ®æ–‡ä»¶ä¸­çš„ page ä» 0 å¼€å§‹ç¼–å·ï¼Œè¿™äº›ç¼–å·å« block numbers.\npage å¤§å°å¯ä»¥æ‰§è¡Œ sql æŸ¥çœ‹, SELECT current_setting('block_size');ï¼Œå…¶å€¼å¯ä»¥åœ¨ç¼–è¯‘æ—¶æ·»åŠ å‚æ•°ä¿®æ”¹\n\u0026ndash;with-blocksize=BLOCKSIZE\neq:\n./configure --with-blocksize=BLOCKSIZE --with-wal-blocksize=BLOCKSIZE\nä¸åŒç§ç±»çš„æ–‡ä»¶çš„å†…éƒ¨å¸ƒå±€ä¸ç›¸åŒã€‚å¦‚ä¸‹ä¸º heap table file çš„æ–‡ä»¶å¸ƒå±€\nheap table ä¸­çš„ pageåŒ…å«å¦‚ä¸‹ä¸‰éƒ¨åˆ†ï¼š\nheap tuple(s): ä¸€ä¸ª heap tuple ä»£è¡¨ tables ä¸­çš„ä¸€è¡Œè®°å½•ã€‚heap tuple ä»¥æ ˆå…¥é¡ºåºæ·»åŠ åˆ° page ä¸­ï¼Œå³æ–°çš„ tuple å›è¢«æ’å…¥åˆ°æ—§çš„å‰è¾¹; line pointer(s): line pointer æŒæœ‰ tuple çš„æŒ‡é’ˆã€‚line pointer æ˜¯ä¸€ä¸ªå˜é•¿æŒ‡é’ˆï¼Œæ¯ä¸ª line pointer çš„åºå·ä» 1å¼€å§‹ï¼Œå½“æ–°çš„ tuple è¢«æ’å…¥åˆ° page ä¸­æ—¶ï¼ŒæŒ‡å‘æ–° tuple çš„ line pointer ä¹Ÿä¼šè¢«ä»æ’å…¥åˆ° line pointer æ•°ç»„çš„å°¾éƒ¨; header data: ä½äº page çš„å¼€å§‹ä½ç½®ï¼Œè®°å½•äº†å½“å‰ page çš„å…ƒæ•°æ®ã€‚å…¶è¯¦ç»†æ„æˆå®šä¹‰åœ¨ PageHeaderData ä¸­.å…¶ä¸»è¦ä¿¡æ¯å¦‚ä¸‹: pd_lsn: ä¿å­˜äº† WAL çš„ LSNï¼Œäº WAL æœºåˆ¶ç›¸å…³ï¼› pd_checksum: ä¿å­˜äº†å½“å‰ page çš„ checksumï¼› pd_lower, pd_upper: pd_lower æŒ‡å‘ linepointer çš„æœ«å°¾ï¼Œpd_upper æŒ‡å‘æœ€æ–°çš„ tuple çš„å¼€å§‹ï¼› pd_special, è¿™ä¸ªå˜é‡æ˜¯ç»™ index ä½¿ç”¨çš„ï¼Œä»–æŒ‡å‘ page çš„æœ«å°¾æœ€åä¸€ä¸ª byte lin pointer çš„æœ€ååˆ°æœ€æ–° tuple çš„å¼€å§‹æ˜¯å½“å‰ page çš„ ç©ºé—²ç©ºé—´ã€‚ tuple identifierï¼ˆTIDï¼‰å”¯ä¸€æ ‡è¯†ä¸€ä¸ª tuple. TID åŒ…å«ä¸¤ä¸ªæŒ‡ï¼Œblock number æ ‡è¯†å®ƒæ‰€åœ¨çš„ pageï¼Œoffset number æ ‡è¯†å®ƒåœ¨ page ä¸­çš„ä½ç½®. å®ƒçš„å…¸å‹ä½¿ç”¨åœºæ™¯çš„ index.\nè¿›ç¨‹æ¨¡å‹ä¸å†…å­˜æ¨¡å‹ # å¹¶å‘æ§åˆ¶ # VACUUM Processing # Buffer Manager # Write Ahead Logging (WAL) # references # The Internals of PostgreSQL for database administrators and system developers "},{"id":4,"href":"/posts/docker/docker-change-default-bridge-ip/","title":"Docker ä¿®æ”¹å†…ç½® bridge ip ä¸ç”Ÿæ•ˆ, åŸå› åŠè§£å†³åŠæ³•","section":"Blog","content":"æ–‡ç« ç®€ä»‹: docker å†…ç½® bridge çš„ ip ä¿®æ”¹æ–¹æ³•\nConfigure the default bridge network\ndocker daemon çš„é…ç½®æ–‡ä»¶ /etc/docker/daemon.json æä¾›äº†è‡ªå®šä¹‰ docker builtin bridge é…ç½®é¡¹.\n# ä¿®æ”¹ daemon.json ä¸­ \u0026#34;bip\u0026#34; { .... \u0026#34;bip: \u0026#34;100.100.1.1/24\u0026#34;, # bip: ä¿®æ”¹ builtin bridge çš„ ip \u0026#34;default-address-pools\u0026#34;:[{\u0026#34;base\u0026#34;:\u0026#34;100.100.0.0/16\u0026#34;,\u0026#34;size\u0026#34;:24}} ... } docker stop $(docker ps -qa) \u0026amp;\u0026amp; systemctl restart docker \u0026amp;\u0026amp; docker start $(docker ps -qa) æ³¨æ„:\ndocker å¦‚æœå·²ç»æœ‰å®¹å™¨åœ¨è¿è¡Œï¼Œbip çš„é…ç½®æ˜¯ä¸ä¼šç”Ÿæ•ˆã€‚é…ç½®æ·»åŠ  {\u0026quot;debug\u0026quot;: true} åä¼šæœ‰å¦‚ä¸‹æ—¥å¿—:\nJun 11 18:31:45 hostname dockerd[323728]: time=\u0026#34;2022-06-11T18:31:45.251000544+08:00\u0026#34; level=debug msg=\u0026#34;RequestPool(LocalDefault, 172.17.0.0/16, , map[], false)\u0026#34; Jun 11 18:31:45 hostname dockerd[323728]: time=\u0026#34;2022-06-22T18:31:45.251092001+08:00\u0026#34; level=debug msg=\u0026#34;RequestAddress(LocalDefault/172.17.0.0/16, 172.17.0.1, map[RequestAddressType:com.docker.network.gateway])\u0026#34; Jun 11 18:31:45 hostname dockerd[323728]: time=\u0026#34;2022-06-11T18:31:45.251140234+08:00\u0026#34; level=debug msg=\u0026#34;Request address PoolID:172.17.0.0/16 App: ipam/default/data, ID: LocalDefault/172.17.0.0/16, DBIndex: 0x0, Bits: 65536, Unselected: 65534, Sequence: (0x80000000, 1)-\u0026gt;(0x0, 2046)-\u0026gt;(0x1, 1)-\u0026gt;end Curr:0 Serial:false PrefAddress:172.17.0.1 \u0026#34; Jun 11 18:31:45 hostname dockerd[323728]: time=\u0026#34;2022-06-11T18:31:45.272456556+08:00\u0026#34; level=info msg=\u0026#34;There are old running containers, the network config will not take affect\u0026#34; è§£å†³æ–¹æ³•æ˜¯å…ˆå°†æ‰€æœ‰å¯åŠ¨çš„å®¹å™¨ stopï¼Œç„¶åé‡å¯ docker é…ç½®ç”Ÿæ•ˆåï¼Œstart å®¹å™¨\n"},{"id":5,"href":"/posts/linux/linux_network/","title":"Linux Network å¦‚ä½•é…ç½®åŠå·¥ä½œåŸç†","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šLinux Network æ˜¯å¦‚ä½•ä½¿ç”¨åŠå·¥ä½œçš„\nLinux Network éå¸¸å¤æ‚ï¼Œå…¶æœ¬èº«çš„æœºåˆ¶éå¸¸å¤æ‚ï¼Œæ¯ä¸€ç§ Linux å‘è¡Œç‰ˆçš„ç½‘ç»œä¹Ÿæœ‰å·®åˆ«ï¼Œç®¡ç†å·¥å…·ä¹Ÿçº·ç¹å¤æ‚ã€‚è¿™é‡Œå…ˆç®€å•çš„æè¿°åœ¨ Centos7 å’Œ Ubuntu20.04 ä¸‹å¦‚ä½•é…ç½®ç½‘ç»œï¼Œåç®€å•çš„æè¿°ä¸€ä¸‹ network æ˜¯æ€æ ·å·¥ä½œçš„.\nCentos6 ä½¿ç”¨ network.service Centos7 network.service å’Œ NetworkManager.service å¹¶å­˜ Centos8 ä¹‹ååªä½¿ç”¨ NetworkManager.service Ubuntu ä½¿ç”¨ netplan å‰ç«¯ï¼ŒNetworkManager/networkd åç«¯ Linux ç½‘ç»œè®¾å¤‡ # TODO: ç½‘ç»œè®¾å¤‡æ¶æ„\nTODO: ç½‘ç»œæ¥å£å‘½å\nnetwork.service ä½¿ç”¨æ–¹æ³• # ä¿®æ”¹ /etc/sysconfig/network-scripts ä¸‹çš„ ifcfg-*æ–‡ä»¶ï¼Œä¹‹åæ‰§è¡Œ service network restartï¼Œé…ç½®å³å¯ç”Ÿæ•ˆã€‚\næ³¨æ„: ç½‘ç»œé…ç½®ä¿®æ”¹å¯èƒ½ä¼šåœæ‰å½“å‰çš„ ssh è¿æ¥\nåŸç†ï¼š network.service ä¼šæ‰§è¡Œ /etc/rc.d/init.d/network start å¯åŠ¨ç½‘ç»œæœåŠ¡ï¼Œå¯åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ ip å‘½ä»¤å¯åŠ¨å„ deviceï¼Œä½¿ç”¨ route é…ç½®ç³»ç»Ÿè·¯ç”±ï¼Œä½¿ç”¨ sysctl é…ç½®ç­‰ã€‚\nNetworkNanager ä½¿ç”¨æ–¹æ³• # Managing IP Networking åŒ…å«ä¼˜ç‚¹åŠå¦‚ä½•ä½¿ç”¨\nD-Bus çš„ unix socket: /var/run/dbus/system_bus_socket\nudev é…ç½®: /etc/udev/udev.conf\né…ç½®æ–‡ä»¶ç›®å½•\n/etc/NetworkManager /etc/sysconfig/network-scripts å‘½ä»¤\nsystemctl restart NetworkManager.service # é‡å¯æœåŠ¡ journalctl -u NetworkManager.service -f -n 100 # æŸ¥çœ‹æ—¥å¿— # æŸ¥è¯¢è¿æ¥ä¿¡æ¯ nmcli conn # æ·»åŠ è¿æ¥ nmcli conn add type ethernet con-name eth0-static ifname eth0 ipv4.method manual ipv4.addresses \u0026#34;10.0.2.16/24\u0026#34; ipv4.gateway 10.0.2.2 ipv4.dns 114.114.114.114 ipv6.method auto # ä¿®æ”¹è¿æ¥ nmcli conn modify eth0-static ipv4.method manual ipv4.addresses 10.0.2.254/24 ipv4.gateway 10.0.2.2 # interactive edit connection nmcli conn edit \u0026lt;conn-name\u0026gt; # ç³»ç»Ÿ link(è®¾å¤‡) nmcli dev # é‡æ–°åº”ç”¨é…ç½® nmcli dev reapply eth0 # TUI nmtui æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ nmcli é…ç½®ç½‘ç»œï¼Œå½“å‡ºç°é”™è¯¯çš„æ—¶å€™ï¼Œé€šè¿‡ journalctl æŸ¥çœ‹æ—¥å¿—ï¼Œåˆ†æé…ç½®é”™è¯¯åŸå› ï¼Œç»§ç»­ä½¿ç”¨ nmcli é…ç½®ç½‘ç»œï¼Œç›´åˆ°ç½‘ç»œæœåŠ¡é…ç½®å¥½.\nNetworkNanager å·¥ä½œåŸç† # NetworkNanager æœ‰ä¸¤ä¸ªç»„ä»¶:\nNetworkManager daemon, ç®¡ç†è¿æ¥å’Œç›‘å¬å¹¶æŠ¥å‘Šç½‘ç»œå˜åŒ– ä¸€äº›ç®¡ç†å‰ç«¯ï¼ˆfront-endsï¼‰, æ¯”å¦‚ nmcli,ä¸€äº› GUI ç¨‹åºç­‰ NetworkManager daemon ä¾èµ–äº D-Bus, å®ç°äº†ç®¡ç†è¿æ¥çš„æ¥å£ï¼Œåº•å±‚ä½¿ç”¨ netlink è·Ÿ linux å†…æ ¸äº¤äº’ï¼Œè·å¾—è®¾å¤‡ä¿¡æ¯ï¼Œé…ç½®è¿æ¥ï¼ˆæ¯”å¦‚ä¿®æ”¹ ipv4 çš„åœ°å€ç­‰ï¼‰ã€‚nmcli è·Ÿ D-Bus äº¤äº’è¿æ¥ NetworkManager daemonï¼Œè·å¾—ä¿¡æ¯ä»¥åŠé…ç½®ç½‘ç»œ\n# ip å‘½ä»¤ä¹Ÿæ˜¯ä½¿ç”¨ netlink è·Ÿ kernel äº¤äº’çš„ strace -fff ip a socket(AF_NETLINK, SOCK_RAW|SOCK_CLOEXEC, NETLINK_ROUTE) = 3 sendto(3, {{len=40, type=RTM_GETLINK, flags=NLM_F_REQUEST|NLM_F_DUMP, seq=1641054708, pid=0}, {ifi_family=AF_UNSPEC, ifi_type=ARPHRD_NETROM, ifi_index=0, ifi_flags=0, ifi_change=0}, {{nla_len=8, nla_type=IFLA_EXT_MASK}, 1}}, 40, 0, NULL, 0) = 40 recvmsg(3, {msg_name={sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, msg_namelen=12, msg_iov=[{iov_base=NULL, iov_len=0}], msg_iovlen=1, msg_controllen=0, msg_flags=MSG_TRUNC}, MSG_PEEK|MSG_TRUNC) recvmsg(3, {msg_name={sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000} sendto(3, {{len=40, type=RTM_GETADDR, flags=NLM_F_REQUEST|NLM_F_DUMP, seq=1641054709, pid=0}, {ifa_family=AF_UNSPEC, ifa_prefixlen=0, ifa_flags=0, ifa_scope=RT_SCOPE_UNIVERSE, ifa_index=0}, {nla_len=0, nla_type=IFA_UNSPEC}}, 40, 0, NULL, 0) = 40 recvmsg(3, {msg_name={sa_family=AF_NETLINK, nl_pid=0, nl_groups=00000000}, msg_namelen=12, msg_iov=[{iov_base=NULL, iov_len=0}], msg_iovlen=1, msg_controllen=0, msg_flags=MSG_TRUNC}, MSG_PEEK|MSG_TRUNC) TODO: ç®€å•çš„ demo ä½¿ç”¨ netlink è·å¾— ip åœ°å€å’Œé…ç½® ip åœ°å€ netlink-demo\nNetworkNanager å’Œ network.service å¦‚ä½•å¹¶å­˜ # TODO:\nnetplan # The network configuration abstraction renderer\nnetplan æ˜¯ä¸€ä¸ªæ–¹ä¾¿åœ¨ linux ç³»ç»Ÿä¸‹é…ç½®ç½‘ç»œçš„å·¥å…·ã€‚æˆ‘ä»¬é€šè¿‡ yaml æ–‡ä»¶æè¿°ç½‘ç»œé…ç½®ï¼Œ\u0008netplan ä¼šä¸ºæˆ‘ä»¬ç”Ÿæˆæˆ‘ä»¬é€‰æ‹©çš„ç½‘ç»œåç«¯æ‰€éœ€è¦çš„é…ç½®ã€‚å½“å‰æ”¯æŒåç«¯ Systemd-networkd(default) å’Œ NetworkManager. Ubuntu 20.04 ä½¿ç”¨ netplan ä½œä¸ºç½‘ç»œé…ç½®å·¥å…·.\né…ç½®æ–‡ä»¶åœ¨ ls /{lib,etc,run}/netplan/*.yaml.\nls /etc/netplan\nnetplan design\nnetplan reference\nls /{lib,etc,run}/netplan/*.yaml # é…ç½®æ–‡ä»¶ä½ç½® netplan generate # ç”Ÿæˆé…ç½® ls /run/systemd/network/ ip a # å„æ¥å£ä¿¡æ¯ lshw -class network # ç¡¬ä»¶æ›´è¯¦ç»†çš„ä¿¡æ¯ ethtool enp0s3 # ä¿®æ”¹é…ç½® /etc/netplan/*.yaml netplan try # æµ‹è¯•æ˜¯å¦ç”Ÿæ•ˆ netplan apply # åº”ç”¨é…ç½® resolvectl status # resolve name netplan ä¸€äº›é€šç”¨çš„é…ç½®æ¨¡ç‰ˆ\nnetplan é…ç½® dhcp è‡ªåŠ¨è·å– ip\ncat /etc/netplan/50-cloud-init.yaml # This file is generated from information provided by the datasource. Changes # to it will not persist across an instance reboot. To disable cloud-init\u0026#39;s # network configuration capabilities, write a file # /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following: # network: {config: disabled} network: ethernets: enp0s3: dhcp4: true match: macaddress: 02:f6:7f:02:5c:72 set-name: enp0s3 version: 2 netplan é…ç½® static ip:\nnetwork: version: 2 ethernets: enp0s3: match: macaddress: 02:f6:7f:02:5c:72 addresses: - 10.10.10.2/24 gateway4: 10.10.10.1 set-name: enp0s3 nameservers: search: [mydomain, otherdomain] addresses: [10.10.10.1, 1.1.1.1] routes: - to: default via: 10.10.10.1 # netplan generate --root-dir /vagrant Name resolve\n# /run/systemd/resolve/stub-resolv.conf man 8 systemd-resolved systemd-resolve --statistics # resolve æœåŠ¡ systemd-resolve --reset-statistics # é‡ç½®ç»Ÿè®¡ä¿¡æ¯ systemctl restart systemd-resolved # é‡å¯ ubuntu resolved æœåŠ¡ resolvectl flush-caches # flush dns cache (old: systemd-resolve --flush-caches) # flush dns cache # https://www.linuxuprising.com/2019/07/how-to-flush-dns-cache-on-linux-for.html æ€»ç»“ # ç½‘ç»œé…ç½®æœ€ç»ˆéƒ½æ˜¯è·Ÿå†…æ ¸ç”¨ netlink æ²Ÿé€šï¼Œå‘Šè¯‰ \u0008linux å†…æ ¸ç½‘ç»œé…ç½®ï¼Œç”± kernel ç”Ÿæ•ˆå¹¶å·¥ä½œã€‚ç”¨æˆ·æ€ç®¡ç†ç¨‹åºå…¸å‹ä»£è¡¨ï¼š NetworkManager å’Œ systemd-networkdã€‚ç†Ÿæ‚‰äº†è¿™äº›ï¼Œä¾¿æœ‰äº†æ‰‹æ®µæŒ‡æŒ¥ linux kernel ç½‘ç»œå¦‚ä½•å·¥ä½œã€‚å‰©ä¸‹çš„å°±éœ€è¦æˆ‘ä»¬æ…¢æ…¢äº†è§£å’Œå­¦ä¹  linux ç½‘ç»œæä¾›äº†å“ªäº›åŠŸèƒ½ã€‚\nref # network_configuration linux kernel network docs Netplan configuration examples "},{"id":6,"href":"/posts/linux/boot_script/","title":"Linux å¼€æœºè‡ªå¯åŠ¨è„šæœ¬æœºå™¨å®ç°åŸç†","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šlinux è®¾ç½®å¼€æœºè‡ªå¯åŠ¨è„šæœ¬çš„å‡ ç§æ–¹å¼\nrc.local # ä½¿ç”¨æ–¹æ³• # # æ–‡ä»¶ /etc/rc.d/rc.local # centos æˆ–è€…å·²ç»é…ç½®è¿‡æ­¤æ–‡ä»¶ echo \u0026#34;echo \u0026#39;do HelloWord\u0026#39;\u0026#34; \u0026gt;\u0026gt; /etc/rc.local # å·²ç»æœ‰è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™ # ubuntu æ²¡æœ‰ /etc/rc.localï¼Œéœ€è¦åˆ›å»ºæ–‡ä»¶ï¼Œæ­£ç¡®çš„é…ç½® shebang printf \u0026#39;%s\\n\u0026#39; \u0026#39;#!/bin/bash\u0026#39; \u0026#39;exit 0\u0026#39; | sudo tee -a /etc/rc.local # æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™ # Please note that you must run \u0026#39;chmod +x /etc/rc.d/rc.local\u0026#39; to ensure # that this script will be executed during boot. chmod +x /etc/rc.local systemctl enable --now rc-local systemctl status rc-local.service å·¥ä½œåŸç† # systemctl cat rc-local.service [Unit] Description=/etc/rc.local Compatibility Documentation=man:systemd-rc-local-generator(8) ConditionFileIsExecutable=/etc/rc.local After=network.target [Service] Type=forking ExecStart=/etc/rc.local start TimeoutSec=0 RemainAfterExit=yes GuessMainPID=no å¯ä»¥çœ‹åˆ°ï¼Œ\u0008ConditionFileIsExecutable=/etc/rc.localï¼Œå½“ /etc/rc.local å¯æ‰§è¡Œçš„æ—¶å€™ï¼Œsystemd æ‹‰èµ·æœåŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæ‰§è¡Œ /etc/rc.local.\ncrontab reboot # echo \u0026#39;@reboot /root/helloworld.sh\u0026#39; \u0026gt;\u0026gt; /etc/crontab crontab /etc/crontab crontab -e @reboot /root/helloworld.sh "},{"id":7,"href":"/posts/linux/systemd/","title":"Systemd ç®€å•ä»‹ç»ï¼Œä½¿ç”¨åŠå¦‚ä½• Debug","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šå­¦ä¹  systemd ç¬”è®°\nLinux çš„å¯åŠ¨ å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡‡ç”¨ init è¿›ç¨‹ã€‚init æ˜¯ç³»ç»Ÿå¯åŠ¨åçš„ç¬¬ä¸€ä¸ªç”¨æˆ·çº§ç¨‹åºï¼Œpid=1.\ninit ç¨‹åºæœ‰ä¸¤ä¸ªç¼ºç‚¹:\nå¯åŠ¨æ—¶é—´é•¿ã€‚init è¿›ç¨‹æ˜¯ä¸²è¡Œå¯åŠ¨ï¼Œåªæœ‰å‰ä¸€ä¸ªè¿›ç¨‹å¯åŠ¨å®Œï¼Œæ‰ä¼šå¯åŠ¨ä¸‹ä¸€ä¸ªè¿›ç¨‹; å¯åŠ¨è„šæœ¬å¤æ‚ã€‚init è¿›ç¨‹åªæ˜¯æ‰§è¡Œå¯åŠ¨è„šæœ¬ï¼Œä¸ç®¡å…¶ä»–äº‹æƒ…ã€‚è„šæœ¬éœ€è¦è‡ªå·±å¤„ç†å„ç§æƒ…å†µï¼Œè¿™å¾€å¾€ä½¿å¾—è„šæœ¬å˜å¾—å¾ˆé•¿; ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ Lennart Poettering è®¾è®¡äº† systemdã€‚\nsystemd æ˜¯ Linux ç”µè„‘æ“ä½œç³»ç»Ÿä¹‹ä¸‹çš„ä¸€å¥—ä¸­å¤®åŒ–ç³»ç»ŸåŠè®¾ç½®ç®¡ç†ç¨‹åºï¼ˆinitï¼‰ï¼ŒåŒ…æ‹¬æœ‰å®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰ã€ç¨‹åºåº“ä»¥åŠåº”ç”¨è½¯ä»¶.å·²çŸ¥çš„ä¸»æµ Linux å‘è¡Œç‰ˆéƒ½æŠŠ systemd ä½œä¸º init. systemd è¿˜é™„å¸¦å¾ˆå¤šåŸºç¡€å·¥å…·ï¼ŒåŒ…æ‹¬ timesync, hostnamectl ç­‰ä¸€ç³»åˆ—ç®¡ç†ç³»ç»Ÿçš„å·¥å…·ã€‚å…·ä½“ä½¿ç”¨æ–¹æ³• è¿™é‡Œ å·²ç»è®²äº†å¾ˆå¤šï¼Œåœ¨è¿™é‡Œä¸å†èµ˜è¿°ã€‚\nsystemd ä½¿ç”¨æƒ…å†µå¦‚ä¸‹:\nç³»ç»Ÿ ç‰ˆæœ¬ å¤‡æ³¨ Ubuntu 15.04 åŠåç»­ç‰ˆæœ¬ 1 Debian GNU/Linux Debian 8â€œJessieâ€ä¹‹å Red Hat åŠå…¶æ´¾ç”Ÿå“ 7 åŠåç»­ç‰ˆæœ¬ Fedora 15 åŠåç»­ç‰ˆæœ¬ å¦‚ä½• debug # systemctl æä¾›äº†ä¸€äº›å·¥å…·ç”¨äº debugã€‚\nsystemctl cat multi-user.service # æŸ¥çœ‹ unit é…ç½® systemctl show multi-user.service # æ˜¾ç¤ºæŸä¸ª Unit çš„æ‰€æœ‰åº•å±‚å‚æ•° systemctl show -p CPUShares multi-user.service # è®¾ç½®æŸä¸ª Unit çš„æŒ‡å®šå±æ€§ systemctl list-dependencies --all multi-user.service # åˆ—å‡ºä¾èµ–é¡¹ systemctl list-dependencies --all multi-user.service # åˆ—å‡ºä¾èµ–é¡¹ systemd-analyze critical-chain # cli æ˜¾ç¤ºç€‘å¸ƒçŠ¶çš„å¯åŠ¨è¿‡ç¨‹æµ systemd-analyze blame # åˆ†æå½“å‰ç³»ç»Ÿå„é¡¹æœåŠ¡å¯åŠ¨æ—¶é—´ systemd-analyze plot \u0026gt; boot.svg # åˆ†æå½“å‰ç³»ç»Ÿå„é¡¹æœåŠ¡å¯åŠ¨é¡ºåº ls /etc/systemd/system/ # ä¿®æ”¹ unit æ–‡ä»¶ # é‡æ–°åŠ è½½ service ä¿¡æ¯ # systemd ä¼šå°†æ‰€æœ‰ unit ä¿¡æ¯ç¼“å­˜åœ¨å†…å­˜ï¼Œåªæœ‰é‡æ–°åŠ è½½ï¼Œä¿®æ”¹å†…å®¹æ‰ä¼šç”Ÿæ•ˆ systemctl daemon-reload journalctl -u ssh.service -f # æŸ¥çœ‹ unit æ—¥å¿— ref # Systemd å…¥é—¨æ•™ç¨‹ï¼šå‘½ä»¤ç¯‡ Linux çš„å¯åŠ¨æµç¨‹ "},{"id":8,"href":"/posts/Go/go-scheduler/","title":"Go Scheduler","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šgolang scheduler ç›¸å…³çš„å†…å®¹\nç®€ä»‹ # ç°åœ¨ä¸»æµçš„çº¿ç¨‹æ¨¡å‹åˆ†ä¸‰ç§ï¼šå†…æ ¸çº§çº¿ç¨‹æ¨¡å‹ã€ç”¨æˆ·çº§çº¿ç¨‹æ¨¡å‹å’Œä¸¤çº§çº¿ç¨‹æ¨¡å‹ï¼ˆä¹Ÿç§°æ··åˆå‹çº¿ç¨‹æ¨¡å‹ï¼‰ï¼Œä»–ä»¬éƒ½å¾ˆå¤æ‚ã€‚golang å±äº ä¸¤çº§çº¿ç¨‹æ¨¡å‹ï¼Œæ˜¯ç”± goroutine å®ç°çš„, goroutine æ˜¯ golang æœ€é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå…·æœ‰ä½¿ç”¨æˆæœ¬ä½ã€æ¶ˆè€—èµ„æºä½ã€èƒ½æ•ˆé«˜ç­‰ç‰¹ç‚¹ï¼Œå®˜æ–¹å®£ç§°åŸç”Ÿ goroutine å¹¶å‘æˆåƒä¸Šä¸‡ä¸æˆé—®é¢˜. CSP(é€šä¿¡é¡ºåºè¿›ç¨‹) æ˜¯ golang ä¸­çš„å¹¶å‘æ¨¡å‹ã€‚æœ¬ç‰‡æ–‡æ¡£å°†å¸¦é¢†è¯»è€…æ·±å…¥ç†è§£ golang çš„ goroutine çš„å·¥ä½œæ–¹å¼ã€‚\nstack å¤§å°ï¼š\ngoroutineï¼š2KB çº¿ç¨‹ï¼š8MB çº¿ç¨‹åˆ‡æ¢éœ€è¦é™·å…¥å†…æ ¸ï¼›goroutine åªéœ€è¦ getcontext å’Œ setcontextï¼Œ30+ ä¸ªå¯„å­˜å™¨çš„è¯»åˆå†™ï¼Œéå¸¸å¿«é€Ÿ\ncoroutine çš„å·¥ä½œæ–¹å¼ # è¯´åˆ° goroutineï¼Œå°±ä¸å¾—ä¸è¯´ä¸€ä¸‹ coroutineã€‚goroutine æ˜¯coroutine åœ¨ golang ä¸­çš„å®ç°å’Œä¼˜åŒ–ã€‚golang ä½œè€…ä¹‹ä¸€ Russ Cox æœ‰å®ç°è½»é‡çš„ libtask ï¼Œ400 è¡Œå·¦å³ä»£ç æè¿°æ¸…æ¥šäº† coroutine æ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚\nå»ºè®®äº²è‡ªä¸‹è½½ä»£ç ï¼Œçœ‹ä¸€ä¸‹å…·ä½“çš„å®ç°é€»è¾‘, éœ€è¦æ¯”è¾ƒç®€å•çš„ c åŸºç¡€\nä¸€ä¸ª coroutine æ¯”è¾ƒæ ¸å¿ƒçš„å·¥ä½œåŒ…æ‹¬ï¼š\ntask ç®¡ç†, åŒ…æ‹¬åˆ›å»ºï¼Œé”€æ¯ï¼Œåˆ‡æ¢ç­‰ coroutine è°ƒåº¦ç®—æ³• å…ˆçœ‹ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ä¾‹å­:\n// https://github.com/mixinlib/libtask/blob/651d7b69a4f7b10c798dcd544e6a25fd7505632c/primes.c#L12 void primetask(void *arg) { Channel *c, *nc; int p, i; c = arg; p = chanrecvul(c); if(p \u0026gt; goal) taskexitall(0); if(!quiet) printf(\u0026#34;%d\\n\u0026#34;, p); nc = chancreate(sizeof(unsigned long), buffer); taskcreate(primetask, nc, 32768); for(;;){ i = chanrecvul(c); if(i%p) chansendul(nc, i); } } void taskmain(int argc, char **argv) { int i; Channel *c; if(argc\u0026gt;1) goal = atoi(argv[1]); else goal = 100; printf(\u0026#34;goal=%d\\n\u0026#34;, goal); c = chancreate(sizeof(unsigned long), buffer); taskcreate(primetask, c, 32768); // åˆ›å»º coroutineï¼Œå¼€å§‹æ‰§è¡Œä»»åŠ¡ primetask for(i=2;; i++) chansendul(c, i); } ä¼šå‘ç°ç¨‹åºä¸­æ²¡æœ‰å¸¸è§çš„ c main å‡½æ•°ï¼Œå®é™…æ˜¯åœ¨ libtask ä¸­å®ç°äº†ã€‚æ•´ä¸ªç¨‹åºæ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œmain ä¸­åˆ›å»ºäº†ç¬¬ä¸€ä¸ª taskï¼Œå¹¶å¯åŠ¨ task è°ƒåº¦å™¨\n// https://github.com/mixinlib/libtask/blob/main/task.c#L353 static void taskmainstart(void *v) { taskname(\u0026#34;taskmain\u0026#34;); taskmain(taskargc, taskargv); } int main(int argc, char **argv) { struct sigaction sa, osa; memset(\u0026amp;sa, 0, sizeof sa); sa.sa_handler = taskinfo; sa.sa_flags = SA_RESTART; sigaction(SIGQUIT, \u0026amp;sa, \u0026amp;osa); #ifdef SIGINFO sigaction(SIGINFO, \u0026amp;sa, \u0026amp;osa); #endif argv0 = argv[0]; taskargc = argc; taskargv = argv; if(mainstacksize == 0) mainstacksize = 256*1024; taskcreate(taskmainstart, nil, mainstacksize); taskscheduler(); // task è°ƒåº¦å™¨å¯åŠ¨ fprint(2, \u0026#34;taskscheduler returned in main!\\n\u0026#34;); abort(); return 0; } \u0008è°ƒåº¦å™¨çš„å·¥ä½œæ˜¯ä» runnable_queue ä¸­è·å¾—ä¸€ä¸ªå¯æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç„¶ååˆ‡æ¢è¿‡å»\nstatic void taskscheduler(void) { int i; Task *t; taskdebug(\u0026#34;scheduler enter\u0026#34;); for(;;){ if(taskcount == 0) exit(taskexitval); t = taskrunqueue.head; if(t == nil){ fprint(2, \u0026#34;no runnable tasks! %d tasks stalled\\n\u0026#34;, taskcount); exit(1); } deltask(\u0026amp;taskrunqueue, t); t-\u0026gt;ready = 0; taskrunning = t; tasknswitch++; taskdebug(\u0026#34;run %d (%s)\u0026#34;, t-\u0026gt;id, t-\u0026gt;name); contextswitch(\u0026amp;taskschedcontext, \u0026amp;t-\u0026gt;context); //print(\u0026#34;back in scheduler\\n\u0026#34;); taskrunning = nil; if(t-\u0026gt;exiting){ if(!t-\u0026gt;system) taskcount--; i = t-\u0026gt;alltaskslot; alltask[i] = alltask[--nalltask]; alltask[i]-\u0026gt;alltaskslot = i; free(t); } } } coroutine æ˜¯å¦‚ä½•åˆ‡æ¢çš„å‘¢ï¼Ÿç”±è®¡ç®—æœºçš„å·¥ä½œåŸç†çŸ¥é“ï¼Œç¨‹åºçš„æ‰§è¡Œæ˜¯æ ¹æ® pc å¯„å­˜å™¨ä¸­çš„ä½ç½®å–æŒ‡ä»¤æ‰§è¡Œçš„ï¼Œæ‰§è¡Œ task éœ€è¦ stack å’Œå¯„å­˜å™¨ã€‚å¯„å­˜å™¨ä¸­çš„æ•°æ®å°±æ˜¯ä¸€ä¸ª coroutine çš„ ä¸Šä¸‹æ–‡ï¼Œè®°å½•ä¸‹æ¥ï¼Œset æˆå…¶ä»–çš„ ä¸Šä¸‹æ–‡çš„ å¯„å­˜å™¨çš„å€¼ï¼Œå³å¯è¾¾åˆ°åˆ‡æ¢ coroutine çš„ç›®çš„ã€‚ç”±äºä¸åŒå¹³å°çš„å¯„å­˜å™¨ä¸åŒï¼ŒæŒ‡ä»¤é›†ä¸åŒï¼Œéœ€è¦åŒºåˆ†å¹³å°åšä¸åŒçš„äº‹æƒ…:\n// linux x86 å¹³å°çš„æŒ‡ä»¤ // https://github.com/mixinlib/libtask/blob/651d7b69a4f7b10c798dcd544e6a25fd7505632c/asm.S#L43 #ifdef NEEDX86CONTEXT .globl SET SET: movl\t4(%esp), %eax movl\t8(%eax), %fs movl\t12(%eax), %es movl\t16(%eax), %ds movl\t76(%eax), %ss movl\t20(%eax), %edi movl\t24(%eax), %esi movl\t28(%eax), %ebp movl\t36(%eax), %ebx movl\t40(%eax), %edx movl\t44(%eax), %ecx movl\t72(%eax), %esp pushl\t60(%eax)\t/* new %eip */ movl\t48(%eax), %eax ret .globl GET GET: movl\t4(%esp), %eax movl\t%fs, 8(%eax) movl\t%es, 12(%eax) movl\t%ds, 16(%eax) movl\t%ss, 76(%eax) movl\t%edi, 20(%eax) movl\t%esi, 24(%eax) movl\t%ebp, 28(%eax) movl\t%ebx, 36(%eax) movl\t%edx, 40(%eax)\tmovl\t%ecx, 44(%eax) movl\t$1, 48(%eax)\t/* %eax */ movl\t(%esp), %ecx\t/* %eip */ movl\t%ecx, 60(%eax) leal\t4(%esp), %ecx\t/* %esp */ movl\t%ecx, 72(%eax) movl\t44(%eax), %ecx\t/* restore %ecx */ movl\t$0, %eax ret #endif // c ä¸­çš„ Context struct Context { ucontext_t\tuc; }; åˆ°æ­¤ï¼Œç”¨æˆ·çº§ task( coroutine )åˆ‡æ¢/è°ƒåº¦/è¿è¡Œå·¥ä½œåŸºæœ¬å¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚\næ€»ç»“ä¸€ä¸‹ï¼š coroutine æ˜¯å•çº¿ç¨‹ç¨‹åºï¼Œå¯ä»¥ä¸²è¡Œçš„è·‘å¤šä¸ªä»»åŠ¡ï¼›å¤šä¸ªä»»åŠ¡é€šè¿‡ä¸€ä¸ª scheduler task åˆ‡æ¢ï¼›åˆ‡æ¢çš„æ–¹å¼æ˜¯é€šè¿‡æ›¿æ¢cpuçš„å¯„å­˜å™¨å®ç°çš„ï¼›åˆ‡æ¢çš„è¿‡ç¨‹ os kernel æ˜¯ä¸çŸ¥é“çš„; ç”±äº context switch åªæ˜¯æ‰§è¡Œ 30+ ä¸ªæ±‡ç¼–æŒ‡ä»¤ï¼Œï¼ˆos context switch éœ€è¦è‡³å°‘ä¸¤æ¬¡ context switchï¼Œä»¥åŠä¸€äº›çŠ¶æ€ç»´æŠ¤ï¼Œç›¸æ¯”è¾ƒæ¥è¯´ï¼‰å¼€é”€æ›´å°ï¼Œcpu çš„åˆ©ç”¨ç‡ä¼šæé«˜ä¸å°‘ï¼›ä½¿ç”¨åŒæ­¥çš„æ–¹å¼å†™å‡ºå¯ä»¥å¼‚æ­¥æ‰§è¡Œçš„ä»£ç ï¼Œç¬¦åˆäººçš„æ™®éæ€è€ƒæ–¹å¼ã€‚\nchannel çš„å·¥ä½œæ–¹å¼ # è¿™ä¸€èŠ‚å†…å®¹å’Œåç¨‹æœºç†æ²¡æœ‰ç›´æ¥è”ç³»ï¼Œä½†æ˜¯å› ä¸ºchannelæ€»æ˜¯ä¼´éšç€goroutineå‡ºç°ï¼Œæ‰€ä»¥æˆ‘ä»¬ é¡ºä¾¿äº†è§£ä¸€ä¸‹channelçš„åŸç†ä¹Ÿé¢‡æœ‰å¥½å¤„ã€‚å¹¸è¿çš„æ˜¯ï¼Œlibtask ä¸­ä¹Ÿæä¾›äº†channelçš„å‚è€ƒå®ç°.\nchannel åˆ†ä¸ºæœ‰ buf å’Œ æ—  buf channel\nå¯¹äºæ—  buf çš„ channel # \u0008\u0008æŸä¸€ä¸ª task æ‰§è¡Œ chansendul ä¼šç›´æ¥å°†å½“å‰ task åŠ å…¥ channel çš„ send é˜Ÿåˆ—ä¸­ï¼Œç„¶åè§¦å‘ä¸€æ¬¡ context switchã€‚\u0008ç”±äºæ­¤æ—¶ channel çš„ task å·²ç»ä¸åœ¨ taskrunqueue ä¸­ï¼Œå‘é€æ•°æ®åˆ° channel çš„ task ä¸ä¼šå†è¢« taskscheduler è°ƒåº¦åˆ°ï¼Œç›´åˆ° chanrecvul task è¢«è°ƒåº¦ï¼Œä¸”æ¶ˆè´¹ channel ä¸­çš„æ•°æ®ï¼Œæ­¤æ—¶ å‘é€ç«¯ task é‡æ–°è¢«æ”¾åˆ°å¯æ‰§è¡Œé˜Ÿåˆ—ä¸­ã€‚\nå¯¹äº æœ‰ buf çš„ channel # æŸä¸€ä¸ª task æ‰§è¡Œ chansendulï¼Œå¦‚æœ channel buf æ²¡æœ‰æ»¡ï¼Œåˆ™ä¼šå°†æ•°æ®å¤åˆ¶åˆ° channel buf ä¸­ï¼Œtask ä¼šç»§ç»­æ‰§è¡Œã€‚ å¦‚æœ channel buf å·²æ»¡ï¼Œä¼šå°† send task è¿› channel send ç­‰å¾…é˜Ÿåˆ—ï¼Œå¹¶è®©å‡º cpuã€‚ chanrecvul task æ¥å—æ•°æ®æ—¶å€™ï¼Œå¦‚æœ channel buf ä¸ä¸ºç©ºï¼Œåˆ™ä¼šç›´æ¥æ¶ˆè´¹ buf ä¸­çš„æ•°æ®ï¼›å¦‚æœ buf ä¸ºç©ºï¼Œåˆ™ä¼š åŠ å…¥ channel çš„ recv ç­‰å¾…é˜Ÿåˆ—ï¼Œå¹¶è®©å‡º cpuï¼Œç›´åˆ°æœ‰æ–°çš„æ•°æ®è¢«send åˆ° channel ä¸ºæ­¢ã€‚\ngolang goroutine å·¥ä½œæ–¹å¼ # äº†è§£äº†ä¼ ç»Ÿ coroutine çš„å®ç°æ–¹å¼ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ golang çš„ goroutine çš„å·¥ä½œæ–¹å¼.\ngolang å®ç°äº†ä¸€ç§å«åš å·¥ä½œçªƒå–ä»»åŠ¡è°ƒåº¦.\nå…·ä½“çš„åŠŸèƒ½ä»‹ç»è§: [ç¿»è¯‘]The Go scheduler å…·ä½“çš„æ›´è¯¦ç»†çš„æºç åˆ†æè§ï¼š Go è°ƒåº¦å™¨\nåŸºæœ¬çš„ç»„æˆå…ƒç´ å’Œå·¥ä½œæ–¹å¼ # Gã€Pã€M\nG: è¡¨ç¤º Goroutineï¼Œæ¯ä¸ª Goroutine å¯¹åº”ä¸€ä¸ª G ç»“æ„ä½“ï¼ŒG å­˜å‚¨ Goroutine çš„è¿è¡Œå †æ ˆã€çŠ¶æ€ä»¥åŠä»»åŠ¡å‡½æ•°ï¼Œå¯é‡ç”¨ã€‚G å¹¶éæ‰§è¡Œä½“ï¼Œæ¯ä¸ª G éœ€è¦ç»‘å®šåˆ° P æ‰èƒ½è¢«è°ƒåº¦æ‰§è¡Œã€‚ P: Processorï¼Œè¡¨ç¤ºé€»è¾‘å¤„ç†å™¨ï¼Œ å¯¹ G æ¥è¯´ï¼ŒP ç›¸å½“äº CPU æ ¸ï¼ŒG åªæœ‰ç»‘å®šåˆ° P(åœ¨ P çš„ local runq ä¸­)æ‰èƒ½è¢«è°ƒåº¦ã€‚å¯¹ M æ¥è¯´ï¼ŒP æä¾›äº†ç›¸å…³çš„æ‰§è¡Œç¯å¢ƒ(Context)ï¼Œå¦‚å†…å­˜åˆ†é…çŠ¶æ€(mcache)ï¼Œä»»åŠ¡é˜Ÿåˆ—(G)ç­‰ï¼ŒP çš„æ•°é‡å†³å®šäº†ç³»ç»Ÿå†…æœ€å¤§å¯å¹¶è¡Œçš„ G çš„æ•°é‡ï¼ˆå‰æï¼šç‰©ç† CPU æ ¸æ•° \u0026gt;= P çš„æ•°é‡ï¼‰ï¼ŒP çš„æ•°é‡ç”±ç”¨æˆ·è®¾ç½®çš„ GOMAXPROCS å†³å®šï¼Œä½†æ˜¯ä¸è®º GOMAXPROCS è®¾ç½®ä¸ºå¤šå¤§ï¼ŒP çš„æ•°é‡æœ€å¤§ä¸º 256ã€‚ M: Machineï¼ŒOS çº¿ç¨‹æŠ½è±¡ï¼Œä»£è¡¨ç€çœŸæ­£æ‰§è¡Œè®¡ç®—çš„èµ„æºï¼Œåœ¨ç»‘å®šæœ‰æ•ˆçš„ P åï¼Œè¿›å…¥ schedule å¾ªç¯ï¼›è€Œ schedule å¾ªç¯çš„æœºåˆ¶å¤§è‡´æ˜¯ä» Global é˜Ÿåˆ—ã€P çš„ Local é˜Ÿåˆ—ä»¥åŠ wait é˜Ÿåˆ—ä¸­è·å– Gï¼Œåˆ‡æ¢åˆ° G çš„æ‰§è¡Œæ ˆä¸Šå¹¶æ‰§è¡Œ G çš„å‡½æ•°ï¼Œè°ƒç”¨ goexit åšæ¸…ç†å·¥ä½œå¹¶å›åˆ° Mï¼Œå¦‚æ­¤åå¤ã€‚M å¹¶ä¸ä¿ç•™ G çŠ¶æ€ï¼Œè¿™æ˜¯ G å¯ä»¥è·¨ M è°ƒåº¦çš„åŸºç¡€ï¼ŒM çš„æ•°é‡æ˜¯ä¸å®šçš„ï¼Œç”± Go Runtime è°ƒæ•´ï¼Œä¸ºäº†é˜²æ­¢åˆ›å»ºè¿‡å¤š OS çº¿ç¨‹å¯¼è‡´ç³»ç»Ÿè°ƒåº¦ä¸è¿‡æ¥ï¼Œç›®å‰é»˜è®¤æœ€å¤§é™åˆ¶ä¸º 10000 ä¸ªã€‚ ä»»åŠ¡é˜Ÿåˆ—å…±æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ p ä¸Šçš„æœ¬åœ°é˜Ÿåˆ—ï¼Œå¦ä¸€ç§æ˜¯ global queueã€‚å½“ä½¿ç”¨ go å…³é”®è¯å¯åŠ¨ä¸€ä¸ªæ–°çš„ goroutine çš„æ—¶å€™ï¼Œè¿™æ—¢å¯èƒ½æ˜¯å…¨å±€çš„è¿è¡Œé˜Ÿåˆ—ï¼Œä¹Ÿå¯èƒ½æ˜¯å¤„ç†å™¨æœ¬åœ°çš„è¿è¡Œé˜Ÿåˆ—ã€‚ runtime.runqput å¯çŸ¥ï¼Œ\nå½“ next ä¸º true æ—¶ï¼Œä¼šå°† Goroutine è®¾ç½®åˆ°å¤„ç†å™¨çš„ runnext ä½œä¸ºä¸‹ä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œçš„ä»»åŠ¡ï¼› å½“ next ä¸º false å¹¶ä¸”æœ¬åœ°é˜Ÿåˆ—è¿˜æœ‰å‰©ä½™ç©ºé—´ï¼ŒGoroutine ä¼šè¢«æ”¾åˆ°æœ¬åœ°è¿è¡Œé˜Ÿåˆ—ä¸Šï¼› å½“å¤„ç†å™¨çš„æœ¬åœ°è¿è¡Œé˜Ÿåˆ—å·²ç»æ²¡æœ‰å‰©ä½™ç©ºé—´æ—¶å°±ä¼šæŠŠæœ¬åœ°é˜Ÿåˆ—ä¸­çš„ä¸€éƒ¨åˆ† Goroutine å’Œå¾…åŠ å…¥çš„ Goroutine é€šè¿‡ runtime.runqputslow æ·»åŠ åˆ°è°ƒåº¦å™¨æŒæœ‰çš„å…¨å±€è¿è¡Œé˜Ÿåˆ—ä¸Šï¼› è°ƒåº¦å¯æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ã€‚ runtime.schedule å‡½æ•°ä¼šä»ä¸‹é¢å‡ ä¸ªåœ°æ–¹æŸ¥æ‰¾å¾…æ‰§è¡Œçš„ Goroutineï¼š\nä¸ºäº†ä¿è¯å…¬å¹³ï¼Œå½“å…¨å±€è¿è¡Œé˜Ÿåˆ—ä¸­æœ‰å¾…æ‰§è¡Œçš„ Goroutine æ—¶ï¼Œé€šè¿‡ schedtick ä¿è¯æœ‰ä¸€å®šå‡ ç‡ä¼šä»å…¨å±€çš„è¿è¡Œé˜Ÿåˆ—ä¸­æŸ¥æ‰¾å¯¹åº”çš„ Goroutineï¼› ä»å¤„ç†å™¨æœ¬åœ°çš„è¿è¡Œé˜Ÿåˆ—ä¸­æŸ¥æ‰¾å¾…æ‰§è¡Œçš„ Goroutineï¼› å¦‚æœå‰ä¸¤ç§æ–¹æ³•éƒ½æ²¡æœ‰æ‰¾åˆ° Goroutineï¼Œä¼šé€šè¿‡ runtime.findrunnable è¿›è¡Œé˜»å¡åœ°æŸ¥æ‰¾ Goroutine. å¦‚æœå¤„ç†å™¨æ²¡æœ‰ä»»åŠ¡å¯å¤„ç†ï¼Œå®ƒä¼šæŒ‰ä»¥ä¸‹è§„åˆ™æ¥æ‰§è¡Œï¼Œç›´åˆ°æ»¡è¶³æŸä¸€æ¡è§„åˆ™ï¼š\nä»æœ¬åœ°é˜Ÿåˆ—è·å–ä»»åŠ¡ ä»å…¨å±€é˜Ÿåˆ—è·å–ä»»åŠ¡ ä»ç½‘ç»œè½®è¯¢å™¨è·å–ä»»åŠ¡ ä»å…¶å®ƒçš„å¤„ç†å™¨çš„æœ¬åœ°é˜Ÿåˆ—çªƒå–ä»»åŠ¡ åŸºäº goroutine å·¥ä½œæ–¹å¼ï¼Œæœ‰å“ªäº›ä¼˜ç‚¹ç‚¹ç¼ºç‚¹ï¼Œç¼ºç‚¹å¦‚ä½•è§„é¿ # ä¼˜ç¼ºç‚¹ # ä¼˜ç‚¹ï¼š\nç”±äº golang goroutine å®ç°çš„ scheduler æ¯”è¾ƒç®€å•ï¼Œåœ¨å¤§é‡ goroutine è°ƒåº¦æ—¶å€™æ€§èƒ½æ¶ˆè€—ç›¸æ¯”è¾ƒ os thread çš„è°ƒåº¦æ¥è¯´ä¼šä½è‡³å°‘ä¸€ä¸ªæ•°é‡çº§ã€‚ ç¼ºç‚¹ï¼š\nscheduler çš„å®ç°ç»†èŠ‚éå¸¸å¤šï¼Œå¤æ‚ ç”¨æˆ·æƒ³ hack è‡ªå·±çš„çº¿ç¨‹æ¨¡å‹åŸºæœ¬ä¸å¯èƒ½ (å½“ç„¶ golang çš„ scheduler å·²ç»è¶³å¤Ÿä¼˜ç§€äº†) goroutine pool # 10M(ç™¾ä¸‡) goroutine æ‰§è¡Œè½»é‡æ“ä½œä¼šå‡ºç°ç“¶é¢ˆï¼Œéœ€è¦è€ƒè™‘ goroutine pool æ¥åšä¼˜åŒ–äº†\ngolang æœ‰ gcï¼Œgoroutine çš„åˆ›å»ºä¸åˆ é™¤è¿˜æ˜¯éœ€è¦ç”³è¯·å†…å­˜çš„ï¼Œå¦‚æœå¯ä»¥ï¼Œå°½é‡ä½¿ç”¨ poolï¼Œè®© goroutineè°ƒåº¦å‹åŠ›å°½é‡å°ä¸€ç‚¹ï¼Œç”¨æˆ·ç¨‹åºå¤ç”¨ goroutineã€‚å¯ä»¥ä½¿ç”¨ goroutine pool å®ç° goroutine çš„å¤ç”¨ã€‚åŒæ—¶ä¸å¥½çš„ pool å®ç°ä¹Ÿä¼šè®©ä¸€æŠŠé”ç ´åæ‰å¥½çš„æ€§èƒ½ã€‚æ˜¯å¦ä½¿ç”¨ï¼Œéœ€è¦è§†æƒ…å†µè€Œå®š.\nref # GMP å¹¶å‘è°ƒåº¦å™¨æ·±åº¦è§£æä¹‹æ‰‹æ’¸ä¸€ä¸ªé«˜æ€§èƒ½ goroutine pool\nScheduler structures\ngolang/proposal\nScalable Go Scheduler Design Doc\nScalable Go Scheduler Design Doc -zh Scalable Go Scheduler Design Doc -en\nç¬¬ä¸€ä»£ Go Preemptive Scheduler Design Doc\nScheduling Multithreaded Computations by Work Stealing\nä¸‡å­—é•¿æ–‡æ·±å…¥æµ…å‡º Golang Runtime\nGo\u0026rsquo;s work-stealing scheduler\nThe Go runtime scheduler source\ngo-scheduler go-scheduler-zh\nGo è¯­è¨€åå¹´è€Œç«‹ï¼ŒGo2 è“„åŠ¿å¾…å‘\n"},{"id":9,"href":"/posts/Go/high-performance-go-workshop/","title":"(ç¿»è¯‘)Go é«˜æ€§èƒ½ç ”è®¨è®²åº§ - High Performance Go Workshop","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šä¼˜åŒ–Goç¨‹åº\nåŸæ–‡åœ°å€ forked from here\nOverview # æœ¬æ¬¡ç ”è®¨è®²åº§çš„ç›®æ ‡æ˜¯è®©æ‚¨èƒ½å¤Ÿè¯Šæ–­ Go åº”ç”¨ç¨‹åºä¸­çš„æ€§èƒ½é—®é¢˜ï¼Œå¹¶ä¸”ä¿®å¤è¿™äº›é—®é¢˜ã€‚\nè¿™ä¸€å¤©ï¼Œæˆ‘ä»¬å°†ä»å°åšèµ· - å­¦ä¹ å¦‚ä½•ç¼–å†™åŸºå‡†æµ‹è¯•ï¼Œç„¶ååˆ†æä¸€å°æ®µä»£ç ã€‚ç„¶åè®¨è®ºä»£ç æ‰§è¡Œè·Ÿè¸ªå™¨ï¼Œåƒåœ¾æ”¶é›†å™¨å’Œè·Ÿè¸ªè¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚æœ€åä¼šæœ‰å‰©ä¸‹çš„æ—¶é—´ï¼Œæ‚¨å¯ä»¥æå‡ºé—®é¢˜ï¼Œå¹¶å°è¯•ç¼–å†™æ‚¨è‡ªå·±çš„ä»£ç ã€‚\nSchedule # è¿™é‡Œæ˜¯è¿™ä¸€å¤©çš„æ—¶é—´å®‰æ’è¡¨ï¼ˆå¤§æ¦‚ï¼‰ã€‚\nå¼€å§‹æ—¶é—´ æè¿° 09:00 æ¬¢è¿ and ä»‹ç» 09:30 Benchmarking 10:45 ä¼‘æ¯ (15 åˆ†é’Ÿ) 11:00 æ€§èƒ½è¯„ä¼°å’Œåˆ†æ 12:00 åˆé¤ (90 åˆ†é’Ÿ) 13:30 ç¼–è¯‘ä¼˜åŒ– 14:30 æ‰§è¡Œè¿½è¸ªå™¨ 15:30 ä¼‘æ¯ (15 åˆ†é’Ÿ) 15:45 å†…å­˜å’Œåƒåœ¾å›æ”¶å™¨ 16:15 æç¤ºå’Œæ—…è¡Œ 16:30 ç»ƒä¹  16:45 æœ€åçš„é—®é¢˜å’Œç»“è®º 17:00 ç»“æŸ æ¬¢è¿ # ä½ å¥½ï¼Œæ¬¢è¿! ğŸ‰\nè¯¥ç ”è®¨çš„ç›®çš„æ˜¯ä¸ºæ‚¨æä¾›è¯Šæ–­å’Œä¿®å¤ Go åº”ç”¨ç¨‹åºä¸­çš„æ€§èƒ½é—®é¢˜æ‰€éœ€çš„å·¥å…·ã€‚\nåœ¨è¿™ä¸€å¤©é‡Œï¼Œæˆ‘ä»¬å°†ä»ä¸€å°éƒ¨åˆ†å¼€å§‹ - å­¦ä¹ å¦‚ä½•ç¼–å†™åŸºå‡†æµ‹è¯•ï¼Œç„¶ååˆ†æä¸€å°æ®µä»£ç ã€‚ç„¶åæ‰©å±•åˆ°ï¼Œè®¨è®º æ‰§è¡Œè·Ÿè¸ªå™¨ï¼Œåƒåœ¾æ”¶é›†å™¨ å’Œè·Ÿè¸ªæ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚å‰©ä¸‹çš„å°†æ˜¯æé—®çš„æ—¶é—´ï¼Œå°è¯•è‡ªå·±ä½¿ç”¨ä»£ç æ¥å®è·µã€‚\nè®²å¸ˆ # Dave Cheney dave@cheney.net å¼€æºè®¸å¯å’Œææ–™ # è¯¥ç ”è®¨ä¼šæ˜¯ David Cheney å’Œ Francesc Campoyã€‚\næ­¤æ–‡ç« ä»¥ Creative Commons Attribution-ShareAlike 4.0 International ä½œä¸ºå¼€æºåè®®ã€‚\né¢„å…ˆå·¥ä½œ # ä¸‹é¢æ˜¯æ‚¨ä»Šå¤©éœ€è¦ä¸‹è½½çš„å‡ ä¸ªè½¯ä»¶\nè®²ä¹ ä»£ç åº“ # å°†æºä»£ç ä¸‹è½½åˆ°æœ¬æ–‡æ¡£ï¼Œå¹¶åœ¨ä»¥ä¸‹ä½ç½®è·å–ä»£ç ç¤ºä¾‹ high-performance-go-workshop\nç”µè„‘æ‰§è¡Œç¯å¢ƒ # è¯¥é¡¹ç›®å·¥ä½œç¯å¢ƒç›®æ ‡ä¸º Go 1.12ã€‚\nDownload Go 1.12\nå¦‚æœæ‚¨å·²ç»å‡çº§åˆ° Go 1.13ï¼Œä¹Ÿå¯ä»¥äº†ã€‚åœ¨æ¬¡è¦çš„ Go ç‰ˆæœ¬ä¹‹é—´ï¼Œä¼˜åŒ–é€‰æ‹©æ€»æ˜¯ä¼šæœ‰ä¸€äº›å°çš„å˜åŒ–ï¼Œæˆ‘ä¼šåœ¨ç»§ç»­è¿›è¡Œæ—¶æŒ‡å‡ºã€‚\nGraphviz # åœ¨ pprof çš„éƒ¨åˆ†éœ€è¦ dot ç¨‹åºï¼Œå®ƒé™„å¸¦çš„å·¥å…· graphviz å¥—ä»¶ã€‚\nLinux: [sudo] apt-get install graphviz OSX: MacPorts: sudo port install graphviz Homebrew: brew install graphviz Windows (untested) Google Chrome # æ‰§è¡Œè·Ÿè¸ªå™¨ä¸Šçš„è¿™ä¸€éƒ¨åˆ†éœ€è¦ä½¿ç”¨ Google Chromeã€‚å®ƒä¸é€‚ç”¨äº Safariï¼ŒEdgeï¼ŒFirefox æˆ– IE 4.01ã€‚\nDownload Google Chrome\næ‚¨çš„ä»£ç ä»¥è¿›è¡Œåˆ†æå’Œä¼˜åŒ– # å½“å¤©çš„æœ€åéƒ¨åˆ†å°†æ˜¯å…¬å¼€è®²åº§ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­è¯•éªŒæ‰€å­¦çš„å·¥å…·ã€‚\nè¿˜æœ‰ä¸€äº›äº‹ â€¦â€‹ # è¿™ä¸æ˜¯æ¼”è®²ï¼Œè€Œæ˜¯å¯¹è¯ã€‚æˆ‘ä»¬å°†æœ‰å¾ˆå¤šæ—¶é—´æ¥æé—®ã€‚\nå¦‚æœæ‚¨å¬ä¸æ‡‚æŸäº›å†…å®¹ï¼Œæˆ–è®¤ä¸ºå¬ä¸æ­£ç¡®ï¼Œè¯·æå‡ºè¯¢é—®ã€‚\n1. å¾®å¤„ç†å™¨æ€§èƒ½çš„è¿‡å»ï¼Œç°åœ¨å’Œæœªæ¥ # è¿™æ˜¯ä¸€ä¸ªæœ‰å…³ç¼–å†™é«˜æ€§èƒ½ä»£ç çš„ç ”è®¨ä¼šã€‚åœ¨å…¶ä»–ç ”è®¨ä¼šä¸Šï¼Œæˆ‘è°ˆåˆ°äº†åˆ†ç¦»çš„è®¾è®¡å’Œå¯ç»´æŠ¤æ€§ï¼Œä½†æ˜¯ä»Šå¤©æˆ‘ä»¬åœ¨è¿™é‡Œè°ˆè®ºæ€§èƒ½ã€‚\nä»Šå¤©ï¼Œæˆ‘æƒ³åšä¸€ä¸ªç®€çŸ­çš„æ¼”è®²ï¼Œå†…å®¹æ˜¯å…³äºæˆ‘å¦‚ä½•æ€è€ƒè®¡ç®—æœºå‘å±•å†å²ä»¥åŠä¸ºä»€ä¹ˆæˆ‘è®¤ä¸ºç¼–å†™é«˜æ€§èƒ½è½¯ä»¶å¾ˆé‡è¦ã€‚\nç°å®æ˜¯è½¯ä»¶åœ¨ç¡¬ä»¶ä¸Šè¿è¡Œï¼Œå› æ­¤è¦è°ˆè®ºç¼–å†™é«˜æ€§èƒ½ä»£ç ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦è°ˆè®ºè¿è¡Œä»£ç çš„ç¡¬ä»¶ã€‚\n1.1. Mechanical Sympathy # ç›®å‰æœ‰ä¸€ä¸ªå¸¸ç”¨æœ¯è¯­ï¼Œæ‚¨ä¼šå¬åˆ°åƒé©¬ä¸Â·æ±¤æ™®æ£®ï¼ˆMartin Thompsonï¼‰æˆ–æ¯”å°”Â·è‚¯å°¼è¿ªï¼ˆBill Kennedyï¼‰è¿™æ ·çš„äººè°ˆè®º Mechanical Sympathyã€‚ Mechanical Sympathy è¿™ä¸ªåå­—æ¥è‡ªä¼Ÿå¤§çš„èµ›è½¦ æ‰‹æ°åŸºÂ·æ–¯å›¾å°”ç‰¹ï¼ˆJackie Stewartï¼‰ï¼Œä»–æ›¾ä¸‰åº¦è·å¾—ä¸–ç•Œä¸€çº§æ–¹ç¨‹å¼èµ›è½¦å† å†›ã€‚ä»–è®¤ä¸ºï¼Œæœ€å¥½çš„é©¾é©¶å‘˜å¯¹æœºå™¨çš„å·¥ä½œåŸç†æœ‰è¶³å¤Ÿçš„äº†è§£ï¼Œä»¥ä¾¿ä»–ä»¬å¯ä»¥ä¸æœºå™¨å’Œè°åœ°å·¥ä½œã€‚\nè¦æˆä¸ºä¸€åå‡ºè‰²çš„èµ›è½¦æ‰‹ï¼Œæ‚¨ä¸éœ€è¦æˆä¸ºä¸€åå‡ºè‰²çš„æœºæ¢°å¸ˆï¼Œä½†æ‚¨éœ€è¦å¯¹æ±½è½¦çš„å·¥ä½œåŸç†æœ‰ä¸€ä¸ªç²—ç•¥çš„äº†è§£ã€‚\næˆ‘ç›¸ä¿¡æˆ‘ä»¬ä½œä¸ºè½¯ä»¶å·¥ç¨‹å¸ˆä¹Ÿæ˜¯å¦‚æ­¤ã€‚æˆ‘è®¤ä¸ºä¼šè®®å®¤ä¸­çš„ä»»ä½•äººéƒ½ä¸ä¼šæ˜¯ä¸“ä¸šçš„ CPU è®¾è®¡äººå‘˜ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å¿½ç•¥ CPU è®¾è®¡äººå‘˜é¢ä¸´çš„é—®é¢˜ã€‚\n1.2. å…­ä¸ªæ•°é‡çº§ # æœ‰ä¸€ä¸ªå¸¸è§çš„ç½‘ç»œæ¨¡å‹æ˜¯è¿™æ ·çš„ï¼›\nå½“ç„¶è¿™æ˜¯è’è°¬çš„ï¼Œä½†æ˜¯å®ƒå¼ºè°ƒäº†è®¡ç®—æœºè¡Œä¸šå‘ç”Ÿäº†å¤šå°‘å˜åŒ–ã€‚\nä½œä¸ºè½¯ä»¶ä½œè€…ï¼Œæˆ‘ä»¬è¿™ä¸ªä¼šè®®å®¤çš„æ‰€æœ‰äººéƒ½å—ç›Šäºæ‘©å°”å®šå¾‹ï¼Œå³ 40 å¹´æ¥ï¼Œæ¯ 18 ä¸ªæœˆå°†èŠ¯ç‰‡ä¸Šå¯ç”¨æ™¶ä½“ç®¡çš„æ•°é‡å¢åŠ ä¸€å€ã€‚æ²¡æœ‰å…¶ä»–è¡Œä¸šç»å†è¿‡ å…­ä¸ªæ•°é‡çº§ [ 1] åœ¨ä¸€ç”Ÿçš„æ—¶é—´å†…æ”¹è¿›å…¶å·¥å…·ã€‚\nä½†è¿™ä¸€åˆ‡éƒ½åœ¨æ”¹å˜ã€‚\n1.3. è®¡ç®—æœºè¿˜åœ¨å˜å¿«å—ï¼Ÿ # å› æ­¤ï¼Œæœ€åŸºæœ¬çš„é—®é¢˜æ˜¯ï¼Œé¢å¯¹ä¸Šå›¾æ‰€ç¤ºçš„ç»Ÿè®¡æ•°æ®ï¼Œæˆ‘ä»¬åº”è¯¥é—®è¿™ä¸ªé—®é¢˜å— è®¡ç®—æœºè¿˜åœ¨å˜å¿«å— ?\nå¦‚æœè®¡ç®—æœºçš„é€Ÿåº¦ä»åœ¨æé«˜ï¼Œé‚£ä¹ˆä¹Ÿè®¸æˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒä»£ç çš„æ€§èƒ½ï¼Œåªéœ€ç¨ç­‰ä¸€ä¸‹ï¼Œç¡¬ä»¶åˆ¶é€ å•†å°†ä¸ºæˆ‘ä»¬è§£å†³æ€§èƒ½é—®é¢˜ã€‚\n1.3.1. è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ•°æ® # è¿™æ˜¯ç»å…¸çš„æ•°æ®ï¼Œæ‚¨å¯ä»¥åœ¨ John L. Hennessy å’Œ David A. Patterson çš„ Computer Architecture, A Quantitative Approach ç­‰æ•™ç§‘ä¹¦ä¸­æ‰¾åˆ°ã€‚è¯¥å›¾æ‘˜è‡ªç¬¬ 5 ç‰ˆ\nåœ¨ç¬¬ 5 ç‰ˆä¸­ï¼Œè½©å°¼è¯—ï¼ˆHennessyï¼‰å’Œå¸•ç‰¹æ£®ï¼ˆPattersonï¼‰æå‡ºäº†è®¡ç®—æ€§èƒ½çš„ä¸‰ä¸ªæ—¶ä»£\né¦–å…ˆæ˜¯ 1970 å¹´ä»£å’Œ 80 å¹´ä»£åˆæœŸï¼Œè¿™æ˜¯å½¢æˆæ€§çš„å¹´ä»£ã€‚æˆ‘ä»¬ä»Šå¤©æ‰€çŸ¥é“çš„å¾®å¤„ç†å™¨å®é™…ä¸Šå¹¶ä¸å­˜åœ¨ï¼Œè®¡ç®—æœºæ˜¯ç”±åˆ†ç«‹æ™¶ä½“ç®¡æˆ–å°è§„æ¨¡é›†æˆç”µè·¯åˆ¶é€ çš„ã€‚æˆæœ¬ï¼Œå°ºå¯¸ä»¥åŠå¯¹ææ–™ç§‘å­¦ç†è§£çš„é™åˆ¶æ˜¯é™åˆ¶å› ç´ ã€‚ ä» 80 å¹´ä»£ä¸­æœŸåˆ° 2004 å¹´ï¼Œè¶‹åŠ¿çº¿å¾ˆæ˜æ˜¾ã€‚ è®¡ç®—æœºæ•´æ•°æ€§èƒ½æ¯å¹´å¹³å‡æé«˜ 52ï¼…ã€‚ è®¡ç®—æœºèƒ½åŠ›æ¯ä¸¤å¹´ç¿»ä¸€ç•ªï¼Œå› æ­¤äººä»¬å°†æ‘©å°”å®šå¾‹ï¼ˆèŠ¯ç‰‡ä¸Šçš„æ™¶ä½“ç®¡æ•°é‡å¢åŠ ä¸€å€ï¼‰ä¸è®¡ç®—æœºæ€§èƒ½æ··ä¸ºä¸€è°ˆã€‚ ç„¶åæˆ‘ä»¬è¿›å…¥è®¡ç®—æœºæ€§èƒ½çš„ç¬¬ä¸‰ä¸ªæ—¶ä»£ã€‚ äº‹æƒ…å˜æ…¢äº†ã€‚ æ€»å˜åŒ–ç‡ä¸ºæ¯å¹´ 22ï¼…ã€‚ ä¹‹å‰çš„å›¾è¡¨ä»…æŒç»­åˆ° 2012 å¹´ï¼Œä½†å¹¸è¿çš„æ˜¯åœ¨ 2012 å¹´ Jeff Preshing å†™äº† tool to scrape the Spec website and build your own graph.\nå› æ­¤ï¼Œè¿™æ˜¯ä½¿ç”¨ 1995 å¹´ åˆ° 2017 å¹´ çš„ Spec æ•°æ®çš„åŒä¸€å›¾ã€‚\nå¯¹æˆ‘è€Œè¨€ï¼Œä¸å…¶è¯´æˆ‘ä»¬åœ¨ 2012 å¹´ çš„æ•°æ®ä¸­çœ‹åˆ°çš„æ­¥ä¼å˜åŒ–ï¼Œä¸å¦‚è¯´æ˜¯ å•æ ¸ æ€§èƒ½å·²æ¥è¿‘æé™ã€‚ è¿™äº›æ•°å­—å¯¹äºæµ®ç‚¹æ•°æ¥è¯´ç¨å¥½ä¸€äº›ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬åœ¨åšä¸šåŠ¡åº”ç”¨ç¨‹åºçš„æˆ¿é—´ä¸­æ¥è¯´ï¼Œè¿™å¯èƒ½å¹¶ä¸é‡è¦ã€‚\n1.3.2. æ˜¯çš„ï¼Œè®¡ç®—æœºä»åœ¨å˜å¾—è¶Šæ¥è¶Šæ…¢ # å…³äºæ‘©å°”å®šå¾‹ç»ˆç»“çš„ç¬¬ä¸€ä»¶äº‹è¦è®°ä½ï¼Œå°±æ˜¯æˆˆç™»Â·æ‘©å°”å‘Šè¯‰æˆ‘çš„äº‹æƒ…ã€‚ä»–è¯´ï¼š\u0026ldquo;æ‰€æœ‰æŒ‡æ•°éƒ½ç»“æŸäº†\u0026rdquo;ã€‚â€‰â€”â€‰John Hennessy\nè¿™æ˜¯è½©å°¼è¯—åœ¨ Google Next 18 åŠå…¶å›¾çµå¥–æ¼”è®²ä¸­çš„å¼•æ–‡ã€‚ ä»–çš„è§‚ç‚¹æ˜¯è‚¯å®šçš„ï¼ŒCPU æ€§èƒ½ä»åœ¨æé«˜ã€‚ ä½†æ˜¯ï¼Œå•çº¿ç¨‹æ•´æ•°æ€§èƒ½ä»åœ¨æ¯å¹´æé«˜ 2-3ï¼… å·¦å³ã€‚ ä»¥è¿™ç§é€Ÿåº¦ï¼Œå®ƒå°†éœ€è¦ 20 å¹´çš„å¤åˆå¢é•¿æ‰èƒ½ä½¿æ•´æ•°æ€§èƒ½ç¿»å€ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œ90 å¹´ä»£çš„è¡¨ç°æ¯å¤©æ¯ä¸¤å¹´ç¿»ä¸€ç•ªã€‚\nä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ\n1.4. æ—¶é’ˆé€Ÿåº¦ # 2015 å¹´çš„è¿™å¼ å›¾å¾ˆå¥½åœ°è¯´æ˜äº†è¿™ä¸€ç‚¹ã€‚ ç¬¬ä¸€è¡Œæ˜¾ç¤ºäº†èŠ¯ç‰‡ä¸Šçš„æ™¶ä½“ç®¡æ•°é‡ã€‚ è‡ª 1970 å¹´ä»£ä»¥æ¥ï¼Œè¿™ç§è¶‹åŠ¿ä¸€ç›´ä»¥å¤§è‡´çº¿æ€§çš„è¶‹åŠ¿çº¿æŒç»­ã€‚ ç”±äºè¿™æ˜¯å¯¹æ•°/æ—çº¿å›¾ï¼Œå› æ­¤è¯¥çº¿æ€§åºåˆ—è¡¨ç¤ºæŒ‡æ•°å¢é•¿ã€‚\nä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çœ‹ä¸­çº¿ï¼Œæˆ‘ä»¬çœ‹åˆ°æ—¶é’Ÿé€Ÿåº¦åå¹´æ¥æ²¡æœ‰å¢åŠ ï¼Œæˆ‘ä»¬çœ‹åˆ° CPU é€Ÿåº¦åœ¨ 2004 å¹´å·¦å³åœæ»äº†ã€‚\nä¸‹å›¾æ˜¾ç¤ºäº†æ•£çƒ­åŠŸç‡ï¼› å³å˜æˆç”µèƒ½çš„ç”µèƒ½éµå¾ªç›¸åŒçš„æ¨¡å¼-æ—¶é’Ÿé€Ÿåº¦å’Œ cpu æ•£çƒ­æ˜¯ç›¸å…³çš„ã€‚\n1.5. å‘çƒ­ # ä¸ºä»€ä¹ˆ CPU ä¼šå‘çƒ­ï¼Ÿ è¿™æ˜¯ä¸€å°å›ºæ€è®¾å¤‡ï¼Œæ²¡æœ‰ç§»åŠ¨ç»„ä»¶ï¼Œå› æ­¤æ­¤å¤„çš„æ‘©æ“¦ç­‰æ•ˆæœå¹¶ä¸ï¼ˆç›´æ¥ï¼‰ç›¸å…³ã€‚\nè¯¥å›¾æ‘˜è‡ª data sheet produced by TIã€‚ åœ¨æ­¤æ¨¡å‹ä¸­ï¼ŒN å‹è®¾å¤‡ä¸­çš„å¼€å…³è¢«å¸å¼•åˆ°æ­£ç”µå‹ï¼ŒP å‹è®¾å¤‡è¢«æ­£ç”µå‹å‡»é€€ã€‚\nCMOS è®¾å¤‡çš„åŠŸè€—æ˜¯ä¸‰ä¸ªå› ç´ çš„æ€»å’Œï¼ŒCMOS åŠŸè€—æ˜¯æˆ¿é—´ï¼ŒåŠå…¬æ¡Œä¸Šå’Œå£è¢‹ä¸­æ¯ä¸ªæ™¶ä½“ç®¡çš„åŠŸç‡ã€‚\né™æ€åŠŸç‡ã€‚å½“æ™¶ä½“ç®¡æ˜¯é™æ€çš„ï¼Œå³ä¸æ”¹å˜å…¶çŠ¶æ€æ—¶ï¼Œä¼šæœ‰å°‘é‡ç”µæµé€šè¿‡æ™¶ä½“ç®¡æ³„æ¼åˆ°åœ°ã€‚ æ™¶ä½“ç®¡è¶Šå°ï¼Œæ³„æ¼è¶Šå¤šã€‚ æ³„æ¼é‡éšæ¸©åº¦è€Œå¢åŠ ã€‚å½“æ‚¨æ‹¥æœ‰æ•°åäº¿ä¸ªæ™¶ä½“ç®¡æ—¶ï¼Œå³ä½¿æ˜¯å¾ˆå°çš„æ³„æ¼ä¹Ÿä¼šåŠ èµ·æ¥ï¼ åŠ¨æ€åŠŸç‡ã€‚å½“æ™¶ä½“ç®¡ä»ä¸€ç§çŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ç§çŠ¶æ€æ—¶ï¼Œå®ƒå¿…é¡»å¯¹è¿æ¥åˆ°æ …æçš„å„ç§ç”µå®¹è¿›è¡Œå……ç”µæˆ–æ”¾ç”µã€‚ æ¯ä¸ªæ™¶ä½“ç®¡çš„åŠ¨æ€åŠŸç‡æ˜¯ç”µå‹ä¹˜ä»¥ç”µå®¹å’Œå˜åŒ–é¢‘ç‡çš„å¹³æ–¹ã€‚ é™ä½ç”µå‹å¯ä»¥å‡å°‘æ™¶ä½“ç®¡æ¶ˆè€—çš„åŠŸç‡ï¼Œä½†æ˜¯è¾ƒä½çš„ç”µå‹ä¼šä½¿æ™¶ä½“ç®¡çš„å¼€å…³é€Ÿåº¦å˜æ…¢ã€‚ æ’¬æ£æˆ–çŸ­è·¯ç”µæµã€‚æˆ‘ä»¬å–œæ¬¢å°†æ™¶ä½“ç®¡è§†ä¸ºæ•°å­—è®¾å¤‡ï¼Œæ— è®ºå…¶å¤„äºå¼€å¯çŠ¶æ€è¿˜æ˜¯å¤„äºåŸå­çŠ¶æ€ï¼Œéƒ½å æ®ä¸€ç§çŠ¶æ€æˆ–å¦ä¸€ç§çŠ¶æ€ã€‚ å®é™…ä¸Šï¼Œæ™¶ä½“ç®¡æ˜¯æ¨¡æ‹Ÿè®¾å¤‡ã€‚ å½“å¼€å…³æ—¶ï¼Œæ™¶ä½“ç®¡å¼€å§‹å‡ ä¹å…¨éƒ¨æˆªæ­¢ï¼Œå¹¶è½¬å˜æˆ–åˆ‡æ¢åˆ°å‡ ä¹å…¨éƒ¨å¯¼é€šçš„çŠ¶æ€ã€‚ è¿™ç§è½¬æ¢æˆ–åˆ‡æ¢æ—¶é—´éå¸¸å¿«ï¼Œåœ¨ç°ä»£å¤„ç†å™¨ä¸­çº¦ä¸ºçš®ç§’ï¼Œä½†æ˜¯å½“ä» Vcc åˆ°åœ°çš„ç”µé˜»è·¯å¾„å¾ˆä½æ—¶ï¼Œè¿™ä»ç„¶ä»£è¡¨äº†ä¸€æ®µæ—¶é—´ã€‚ æ™¶ä½“ç®¡åˆ‡æ¢çš„é€Ÿåº¦è¶Šå¿«ï¼Œå…¶é¢‘ç‡å°±ä¼šè€—æ•£æ›´å¤šçš„çƒ­é‡ã€‚ 1.6. Dennard æ‰©å±•çš„ç»ˆç»“ # è¦äº†è§£æ¥ä¸‹æ¥å‘ç”Ÿçš„äº‹æƒ…ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹ Robert H. Dennard äº 1974 å¹´å…±åŒæ’°å†™çš„è®ºæ–‡ã€‚ ä¸¹çº³å¾·çš„ç¼©æ”¾å®šå¾‹å¤§è‡´ä¸ŠæŒ‡å‡ºï¼Œéšç€æ™¶ä½“ç®¡çš„å˜å°ï¼Œå®ƒä»¬çš„ power density ä¿æŒæ’å®šã€‚ è¾ƒå°çš„æ™¶ä½“ç®¡å¯ä»¥åœ¨è¾ƒä½çš„ç”µå‹ä¸‹è¿è¡Œï¼Œå…·æœ‰è¾ƒä½çš„æ …æç”µå®¹ï¼Œå¹¶ä¸”å¼€å…³é€Ÿåº¦æ›´å¿«ï¼Œè¿™æœ‰åŠ©äºå‡å°‘åŠ¨æ€åŠŸç‡ã€‚\né‚£ä¹ˆï¼Œç»“æœå¦‚ä½•å‘¢ï¼Ÿ\näº‹å®å¹¶éå¦‚æ­¤ã€‚ å½“æ™¶ä½“ç®¡çš„æ …æé•¿åº¦æ¥è¿‘å‡ ä¸ªç¡…åŸå­çš„å®½åº¦æ—¶ï¼Œæ™¶ä½“ç®¡å°ºå¯¸ï¼Œç”µå‹ä¸é‡è¦çš„æ³„æ¼ä¹‹é—´çš„å…³ç³»å°±ç ´è£‚äº†ã€‚\nå®ƒæ˜¯åœ¨ Micro-32 conference in 1999 å‡å®šçš„ï¼Œå¦‚æœæˆ‘ä»¬éµå¾ªäº†æé«˜æ—¶é’Ÿé€Ÿåº¦å’Œç¼©å°æ™¶ä½“ç®¡å°ºå¯¸çš„è¶‹åŠ¿çº¿ï¼Œé‚£ä¹ˆåœ¨å¤„ç†å™¨ä¸€ä»£ä¹‹å†…æ™¶ä½“ç®¡ç»“å°†æ¥è¿‘æ ¸ååº”å †å †èŠ¯çš„æ¸©åº¦ã€‚æ˜¾ç„¶ï¼Œè¿™æ˜¯è’è°¬çš„ã€‚å¥”è…¾ 4 marked the end of the line é€‚ç”¨äºå•æ ¸é«˜é¢‘æ¶ˆè´¹ç±» CPUã€‚\nè¿”å›æ­¤å›¾ï¼Œæˆ‘ä»¬çœ‹åˆ°æ—¶é’Ÿé€Ÿåº¦åœæ­¢çš„åŸå› æ˜¯ CPU è¶…å‡ºäº†æˆ‘ä»¬å†·å´æ—¶é’Ÿçš„èƒ½åŠ›ã€‚ åˆ° 2006 å¹´ï¼Œå‡å°æ™¶ä½“ç®¡çš„å°ºå¯¸ä¸å†æé«˜å…¶åŠŸç‡æ•ˆç‡ã€‚\nç°åœ¨æˆ‘ä»¬çŸ¥é“ï¼Œå‡å° CPU åŠŸèƒ½çš„å¤§å°ä¸»è¦æ˜¯ä¸ºäº†é™ä½åŠŸè€—ã€‚ é™ä½åŠŸè€—ä¸ä»…æ„å‘³ç€â€œç»¿è‰²â€ï¼Œä¾‹å¦‚å›æ”¶åˆ©ç”¨ï¼Œè¿˜å¯ä»¥æ‹¯æ•‘åœ°çƒã€‚ ä¸»è¦ç›®æ ‡æ˜¯ä¿æŒåŠŸè€—ï¼Œä»è€Œä¿æŒæ•£çƒ­ï¼Œ below levels that will damage the CPU.\nä½†æ˜¯ï¼Œå›¾ä¸­çš„ä¸€éƒ¨åˆ†åœ¨ä¸æ–­å¢åŠ ï¼Œå³ç®¡èŠ¯ä¸Šçš„æ™¶ä½“ç®¡æ•°é‡ã€‚cpu çš„è¡Œè¿›å…·æœ‰å°ºå¯¸ç‰¹å¾ï¼Œåœ¨ç›¸åŒçš„ç»™å®šé¢ç§¯å†…æœ‰æ›´å¤šçš„æ™¶ä½“ç®¡ï¼Œæ—¢æœ‰æ­£é¢å½±å“ï¼Œä¹Ÿæœ‰è´Ÿé¢å½±å“ã€‚\nåŒæ ·ï¼Œå¦‚æ‚¨åœ¨æ’å…¥ç‰©ä¸­æ‰€çœ‹åˆ°çš„ï¼Œç›´åˆ°å¤§çº¦ 5 å¹´å‰ï¼Œæ¯ä¸ªæ™¶ä½“ç®¡çš„æˆæœ¬ä¸€ç›´åœ¨ä¸‹é™ï¼Œç„¶åæ¯ä¸ªæ™¶ä½“ç®¡çš„æˆæœ¬åˆå¼€å§‹å›å‡ã€‚\nåˆ¶é€ è¾ƒå°çš„æ™¶ä½“ç®¡ä¸ä»…å˜å¾—è¶Šæ¥è¶Šæ˜‚è´µï¼Œè€Œä¸”å˜å¾—è¶Šæ¥è¶Šå›°éš¾ã€‚ 2016 å¹´ çš„è¿™ä»½æŠ¥å‘Šæ˜¾ç¤ºäº†èŠ¯ç‰‡åˆ¶é€ å•†è®¤ä¸ºåœ¨ 2013 å¹´ ä¼šå‘ç”Ÿä»€ä¹ˆçš„é¢„æµ‹ã€‚ä¸¤å¹´åï¼Œä»–ä»¬é”™è¿‡äº†æ‰€æœ‰é¢„æµ‹ï¼Œå°½ç®¡æˆ‘æ²¡æœ‰æ­¤æŠ¥å‘Šçš„æ›´æ–°ç‰ˆæœ¬ï¼Œä½†æ²¡æœ‰è¿¹è±¡è¡¨æ˜ä»–ä»¬å°†èƒ½å¤Ÿæ‰­è½¬è¿™ä¸€è¶‹åŠ¿ã€‚\nè‹±ç‰¹å°”ï¼Œå°ç§¯ç”µï¼ŒAMD å’Œä¸‰æ˜Ÿéƒ½è¦èŠ±è´¹æ•°åäº¿ç¾å…ƒï¼Œå› ä¸ºå®ƒä»¬å¿…é¡»å»ºé€ æ–°çš„æ™¶åœ†å‚ï¼Œè´­ä¹°æ‰€æœ‰æ–°çš„å·¥è‰ºå·¥å…·ã€‚å› æ­¤ï¼Œå°½ç®¡æ¯ä¸ªèŠ¯ç‰‡çš„æ™¶ä½“ç®¡æ•°é‡æŒç»­å¢åŠ ï¼Œä½†å…¶å•ä½æˆæœ¬å´å¼€å§‹å¢åŠ ã€‚\nç”šè‡³ä»¥çº³ç±³ä¸ºå•ä½çš„æœ¯è¯­ æ …æé•¿åº¦ ä¹Ÿå˜å¾—æ¨¡æ£±ä¸¤å¯ã€‚ å„ç§åˆ¶é€ å•†ä»¥ä¸åŒçš„æ–¹å¼æµ‹é‡å…¶æ™¶ä½“ç®¡çš„å°ºå¯¸ï¼Œä»è€Œä½¿å®ƒä»¬åœ¨æ²¡æœ‰äº¤ä»˜çš„æƒ…å†µä¸‹å¯ä»¥å±•ç¤ºæ¯”ç«äº‰å¯¹æ‰‹å°‘çš„æ•°é‡ã€‚è¿™æ˜¯ CPU åˆ¶é€ å•†çš„é GAAP æ”¶ç›ŠæŠ¥å‘Šæ¨¡å‹ã€‚\n1.7. æ›´å¤šçš„æ ¸å¿ƒ # è¾¾åˆ°æ¸©åº¦å’Œé¢‘ç‡é™åˆ¶åï¼Œä¸å†å¯èƒ½ä½¿å•ä¸ªå†…æ ¸çš„è¿è¡Œé€Ÿåº¦å¿«ä¸¤å€ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ·»åŠ å¦ä¸€ä¸ªå†…æ ¸ï¼Œåˆ™å¯ä»¥æä¾›ä¸¤å€çš„å¤„ç†èƒ½åŠ›-å¦‚æœè½¯ä»¶å¯ä»¥æ”¯æŒçš„è¯ã€‚\nå®é™…ä¸Šï¼ŒCPU çš„æ ¸å¿ƒæ•°é‡ä¸»è¦ç”±æ•£çƒ­å†³å®šã€‚ Dennard ç¼©æ”¾çš„æœ«å°¾æ„å‘³ç€ CPU çš„æ—¶é’Ÿé€Ÿåº¦æ˜¯ 1 åˆ° 4 Ghz ä¹‹é—´çš„ä»»æ„æ•°å­—ï¼Œå…·ä½“å–å†³äºå®ƒçš„æ¸©åº¦ã€‚åœ¨è°ˆè®ºåŸºå‡†æµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾ˆå¿«çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚\n1.8. é˜¿å§†è¾¾å°”å®šå¾‹ # CPU å¹¶æ²¡æœ‰å˜å¾—è¶Šæ¥è¶Šå¿«ï¼Œä½†æ˜¯éšç€è¶…çº¿ç¨‹å’Œå¤šæ ¸å®ƒä»¬å˜å¾—è¶Šæ¥è¶Šå®½ã€‚ ç§»åŠ¨éƒ¨ä»¶ä¸ºåŒæ ¸ï¼Œå°å¼æœºéƒ¨ä»¶ä¸ºå››æ ¸ï¼ŒæœåŠ¡å™¨éƒ¨ä»¶ä¸ºæ•°åä¸ªå†…æ ¸ã€‚ è¿™å°†æ˜¯è®¡ç®—æœºæ€§èƒ½çš„æœªæ¥å—ï¼Ÿ ä¸å¹¸çš„æ˜¯æ²¡æœ‰ã€‚\né˜¿å§†è¾¾å°”å®šå¾‹ä»¥ IBM/360 çš„è®¾è®¡è€…å‰å§†Â·é˜¿å§†è¾¾å°”ï¼ˆGene Amdahlï¼‰çš„åå­—å‘½åï¼Œå®ƒæ˜¯ä¸€ä¸ªå…¬å¼ï¼Œå®ƒç»™å‡ºäº†åœ¨å›ºå®šå·¥ä½œè´Ÿè½½ä¸‹ä»»åŠ¡æ‰§è¡Œå»¶è¿Ÿçš„ç†è®ºä¸Šçš„åŠ é€Ÿï¼Œè¿™å¯ä»¥é€šè¿‡æ”¹å–„èµ„æºçš„ç³»ç»Ÿæ¥å®ç°ã€‚\né˜¿å§†è¾¾å°”å®šå¾‹å‘Šè¯‰æˆ‘ä»¬ï¼Œç¨‹åºçš„æœ€å¤§é€Ÿåº¦å—ç¨‹åºé¡ºåºéƒ¨åˆ†çš„é™åˆ¶ã€‚ å¦‚æœæ‚¨ç¼–å†™çš„ç¨‹åºçš„æ‰§è¡ŒåŠ›çš„ 95ï¼… å¯ä»¥å¹¶è¡Œè¿è¡Œï¼Œå³ä½¿æœ‰æˆåƒä¸Šä¸‡çš„å¤„ç†å™¨ï¼Œåˆ™ç¨‹åºæ‰§è¡Œçš„æœ€å¤§é€Ÿåº¦ä¹Ÿå°†é™åˆ¶ä¸º 20 å€ã€‚\nè€ƒè™‘ä¸€ä¸‹æ‚¨æ¯å¤©ä½¿ç”¨çš„ç¨‹åºï¼Œå®ƒä»¬çš„æ‰§è¡Œé‡ä¸­æœ‰å¤šå°‘æ˜¯å¯ä»¥è§£æçš„ï¼Ÿ\n1.9. åŠ¨æ€ä¼˜åŒ– # ç”±äºæ—¶é’Ÿé€Ÿåº¦åœæ»ä¸å‰ï¼Œå¹¶ä¸”ç”±äºæŠ›å‡ºé¢å¤–çš„å†…æ ¸è€Œäº§ç”Ÿçš„å›æŠ¥æœ‰é™ï¼Œå› æ­¤ï¼Œæé€Ÿæ¥è‡ªä½•å¤„ï¼Ÿ å®ƒä»¬æ¥è‡ªèŠ¯ç‰‡æœ¬èº«çš„ä½“ç³»ç»“æ„æ”¹è¿›ã€‚ è¿™äº›æ˜¯äº”åˆ°ä¸ƒå¹´çš„å¤§å‹é¡¹ç›®ï¼Œåç§°å¦‚ä¸‹ Nehalem, Sandy Bridge, and Skylake.\nåœ¨è¿‡å»çš„äºŒåå¹´ä¸­ï¼Œæ€§èƒ½çš„æ”¹å–„å¤§éƒ¨åˆ†æ¥è‡ªä½“ç³»ç»“æ„çš„æ”¹å–„:\n1.9.1. ä¹±åºæ‰§è¡Œ # ä¹±åºï¼Œä¹Ÿç§°ä¸ºè¶…æ ‡é‡ï¼Œæ‰§è¡Œæ˜¯ä¸€ç§ä» CPU æ­£åœ¨æ‰§è¡Œçš„ä»£ç ä¸­æå–æ‰€è°“çš„ æŒ‡ä»¤çº§å¹¶è¡Œæ€§ çš„æ–¹æ³•ã€‚ ç°ä»£ CPU åœ¨ç¡¬ä»¶çº§åˆ«æœ‰æ•ˆåœ°æ‰§è¡Œ SSAï¼Œä»¥è¯†åˆ«æ“ä½œä¹‹é—´çš„æ•°æ®ä¾èµ–æ€§ï¼Œå¹¶åœ¨å¯èƒ½çš„æƒ…å†µä¸‹å¹¶è¡Œè¿è¡Œç‹¬ç«‹çš„æŒ‡ä»¤ã€‚\nä½†æ˜¯ï¼Œä»»ä½•ä¸€æ®µä»£ç å›ºæœ‰çš„å¹¶è¡Œæ€§æ•°é‡æ˜¯æœ‰é™çš„ã€‚å®ƒä¹Ÿéå¸¸è€—ç”µã€‚å¤§å¤šæ•°ç°ä»£ CPU åœ¨æ¯ä¸ªå†…æ ¸ä¸Šéƒ½éƒ¨ç½²äº†å…­ä¸ªæ‰§è¡Œå•å…ƒï¼Œå› ä¸ºåœ¨æµæ°´çº¿çš„æ¯ä¸ªé˜¶æ®µå°†æ¯ä¸ªæ‰§è¡Œå•å…ƒè¿æ¥åˆ°æ‰€æœ‰å…¶ä»–æ‰§è¡Œå•å…ƒçš„æˆæœ¬ä¸º n å¹³æ–¹ã€‚\n1.9.2. é¢„æµ‹æ‰§è¡Œ # é™¤æœ€å°çš„å¾®æ§åˆ¶å™¨å¤–ï¼Œæ‰€æœ‰ CPU å‡ä½¿ç”¨ æŒ‡ä»¤ç®¡é“ æ¥é‡å æŒ‡ä»¤ è·å–/è§£ç /æ‰§è¡Œ/æäº¤ å‘¨æœŸä¸­çš„éƒ¨åˆ†ã€‚\næŒ‡ä»¤æµæ°´çº¿çš„é—®é¢˜æ˜¯åˆ†æ”¯æŒ‡ä»¤ï¼Œå¹³å‡æ¯ 5 åˆ° 8 æ¡æŒ‡ä»¤å‡ºç°ä¸€æ¬¡ã€‚å½“ CPU åˆ°è¾¾åˆ†æ”¯æ—¶ï¼Œå®ƒä¸èƒ½åœ¨åˆ†æ”¯ä¹‹å¤–å¯»æ‰¾å…¶ä»–æŒ‡ä»¤æ¥æ‰§è¡Œï¼Œå¹¶ä¸”ç›´åˆ°çŸ¥é“ç¨‹åºè®¡æ•°å™¨ä¹Ÿå°†åœ¨ä½•å¤„åˆ†æ”¯ä¹‹å‰ï¼Œå®ƒæ‰èƒ½å¼€å§‹å¡«å……å…¶ç®¡é“ã€‚æ¨æµ‹æ‰§è¡Œä½¿ CPU å¯ä»¥â€œçŒœæµ‹â€åˆ†æ”¯ä»è¦å¤„ç†çš„è·¯å¾„ï¼ŒåŒæ—¶ä»åœ¨å¤„ç†åˆ†æ”¯æŒ‡ä»¤ï¼\nå¦‚æœ CPU æ­£ç¡®é¢„æµ‹äº†åˆ†æ”¯ï¼Œåˆ™å®ƒå¯ä»¥ä¿æŒå…¶æŒ‡ä»¤æµæ°´çº¿æ»¡ã€‚å¦‚æœ CPU æ— æ³•é¢„æµ‹æ­£ç¡®çš„åˆ†æ”¯ï¼Œåˆ™å½“å®ƒæ„è¯†åˆ°é”™è¯¯æ—¶ï¼Œå¿…é¡»å›æ»šå¯¹å…¶ architectural state æ‰€åšçš„ä»»ä½•æ›´æ”¹ã€‚ç”±äºæˆ‘ä»¬éƒ½åœ¨é€šè¿‡ Spectre æ ·å¼æ¼æ´è¿›è¡Œå­¦ä¹ ï¼Œå› æ­¤æœ‰æ—¶è¿™ç§å›æ»šå¹¶æ²¡æœ‰åƒå¸Œæœ›çš„é‚£æ ·æ— ç¼ã€‚\nå½“åˆ†æ”¯é¢„æµ‹ç‡è¾ƒä½æ—¶ï¼ŒæŠ•æœºæ‰§è¡Œå¯èƒ½ä¼šéå¸¸è€—ç”µã€‚å¦‚æœåˆ†æ”¯é¢„æµ‹é”™è¯¯ï¼Œä¸ä»… CPU å›æº¯åˆ°é¢„æµ‹é”™è¯¯çš„åœ°æ­¥ï¼Œè€Œä¸”æµªè´¹åœ¨é”™è¯¯åˆ†æ”¯ä¸Šçš„èƒ½é‡ä¹Ÿè¢«æµªè´¹äº†ã€‚\næ‰€æœ‰è¿™äº›ä¼˜åŒ–å¯¼è‡´æˆ‘ä»¬çœ‹åˆ°çš„å•çº¿ç¨‹æ€§èƒ½çš„æé«˜ï¼Œä½†è¦ä»˜å‡ºå¤§é‡æ™¶ä½“ç®¡å’ŒåŠŸç‡çš„ä»£ä»·ã€‚\nCliff Click çš„ ç²¾å½©æ¼”è®² è®¤ä¸ºä¹±åºï¼Œå¹¶ä¸”æ¨æµ‹æ€§æ‰§è¡Œå¯¹äºå°½æ—©å¼€å§‹ç¼“å­˜æœªå‘½ä¸­æœ€æœ‰ç”¨ï¼Œä»è€Œå‡å°‘äº†è§‚å¯Ÿåˆ°çš„ç¼“å­˜å»¶è¿Ÿã€‚\n1.10. ç°ä»£ CPU å·²é’ˆå¯¹æ‰¹é‡æ“ä½œè¿›è¡Œäº†ä¼˜åŒ– # ç°ä»£å¤„ç†å™¨å°±åƒæ˜¯ç”±ç¡åŸºç‡ƒæ–™é©±åŠ¨çš„æœ‰è¶£çš„æ±½è½¦ï¼Œå®ƒä»¬åœ¨å››åˆ†ä¹‹ä¸€è‹±é‡Œå¤„è¡¨ç°å‡ºè‰²ã€‚ä¸å¹¸çš„æ˜¯ï¼Œç°ä»£ç¼–ç¨‹è¯­è¨€å°±åƒè’™ç‰¹å¡æ´›ä¸€æ ·ï¼Œå……æ»¡äº†æ›²æŠ˜ã€‚- å¤§å«Â·æ˜‚åŠ ï¼ˆDavid Ungarï¼‰\nè¿™æ˜¯æ¥è‡ªæœ‰å½±å“åŠ›çš„è®¡ç®—æœºç§‘å­¦å®¶ï¼ŒSELF ç¼–ç¨‹è¯­è¨€çš„å¼€å‘äººå‘˜ David Ungar çš„å¼•è¨€ï¼Œåœ¨å¾ˆæ—§çš„æ¼”è®²ä¸­å°±å¼•ç”¨äº† I found online.\nå› æ­¤ï¼Œç°ä»£ CPU å·²é’ˆå¯¹æ‰¹é‡ä¼ è¾“å’Œæ‰¹é‡æ“ä½œè¿›è¡Œäº†ä¼˜åŒ–ã€‚ åœ¨æ¯ä¸ªçº§åˆ«ï¼Œæ“ä½œçš„è®¾ç½®æˆæœ¬éƒ½ä¼šé¼“åŠ±æ‚¨è¿›è¡Œå¤§é‡å·¥ä½œã€‚ ä¸€äº›ä¾‹å­åŒ…æ‹¬\nå†…å­˜ä¸æ˜¯æŒ‰å­—èŠ‚åŠ è½½ï¼Œè€Œæ˜¯æŒ‰é«˜é€Ÿç¼“å­˜è¡Œçš„å€æ•°åŠ è½½ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¯¹é½å˜å¾—ä¸å†åƒä»¥å‰çš„è®¡ç®—æœºé‚£æ ·æˆä¸ºé—®é¢˜çš„åŸå› ã€‚ MMX å’Œ SSE ç­‰å‘é‡æŒ‡ä»¤å…è®¸ä¸€æ¡æŒ‡ä»¤åŒæ—¶é’ˆå¯¹å¤šä¸ªæ•°æ®é¡¹æ‰§è¡Œï¼Œå‰ææ˜¯æ‚¨çš„ç¨‹åºå¯ä»¥ä»¥è¿™ç§å½¢å¼è¡¨ç¤ºã€‚ 1.11. ç°ä»£å¤„ç†å™¨å—å†…å­˜å»¶è¿Ÿè€Œä¸æ˜¯å†…å­˜å®¹é‡çš„é™åˆ¶ # å¦‚æœ CPU å ç”¨çš„çŠ¶å†µè¿˜ä¸å¤Ÿç³Ÿï¼Œé‚£ä¹ˆä»å†…å­˜æ–¹é¢æ¥çš„æ¶ˆæ¯å°±ä¸ä¼šå¥½å¤šäº†ã€‚\nè¿æ¥åˆ°æœåŠ¡å™¨çš„ç‰©ç†å†…å­˜åœ¨å‡ ä½•ä¸Šæœ‰æ‰€å¢åŠ ã€‚ æˆ‘åœ¨ 1980 å¹´ä»£çš„ç¬¬ä¸€å°è®¡ç®—æœºå…·æœ‰æ•°åƒå­—èŠ‚çš„å†…å­˜ã€‚ å½“æˆ‘è¯»é«˜ä¸­æ—¶ï¼Œæˆ‘æ‰€æœ‰çš„è®ºæ–‡éƒ½æ˜¯ç”¨ 3.8 MB çš„ 386 å†™åœ¨ 386 ä¸Šçš„ã€‚ ç°åœ¨ï¼ŒæŸ¥æ‰¾å…·æœ‰æ•°åæˆ–æ•°ç™¾ GB RAM çš„æœåŠ¡å™¨å·²å˜å¾—å¸ç©ºè§æƒ¯ï¼Œè€Œäº‘æä¾›å•†åˆ™å°†å…¶æ¨å‘äº† TB çš„ TBã€‚\nä½†æ˜¯ï¼Œå¤„ç†å™¨é€Ÿåº¦å’Œå†…å­˜è®¿é—®æ—¶é—´ä¹‹é—´çš„å·®è·ç»§ç»­æ‰©å¤§ã€‚\nä½†æ˜¯ï¼Œå°±ä¸¢å¤±å¤„ç†å™¨ç­‰å¾…å†…å­˜çš„å¤„ç†å™¨å‘¨æœŸè€Œè¨€ï¼Œç‰©ç†å†…å­˜ä»ä¸ä»¥å¾€ä¸€æ ·é¥ä¸å¯åŠï¼Œå› ä¸ºå†…å­˜æ— æ³•è·Ÿä¸Š CPU é€Ÿåº¦çš„æé«˜ã€‚\nå› æ­¤ï¼Œå¤§å¤šæ•°ç°ä»£å¤„ç†å™¨å—å†…å­˜å»¶è¿Ÿè€Œä¸æ˜¯å®¹é‡çš„é™åˆ¶ã€‚\n1.12. ç¼“å­˜æ§åˆ¶ç€æˆ‘ä»¬å‘¨å›´çš„ä¸€åˆ‡ # å‡ åå¹´æ¥ï¼Œè§£å†³å¤„ç†å™¨/å†…å­˜ä¸Šé™çš„è§£å†³æ–¹æ¡ˆæ˜¯æ·»åŠ ç¼“å­˜-ä¸€å—è¾ƒå°çš„å¿«é€Ÿå†…å­˜ï¼Œä½ç½®æ›´è¿‘ï¼Œç°åœ¨ç›´æ¥é›†æˆåˆ° CPU ä¸­ã€‚\nä½†;\næ•°åå¹´æ¥ï¼ŒL1 ä¸€ç›´åœç•™åœ¨æ¯ä¸ªæ ¸å¿ƒ 32kb L2 åœ¨æœ€å¤§çš„è‹±ç‰¹å°”éƒ¨åˆ†ä¸Šå·²ç¼“æ…¢çˆ¬å‡åˆ° 512kb L3 ç°åœ¨åœ¨ 4-32mb èŒƒå›´å†…ï¼Œä½†å…¶è®¿é—®æ—¶é—´å¯å˜ å—é«˜é€Ÿç¼“å­˜é™åˆ¶çš„å¤§å°æ˜¯å› ä¸ºå®ƒä»¬ physically large on the CPU dieï¼Œä¼šæ¶ˆè€—å¤§é‡åŠŸç‡ã€‚ è¦ä½¿ç¼“å­˜æœªå‘½ä¸­ç‡å‡åŠï¼Œæ‚¨å¿…é¡»å°†ç¼“å­˜å¤§å°æé«˜ å››å€ã€‚\n1.13. å…è´¹åˆé¤ç»“æŸäº† # 2005 å¹´ï¼ŒC++ å§”å‘˜ä¼šè´Ÿè´£äºº Herb Sutter æ’°å†™äº†ä¸€ç¯‡é¢˜ä¸º å…è´¹åˆé¤ç»“æŸ çš„æ–‡ç« ã€‚ è¨ç‰¹ï¼ˆSutterï¼‰åœ¨ä»–çš„æ–‡ç« ä¸­è®¨è®ºäº†æˆ‘æ¶µç›–çš„æ‰€æœ‰è¦ç‚¹ï¼Œå¹¶æ–­è¨€æœªæ¥çš„ç¨‹åºå‘˜å°†ä¸å†èƒ½å¤Ÿä¾é è¾ƒå¿«çš„ç¡¬ä»¶æ¥ä¿®å¤è¾ƒæ…¢çš„ç¨‹åºæˆ–è¾ƒæ…¢çš„ç¼–ç¨‹è¯­è¨€ã€‚\nåå¤šå¹´åçš„ä»Šå¤©ï¼Œæ¯«æ— ç–‘é—®ï¼Œèµ«ä¼¯Â·è¨ç‰¹ï¼ˆHerb Sutterï¼‰æ˜¯æ­£ç¡®çš„ã€‚å†…å­˜å¾ˆæ…¢ï¼Œç¼“å­˜å¤ªå°ï¼ŒCPU æ—¶é’Ÿé€Ÿåº¦å€’é€€äº†ï¼Œå•çº¿ç¨‹ CPU çš„ç®€å•ä¸–ç•Œæ—©å·²ä¸€å»ä¸å¤è¿”äº†ã€‚\næ‘©å°”å®šå¾‹ä»ç„¶æœ‰æ•ˆï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬è¿™ä¸ªæˆ¿é—´é‡Œçš„æ‰€æœ‰äººæ¥è¯´ï¼Œå…è´¹åˆé¤å·²ç»ç»“æŸã€‚\n1.14. ç»“æŸ # æˆ‘è¦å¼•ç”¨çš„æ•°å­—æ˜¯åˆ° 2010 å¹´ï¼š30GHzï¼Œ100 äº¿ä¸ªæ™¶ä½“ç®¡å’Œæ¯ç§’ 1 å…†æŒ‡ä»¤ã€‚â€”â€‰Pat Gelsinger, Intel CTO, April 2002\nå¾ˆæ˜æ˜¾ï¼Œå¦‚æœæ²¡æœ‰ææ–™ç§‘å­¦æ–¹é¢çš„çªç ´ï¼ŒCPU æ€§èƒ½æ¢å¤åˆ°åŒæ¯” 52ï¼… å¢é•¿çš„å¯èƒ½æ€§å‡ ä¹å¾ˆå°ã€‚æ™®éçš„å…±è¯†æ˜¯ï¼Œæ•…éšœä¸åœ¨äºææ–™ç§‘å­¦æœ¬èº«ï¼Œè€Œåœ¨äºæ™¶ä½“ç®¡çš„ä½¿ç”¨æ–¹å¼ã€‚ç”¨ç¡…è¡¨ç¤ºçš„é¡ºåºæŒ‡ä»¤æµçš„é€»è¾‘æ¨¡å‹å¯¼è‡´äº†è¿™ç§æ˜‚è´µçš„æœ€ç»ˆç»“æœã€‚\nåœ¨çº¿ä¸Šæœ‰è®¸å¤šæ¼”ç¤ºæ–‡ç¨¿å¯ä»¥é‡è¿°è¿™ä¸€ç‚¹ã€‚ å®ƒä»¬éƒ½å…·æœ‰ç›¸åŒçš„é¢„æµ‹-å°†æ¥çš„è®¡ç®—æœºå°†ä¸ä¼šåƒä»Šå¤©è¿™æ ·ç¼–ç¨‹ã€‚ æœ‰äººè®¤ä¸ºå®ƒçœ‹èµ·æ¥æ›´åƒæ˜¯å¸¦æœ‰æ•°ç™¾ä¸ªéå¸¸ç¬¨æ‹™ï¼Œéå¸¸ä¸è¿è´¯çš„å¤„ç†å™¨çš„å›¾å½¢å¡ã€‚ å…¶ä»–äººåˆ™è®¤ä¸ºï¼Œè¶…é•¿æŒ‡ä»¤å­—ï¼ˆVLIWï¼‰è®¡ç®—æœºå°†æˆä¸ºä¸»æµã€‚ æ‰€æœ‰äººéƒ½åŒæ„ï¼Œæˆ‘ä»¬å½“å‰çš„é¡ºåºç¼–ç¨‹è¯­è¨€å°†ä¸æ­¤ç±»å¤„ç†å™¨ä¸å…¼å®¹ã€‚\næˆ‘çš„è§‚ç‚¹æ˜¯è¿™äº›é¢„æµ‹æ˜¯æ­£ç¡®çš„ï¼Œæ­¤æ—¶ç¡¬ä»¶åˆ¶é€ å•†æŒ½æ•‘æˆ‘ä»¬çš„å‰æ™¯ä¸¥å³»ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä»Šå¤©æ‹¥æœ‰çš„ç¡¬ä»¶ä¼˜åŒ–å½“å‰ç¨‹åºçš„èŒƒå›´æ˜¯ å·¨å¤§çš„ã€‚ é‡Œå…‹Â·å“ˆå¾·æ£®ï¼ˆRick Hudsonï¼‰åœ¨ GopherCon 2015 å¤§ä¼šä¸Šè°ˆåˆ° ä»¥\u0026quot;è‰¯å¥½çš„å¾ªç¯\u0026quot;é‡æ–°å‚ä¸ï¼Œè¯¥è½¯ä»¶å¯ä»¥ä¸æˆ‘ä»¬ä»Šå¤©æ‹¥æœ‰çš„ç¡¬ä»¶ä¸€èµ·å·¥ä½œï¼Œè€Œä¸æ˜¯ä»…é€‚ç”¨äºè¿™ç§ç¡¬ä»¶ ã€‚\næŸ¥çœ‹æˆ‘ä¹‹å‰æ˜¾ç¤ºçš„å›¾è¡¨ï¼Œä» 2015 å¹´åˆ° 2018 å¹´ï¼Œæ•´æ•°æ€§èƒ½æœ€å¤šæé«˜äº† 5-8ï¼…ï¼Œè€Œå†…å­˜å»¶è¿Ÿå´æœ€å¤šï¼ŒGo å›¢é˜Ÿå°†åƒåœ¾æ”¶é›†å™¨çš„æš‚åœæ—¶é—´å‡å°‘äº† ä¸¤ä¸ªæ•°é‡çº§ã€‚ ä¸ä½¿ç”¨ Go 1.6 çš„ç›¸åŒç¡¬ä»¶ä¸Šçš„åŒä¸€ç¨‹åºç›¸æ¯”ï¼ŒGo 1.11 ç¨‹åºå…·æœ‰æ›´å¥½çš„ GC å»¶è¿Ÿã€‚ è¿™äº›éƒ½ä¸æ˜¯æ¥è‡ªç¡¬ä»¶ã€‚\nå› æ­¤ï¼Œä¸ºäº†åœ¨å½“ä»Šä¸–ç•Œçš„å½“ä»Šç¡¬ä»¶ä¸Šè·å¾—æœ€ä½³æ€§èƒ½ï¼Œæ‚¨éœ€è¦ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œè¯¥è¯­è¨€åº”ï¼š\nä¹‹æ‰€ä»¥ç¼–è¯‘è€Œä¸æ˜¯è§£é‡Šï¼Œæ˜¯å› ä¸ºè§£é‡Šåçš„ç¼–ç¨‹è¯­è¨€ä¸ CPU åˆ†æ”¯é¢„æµ‹å˜é‡å’Œæ¨æµ‹æ€§æ‰§è¡Œä¹‹é—´çš„äº¤äº’ä½œç”¨å¾ˆå·®ã€‚ æ‚¨éœ€è¦ä¸€ç§è¯­è¨€æ¥å…è®¸ç¼–å†™æœ‰æ•ˆçš„ä»£ç ï¼Œå®ƒéœ€è¦èƒ½å¤Ÿè°ˆè®ºä½å’Œå­—èŠ‚ï¼Œå¹¶ä¸”å¿…é¡»æœ‰æ•ˆåœ°è¯´æ˜æ•´æ•°çš„é•¿åº¦ï¼Œè€Œä¸æ˜¯å‡è£…æ¯ä¸ªæ•°å­—éƒ½æ˜¯ç†æƒ³çš„æµ®ç‚¹æ•°ã€‚ æ‚¨éœ€è¦ä¸€ç§ä½¿ç¨‹åºå‘˜èƒ½å¤Ÿæœ‰æ•ˆåœ°è°ˆè®ºå†…å­˜ï¼Œæ€è€ƒç»“æ„ä¸ Java å¯¹è±¡çš„è¯­è¨€ï¼Œå› ä¸ºæ‰€æœ‰çš„æŒ‡é’ˆè¿½é€éƒ½ä¼šç»™ CPU é«˜é€Ÿç¼“å­˜å¸¦æ¥å‹åŠ›ï¼Œè€Œé«˜é€Ÿç¼“å­˜æœªå‘½ä¸­ä¼šæ¶ˆè€—æ•°ç™¾ä¸ªå‘¨æœŸã€‚ éšåº”ç”¨ç¨‹åºçš„æ€§èƒ½è€Œæ‰©å±•åˆ°å¤šä¸ªå†…æ ¸çš„ç¼–ç¨‹è¯­è¨€å–å†³äºå®ƒä½¿ç”¨ç¼“å­˜çš„æ•ˆç‡ä»¥åŠåœ¨å¤šä¸ªå†…æ ¸ä¸Šå¹¶è¡ŒåŒ–å·¥ä½œçš„æ•ˆç‡ã€‚ æ˜¾ç„¶ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè°ˆè®º Goï¼Œæˆ‘ç›¸ä¿¡ Go æ‹¥æœ‰äº†æˆ‘åˆšæ‰æè¿°çš„è®¸å¤šç‰¹å¾ã€‚\n1.14.1. è¿™å¯¹æˆ‘ä»¬æ„å‘³ç€ä»€ä¹ˆï¼Ÿ # åªæœ‰ä¸‰ç§ä¼˜åŒ–ï¼šå°‘åšäº›ã€‚å°‘åšä¸€æ¬¡ã€‚æ›´å¿«åœ°åšã€‚\næœ€å¤§çš„æ”¶ç›Šæ¥è‡ª 1ï¼Œä½†æˆ‘ä»¬å°†æ‰€æœ‰æ—¶é—´éƒ½èŠ±åœ¨ 3 ä¸Šã€‚â€‰â€”â€‰Michael Fromberger\næœ¬è®²åº§çš„ç›®çš„æ˜¯è¯´æ˜ï¼Œå½“æ‚¨è°ˆè®ºç¨‹åºæˆ–ç³»ç»Ÿçš„æ€§èƒ½æ—¶ï¼Œå®Œå…¨æ˜¯åœ¨è½¯ä»¶ä¸­ã€‚ç­‰å¾…æ›´å¿«çš„ç¡¬ä»¶æ¥æŒ½æ•‘ä¸€å¤©çœŸæ˜¯æ„šè ¢çš„äº‹æƒ…ã€‚\nä½†æ˜¯æœ‰ä¸ªå¥½æ¶ˆæ¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è½¯ä»¶ä¸Šè¿›è¡Œå¤§é‡æ”¹è¿›ï¼Œè€Œè¿™å°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦è®¨è®ºçš„ã€‚\n1.14.2. è¿›ä¸€æ­¥é˜…è¯» # The Future of Microprocessors, Sophie Wilson JuliaCon 2018 50 Years of Computer Architecture: From Mainframe CPUs to DNN TPUs, David Patterson The Future of Computing, John Hennessy The future of computing: a conversation with John Hennessy (Google I/O \u0026lsquo;18) 2. Benchmarking # æµ‹é‡ä¸¤æ¬¡ï¼Œå–ä¸€æ¬¡ã€‚â€‰â€”â€‰Ancient proverb\nåœ¨å°è¯•æ”¹å–„ä¸€æ®µä»£ç çš„æ€§èƒ½ä¹‹å‰ï¼Œé¦–å…ˆæˆ‘ä»¬å¿…é¡»äº†è§£å…¶å½“å‰æ€§èƒ½ã€‚\næœ¬èŠ‚é‡ç‚¹ä»‹ç»å¦‚ä½•ä½¿ç”¨ Go æµ‹è¯•æ¡†æ¶æ„å»ºæœ‰ç”¨çš„åŸºå‡†ï¼Œå¹¶æä¾›äº†é¿å…é™·é˜±çš„å®ç”¨æŠ€å·§ã€‚\n2.1. æ ‡æ†åŸºå‡†è§„åˆ™ # åœ¨è¿›è¡ŒåŸºå‡†æµ‹è¯•ä¹‹å‰ï¼Œå¿…é¡»å…·æœ‰ç¨³å®šçš„ç¯å¢ƒæ‰èƒ½è·å¾—å¯é‡å¤çš„ç»“æœã€‚\næœºå™¨å¿…é¡»å¤„äºé—²ç½®çŠ¶æ€-ä¸è¦åœ¨å…±äº«ç¡¬ä»¶ä¸Šè¿›è¡Œé…ç½®ï¼Œä¸è¦åœ¨ç­‰å¾…è¾ƒé•¿åŸºå‡†æµ‹è¯•è¿è¡Œæ—¶æµè§ˆç½‘ç»œã€‚ æ³¨æ„èŠ‚èƒ½å’Œçƒ­ç¼©æ”¾ã€‚è¿™äº›åœ¨ç°ä»£ç¬”è®°æœ¬ç”µè„‘ä¸Šå‡ ä¹æ˜¯ä¸å¯é¿å…çš„ã€‚ é¿å…ä½¿ç”¨è™šæ‹Ÿæœºå’Œå…±äº«äº‘æ‰˜ç®¡ï¼›å¯¹äºä¸€è‡´çš„æµ‹é‡ï¼Œå®ƒä»¬å¯èƒ½å¤ªå˜ˆæ‚ã€‚ å¦‚æœè´Ÿæ‹…å¾—èµ·ï¼Œè¯·è´­ä¹°ä¸“ç”¨çš„æ€§èƒ½æµ‹è¯•ç¡¬ä»¶ã€‚æœºæ¶å®‰è£…ï¼Œç¦ç”¨æ‰€æœ‰ç”µæºç®¡ç†å’Œçƒ­é‡ç¼©æ”¾åŠŸèƒ½ï¼Œå¹¶ä¸”æ°¸è¿œä¸è¦åœ¨è¿™äº›è®¡ç®—æœºä¸Šæ›´æ–°è½¯ä»¶ã€‚ æœ€åä¸€ç‚¹æ˜¯ä»ç³»ç»Ÿç®¡ç†çš„è§’åº¦æ¥çœ‹ç³Ÿç³•çš„å»ºè®®ï¼Œä½†æ˜¯å¦‚æœè½¯ä»¶æ›´æ–°æ”¹å˜äº†å†…æ ¸æˆ–åº“çš„æ‰§è¡Œæ–¹å¼ -æƒ³æƒ³ Spectre è¡¥ä¸- è¿™å°†ä½¿ä»¥å‰çš„ä»»ä½•åŸºå‡†æµ‹è¯•ç»“æœæ— æ•ˆã€‚\nå¯¹äºæˆ‘ä»¬å…¶ä»–äººï¼Œè¯·è¿›è¡Œå‰åé‡‡æ ·ï¼Œç„¶åå¤šæ¬¡è¿è¡Œä»¥è·å–ä¸€è‡´çš„ç»“æœã€‚\n2.2. Using the testing package for benchmarking # testing åŒ…å†…ç½®äº†å¯¹ç¼–å†™åŸºå‡†æµ‹è¯•çš„æ”¯æŒã€‚ å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œåƒè¿™æ ·ï¼š\nfunc Fib(n int) int { switch n { case 0: return 0 case 1: return 1 default: return Fib(n-1) + Fib(n-2) } } æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ testing åŒ…é€šè¿‡è¿™ç§å½¢å¼ä¸ºå‡½æ•°ç¼–å†™ä¸€ä¸ª åŸºå‡†ã€‚\nfunc BenchmarkFib20(b *testing.B) { for n := 0; n \u0026lt; b.N; n++ { Fib(20) // run the Fib function b.N times } } åŸºå‡†æµ‹è¯•åŠŸèƒ½ä¸æ‚¨çš„æµ‹è¯•ä¸€èµ·å­˜åœ¨äº _test.go æ–‡ä»¶ä¸­ã€‚\nBenchmarks are similar to tests, the only real difference is they take a *testing.B rather than a *testing.T. Both of these types implement the testing.TB interface which provides crowd favorites like Errorf(), Fatalf(), and FailNow().\nåŸºå‡†æµ‹è¯•ç±»ä¼¼äºæµ‹è¯•ï¼Œå”¯ä¸€çš„ä¸åŒæ˜¯åŸºå‡†æµ‹è¯•é‡‡ç”¨çš„æ˜¯ *testing.Bï¼Œè€Œä¸æ˜¯ *testing.Tã€‚è¿™ä¸¤ç§ç±»å‹éƒ½å®ç°äº† testing.TB æ¥å£ï¼Œè¯¥æ¥å£æä¾›äº†è¯¸å¦‚ Errorf()ï¼ŒFatalf() å’Œ FailNow() ä¹‹ç±»çš„æ–¹æ³•ã€‚\n2.2.1. è¿è¡Œè½¯ä»¶åŒ…çš„åŸºå‡†æµ‹è¯• # As benchmarks use the testing package they are executed via the go test subcommand. However, by default when you invoke go test, benchmarks are excluded.\nå½“åŸºå‡†æµ‹è¯•ä½¿ç”¨ æµ‹è¯• è½¯ä»¶åŒ…æ—¶ï¼Œå®ƒä»¬é€šè¿‡ go test å­å‘½ä»¤æ‰§è¡Œã€‚ ä½†æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ‚¨è°ƒç”¨ go test æ—¶ï¼Œå°†æ’é™¤åŸºå‡†æµ‹è¯•ã€‚\nè¦åœ¨åŒ…ä¸­æ˜¾å¼è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼Œè¯·ä½¿ç”¨ -bench æ ‡å¿—ã€‚-bench é‡‡ç”¨ä¸æ‚¨è¦è¿è¡Œçš„åŸºå‡†æµ‹è¯•åç§°åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå› æ­¤è°ƒç”¨åŒ…ä¸­æ‰€æœ‰åŸºå‡†æµ‹è¯•çš„æœ€å¸¸è§æ–¹æ³•æ˜¯ -bench=. è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼š\n% go test -bench=. ./examples/fib/ goos: darwin goarch: amd64 BenchmarkFib20-8 30000 40865 ns/op PASS ok _/Users/dfc/devel/high-performance-go-workshop/examples/fib 1.671s go test è¿˜å°†åœ¨åŒ¹é…åŸºå‡†ä¹‹å‰è¿è¡Œè½¯ä»¶åŒ…ä¸­çš„æ‰€æœ‰æµ‹è¯•ï¼Œå› æ­¤ï¼Œå¦‚æœè½¯ä»¶åŒ…ä¸­æœ‰å¾ˆå¤šæµ‹è¯•ï¼Œæˆ–è€…å®ƒä»¬èŠ±è´¹å¾ˆé•¿æ—¶é—´ï¼Œåˆ™å¯ä»¥é€šè¿‡ go test æä¾›çš„ -run å‚æ•°æ¥æ’é™¤å®ƒä»¬ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¸åŒ¹é…ï¼› å³ã€‚\ngo test -run=^$ 2.2.2. åŸºå‡†å¦‚ä½•è¿ä½œ # æ¯ä¸ªåŸºå‡†å‡½æ•°è°ƒç”¨çš„ b.N å€¼éƒ½ä¸åŒï¼Œè¿™æ˜¯åŸºå‡†åº”è¿è¡Œçš„è¿­ä»£æ¬¡æ•°ã€‚\nå¦‚æœåŸºå‡†åŠŸèƒ½åœ¨ 1 ç§’å†…ï¼ˆé»˜è®¤å€¼ï¼‰åœ¨ 1 ç§’å†…å®Œæˆï¼Œåˆ™ b.N ä» 1 å¼€å§‹ï¼Œç„¶å b.N å¢åŠ ï¼ŒåŸºå‡†åŠŸèƒ½å†æ¬¡è¿è¡Œã€‚\nb.N increases in the approximate sequence; 1, 2, 3, 5, 10, 20, 30, 50, 100, and so on. The benchmark framework tries to be smart and if it sees small values of b.N are completing relatively quickly, it will increase the the iteration count faster.\nb.N ä»¥è¿‘ä¼¼é¡ºåºå¢åŠ ï¼›1, 2, 3, 5, 10, 20, 30, 50, 100 ç­‰ã€‚åŸºå‡†æ¡†æ¶è¯•å›¾å˜å¾—èªæ˜ï¼Œå¦‚æœçœ‹åˆ°è¾ƒå°çš„ b.N å€¼ç›¸å¯¹è¾ƒå¿«åœ°å®Œæˆï¼Œå®ƒå°†æ›´å¿«åœ°å¢åŠ è¿­ä»£æ¬¡æ•°ã€‚\næŸ¥çœ‹ä¸Šé¢çš„ç¤ºä¾‹ï¼ŒBenchmarkFib20-8 å‘ç°å¾ªç¯çš„å¤§çº¦ 30,000 æ¬¡è¿­ä»£èŠ±è´¹äº†è¶…è¿‡ä¸€ç§’é’Ÿçš„æ—¶é—´ã€‚ä»é‚£é‡ŒåŸºå‡†æ¡†æ¶è®¡ç®—å¾—å‡ºï¼Œæ¯æ¬¡æ“ä½œçš„å¹³å‡æ—¶é—´ä¸º 40865nsã€‚\nåç¼€ -8 ä¸ç”¨äºè¿è¡Œæ­¤æµ‹è¯•çš„ GOMAXPROCS çš„å€¼æœ‰å…³ã€‚ è¯¥æ•°å­— GOMAXPROCS é»˜è®¤ä¸ºå¯åŠ¨æ—¶ Go è¿›ç¨‹å¯è§çš„ CPU æ•°ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ -cpu æ ‡å¿—æ¥æ›´æ”¹æ­¤å€¼ï¼Œè¯¥æ ‡å¿—å¸¦æœ‰ä¸€ä¸ªå€¼åˆ—è¡¨ä»¥è¿è¡ŒåŸºå‡†æµ‹è¯•ã€‚\n% go test -bench=. -cpu=1,2,4 ./examples/fib/ goos: darwin goarch: amd64 BenchmarkFib20 30000 39115 ns/op BenchmarkFib20-2 30000 39468 ns/op BenchmarkFib20-4 50000 40728 ns/op PASS ok _/Users/dfc/devel/high-performance-go-workshop/examples/fib 5.531s è¿™æ˜¾ç¤ºäº†ä»¥ 1ã€2 å’Œ 4 æ ¸è¿è¡ŒåŸºå‡†æµ‹è¯•ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥æ ‡å¿—å¯¹ç»“æœå‡ ä¹æ²¡æœ‰å½±å“ï¼Œå› ä¸ºè¯¥åŸºå‡†æ˜¯å®Œå…¨é¡ºåºçš„ã€‚\n2.2.3. æé«˜åŸºå‡†ç²¾åº¦ # fib åŠŸèƒ½æ˜¯ä¸€ä¸ªç¨ä½œè®¾è®¡çš„ç¤ºä¾‹-é™¤éæ‚¨ç¼–å†™ TechPower Web æœåŠ¡å™¨åŸºå‡†æµ‹è¯•-å¦åˆ™æ‚¨çš„ä¸šåŠ¡ä¸å¤ªå¯èƒ½ä¼šå› æ‚¨èƒ½å¤Ÿå¿«é€Ÿè®¡ç®—å‡ºæ–æ³¢é‚£å¥‘åºåˆ—ä¸­çš„ç¬¬ 20 ä¸ªæ•°å­—è€Œå—åˆ°é™åˆ¶ã€‚ä½†æ˜¯ï¼ŒåŸºå‡†ç¡®å®æä¾›äº†æœ‰æ•ˆåŸºå‡†çš„å¿ å®ç¤ºä¾‹ã€‚\nå…·ä½“æ¥è¯´ï¼Œæ‚¨å¸Œæœ›åŸºå‡†æµ‹è¯•å¯ä»¥è¿è¡Œæ•°ä¸‡æ¬¡è¿­ä»£ï¼Œä»¥ä¾¿æ¯ä¸ªæ“ä½œè·å¾—è‰¯å¥½çš„å¹³å‡å€¼ã€‚å¦‚æœæ‚¨çš„åŸºå‡†æµ‹è¯•ä»…è¿è¡Œ 100 æˆ– 10 æ¬¡è¿­ä»£ï¼Œåˆ™è¿™äº›è¿è¡Œçš„å¹³å‡å€¼å¯èƒ½ä¼šæœ‰è¾ƒé«˜çš„æ ‡å‡†åå·®ã€‚å¦‚æœæ‚¨çš„åŸºå‡†æµ‹è¯•è¿è¡Œäº†æ•°ç™¾ä¸‡æˆ–æ•°åäº¿æ¬¡è¿­ä»£ï¼Œåˆ™å¹³å‡å€¼å¯èƒ½éå¸¸å‡†ç¡®ï¼Œä½†ä¼šå—åˆ°ä»£ç å¸ƒå±€å’Œå¯¹é½æ–¹å¼çš„å½±å“ã€‚\nä¸ºäº†å¢åŠ è¿­ä»£æ¬¡æ•°ï¼Œå¯ä»¥ä½¿ç”¨ -benchtime æ ‡å¿—æ¥å¢åŠ åŸºå‡†æ—¶é—´ã€‚ ä¾‹å¦‚ï¼š\n% go test -bench=. -benchtime=10s ./examples/fib/ goos: darwin goarch: amd64 BenchmarkFib20-8 300000 39318 ns/op PASS ok _/Users/dfc/devel/high-performance-go-workshop/examples/fib 20.066s è¿è¡Œç›¸åŒçš„åŸºå‡†ï¼Œç›´åˆ°è¾¾åˆ° b.N çš„å€¼ï¼Œå¹¶èŠ±è´¹äº†è¶…è¿‡ 10 ç§’çš„æ—¶é—´æ‰èƒ½è¿”å›ã€‚ç”±äºæˆ‘ä»¬çš„è¿è¡Œæ—¶é—´å¢åŠ äº† 10 å€ï¼Œå› æ­¤è¿­ä»£çš„æ€»æ•°ä¹Ÿå¢åŠ äº† 10 å€ã€‚ ç»“æœå¹¶æ²¡æœ‰å¤ªå¤§å˜åŒ–ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚\nä¸ºä»€ä¹ˆæŠ¥å‘Šçš„æ€»æ—¶é—´æ˜¯ 20 ç§’ï¼Œè€Œä¸æ˜¯ 10 ç§’ï¼Ÿ å¦‚æœæ‚¨æœ‰ä¸€ä¸ªåŸºå‡†è¿è¡Œæ•°ç™¾ä¸‡æˆ–æ•°åäº¿æ¬¡è¿­ä»£ï¼Œå¯¼è‡´æ¯æ¬¡æ“ä½œçš„æ—¶é—´åœ¨å¾®ç§’æˆ–çº³ç§’èŒƒå›´å†…ï¼Œåˆ™æ‚¨å¯èƒ½ä¼šå‘ç°åŸºå‡†å€¼ä¸ç¨³å®šï¼Œå› ä¸ºçƒ­ç¼©æ”¾ï¼Œå†…å­˜å±€éƒ¨æ€§ï¼Œåå°å¤„ç†ï¼Œgc æ´»åŠ¨ç­‰ã€‚\nå¯¹äºæ¯æ¬¡æ“ä½œä»¥ 10 çº³ç§’æˆ–ä¸€ä½æ•°çº³ç§’ä¸ºå•ä½çš„æ—¶é—´ï¼ŒæŒ‡ä»¤é‡æ–°æ’åºå’Œä»£ç å¯¹é½çš„ç›¸å¯¹è®ºæ•ˆåº”å°†å¯¹åŸºå‡†æ—¶é—´äº§ç”Ÿå½±å“ã€‚\nè¦ä½¿ç”¨ -count æ ‡å¿—æ¥å¤šæ¬¡è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼š\n% go test -bench=Fib1 -count=10 ./examples/fib/ goos: darwin goarch: amd64 BenchmarkFib1-8 2000000000 1.99 ns/op BenchmarkFib1-8 1000000000 1.95 ns/op BenchmarkFib1-8 2000000000 1.99 ns/op BenchmarkFib1-8 2000000000 1.97 ns/op BenchmarkFib1-8 2000000000 1.99 ns/op BenchmarkFib1-8 2000000000 1.96 ns/op BenchmarkFib1-8 2000000000 1.99 ns/op BenchmarkFib1-8 2000000000 2.01 ns/op BenchmarkFib1-8 2000000000 1.99 ns/op BenchmarkFib1-8 1000000000 2.00 ns/op Fib(1) åŸºå‡†æµ‹è¯•å¤§çº¦éœ€è¦ 2 çº³ç§’ï¼Œæ–¹å·®ä¸º +/- 2ï¼…ã€‚\nGo 1.12 ä¸­çš„æ–°å¢åŠŸèƒ½æ˜¯ -benchtime æ ‡å¿—ï¼Œç°åœ¨éœ€è¦è¿›è¡Œå¤šæ¬¡è¿­ä»£ï¼Œä¾‹å¦‚ã€‚-benchtime=20xï¼Œå®ƒå°†å‡†ç¡®åœ°è¿è¡Œæ‚¨çš„ä»£ç  benchtime çš„æ—¶é—´ã€‚\nå°è¯•ä»¥10å€ï¼Œ20å€ï¼Œ50å€ï¼Œ100å€å’Œ300å€çš„ `-benchtime` è¿è¡Œä¸Šé¢çš„ fib æµ‹è¯•ã€‚ ä½ çœ‹åˆ°äº†ä»€ä¹ˆï¼Ÿ If you find that the defaults that go test applies need to be tweaked for a particular package, I suggest codifying those settings in a Makefile so everyone who wants to run your benchmarks can do so with the same settings.\nå¦‚æœæ‚¨å‘ç°éœ€è¦é’ˆå¯¹ç‰¹å®šçš„è½¯ä»¶åŒ…è°ƒæ•´ go test çš„é»˜è®¤è®¾ç½®ï¼Œæˆ‘å»ºè®®å°†è¿™äº›è®¾ç½®ç¼–å…¥ Makefile ä¸­ï¼Œè¿™æ ·ï¼Œæ¯ä¸ªæƒ³è¦è¿è¡ŒåŸºå‡†æµ‹è¯•çš„äººéƒ½å¯ä»¥ä½¿ç”¨ç›¸åŒçš„è®¾ç½®ã€‚\n2.3. å°†åŸºå‡†ä¸ Benchstat è¿›è¡Œæ¯”è¾ƒ # åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘å»ºè®®å¤šæ¬¡è¿è¡ŒåŸºå‡†æµ‹è¯•ä»¥ä½¿æ›´å¤šæ•°æ®å¹³å‡ã€‚ç”±äºæœ¬ç« å¼€å¤´æåˆ°çš„ç”µæºç®¡ç†ï¼Œåå°è¿‡ç¨‹å’Œçƒ­ç®¡ç†çš„å½±å“ï¼Œè¿™å¯¹äºä»»ä½•åŸºå‡†æµ‹è¯•éƒ½æ˜¯å¾ˆå¥½çš„å»ºè®®ã€‚\næˆ‘å°†ä»‹ç» Russ Cox çš„ä¸€ä¸ªå·¥å…· benchstat.\n% go get golang.org/x/perf/cmd/benchstat Benchstat å¯ä»¥è¿›è¡Œä¸€ç³»åˆ—åŸºå‡†æµ‹è¯•ï¼Œå¹¶å‘Šè¯‰æ‚¨å®ƒä»¬çš„ç¨³å®šæ€§ã€‚ è¿™æ˜¯æœ‰å…³ç”µæ± ä¾›ç”µçš„ Fib(20) ç¤ºä¾‹ã€‚\n% go test -bench=Fib20 -count=10 ./examples/fib/ | tee old.txt goos: darwin goarch: amd64 BenchmarkFib20-8 50000 38479 ns/op BenchmarkFib20-8 50000 38303 ns/op BenchmarkFib20-8 50000 38130 ns/op BenchmarkFib20-8 50000 38636 ns/op BenchmarkFib20-8 50000 38784 ns/op BenchmarkFib20-8 50000 38310 ns/op BenchmarkFib20-8 50000 38156 ns/op BenchmarkFib20-8 50000 38291 ns/op BenchmarkFib20-8 50000 38075 ns/op BenchmarkFib20-8 50000 38705 ns/op PASS ok _/Users/dfc/devel/high-performance-go-workshop/examples/fib 23.125s % benchstat old.txt name time/op Fib20-8 38.4Âµs Â± 1% benchstat å‘Šè¯‰æˆ‘ä»¬å¹³å‡å€¼ä¸º 38.8 å¾®ç§’ï¼Œæ ·æœ¬ä¹‹é—´çš„å˜åŒ–ä¸º +/- 2ï¼…ã€‚è¿™å¯¹äºç”µæ± ä¾›ç”µæ¥è¯´ç›¸å½“ä¸é”™ã€‚\nç¬¬ä¸€æ¬¡è¿è¡Œæ˜¯æœ€æ…¢çš„ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿå·²é™ä½ CPU æ—¶é’Ÿä»¥èŠ‚çœç”µé‡ã€‚ æ¥ä¸‹æ¥çš„ä¸¤æ¬¡è¿è¡Œæ˜¯æœ€å¿«çš„ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿç¡®å®šè¿™ä¸æ˜¯å·¥ä½œçš„çŸ­æš‚é«˜å³°ï¼Œå¹¶ä¸”æé«˜äº†æ—¶é’Ÿé€Ÿåº¦ä»¥å°½å¿«å®Œæˆå·¥ä½œï¼Œä»è€Œå¸Œæœ›èƒ½å¤Ÿè¿”å›ç¡è§‰ã€‚ å…¶ä½™è¿è¡Œæ˜¯æ“ä½œç³»ç»Ÿå’Œä¾›çƒ­ç”Ÿäº§çš„ BIOS äº¤äº’åŠŸè€—ã€‚ 2.3.1. Improve Fib # ç¡®å®šä¸¤ç»„åŸºå‡†ä¹‹é—´çš„æ€§èƒ½å·®å¼‚å¯èƒ½æ˜¯ä¹å‘³ä¸”å®¹æ˜“å‡ºé”™çš„ã€‚benchstat å¯ä»¥å¸®åŠ©æˆ‘ä»¬ã€‚\nSaving the output from a benchmark run is useful, but you can also save the binary that produced it. This lets you rerun benchmark previous iterations. To do this, use the -c flag to save the test binaryâ€”â€‹I often rename this binary from .test to .golden.\nä¿å­˜æ¥è‡ªåŸºå‡†è¿è¡Œçš„è¾“å‡ºå¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯æ‚¨ä¹Ÿå¯ä»¥ä¿å­˜äº§ç”Ÿå®ƒçš„ äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ è¿™ä½¿æ‚¨å¯ä»¥é‡æ–°è¿è¡ŒåŸºå‡†æµ‹è¯•ä»¥å‰çš„è¿­ä»£ã€‚ ä¸ºæ­¤ï¼Œè¯·ä½¿ç”¨ -cæ ‡å¿—ä¿å­˜æµ‹è¯•äºŒè¿›åˆ¶æ–‡ä»¶æˆ‘ç»å¸¸å°†æ­¤äºŒè¿›åˆ¶æ–‡ä»¶ä» .test é‡å‘½åä¸º .goldenã€‚\n% go test -c % mv fib.test fib.golden å…ˆå‰çš„ Fib åŠŸèƒ½å…·æœ‰æ–æ³¢é‚£å¥‘ç³»åˆ—ä¸­ç¬¬ 0 å’Œç¬¬ 1 ä¸ªæ•°å­—çš„ç¡¬ç¼–ç å€¼ã€‚ä¹‹åï¼Œä»£ç ä»¥é€’å½’æ–¹å¼è°ƒç”¨è‡ªèº«ã€‚ä»Šå¤©æ™šäº›æ—¶å€™ï¼Œæˆ‘ä»¬å°†è®¨è®ºé€’å½’çš„æˆæœ¬ï¼Œä½†æ˜¯ç›®å‰ï¼Œå‡è®¾é€’å½’çš„æˆæœ¬æ˜¯å¾ˆé«˜çš„ï¼Œå°¤å…¶æ˜¯å› ä¸ºæˆ‘ä»¬çš„ç®—æ³•ä½¿ç”¨çš„æ˜¯æŒ‡æ•°æ—¶é—´ã€‚\nå¯¹æ­¤çš„ç®€å•è§£å†³æ–¹æ³•æ˜¯å¯¹æ–æ³¢é‚£å¥‘æ•°åˆ—ä¸­çš„å¦ä¸€ä¸ªæ•°å­—è¿›è¡Œç¡¬ç¼–ç ï¼Œä»è€Œå°†æ¯ä¸ªå¯å›æº¯è°ƒç”¨çš„æ·±åº¦å‡å°‘ä¸€ä¸ªã€‚\nfunc Fib(n int) int { switch n { case 0: return 0 case 1: return 1 case 2: return 1 default: return Fib(n-1) + Fib(n-2) } } è¯¥æ–‡ä»¶è¿˜åŒ…å«å¯¹ Fib çš„ç»¼åˆæµ‹è¯•ã€‚å¦‚æœæ²¡æœ‰é€šè¿‡éªŒè¯å½“å‰è¡Œä¸ºçš„æµ‹è¯•ï¼Œè¯·å‹¿å°è¯•æé«˜åŸºå‡†ã€‚\nä¸ºäº†æ¯”è¾ƒæˆ‘ä»¬çš„æ–°ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ç¼–è¯‘äº†ä¸€ä¸ªæ–°çš„æµ‹è¯•äºŒè¿›åˆ¶æ–‡ä»¶å¹¶å¯¹å…¶è¿›è¡Œäº†åŸºå‡†æµ‹è¯•ï¼Œå¹¶ä½¿ç”¨ benchstat æ¥æ¯”è¾ƒè¾“å‡ºã€‚\n% go test -c % ./fib.golden -test.bench=. -test.count=10 \u0026gt; old.txt % ./fib.test -test.bench=. -test.count=10 \u0026gt; new.txt % benchstat old.txt new.txt name old time/op new time/op delta Fib20-8 44.3Âµs Â± 6% 25.6Âµs Â± 2% -42.31% (p=0.000 n=10+10) æ¯”è¾ƒåŸºå‡†æ—¶éœ€è¦æ£€æŸ¥ä¸‰ä»¶äº‹\næ—§æ—¶ä»£å’Œæ–°æ—¶æœŸçš„æ–¹å·® Â±ã€‚ 1-2ï¼… æ˜¯å¥½çš„ï¼Œ3-5ï¼… æ˜¯å¯ä»¥çš„ï¼Œå¤§äº 5ï¼…ï¼Œå¹¶ä¸”æ‚¨çš„æŸäº›æ ·æœ¬å°†è¢«è®¤ä¸ºä¸å¯é ã€‚ æ¯”è¾ƒä¸€ä¾§å·®å¼‚è¾ƒå¤§çš„åŸºå‡†æ—¶ï¼Œè¯·æ³¨æ„ä¸è¦æœ‰æ‰€æ”¹å–„ã€‚ p å€¼ã€‚ p å€¼å°äº 0.05 è¡¨ç¤ºè‰¯å¥½ï¼Œå¤§äº 0.05 è¡¨ç¤ºåŸºå‡†å¯èƒ½æ²¡æœ‰ç»Ÿè®¡å­¦æ„ä¹‰ã€‚ ç¼ºå°‘æ ·æœ¬ã€‚benchstat å°†æŠ¥å‘Šå®ƒè®¤ä¸ºæœ‰æ•ˆçš„æ—§æ ·æœ¬å’Œæ–°æ ·æœ¬ä¸­çš„å¤šå°‘ä¸ªï¼Œæœ‰æ—¶å³ä½¿æ‚¨æ‰§è¡Œäº† -count=10ï¼Œä¹Ÿå¯èƒ½åªæŠ¥å‘Šäº† 9 ä¸ªã€‚ 10ï¼… æˆ–æ›´ä½çš„æ‹’ç»ç‡æ˜¯å¯ä»¥çš„ï¼Œé«˜äº 10ï¼… å¯èƒ½è¡¨æ˜æ‚¨çš„è®¾ç½®ä¸ç¨³å®šï¼Œå¹¶ä¸”æ‚¨å¯èƒ½æ¯”è¾ƒçš„æ ·æœ¬å¤ªå°‘ã€‚ 2.4. é¿å…åŸºå‡†åŒ–å¯åŠ¨æˆæœ¬ # æœ‰æ—¶ï¼Œæ‚¨çš„åŸºå‡†æµ‹è¯•å…·æœ‰ä¸€æ¬¡è¿è¡Œè®¾ç½®æˆæœ¬ã€‚b.ResetTimer() å°†ç”¨äºå¿½ç•¥è®¾ç½®ä¸­çš„æ—¶é—´ã€‚\nfunc BenchmarkExpensive(b *testing.B) { boringAndExpensiveSetup() b.ResetTimer() // (1) for n := 0; n \u0026lt; b.N; n++ { // function under test } } | 1 | é‡ç½®åŸºå‡†è®¡æ—¶å™¨ |\nå¦‚æœ æ¯ä¸ªå¾ªç¯ è¿­ä»£éƒ½æœ‰ä¸€äº›æ˜‚è´µçš„è®¾ç½®é€»è¾‘ï¼Œè¯·ä½¿ç”¨ b.StopTimer() å’Œ b.StartTimer() æš‚åœåŸºå‡†è®¡æ—¶å™¨ã€‚\nfunc BenchmarkComplicated(b *testing.B) { for n := 0; n \u0026lt; b.N; n++ { b.StopTimer() // (1) complicatedSetup() b.StartTimer() // (2) // function under test } } | 1 | æš‚åœåŸºå‡†æµ‹è¯•è®¡æ—¶å™¨ | | 2 | æ¢å¤è®¡æ—¶å™¨ |\n2.5. åŸºå‡†åˆ†é… # åˆ†é…æ•°é‡å’Œå¤§å°ä¸åŸºå‡†æ—¶é—´å¯†åˆ‡ç›¸å…³ã€‚ æ‚¨å¯ä»¥å‘Šè¯‰ testing æ¡†æ¶è®°å½•è¢«æµ‹ä»£ç åˆ†é…çš„æ•°é‡ã€‚\nfunc BenchmarkRead(b *testing.B) { b.ReportAllocs() for n := 0; n \u0026lt; b.N; n++ { // function under test } } è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ bufio è½¯ä»¶åŒ…åŸºå‡†æµ‹è¯•çš„ç¤ºä¾‹ã€‚\n% go test -run=^$ -bench=. bufio goos: darwin goarch: amd64 pkg: bufio BenchmarkReaderCopyOptimal-8 20000000 103 ns/op BenchmarkReaderCopyUnoptimal-8 10000000 159 ns/op BenchmarkReaderCopyNoWriteTo-8 500000 3644 ns/op BenchmarkReaderWriteToOptimal-8 5000000 344 ns/op BenchmarkWriterCopyOptimal-8 20000000 98.6 ns/op BenchmarkWriterCopyUnoptimal-8 10000000 131 ns/op BenchmarkWriterCopyNoReadFrom-8 300000 3955 ns/op BenchmarkReaderEmpty-8 2000000 789 ns/op 4224 B/op 3 allocs/op BenchmarkWriterEmpty-8 2000000 683 ns/op 4096 B/op 1 allocs/op BenchmarkWriterFlush-8 100000000 17.0 ns/op 0 B/op 0 allocs/op You can also use the go test -benchmem flag to force the testing framework to report allocation statistics for all benchmarks run.\n% go test -run=^$ -bench=. -benchmem bufio goos: darwin goarch: amd64 pkg: bufio BenchmarkReaderCopyOptimal-8 20000000 93.5 ns/op 16 B/op 1 allocs/op BenchmarkReaderCopyUnoptimal-8 10000000 155 ns/op 32 B/op 2 allocs/op BenchmarkReaderCopyNoWriteTo-8 500000 3238 ns/op 32800 B/op 3 allocs/op BenchmarkReaderWriteToOptimal-8 5000000 335 ns/op 16 B/op 1 allocs/op BenchmarkWriterCopyOptimal-8 20000000 96.7 ns/op 16 B/op 1 allocs/op BenchmarkWriterCopyUnoptimal-8 10000000 124 ns/op 32 B/op 2 allocs/op BenchmarkWriterCopyNoReadFrom-8 500000 3219 ns/op 32800 B/op 3 allocs/op BenchmarkReaderEmpty-8 2000000 748 ns/op 4224 B/op 3 allocs/op BenchmarkWriterEmpty-8 2000000 662 ns/op 4096 B/op 1 allocs/op BenchmarkWriterFlush-8 100000000 16.9 ns/op 0 B/op 0 allocs/op PASS ok bufio 20.366s 2.6. æ³¨æ„ç¼–è¯‘å™¨çš„ä¼˜åŒ– # è¿™ä¸ªä¾‹å­æ¥è‡ª issue 14813.\nconst m1 = 0x5555555555555555 const m2 = 0x3333333333333333 const m4 = 0x0f0f0f0f0f0f0f0f const h01 = 0x0101010101010101 func popcnt(x uint64) uint64 { x -= (x \u0026gt;\u0026gt; 1) \u0026amp; m1 x = (x \u0026amp; m2) + ((x \u0026gt;\u0026gt; 2) \u0026amp; m2) x = (x + (x \u0026gt;\u0026gt; 4)) \u0026amp; m4 return (x * h01) \u0026gt;\u0026gt; 56 } func BenchmarkPopcnt(b *testing.B) { for i := 0; i \u0026lt; b.N; i++ { popcnt(uint64(i)) } } æ‚¨è®¤ä¸ºè¯¥åŠŸèƒ½å°†ä»¥å¤šå¿«çš„é€Ÿåº¦è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Ÿ è®©æˆ‘ä»¬æ‰¾å‡ºç­”æ¡ˆã€‚\n% go test -bench=. ./examples/popcnt/ goos: darwin goarch: amd64 BenchmarkPopcnt-8 2000000000 0.30 ns/op PASS\u0026lt;/pre\u0026gt; 0.3 çº³ç§’ï¼›è¿™åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚å³ä½¿å‡è®¾æ¯ä¸ªæ—¶é’Ÿå‘¨æœŸä¸­ CPU å¯èƒ½æ­£åœ¨è¿è¡Œä¸€äº›æŒ‡ä»¤ï¼Œè¯¥æ•°å­—ä¼¼ä¹ä¹Ÿè¿‡ä½ã€‚å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ\nTo understand what happened, we have to look at the function under benchmake, popcnt. popcnt is a leaf functionâ€‰â€”â€‰it does not call any other functionsâ€‰â€”â€‰so the compiler can inline it.\nè¦äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬å¿…é¡»æŸ¥çœ‹ benchmake ä¸‹çš„å‡½æ•° popcntã€‚popcnt æ˜¯ å¶å‡½æ•°(å®ƒä¸è°ƒç”¨ä»»ä½•å…¶ä»–å‡½æ•°) å› æ­¤ç¼–è¯‘å™¨å¯ä»¥å†…è”å®ƒã€‚\nå› ä¸ºè¯¥å‡½æ•°æ˜¯å†…è”çš„ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ç°åœ¨å¯ä»¥çœ‹åˆ°å®ƒæ²¡æœ‰å‰¯ä½œç”¨ã€‚ popcnt ä¸ä¼šå½±å“ä»»ä½•å…¨å±€å˜é‡çš„çŠ¶æ€ã€‚ å› æ­¤ï¼Œæ¶ˆé™¤äº†è¯¥è°ƒç”¨ã€‚è¿™æ˜¯ç¼–è¯‘å™¨çœ‹åˆ°çš„ï¼š\nfunc BenchmarkPopcnt(b *testing.B) { for i := 0; i \u0026lt; b.N; i++ { // optimised away } } åœ¨æˆ‘æµ‹è¯•è¿‡çš„æ‰€æœ‰ Go ç¼–è¯‘å™¨ç‰ˆæœ¬ä¸­ï¼Œä»ç„¶ä¼šç”Ÿæˆå¾ªç¯ã€‚ ä½†æ˜¯è‹±ç‰¹å°” CPU ç¡®å®æ“…é•¿ä¼˜åŒ–å¾ªç¯ï¼Œå°¤å…¶æ˜¯ç©ºå¾ªç¯ã€‚\n2.6.1. ç»ƒä¹ ï¼Œå®è·µ # åœ¨ç»§ç»­ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å®è·µä¸€ä¸‹ä»¥ç¡®è®¤æˆ‘ä»¬æ‰€çœ‹åˆ°çš„\n% go test -gcflags=-S ä½¿ç”¨ `gcflags=\u0026#34;-l -S\u0026#34;` ç¦ç”¨å†…è”ï¼Œè¿™å¯ä»¥å½±å“ç¨‹åºè¾“å‡º è¦æ¶ˆé™¤çš„äº‹æƒ…æ˜¯ä¸é€šè¿‡æ¶ˆé™¤ä¸å¿…è¦çš„è®¡ç®—æ¥ä½¿å®é™…ä»£ç ç›¸åŒçš„ä¼˜åŒ–ï¼Œå³æ¶ˆé™¤äº†æ²¡æœ‰å¯è§‚å¯Ÿåˆ°çš„å‰¯ä½œç”¨çš„åŸºå‡†æµ‹è¯•ã€‚ éšç€ Go ç¼–è¯‘å™¨çš„æ”¹è¿›ï¼Œè¿™åªä¼šå˜å¾—è¶Šæ¥è¶Šæ™®éã€‚\n2.6.2. ä¿®å¤åŸºå‡† # ç¦ç”¨å†…è”ä»¥ä½¿åŸºå‡†æµ‹è¯•æœ‰æ•ˆæ˜¯ä¸ç°å®çš„ï¼›æˆ‘ä»¬å¸Œæœ›åœ¨ä¼˜åŒ–çš„åŸºç¡€ä¸Šæ„å»ºä»£ç ã€‚\nä¸ºäº†ä¿®æ­£è¿™ä¸ªåŸºå‡†ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿ç¼–è¯‘å™¨æ— æ³• è¯æ˜ BenchmarkPopcnt çš„ä¸»ä½“ä¸ä¼šå¼•èµ·å…¨å±€çŠ¶æ€çš„æ”¹å˜ã€‚\nvar Result uint64 func BenchmarkPopcnt(b *testing.B) { var r uint64 for i := 0; i \u0026lt; b.N; i++ { r = popcnt(uint64(i)) } Result = r } è¿™æ˜¯ç¡®ä¿ç¼–è¯‘å™¨æ— æ³•ä¼˜åŒ–å¾ªç¯ä¸»ä½“çš„æ¨èæ–¹æ³•ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡å°†å…¶å­˜å‚¨åœ¨ r ä¸­æ¥ä½¿ç”¨è°ƒç”¨ popcnt çš„ç»“æœã€‚å…¶æ¬¡ï¼Œç”±äºä¸€æ—¦åŸºå‡†æµ‹è¯•ç»“æŸï¼Œr å°±åœ¨ BenchmarkPopcnt çš„èŒƒå›´å†…å±€éƒ¨å£°æ˜ï¼Œæ‰€ä»¥ r çš„ç»“æœå¯¹äºç¨‹åºçš„å¦ä¸€éƒ¨åˆ†æ°¸è¿œæ˜¯ä¸å¯è§çš„ï¼Œå› æ­¤ä½œä¸ºæœ€åçš„åŠ¨ä½œï¼Œæˆ‘ä»¬å°† r çš„å€¼èµ‹å€¼å‚¨å­˜åˆ°åŒ…å…¬å…±å˜é‡ Resultã€‚\nBecause Result is public the compiler cannot prove that another package importing this one will not be able to see the value of Result changing over time, hence it cannot optimise away any of the operations leading to its assignment.\nWhat happens if we assign to Result directly? Does this affect the benchmark time? What about if we assign the result of popcnt to _?\nç”±äº Result æ˜¯å…¬å¼€çš„ï¼Œå› æ­¤ç¼–è¯‘å™¨æ— æ³•è¯æ˜å¯¼å…¥è¯¥è½¯ä»¶åŒ…çš„å¦ä¸€ä¸ªåŒ…å°†æ— æ³•çœ‹åˆ° Result çš„å€¼éšæ—¶é—´å˜åŒ–ï¼Œå› æ­¤å®ƒæ— æ³•ä¼˜åŒ–å¯¼è‡´å…¶èµ‹å€¼çš„ä»»ä½•æ“ä½œã€‚\nå¦‚æœç›´æ¥åˆ†é…ç»™ Result ä¼šæ€æ ·ï¼Ÿè¿™ä¼šå½±å“åŸºå‡†æ—¶é—´å—ï¼Ÿå¦‚æœå°† popcnt çš„ç»“æœèµ‹ç»™ _ ä¼šæ€ä¹ˆæ ·ï¼Ÿ\nåœ¨æˆ‘ä»¬ä¹‹å‰çš„ Fib åŸºå‡†æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰é‡‡å–è¿™äº›é¢„é˜²æªæ–½ï¼Œåº”è¯¥è¿™æ ·åšå—ï¼Ÿ\n2.7. åŸºå‡†è¯¯å·® # for å¾ªç¯å¯¹äºåŸºå‡†æµ‹è¯•çš„è¿è¡Œè‡³å…³é‡è¦ã€‚\nè¿™æ˜¯ä¸¤ä¸ªä¸æ­£ç¡®çš„åŸºå‡†ï¼Œæ‚¨èƒ½è§£é‡Šä¸€ä¸‹å®ƒä»¬æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ\nfunc BenchmarkFibWrong(b *testing.B) { Fib(b.N) } func BenchmarkFibWrong2(b *testing.B) { for n := 0; n \u0026lt; b.N; n++ { Fib(n) } } è¿è¡Œè¿™äº›åŸºå‡†æµ‹è¯•ï¼Œæ‚¨ä¼šçœ‹åˆ°ä»€ä¹ˆï¼Ÿ\n2.8. åˆ†æåŸºå‡† # testing åŒ…å†…ç½®äº†å¯¹ç”Ÿæˆ CPUï¼Œå†…å­˜å’Œå—é…ç½®æ–‡ä»¶çš„æ”¯æŒã€‚\n-cpuprofile=\u0026lt;span class=\u0026quot;katex\u0026quot;\u0026gt;$1$\u0026lt;/span\u0026gt;FILE. -memprofile=\u0026lt;span class=\u0026quot;katex\u0026quot;\u0026gt;$1$\u0026lt;/span\u0026gt;FILE, -memprofilerate=N å°†é…ç½®æ–‡ä»¶é€Ÿç‡è°ƒæ•´ä¸º 1/N. -blockprofile=\u0026lt;span class=\u0026quot;katex\u0026quot;\u0026gt;$1$\u0026lt;/span\u0026gt;FILE. ä½¿ç”¨è¿™äº›æ ‡å¿—ä¸­çš„ä»»ä½•ä¸€ä¸ªä¹Ÿä¼šä¿ç•™äºŒè¿›åˆ¶æ–‡ä»¶ã€‚\n% go test -run=XXX -bench=. -cpuprofile=c.p bytes % go tool pprof c.p 2.9. è®¨è®º # æœ‰æ²¡æœ‰é—®é¢˜ï¼Ÿ\nä¹Ÿè®¸æ˜¯æ—¶å€™ä¼‘æ¯ä¸€ä¸‹äº†ã€‚\n3. æ€§èƒ½è¯„ä¼°å’Œæ€§èƒ½åˆ†æ # åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†å¯¹å•ä¸ªå‡½æ•°è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œè¿™å¯¹æ‚¨æå‰çŸ¥é“ç“¶é¢ˆåœ¨å“ªé‡Œå¾ˆæœ‰ç”¨ã€‚ä½†æ˜¯ï¼Œé€šå¸¸æ‚¨ä¼šå‘ç°è‡ªå·±æœ‰ä¸€ä¸ªé—®é¢˜\nä¸ºä»€ä¹ˆè¯¥ç¨‹åºéœ€è¦è¿™ä¹ˆé•¿æ—¶é—´æ‰èƒ½è¿è¡Œï¼Ÿ\nå¯¹ æ•´ä¸ª ç¨‹åºè¿›è¡Œæ¦‚è¦åˆ†æï¼Œå¯¹äºå›ç­”è¯¸å¦‚æ­¤ç±»çš„é«˜çº§é—®é¢˜å¾ˆæœ‰ç”¨ã€‚åœ¨æœ¬éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Go å†…ç½®çš„æ€§èƒ½åˆ†æå·¥å…·ä»å†…éƒ¨è°ƒæŸ¥ç¨‹åºçš„è¿è¡Œæƒ…å†µã€‚\n3.1. pprof # ä»Šå¤©æˆ‘ä»¬è¦è®¨è®ºçš„ç¬¬ä¸€ä¸ªå·¥å…·æ˜¯ pprof. pprof æ¥è‡ª Google Perf Tools è¿™å¥—å·¥å…·å¥—ä»¶ï¼Œè‡ªæœ€æ—©çš„å…¬å¼€å‘å¸ƒä»¥æ¥å·²é›†æˆåˆ° Go è¿è¡Œæ—¶ä¸­ã€‚\npprof ç”±ä¸¤éƒ¨åˆ†ç»„æˆ:\nruntime/pprof æ¯ä¸ª Go ç¨‹åºå†…ç½®çš„è½¯ä»¶åŒ… go tool pprof ç”¨äºè°ƒæŸ¥æ€§èƒ½åˆ†æã€‚ 3.2. æ€§èƒ½åˆ†ææ–‡ä»¶ç±»å‹ # pprof æ”¯æŒå¤šç§ç±»å‹çš„æ€§èƒ½åˆ†æï¼Œä»Šå¤©æˆ‘ä»¬å°†è®¨è®ºå…¶ä¸­çš„ä¸‰ç§:\nCPU profiling. Memory profiling. Block (or blocking) profiling. Mutex contention profiling. 3.2.1. CPU åˆ†æ # CPU åˆ†ææ–‡ä»¶æ˜¯æœ€å¸¸è§çš„é…ç½®æ–‡ä»¶ç±»å‹ï¼Œä¹Ÿæ˜¯æœ€æ˜æ˜¾çš„é…ç½®æ–‡ä»¶ã€‚\nå¯ç”¨ CPU æ€§èƒ½åˆ†æåï¼Œè¿è¡Œæ—¶å°†æ¯ 10 æ¯«ç§’ä¸­æ–­ä¸€æ¬¡ï¼Œå¹¶è®°å½•å½“å‰æ­£åœ¨è¿è¡Œçš„ goroutine çš„å †æ ˆè·Ÿè¸ªã€‚\nåˆ†ææ–‡ä»¶å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œåˆ†æä»¥ç¡®å®šæœ€çƒ­é—¨çš„ä»£ç è·¯å¾„ã€‚\nå‡½æ•°åœ¨åˆ†ææ–‡ä»¶ä¸­å‡ºç°çš„æ¬¡æ•°è¶Šå¤šï¼Œä»£ç è·¯å¾„èŠ±è´¹çš„æ—¶é—´å°±è¶Šå¤šã€‚\n3.2.2. å†…å­˜åˆ†æ # è¿›è¡Œ å † åˆ†é…æ—¶ï¼Œå†…å­˜åˆ†æè®°å½•å †æ ˆè·Ÿè¸ªã€‚\nå †æ ˆåˆ†é…å‡å®šä¸ºç©ºé—²ï¼Œå¹¶ä¸”åœ¨å†…å­˜æ€§èƒ½åˆ†ææ–‡ä»¶ä¸­ æœªè·Ÿè¸ªã€‚\nåƒ CPU åˆ†æä¸€æ ·ï¼Œå†…å­˜åˆ†æéƒ½æ˜¯åŸºäºæ ·æœ¬çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ 1000 ä¸ªåˆ†é…ä¸­çš„å†…å­˜åˆ†ææ ·æœ¬ä¸º 1ã€‚ æ­¤é€Ÿç‡å¯ä»¥æ›´æ”¹ã€‚\nç”±äºå†…å­˜åˆ†ææ˜¯åŸºäºæ ·æœ¬çš„ï¼Œå¹¶ä¸”ç”±äºå®ƒè·Ÿè¸ªæœª ä½¿ç”¨ çš„ åˆ†é…ï¼Œå› æ­¤å¾ˆéš¾ä½¿ç”¨å†…å­˜åˆ†ææ¥ç¡®å®šåº”ç”¨ç¨‹åºçš„æ•´ä½“å†…å­˜ä½¿ç”¨æƒ…å†µã€‚\nä¸ªäººæƒ³æ³•: æˆ‘å‘ç°å†…å­˜åˆ†æå¯¹å‘ç°å†…å­˜æ³„æ¼æ²¡æœ‰å¸®åŠ©ã€‚æœ‰æ›´å¥½çš„æ–¹æ³•æ¥ç¡®å®šæ‚¨çš„åº”ç”¨ç¨‹åºæ­£åœ¨ä½¿ç”¨å¤šå°‘å†…å­˜ã€‚ æˆ‘ä»¬å°†åœ¨æ¼”ç¤ºæ–‡ç¨¿çš„åé¢è®¨è®ºè¿™äº›ã€‚\n3.2.3. å—æ€§èƒ½åˆ†æ # å—åˆ†ææ˜¯ Go ç‰¹æœ‰çš„ã€‚\nå—æ¦‚è¦æ–‡ä»¶ç±»ä¼¼äº CPU æ¦‚è¦æ–‡ä»¶ï¼Œä½†æ˜¯å®ƒè®°å½• goroutine ç­‰å¾…å…±äº«èµ„æºæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚\nè¿™å¯¹äºç¡®å®šåº”ç”¨ç¨‹åºä¸­çš„ å¹¶å‘ ç“¶é¢ˆå¾ˆæœ‰ç”¨ã€‚\nå—æ€§èƒ½åˆ†æå¯ä»¥å‘æ‚¨æ˜¾ç¤ºä½•æ—¶æœ‰å¤§é‡ goroutine å¯ä»¥ å–å¾—è¿›å±•ï¼Œä½†è¢« é˜»å¡ äº†ã€‚åŒ…æ‹¬é˜»æ­¢\nåœ¨æ— ç¼“å†²çš„é€šé“ä¸Šå‘é€æˆ–æ¥æ”¶ã€‚ æ­£åœ¨å‘é€åˆ°å®Œæ•´é¢‘é“ï¼Œä»ç©ºé¢‘é“æ¥æ”¶ã€‚ è¯•å›¾ é”å®š è¢«å¦ä¸€ä¸ª goroutine é”å®šçš„ sync.Mutexã€‚ å—åˆ†ææ˜¯ä¸€ç§éå¸¸ä¸“ä¸šçš„å·¥å…·ï¼Œåœ¨æ‚¨ç¡®ä¿¡æ¶ˆé™¤äº†æ‰€æœ‰ CPU å’Œå†…å­˜ä½¿ç”¨ç“¶é¢ˆä¹‹åï¼Œæ‰åº”è¯¥ä½¿ç”¨å®ƒã€‚\n3.2.4. Mutex profiling # äº’æ–¥é”æ¦‚è¦åˆ†æä¸å—æ¦‚è¦åˆ†æç±»ä¼¼ï¼Œä½†ä¸“é—¨é’ˆå¯¹å¯¼è‡´äº’æ–¥é”äº‰ç”¨å¯¼è‡´å»¶è¿Ÿçš„æ“ä½œã€‚\næˆ‘å¯¹è¿™ç§ç±»å‹çš„ä¸ªäººèµ„æ–™æ²¡æœ‰å¾ˆå¤šç»éªŒï¼Œä½†æ˜¯æˆ‘å»ºç«‹äº†ä¸€ä¸ªç¤ºä¾‹æ¥æ¼”ç¤ºå®ƒã€‚æˆ‘ä»¬å°†å¾ˆå¿«çœ‹ä¸€ä¸‹è¯¥ç¤ºä¾‹ã€‚\n3.3. åŒä¸€æ—¶é—´åªä½¿ç”¨ä¸€ç§æ€§èƒ½åˆ†æ # æ€§èƒ½åˆ†æä¸æ˜¯å…è´¹çš„ã€‚\nåˆ†æå¯¹ç¨‹åºæ€§èƒ½æœ‰ä¸­ç­‰ä½†å¯æµ‹é‡çš„å½±å“ï¼Œå°¤å…¶æ˜¯å¦‚æœæ‚¨å¢åŠ å†…å­˜é…ç½®æ–‡ä»¶é‡‡æ ·ç‡ã€‚\nå¤§å¤šæ•°å·¥å…·ä¸ä¼šé˜»æ­¢æ‚¨ä¸€æ¬¡å¯ç”¨å¤šä¸ªæ€§èƒ½åˆ†æã€‚\nä¸€æ¬¡ä¸è¦å¯ç”¨å¤šç§æ€§èƒ½åˆ†æã€‚\nå¦‚æœæ‚¨åŒæ—¶å¯ç”¨å¤šä¸ªä¸ªäººèµ„æ–™ï¼Œä»–ä»¬å°†è§‚å¯Ÿè‡ªå·±çš„äº’åŠ¨å¹¶æ”¾å¼ƒæ‚¨çš„ç»“æœã€‚\n3.4. æ”¶é›†æ€§èƒ½åˆ†æ # Go è¿è¡Œæ—¶çš„é…ç½®æ–‡ä»¶ç•Œé¢ä½äº runtime/pprof åŒ…ä¸­ã€‚runtime/pprof æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„å·¥å…·ï¼Œç”±äºå†å²åŸå› ï¼Œä¸å„ç§é…ç½®æ–‡ä»¶çš„æ¥å£å¹¶ä¸ç»Ÿä¸€ã€‚\næ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼Œpprof æ¦‚è¦åˆ†æå†…ç½®äº testing åŒ…ä¸­ï¼Œä½†æ˜¯æœ‰æ—¶å°†æ‚¨è¦åˆ†æçš„ä»£ç æ”¾åœ¨ testing.B åŸºå‡†æµ‹è¯•ç¯å¢ƒä¸­æ˜¯ä¸ä¾¿æˆ–å›°éš¾çš„ï¼Œå¹¶ä¸”å¿…é¡»ä½¿ç”¨ç›´æ¥ä½¿ç”¨ runtime/pprof APIã€‚\nå‡ å¹´å‰ï¼Œæˆ‘å†™äº†ä¸€ä¸ª small packageï¼Œä»¥ä¾¿æ›´è½»æ¾åœ°æè¿°ç°æœ‰åº”ç”¨ç¨‹åºã€‚\nimport \u0026#34;github.com/pkg/profile\u0026#34; func main() { defer profile.Start().Stop() // ... } åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ profile åŒ…ã€‚ ç¨åï¼Œæˆ‘ä»¬å°†ç›´æ¥ä½¿ç”¨ runtime/pprof æ¥å£ã€‚\n3.5. Analysing a profile with pprof # æ—¢ç„¶æˆ‘ä»¬å·²ç»è®¨è®ºäº† pprof å¯ä»¥æµ‹é‡çš„å†…å®¹ä»¥åŠå¦‚ä½•ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥è®¨è®ºå¦‚ä½•ä½¿ç”¨ pprof åˆ†æé…ç½®æ–‡ä»¶ã€‚\nåˆ†æç”± go pprof å­å‘½ä»¤é©±åŠ¨\n% go tool pprof /path/to/your/profile è¯¥å·¥å…·æä¾›äº†æ¦‚è¦æ•°æ®çš„å‡ ç§ä¸åŒè¡¨ç¤ºå½¢å¼ã€‚æ–‡å­—ï¼Œå›¾å½¢ç”šè‡³ç«ç„°å›¾ã€‚\nå¦‚æœæ‚¨ä½¿ç”¨ Go å·²æœ‰ä¸€æ®µæ—¶é—´ï¼Œåˆ™å¯èƒ½ä¼šè¢«å‘ŠçŸ¥ pprof æœ‰ä¸¤ä¸ªå‚æ•°ã€‚ä» Go 1.9 å¼€å§‹ï¼Œé…ç½®æ–‡ä»¶åŒ…å«æ¸²æŸ“é…ç½®æ–‡ä»¶æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚æ‚¨ä¸å†éœ€è¦ç”Ÿæˆæ€§èƒ½åˆ†æçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ğŸ‰\n3.5.1. è¿›ä¸€æ­¥é˜…è¯» # Profiling Go programs (Go Blog) Debugging performance issues in Go programs 3.5.2. CPU profiling (exercise) # è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªè®¡ç®—å•è¯æ•°çš„ç¨‹åº:\npackage main import ( \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;unicode\u0026#34; ) func readbyte(r io.Reader) (rune, error) { var buf [1]byte _, err := r.Read(buf[:]) return rune(buf[0]), err } func main() { f, err := os.Open(os.Args[1]) if err != nil { log.Fatalf(\u0026#34;could not open file %q: %v\u0026#34;, os.Args[1], err) } words := 0 inword := false for { r, err := readbyte(f) if err == io.EOF { break } if err != nil { log.Fatalf(\u0026#34;could not read file %q: %v\u0026#34;, os.Args[1], err) } if unicode.IsSpace(r) \u0026amp;\u0026amp; inword { words++ inword = false } inword = unicode.IsLetter(r) } fmt.Printf(\u0026#34;%q: %d words\\n\u0026#34;, os.Args[1], words) } è®©æˆ‘ä»¬çœ‹çœ‹èµ«å°”æ›¼Â·æ¢…å°”ç»´å°”ç»å…¸å°è¯´ä¸­æœ‰å¤šå°‘ä¸ªå•è¯ Moby Dick (æ¥è‡ªå¤è…¾å ¡è®¡åˆ’)\n% go build \u0026amp;\u0026amp; time ./words moby.txt \u0026#34;moby.txt\u0026#34;: 181275 words real 0m2.110s user 0m1.264s sys 0m0.944s è®©æˆ‘ä»¬å°†å…¶ä¸ unix çš„ wc -w è¿›è¡Œæ¯”è¾ƒ\n% time wc -w moby.txt 215829 moby.txt real 0m0.012s user 0m0.009s sys 0m0.002s æ‰€ä»¥æ•°å­—ä¸ä¸€æ ·ã€‚ wc å¤§çº¦é«˜å‡º 19ï¼…ï¼Œå› ä¸ºå®ƒè®¤ä¸ºå•è¯ä¸æˆ‘çš„ç®€å•ç¨‹åºä¸åŒã€‚è¿™å¹¶ä¸é‡è¦-ä¸¤ä¸ªç¨‹åºéƒ½å°†æ•´ä¸ªæ–‡ä»¶ä½œä¸ºè¾“å…¥ï¼Œå¹¶åœ¨ä¸€æ¬¡é€šè¿‡ä¸­è®¡ç®—ä»å•è¯åˆ°éå•è¯çš„è¿‡æ¸¡æ¬¡æ•°ã€‚\nè®©æˆ‘ä»¬ç ”ç©¶ä¸€ä¸‹ä¸ºä»€ä¹ˆä½¿ç”¨ pprof è¿™äº›ç¨‹åºçš„è¿è¡Œæ—¶é—´ä¸åŒã€‚\n3.5.3. æ·»åŠ  CPU åˆ†æ # é¦–å…ˆï¼Œç¼–è¾‘ main.go å¹¶å¯ç”¨åˆ†æ\nimport ( \u0026#34;github.com/pkg/profile\u0026#34; ) func main() { defer profile.Start().Stop() // ... ç°åœ¨ï¼Œå½“æˆ‘ä»¬è¿è¡Œç¨‹åºæ—¶ï¼Œå°†åˆ›å»ºä¸€ä¸ª cpu.pprof æ–‡ä»¶ã€‚\n% go run main.go moby.txt 2018/08/25 14:09:01 profile: cpu profiling enabled, /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile239941020/cpu.pprof \u0026#34;moby.txt\u0026#34;: 181275 words 2018/08/25 14:09:03 profile: cpu profiling disabled, /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile239941020/cpu.pprof ç°åœ¨æˆ‘ä»¬æœ‰äº†é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ go pprof å·¥å…·å¯¹å…¶è¿›è¡Œåˆ†æã€‚\n% go tool pprof /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile239941020/cpu.pprof Type: cpu Time: Aug 25, 2018 at 2:09pm (AEST) Duration: 2.05s, Total samples = 1.36s (66.29%) Entering interactive mode (type \u0026#34;help\u0026#34; for commands, \u0026#34;o\u0026#34; for options) (pprof) top Showing nodes accounting for 1.42s, 100% of 1.42s total flat flat% sum% cum cum% 1.41s 99.30% 99.30% 1.41s 99.30% syscall.Syscall 0.01s 0.7% 100% 1.42s 100% main.readbyte 0 0% 100% 1.41s 99.30% internal/poll.(*FD).Read 0 0% 100% 1.42s 100% main.main 0 0% 100% 1.41s 99.30% os.(*File).Read 0 0% 100% 1.41s 99.30% os.(*File).read 0 0% 100% 1.42s 100% runtime.main 0 0% 100% 1.41s 99.30% syscall.Read 0 0% 100% 1.41s 99.30% syscall.read top å‘½ä»¤æ˜¯æ‚¨æœ€å¸¸ä½¿ç”¨çš„å‘½ä»¤ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥ç¨‹åºæœ‰ 99ï¼… çš„æ—¶é—´èŠ±è´¹åœ¨ syscall.Syscall ä¸­ï¼Œè€Œä¸€å°éƒ¨åˆ†èŠ±è´¹åœ¨main.readbyte ä¸­ã€‚\næˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ web å‘½ä»¤æ¥å¯è§†åŒ–æ­¤è°ƒç”¨ã€‚è¿™å°†ä»é…ç½®æ–‡ä»¶æ•°æ®ç”Ÿæˆæœ‰å‘å›¾ã€‚ åœ¨åå°ï¼Œè¿™ä½¿ç”¨äº† Graphviz çš„ dot å‘½ä»¤ã€‚\nä½†æ˜¯ï¼Œåœ¨ Go 1.10(ä¹Ÿå¯èƒ½æ˜¯ 1.11)ä¸­ï¼ŒGo é™„å¸¦äº†æœ¬èº«æ”¯æŒ HTTP æœåŠ¡å™¨çš„ pprof ç‰ˆæœ¬\n% go tool pprof -http=:8080 /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile239941020/cpu.pprof å°†ä¼šæ‰“å¼€ç½‘ç»œæµè§ˆå™¨;\nå›¾å½¢æ¨¡å¼ ç«ç„°å›¾æ¨¡å¼ åœ¨å›¾å½¢ä¸Šï¼Œå ç”¨ æœ€å¤š CPU æ—¶é—´çš„æ¡†æ˜¯æœ€å¤§çš„æ¡†ï¼Œæˆ‘ä»¬çœ‹åˆ° syscall.Syscall å ç¨‹åºæ€»æ—¶é—´çš„ 99.3ï¼…ã€‚å¯¼è‡´ syscall.Syscall çš„å­—ç¬¦ä¸²è¡¨ç¤ºç«‹å³è°ƒç”¨è€…ï¼Œå¦‚æœå¤šä¸ªä»£ç è·¯å¾„åœ¨åŒä¸€å‡½æ•°ä¸Šæ”¶æ•›ï¼Œåˆ™å¯ä»¥æœ‰å¤šä¸ªã€‚ç®­å¤´çš„å¤§å°ä»£è¡¨åœ¨ä¸€ä¸ªç›’å­çš„å­å…ƒç´ ä¸ŠèŠ±è´¹äº†å¤šå°‘æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä» main.readbyte å¼€å§‹ï¼Œå®ƒä»¬å äº†è¯¥å›¾åˆ†æ”¯ä¸­ 1.41 ç§’æ‰€ç”¨æ—¶é—´çš„æ¥è¿‘ 0ã€‚\né—®é¢˜: è°èƒ½çŒœå‡ºä¸ºä»€ä¹ˆæˆ‘ä»¬çš„ç‰ˆæœ¬æ¯” wc æ…¢å¾—å¤š?\n3.5.4. æ”¹è¿› # æˆ‘ä»¬çš„ç¨‹åºè¿è¡Œç¼“æ…¢çš„åŸå› ä¸æ˜¯å› ä¸º Go çš„ syscall.Syscall è¿è¡Œç¼“æ…¢ã€‚ è¿™æ˜¯å› ä¸ºç³»ç»Ÿè°ƒç”¨é€šå¸¸æ˜¯æ˜‚è´µçš„æ“ä½œï¼ˆå¹¶ä¸”éšç€å‘ç°æ›´å¤š Spectre ç³»åˆ—æ¼æ´è€Œå˜å¾—è¶Šæ¥è¶Šæ˜‚è´µï¼‰ã€‚\næ¯æ¬¡å¯¹ readbyte çš„è°ƒç”¨éƒ½ä¼šå¯¼è‡´ä¸€ä¸ª syscall.Read çš„ç¼“å†²åŒºå¤§å°ä¸º 1ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ç¨‹åºæ‰§è¡Œçš„ syscall æ•°é‡ç­‰äºè¾“å…¥çš„å¤§å°ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ pprof å›¾ä¸­ï¼Œè¯»å–è¾“å…¥çš„å†…å®¹å ä¸»å¯¼åœ°ä½ã€‚\nfunc main() { defer profile.Start(profile.MemProfile, profile.MemProfileRate(1)).Stop() // defer profile.Start(profile.MemProfile).Stop() f, err := os.Open(os.Args[1]) if err != nil { log.Fatalf(\u0026#34;could not open file %q: %v\u0026#34;, os.Args[1], err) } b := bufio.NewReader(f) words := 0 inword := false for { r, err := readbyte(b) if err == io.EOF { break } if err != nil { log.Fatalf(\u0026#34;could not read file %q: %v\u0026#34;, os.Args[1], err) } if unicode.IsSpace(r) \u0026amp;\u0026amp; inword { words++ inword = false } inword = unicode.IsLetter(r) } fmt.Printf(\u0026#34;%q: %d words\\n\u0026#34;, os.Args[1], words) } é€šè¿‡åœ¨ readbyte ä¹‹å‰ä½¿ç”¨ bufio.Reader åŒ…è£…è¾“å…¥æ–‡ä»¶\nå°†æ­¤ä¿®è®¢ç¨‹åºçš„æ—¶é—´ä¸ `wc` æ¯”è¾ƒã€‚æœ‰å¤šå°‘å·®è·ï¼Ÿè¿›è¡Œæ€§èƒ½åˆ†æï¼Œçœ‹çœ‹è¿˜å‰©ä¸‹ä»€ä¹ˆã€‚ 3.5.5. å†…å­˜åˆ†æ # æ–°çš„å•è¯é…ç½®æ–‡ä»¶è¡¨æ˜åœ¨ readbyte å‡½æ•°å†…éƒ¨åˆ†é…äº†ä¸€äº›ä¸œè¥¿ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ pprof è¿›è¡Œè°ƒæŸ¥ã€‚\ndefer profile.Start(profile.MemProfile).Stop() ç„¶åç…§å¸¸è¿è¡Œç¨‹åº\n% go run main2.go moby.txt 2018/08/25 14:41:15 profile: memory profiling enabled (rate 4096), /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile312088211/mem.pprof \u0026#34;moby.txt\u0026#34;: 181275 words 2018/08/25 14:41:15 profile: memory profiling disabled, /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile312088211/mem.pprof ç”±äºæˆ‘ä»¬æ€€ç–‘åˆ†é…æ¥è‡ª readbyteï¼Œè¿™ä¸æ˜¯é‚£ä¹ˆå¤æ‚ï¼Œreadbyte åªæœ‰ä¸‰è¡Œ:\nä½¿ç”¨ `pprof` ç¡®å®šåˆ†é…æ¥è‡ªä½•å¤„ã€‚ func readbyte(r io.Reader) (rune, error) { var buf [1]byte // (1) _, err := r.Read(buf[:]) return rune(buf[0]), err } | 1 | åˆ†é…åœ¨è¿™é‡Œ |\nåœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œä½†æ˜¯ç›®å‰ï¼Œæˆ‘ä»¬çœ‹åˆ°å¯¹ readbyte çš„æ¯ä¸ªè°ƒç”¨éƒ½åœ¨åˆ†é…ä¸€ä¸ªæ–°çš„ä¸€å­—èŠ‚é•¿çš„ array ï¼Œå¹¶ä¸”è¯¥æ•°ç»„æ­£åœ¨å †ä¸Šåˆ†é…ã€‚\næœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥é¿å…è¿™ç§æƒ…å†µï¼Ÿè¯•è¯•çœ‹ï¼Œå¹¶ä½¿ç”¨ CPU å’Œå†…å­˜æ€§èƒ½åˆ†æè¿›è¡ŒéªŒè¯ã€‚\nAlloc å¯¹è±¡ä¸ inuse å¯¹è±¡ # å†…å­˜æ€§èƒ½åˆ†ææœ‰ä¸¤ç§ï¼Œåˆ†åˆ«ä»¥ go tool pprof æ ‡å¿—åŒºåˆ†ã€‚\n-alloc_objects æŠ¥å‘Šè¿›è¡Œåˆ†é…çš„å‘¼å«ç«™ç‚¹ã€‚ -inuse_objects æŠ¥å‘Šåœ¨æ€§èƒ½åˆ†ææœ«å°¾å¯ä»¥è®¿é—®çš„å‘¼å«ç«™ç‚¹ã€‚ ä¸ºäº†æ¼”ç¤ºè¿™ä¸€ç‚¹ï¼Œè¿™æ˜¯ä¸€ä¸ªäººä¸ºè®¾è®¡çš„ç¨‹åºï¼Œå®ƒå°†ä»¥å—æ§æ–¹å¼åˆ†é…ä¸€å †å†…å­˜ã€‚\nconst count = 100000 var y []byte func main() { defer profile.Start(profile.MemProfile, profile.MemProfileRate(1)).Stop() y = allocate() runtime.GC() } // allocate allocates count byte slices and returns the first slice allocated. func allocate() []byte { var x [][]byte for i := 0; i \u0026lt; count; i++ { x = append(x, makeByteSlice()) } return x[0] } // makeByteSlice returns a byte slice of a random length in the range [0, 16384). func makeByteSlice() []byte { return make([]byte, rand.Intn(2^14)) } è¯¥ç¨‹åºæ˜¯å¸¦æœ‰ profile åŒ…çš„æ³¨é‡Šï¼Œæˆ‘ä»¬å°†å†…å­˜é…ç½®æ–‡ä»¶é€Ÿç‡è®¾ç½®ä¸º 1ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè®°å½•æ¯æ¬¡åˆ†é…çš„å †æ ˆè·Ÿè¸ªã€‚è¿™ä¼šå¤§å¤§å‡æ…¢è¯¥ç¨‹åºçš„é€Ÿåº¦ï¼Œä½†æ˜¯æ‚¨å¾ˆå¿«å°±ä¼šçŸ¥é“åŸå› ã€‚\n% go run main.go 2018/08/25 15:22:05 profile: memory profiling enabled (rate 1), /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile730812803/mem.pprof 2018/08/25 15:22:05 profile: memory profiling disabled, /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile730812803/mem.pprof è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å·²åˆ†é…å¯¹è±¡çš„å›¾ï¼Œè¿™æ˜¯é»˜è®¤è®¾ç½®ï¼Œå¹¶æ˜¾ç¤ºå¯¼è‡´åœ¨æ¦‚è¦æ–‡ä»¶æœŸé—´åˆ†é…æ¯ä¸ªå¯¹è±¡çš„è°ƒç”¨å›¾ã€‚\n% go tool pprof -http=:8080 /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile891268605/mem.pprof ä¸è¶³ä¸ºå¥‡çš„æ˜¯ï¼Œè¶…è¿‡ 99ï¼… çš„åˆ†é…ä½äº makeByteSlice å†…éƒ¨ã€‚ ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨ -inuse_objects æŸ¥çœ‹ç›¸åŒçš„é…ç½®æ–‡ä»¶\n% go tool pprof -http=:8080 /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile891268605/mem.pprof æˆ‘ä»¬çœ‹åˆ°çš„ä¸æ˜¯åœ¨æ¦‚è¦æ–‡ä»¶æœŸé—´ åˆ†é… çš„å¯¹è±¡ï¼Œè€Œæ˜¯åœ¨è·å–æ¦‚è¦æ–‡ä»¶æ—¶ ä»åœ¨ä½¿ç”¨ çš„å¯¹è±¡ï¼Œè¿™å°†å¿½ç•¥å·²ç”±åƒåœ¾æ”¶é›†å™¨å›æ”¶çš„å¯¹è±¡çš„å †æ ˆè·Ÿè¸ªã€‚\n3.5.6. Block profiling # æˆ‘ä»¬è¦æŸ¥çœ‹çš„æœ€åä¸€ä¸ªé…ç½®æ–‡ä»¶ç±»å‹æ˜¯åŒºå—åˆ†æã€‚ æˆ‘ä»¬å°†ä½¿ç”¨æ¥è‡ª net/http åŒ…çš„ ClientServer åŸºå‡†æµ‹è¯•\n% go test -run=XXX -bench=ClientServer$ -blockprofile=/tmp/block.p net/http % go tool pprof -http=:8080 /tmp/block.p 3.5.7. çº¿ç¨‹åˆ›å»ºåˆ†æ # Go 1.11 (?) å¢åŠ äº†å¯¹æ“ä½œç³»ç»Ÿçº¿ç¨‹åˆ›å»ºçš„åˆ†ææ”¯æŒã€‚\nå°†çº¿ç¨‹åˆ›å»ºåˆ†ææ·»åŠ åˆ° `godoc` ä¸­ï¼Œå¹¶è§‚å¯Ÿåˆ†æ `godoc -http =ï¼š8080 -index` çš„ç»“æœã€‚ 3.5.8. Framepointers # Go 1.7 å·²å‘å¸ƒï¼Œå¹¶ä¸”ä¸ç”¨äº amd64 çš„æ–°ç¼–è¯‘å™¨ä¸€èµ·ï¼Œç°åœ¨é»˜è®¤æƒ…å†µä¸‹ç¼–è¯‘å™¨å¯ç”¨äº†å¸§æŒ‡é’ˆã€‚\nå¸§æŒ‡é’ˆæ˜¯ä¸€ä¸ªå§‹ç»ˆæŒ‡å‘å½“å‰å †æ ˆå¸§é¡¶éƒ¨çš„å¯„å­˜å™¨ã€‚\nå¸§æŒ‡é’ˆä½¿è¯¸å¦‚ gdb(1) å’Œ perf(1) ä¹‹ç±»çš„å·¥å…·èƒ½å¤Ÿç†è§£ Go è°ƒç”¨å †æ ˆã€‚\nåœ¨æœ¬ç ”è®¨ä¼šä¸­ï¼Œæˆ‘ä»¬ä¸ä¼šä»‹ç»è¿™äº›å·¥å…·ï¼Œä½†æ˜¯æ‚¨å¯ä»¥é˜…è¯»å’Œè§‚çœ‹æˆ‘çš„æ¼”è®²ï¼Œè¯¥æ¼”è®²ä»¥ä¸ƒç§ä¸åŒçš„æ–¹å¼ä»‹ç» Go ç¨‹åºã€‚\nåˆ†æ Go ç¨‹åºçš„ä¸ƒç§æ–¹æ³• (slides) åˆ†æ Go ç¨‹åºçš„ä¸ƒç§æ–¹æ³• (video, 30 mins) åˆ†æ Go ç¨‹åºçš„ä¸ƒç§æ–¹æ³• (webcast, 60 mins) 3.5.9. ç»ƒä¹  # æ ¹æ®æ‚¨ç†Ÿæ‚‰çš„ä¸€æ®µä»£ç ç”Ÿæˆä¸€ä¸ªæ€§èƒ½åˆ†æã€‚å¦‚æœæ‚¨æ²¡æœ‰ä»£ç ç¤ºä¾‹ï¼Œè¯·å°è¯•å¯¹ godoc è¿›è¡Œåˆ†æã€‚ % go get golang.org/x/tools/cmd/godoc % cd $GOPATH/src/golang.org/x/tools/cmd/godoc % vim main.go å¦‚æœè¦åœ¨ä¸€å°è®¡ç®—æœºä¸Šç”Ÿæˆæ€§èƒ½åˆ†æï¼Œç„¶ååœ¨å¦ä¸€å°è®¡ç®—æœºä¸Šæ£€æŸ¥æ€§èƒ½åˆ†æï¼Œæ‚¨å°†å¦‚ä½•å¤„ç†ï¼Ÿ 4. ç¼–è¯‘ä¼˜åŒ– # æœ¬èŠ‚ä»‹ç»äº† Go ç¼–è¯‘å™¨æ‰§è¡Œçš„ä¸€äº›ä¼˜åŒ–ã€‚\nä¾‹å¦‚;\né€ƒé€¸åˆ†æ å†…è” æ¶ˆé™¤æ­»ä»£ç  å…¨éƒ¨åœ¨ç¼–è¯‘å™¨çš„å‰ç«¯å¤„ç†ï¼Œè€Œä»£ç ä»ä¸º AST å½¢å¼ï¼› ç„¶åå°†ä»£ç ä¼ é€’ç»™ SSA ç¼–è¯‘å™¨è¿›è¡Œè¿›ä¸€æ­¥ä¼˜åŒ–ã€‚\n4.1. History of the Go compiler # Go ç¼–è¯‘å™¨å¤§çº¦åœ¨ 2007 æ—¶ä½œä¸º Plan9 ç¼–è¯‘å™¨å·¥å…·é“¾çš„åˆ†æ”¯è€Œå¼€å§‹çš„ã€‚å½“æ—¶çš„ç¼–è¯‘å™¨ä¸ Aho å’Œ Ullman çš„ Dragon Book éå¸¸ç›¸ä¼¼ã€‚\nåœ¨ 2015 å¹´ï¼Œå½“æ—¶çš„ Go 1.5 ç¼–è¯‘å™¨ä¸º C è½¬æ¢ä¸º Goã€‚\nä¸€å¹´åï¼ŒGo 1.7 å¼•å…¥äº†ä¸€ç§åŸºäº SSA æŠ€æœ¯çš„ new compiler backend ä»¥å‰çš„ Plan9 æ ·å¼ä»£ç ç”Ÿæˆã€‚è¿™ä¸ªæ–°çš„åç«¯ä¸ºé€šç”¨å’Œç‰¹å®šäºæ¶æ„çš„ä¼˜åŒ–å¼•å…¥äº†è®¸å¤šæœºä¼šã€‚\n4.2. é€ƒé€¸ä¼˜åŒ– # æˆ‘ä»¬æ­£åœ¨è®¨è®ºçš„ç¬¬ä¸€ä¸ªä¼˜åŒ–æ˜¯ é€ƒé€¸ä¼˜åŒ–ã€‚\nä¸ºäº†è¯´æ˜é€ƒé€¸åˆ†æçš„ä½œç”¨ï¼Œæˆ‘ä»¬å›æƒ³èµ· Go spec å¹¶æœªæåŠå †æˆ–å †æ ˆã€‚å®ƒä»…æåŠè¯¥è¯­è¨€æ˜¯åœ¨å¼•è¨€ä¸­è¢«åƒåœ¾æ”¶é›†çš„ï¼Œå¹¶æ²¡æœ‰æç¤ºå¦‚ä½•å®ç°è¯¥è¯­è¨€ã€‚\nGo è§„èŒƒçš„å…¼å®¹ Go å®ç° å¯ä»¥ å°†æ¯ä¸ªåˆ†é…å­˜å‚¨åœ¨å †ä¸Šã€‚è¿™å°†å¯¹åƒåœ¾æ”¶é›†å™¨æ–½åŠ å¾ˆå¤§å‹åŠ›ï¼Œä½†æ˜¯è¿™ç»ä¸æ˜¯ä¸æ­£ç¡®çš„ã€‚å¤šå¹´æ¥ï¼Œgccgo å¯¹é€ƒé€¸åˆ†æçš„æ”¯æŒéå¸¸æœ‰é™ï¼Œå› æ­¤å¯ä»¥æœ‰æ•ˆåœ°è®¤ä¸ºå®ƒåœ¨è¿™ç§æ¨¡å¼ä¸‹è¿è¡Œã€‚\nä½†æ˜¯ï¼Œgoroutine çš„å †æ ˆä½œä¸ºå­˜å‚¨å±€éƒ¨å˜é‡çš„å»‰ä»·åœºæ‰€è€Œå­˜åœ¨ã€‚æ— éœ€åœ¨å †æ ˆä¸Šè¿›è¡Œåƒåœ¾æ”¶é›†ã€‚å› æ­¤ï¼Œåœ¨å®‰å…¨çš„æƒ…å†µä¸‹ï¼Œæ”¾ç½®åœ¨å †æ ˆä¸Šçš„åˆ†é…å°†æ›´æœ‰æ•ˆã€‚\nåœ¨æŸäº›è¯­è¨€ä¸­ï¼Œä¾‹å¦‚ C å’Œ C++ï¼Œé€‰æ‹©åœ¨å †æ ˆä¸Šè¿˜æ˜¯åœ¨å †ä¸Šåˆ†é…æ˜¯ç¨‹åºå‘˜çš„æ‰‹åŠ¨æ“ä½œã€‚å †åˆ†é…æ˜¯é€šè¿‡ malloc å’Œ free è¿›è¡Œçš„ï¼Œæ ˆåˆ†é…æ˜¯é€šè¿‡ alloca è¿›è¡Œçš„ã€‚ä½¿ç”¨è¿™äº›æœºåˆ¶çš„é”™è¯¯æ˜¯å¯¼è‡´å†…å­˜æŸåé”™è¯¯çš„å¸¸è§åŸå› ã€‚\nåœ¨ Go ä¸­ï¼Œå¦‚æœå€¼çš„å¯¿å‘½è¶…å‡ºäº†å‡½æ•°è°ƒç”¨çš„å¯¿å‘½ï¼Œåˆ™ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å°†å…¶ç§»åŠ¨åˆ°å †ä¸­ã€‚ è¯´æ˜è¯¥å€¼ é€ƒé€¸ åˆ°å †ã€‚\ntype Foo struct { a, b, c, d int } func NewFoo() *Foo { return \u0026amp;Foo{a: 3, b: 1, c: 4, d: 7} } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåœ¨ NewFoo ä¸­åˆ†é…çš„ Foo å°†è¢«ç§»åˆ°å †ä¸­ï¼Œå› æ­¤åœ¨ NewFoo è¿”å›åå…¶å†…å®¹ä»ç„¶æœ‰æ•ˆã€‚\nè‡ª Go æˆç«‹ä»¥æ¥ï¼Œè¿™ç§æƒ…å†µå°±ä¸€ç›´å­˜åœ¨ã€‚ä¸å…¶è¯´æ˜¯è‡ªåŠ¨çº æ­£åŠŸèƒ½ï¼Œè¿˜ä¸å¦‚è¯´æ˜¯ä¸€ç§ä¼˜åŒ–ã€‚åœ¨ Go ä¸­æ„å¤–è¿”å›å †æ ˆåˆ†é…å˜é‡çš„åœ°å€æ˜¯ä¸å¯èƒ½çš„ã€‚\nä½†æ˜¯ç¼–è¯‘å™¨ä¹Ÿå¯ä»¥åšç›¸åçš„äº‹æƒ…ã€‚å®ƒå¯ä»¥æ‰¾åˆ°å‡å®šåœ¨å †ä¸Šåˆ†é…çš„ä¸œè¥¿ï¼Œå¹¶å°†å®ƒä»¬ç§»åˆ°å †æ ˆä¸­ã€‚\nè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­\nfunc Sum() int { const count = 100 numbers := make([]int, count) for i := range numbers { numbers[i] = i + 1 } var sum int for _, i := range numbers { sum += i } return sum } func main() { answer := Sum() fmt.Println(answer) } sum å°† 1 ä¸ 100 ä¹‹é—´çš„ int ç›¸åŠ å¹¶è¿”å›ç»“æœã€‚\nç”±äº numbers åˆ‡ç‰‡ä»…åœ¨ Sum å†…éƒ¨å¼•ç”¨ï¼Œå› æ­¤ç¼–è¯‘å™¨å°†å®‰æ’å°†è¯¥åˆ‡ç‰‡çš„ 100 ä¸ªæ•´æ•°å­˜å‚¨åœ¨å †æ ˆä¸­ï¼Œè€Œä¸æ˜¯å †ä¸­ã€‚æ— éœ€åƒåœ¾å›æ”¶ numbersï¼Œå®ƒä¼šåœ¨ Sum è¿”å›æ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚\n4.2.1. è¯æ˜å®ƒ! # è¦æ‰“å°ç¼–è¯‘å™¨çš„é€ƒé€¸åˆ†æç»“æœï¼Œè¯·ä½¿ç”¨ -m æ ‡å¿—ã€‚\n% go build -gcflags=-m examples/esc/sum.go # command-line-arguments examples/esc/sum.go:22:13: inlining call to fmt.Println examples/esc/sum.go:8:17: Sum make([]int, count) does not escape examples/esc/sum.go:22:13: answer escapes to heap examples/esc/sum.go:22:13: io.Writer(os.Stdout) escapes to heap examples/esc/sum.go:22:13: main []interface {} literal does not escape \u0026lt;autogenerated\u0026gt;:1: os.(*File).close .this does not escape ç¬¬ 8 è¡Œæ˜¾ç¤ºç¼–è¯‘å™¨å·²æ­£ç¡®æ¨æ–­å‡º make([]int, 100) çš„ç»“æœä¸ä¼šé€¸å‡ºåˆ°å †ä¸­ã€‚æ²¡æœ‰çš„åŸå› \nç¬¬ 22 è¡ŒæŠ¥å‘Š answer è½¬å‚¨åˆ°å †ä¸­æ˜¯ fmt.Println æ˜¯ä¸€ä¸ªå¯å˜å‡½æ•°ã€‚å¯å˜å‚æ•°å‡½æ•°çš„å‚æ•°è£…åœ¨åˆ‡ç‰‡ä¸­ï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸º []interface {}ï¼Œå› æ­¤å°† answer æ”¾å…¥æ¥å£å€¼ä¸­ï¼Œå› ä¸ºå®ƒæ˜¯ç”±å¯¹ fmt.Println çš„è°ƒç”¨å¼•ç”¨çš„ã€‚ç”±äº Go 1.6 çš„åƒåœ¾å›æ”¶å™¨è¦æ±‚é€šè¿‡æ¥å£ä¼ é€’çš„æ‰€æœ‰å€¼éƒ½æ˜¯æŒ‡é’ˆï¼Œå› æ­¤ç¼–è¯‘å™¨ä¼˜åŒ–åçš„ä»£ç çš„å¤§è‡´æ˜¯ï¼š\nvar answer = Sum() fmt.Println([]interface{\u0026amp;answer}...) æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ -gcflags=\u0026quot;-m -m\u0026quot; æ ‡å¿—æ¥ç¡®è®¤ã€‚åœ¨å“ªè¿”å›äº†\n% go build -gcflags=\u0026#39;-m -m\u0026#39; examples/esc/sum.go 2\u0026gt;\u0026amp;1 | grep sum.go:22 examples/esc/sum.go:22:13: inlining call to fmt.Println func(...interface {}) (int, error) { return fmt.Fprintln(io.Writer(os.Stdout), fmt.a...) } examples/esc/sum.go:22:13: answer escapes to heap examples/esc/sum.go:22:13: from ~arg0 (assign-pair) at examples/esc/sum.go:22:13 examples/esc/sum.go:22:13: io.Writer(os.Stdout) escapes to heap examples/esc/sum.go:22:13: from io.Writer(os.Stdout) (passed to call[argument escapes]) at examples/esc/sum.go:22:13 examples/esc/sum.go:22:13: main []interface {} literal does not escape ç®€è€Œè¨€ä¹‹ï¼Œä¸å¿…æ‹…å¿ƒç¬¬ 22 è¡Œçš„é€ƒé€¸ï¼Œè¿™å¯¹æœ¬æ¬¡è®¨è®ºå¹¶ä¸é‡è¦ã€‚\n4.2.2. ç»ƒä¹  # è¿™ç§ä¼˜åŒ–å¯¹æ‰€æœ‰ count çš„å€¼éƒ½é€‚ç”¨å—ï¼Ÿ å¦‚æœ count æ˜¯å˜é‡è€Œä¸æ˜¯å¸¸é‡ï¼Œæ­¤ä¼˜åŒ–æ˜¯å¦æˆç«‹ï¼Ÿ å¦‚æœ count æ˜¯ Sum çš„å‚æ•°ï¼Œæ­¤ä¼˜åŒ–æ˜¯å¦æˆç«‹ï¼Ÿ 4.2.3. Escape analysis (continued) # è¿™ä¸ªä¾‹å­æ˜¯äººä¸ºé€ çš„ã€‚å®ƒä¸æ—¨åœ¨æˆä¸ºçœŸå®çš„ä»£ç ï¼Œä»…æ˜¯ç¤ºä¾‹ã€‚\ntype Point struct{ X, Y int } const Width = 640 const Height = 480 func Center(p *Point) { p.X = Width / 2 p.Y = Height / 2 } func NewPoint() { p := new(Point) Center(p) fmt.Println(p.X, p.Y) } NewPoint creates a new *Point value, p. We pass p to the Center function which moves the point to a position in the center of the screen. Finally we print the values of p.X and p.Y.\nNewPoint åˆ›å»ºä¸€ä¸ªæ–°çš„ *Point å€¼ pã€‚ æˆ‘ä»¬å°† p ä¼ é€’ç»™ Center å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†ç‚¹ç§»åŠ¨åˆ°å±å¹•ä¸­å¿ƒçš„ä½ç½®ã€‚ æœ€åï¼Œæˆ‘ä»¬è¾“å‡º p.X å’Œ p.Y çš„å€¼ã€‚\n% go build -gcflags=-m examples/esc/center.go # command-line-arguments examples/esc/center.go:11:6: can inline Center examples/esc/center.go:18:8: inlining call to Center examples/esc/center.go:19:13: inlining call to fmt.Println examples/esc/center.go:11:13: Center p does not escape examples/esc/center.go:19:15: p.X escapes to heap examples/esc/center.go:19:20: p.Y escapes to heap examples/esc/center.go:19:13: io.Writer(os.Stdout) escapes to heap examples/esc/center.go:17:10: NewPoint new(Point) does not escape examples/esc/center.go:19:13: NewPoint []interface {} literal does not escape \u0026lt;autogenerated\u0026gt;:1: os.(*File).close .this does not escape å³ä½¿ä½¿ç”¨æ–°å‡½æ•°åˆ†é…äº† pï¼Œä¹Ÿä¸ä¼šå°†å…¶å­˜å‚¨åœ¨å †ä¸­ï¼Œå› ä¸ºæ²¡æœ‰å¼•ç”¨ p ä¼šé€¸å‡º Center å‡½æ•°ã€‚\né—®é¢˜: é‚£ç¬¬ 19 è¡Œï¼Œå¦‚æœ p ä¸é€ƒé€¸ï¼Œé‚£æ˜¯ä»€ä¹ˆé€ƒé€¸åˆ°äº†å †å‘¢ï¼Ÿ\nç¼–å†™ä¸€ä¸ªåŸºå‡†ï¼Œä»¥è§„å®š Sum ä¸åˆ†é…ã€‚\n4.3. å†…è” # åœ¨ Go å‡½æ•°ä¸­ï¼Œè°ƒç”¨å…·æœ‰å›ºå®šçš„å¼€é”€ï¼›å †æ ˆå’ŒæŠ¢å æ£€æŸ¥ã€‚\nç¡¬ä»¶åˆ†æ”¯é¢„æµ‹å™¨å¯ä»¥æ”¹å–„å…¶ä¸­çš„ä¸€äº›åŠŸèƒ½ï¼Œä½†æ˜¯å°±åŠŸèƒ½å¤§å°å’Œæ—¶é’Ÿå‘¨æœŸè€Œè¨€ï¼Œè¿™ä»ç„¶æ˜¯ä¸€ä¸ªä»£ä»·ã€‚\nå†…è”æ˜¯é¿å…è¿™äº›æˆæœ¬çš„ç»å…¸ä¼˜åŒ–æ–¹æ³•ã€‚\nç›´åˆ° Go 1.11 å†…è”ä»…åœ¨ å¶å‡½æ•° ä¸Šèµ·ä½œç”¨ï¼Œè¯¥å‡½æ•°ä¸ä¼šè°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ã€‚è¿™æ ·åšçš„ç†ç”±æ˜¯:\nå¦‚æœæ‚¨çš„å‡½æ•°åšäº†å¾ˆå¤šå·¥ä½œï¼Œé‚£ä¹ˆå‰å¯¼å¼€é”€å°†å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåŠŸèƒ½è¦è¾¾åˆ°ä¸€å®šçš„å¤§å°ï¼ˆç›®å‰æœ‰ä¸€äº›æŒ‡ä»¤ï¼ŒåŠ ä¸Šä¸€äº›é˜»æ­¢å…¨éƒ¨å†…è”çš„æ“ä½œï¼Œä¾‹å¦‚ï¼Œåœ¨ Go 1.7 ä¹‹å‰è¿›è¡Œåˆ‡æ¢ï¼‰ å¦ä¸€æ–¹é¢ï¼Œå°çš„åŠŸèƒ½ä¸ºæ‰§è¡Œçš„ç›¸å¯¹å°‘é‡çš„æœ‰ç”¨å·¥ä½œæ”¯ä»˜å›ºå®šçš„å¼€é”€ã€‚è¿™äº›æ˜¯å†…è”ç›®æ ‡çš„åŠŸèƒ½ï¼Œå› ä¸ºå®ƒä»¬æœ€å¤§ç¨‹åº¦åœ°å—ç›Šã€‚ å¦ä¸€ä¸ªåŸå› æ˜¯è¿‡å¤šçš„å†…è”ä½¿å †æ ˆè·Ÿè¸ªæ›´éš¾éµå¾ªã€‚\n4.3.1. Inlining (example) # func Max(a, b int) int { if a \u0026gt; b { return a } return b } func F() { const a, b = 100, 20 if Max(a, b) == b { panic(b) } } åŒæ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨ -gcflags=-m æ ‡å¿—æ¥æŸ¥çœ‹ç¼–è¯‘å™¨çš„ä¼˜åŒ–å†³ç­–ã€‚\n% go build -gcflags=-m examples/inl/max.go # command-line-arguments examples/inl/max.go:4:6: can inline Max examples/inl/max.go:11:6: can inline F examples/inl/max.go:13:8: inlining call to Max examples/inl/max.go:20:6: can inline main examples/inl/max.go:21:3: inlining call to F examples/inl/max.go:21:3: inlining call to Max ç¼–è¯‘å™¨æ‰“å°äº†ä¸¤è¡Œã€‚\nç¬¬ 3 è¡Œä¸­çš„ç¬¬ä¸€ä¸ªæ˜¯ Max çš„å£°æ˜ï¼Œå‘Šè¯‰æˆ‘ä»¬å¯ä»¥å†…è”ã€‚ ç¬¬äºŒä¸ªæŠ¥å‘Šè¯´ï¼ŒMax çš„ä¸»ä½“å·²åœ¨ç¬¬ 12 è¡Œå†…è”åˆ°è°ƒç”¨æ–¹ä¸­ã€‚ åœ¨ä¸ä½¿ç”¨ //go:noinline comment çš„æƒ…å†µä¸‹ï¼Œé‡å†™ Max ä½¿å¾—å®ƒä»ç„¶è¿”å›æ­£ç¡®çš„ç­”æ¡ˆï¼Œä½†æ˜¯ç¼–è¯‘å™¨ä¸å†è®¤ä¸ºå®ƒæ˜¯å¯å†…è”çš„ã€‚\n4.3.2. å†…è”æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ # ç¼–è¯‘ max.goï¼Œçœ‹çœ‹ F() çš„ä¼˜åŒ–ç‰ˆæœ¬æ˜¯ä»€ä¹ˆã€‚\n% go build -gcflags=-S examples/inl/max.go 2\u0026gt;\u0026amp;1 | grep -A5 \u0026#39;\u0026#34;\u0026#34;.F STEXT\u0026#39; \u0026#34;\u0026#34;.F STEXT nosplit size=2 args=0x0 locals=0x0 0x0000 00000 (/Users/dfc/devel/high-performance-go-workshop/examples/inl/max.go:11) TEXT \u0026#34;\u0026#34;.F(SB), NOSPLIT|ABIInternal, $0-0 0x0000 00000 (/Users/dfc/devel/high-performance-go-workshop/examples/inl/max.go:11) FUNCDATA $0, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB) 0x0000 00000 (/Users/dfc/devel/high-performance-go-workshop/examples/inl/max.go:11) FUNCDATA $1, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB) 0x0000 00000 (/Users/dfc/devel/high-performance-go-workshop/examples/inl/max.go:11) FUNCDATA $3, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB) 0x0000 00000 (/Users/dfc/devel/high-performance-go-workshop/examples/inl/max.go:13) PCDATA \u0026lt;span class=\u0026#34;katex\u0026#34;\u0026gt;$1$\u0026lt;/span\u0026gt;0 ä¸€æ—¦å°† Max å†…è”åˆ°å…¶ä¸­ï¼Œå®ƒå°±æ˜¯ F çš„ä¸»ä½“, æ­¤åŠŸèƒ½æ²¡æœ‰ä»»ä½•ååº”ã€‚ æˆ‘çŸ¥é“å±å¹•ä¸Šæœ‰å¾ˆå¤šæ–‡æœ¬ï¼Œä½†æ˜¯ä»€ä¹ˆä¹Ÿæ²¡è¯´ï¼Œä½†è¯·æ‚¨ç›¸ä¿¡ï¼Œå”¯ä¸€å‘ç”Ÿçš„æ˜¯ RETã€‚ å®é™…ä¸Šï¼ŒF å˜ä¸ºï¼š\nfunc F() { return } -S çš„è¾“å‡ºä¸æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„æœ€ç»ˆæœºå™¨ä»£ç ã€‚é“¾æ¥å™¨åœ¨æœ€ç»ˆé“¾æ¥é˜¶æ®µè¿›è¡Œä¸€äº›å¤„ç†ã€‚åƒ FUNCDATA å’Œ PCDATA è¿™æ ·çš„è¡Œæ˜¯åƒåœ¾æ”¶é›†å™¨çš„å…ƒæ•°æ®ï¼Œå®ƒä»¬åœ¨é“¾æ¥æ—¶ä¼šç§»åˆ°å…¶ä»–ä½ç½®ã€‚å¦‚æœæ‚¨æ­£åœ¨è¯»å– -S çš„è¾“å‡ºï¼Œåˆ™åªéœ€å¿½ç•¥ FUNCDATA å’Œ PCDATA è¡Œï¼›å®ƒä»¬ä¸æ˜¯æœ€ç»ˆäºŒè¿›åˆ¶æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ã€‚\n4.3.3. è®¨è®º # ä¸ºä»€ä¹ˆåœ¨ F() ä¸­å£°æ˜ a å’Œ b ä¸ºå¸¸æ•°ï¼Ÿ\nå®éªŒè¾“å‡ºä»¥ä¸‹å†…å®¹ï¼šå¦‚æœå°† a å’Œ b å£°æ˜ä¸ºå˜é‡ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ å¦‚æœ a å’Œ b ä½œä¸ºå‚æ•°ä¼ é€’ç»™ F() ä¼šæ€æ ·ï¼Ÿ\n-gcflags=-S ä¸ä¼šé˜»æ­¢åœ¨æ‚¨çš„å·¥ä½œç›®å½•ä¸­æ„å»ºæœ€ç»ˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å¦‚æœå‘ç°éšåçš„ go build â€¦ è¿è¡Œæ²¡æœ‰è¾“å‡ºï¼Œè¯·åˆ é™¤å·¥ä½œç›®å½•ä¸­çš„ ./max äºŒè¿›åˆ¶æ–‡ä»¶ã€‚\n4.3.4. è°ƒæ•´å†…è”çº§åˆ« # è°ƒæ•´ å†…è”çº§åˆ« æ˜¯é€šè¿‡ -gcflags = -l æ ‡å¿—æ‰§è¡Œçš„ã€‚æœ‰äº›ä»¤äººå›°æƒ‘çš„ä¼ é€’å•ä¸ª -l å°†ç¦ç”¨å†…è”ï¼Œè€Œä¸¤ä¸ªæˆ–å¤šä¸ªå°†å¯ç”¨æ›´æ¿€è¿›çš„è®¾ç½®çš„å†…è”ã€‚\n-gcflags=-l, ç¦ç”¨å†…è”. æ²¡æœ‰ï¼Œæ­£å¸¸å†…è”ã€‚ -gcflags='-l -l' å†…è”çº§åˆ« 2ï¼Œæ›´å…·æ”»å‡»æ€§ï¼Œå¯èƒ½æ›´å¿«ï¼Œå¯èƒ½ä¼šç”Ÿæˆæ›´å¤§çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ -gcflags='-l -l -l' å†…è” 3 çº§ï¼Œå†æ¬¡æ›´å…·æ”»å‡»æ€§ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶è‚¯å®šæ›´å¤§ï¼Œä¹Ÿè®¸å†æ¬¡æ›´å¿«ï¼Œä½†ä¹Ÿå¯èƒ½æœ‰é—®é¢˜ã€‚ -gcflags=-l=4 Go 1.11 ä¸­çš„ï¼ˆå››ä¸ª -lï¼‰å°†å¯ç”¨å®éªŒæ€§ mid stack inlining optimisationã€‚æˆ‘ç›¸ä¿¡ä» Go 1.12 å¼€å§‹å®ƒæ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚ 4.3.5. ä¸­æ ˆå†…è” # ç”±äº Go 1.12 å·²å¯ç”¨æ‰€è°“çš„ ä¸­æ ˆ å†…è”ï¼ˆä»¥å‰åœ¨ Go 1.11 ä¸­çš„é¢„è§ˆä¸­å¸¦æœ‰ -gcflags ='-l -l -l -l' æ ‡å¿—ï¼‰ã€‚\næˆ‘ä»¬å¯ä»¥åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­çœ‹åˆ°ä¸­æ ˆå†…è”çš„ç¤ºä¾‹ã€‚åœ¨ Go 1.11 å’Œæ›´æ—©çš„ç‰ˆæœ¬ä¸­ï¼ŒF ä¸ä¼šæ˜¯å¶å­å‡½æ•°ï¼Œå®ƒç§°ä¸º maxã€‚ä½†æ˜¯ç”±äºå†…è”çš„æ”¹è¿›ï¼Œç°åœ¨å°† F å†…è”åˆ°å…¶è°ƒç”¨æ–¹ä¸­ã€‚è¿™æœ‰ä¸¤ä¸ªåŸå› ã€‚å½“å°† max å†…è”åˆ° F ä¸­æ—¶ï¼ŒF ä¸åŒ…å«å…¶ä»–å‡½æ•°è°ƒç”¨ï¼Œå› æ­¤ï¼Œå¦‚æœæœªè¶…è¿‡å…¶å¤æ‚æ€§é¢„ç®—ï¼Œå®ƒå°†æˆä¸ºæ½œåœ¨çš„ å¶å‡½æ•°ã€‚ç”±äº F æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œå†…è”å’Œæ¶ˆé™¤æ­»ä»£ç æ¶ˆé™¤äº†è®¸å¤šå¤æ‚æ€§é¢„ç®—-å®ƒæœ‰èµ„æ ¼è¿›è¡Œ ä¸­æ ˆ å†…è”ï¼Œè€Œä¸è°ƒç”¨maxæ— å…³ã€‚\nä¸­æ ˆå†…è”å¯ç”¨äºå†…è”å‡½æ•°çš„å¿«é€Ÿè·¯å¾„ï¼Œä»è€Œæ¶ˆé™¤äº†å¿«é€Ÿè·¯å¾„ä¸­çš„å‡½æ•°è°ƒç”¨å¼€é”€ã€‚ æœ€è¿‘è¿›å…¥ Go 1.13 çš„ CL æ˜¾ç¤ºäº†æ­¤æŠ€æœ¯åº”ç”¨äº sync.RWMutex.Unlock()ã€‚\n4.4. æ¶ˆé™¤æ— æ•ˆä»£ç  # ä¸ºä»€ä¹ˆ a å’Œ b æ˜¯å¸¸é‡å¾ˆé‡è¦ï¼Ÿ\nè¦äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ç¼–è¯‘å™¨å°†å…¶ Max å†…è”åˆ° F ä¸­åçœ‹åˆ°çš„å†…å®¹ã€‚æˆ‘ä»¬å¾ˆéš¾ä»ç¼–è¯‘å™¨ä¸­è·å¾—æ­¤ä¿¡æ¯ï¼Œä½†æ˜¯ç›´æ¥æ‰‹åŠ¨å®Œæˆæ˜¯å¾ˆç®€å•çš„ã€‚\nBefore:\nfunc Max(a, b int) int { if a \u0026gt; b { return a } return b } func F() { const a, b = 100, 20 if Max(a, b) == b { panic(b) } } After:\nfunc F() { const a, b = 100, 20 var result int if a \u0026gt; b { result = a } else { result = b } if result == b { panic(b) } } å› ä¸º a å’Œ b æ˜¯å¸¸é‡ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å¯ä»¥åœ¨ç¼–è¯‘æ—¶è¯æ˜è¯¥åˆ†æ”¯æ°¸è¿œä¸ä¼šä¸ºå‡ã€‚100 å§‹ç»ˆå¤§äº 20ã€‚ å› æ­¤ï¼Œç¼–è¯‘å™¨å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ– F ä»¥\nfunc F() { const a, b = 100, 20 var result int if true { result = a } else { result = b } if result == b { panic(b) } } ç°åœ¨å·²ç»çŸ¥é“äº†åˆ†æ”¯çš„ç»“æœï¼Œé‚£ä¹ˆ result çš„å†…å®¹ä¹Ÿå°±çŸ¥é“äº†ã€‚è¿™å°±æ˜¯ æ¶ˆé™¤åˆ†æ”¯.\nfunc F() { const a, b = 100, 20 const result = a if result == b { panic(b) } } ç°åœ¨æ¶ˆé™¤äº†åˆ†æ”¯ï¼Œæˆ‘ä»¬çŸ¥é“ result æ€»æ˜¯ç­‰äº aï¼Œå¹¶ä¸”å› ä¸º a æ˜¯å¸¸æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“ result æ˜¯å¸¸æ•°ã€‚ç¼–è¯‘å™¨å°†æ­¤è¯æ˜åº”ç”¨äºç¬¬äºŒä¸ªåˆ†æ”¯\nfunc F() { const a, b = 100, 20 const result = a if false { panic(b) } } å†æ¬¡ä½¿ç”¨åˆ†æ”¯æ¶ˆé™¤ï¼Œæœ€ç»ˆå½¢å¼ä¸º Fã€‚\nfunc F() { const a, b = 100, 20 const result = a } æœ€åå°±æ˜¯\nfunc F() { } 4.4.1. æ¶ˆé™¤æ— æ•ˆä»£ç ï¼ˆç»­ï¼‰ # åˆ†æ”¯æ¶ˆé™¤æ˜¯ç§°ä¸º æ— æ•ˆä»£ç æ¶ˆé™¤ çš„ä¼˜åŒ–ç±»åˆ«ä¹‹ä¸€ã€‚å®é™…ä¸Šï¼Œä½¿ç”¨é™æ€è¯æ˜æ¥æ˜¾ç¤ºï¼Œæ®µä»£ç æ˜¯æ°¸è¿œæ— æ³•è®¿é—®çš„ï¼Œä¿—ç§° æ— æ•ˆï¼Œå› æ­¤ä¸éœ€è¦åœ¨æœ€ç»ˆäºŒè¿›åˆ¶æ–‡ä»¶ä¸­å¯¹å…¶è¿›è¡Œç¼–è¯‘ï¼Œä¼˜åŒ–æˆ–å‘å‡ºã€‚\næˆ‘ä»¬çœ‹åˆ°äº†æ— æ•ˆä»£ç æ¶ˆé™¤å¦‚ä½•ä¸å†…è”ä¸€èµ·å·¥ä½œï¼Œä»¥å‡å°‘é€šè¿‡åˆ é™¤è¯æ˜æ— æ³•è®¿é—®çš„å¾ªç¯å’Œåˆ†æ”¯è€Œå‡å°‘çš„ä»£ç é‡ã€‚\næ‚¨å¯ä»¥åˆ©ç”¨æ­¤ä¼˜åŠ¿å®æ–½æ˜‚è´µçš„è°ƒè¯•ï¼Œå¹¶å°†å…¶éšè—\nconst debug = false ä¸æ„å»ºæ ‡ç­¾ç»“åˆä½¿ç”¨ï¼Œè¿™å¯èƒ½éå¸¸æœ‰ç”¨ã€‚\n4.4.2. è¿›ä¸€æ­¥é˜…è¯» # Using // +build to switch between debug and release builds How to use conditional compilation with the go build tool 4.5. ç¼–è¯‘å™¨æ ‡è¯†ç»ƒä¹  # % go build -gcflags=$FLAGS ç ”ç©¶ä»¥ä¸‹ç¼–è¯‘å™¨åŠŸèƒ½çš„æ“ä½œï¼š\n-S æ‰“å°æ­£åœ¨ç¼–è¯‘çš„ç¨‹åºåŒ…çš„ (Go é£æ ¼) ç¨‹åºé›†ã€‚ -l æ§åˆ¶å†…è”çš„è¡Œä¸ºï¼› -l ç¦ç”¨å†…è”ï¼Œ-l -l å¢åŠ å†…è”ï¼ˆæ›´å¤š -l å¢åŠ ç¼–è¯‘å™¨å¯¹å†…è”ä»£ç çš„éœ€æ±‚ï¼‰ã€‚å°è¯•ç¼–è¯‘æ—¶é—´ï¼Œç¨‹åºå¤§å°å’Œè¿è¡Œæ—¶é—´çš„å·®å¼‚ã€‚ -m æ§åˆ¶è¯¸å¦‚å†…è”ï¼Œè½¬ä¹‰åˆ†æä¹‹ç±»çš„ä¼˜åŒ–å†³ç­–çš„æ‰“å°ã€‚-m -m æ‰“å°æœ‰å…³ç¼–è¯‘å™¨æ€æƒ³çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚ -l -N ç¦ç”¨æ‰€æœ‰ä¼˜åŒ–ã€‚ å¦‚æœå‘ç°éšåçš„ go build â€¦â€‹ è¿è¡Œæ²¡æœ‰è¾“å‡ºï¼Œè¯·åˆ é™¤å·¥ä½œç›®å½•ä¸­çš„ ./max äºŒè¿›åˆ¶æ–‡ä»¶ã€‚\n4.5.1 è¿›ä¸€æ­¥é˜…è¯» # Codegen Inspection by Jaana Burcu Dogan 4.6. è¾¹ç•Œæ£€æŸ¥æ¶ˆé™¤ # Go æ˜¯ä¸€ç§è¾¹ç•Œæ£€æŸ¥è¯­è¨€ã€‚è¿™æ„å‘³ç€å°†æ£€æŸ¥æ•°ç»„å’Œåˆ‡ç‰‡ä¸‹æ ‡æ“ä½œï¼Œä»¥ç¡®ä¿å®ƒä»¬åœ¨ç›¸åº”ç±»å‹çš„èŒƒå›´å†…ã€‚\nå¯¹äºæ•°ç»„ï¼Œè¿™å¯ä»¥åœ¨ç¼–è¯‘æ—¶å®Œæˆã€‚å¯¹äºåˆ‡ç‰‡ï¼Œè¿™å¿…é¡»åœ¨è¿è¡Œæ—¶å®Œæˆã€‚\nvar v = make([]int, 9) var A, B, C, D, E, F, G, H, I int func BenchmarkBoundsCheckInOrder(b *testing.B) { for n := 0; n \u0026lt; b.N; n++ { A = v[0] B = v[1] C = v[2] D = v[3] E = v[4] F = v[5] G = v[6] H = v[7] I = v[8] } } ä½¿ç”¨ -gcflags=-S æ¥æ‹†è§£ BenchmarkBoundsCheckInOrderã€‚æ¯ä¸ªå¾ªç¯æ‰§è¡Œå¤šå°‘ä¸ªè¾¹ç•Œæ£€æŸ¥æ“ä½œï¼Ÿ\nfunc BenchmarkBoundsCheckOutOfOrder(b *testing.B) { for n := 0; n \u0026lt; b.N; n++ { I = v[8] A = v[0] B = v[1] C = v[2] D = v[3] E = v[4] F = v[5] G = v[6] H = v[7] } } é‡æ–°å®‰æ’æˆ‘ä»¬é€šè¿‡ I åˆ†é… A çš„é¡ºåºæ˜¯å¦ä¼šå½±å“è£…é…ã€‚åˆ†è§£ BenchmarkBoundsCheckOutOfOrder å¹¶æ‰¾å‡ºã€‚\n4.6.1. ç»ƒä¹  # é‡æ–°æ’åˆ—ä¸‹æ ‡æ“ä½œçš„é¡ºåºæ˜¯å¦ä¼šå½±å“å‡½æ•°çš„å¤§å°ï¼Ÿå®ƒä¼šå½±å“åŠŸèƒ½çš„é€Ÿåº¦å—ï¼Ÿ å¦‚æœå°† v ç§»å…¥ åŸºå‡† å‡½æ•°å†…éƒ¨ä¼šæ€æ ·ï¼Ÿ å¦‚æœ v è¢«å£°æ˜ä¸ºæ•°ç»„ï¼Œvar v [9] int ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ 5. æ‰§è¡Œè¿½è¸ªå™¨ # æ‰§è¡Œè·Ÿè¸ªç¨‹åºæ˜¯ç”± Dmitry Vyukov ä¸º Go 1.5 å¼€å‘çš„ï¼Œå¹¶ä¸”ä»å¤„äºè®°å½•å’Œä½¿ç”¨çŠ¶æ€ï¼Œå·²æœ‰å¥½å‡ å¹´äº†ã€‚\nä¸åŸºäºæ ·æœ¬çš„åˆ†æä¸åŒï¼Œæ‰§è¡Œè·Ÿè¸ªå™¨é›†æˆåˆ° Go è¿è¡Œæ—¶ä¸­ï¼Œå› æ­¤å®ƒåªçŸ¥é“ Go ç¨‹ åºåœ¨ç‰¹å®šæ—¶é—´ç‚¹æ­£åœ¨åšä»€ä¹ˆï¼Œä½†æ˜¯ ä¸ºä»€ä¹ˆã€‚\n5.1. ä»€ä¹ˆæ˜¯æ‰§è¡Œè·Ÿè¸ªå™¨ï¼Œä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ # æˆ‘è®¤ä¸ºï¼Œé€šè¿‡æŸ¥çœ‹ä¸€æ®µä»£ç  go tool pprof çš„æ•ˆæœä¸å¥½ï¼Œå¯ä»¥æœ€å®¹æ˜“åœ°è§£é‡Šæ‰§è¡Œè·Ÿè¸ªå™¨çš„åŠŸèƒ½ï¼Œä»¥åŠä¸ºä»€ä¹ˆè¿™æ ·åšå¾ˆé‡è¦ã€‚\nexamples/mandelbrot ç›®å½•åŒ…å«ä¸€ä¸ªç®€å•çš„ mandelbrot ç”Ÿæˆå™¨ã€‚è¯¥ä»£ç æ¥è‡ª Francesc Campoyâ€™s mandelbrot packageã€‚\n% cd examples/mandelbrot % go build \u0026amp;\u0026amp; ./mandelbrot å¦‚æœæˆ‘ä»¬æ„å»ºå®ƒï¼Œç„¶åè¿è¡Œå®ƒï¼Œå®ƒå°†ç”Ÿæˆå¦‚ä¸‹å†…å®¹\n5.1.1. å¤šä¹…æ—¶é—´ï¼Ÿ # é‚£ä¹ˆï¼Œæ­¤ç¨‹åºéœ€è¦å¤šé•¿æ—¶é—´æ‰èƒ½ç”Ÿæˆ 1024 * 1024 åƒç´ çš„å›¾åƒï¼Ÿ\næˆ‘çŸ¥é“å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œçš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ time(1) ä¹‹ç±»çš„ä¸œè¥¿ã€‚\n% time ./mandelbrot real 0m1.654s user 0m1.630s sys 0m0.015s ä¸è¦ä½¿ç”¨ time go run mandebrot.goï¼Œå¦åˆ™æ‚¨å°†èŠ±è´¹ ç¼–è¯‘ ç¨‹åºä»¥åŠè¿è¡Œè¯¥ç¨‹åºæ‰€éœ€çš„æ—¶é—´ã€‚\n5.1.2. è¯¥ç¨‹åºåœ¨åšä»€ä¹ˆï¼Ÿ # åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œç¨‹åºèŠ±è´¹äº† 1.6 ç§’æ¥ç”Ÿæˆ mandelbrot å¹¶å†™å…¥ pngã€‚\nè¿™æ ·å¥½å—ï¼Ÿæˆ‘ä»¬å¯ä»¥åŠ å¿«é€Ÿåº¦å—ï¼Ÿ\nå›ç­”è¯¥é—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ Go å†…ç½®çš„ pprof æ¥åˆ†æç¨‹åºã€‚\nè®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ã€‚\n5.2. ç”Ÿæˆæ€§èƒ½åˆ†æ # è¦ç”Ÿæˆæ€§èƒ½åˆ†æï¼Œæˆ‘ä»¬éœ€è¦\nç›´æ¥ä½¿ç”¨ runtime/pprof è½¯ä»¶åŒ…ã€‚ ä½¿ç”¨ç±»ä¼¼ github.com/pkg/profile çš„åŒ…è£…å™¨è‡ªåŠ¨æ‰§è¡Œæ­¤æ“ä½œã€‚ 5.3. ä½¿ç”¨ runtime/pprof ç”Ÿæˆæ€§èƒ½åˆ†æ # ä¸ºäº†å‘Šè¯‰æ‚¨æˆ‘æ²¡æœ‰ä½¿ç”¨é»‘ç§‘æŠ€(é­”æ³•)ï¼Œè®©æˆ‘ä»¬ä¿®æ”¹ç¨‹åºä»¥å°† CPU æ€§èƒ½åˆ†æå†™å…¥ os.Stdoutã€‚\nimport \u0026#34;runtime/pprof\u0026#34; func main() { pprof.StartCPUProfile(os.Stdout) defer pprof.StopCPUProfile() By adding this code to the top of the main function, this program will write a profile to os.Stdout.\né€šè¿‡å°†æ­¤ä»£ç æ·»åŠ åˆ° main å‡½æ•°çš„é¡¶éƒ¨ï¼Œè¯¥ç¨‹åºä¼šå°†é…ç½®æ–‡ä»¶å†™å…¥ os.Stdoutã€‚\n% cd examples/mandelbrot-runtime-pprof % go run mandelbrot.go \u0026gt; cpu.pprof åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ go runï¼Œå› ä¸º cpu é…ç½®æ–‡ä»¶å°†ä»…åŒ…å« mandelbrot.go çš„æ‰§è¡Œï¼Œè€Œä¸åŒ…æ‹¬å…¶ç¼–è¯‘ã€‚\n5.3.1. ä½¿ç”¨ github.com/pkg/profile ç”Ÿæˆæ€§èƒ½åˆ†æ # ä¸Šä¸€å¼ å¹»ç¯ç‰‡æ˜¾ç¤ºäº†ä¸€ç§ç”Ÿæˆé…ç½®æ–‡ä»¶çš„è¶…çº§ç®€ä¾¿çš„æ–¹æ³•ï¼Œä½†æ˜¯å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚\nå¦‚æœæ‚¨å¿˜è®°äº†å°†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ï¼Œåˆ™ä¼šç ´åè¯¥ç»ˆç«¯ä¼šè¯ã€‚ğŸ˜ï¼ˆæç¤ºï¼šreset(1) æ˜¯æ‚¨çš„æœ‹å‹ï¼‰ å¦‚æœæ‚¨å‘ os.Stdout ä¸­å†™å…¥å…¶ä»–å†…å®¹ (ä¾‹å¦‚ï¼Œfmt.Println)ï¼Œåˆ™ä¼šç ´åè·Ÿè¸ªã€‚ æ¨èä½¿ç”¨ runtime/pprof çš„æ–¹æ³•æ˜¯ å°†è·Ÿè¸ªä¿¡æ¯å†™å…¥æ–‡ä»¶ã€‚ ä½†æ˜¯ï¼Œæ‚¨å¿…é¡»ç¡®ä¿è·Ÿè¸ªå·²åœæ­¢ï¼Œå¹¶ä¸”åœ¨ç¨‹åºåœæ­¢ä¹‹å‰ (åŒ…æ‹¬æœ‰äºº ^C) å…³é—­äº†æ–‡ä»¶ã€‚\nå› æ­¤ï¼Œå‡ å¹´å‰ï¼Œæˆ‘å†™äº†ä¸€ä¸ª package æ¥å¤„ç†å®ƒã€‚\nimport \u0026#34;github.com/pkg/profile\u0026#34; func main() { defer profile.Start(profile.CPUProfile, profile.ProfilePath(\u0026#34;.\u0026#34;)).Stop() å¦‚æœè¿è¡Œæ­¤ç‰ˆæœ¬ï¼Œåˆ™å°†é…ç½®æ–‡ä»¶å†™å…¥å½“å‰å·¥ä½œç›®å½•\n% go run mandelbrot.go 2017/09/17 12:22:06 profile: cpu profiling enabled, cpu.pprof 2017/09/17 12:22:08 profile: cpu profiling disabled, cpu.pprof ä½¿ç”¨ pkg/profile ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä½†æ˜¯å®ƒä¼šå¤„ç†æ”¶é›†å’Œè®°å½•è·Ÿè¸ªä¿¡æ¯çš„è®¸å¤šæ ·æ¿ï¼Œå› æ­¤æˆ‘ä»¬å°†åœ¨æœ¬è®²ä¹ ç­çš„å…¶ä½™éƒ¨åˆ†ä¸­ä½¿ç”¨å®ƒã€‚\n5.3.2. åˆ†ææ€§èƒ½ # ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæ€§èƒ½åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ go tool pprof å¯¹å…¶è¿›è¡Œåˆ†æã€‚\n% go tool pprof -http=:8080 cpu.pprof åœ¨æ­¤è¿è¡Œä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ç¨‹åºè¿è¡Œäº† 1.81 ç§’ (åˆ†æå¢åŠ äº†å°‘é‡å¼€é”€)ã€‚æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ° pprof ä»…æ•è·äº† 1.53 ç§’çš„æ•°æ®ï¼Œå› ä¸º pprof åŸºäºç¤ºä¾‹ï¼Œå®ƒä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ SIGPROF è®¡æ—¶å™¨ã€‚\nä» 1.9 å¼€å§‹ï¼Œpprof è·Ÿè¸ªåŒ…å«åˆ†æè·Ÿè¸ªæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚æ‚¨ä¸å†éœ€è¦ç”Ÿæˆè·Ÿè¸ªçš„åŒ¹é…äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ğŸ‰\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ top pprof å‡½æ•°å¯¹è·Ÿè¸ªè®°å½•çš„å‡½æ•°è¿›è¡Œæ’åº\n% go tool pprof cpu.pprof Type: cpu Time: Mar 24, 2019 at 5:18pm (CET) Duration: 2.16s, Total samples = 1.91s (88.51%) Entering interactive mode (type \u0026#34;help\u0026#34; for commands, \u0026#34;o\u0026#34; for options) (pprof) top Showing nodes accounting for 1.90s, 99.48% of 1.91s total Showing top 10 nodes out of 35 flat flat% sum% cum cum% 0.82s 42.93% 42.93% 1.63s 85.34% main.fillPixel 0.81s 42.41% 85.34% 0.81s 42.41% main.paint 0.11s 5.76% 91.10% 0.12s 6.28% runtime.mallocgc 0.04s 2.09% 93.19% 0.04s 2.09% runtime.memmove 0.04s 2.09% 95.29% 0.04s 2.09% runtime.nanotime 0.03s 1.57% 96.86% 0.03s 1.57% runtime.pthread_cond_signal 0.02s 1.05% 97.91% 0.04s 2.09% compress/flate.(*compressor).deflate 0.01s 0.52% 98.43% 0.01s 0.52% compress/flate.(*compressor).findMatch 0.01s 0.52% 98.95% 0.01s 0.52% compress/flate.hash4 0.01s 0.52% 99.48% 0.01s 0.52% image/png.filter æˆ‘ä»¬çœ‹åˆ°ï¼Œå½“ pprof æ•è·å †æ ˆæ—¶ï¼Œmain.fillPixel å‡½æ•°åœ¨ CPU ä¸Šçš„æ•°é‡æœ€å¤šã€‚\nåœ¨å †æ ˆä¸Šæ‰¾åˆ° main.paint å¹¶ä¸å¥‡æ€ªï¼Œè¿™å°±æ˜¯ç¨‹åºçš„ä½œç”¨ã€‚å®ƒç»˜åˆ¶åƒç´ ã€‚ä½†æ˜¯ï¼Œæ˜¯ä»€ä¹ˆå¯¼è‡´ paint èŠ±è´¹å¤§é‡æ—¶é—´å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥é€šè¿‡å°† cummulative æ ‡å¿—è®¾ç½®ä¸º top æ¥è¿›è¡Œæ£€æŸ¥ã€‚\n(pprof) top --cum Showing nodes accounting for 1630ms, 85.34% of 1910ms total Showing top 10 nodes out of 35 flat flat% sum% cum cum% 0 0% 0% 1840ms 96.34% main.main 0 0% 0% 1840ms 96.34% runtime.main 820ms 42.93% 42.93% 1630ms 85.34% main.fillPixel 0 0% 42.93% 1630ms 85.34% main.seqFillImg 810ms 42.41% 85.34% 810ms 42.41% main.paint 0 0% 85.34% 210ms 10.99% image/png.(*Encoder).Encode 0 0% 85.34% 210ms 10.99% image/png.Encode 0 0% 85.34% 160ms 8.38% main.(*img).At 0 0% 85.34% 160ms 8.38% runtime.convT2Inoptr 0 0% 85.34% 150ms 7.85% image/png.(*encoder).writeIDATs è¿™æš—ç¤ºç€ main.fillPixed å®é™…ä¸Šæ­£åœ¨å®Œæˆå¤§éƒ¨åˆ†å·¥ä½œã€‚\næ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ web å‘½ä»¤æ¥å½¢è±¡åŒ–é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n5.4. è·Ÿè¸ªå’Œæ€§èƒ½åˆ†æ # å¸Œæœ›æ­¤ç¤ºä¾‹æ˜¾ç¤ºäº†åˆ†æçš„å±€é™æ€§ã€‚æ€§èƒ½åˆ†æå‘Šè¯‰æˆ‘ä»¬æ¢æŸ¥å™¨çœ‹åˆ°çš„å†…å®¹ï¼›fillPixel æ­£åœ¨å®Œæˆæ‰€æœ‰å·¥ä½œã€‚ä¼¼ä¹æ²¡æœ‰å¾ˆå¤šäº‹æƒ…å¯ä»¥åšã€‚\nå› æ­¤ï¼Œç°åœ¨æ˜¯å¼•å…¥æ‰§è¡Œè·Ÿè¸ªç¨‹åºçš„å¥½æ—¶æœºï¼Œè¯¥è·Ÿè¸ªç¨‹åºå¯ä»¥ä¸ºåŒä¸€ç¨‹åºæä¾›ä¸åŒçš„è§†å›¾ã€‚\n5.4.1. ä½¿ç”¨æ‰§è¡Œè·Ÿè¸ªå™¨ # ä½¿ç”¨è·Ÿè¸ªç¨‹åºå°±åªéœ€è¦æ”¹å˜ä¸º profile.TraceProfile å³å¯ã€‚\nimport \u0026#34;github.com/pkg/profile\u0026#34; func main() { defer profile.Start(profile.TraceProfile, profile.ProfilePath(\u0026#34;.\u0026#34;)).Stop() å½“æˆ‘ä»¬è¿è¡Œç¨‹åºæ—¶ï¼Œæˆ‘ä»¬åœ¨å½“å‰å·¥ä½œç›®å½•ä¸­å¾—åˆ°ä¸€ä¸ª trace.out æ–‡ä»¶ã€‚\n% go build mandelbrot.go % time ./mandelbrot 2017/09/17 13:19:10 profile: trace enabled, trace.out 2017/09/17 13:19:12 profile: trace disabled, trace.out real 0m1.740s user 0m1.707s sys 0m0.020s å°±åƒ pprof ä¸€æ ·ï¼Œgo å‘½ä»¤ä¸­æœ‰ä¸€ä¸ªå·¥å…·å¯ä»¥åˆ†æè·Ÿè¸ªã€‚\n% go tool trace trace.out 2017/09/17 12:41:39 Parsing trace... 2017/09/17 12:41:40 Serializing trace... 2017/09/17 12:41:40 Splitting trace... 2017/09/17 12:41:40 Opening browser. Trace viewer s listening on http://127.0.0.1:57842 è¿™ä¸ªå·¥å…·å’Œ go tool pprof æœ‰ç‚¹ä¸åŒã€‚æ‰§è¡Œè·Ÿè¸ªå™¨æ­£åœ¨é‡ç”¨ Chrome å†…ç½®çš„è®¸å¤šé…ç½®æ–‡ä»¶å¯è§†åŒ–åŸºç¡€ç»“æ„ï¼Œå› æ­¤ go tool trace å……å½“æœåŠ¡å™¨å°†åŸå§‹æ‰§è¡Œè·Ÿè¸ªè½¬æ¢ä¸º Chome å¯ä»¥æœ¬åœ°æ˜¾ç¤ºçš„æ•°æ®ã€‚\n5.4.2. åˆ†æè¿½è¸ª # ä»è·Ÿè¸ªä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥ç¨‹åºä»…ä½¿ç”¨ä¸€ä¸ª cpuã€‚\nfunc seqFillImg(m *img) { for i, row := range m.m { for j := range row { fillPixel(m, i, j) } } } è¿™å¹¶ä¸å¥‡æ€ªï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œmandelbrot.go ä¼šæŒ‰é¡ºåºä¸ºæ¯ä¸€è¡Œä¸­çš„æ¯ä¸ªåƒç´ è°ƒç”¨ fillPixelã€‚\nç»˜åˆ¶å®Œå›¾åƒåï¼ŒæŸ¥çœ‹æ‰§è¡Œåˆ‡æ¢ä¸ºå†™å…¥ .png æ–‡ä»¶ã€‚è¿™ä¼šåœ¨å †ä¸Šç”Ÿæˆåƒåœ¾ï¼Œå› æ­¤è·Ÿè¸ªåœ¨é‚£æ—¶å‘ç”Ÿäº†å˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åƒåœ¾æ”¶é›†å †çš„ç»å…¸é”¯é½¿æ¨¡å¼ã€‚\nè·Ÿè¸ªæ€§èƒ½åˆ†æå¯æä¾›ä½è‡³ æ¯«ç§’ çº§åˆ«çš„æ—¶åºåˆ†è¾¨ç‡ã€‚ è¿™æ˜¯æ‚¨ä½¿ç”¨å¤–éƒ¨æ€§èƒ½åˆ†ææ— æ³•è·å¾—çš„ã€‚\nåœ¨ç»§ç»­ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è°ˆè°ˆè·Ÿè¸ªå·¥å…·çš„ç”¨æ³•ã€‚\næŠ±æ­‰ï¼Œè¯¥å·¥å…·ä½¿ç”¨ Chrome å†…ç½®çš„ javascript è°ƒè¯•æ”¯æŒã€‚è·Ÿè¸ªé…ç½®æ–‡ä»¶åªèƒ½åœ¨ Chrome ä¸­æŸ¥çœ‹ï¼Œè€Œä¸èƒ½åœ¨ Firefox, Safari, IE/Edge ä¸­ä½¿ç”¨ã€‚ å› ä¸ºè¿™æ˜¯ Google äº§å“ï¼Œæ‰€ä»¥å®ƒæ”¯æŒé”®ç›˜å¿«æ·é”®ã€‚ä½¿ç”¨ WASD å¯¼èˆªï¼Œä½¿ç”¨ ? è·å–åˆ—è¡¨ã€‚ æŸ¥çœ‹è¿½è¸ªå¯èƒ½ä¼šå ç”¨å¤§é‡å†…å­˜ã€‚ è®¤çœŸåœ°è¯´ï¼Œ4Gb ä¸ä¼šå‰Šå‡å®ƒï¼Œ8Gb å¯èƒ½æ˜¯æœ€å°å€¼ï¼Œæ›´å¤šè‚¯å®šæ›´å¥½ã€‚ å¦‚æœæ‚¨æ˜¯ä» Fedora ä¹‹ç±»çš„ OS å‘è¡Œç‰ˆä¸­å®‰è£… Go çš„ï¼Œåˆ™è·Ÿè¸ªæŸ¥çœ‹å™¨çš„æ”¯æŒæ–‡ä»¶å¯èƒ½ä¸æ˜¯ä¸» golang deb/rpm çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä»¬å¯èƒ½ä½äºæŸäº› -extra è½¯ä»¶åŒ…ä¸­ã€‚ 5.5. ä½¿ç”¨å¤šä¸ª CPU # ä»å‰é¢çš„è·Ÿè¸ªä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç¨‹åºæ­£åœ¨æŒ‰é¡ºåºè¿è¡Œï¼Œå¹¶ä¸”æ²¡æœ‰åˆ©ç”¨è¯¥è®¡ç®—æœºä¸Šçš„å…¶ä»– CPUã€‚\nMandelbrot çš„ç”Ÿæˆç§°ä¸º embarassingly_parallel ã€‚æ¯ä¸ªåƒç´ å½¼æ­¤ç‹¬ç«‹ï¼Œéƒ½å¯ä»¥å¹¶è¡Œè®¡ç®—ã€‚æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ã€‚\n% go build mandelbrot.go % time ./mandelbrot -mode px 2017/09/17 13:19:48 profile: trace enabled, trace.out 2017/09/17 13:19:50 profile: trace disabled, trace.out real 0m1.764s user 0m4.031s sys 0m0.865s å› æ­¤ï¼Œè¿è¡Œæ—¶é—´åŸºæœ¬ä¸Šæ˜¯ç›¸åŒçš„ã€‚æˆ‘ä»¬ä½¿ç”¨äº†æ‰€æœ‰ CPUï¼Œå› æ­¤æœ‰æ›´å¤šçš„ç”¨æˆ·æ—¶é—´ï¼Œè¿™æ˜¯æœ‰é“ç†çš„ï¼Œä½†æ˜¯å® é™…(æŒ‚é’Ÿ) æ—¶é—´å¤§è‡´ç›¸åŒã€‚\nè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿½è¸ªã€‚\nå¦‚æ‚¨æ‰€è§ï¼Œæ­¤è·Ÿè¸ªç”Ÿæˆäº† æ›´å¤š çš„æ•°æ®ã€‚\nä¼¼ä¹éœ€è¦å®Œæˆå¾ˆå¤šå·¥ä½œï¼Œä½†æ˜¯å¦‚æœæ‚¨æ”¾å¤§æ”¾å¤§ï¼Œå°±ä¼šå‘ç°å·®è·ã€‚æ®ä¿¡è¿™æ˜¯è°ƒåº¦ç¨‹åºã€‚ è™½ç„¶æˆ‘ä»¬ä½¿ç”¨æ‰€æœ‰å››ä¸ªå†…æ ¸ï¼Œä½†æ˜¯ç”±äºæ¯ä¸ª fillPixel çš„å·¥ä½œé‡ç›¸å¯¹è¾ƒå°ï¼Œå› æ­¤æˆ‘ä»¬åœ¨è°ƒåº¦å¼€é”€æ–¹é¢èŠ±è´¹äº†å¤§é‡æ—¶é—´ã€‚ 5.6. æ•´ç†å·¥ä½œ # æ¯ä¸ªåƒç´ ä½¿ç”¨ä¸€ä¸ª goroutine å¤ªç»†ç²’åº¦ã€‚æ²¡æœ‰è¶³å¤Ÿçš„å·¥ä½œæ¥è¯æ˜ goroutine çš„æˆæœ¬åˆç†ã€‚\nç›¸åï¼Œè®©æˆ‘ä»¬å°è¯•ä¸ºæ¯ä¸ª goroutine å¤„ç†ä¸€è¡Œã€‚\n% go build mandelbrot.go % time ./mandelbrot -mode row 2017/09/17 13:41:55 profile: trace enabled, trace.out 2017/09/17 13:41:55 profile: trace disabled, trace.out real 0m0.764s user 0m1.907s sys 0m0.025s è¿™çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªä¸é”™çš„æ”¹è¿›ï¼Œæˆ‘ä»¬å‡ ä¹å°†ç¨‹åºçš„è¿è¡Œæ—¶é—´å‡å°‘äº†ä¸€åŠã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ç—•è¿¹ã€‚\nå¦‚æ‚¨æ‰€è§ï¼Œè½¨è¿¹ç°åœ¨æ›´å°ï¼Œæ›´æ˜“äºä½¿ç”¨ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è·¨åº¦çš„æ•´ä¸ªè½¨è¿¹ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸é”™çš„å¥–åŠ±ã€‚\nåœ¨ç¨‹åºå¼€å§‹æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ° goroutine çš„æ•°é‡å¤§çº¦ä¸º 1000 è¿™æ˜¯å¯¹ä¸Šä¸€æ¡è·Ÿè¸ªä¸­çœ‹åˆ°çš„ 1 \u0026lt;\u0026lt; 20 çš„æ”¹è¿›ã€‚ æ”¾å¤§åï¼Œæˆ‘ä»¬çœ‹åˆ° onePerRowFillImg è¿è¡Œæ—¶é—´æ›´é•¿ï¼Œå¹¶ä¸”ç”±äº goroutine ç”Ÿäº§ å·¥ä½œå°½æ—©å®Œæˆï¼Œè°ƒåº¦ç¨‹åºæœ‰æ•ˆåœ°å¤„ç†äº†å…¶ä½™å¯è¿è¡Œçš„ goroutineã€‚ 5.7. ä½¿ç”¨ workers # mandelbrot.go æ”¯æŒå¦ä¸€ç§æ¨¡å¼ï¼Œè¯·å°è¯•ä¸€ä¸‹\n% go build mandelbrot.go % time ./mandelbrot -mode workers 2017/09/17 13:49:46 profile: trace enabled, trace.out 2017/09/17 13:49:50 profile: trace disabled, trace.out real 0m4.207s user 0m4.459s sys 0m1.284s å› æ­¤ï¼Œè¿è¡Œæ—¶æ¯”ä»¥å‰ä»»ä½•æ—¶å€™éƒ½å·®ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿½è¸ªï¼Œçœ‹çœ‹æ˜¯å¦å¯ä»¥å¼„æ¸…æ¥šå‘ç”Ÿäº†ä»€ä¹ˆã€‚\nè§‚å¯Ÿç—•è¿¹ï¼Œæ‚¨ä¼šå‘ç°åªæœ‰ä¸€ä¸ª worker å¤„ç†å™¨ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¾€å¾€ä¼šè½®æ¢ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ª worker å¤„ç†å™¨å’Œä¸€ä¸ªæ¶ˆè´¹è€…ã€‚ è®©æˆ‘ä»¬å¢åŠ  worker å¤„ç†å™¨æ•°é‡\n% go build mandelbrot.go % time ./mandelbrot -mode workers -workers 4 2017/09/17 13:52:51 profile: trace enabled, trace.out 2017/09/17 13:52:57 profile: trace disabled, trace.out real 0m5.528s user 0m7.307s sys 0m4.311s è¿™æ ·å°±æ›´ç³Ÿäº†ï¼ æ›´å¤šå®æ—¶ï¼Œæ›´å¤š CPU æ—¶é—´ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿½è¸ªï¼Œçœ‹çœ‹å‘ç”Ÿäº†ä»€ä¹ˆã€‚\né‚£æ¡ç—•è¿¹æ˜¯ä¸€å›¢ç³Ÿã€‚ æœ‰æ›´å¤šçš„ worker å¤„ç†å™¨å¯ç”¨ï¼Œä½†æ˜¯ä¼¼ä¹æ‰€æœ‰çš„æ—¶é—´éƒ½èŠ±åœ¨å¤„ç†å™¨æ‰§è¡Œä¸Šã€‚\nè¿™æ˜¯å› ä¸ºé€šé“æ˜¯ æ— ç¼“å­˜çš„ã€‚åªæœ‰åœ¨æœ‰äººå‡†å¤‡æ¥æ”¶ä¹‹å‰ï¼Œæ— ç¼“å†²çš„é€šé“æ‰èƒ½å‘é€ã€‚\nåœ¨æ²¡æœ‰ worker å¤„ç†å™¨å‡†å¤‡æ¥æ”¶ä¹‹å‰ï¼Œç”Ÿäº§è€…æ— æ³•å‘é€ä½œå“ã€‚ worker å¤„ç†å™¨è¦ç­‰åˆ°æœ‰äººå‡†å¤‡æ´¾é£åæ‰èƒ½æ¥å—å·¥ä½œï¼Œå› æ­¤ä»–ä»¬åœ¨ç­‰å¾…æ—¶ä¼šäº’ç›¸ç«äº‰ã€‚ å‘é€è€…æ²¡æœ‰ç‰¹æƒï¼Œå®ƒä¸èƒ½æ¯”å·²ç»è¿è¡Œçš„å·¥ä½œè€…äº«æœ‰ä¼˜å…ˆæƒã€‚ æˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°çš„æ˜¯æ— ç¼“å†²é€šé“å¸¦æ¥çš„å¤§é‡å»¶è¿Ÿã€‚è°ƒåº¦ç¨‹åºå†…éƒ¨æœ‰å¾ˆå¤šåœæ­¢å’Œå¯åŠ¨ï¼Œå¹¶ä¸”åœ¨ç­‰å¾…å·¥ä½œæ—¶å¯èƒ½ä¼šé”å®šå’Œäº’æ–¥ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬çœ‹åˆ° sys æ—¶é—´æ›´é•¿çš„åŸå› ã€‚\n5.8. ä½¿ç”¨ç¼“å†²é€šé“ # import \u0026#34;github.com/pkg/profile\u0026#34; func main() { defer profile.Start(profile.TraceProfile, profile.ProfilePath(\u0026#34;.\u0026#34;)).Stop() % go build mandelbrot.go % time ./mandelbrot -mode workers -workers 4 2017/09/17 14:23:56 profile: trace enabled, trace.out 2017/09/17 14:23:57 profile: trace disabled, trace.out real 0m0.905s user 0m2.150s sys 0m0.121s è¿™ä¸ä¸Šé¢çš„æ¯è¡Œæ¨¡å¼éå¸¸æ¥è¿‘ã€‚\nä½¿ç”¨ç¼“å†²çš„é€šé“ï¼Œè·Ÿè¸ªæ˜¾ç¤ºå‡ºï¼š\nç”Ÿäº§è€…ä¸å¿…ç­‰å¾… worker å¤„ç†å™¨çš„åˆ°æ¥ï¼Œå®ƒå¯ä»¥è¿…é€Ÿå¡«è¡¥æ¸ é“ã€‚ worker å¤„ç†å™¨å¯ä»¥å¿«é€Ÿä»é€šé“ä¸­å–å‡ºä¸‹ä¸€ä¸ªç‰©å“ï¼Œè€Œæ— éœ€ä¼‘çœ ç­‰å¾…ç”Ÿäº§ã€‚ ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬ä½¿ç”¨é€šé“è¿›è¡Œæ¯ä¸ªåƒç´ çš„å·¥ä½œä¼ é€’çš„é€Ÿåº¦å‡ ä¹ä¸ä¹‹å‰åœ¨æ¯è¡Œ goroutine ä¸Šè¿›è¡Œè°ƒåº¦çš„é€Ÿåº¦ç›¸åŒã€‚\nä¿®æ”¹ nWorkersFillImg ä»¥æ¯è¡Œå·¥ä½œã€‚è®¡æ—¶ç»“æœå¹¶åˆ†æè½¨è¿¹ã€‚\n5.9. Mandelbrot å¾®æœåŠ¡ # åœ¨ 2019 å¹´ï¼Œé™¤éæ‚¨å¯ä»¥å°† Internet ä½œä¸ºæ— æœåŠ¡å™¨å¾®æœåŠ¡æä¾›ï¼Œå¦åˆ™ç”Ÿæˆ Mandelbrots æ¯«æ— æ„ä¹‰ã€‚ å› æ­¤ï¼Œæˆ‘å‘æ‚¨ä»‹ç» Mandelweb\n% go run examples/mandelweb/mandelweb.go 2017/09/17 15:29:21 listening on http://127.0.0.1:8080/ http://127.0.0.1:8080/mandelbrot\n5.9.1. è·Ÿè¸ªæ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åº # åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯¹æ•´ä¸ªç¨‹åºè¿›è¡Œäº†è·Ÿè¸ªã€‚\nå¦‚æ‚¨æ‰€è§ï¼Œå³ä½¿åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…ï¼Œè·Ÿè¸ªä¹Ÿå¯èƒ½éå¸¸å¤§ï¼Œå› æ­¤ï¼Œè¿ç»­æ”¶é›†è·Ÿè¸ªæ•°æ®å°†äº§ç”Ÿå¤ªå¤šçš„æ•°æ®ã€‚åŒæ ·ï¼Œè·Ÿè¸ªå¯èƒ½ä¼šå½±å“ç¨‹åºçš„é€Ÿåº¦ï¼Œç‰¹åˆ«æ˜¯åœ¨æ´»åŠ¨å¾ˆå¤šçš„æƒ…å†µä¸‹ã€‚\næˆ‘ä»¬æƒ³è¦çš„æ˜¯ä¸€ç§ä»æ­£åœ¨è¿è¡Œçš„ç¨‹åºä¸­æ”¶é›†ç®€çŸ­è·Ÿè¸ªçš„æ–¹æ³•ã€‚\nå¹¸è¿çš„æ˜¯ï¼Œnet/http/pprof è½¯ä»¶åŒ…å…·æœ‰è¿™æ ·çš„åŠŸèƒ½ã€‚\n5.9.2. é€šè¿‡ http æ”¶é›†è·Ÿè¸ª # å¸Œæœ›æ¯ä¸ªäººéƒ½çŸ¥é“ net/http/pprof è½¯ä»¶åŒ…ã€‚\nimport _ \u0026#34;net/http/pprof\u0026#34; å¯¼å…¥åï¼Œnet/http/pprof å°†å‘ http.DefaultServeMux æ³¨å†Œè·Ÿè¸ªå’Œåˆ†æè·¯ç”±ã€‚ä» Go 1.5 å¼€å§‹ï¼Œè¿™åŒ…æ‹¬è·Ÿè¸ªåˆ†æå™¨ã€‚\nnet/http/pprof å‘ http.DefaultServeMux æ³¨å†Œã€‚å¦‚æœæ‚¨éšå¼æˆ–æ˜¾å¼åœ°ä½¿ç”¨è¯¥ ServeMuxï¼Œåˆ™å¯èƒ½ä¼šæ— æ„é—´å°† pprof ç«¯ç‚¹å…¬å¼€åˆ° Internetã€‚è¿™å¯èƒ½å¯¼è‡´æºä»£ç æ³„éœ²ã€‚æ‚¨å¯èƒ½ä¸æƒ³è¿™æ ·åšã€‚\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ curlï¼ˆæˆ–wgetï¼‰ä» mandelweb ä¸­è·å–äº”ç§’é’Ÿçš„è·Ÿè¸ªè®°å½•\n% curl -o trace.out http://127.0.0.1:8080/debug/pprof/trace?seconds=5 5.9.3. äº§ç”Ÿä¸€äº›è´Ÿè½½ # å‰é¢çš„ç¤ºä¾‹å¾ˆæœ‰è¶£ï¼Œä½†æ˜¯æ ¹æ®å®šä¹‰ï¼Œç©ºé—²çš„ Web æœåŠ¡å™¨æ²¡æœ‰æ€§èƒ½é—®é¢˜ã€‚æˆ‘ä»¬éœ€è¦äº§ç”Ÿä¸€äº›è´Ÿè½½ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ hey by JBDã€‚\n% go get -u github.com/rakyll/hey è®©æˆ‘ä»¬ä»æ¯ç§’ä¸€ä¸ªè¯·æ±‚å¼€å§‹ã€‚\n% hey -c 1 -n 1000 -q 1 http://127.0.0.1:8080/mandelbrot ç„¶åè¿è¡Œï¼Œåœ¨å¦ä¸€ä¸ªçª—å£ä¸­æ”¶é›†è·Ÿè¸ª\n% curl -o trace.out http://127.0.0.1:8080/debug/pprof/trace?seconds=5 % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 66169 0 66169 0 0 13233 0 --:--:-- 0:00:05 --:--:-- 17390 % go tool trace trace.out 2017/09/17 16:09:30 Parsing trace... 2017/09/17 16:09:30 Serializing trace... 2017/09/17 16:09:30 Splitting trace... 2017/09/17 16:09:30 Opening browser. Trace viewer is listening on http://127.0.0.1:60301 5.9.4. æ¨¡æ‹Ÿè¿‡è½½ # è®©æˆ‘ä»¬å°†é€Ÿç‡æé«˜åˆ°æ¯ç§’ 5 ä¸ªè¯·æ±‚ã€‚\n% hey -c 5 -n 1000 -q 5 http://127.0.0.1:8080/mandelbrot ç„¶åè¿è¡Œï¼Œåœ¨å¦ä¸€ä¸ªçª—å£ä¸­æ”¶é›†è·Ÿè¸ª\n% curl -o trace.out http://127.0.0.1:8080/debug/pprof/trace?seconds=5 % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 66169 0 66169 0 0 13233 0 --:--:-- 0:00:05 --:--:-- 17390 % go tool trace trace.out 2017/09/17 16:09:30 Parsing trace... 2017/09/17 16:09:30 Serializing trace... 2017/09/17 16:09:30 Splitting trace... 2017/09/17 16:09:30 Opening browser. Trace viewer is listening on http://127.0.0.1:60301 5.9.5. é¢å¤–çš„ä¿¡èª‰ï¼ŒEratosthenes çš„ç­›å­ # concurrent prime sieve æ˜¯æœ€æ—©ç¼–å†™çš„ Go ç¨‹åºä¹‹ä¸€ã€‚\nIvan Daniluk æ’°å†™äº†ä¸€ç¯‡å…³äºå¯è§†åŒ–çš„å¾ˆæ£’çš„æ–‡ç« ã€‚\nè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä½¿ç”¨æ‰§è¡Œè·Ÿè¸ªå™¨çš„æ“ä½œã€‚\n5.9.6. æ›´å¤šèµ„æº # Rhys Hiltner, Goâ€™s execution tracer (dotGo 2016) Rhys Hiltner, An Introduction to \u0026ldquo;go tool trace\u0026rdquo; (GopherCon 2017) Dave Cheney, Seven ways to profile Go programs (GolangUK 2016) Dave Cheney, High performance Go workshop] Ivan Daniluk, Visualizing Concurrency in Go (GopherCon 2016) Kavya Joshi, Understanding Channels (GopherCon 2017) Francesc Campoy, Using the Go execution tracer 6. å†…å­˜å’Œåƒåœ¾æ”¶é›†å™¨ # Go æ˜¯ä¸€ç§ gc è¯­è¨€ã€‚è¿™æ˜¯è®¾è®¡åŸåˆ™ï¼Œä¸ä¼šæ”¹å˜ã€‚\nä½œä¸º gc è¯­è¨€ï¼ŒGo ç¨‹åºçš„æ€§èƒ½é€šå¸¸å–å†³äºå®ƒä»¬ä¸ gc çš„äº¤äº’ã€‚\né™¤äº†é€‰æ‹©ç®—æ³•ä¹‹å¤–ï¼Œå†…å­˜æ¶ˆè€—æ˜¯å†³å®šåº”ç”¨ç¨‹åºæ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§çš„æœ€é‡è¦å› ç´ ã€‚\næœ¬èŠ‚è®¨è®ºåƒåœ¾æ”¶é›†å™¨çš„æ“ä½œï¼Œå¦‚ä½•æµ‹é‡ç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µä»¥åŠåœ¨åƒåœ¾æ”¶é›†å™¨æ€§èƒ½æˆä¸ºç“¶é¢ˆçš„æƒ…å†µä¸‹é™ä½å†…å­˜ä½¿ç”¨é‡çš„ç­–ç•¥ã€‚\n6.1. gc çš„ä¸–ç•Œè§‚ # ä»»ä½•åƒåœ¾æ”¶é›†å™¨çš„ç›®çš„éƒ½æ˜¯ä¸ºäº†ç»™ç¨‹åºä¸€ç§å¹»æƒ³ï¼Œå³å­˜åœ¨æ— é™æ•°é‡çš„å¯ç”¨å†…å­˜ã€‚\næ‚¨å¯èƒ½ä¸åŒæ„æ­¤å£°æ˜ï¼Œä½†è¿™æ˜¯åƒåœ¾æ”¶é›†å™¨è®¾è®¡è€…å¦‚ä½•å·¥ä½œçš„åŸºæœ¬å‡è®¾ã€‚\nä»¤äººéœ‡æƒŠçš„æ˜¯ï¼Œå°±æ€»è¿è¡Œæ—¶é—´è€Œè¨€ï¼Œæ ‡è®°æ‰«æ GC æ˜¯æœ€æœ‰æ•ˆçš„ï¼›å¾ˆå¥½ï¼Œé€‚ç”¨äºæ‰¹å¤„ç†ï¼Œæ¨¡æ‹Ÿç­‰ã€‚ä½†æ˜¯ï¼Œéšç€æ—¶é—´çš„æµé€ï¼ŒGo GC å·²ä»çº¯ç²¹çš„åœæ­¢ä¸–ç•Œæ”¶é›†å™¨è½¬å˜ä¸ºå¹¶å‘çš„éå‹ç¼©æ”¶é›†å™¨ã€‚è¿™æ˜¯å› ä¸º Go GC ä¸“ä¸ºä½å»¶è¿ŸæœåŠ¡å™¨å’Œäº¤äº’å¼åº”ç”¨ç¨‹åºè€Œè®¾è®¡ã€‚\nGo GC çš„è®¾è®¡å€¾å‘äºåœ¨ æœ€å¤§ååé‡ ä¸Š é™ä½å»¶è¿Ÿã€‚å®ƒå°†ä¸€äº›åˆ†é…æˆæœ¬ç§»åˆ°äº† mutator ä¸Šï¼Œä»¥å‡å°‘ä»¥åçš„æ¸…ç†æˆæœ¬ã€‚\n6.2. åƒåœ¾æ”¶é›†å™¨è®¾è®¡ # å¤šå¹´æ¥ï¼ŒGo GC çš„è®¾è®¡å‘ç”Ÿäº†å˜åŒ–\nGo 1.0, åœæ­¢å¤§é‡åŸºäº tcmalloc çš„ä¸–ç•Œæ ‡è®°æ¸…é™¤æ”¶é›†å™¨ã€‚ Go 1.3, å®Œå…¨ç²¾ç¡®çš„æ”¶é›†å™¨ï¼Œä¸ä¼šå°†å †ä¸Šçš„å¤§æ•°å­—è¯¯è®¤ä¸ºæ˜¯æŒ‡é’ˆï¼Œä»è€Œä¸ä¼šæµªè´¹å†…å­˜ã€‚ Go 1.5, æ–°çš„ GC è®¾è®¡ï¼Œç€é‡äº ååé‡ å»¶è¿Ÿã€‚ Go 1.6, GC çš„æ”¹è¿›ï¼Œä»¥è¾ƒä½çš„å»¶è¿Ÿå¤„ç†è¾ƒå¤§çš„å †ã€‚ Go 1.7, è¾ƒå°çš„ GC æ”¹è¿›ï¼Œä¸»è¦æ˜¯é‡æ„ã€‚ Go 1.8, è¿›ä¸€æ­¥å·¥ä½œä»¥å‡å°‘ STW æ—¶é—´ï¼Œç°åœ¨å·²é™è‡³ 100 å¾®ç§’èŒƒå›´ã€‚ Go 1.10+, æ‘†è„±çº¯ç²¹çš„åˆä½œ Goroutine è°ƒåº¦ ä»¥é™ä½è§¦å‘æ•´ä¸ªGCå‘¨æœŸæ—¶çš„å»¶è¿Ÿã€‚ 6.3. åƒåœ¾æ”¶é›†å™¨ç›‘æ§ # ä¸€ç§è·å¾—åƒåœ¾æ”¶é›†å™¨å·¥ä½œé‡çš„æ€»ä½“æ€è·¯çš„ç®€å•æ–¹æ³•æ˜¯å¯ç”¨ GC æ—¥å¿—è®°å½•çš„è¾“å‡ºã€‚\nè¿™äº›ç»Ÿè®¡ä¿¡æ¯å§‹ç»ˆä¼šæ”¶é›†ï¼Œä½†é€šå¸¸ä¼šè¢«ç¦æ­¢æ˜¾ç¤ºï¼Œæ‚¨å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ GODEBUG å¯ç”¨å®ƒä»¬ã€‚\n% env GODEBUG=gctrace=1 godoc -http=:8080 gc 1 @0.012s 2%: 0.026+0.39+0.10 ms clock, 0.21+0.88/0.52/0+0.84 ms cpu, 4-\u0026gt;4-\u0026gt;0 MB, 5 MB goal, 8 P gc 2 @0.016s 3%: 0.038+0.41+0.042 ms clock, 0.30+1.2/0.59/0+0.33 ms cpu, 4-\u0026gt;4-\u0026gt;1 MB, 5 MB goal, 8 P gc 3 @0.020s 4%: 0.054+0.56+0.054 ms clock, 0.43+1.0/0.59/0+0.43 ms cpu, 4-\u0026gt;4-\u0026gt;1 MB, 5 MB goal, 8 P gc 4 @0.025s 4%: 0.043+0.52+0.058 ms clock, 0.34+1.3/0.64/0+0.46 ms cpu, 4-\u0026gt;4-\u0026gt;1 MB, 5 MB goal, 8 P gc 5 @0.029s 5%: 0.058+0.64+0.053 ms clock, 0.46+1.3/0.89/0+0.42 ms cpu, 4-\u0026gt;4-\u0026gt;1 MB, 5 MB goal, 8 P gc 6 @0.034s 5%: 0.062+0.42+0.050 ms clock, 0.50+1.2/0.63/0+0.40 ms cpu, 4-\u0026gt;4-\u0026gt;1 MB, 5 MB goal, 8 P gc 7 @0.038s 6%: 0.057+0.47+0.046 ms clock, 0.46+1.2/0.67/0+0.37 ms cpu, 4-\u0026gt;4-\u0026gt;1 MB, 5 MB goal, 8 P gc 8 @0.041s 6%: 0.049+0.42+0.057 ms clock, 0.39+1.1/0.57/0+0.46 ms cpu, 4-\u0026gt;4-\u0026gt;1 MB, 5 MB goal, 8 P gc 9 @0.045s 6%: 0.047+0.38+0.042 ms clock, 0.37+0.94/0.61/0+0.33 ms cpu, 4-\u0026gt;4-\u0026gt;1 MB, 5 MB goal, 8 P è·Ÿè¸ªè¾“å‡ºç»™å‡ºäº†GCæ´»æ€§çš„ä¸€èˆ¬åº¦é‡ã€‚ the runtime package documentation ä¸­æè¿°äº† gctrace=1 çš„è¾“å‡ºæ ¼å¼ã€‚\nDEMO: æ˜¾ç¤ºå¯ç”¨äº† GODEBUG=gctrace=1 çš„ godoc\nåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨æ­¤ç¯å¢ƒå˜é‡ï¼Œä¸ä¼šå¯¹æ€§èƒ½äº§ç”Ÿå½±å“ã€‚\nå½“æ‚¨çŸ¥é“æœ‰é—®é¢˜æ—¶ï¼Œä½¿ç”¨ GODEBUG=gctrace=1 å¾ˆå¥½ï¼Œä½†æ˜¯å¯¹äºGoåº”ç”¨ç¨‹åºä¸Šçš„å¸¸è§„é¥æµ‹ï¼Œæˆ‘å»ºè®®ä½¿ç”¨ net/http/pprof æ¥å£ã€‚\nimport _ \u0026#34;net/http/pprof\u0026#34; å¯¼å…¥ net/http/pprof è½¯ä»¶åŒ…å°†åœ¨ /debug/pprof æ³¨å†Œä¸€ä¸ªå…·æœ‰å„ç§è¿è¡Œæ—¶æŒ‡æ ‡çš„å¤„ç†ç¨‹åºï¼ŒåŒ…æ‹¬ï¼š\nA list of all the running goroutines, /debug/pprof/heap?debug=1. A report on the memory allocation statistics, /debug/pprof/heap?debug=1. net/http/pprof å°†ä½¿ç”¨é»˜è®¤çš„ http.ServeMux æ³¨å†Œè‡ªå·±ã€‚\nè¯·å°å¿ƒï¼Œå› ä¸ºå¦‚æœæ‚¨ä½¿ç”¨ http.ListenAndServe(address, nil)ï¼Œè¿™å°†æ˜¯å¯è§çš„ã€‚\nDEMO: godoc -http=:8080, ä¼šæ˜¾ç¤º /debug/pprofã€‚\n6.3.1. åƒåœ¾æ”¶é›†å™¨è°ƒæ•´ # Go è¿è¡Œæ—¶æä¾›äº†ä¸€ä¸ªç”¨äºè°ƒæ•´ GC çš„ç¯å¢ƒå˜é‡ GOGCã€‚\nGOGC çš„å…¬å¼æ˜¯\n$$ goal = reachabl\\e * (1 + (GOGC)/100) $$ ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å½“å‰æœ‰ä¸€ä¸ª256MBçš„å †ï¼Œå¹¶ä¸” GOGC=100 (é»˜è®¤å€¼)ï¼Œå½“å †å¡«æ»¡æ—¶ï¼Œå®ƒå°†å¢é•¿åˆ°\n$$ 512MB = 256MB * (1 + 100/100) $$ GOGC çš„å€¼å¤§äº100ä¼šä½¿å †å¢é•¿æ›´å¿«ï¼Œä»è€Œå‡è½»äº† GC çš„å‹åŠ›ã€‚ å°äº 100 çš„ GOGC å€¼ä¼šå¯¼è‡´å †ç¼“æ…¢å¢é•¿ï¼Œä»è€Œå¢åŠ äº† GC çš„å‹åŠ›ã€‚ é»˜è®¤å€¼ 100 ä»…ä½œä¸ºå‚è€ƒã€‚ åœ¨ä½¿ç”¨ç”Ÿäº§è´Ÿè½½å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œæ€§èƒ½åˆ†æ ä¹‹åï¼Œæ‚¨åº”è¯¥é€‰æ‹©è‡ªå·±çš„å€¼ã€‚\n6.4. å‡å°‘åˆ†é… # ç¡®ä¿æ‚¨çš„ API å…è®¸è°ƒç”¨æ–¹å‡å°‘ç”Ÿæˆçš„åƒåœ¾é‡ã€‚\nè€ƒè™‘è¿™ä¸¤ç§è¯»å–æ–¹æ³•\nfunc (r *Reader) Read() ([]byte, error) func (r *Reader) Read(buf []byte) (int, error) ç¬¬ä¸€ä¸ª Read æ–¹æ³•ä¸å¸¦ä»»ä½•å‚æ•°ï¼Œå¹¶ä»¥ []byte çš„å½¢å¼è¿”å›ä¸€äº›æ•°æ®ã€‚ç¬¬äºŒä¸ªæ¥æ”¶ä¸€ä¸ª []byte ç¼“å†²åŒºï¼Œå¹¶è¿”å›è¯»å–çš„å­—èŠ‚æ•°ã€‚\nç¬¬ä¸€ä¸ª Read æ–¹æ³•å°† å§‹ç»ˆ åˆ†é…ç¼“å†²åŒºï¼Œä»è€Œç»™GCå¸¦æ¥å‹åŠ›ã€‚ç¬¬äºŒä¸ªå¡«å……å®ƒç»™å®šçš„ç¼“å†²åŒºã€‚\næ‚¨å¯ä»¥åœ¨æ ‡å‡†åº“ä¸­å‘½åéµå¾ªæ­¤æ¨¡å¼çš„ç¤ºä¾‹å—ï¼Ÿ\n6.5. strings å’Œ []bytes # åœ¨ Go ä¸­ï¼Œstring çš„å€¼æ˜¯ä¸å¯å˜çš„ï¼Œ[]byte æ˜¯å¯å˜çš„ã€‚\nå¤§å¤šæ•°ç¨‹åºéƒ½å–œæ¬¢ä½¿ç”¨ stringï¼Œä½†æ˜¯å¤§å¤šæ•° IO æ˜¯ä½¿ç”¨ []byte æ¥å®Œæˆçš„ã€‚\nå°½å¯èƒ½é¿å…å°† []byte è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè¿™é€šå¸¸æ„å‘³ç€é€‰æ‹©ä¸€ç§è¡¨ç¤ºå½¢å¼ï¼Œå³ string æˆ– []byte ä½œä¸ºå€¼ã€‚å¦‚æœæ‚¨ä»ç½‘ç»œæˆ–ç£ç›˜è¯»å–æ•°æ®ï¼Œé€šå¸¸ä¸º []byteã€‚\nbytes åŒ…åŒ…å«è®¸å¤šä¸ strings è½¯ä»¶åŒ…ç›¸åŒçš„æ“ä½œ - Split, Compare, HasPrefixï¼ŒTrim ç­‰ã€‚\nåœ¨åº•å±‚ï¼Œstrings ä¸ bytesåŒ…ä½¿ç”¨ç›¸åŒçš„æ±‡ç¼–åŸè¯­ã€‚\n6.6. ä½¿ç”¨ []byte ä½œä¸º map çš„ key # ä½¿ç”¨ string ä½œä¸ºæ˜ å°„é”®æ˜¯å¾ˆå¸¸è§çš„ï¼Œä½†æ˜¯é€šå¸¸æ‚¨ä¼šä½¿ç”¨ []byteã€‚\nç¼–è¯‘å™¨é’ˆå¯¹è¿™ç§æƒ…å†µå®ç°äº†ç‰¹å®šçš„ä¼˜åŒ–\nvar m map[string]string v, ok := m[string(bytes)] è¿™å°†é¿å…å°†å­—èŠ‚åˆ‡ç‰‡è½¬æ¢ä¸ºç”¨äºæ˜ å°„æŸ¥æ‰¾çš„å­—ç¬¦ä¸²ã€‚è¿™æ˜¯éå¸¸å…·ä½“çš„æ“ä½œï¼Œå¦‚æœæ‚¨æ‰§è¡Œä»¥ä¸‹æ“ä½œå°†æ— æ³•æ­£å¸¸å·¥ä½œ\nkey := string(bytes) val, ok := m[key] è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯å¦ä»ç„¶æ­£ç¡®ã€‚ç¼–å†™ä¸€ä¸ªåŸºå‡†ï¼Œæ¯”è¾ƒä½¿ç”¨ []byte ä½œä¸º string æ˜ å°„é”®çš„è¿™ä¸¤ç§æ–¹æ³•ã€‚\n6.7. é¿å…å­—ç¬¦ä¸²è¿æ¥ # è½¬åˆ°å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ã€‚è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²ä¼šç”Ÿæˆç¬¬ä¸‰ä¸ªå­—ç¬¦ä¸²ã€‚ ä»¥ä¸‹å“ªé¡¹æ˜¯æœ€å¿«çš„ï¼Ÿ\ns := request.ID s += \u0026#34; \u0026#34; + client.Addr().String() s += \u0026#34; \u0026#34; + time.Now().String() r = s var b bytes.Buffer fmt.Fprintf(\u0026amp;b, \u0026#34;%s %v %v\u0026#34;, request.ID, client.Addr(), time.Now()) r = b.String() r = fmt.Sprintf(\u0026#34;%s %v %v\u0026#34;, request.ID, client.Addr(), time.Now()) b := make([]byte, 0, 40) b = append(b, request.ID...) b = append(b, \u0026#39; \u0026#39;) b = append(b, client.Addr().String()...) b = append(b, \u0026#39; \u0026#39;) b = time.Now().AppendFormat(b, \u0026#34;2006-01-02 15:04:05.999999999 -0700 MST\u0026#34;) r = string(b) var b strings.Builder b.WriteString(request.ID) b.WriteString(\u0026#34; \u0026#34;) b.WriteString(client.Addr().String()) b.WriteString(\u0026#34; \u0026#34;) b.WriteString(time.Now().String()) r = b.String() DEMO: go test -bench=. ./examples/concat\n6.8. å¦‚æœé•¿åº¦å·²çŸ¥ï¼Œåˆ™é¢„åˆ†é…ç‰‡ # è¿½åŠ å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å¾ˆæµªè´¹ã€‚\nåˆ‡ç‰‡é€šè¿‡å°†å¤šè¾¾ 1024 ä¸ªå…ƒç´ åŠ å€è€Œå¢é•¿ï¼Œç„¶åå¢åŠ çº¦ 25ï¼…ã€‚æˆ‘ä»¬å†è¿½åŠ ä¸€é¡¹åï¼Œb çš„å®¹é‡æ˜¯å¤šå°‘ï¼Ÿ\nfunc main() { b := make([]int, 1024) b = append(b, 99) fmt.Println(\u0026#34;len:\u0026#34;, len(b), \u0026#34;cap:\u0026#34;, cap(b)) } å¦‚æœä½¿ç”¨ append æ¨¡å¼ï¼Œåˆ™å¯èƒ½ä¼šå¤åˆ¶å¤§é‡æ•°æ®å¹¶åˆ›å»ºå¤§é‡åƒåœ¾ã€‚\nå¦‚æœçŸ¥é“äº‹å…ˆçŸ¥é“åˆ‡ç‰‡çš„é•¿åº¦ï¼Œåˆ™å¯ä»¥é¢„å…ˆåˆ†é…ç›®æ ‡ï¼Œä»¥é¿å…å¤åˆ¶å¹¶ç¡®ä¿ç›®æ ‡å¤§å°æ­£ç¡®ã€‚\nBefore\nvar s []string for _, v := range fn() { s = append(s, v) } return s After\nvals := fn() s := make([]string, len(vals)) for i, v := range vals { s[i] = v } return s 6.9. ä½¿ç”¨ sync.Pool # sync è½¯ä»¶åŒ…å¸¦æœ‰ sync.Pool ç±»å‹ï¼Œç”¨äºé‡ç”¨å…¬å…±å¯¹è±¡ã€‚\nsync.Pool æ²¡æœ‰å›ºå®šå¤§å°æˆ–æœ€å¤§å®¹é‡ã€‚æ‚¨æ·»åŠ åˆ°å®ƒå¹¶ä»ä¸­å–å‡ºç›´åˆ°å‘ç”Ÿ GCï¼Œç„¶åå°†å…¶æ— æ¡ä»¶æ¸…ç©ºã€‚è¿™æ˜¯ by design:\nå¦‚æœåœ¨åƒåœ¾å›æ”¶ä¹‹å‰ä¸ºæ—¶è¿‡æ—©è€Œåœ¨åƒåœ¾å›æ”¶ä¹‹åä¸ºæ—¶è¿‡æ™šï¼Œåˆ™æ’ç©ºæ± çš„æ­£ç¡®æ—¶é—´å¿…é¡»åœ¨åƒåœ¾å›æ”¶æœŸé—´ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ± ç±»å‹çš„è¯­ä¹‰å¿…é¡»æ˜¯å®ƒåœ¨æ¯ä¸ªåƒåœ¾å›æ”¶æ—¶éƒ½æ¶ˆè€—æ‰ã€‚â€”â€‰Russ Cox\nä½¿ç”¨ sync.Pool\nvar pool = sync.Pool{ New: func() interface{} { return make([]byte, 4096) }, } func fn() { buf := pool.Get().([]byte) // takes from pool or calls New // do work pool.Put(buf) // returns buf to the pool } sync.Pool ä¸æ˜¯ç¼“å­˜ã€‚å®ƒå¯ä»¥å¹¶ä¸”å°†åœ¨ä»»ä½•æ—¶é—´æ¸…ç©ºã€‚\nä¸è¦å°†é‡è¦é¡¹ç›®æ”¾åœ¨ sync.Pool ä¸­ï¼Œå®ƒä»¬å°†è¢«ä¸¢å¼ƒã€‚\nGo 1.13 ä¸­å¯èƒ½ä¼šæ›´æ”¹åœ¨æ¯ä¸ª GC ä¸Šæ¸…ç©ºçš„ sync.Pool çš„è®¾è®¡ï¼Œè¿™å°†æœ‰åŠ©äºæé«˜å…¶å®ç”¨æ€§ã€‚\næ­¤ CL é€šè¿‡å¼•å…¥å—å®³è€…ç¼“å­˜æœºåˆ¶æ¥è§£å†³æ­¤é—®é¢˜ã€‚ä»£æ›¿æ¸…é™¤æ± ï¼Œå°†åˆ é™¤å—å®³ç¼“å­˜ï¼Œå¹¶å°†ä¸»ç¼“å­˜ç§»è‡³å—å®³ç¼“å­˜ã€‚ ç»“æœï¼Œåœ¨ç¨³å®šçŠ¶æ€ä¸‹ï¼Œï¼ˆå‡ ä¹ï¼‰æ²¡æœ‰æ–°åˆ†é…ï¼Œä½†æ˜¯å¦‚æœ Pool ä½¿ç”¨ç‡ä¸‹é™ï¼Œå¯¹è±¡ä»å°†åœ¨ä¸¤ä¸ª GCï¼ˆè€Œä¸æ˜¯ä¸€ä¸ªï¼‰ä¸­æ”¶é›†ã€‚â€”â€‰Austin Clements\nhttps://go-review.googlesource.com/c/go/+/166961/\n6.10. ç»ƒä¹  # ä½¿ç”¨ godocï¼ˆæˆ–å…¶ä»–ç¨‹åºï¼‰è§‚å¯Ÿä½¿ç”¨ GODEBUG=gctrace=1 æ”¹å˜ GOGC çš„ç»“æœã€‚ ä½¿ç”¨ bytes, string ä½œä¸º map key å¹¶æ£€æŸ¥åŸºå‡†ã€‚ ä¸åŒå­—ç¬¦ä¸²è¿æ¥ç­–ç•¥çš„åŸºå‡†åˆ†é…ã€‚ 7. æç¤ºå’Œæ—…è¡Œ # éšæœºè·å–æç¤ºå’Œå»ºè®®\næœ€åä¸€éƒ¨åˆ†åŒ…å«ä¸€äº›å¾®ä¼˜åŒ– Go ä»£ç çš„æŠ€å·§ã€‚\n7.1. Goroutines # Goroutines æ˜¯ä½¿å…¶éå¸¸é€‚åˆç°ä»£ç¡¬ä»¶çš„å…³é”®åŠŸèƒ½ã€‚\nGoroutines æ˜“äºä½¿ç”¨ï¼Œè€Œä¸”åˆ›å»ºæˆæœ¬ä½å»‰ï¼Œæ‚¨å¯ä»¥å°†å®ƒä»¬è§†ä¸º å‡ ä¹ å…è´¹ã€‚\nGo è¿è¡Œæ—¶å·²é’ˆå¯¹å…·æœ‰æˆåƒä¸Šä¸‡ä¸ª goroutine ä½œä¸ºæ ‡å‡†çš„ç¨‹åºè€Œç¼–å†™ï¼Œæ•°åä¸‡ä¸ªå¹¶ä¸æ„å¤–ã€‚\nä½†æ˜¯ï¼Œæ¯ä¸ª goroutine ç¡®å®æ¶ˆè€—äº† goroutine å †æ ˆçš„æœ€å°å†…å­˜é‡ï¼Œç›®å‰è‡³å°‘ä¸º2kã€‚\n2048 * 1,000,000 ä¸ª goroutines == 2GB çš„å†…å­˜ï¼Œä»–ä»¬è¿˜æ²¡æœ‰åšä»»ä½•äº‹æƒ…ã€‚\nå¯èƒ½å¾ˆå¤šï¼Œä½†æœªæä¾›åº”ç”¨ç¨‹åºçš„å…¶ä»–ç”¨æ³•ã€‚\n7.1.1. çŸ¥é“ä½•æ—¶åœæ­¢ goroutine # Goroutine çš„å¯åŠ¨æ–¹ä¾¿ï¼Œè¿è¡Œä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯åœ¨å†…å­˜å ç”¨æ–¹é¢ç¡®å®æœ‰ä¸€å®šçš„æˆæœ¬ã€‚æ‚¨ä¸èƒ½åˆ›å»ºæ— é™æ•°é‡çš„å®ƒä»¬ã€‚\næ¯æ¬¡æ‚¨åœ¨ç¨‹åºä¸­ä½¿ç”¨goå…³é”®å­—å¯åŠ¨ goroutine æ—¶ï¼Œæ‚¨éƒ½å¿…é¡» çŸ¥é“ è¯¥ goroutine å¦‚ä½•ä»¥åŠä½•æ—¶é€€å‡ºã€‚\nåœ¨æ‚¨çš„è®¾è®¡ä¸­ï¼ŒæŸäº› goroutine å¯èƒ½ä¼šè¿è¡Œç›´åˆ°ç¨‹åºé€€å‡ºã€‚è¿™äº› goroutine éå¸¸ç½•è§ï¼Œä¸ä¼šæˆä¸ºè§„åˆ™çš„ä¾‹å¤–ã€‚\nå¦‚æœæ‚¨ä¸çŸ¥é“ç­”æ¡ˆï¼Œé‚£å°†æ˜¯æ½œåœ¨çš„å†…å­˜æ³„æ¼ï¼Œå› ä¸º goroutine ä¼šå°†å…¶å †æ ˆçš„å†…å­˜ä»¥åŠå¯ä»å †æ ˆè®¿é—®çš„æ‰€æœ‰å †åˆ†é…å˜é‡å›ºå®šåœ¨å †æ ˆä¸Šã€‚\nåˆ‡å‹¿åœ¨ä¸çŸ¥é“å¦‚ä½•åœæ­¢ goroutine çš„æƒ…å†µä¸‹å¯åŠ¨å®ƒã€‚\n7.1.2. è¿›ä¸€æ­¥é˜…è¯» # Concurrency Made Easy (video) Concurrency Made Easy (slides) Never start a goroutine without knowning when it will stop (Practical Go, QCon Shanghai 2018) 7.2. Go å¯¹æŸäº›è¯·æ±‚ä½¿ç”¨æœ‰æ•ˆçš„ç½‘ç»œè½®è¯¢ # Go è¿è¡Œæ—¶ä½¿ç”¨æœ‰æ•ˆçš„æ“ä½œç³»ç»Ÿè½®è¯¢æœºåˆ¶ï¼ˆkqueueï¼Œepollï¼Œwindows IOCPç­‰ï¼‰å¤„ç†ç½‘ç»œIOã€‚ä¸€ä¸ªå•ä¸€çš„æ“ä½œç³»ç»Ÿçº¿ç¨‹å°†ä¸ºè®¸å¤šç­‰å¾…çš„ goroutine æä¾›æœåŠ¡ã€‚\nä½†æ˜¯ï¼Œå¯¹äºæœ¬åœ°æ–‡ä»¶ IOï¼ŒGo ä¸ä¼šå®ç°ä»»ä½• IO è½®è¯¢ã€‚ *os.File ä¸Šçš„æ¯ä¸ªæ“ä½œåœ¨è¿›è¡Œä¸­éƒ½ä¼šæ¶ˆè€—ä¸€ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ã€‚\nå¤§é‡ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ IO å¯èƒ½ä¼šå¯¼è‡´æ‚¨çš„ç¨‹åºäº§ç”Ÿæ•°ç™¾æˆ–æ•°åƒä¸ªçº¿ç¨‹ã€‚å¯èƒ½è¶…å‡ºæ‚¨çš„æ“ä½œç³»ç»Ÿæ‰€å…è®¸çš„èŒƒå›´ã€‚\næ‚¨çš„ç£ç›˜å­ç³»ç»Ÿä¸å¸Œæœ›èƒ½å¤Ÿå¤„ç†æˆç™¾ä¸Šåƒçš„å¹¶å‘ IO è¯·æ±‚ã€‚\nè¦é™åˆ¶å¹¶å‘é˜»å¡ IO çš„æ•°é‡ï¼Œè¯·ä½¿ç”¨å·¥ä½œç¨‹åº goroutine æ± æˆ–ç¼“å†²é€šé“ä½œä¸ºä¿¡å·ç¯ã€‚\nvar semaphore = make(chan struct{}, 10) func processRequest(work *Work) { semaphore \u0026lt;- struct{}{} // acquire semaphore // process request \u0026lt;-semaphore // release semaphore } 7.3. æ³¨æ„æ‚¨çš„åº”ç”¨ç¨‹åºä¸­çš„ IO multipliers # å¦‚æœæ‚¨æ­£åœ¨ç¼–å†™æœåŠ¡å™¨è¿›ç¨‹ï¼Œé‚£ä¹ˆå®ƒçš„ä¸»è¦å·¥ä½œæ˜¯å¤šè·¯å¤ç”¨é€šè¿‡ç½‘ç»œè¿æ¥çš„å®¢æˆ·ç«¯å’Œå­˜å‚¨åœ¨åº”ç”¨ç¨‹åºä¸­çš„æ•°æ®ã€‚\nå¤§å¤šæ•°æœåŠ¡å™¨ç¨‹åºæ¥å—è¯·æ±‚ï¼Œè¿›è¡Œä¸€äº›å¤„ç†ï¼Œç„¶åè¿”å›ç»“æœã€‚è¿™å¬èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯æ ¹æ®ç»“æœï¼Œå®ƒå¯èƒ½ä¼šä½¿å®¢æˆ·ç«¯æ¶ˆè€—æœåŠ¡å™¨ä¸Šå¤§é‡ï¼ˆå¯èƒ½æ˜¯æ— é™åˆ¶çš„ï¼‰èµ„æºã€‚ è¿™é‡Œæœ‰ä¸€äº›æ³¨æ„äº‹é¡¹:\næ¯ä¸ªä¼ å…¥è¯·æ±‚çš„ IO è¯·æ±‚æ•°é‡ï¼›å•ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ç”Ÿæˆå¤šå°‘ä¸ªIOäº‹ä»¶ï¼Ÿå®ƒå¯èƒ½å¹³å‡ä¸º 1ï¼Œæˆ–è€…å¦‚æœä»ç¼“å­˜ä¸­æä¾›äº†è®¸å¤šè¯·æ±‚ï¼Œåˆ™å¯èƒ½å°äºä¸€ä¸ªã€‚ æœåŠ¡æŸ¥è¯¢æ‰€éœ€çš„è¯»å–é‡ï¼›å®ƒæ˜¯å›ºå®šçš„ï¼ŒN + 1è¿˜æ˜¯çº¿æ€§çš„ï¼ˆè¯»å–æ•´ä¸ªè¡¨ä»¥ç”Ÿæˆç»“æœçš„æœ€åä¸€é¡µï¼‰ã€‚ ç›¸å¯¹è€Œè¨€ï¼Œå¦‚æœå†…å­˜å¾ˆæ…¢ï¼Œé‚£ä¹ˆIOå¤ªæ…¢äº†ï¼Œæ‚¨åº”è¯¥ä¸æƒœä¸€åˆ‡ä»£ä»·é¿å…è¿™æ ·åšã€‚æœ€é‡è¦çš„æ˜¯ï¼Œé¿å…åœ¨è¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¸­è¿›è¡ŒIOï¼Œä¸è¦è®©ç”¨æˆ·ç­‰å¾…æ‚¨çš„ç£ç›˜å­ç³»ç»Ÿå†™å…¥ç£ç›˜ç”šè‡³è¯»å–ç£ç›˜ã€‚\n7.4. ä½¿ç”¨æµå¼ IO æ¥å£ # å°½å¯èƒ½é¿å…å°†æ•°æ®è¯»å–åˆ° []byte ä¸­å¹¶å°†å…¶ä¼ é€’ã€‚\næ ¹æ®è¯·æ±‚ï¼Œæ‚¨å¯èƒ½æœ€ç»ˆå°†å…†å­—èŠ‚ï¼ˆæˆ–æ›´å¤šï¼ï¼‰çš„æ•°æ®è¯»å–åˆ°å†…å­˜ä¸­ã€‚è¿™ç»™ GC å¸¦æ¥äº†å·¨å¤§å‹åŠ›ï¼Œè¿™å°†å¢åŠ åº”ç”¨ç¨‹åºçš„å¹³å‡å»¶è¿Ÿã€‚\nè€Œæ˜¯ä½¿ç”¨ io.Reader å’Œ io.Writer æ¥æ„é€ å¤„ç†ç®¡é“ï¼Œä»¥é™åˆ¶æ¯ä¸ªè¯·æ±‚ä½¿ç”¨çš„å†…å­˜é‡ã€‚\nä¸ºäº†æé«˜æ•ˆç‡ï¼Œå¦‚æœæ‚¨ä½¿ç”¨å¤§é‡çš„ io.Copyï¼Œè¯·è€ƒè™‘å®ç° io.ReaderFrom/io.WriterToã€‚ è¿™äº›æ¥å£æ•ˆç‡æ›´é«˜ï¼Œå¹¶ä¸”é¿å…å°†å†…å­˜å¤åˆ¶åˆ°ä¸´æ—¶ç¼“å†²åŒºä¸­ã€‚\n7.5. è¶…æ—¶, è¶…æ—¶, è¶…æ—¶ # åœ¨ä¸çŸ¥é“æ‰€éœ€çš„æœ€é•¿æ—¶é—´ä¹‹å‰ï¼Œåˆ‡å‹¿å¯åŠ¨ IO æ“ä½œã€‚\næ‚¨éœ€è¦ä½¿ç”¨ SetDeadline, SetReadDeadline, SetWriteDeadline å¯¹æ¯ä¸ªç½‘ç»œè¯·æ±‚è®¾ç½®è¶…æ—¶ã€‚\n7.6. defer æ¶ˆè€—å¾ˆå¤§ï¼Œè¿˜æ˜¯ï¼Ÿ # defer æ¶ˆè€—å¾ˆé«˜ï¼Œå› ä¸ºå®ƒå¿…é¡»è®°å½•ä¸‹ defer çš„è®ºç‚¹ã€‚\ndefer mu.Unlock() ç›¸å½“äº\ndefer func() { mu.Unlock() }() å¦‚æœå®Œæˆçš„å·¥ä½œé‡å¾ˆå°ï¼Œåˆ™ defer ä¼šå¾ˆæ˜‚è´µï¼Œç»å…¸çš„ä¾‹å­æ˜¯ defer å›´ç»•ç»“æ„å˜é‡æˆ–æ˜ å°„æŸ¥æ‰¾è¿›è¡Œäº’æ–¥è§£é”ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥é€‰æ‹©é¿å… deferã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºäº†è·å¾—æ€§èƒ½è€Œç‰ºç‰²äº†å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚\nå§‹ç»ˆé‡æ–°å®¡è§†è¿™äº›å†³å®šã€‚\n7.7. é¿å… Finalisers # Finalisation æ˜¯ä¸€ç§å°†è¡Œä¸ºé™„åŠ åˆ°å³å°†è¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡çš„æŠ€æœ¯ã€‚\nå› æ­¤ï¼Œæœ€ç»ˆç¡®å®šæ˜¯ä¸ç¡®å®šçš„ã€‚\nè¦è¿è¡Œ finalizerï¼Œè¯¥å¯¹è±¡ä¸å¾—é€šè¿‡ä»»ä½•ç‰©ä½“åˆ°è¾¾ã€‚ å¦‚æœæ‚¨ä¸å°å¿ƒåœ¨åœ°å›¾ä¸Šä¿ç•™äº†å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨ï¼Œåˆ™è¯¥å¯¹è±¡ä¸ä¼šè¢«æœ€ç»ˆç¡®å®šã€‚\nfinalizer æ˜¯ gc å‘¨æœŸçš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ„å‘³ç€å®ƒä»¬ä½•æ—¶è¿è¡Œå°†æ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œå¹¶ä¸”ä¸å‡å°‘ gc æ“ä½œçš„ç›®æ ‡ç›¸çŸ›ç›¾ã€‚\nå¦‚æœå †å¾ˆå¤§å¹¶ä¸”å·²è°ƒæ•´åº”ç”¨ç¨‹åºä»¥åˆ›å»ºæœ€å°‘çš„åƒåœ¾ï¼Œåˆ™ finalizer å¯èƒ½ä¸ä¼šè¿è¡Œå¾ˆé•¿æ—¶é—´ã€‚\n7.8. å‡å°‘ cgo # cgo å…è®¸ Go ç¨‹åºè°ƒç”¨ C åº“ã€‚\nC ä»£ç å’Œ Go ä»£ç ç”Ÿæ´»åœ¨ä¸¤ä¸ªä¸åŒçš„ä¸–ç•Œä¸­ï¼Œcgo ç©¿è¶Šäº†å®ƒä»¬ä¹‹é—´çš„è¾¹ç•Œã€‚\nè¿™ç§è½¬æ¢ä¸æ˜¯å…è´¹çš„ï¼Œå¹¶ä¸”å–å†³äºå®ƒåœ¨ä»£ç ä¸­çš„ä½ç½®ï¼Œå…¶æˆæœ¬å¯èƒ½å¾ˆé«˜ã€‚\ncgo è°ƒç”¨ç±»ä¼¼äºé˜»å¡ IOï¼Œå®ƒä»¬åœ¨æ“ä½œæœŸé—´æ¶ˆè€—çº¿ç¨‹ã€‚\nä¸è¦åœ¨ç´§å¯†å¾ªç¯ä¸­è°ƒç”¨ C ä»£ç ã€‚\n7.8.1. å…¶å®ï¼Œä¹Ÿè®¸é¿å… cgo # cgo çš„å¼€é”€å¾ˆé«˜ã€‚\nä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½ï¼Œæˆ‘å»ºè®®æ‚¨åœ¨åº”ç”¨ç¨‹åºä¸­é¿å…ä½¿ç”¨ cgoã€‚\nå¦‚æœCä»£ç èŠ±è´¹å¾ˆé•¿æ—¶é—´ï¼Œåˆ™ cgo å¼€é”€å¹¶ä¸é‡è¦ã€‚ å¦‚æœæ‚¨ä½¿ç”¨ cgo è°ƒç”¨éå¸¸çŸ­çš„ C å‡½æ•°ï¼ˆå…¶å¼€é”€æœ€æ˜æ˜¾ï¼‰ï¼Œè¯·åœ¨ Go ä¸­é‡å†™è¯¥ä»£ç  - æ ¹æ®å®šä¹‰ï¼Œè¿™å¾ˆçŸ­ã€‚ å¦‚æœæ‚¨åœ¨ç´§å¯†çš„å¾ªç¯ä¸­ä½¿ç”¨äº†å¤§é‡æ˜‚è´µçš„ C ä»£ç ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Goï¼Ÿ æ˜¯å¦æœ‰äººä½¿ç”¨ cgo é¢‘ç¹è°ƒç”¨æ˜‚è´µçš„ C ä»£ç ï¼Ÿ\nè¿›ä¸€æ­¥é˜…è¯» # cgo is not Go 7.9. å§‹ç»ˆä½¿ç”¨æœ€æ–°å‘å¸ƒçš„Goç‰ˆæœ¬ # æ—§ç‰ˆæœ¬çš„ Go æ°¸è¿œä¸ä¼šå˜å¾—æ›´å¥½ã€‚ä»–ä»¬å°†æ°¸è¿œä¸ä¼šå¾—åˆ°é”™è¯¯ä¿®å¤æˆ–ä¼˜åŒ–ã€‚\nGo 1.4 ä¸åº”è¯¥ä½¿ç”¨ã€‚ Go 1.5 å’Œ 1.6 ç¼–è¯‘å™¨é€Ÿåº¦è¾ƒæ…¢ï¼Œä½†ç”Ÿæˆçš„ä»£ç æ›´å¿«ï¼ŒGCæ›´å¿«ã€‚ Go 1.7 ä¸ 1.6 ç›¸æ¯”ï¼Œç¼–è¯‘é€Ÿåº¦æé«˜äº†çº¦ 30ï¼…ï¼Œé“¾æ¥é€Ÿåº¦æé«˜äº† 2 å€ï¼ˆæ¯”ä»»ä½•ä»¥å‰çš„Goç‰ˆæœ¬éƒ½è¦å¥½ï¼‰ã€‚ Go 1.8 ï¼ˆæ­¤æ—¶ï¼‰å°†æä¾›è¾ƒå°çš„ç¼–è¯‘é€Ÿåº¦æ”¹è¿›ï¼Œä½†éè‹±ç‰¹å°”æ¶æ„çš„ä»£ç è´¨é‡å°†å¾—åˆ°æ˜¾ç€æ”¹è¿›ã€‚ Go 1.9-1.12 ç»§ç»­æé«˜æ‰€ç”Ÿæˆä»£ç çš„æ€§èƒ½ï¼Œä¿®å¤é”™è¯¯ï¼Œå¹¶æ”¹å–„å†…è”å’Œæ”¹è¿›è°ƒè¯•ã€‚ æ—§ç‰ˆæœ¬çš„Goæ²¡æœ‰æ›´æ–°ã€‚è¯·å‹¿ä½¿ç”¨ã€‚ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬ï¼Œæ‚¨å°†è·å¾—æœ€ä½³æ€§èƒ½ã€‚\n7.9.1. è¿›ä¸€æ­¥é˜…è¯» # Go 1.7 toolchain improvements Go 1.8 performance improvements 7.9.2. å°†çƒ­ç‚¹å­—æ®µç§»åŠ¨åˆ° struct é¡¶éƒ¨ # 7.10. è®¨è®º # Any questions?\n8. æœ€åçš„é—®é¢˜å’Œç»“è®º # å¯è¯»æ„å‘³ç€å¯é â€‰â€”â€‰Rob Pike\nä»æœ€ç®€å•çš„ä»£ç å¼€å§‹ã€‚\næµ‹é‡ã€‚ åˆ†ææ‚¨çš„ä»£ç ä»¥è¯†åˆ«ç“¶é¢ˆï¼Œè¯·ä¸è¦çŒœæµ‹ã€‚\nå¦‚æœæ€§èƒ½è‰¯å¥½ï¼Œè¯· åœæ­¢ã€‚æ‚¨æ— éœ€ä¼˜åŒ–æ‰€æœ‰å†…å®¹ï¼Œåªéœ€ä¼˜åŒ–ä»£ç ä¸­æœ€çƒ­çš„éƒ¨åˆ†ã€‚\néšç€åº”ç”¨ç¨‹åºçš„å¢é•¿æˆ–æµé‡æ¨¡å¼çš„å‘å±•ï¼Œæ€§èƒ½çƒ­ç‚¹å°†å‘ç”Ÿå˜åŒ–ã€‚\nä¸è¦ç•™ä¸‹å¯¹æ€§èƒ½ä¸é‡è¦çš„å¤æ‚ä»£ç ï¼Œå¦‚æœç“¶é¢ˆè½¬ç§»åˆ°å…¶ä»–åœ°æ–¹ï¼Œè¯·ä½¿ç”¨æ›´ç®€å•çš„æ“ä½œå°†å…¶é‡å†™ã€‚\nå§‹ç»ˆç¼–å†™æœ€ç®€å•çš„ä»£ç ï¼Œç¼–è¯‘å™¨é’ˆå¯¹ æ­£è§„ ä»£ç è¿›è¡Œäº†ä¼˜åŒ–ã€‚\nè¾ƒçŸ­çš„ä»£ç æ˜¯è¾ƒå¿«çš„ä»£ç ï¼› Go ä¸æ˜¯ C++ï¼Œä¸è¦æŒ‡æœ›ç¼–è¯‘å™¨èƒ½å¤Ÿè§£å¼€å¤æ‚çš„æŠ½è±¡ã€‚\nä»£ç è¶ŠçŸ­ï¼Œä»£ç  è¶Šå°ï¼›è¿™å¯¹äºCPUçš„ç¼“å­˜å¾ˆé‡è¦ã€‚\néå¸¸æ³¨æ„åˆ†é…ï¼Œå°½å¯èƒ½é¿å…ä¸å¿…è¦çš„åˆ†é…ã€‚\nå¦‚æœäº‹æƒ…ä¸ä¸€å®šæ­£ç¡®ï¼Œæˆ‘å¯ä»¥å°†äº‹æƒ…åšå¾—å¾ˆå¿«ã€‚â€”â€‰Russ Cox\næ€§èƒ½å’Œå¯é æ€§åŒæ ·é‡è¦ã€‚\næˆ‘è®¤ä¸ºåˆ¶ä½œä¸€ä¸ªéå¸¸å¿«é€Ÿçš„æœåŠ¡å™¨ä½†æ˜¯å´å®šæœŸ panicsï¼Œæ­»é”æˆ– OOM æ¯«æ— ä»·å€¼ã€‚\nä¸è¦ä¸ºäº†å¯é æ€§è€Œç‰ºç‰²æ€§èƒ½ã€‚\n1. Hennessy et al: 40 å¹´çš„å¹´åº¦ç»©æ•ˆæé«˜äº† 1.4 å€ã€‚\nref # https://github.com/davecheney/gophercon2018-performance-tuning-workshop https://dave.cheney.net/high-performance-go-workshop/dotgo-paris.html#avoid_finalisers https://github.com/davecheney/high-performance-go-workshop\n"},{"id":10,"href":"/posts/backend/report/","title":"æŠ¥å‘Šå®ç°","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šæŠ¥å‘Šç³»ç»Ÿè®¾è®¡\néœ€æ±‚æ˜¯æ— å¤–ç½‘ç¯å¢ƒä¸‹ï¼Œæ±‡æ€»å½“å‰ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ï¼Œéœ€è¦ç»˜åˆ¶å¤§é‡å›¾è¡¨åˆ° word/pdfã€‚\nå®ç°è¯­è¨€: golang\nå¦‚ä½•æ›´åŠ æ–¹ä¾¿çš„ç®¡ç†æŠ¥å‘Šæ¨¡ç‰ˆ # ä¸»è¦æ€è·¯ï¼š\næŠ¥å‘Šæ¨¡ç‰ˆä½¿ç”¨ markdown+golang/text/template æ¸²æŸ“ï¼Œå›¾è¡¨ä½¿ç”¨ datauri ç›´æ¥å†…åµŒå…¥ markdownã€‚\u0008\u0008markdown ç»è¿‡ ast è§£æåç¿»è¯‘æˆå¯¹åº”çš„å…ƒç´ ï¼Œæ¸²æŸ“æˆ report.Report ä¸­é—´æ¥å£ã€‚report.Report æ¥å£ä½œä¸ºä¸­é—´å±‚ï¼Œä¸‹è¾¹å®ç° pdf/word æ¸²æŸ“å®ç°ã€‚\næœ€ç»ˆè¾¾æˆçš„ç›®æ ‡ï¼šæ ·å¼ç”± report.Report çš„å®ç°å†³å®šï¼Œä¸Šå±‚ markdown å…³æ³¨å†…å®¹ã€‚\ngithub.com/yuin/goldmark\næŠ¥è¡¨ä¸­å¤§é‡å›¾è¡¨å¦‚ä½•æ¸²æŸ“ # ä½¿ç”¨å‰ç«¯æŠ€æœ¯ç»˜åˆ¶å›¾è¡¨ï¼Œå¯åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è·å¾—ç»“æœ\næ¸²æŸ“æœåŠ¡ï¼šæ§åˆ¶æµè§ˆå™¨æ‰“å¼€ç½‘é¡µï¼Œå¹¶æŒ‡å®šæˆªå›¾æŸåŒºåŸŸ\u0008.\næœ‰ä¸€ä¸ªå…³é”®è®¾è®¡: chromedp æ§åˆ¶æµè§ˆå™¨ï¼Œä¼šæ²¡æœ‰åŸºç¡€çš„ postè¯·æ±‚æ–¹å¼ï¼Œéœ€è¦é€šè¿‡æ§åˆ¶æµè§ˆå™¨æ‰§è¡Œ js, å¯¹ç½‘é¡µè¿›è¡Œæ§åˆ¶ï¼ˆåˆ›å»º dom ï¼Œå¹¶ç”»å‡ºå›¾ï¼‰\næ¸²æŸ“æœåŠ¡æ— çŠ¶æ€ï¼Œéœ€è¦ç®¡ç† chrome headlessã€‚å¯¹å¤–æä¾› openapi\ngolang\nhttps://github.com/browserless/chrome/issues/52 github.com/chromedp/chromedp\nå¦‚ä½•ä¿å­˜æœ€ç»ˆç”Ÿæˆçš„æŠ¥å‘Š # markdown ç›´æ¥å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œä¼˜ç‚¹ä¸éœ€è¦åšå¤§é‡å°æ–‡ä»¶ä¼˜åŒ–\n"},{"id":11,"href":"/posts/Go/go-issue/","title":"Go Issue","section":"Blog","content":"è®°å½• golang ç›¸å…³å¾ˆéš¾è°ƒè¯•çš„ bug\nbugs # SIGSEGV during C.getaddrinfo # https://github.com/golang/go/issues/30310\nglibc çš„ bug å¯¼è‡´ go ä¸­ net æ¨¡å—é™æ€ç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶ getaddrinfo çš„æ—¶å€™ pinicï¼Œæ— æ³•å¯åŠ¨æœåŠ¡ è§£å†³åŠæ³•: ä¸´æ—¶ä½¿ç”¨ go è‡ªå·±çš„ net å®ç° -tags netgo, æˆ–è€… å·²ç» build çš„ç¨‹åº GODEBUG=netdns=go binery åŠ ç¯å¢ƒå˜é‡ä½¿ç”¨ go çš„ net å®ç°\n"},{"id":12,"href":"/posts/Architecture/opentracing/jaeger-agent/","title":"Opentracing - jaeger","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šä»‹ç» Opentracing - jaeger\nagent # Agent å¤„äº jaeger-client å’Œ collector ä¹‹é—´ï¼Œå±äºä»£ç†çš„ä½œç”¨ï¼Œä¸»è¦æ˜¯æŠŠ client å‘é€è¿‡æ¥çš„æ•°æ®ä» thrift è½¬ä¸º Batchï¼Œå¹¶é€šè¿‡ RPC æ‰¹é‡æäº¤åˆ° collector\njaegertracing/jaeger/cmd/agent/app/flags.go#L62\nvar defaultProcessors = []struct { model Model protocol Protocol port int }{ {model: \u0026#34;zipkin\u0026#34;, protocol: \u0026#34;compact\u0026#34;, port: 5775}, {model: \u0026#34;jaeger\u0026#34;, protocol: \u0026#34;compact\u0026#34;, port: 6831}, {model: \u0026#34;jaeger\u0026#34;, protocol: \u0026#34;binary\u0026#34;, port: 6832}, } jaegertracing/jaeger/cmd/agent/app/servers/tbuffered_server.go#L82\n// Serve initiates the readers and starts serving traffic func (s *TBufferedServer) Serve() { atomic.StoreUint32(\u0026amp;s.serving, 1) for s.IsServing() { readBuf := s.readBufPool.Get().(*ReadBuf) n, err := s.transport.Read(readBuf.bytes) if err == nil { readBuf.n = n s.metrics.PacketSize.Update(int64(n)) select { case s.dataChan \u0026lt;- readBuf: s.metrics.PacketsProcessed.Inc(1) s.updateQueueSize(1) default: s.metrics.PacketsDropped.Inc(1) } } else { s.metrics.ReadError.Inc(1) } } } jaegertracing/jaeger/blob/master/cmd/agent/app/processors/thrift_processor.go#L114\n// processBuffer reads data off the channel and puts it into a custom transport for // the processor to process func (s *ThriftProcessor) processBuffer() { for readBuf := range s.server.DataChan() { protocol := s.protocolPool.Get().(thrift.TProtocol) payload := readBuf.GetBytes() protocol.Transport().Write(payload) s.logger.Debug(\u0026#34;Span(s) received by the agent\u0026#34;, zap.Int(\u0026#34;bytes-received\u0026#34;, len(payload))) if ok, err := s.handler.Process(protocol, protocol); !ok { s.logger.Error(\u0026#34;Processor failed\u0026#34;, zap.Error(err)) s.metrics.HandlerProcessError.Inc(1) } s.protocolPool.Put(protocol) s.server.DataRecd(readBuf) // acknowledge receipt and release the buffer } } jaegertracing/jaeger/thrift-gen/agent/agent.go#L187\nfunc (p *agentProcessorEmitBatch) Process(seqId int32, iprot, oprot thrift.TProtocol) (success bool, err thrift.TException) { args := AgentEmitBatchArgs{} if err = args.Read(iprot); err != nil { iprot.ReadMessageEnd() return false, err } iprot.ReadMessageEnd() var err2 error if err2 = p.handler.EmitBatch(args.Batch); err2 != nil { return true, err2 } return true, nil } jaegertracing/jaeger/thrift-gen/jaeger/tchan-jaeger.go#L39\nCollector # æ¥æ”¶ Agent çš„æ•°æ® # jaegertracing/jaeger/cmd/collector/app/handler/thrift_span_handler.go#L60\næ¯”è¾ƒèˆ’æœçš„ç»´æŠ¤metricsçš„åœºæ™¯\nreferences # jaeger "},{"id":13,"href":"/posts/Architecture/opentracing/overview/","title":"Opentracing Overview","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šç®€å•ä»‹ç» opentracingï¼Œä»¥åŠæŠ€æœ¯é€‰å‹ã€‚\nåŸºç¡€åè¯ç†è§£ # spec-zh\nspec-office\nè¯­ä¹‰æƒ¯ä¾‹\nreferences # jaeger opentracing-contrib "},{"id":14,"href":"/posts/db/elastic/","title":"ElasticSearch","section":"Blog","content":"ElasticSearch æ•´ç†ä¸€ä¸‹çŸ¥è¯†ç‚¹\nElasticSearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œåº•å±‚ä½¿ç”¨ Lucene æ¥å®ç°å…¶æ ¸å¿ƒæœç´¢åŠŸèƒ½.å…¶æ ¸å¿ƒæ˜¯å…¨æ–‡æ£€ç´¢.\nå…¨æ–‡æ£€ç´¢ # å€’æ’ç´¢å¼• + TF-IDFä¸ºå…¨æ–‡æœç´¢çš„åŸºçŸ³ã€‚\nElasticSearch è¯ç”Ÿçš„èƒŒæ™¯ # å¤§è§„æ¨¡æ•°æ®å¦‚ä½•æ£€ç´¢ # å½“ç³»ç»Ÿæ•°æ®é‡ä¸Šäº† 10 äº¿ã€100 äº¿æ¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨åšç³»ç»Ÿæ¶æ„çš„æ—¶å€™é€šå¸¸ä¼šä»ä»¥ä¸‹è§’åº¦å»è€ƒè™‘é—®é¢˜ï¼š\nç”¨ä»€ä¹ˆæ•°æ®åº“å¥½ï¼Ÿ(mysqlã€postgresã€sybaseã€oracleã€è¾¾æ¢¦ã€ç¥é€šã€mongodbã€hbaseâ€¦) å¦‚ä½•è§£å†³å•ç‚¹æ•…éšœï¼›(lvsã€F5ã€A10ã€Zookeepã€MQ) å¦‚ä½•ä¿è¯æ•°æ®å®‰å…¨æ€§ï¼›(çƒ­å¤‡ã€å†·å¤‡ã€å¼‚åœ°å¤šæ´») å¦‚ä½•è§£å†³æ£€ç´¢éš¾é¢˜ï¼›(æ•°æ®åº“ä»£ç†ä¸­é—´ä»¶ï¼šmysql-proxyã€Cobarã€MaxScale ç­‰;) å¦‚ä½•è§£å†³ç»Ÿè®¡åˆ†æé—®é¢˜ï¼›(ç¦»çº¿ã€è¿‘å®æ—¶) ä¼ ç»Ÿæ•°æ®åº“çš„åº”å¯¹è§£å†³æ–¹æ¡ˆ # å¯¹äºå…³ç³»å‹æ•°æ®ï¼Œæˆ‘ä»¬é€šå¸¸é‡‡ç”¨ä»¥ä¸‹æˆ–ç±»ä¼¼æ¶æ„å»è§£å†³æŸ¥è¯¢ç“¶é¢ˆå’Œå†™å…¥ç“¶é¢ˆï¼š\né€šè¿‡ä¸»ä»å¤‡ä»½è§£å†³æ•°æ®å®‰å…¨æ€§é—®é¢˜ï¼› é€šè¿‡æ•°æ®åº“ä»£ç†ä¸­é—´ä»¶å¿ƒè·³ç›‘æµ‹ï¼Œè§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼› é€šè¿‡ä»£ç†ä¸­é—´ä»¶å°†æŸ¥è¯¢è¯­å¥åˆ†å‘åˆ°å„ä¸ª slave èŠ‚ç‚¹è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶æ±‡æ€»ç»“æœ éå…³ç³»å‹æ•°æ®åº“çš„è§£å†³æ–¹æ¡ˆ # å¯¹äº Nosql æ•°æ®åº“ï¼ŒåŸºæœ¬åŸç†ç±»ä¼¼ï¼š\né€šè¿‡å‰¯æœ¬å¤‡ä»½ä¿è¯æ•°æ®å®‰å…¨æ€§ï¼› é€šè¿‡èŠ‚ç‚¹ç«é€‰æœºåˆ¶è§£å†³å•ç‚¹é—®é¢˜ï¼› å…ˆä»é…ç½®åº“æ£€ç´¢åˆ†ç‰‡ä¿¡æ¯ï¼Œç„¶åå°†è¯·æ±‚åˆ†å‘åˆ°å„ä¸ªèŠ‚ç‚¹ï¼Œæœ€åç”±è·¯ç”±èŠ‚ç‚¹åˆå¹¶æ±‡æ€»ç»“æœ Elastic ç†è®ºçŸ¥è¯† # Elasticsearch vs mysql # Mysql -\u0026gt; database -\u0026gt; table -\u0026gt; rows -\u0026gt; columns Elasticsearch -\u0026gt; index -\u0026gt; type -\u0026gt; documents -\u0026gt; fields\nelastic åœ¨ 7.x ä¹‹åå°†å»æ‰ types, æ›¿ä»£æ–¹æ¡ˆï¼šindex per document type / custom type field\nES çš„ CRUD # èµ„æ–™\nç´¢å¼•æ–°æ–‡æ¡£ # å½“ç”¨æˆ·å‘ä¸€ä¸ªèŠ‚ç‚¹æäº¤äº†ä¸€ä¸ªç´¢å¼•æ–°æ–‡æ¡£çš„è¯·æ±‚ï¼ŒèŠ‚ç‚¹ä¼šè®¡ç®—æ–°æ–‡æ¡£åº”è¯¥åŠ å…¥åˆ°å“ªä¸ªåˆ†ç‰‡ï¼ˆshardï¼‰ä¸­ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½å­˜å‚¨æœ‰æ¯ä¸ªåˆ†ç‰‡å­˜å‚¨åœ¨å“ªä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œå› æ­¤åè°ƒèŠ‚ç‚¹ä¼šå°†è¯·æ±‚å‘é€ç»™å¯¹åº”çš„èŠ‚ç‚¹ã€‚æ³¨æ„è¿™ä¸ªè¯·æ±‚ä¼šå‘é€ç»™ä¸»åˆ†ç‰‡ï¼Œç­‰ä¸»åˆ†ç‰‡å®Œæˆç´¢å¼•ï¼Œä¼šå¹¶è¡Œå°†è¯·æ±‚å‘é€åˆ°å…¶æ‰€æœ‰å‰¯æœ¬åˆ†ç‰‡ï¼Œä¿è¯æ¯ä¸ªåˆ†ç‰‡éƒ½æŒæœ‰æœ€æ–°æ•°æ®ã€‚\næ¯æ¬¡å†™å…¥æ–°æ–‡æ¡£æ—¶ï¼Œéƒ½ä¼šå…ˆå†™å…¥å†…å­˜ä¸­ï¼Œå¹¶å°†è¿™ä¸€æ“ä½œå†™å…¥ä¸€ä¸ª translog æ–‡ä»¶ï¼ˆtransaction logï¼‰ä¸­ï¼Œæ­¤æ—¶å¦‚æœæ‰§è¡Œæœç´¢æ“ä½œï¼Œè¿™ä¸ªæ–°æ–‡æ¡£è¿˜ä¸èƒ½è¢«ç´¢å¼•åˆ°ã€‚\nES ä¼šæ¯éš” 1 ç§’æ—¶é—´ï¼ˆè¿™ä¸ªæ—¶é—´å¯ä»¥ä¿®æ”¹ï¼‰è¿›è¡Œä¸€æ¬¡åˆ·æ–°æ“ä½œï¼ˆrefreshï¼‰ï¼Œæ­¤æ—¶åœ¨è¿™ 1 ç§’æ—¶é—´å†…å†™å…¥å†…å­˜çš„æ–°æ–‡æ¡£éƒ½ä¼šè¢«å†™å…¥ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼ˆfilesystem cacheï¼‰ä¸­ï¼Œå¹¶æ„æˆä¸€ä¸ªåˆ†æ®µï¼ˆsegmentï¼‰ã€‚æ­¤æ—¶è¿™ä¸ª segment é‡Œçš„æ–‡æ¡£å¯ä»¥è¢«æœç´¢åˆ°ï¼Œä½†æ˜¯å°šæœªå†™å…¥ç¡¬ç›˜ï¼Œå³å¦‚æœæ­¤æ—¶å‘ç”Ÿæ–­ç”µï¼Œåˆ™è¿™äº›æ–‡æ¡£å¯èƒ½ä¼šä¸¢å¤±ã€‚\nä¸æ–­æœ‰æ–°çš„æ–‡æ¡£å†™å…¥ï¼Œåˆ™è¿™ä¸€è¿‡ç¨‹å°†ä¸æ–­é‡å¤æ‰§è¡Œã€‚æ¯éš”ä¸€ç§’å°†ç”Ÿæˆä¸€ä¸ªæ–°çš„ segmentï¼Œè€Œ translog æ–‡ä»¶å°†è¶Šæ¥è¶Šå¤§ã€‚æ¯éš” 30 åˆ†é’Ÿæˆ–è€… translog æ–‡ä»¶å˜å¾—å¾ˆå¤§ï¼Œåˆ™æ‰§è¡Œä¸€æ¬¡ fsync æ“ä½œã€‚æ­¤æ—¶æ‰€æœ‰åœ¨æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ä¸­çš„ segment å°†è¢«å†™å…¥ç£ç›˜ï¼Œè€Œ translog å°†è¢«åˆ é™¤ï¼ˆæ­¤åä¼šç”Ÿæˆæ–°çš„ translogï¼‰ã€‚\nç”±ä¸Šé¢çš„æµç¨‹å¯ä»¥çœ‹å‡ºï¼Œåœ¨ä¸¤æ¬¡ fsync æ“ä½œä¹‹é—´ï¼Œå­˜å‚¨åœ¨å†…å­˜å’Œæ–‡ä»¶ç³»ç»Ÿç¼“å­˜ä¸­çš„æ–‡æ¡£æ˜¯ä¸å®‰å…¨çš„ï¼Œä¸€æ—¦å‡ºç°æ–­ç”µè¿™äº›æ–‡æ¡£å°±ä¼šä¸¢å¤±ã€‚æ‰€ä»¥ ES å¼•å…¥äº† translog æ¥è®°å½•ä¸¤æ¬¡ fsync ä¹‹é—´æ‰€æœ‰çš„æ“ä½œï¼Œè¿™æ ·æœºå™¨ä»æ•…éšœä¸­æ¢å¤æˆ–è€…é‡æ–°å¯åŠ¨ï¼ŒES ä¾¿å¯ä»¥æ ¹æ® translog è¿›è¡Œè¿˜åŸã€‚\næ­¤å¤–ï¼Œç”±äºæ¯ä¸€ç§’å°±ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ segmentï¼Œå¾ˆå¿«å°†ä¼šæœ‰å¤§é‡çš„ segmentã€‚å¯¹äºä¸€ä¸ªåˆ†ç‰‡è¿›è¡ŒæŸ¥è¯¢è¯·æ±‚ï¼Œå°†ä¼šè½®æµæŸ¥è¯¢åˆ†ç‰‡ä¸­çš„æ‰€æœ‰ segmentï¼Œè¿™å°†é™ä½æœç´¢çš„æ•ˆç‡ã€‚å› æ­¤ ES ä¼šè‡ªåŠ¨å¯åŠ¨åˆå¹¶ segment çš„å·¥ä½œï¼Œå°†ä¸€éƒ¨åˆ†ç›¸ä¼¼å¤§å°çš„ segment åˆå¹¶æˆä¸€ä¸ªæ–°çš„å¤§ segmentã€‚åˆå¹¶çš„è¿‡ç¨‹å®é™…ä¸Šæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ segmentï¼Œå½“æ–° segment è¢«å†™å…¥ç£ç›˜ï¼Œæ‰€æœ‰è¢«åˆå¹¶çš„æ—§ segment è¢«æ¸…é™¤ã€‚\næ›´æ–°ï¼ˆUpdateï¼‰å’Œåˆ é™¤ï¼ˆDeleteï¼‰æ–‡æ¡£ # ES çš„ç´¢å¼•æ˜¯ä¸èƒ½ä¿®æ”¹çš„ï¼Œå› æ­¤æ›´æ–°å’Œåˆ é™¤æ“ä½œå¹¶ä¸æ˜¯ç›´æ¥åœ¨åŸç´¢å¼•ä¸Šç›´æ¥æ‰§è¡Œã€‚æ¯ä¸€ä¸ªç£ç›˜ä¸Šçš„ segment éƒ½ä¼šç»´æŠ¤ä¸€ä¸ª del æ–‡ä»¶ï¼Œç”¨æ¥è®°å½•è¢«åˆ é™¤çš„æ–‡ä»¶ã€‚æ¯å½“ç”¨æˆ·æå‡ºä¸€ä¸ªåˆ é™¤è¯·æ±‚ï¼Œæ–‡æ¡£å¹¶æ²¡æœ‰è¢«çœŸæ­£åˆ é™¤ï¼Œç´¢å¼•ä¹Ÿæ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œè€Œæ˜¯åœ¨ del æ–‡ä»¶ä¸­æ ‡è®°è¯¥æ–‡æ¡£å·²è¢«åˆ é™¤ã€‚å› æ­¤ï¼Œè¢«åˆ é™¤çš„æ–‡æ¡£ä¾ç„¶å¯ä»¥è¢«æ£€ç´¢åˆ°ï¼Œåªæ˜¯åœ¨è¿”å›æ£€ç´¢ç»“æœæ—¶è¢«è¿‡æ»¤æ‰äº†ã€‚æ¯æ¬¡åœ¨å¯åŠ¨ segment åˆå¹¶å·¥ä½œæ—¶ï¼Œé‚£äº›è¢«æ ‡è®°ä¸ºåˆ é™¤çš„æ–‡æ¡£æ‰ä¼šè¢«çœŸæ­£åˆ é™¤ã€‚\næ›´æ–°æ–‡æ¡£ä¼šé¦–å…ˆæŸ¥æ‰¾åŸæ–‡æ¡£ï¼Œå¾—åˆ°è¯¥æ–‡æ¡£çš„ç‰ˆæœ¬å·ã€‚ç„¶åå°†ä¿®æ”¹åçš„æ–‡æ¡£å†™å…¥å†…å­˜ï¼Œæ­¤è¿‡ç¨‹ä¸å†™å…¥ä¸€ä¸ªæ–°æ–‡æ¡£ç›¸åŒã€‚åŒæ—¶ï¼Œæ—§ç‰ˆæœ¬æ–‡æ¡£è¢«æ ‡è®°ä¸ºåˆ é™¤ï¼ŒåŒç†ï¼Œè¯¥æ–‡æ¡£å¯ä»¥è¢«æœç´¢åˆ°ï¼Œåªæ˜¯æœ€ç»ˆè¢«è¿‡æ»¤æ‰ã€‚\nè¯»æ“ä½œï¼ˆReadï¼‰ï¼šæŸ¥è¯¢è¿‡ç¨‹ # æŸ¥è¯¢é˜¶æ®µ # å½“ä¸€ä¸ªèŠ‚ç‚¹æ¥æ”¶åˆ°ä¸€ä¸ªæœç´¢è¯·æ±‚ï¼Œåˆ™è¿™ä¸ªèŠ‚ç‚¹å°±å˜æˆäº†åè°ƒèŠ‚ç‚¹ã€‚ç¬¬ä¸€æ­¥æ˜¯å¹¿æ’­è¯·æ±‚åˆ°ç´¢å¼•ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„åˆ†ç‰‡æ‹·è´ã€‚ æŸ¥è¯¢è¯·æ±‚å¯ä»¥è¢«æŸä¸ªä¸»åˆ†ç‰‡æˆ–æŸä¸ªå‰¯æœ¬åˆ†ç‰‡å¤„ç†ï¼Œåè°ƒèŠ‚ç‚¹å°†åœ¨ä¹‹åçš„è¯·æ±‚ä¸­è½®è¯¢æ‰€æœ‰çš„åˆ†ç‰‡æ‹·è´æ¥åˆ†æ‘Šè´Ÿè½½ã€‚\næ¯ä¸ªåˆ†ç‰‡å°†ä¼šåœ¨æœ¬åœ°æ„å»ºä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚å¦‚æœå®¢æˆ·ç«¯è¦æ±‚è¿”å›ç»“æœæ’åºä¸­ä»ç¬¬ from åå¼€å§‹çš„æ•°é‡ä¸º size çš„ç»“æœé›†ï¼Œåˆ™æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦ç”Ÿæˆä¸€ä¸ª from+size å¤§å°çš„ç»“æœé›†ï¼Œå› æ­¤ä¼˜å…ˆçº§é˜Ÿåˆ—çš„å¤§å°ä¹Ÿæ˜¯ from+sizeã€‚åˆ†ç‰‡ä»…ä¼šè¿”å›ä¸€ä¸ªè½»é‡çº§çš„ç»“æœç»™åè°ƒèŠ‚ç‚¹ï¼ŒåŒ…å«ç»“æœé›†ä¸­çš„æ¯ä¸€ä¸ªæ–‡æ¡£çš„ ID å’Œè¿›è¡Œæ’åºæ‰€éœ€è¦çš„ä¿¡æ¯ã€‚\nåè°ƒèŠ‚ç‚¹ä¼šå°†æ‰€æœ‰åˆ†ç‰‡çš„ç»“æœæ±‡æ€»ï¼Œå¹¶è¿›è¡Œå…¨å±€æ’åºï¼Œå¾—åˆ°æœ€ç»ˆçš„æŸ¥è¯¢æ’åºç»“æœã€‚æ­¤æ—¶æŸ¥è¯¢é˜¶æ®µç»“æŸã€‚\nå–å›é˜¶æ®µ # æŸ¥è¯¢è¿‡ç¨‹å¾—åˆ°çš„æ˜¯ä¸€ä¸ªæ’åºç»“æœï¼Œæ ‡è®°å‡ºå“ªäº›æ–‡æ¡£æ˜¯ç¬¦åˆæœç´¢è¦æ±‚çš„ï¼Œæ­¤æ—¶ä»ç„¶éœ€è¦è·å–è¿™äº›æ–‡æ¡£è¿”å›å®¢æˆ·ç«¯ã€‚\nåè°ƒèŠ‚ç‚¹ä¼šç¡®å®šå®é™…éœ€è¦è¿”å›çš„æ–‡æ¡£ï¼Œå¹¶å‘å«æœ‰è¯¥æ–‡æ¡£çš„åˆ†ç‰‡å‘é€ get è¯·æ±‚ï¼›åˆ†ç‰‡è·å–æ–‡æ¡£è¿”å›ç»™åè°ƒèŠ‚ç‚¹ï¼›åè°ƒèŠ‚ç‚¹å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚\nåˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç† # èµ„æºï¼Œæœ‰æºç åˆ†æ\nES é›†ç¾¤æ„æˆ # node.master node.data ä¸¤ä¸¤ç»„åˆæˆä¸åŒçš„èŠ‚ç‚¹\nèŠ‚ç‚¹å‘ç° # Master é€‰ä¸¾ # å¤šæ•°æ´¾åŸåˆ™ é€‰ä¸»\nreferences # elasticsearch cheatsheet Elasticsearch Reference Elasticsearchï¼åŸºç¡€ä»‹ç»åŠç´¢å¼•åŸç†åˆ†æ Choosing a fast unique identifier (UUID) for Lucene Elasticsearchæ¶æ„åŸç† Elasticsearchæ€§èƒ½ä¼˜åŒ– ElasticSearchè¯»å†™åº•å±‚åŸç†åŠæ€§èƒ½è°ƒä¼˜ "},{"id":15,"href":"/posts/high_performance/linux_epoll/","title":"Linux epoll","section":"Blog","content":"epoll é«˜æ€§èƒ½ network io æ¨¡å‹\nç”±äºå¤ªå¤š blog å·²ç»è®² epollï¼Œå†æ­¤å¼•ç”¨çœ‹çš„blogï¼Œä»¥åŠé¡¹ç›®ã€‚å¹¶æ ¹æ®è‡ªå·±çš„ç†è§£ï¼Œå®ç°å‡ºä¸€ä¸ª epoll å®ç°çš„ serverã€‚\nTODO: éœ€è¦è·Ÿä¸€æ­¥è®¾è®¡å®ç°è·¨å¹³å°çš„åºåˆ—åŒ–ååºåˆ—åŒ–æ–¹æ¡ˆï¼Œè¿›ä¸€æ­¥å®ç°åº”ç”¨å±‚éœ€æ±‚ã€‚\nepoll # é«˜æ€§èƒ½ å¼‚æ­¥io æ¨¡å‹ï¼Œåœ¨ Linux æ˜¯ epollï¼Œmac kqueueï¼Œwindows IOCP.\nApp: nginx, redis\nreferences # EPOLLçš„LINUXå†…æ ¸å·¥ä½œæœºåˆ¶ https://blog.lucode.net/linux/epoll-tutorial.html https://github.com/millken/c-example/blob/master/epoll-example.c https://www.suchprogramming.com/epoll-in-3-easy-steps/ https://medium.com/@copyconstruct/the-method-to-epolls-madness-d9d2d6378642 https://github.com/angrave/SystemProgramming/wiki/Networking,-Part-7:-Nonblocking-I-O,-select(),-and-epoll https://github.com/angrave/SystemProgramming/wiki https://jvns.ca/blog/2017/06/03/async-io-on-linux--select--poll--and-epoll simple http server base on epoll https://github.com/cloudwu/cstring camel # ä½¿ç”¨ linux epoll å®ç°çš„ socket server.\n"},{"id":16,"href":"/posts/db/how-fast-the-read-write/","title":"è¯»å†™æ“ä½œåˆ°åº•æœ‰å¤šæ…¢, æ“ä½œç³»ç»Ÿç›¸å…³ä¸€äº›å‚æ•°","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šLatency numbers every programmer should know\nL1 cache reference ......................... 0.5 ns Branch mispredict ............................ 5 ns L2 cache reference ........................... 7 ns Mutex lock/unlock ........................... 25 ns Main memory reference ...................... 100 ns Compress 1K bytes with Zippy ............. 3,000 ns = 3 Âµs Send 2K bytes over 1 Gbps network ....... 20,000 ns = 20 Âµs SSD random read ........................ 150,000 ns = 150 Âµs Read 1 MB sequentially from memory ..... 250,000 ns = 250 Âµs Round trip within same datacenter ...... 500,000 ns = 0.5 ms Read 1 MB sequentially from SSD* ..... 1,000,000 ns = 1 ms Disk seek ........................... 10,000,000 ns = 10 ms Read 1 MB sequentially from disk .... 20,000,000 ns = 20 ms Send packet CA-\u0026gt;Netherlands-\u0026gt;CA .... 150,000,000 ns = 150 ms src\n"},{"id":17,"href":"/posts/tools/dotfiles/","title":"æ•´ç†äº†ä¸€å¥— dotfiles è‡ªç”¨","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šè‡ªå·±çš„ dotfiles ä¾›è‡ªå·±ä½¿ç”¨ï¼Œå‡ ä¹ä¸€é”®æ¢æœº\nç®€ä»‹ # ä½¿ç”¨æ–¹æ³•\ngit clone https://github.com/exfly/dotfiles.git ~/.dotfiles cd ~/.dotfiles make preinstall-arch make bootstrap make install å¤‡æ³¨ # å¯¹äºæ‰€æœ‰çš„ *.zsh éƒ½ä¼šåŠ è½½åˆ° .zshrc ä¸­ï¼Œæ‰€æœ‰çš„ *.symlink éƒ½ä¼šå¯¹åº”çš„åœ¨$HOMEç”Ÿæˆä¸€ä¸ªè½¯è¿æ¥ .*, æ–‡ä»¶å¤¹ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡ŒåŠ è½½ã€‚\næ¯”å¦‚ zsh/zshrc.symlink ä¼šç”Ÿæˆè½¯è¿æ¥ $HOME/.zshrc,å…·ä½“å¦‚ä½•å·¥ä½œå¯ä»¥çœ‹ä¸€ä¸‹ script/bootstrap\nreferences # my dotfiles "},{"id":18,"href":"/posts/docker/comtainerd-cgroup-namespace/","title":"Comtainerd Cgroup Namespace","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šDocker Cgroup , Namespace , union fs è¿è¡Œæœºåˆ¶\nNamespaces # å‘½åç©ºé—´ (namespaces) æ˜¯ Linux ä¸ºæˆ‘ä»¬æä¾›çš„ç”¨äºåˆ†ç¦»è¿›ç¨‹æ ‘ã€ç½‘ç»œæ¥å£ã€æŒ‚è½½ç‚¹ä»¥åŠè¿›ç¨‹é—´é€šä¿¡ç­‰èµ„æºçš„æ–¹æ³•.\nLinux çš„å‘½åç©ºé—´æœºåˆ¶æä¾›äº†ä»¥ä¸‹ä¸ƒç§ä¸åŒçš„å‘½åç©ºé—´ï¼ŒåŒ…æ‹¬ CLONE_NEWCGROUPã€CLONE_NEWIPCã€CLONE_NEWNETã€CLONE_NEWNSã€CLONE_NEWPIDã€CLONE_NEWUSER å’Œ CLONE_NEWUTS(åˆ†åˆ«å¯¹åº” Cgroup, IPC, Network, Mount, PID, User, UTS)ï¼Œé€šè¿‡è¿™ä¸ƒä¸ªé€‰é¡¹æˆ‘ä»¬èƒ½åœ¨åˆ›å»ºæ–°çš„è¿›ç¨‹æ—¶è®¾ç½®æ–°è¿›ç¨‹åº”è¯¥åœ¨å“ªäº›èµ„æºä¸Šä¸å®¿ä¸»æœºå™¨è¿›è¡Œéš”ç¦»ã€‚\nthe Network namespace encapsulates system resources related to networking such as network interfaces (e.g wlan0, eth0), route tables etc, the Mount namespace encapsulates files and directories in the system, PID contains process IDs and so on. So two instances of a Network namespace A and B (corresponding to two boxes of the same type in our analogy) can contain different resources - maybe A contains wlan0 while B contains eth0 and a different route table copy \u0026ndash; related\n$ ls -l /proc/$$/ns total 0 lrwxrwxrwx 1 vagrant vagrant 0 Sep 19 00:46 cgroup -\u0026gt; \u0026#39;cgroup:[4026531835]\u0026#39; lrwxrwxrwx 1 vagrant vagrant 0 Sep 19 00:46 ipc -\u0026gt; \u0026#39;ipc:[4026531839]\u0026#39; lrwxrwxrwx 1 vagrant vagrant 0 Sep 19 00:46 mnt -\u0026gt; \u0026#39;mnt:[4026531840]\u0026#39; lrwxrwxrwx 1 vagrant vagrant 0 Sep 19 00:46 net -\u0026gt; \u0026#39;net:[4026531992]\u0026#39; lrwxrwxrwx 1 vagrant vagrant 0 Sep 19 00:46 pid -\u0026gt; \u0026#39;pid:[4026531836]\u0026#39; lrwxrwxrwx 1 vagrant vagrant 0 Sep 19 00:46 pid_for_children -\u0026gt; \u0026#39;pid:[4026531836]\u0026#39; lrwxrwxrwx 1 vagrant vagrant 0 Sep 19 00:46 user -\u0026gt; \u0026#39;user:[4026531837]\u0026#39; lrwxrwxrwx 1 vagrant vagrant 0 Sep 19 00:46 uts -\u0026gt; \u0026#39;uts:[4026531838]\u0026#39; $ sudo unshare -u bash $ ls -l /proc/$$/ns total 0 lrwxrwxrwx 1 root root 0 Sep 19 01:00 cgroup -\u0026gt; \u0026#39;cgroup:[4026531835]\u0026#39; lrwxrwxrwx 1 root root 0 Sep 19 01:00 ipc -\u0026gt; \u0026#39;ipc:[4026531839]\u0026#39; lrwxrwxrwx 1 root root 0 Sep 19 01:00 mnt -\u0026gt; \u0026#39;mnt:[4026531840]\u0026#39; lrwxrwxrwx 1 root root 0 Sep 19 01:00 net -\u0026gt; \u0026#39;net:[4026531992]\u0026#39; lrwxrwxrwx 1 root root 0 Sep 19 01:00 pid -\u0026gt; \u0026#39;pid:[4026531836]\u0026#39; lrwxrwxrwx 1 root root 0 Sep 19 01:00 pid_for_children -\u0026gt; \u0026#39;pid:[4026531836]\u0026#39; lrwxrwxrwx 1 root root 0 Sep 19 01:00 user -\u0026gt; \u0026#39;user:[4026531837]\u0026#39; lrwxrwxrwx 1 root root 0 Sep 19 01:00 uts -\u0026gt; \u0026#39;uts:[4026532239]\u0026#39; unshare ä¼šåœ¨ä¸€ä¸ªæ–°çš„ namespace æ‰§è¡Œæ–°çš„ç¨‹åºï¼Œflag -u æŒ‡å®šæ–°çš„ UTS namespace, sudo unshare -u bashå³æ˜¯åœ¨æ–°çš„UTSå‘½åç©ºé—´æ‰§è¡Œ bash\nlinux ä»¥é»˜è®¤çš„ namespace å¯åŠ¨æ–°çš„ç¨‹åºï¼Œé™¤éæ˜ç¡®çš„æŒ‡å®š\nuser namespace # P$ Q$ ä¸åŒçš„å­—æ¯ä»£è¡¨ä¸åŒçš„ user namespace\nP$ whoami vagrant P$ id uid=1000(vagrant) gid=1000(vagrant) groups=1000(vagrant),977(docker) P$ unshare -U bash # Enter a new shell that runs within a nested user namespace, the shell is bash which is your cmd shell C$ id uid=65534(nobody) gid=65534(nobody) groups=65534(nobody) C$ ls -l /proc/$pid/uid_map # the map file /proc/$pid/uid_map returns a mapping from UIDs in the user namespace to which the process pid belongsï¼Œ user_namespace linux man page\næ¯ä¸€è¡Œçš„æ ¼å¼ä¸º $fromID $toID $lengthï¼Œ\nC$ echo $$ 8683 # æ–°çš„ PID P$ echo $$ 7898 # åŸå§‹ PID C$ cat /proc/8683/uid_map C$ cat /proc/7898/uid_map 0 0 4294967295 P$ id uid=1000(vagrant) gid=1000(vagrant) groups=1000(vagrant),977(docker) P$ ip link add type veth RTNETLINK answers: Operation not permitted # åœ¨ä¸€ä¸ªä¸åŒçš„username å’Œ net namespaceä¸­å°è¯• P$ unshare -nU bash C$ ip link add type veth RTNETLINK answers: Operation not permitted C$ echo $$ 9078 P$ echo \u0026#34;0 1000 1\u0026#34; \u0026gt; /proc/9078/uid_map C$ id uid=0(root) gid=65534(nobody) groups=65534(nobody) C$ ip link add type veth # Success! P$ echo deny \u0026gt; /proc/9078/setgroups P$ echo \u0026#34;0 1000 1\u0026#34; \u0026gt; /proc/9078/gid_map C$ id uid=0(root) gid=0(root) groups=0(root),65534(nobody) mount namespace # cat /proc/$$/mounts proc /proc proc rw,nosuid,nodev,noexec,relatime 0 0 sys /sys sysfs rw,nosuid,nodev,noexec,relatime 0 0 dev /dev devtmpfs rw,nosuid,relatime,size=496792k,nr_inodes=124198,mode=755 0 0 run /run tmpfs rw,nosuid,nodev,relatime,mode=755 0 0 /dev/sda2 / btrfs rw,relatime,space_cache,subvolid=5,subvol=/ 0 0 securityfs /sys/kernel/security securityfs rw,nosuid,nodev,noexec,relatime 0 0 tmpfs /dev/shm tmpfs rw,nosuid,nodev 0 0 devpts /dev/pts devpts rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000 0 0 tmpfs /sys/fs/cgroup tmpfs ro,nosuid,nodev,noexec,mode=755 0 0 cgroup2 /sys/fs/cgroup/unified cgroup2 rw,nosuid,nodev,noexec,relatime,nsdelegate 0 0 cgroup /sys/fs/cgroup/systemd cgroup rw,nosuid,nodev,noexec,relatime,xattr,name=systemd 0 0 pstore /sys/fs/pstore pstore rw,nosuid,nodev,noexec,relatime 0 0 bpf /sys/fs/bpf bpf rw,nosuid,nodev,noexec,relatime,mode=700 0 0 cgroup /sys/fs/cgroup/cpuset cgroup rw,nosuid,nodev,noexec,relatime,cpuset 0 0 cgroup /sys/fs/cgroup/pids cgroup rw,nosuid,nodev,noexec,relatime,pids 0 0 cgroup /sys/fs/cgroup/perf_event cgroup rw,nosuid,nodev,noexec,relatime,perf_event 0 0 cgroup /sys/fs/cgroup/net_cls,net_prio cgroup rw,nosuid,nodev,noexec,relatime,net_cls,net_prio 0 0 cgroup /sys/fs/cgroup/rdma cgroup rw,nosuid,nodev,noexec,relatime,rdma 0 0 cgroup /sys/fs/cgroup/freezer cgroup rw,nosuid,nodev,noexec,relatime,freezer 0 0 cgroup /sys/fs/cgroup/cpu,cpuacct cgroup rw,nosuid,nodev,noexec,relatime,cpu,cpuacct 0 0 cgroup /sys/fs/cgroup/devices cgroup rw,nosuid,nodev,noexec,relatime,devices 0 0 cgroup /sys/fs/cgroup/blkio cgroup rw,nosuid,nodev,noexec,relatime,blkio 0 0 cgroup /sys/fs/cgroup/memory cgroup rw,nosuid,nodev,noexec,relatime,memory 0 0 cgroup /sys/fs/cgroup/hugetlb cgroup rw,nosuid,nodev,noexec,relatime,hugetlb 0 0 hugetlbfs /dev/hugepages hugetlbfs rw,relatime,pagesize=2M 0 0 configfs /sys/kernel/config configfs rw,nosuid,nodev,noexec,relatime 0 0 systemd-1 /proc/sys/fs/binfmt_misc autofs rw,relatime,fd=46,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pipe_ino=10711 0 0 mqueue /dev/mqueue mqueue rw,nosuid,nodev,noexec,relatime 0 0 debugfs /sys/kernel/debug debugfs rw,nosuid,nodev,noexec,relatime 0 0 tmpfs /tmp tmpfs rw,nosuid,nodev 0 0 tmpfs /run/user/1000 tmpfs rw,nosuid,nodev,relatime,size=100836k,mode=700,uid=1000,gid=1000 0 0 vagrant /vagrant vboxsf rw,relatime 0 0 mount point\n$ unshare -m bash $ cat /proc/$$/mounts /dev/sda2 / btrfs rw,relatime,space_cache,subvolid=5,subvol=/ 0 0 dev /dev devtmpfs rw,nosuid,relatime,size=496792k,nr_inodes=124198,mode=755 0 0 tmpfs /dev/shm tmpfs rw,nosuid,nodev 0 0 devpts /dev/pts devpts rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000 0 0 hugetlbfs /dev/hugepages hugetlbfs rw,relatime,pagesize=2M 0 0 mqueue /dev/mqueue mqueue rw,nosuid,nodev,noexec,relatime 0 0 proc /proc proc rw,nosuid,nodev,noexec,relatime 0 0 systemd-1 /proc/sys/fs/binfmt_misc autofs rw,relatime,fd=46,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pipe_ino=10711 0 0 sys /sys sysfs rw,nosuid,nodev,noexec,relatime 0 0 securityfs /sys/kernel/security securityfs rw,nosuid,nodev,noexec,relatime 0 0 tmpfs /sys/fs/cgroup tmpfs ro,nosuid,nodev,noexec,mode=755 0 0 cgroup2 /sys/fs/cgroup/unified cgroup2 rw,nosuid,nodev,noexec,relatime,nsdelegate 0 0 cgroup /sys/fs/cgroup/systemd cgroup rw,nosuid,nodev,noexec,relatime,xattr,name=systemd 0 0 cgroup /sys/fs/cgroup/cpuset cgroup rw,nosuid,nodev,noexec,relatime,cpuset 0 0 cgroup /sys/fs/cgroup/pids cgroup rw,nosuid,nodev,noexec,relatime,pids 0 0 cgroup /sys/fs/cgroup/perf_event cgroup rw,nosuid,nodev,noexec,relatime,perf_event 0 0 cgroup /sys/fs/cgroup/net_cls,net_prio cgroup rw,nosuid,nodev,noexec,relatime,net_cls,net_prio 0 0 cgroup /sys/fs/cgroup/rdma cgroup rw,nosuid,nodev,noexec,relatime,rdma 0 0 cgroup /sys/fs/cgroup/freezer cgroup rw,nosuid,nodev,noexec,relatime,freezer 0 0 cgroup /sys/fs/cgroup/cpu,cpuacct cgroup rw,nosuid,nodev,noexec,relatime,cpu,cpuacct 0 0 cgroup /sys/fs/cgroup/devices cgroup rw,nosuid,nodev,noexec,relatime,devices 0 0 cgroup /sys/fs/cgroup/blkio cgroup rw,nosuid,nodev,noexec,relatime,blkio 0 0 cgroup /sys/fs/cgroup/memory cgroup rw,nosuid,nodev,noexec,relatime,memory 0 0 cgroup /sys/fs/cgroup/hugetlb cgroup rw,nosuid,nodev,noexec,relatime,hugetlb 0 0 pstore /sys/fs/pstore pstore rw,nosuid,nodev,noexec,relatime 0 0 bpf /sys/fs/bpf bpf rw,nosuid,nodev,noexec,relatime,mode=700 0 0 configfs /sys/kernel/config configfs rw,nosuid,nodev,noexec,relatime 0 0 debugfs /sys/kernel/debug debugfs rw,nosuid,nodev,noexec,relatime 0 0 tracefs /sys/kernel/debug/tracing tracefs rw,nosuid,nodev,noexec,relatime 0 0 run /run tmpfs rw,nosuid,nodev,relatime,mode=755 0 0 tmpfs /run/user/1000 tmpfs rw,nosuid,nodev,relatime,size=100836k,mode=700,uid=1000,gid=1000 0 0 tmpfs /tmp tmpfs rw,nosuid,nodev 0 0 vagrant /vagrant vboxsf rw,relatime 0 0 è¯´æ˜ unshare -m bash å¹¶æ²¡æœ‰æŒ‰ç…§é¢„æœŸåœ¨æ–°çš„ mount namespace ä¸­è¿è¡Œ\næ‰€ä»¥ä¸ºäº†éªŒè¯mount namespace, æˆ‘ä»¬éœ€è¦åšå¦‚ä¸‹ä¸€äº›äº‹æƒ…:\nåˆ›å»ºå‘½ä»¤æ‰€éœ€çš„ä¾èµ–é¡¹å’Œç³»ç»Ÿæ–‡ä»¶çš„å‰¯æœ¬ åˆ›å»ºä¸€ä¸ªæ–°çš„ mount namespace å°†æ–°æŒ‚è½½å‘½åç©ºé—´ä¸­çš„æ ¹æ–‡ä»¶ç³»ç»Ÿæ›¿æ¢ä¸ºç”±æˆ‘ä»¬çš„ç³»ç»Ÿæ–‡ä»¶å‰¯æœ¬ç»„æˆçš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚ åœ¨æ–°çš„å®‰è£…åç§°ç©ºé—´å†…æ‰§è¡Œç¨‹åº è¿›è¡Œå®éªŒ # $ wget http://dl-cdn.alpinelinux.org/alpine/v3.10/releases/x86_64/alpine-minirootfs-3.10.1-x86_64.tar.gz $ mkdir rootfs $ tar -xzf alpine-minirootfs-3.10.1-x86_64.tar.gz -C rootfs $ ls rootfs $ ls rootfs/{mnt,dev,proc,home,sys} Pivot root # $ unshare -m bash $ mount --bind rootfs rootfs $ cd rootfs $ mkdir put_old $ pivot_root . put_old $ cd / # We should now have our new root. e.g if we: $ ls proc # proc is empty # And the old root is now in put_old $ ls put_old bin dev home lib lost+found mnt proc run srv tmp var boot etc initrd.img lib64 media opt root sbin sys usr vmlinuz $ /bin/busybox umount -l put_old # å¸è½½æ—§çš„æ–‡ä»¶ç³»ç»Ÿ $ mount -t proc proc proc/ åˆ°è¿™é‡Œï¼Œå·²ç»åˆ›å»ºäº†ä¸€ä¸ªéš”ç¦»çš„ rootfs\nè¿›ç¨‹ # $ ps -ef UID PID PPID C STIME TTY TIME CMD root 1 0 0 01:17 ? 00:00:00 /sbin/init root 2 0 0 01:17 ? 00:00:00 [kthreadd] root 3 2 0 01:17 ? 00:00:00 [rcu_gp] root 4 2 0 01:17 ? 00:00:00 [rcu_par_gp] root 5 2 0 01:17 ? 00:00:00 [kworker/0:0-events] root 6 2 0 01:17 ? 00:00:00 [kworker/0:0H-kblockd] root 7 2 0 01:17 ? 00:00:00 [kworker/u4:0-btrfs-endio-write] root 8 2 0 01:17 ? 00:00:00 [mm_percpu_wq] æœ‰ä¸¤ä¸ªè¿›ç¨‹å¾ˆç‰¹æ®Šï¼Œpid={1,2}, è¿™ä¸¤ä¸ªè¿›ç¨‹éƒ½æ˜¯è¢« Linux ä¸­çš„ä¸Šå¸è¿›ç¨‹ idle åˆ›å»ºå‡ºæ¥çš„\npid=1 çš„ /sbin/init, æ‰§è¡Œå†…æ ¸çš„ä¸€éƒ¨åˆ†åˆå§‹åŒ–å·¥ä½œå’Œç³»ç»Ÿé…ç½®ï¼Œä¹Ÿä¼šåˆ›å»ºä¸€äº›ç±»ä¼¼ getty çš„æ³¨å†Œè¿›ç¨‹ pid=2 çš„kthreadd, ç®¡ç†å’Œè°ƒåº¦å…¶ä»–çš„å†…æ ¸è¿›ç¨‹ ç½‘ç»œ # åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸€ä¸ªå®¹å™¨åœ¨åˆ›å»ºæ—¶éƒ½ä¼šåˆ›å»ºä¸€å¯¹è™šæ‹Ÿç½‘å¡ï¼Œä¸¤ä¸ªè™šæ‹Ÿç½‘å¡ç»„æˆäº†æ•°æ®çš„é€šé“ï¼Œå…¶ä¸­ä¸€ä¸ªä¼šæ”¾åœ¨åˆ›å»ºçš„å®¹å™¨ä¸­ï¼Œä¼šåŠ å…¥åˆ°åä¸º docker0 ç½‘æ¡¥ä¸­ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ç½‘æ¡¥çš„æ¥å£ï¼š\n$ brctl show bridge name bridge id STP enabled interfaces br-43ee5ed53f84 8000.024297630322 no docker0 8000.0242bf0282f8 no docker0 ä¼šä¸ºæ¯ä¸€ä¸ªå®¹å™¨åˆ†é…ä¸€ä¸ªæ–°çš„ IP åœ°å€å¹¶å°† docker0 çš„ IP åœ°å€è®¾ç½®ä¸ºé»˜è®¤çš„ç½‘å…³ã€‚ç½‘æ¡¥ docker0 é€šè¿‡ iptables ä¸­çš„é…ç½®ä¸å®¿ä¸»æœºå™¨ä¸Šçš„ç½‘å¡ç›¸è¿ï¼Œæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è¯·æ±‚éƒ½ä¼šé€šè¿‡ iptables è½¬å‘åˆ° docker0 å¹¶ç”±ç½‘æ¡¥åˆ†å‘ç»™å¯¹åº”çš„æœºå™¨ã€‚\n$ iptables -t nat -L Chain PREROUTING (policy ACCEPT) target prot opt source destination DOCKER all -- anywhere anywhere ADDRTYPE match dst-type LOCAL Chain DOCKER (2 references) target prot opt source destination RETURN all -- anywhere anywhere ip # $ ip link list 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 2: eth0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000 link/ether 08:00:27:d4:b6:c8 brd ff:ff:ff:ff:ff:ff 3: eth1: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc fq_codel state DOWN mode DEFAULT group default qlen 1000 link/ether 08:00:27:b7:f5:14 brd ff:ff:ff:ff:ff:ff $ ip netns add coke $ ip netns list coke ip netns list åªæ˜¾ç¤ºå‘½åçš„ netnsï¼Œåˆå§‹ netns æ˜¯éå‘½å netnsã€‚å¹¶ä¸”æ¯ä¸€ä¸ªå‘½å netns éƒ½ä¼šåœ¨/var/run/netnsåˆ›å»ºåŒåæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥è®©è¿›ç¨‹åˆ‡æ¢åˆ°æ­¤ netns\nC$ ä»£è¡¨åœ¨ä¸€ä¸ªå­å‘½åç©ºé—´ä¸­æ‰§è¡Œ\n$ ip netns exec coke bash C$ ip link list 1: lo: \u0026lt;LOOPBACK\u0026gt; mtu 65536 qdisc noop state DOWN mode DEFAULT group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 C$ ping 127.0.0.1 connect: Network is unreachable C$ ip link set dev lo up C$ ip link list 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 C$ ping 127.0.0.1 # OK ç°åœ¨åœ¨æ­¤ netns ä¸­åªå¯ä»¥ä¸åŒ netns çš„è¿›ç¨‹è¿›è¡Œæ²Ÿé€š(localhost),æˆ‘ä»¬å¯ä»¥å°è¯•ä¸ init netns çš„ç¨‹åºè¿›è¡Œæ²Ÿé€š\nVeth Devices # $ ip link add veth0 type veth peer name veth1 # # Create a veth pair (veth0 \u0026lt;=\u0026gt; veth1) $ ip link set veth1 netns coke # # Move the veth1 end to the new namespace C$ ip link list 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 7: veth1@if5: \u0026lt;BROADCAST,MULTICAST\u0026gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000 link/ether ee:16:0c:23:f3:af brd ff:ff:ff:ff:ff:ff link-netnsid 0 $ ip addr add 10.1.1.1/24 dev veth0 ç°åœ¨ veth1 è®¾å¤‡å·²ç»å¯ä»¥åœ¨ä¸¤ä¸ª netns ä¸­çœ‹åˆ°ï¼Œä¸ºäº†æ˜¯ä»–ä»¬éƒ½å¯ä»¥å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦ç»™å®ƒä»¬ä¸¤ä¸ªip addresses å’Œè®©interface up\n$ ip addr add 10.1.1.1/24 dev veth0 # In the initial namespace $ ip link set dev veth0 up C$ ip addr add 10.1.1.2/24 dev veth1 # # In the coke namespace C$ ip link set dev veth1 up C$ ip addr show veth1 4: veth1@if5: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc noqueue state UP group default qlen 1000 link/ether 1a:e7:9f:4e:d4:db brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 10.1.1.2/24 scope global veth1 valid_lft forever preferred_lft forever inet6 fe80::18e7:9fff:fe4e:d4db/64 scope link valid_lft forever preferred_lft forever ç°åœ¨ veth0 å’Œ veth1 å·²ç» up å’Œèµ‹äºˆäº† ip address 10.1.1.1 10.1.1.2\n$ ping -I veth0 10.1.1.2 C$ ping 10.1.1.1 netlink # libnetwork # chroot # https://www.ibm.com/developerworks/cn/linux/l-cn-chroot/index.html\nCGroups # https://www.ibm.com/developerworks/cn/linux/1506_cgroup/index.html\nUnionFS # docker export $(docker create busybox) | tar -C rootfs -xvf - AUFS overlay2\næŸ¥çœ‹ç³»ç»Ÿæ˜¯å¦æ”¯æŒç›¸åº”çš„æ–‡ä»¶ç³»ç»Ÿ\n$ uname -a Linux archlinux 5.1.15-arch1-1-ARCH #1 SMP PREEMPT Tue Jun 25 04:49:39 UTC 2019 x86_64 GNU/Linux $ grep btrfs /proc/filesystems btrfs æœ‰ä¸€äº›ç³»ç»Ÿè¿™ç§æ–¹å¼æ‰¾ä¸åˆ°å¯¹åº”çš„ç³»ç»Ÿï¼Œä½†æ˜¯åŒæ ·æ”¯æŒæ­¤æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚ archlinux å‘è¡Œç‰ˆï¼Œ Overlay_filesystem, overlay-docker-doc\n$ mkdir b0 b1 b2 upper work merged $ mount -t overlay overlay -o lowerdir=./b0:./b1:./b2,upperdir=./upper,workdir=./work ./merged overlay2 å°† lowerdirã€upperdirã€workdir è”åˆæŒ‚è½½ï¼Œå½¢æˆæœ€ç»ˆçš„ merged æŒ‚è½½ç‚¹ï¼Œå…¶ä¸­ lowerdir æ˜¯é•œåƒåªè¯»å±‚ï¼Œupperdir æ˜¯å®¹å™¨å¯è¯»å¯å†™å±‚ï¼Œworkdir æ˜¯æ‰§è¡Œæ¶‰åŠä¿®æ”¹ lowerdir æ‰§è¡Œ copy_up æ“ä½œçš„ä¸­è½¬å±‚ï¼ˆä¾‹å¦‚ï¼Œupperdir ä¸­ä¸å­˜åœ¨ï¼Œéœ€è¦ä» lowerdir ä¸­è¿›è¡Œå¤åˆ¶ï¼Œè¯¥è¿‡ç¨‹æš‚æœªè¯¦ç»†äº†è§£ï¼Œé‡åˆ°äº†å†åˆ†æï¼‰\n$ tree . â”œâ”€â”€ b0 â”œâ”€â”€ b1 â”œâ”€â”€ b2 â”œâ”€â”€ merged â”œâ”€â”€ README.md â”œâ”€â”€ upper â””â”€â”€ work â”œâ”€â”€ index â””â”€â”€ work è·å¾—çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯æœ‰å±‚æ¬¡çš„ï¼Œå½“å‰çš„å±‚æ¬¡å…³ç³»ä¸ºï¼š\n/upper /b0 /b1 /b2 $ echo \u0026#39;192.168.0.1\u0026#39; \u0026gt; b0/ip.txt $ tree . â”œâ”€â”€ b0 â”‚Â â””â”€â”€ ip.txt â”œâ”€â”€ b1 â”œâ”€â”€ b2 â”œâ”€â”€ merged â”‚Â â””â”€â”€ ip.txt â”œâ”€â”€ README.md â”œâ”€â”€ upper â””â”€â”€ work â”œâ”€â”€ index â””â”€â”€ work $ cat merged/ip.txt 192.168.0.1 $ echo \u0026#39;192.168.0.2\u0026#39; \u0026gt; merged/ip.txt $ tree . â”œâ”€â”€ b0 â”‚Â â””â”€â”€ ip.txt â”œâ”€â”€ b1 â”œâ”€â”€ b2 â”œâ”€â”€ merged â”‚Â â””â”€â”€ ip.txt â”œâ”€â”€ README.md â”œâ”€â”€ upper â”‚Â â””â”€â”€ ip.txt â””â”€â”€ work â”œâ”€â”€ index â””â”€â”€ work $ cat upper/ip.txt 192.168.0.2 $ echo \u0026#39;192.168.0.3\u0026#39; \u0026gt; upper/ip.txt $ cat merged/ip.txt 192.168.0.3 $ rm -rf merged/ip.txt $ tree . â”œâ”€â”€ b0 â”‚Â â””â”€â”€ ip.txt â”œâ”€â”€ b1 â”‚Â â””â”€â”€ ip.txt â”œâ”€â”€ b2 â”œâ”€â”€ merged â”œâ”€â”€ README.md â”œâ”€â”€ upper â”‚Â â””â”€â”€ ip.txt â””â”€â”€ work â”œâ”€â”€ index â””â”€â”€ work $ ls upper/ip.txt c--------- 1 root root 0, 0 Sep 18 04:35 upper/ip.txt references # container-lab\nhttps://draveness.me/docker\nè°ƒè¯•ç½‘ç»œ docker run -it --net container:vibrant_blackburn nicolaka/netshoot\nhttps://www.kernel.org/doc/Documentation/filesystems/overlayfs.txt\noverlayfsçš„ä¸€äº›é™åˆ¶/å…¼å®¹æ€§é—®é¢˜\nlinux-namespace-isolate-programing æœ‰ä¸€ä¸ªä¾‹å­ç¨‹åº\nNamespaces in operation\ncgroup/linux-man-page\nuser-namespace/linum-man-page\nmount namespaces\nproc special filesystem\nmanagement ip netns\nip command cheatsheet\nveth\nNetlink-doc\nman netlink\nA deep dive into Linux namespaces\n100ä¸ªå®¹å™¨å‘¨è¾¹é¡¹ç›®ï¼Œç‚¹äº®ä½ çš„å®¹å™¨é›†ç¾¤æŠ€èƒ½æ ‘\n"},{"id":19,"href":"/posts/Architecture/log/","title":"Log","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼š\u0008log\nåœ¨å¤šä¸ªç³»ç»Ÿç›¸äº’åä½œçš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸ºäº†èƒ½å¤Ÿä¿è¯å¼‚æ­¥ç³»ç»Ÿçš„åä½œæ˜¯å¦å·¥ä½œï¼Œéœ€è¦ä¸€å¥—æ—¥å¿—ç³»ç»Ÿä¿è¯ç³»ç»Ÿæ­£å¸¸çš„å·¥ä½œã€‚\nå·¥å…· # åº”ç”¨å†…æ—¥å¿—ï¼Œæ¯”å¦‚å¼€ä¸€ä¸ªæ–°çš„ log tableï¼Œå…¶ä¸­è®°å½•å…³é”®å…ƒæ•°æ®ï¼Œä»¥åŠä¸€äº›è¿”å›ç»“æœã€‚åº”ç”¨å†…æ—¥å¿—è®°å½•çš„å†…å®¹æœªæ¥å¯ä»¥ä½œä¸ºæ•°æ® migration çš„æœ‰æ•ˆå·¥å…·ï¼Œä¿è¯æ²¡æœ‰æˆåŠŸçš„æ“ä½œå¯ä»¥åœ¨æœªæ¥é‡è¯•ï¼Œä¿è¯ç³»ç»Ÿçš„æ•°æ®çš„å®Œæ•´ opentracing è·Ÿè¸ªè¯·æ±‚é“¾è·¯ï¼Œæ–¹ä¾¿ debug åˆ†å¸ƒå¼ç³»ç»Ÿã€‚ï¼ˆå…·ä½“å¦‚ä½•åšï¼Œä¹‹åè¡¥å…… TODO: flagï¼‰ elk ç³»åˆ— nginx æ—¥å¿— "},{"id":20,"href":"/posts/tools/git/","title":"Git","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šgit ç®€å•ä½¿ç”¨ï¼Œ åˆ†äº«ä¸€äº›èµ„æ–™\n\u0008references # å›¾è§£ Git Git äº¤äº’å¼å­¦ä¹ ç¯å¢ƒ-æ¼”ç¤º Git äº¤äº’å¼å­¦ä¹ ç¯å¢ƒ-å­¦ä¹ ä¸­ä½¿ç”¨ Google Engineering Practices Documentation Conventional Commits æœ‰å·¥å…·å¯ä»¥ç”Ÿæˆ changelog "},{"id":21,"href":"/posts/cs/linker/","title":"Linker","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šé“¾æ¥å™¨ å­¦ä¹ èµ„æº\né“¾æ¥å™¨ å­¦ä¹ èµ„æº\nreferences # Beginner\u0026rsquo;s Guide to Linkers-cn\nBeginner\u0026rsquo;s Guide to Linkers\nCppCon 2017: Nir Friedman â€œWhat C++ developers should know about globals (and the linker)â€\n"},{"id":22,"href":"/posts/Architecture/mq/","title":"æ¶ˆæ¯é˜Ÿåˆ—","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šæ¶ˆæ¯é˜Ÿåˆ—ä¸­éœ€è¦è§£å†³çš„é—®é¢˜\nç½‘ç»œé€šä¿¡å¯èƒ½ä¼šåŒ…å«ï¼ŒæˆåŠŸã€å¤±è´¥ä»¥åŠè¶…æ—¶ä¸‰ç§æƒ…å†µ\næ¶ˆæ¯æŠ•é€’è¯­ä¹‰ # æœ€å¤šä¸€æ¬¡ï¼ˆAt-Most Onceï¼‰ã€æœ€å°‘ä¸€æ¬¡ï¼ˆAt-Least Onceï¼‰ä»¥åŠæ°å¥½ä¸€æ¬¡ï¼ˆExactly Onceï¼‰\næœ€å¤šä¸€æ¬¡åœ¨ TCP/UDP ä¼ è¾“å±‚åè®®å°±æ˜¯ä¿è¯æœ€å¤šä¸€æ¬¡æ¶ˆæ¯æŠ•é€’ï¼Œæ¶ˆæ¯çš„å‘é€è€…åªä¼šå°è¯•å‘é€è¯¥æ¶ˆæ¯ä¸€æ¬¡ï¼Œå¹¶ä¸ä¼šå…³å¿ƒè¯¥æ¶ˆæ¯æ˜¯å¦å¾—åˆ°äº†è¿œç¨‹èŠ‚ç‚¹çš„å“åº”ã€‚ æœ€å°‘ä¸€æ¬¡å¼•å…¥è¶…æ—¶é‡è¯•çš„æœºåˆ¶ã€‚åŒæ—¶å¼•å…¥æ–°çš„é—®é¢˜ï¼Œæ¶ˆæ¯é‡å¤ã€‚ æ°å¥½ä¸€æ¬¡ä»ç†è®ºä¸Šæ¥è¯´ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æƒ³è¦è§£å†³æ¶ˆæ¯é‡å¤çš„é—®é¢˜æ˜¯ä¸å¯èƒ½çš„ï¼Œå¾ˆå¤šæ¶ˆæ¯æœåŠ¡æä¾›äº†æ­£å¥½ä¸€æ¬¡çš„ QoS å…¶å®æ˜¯åœ¨æ¥æ”¶ç«¯è¿›è¡Œäº†å»é‡ã€‚\næŠ•é€’é¡ºåº # ç”±äºä¸€äº›ç½‘ç»œçš„é—®é¢˜ï¼Œæ¶ˆæ¯åœ¨æŠ•é€’æ—¶å¯èƒ½ä¼šå‡ºç°é¡ºåºä¸ä¸€è‡´æ€§çš„æƒ…å†µï¼Œåœ¨ç½‘ç»œæ¡ä»¶éå¸¸ä¸ç¨³å®šæ—¶ï¼Œæˆ‘ä»¬å°±å¯èƒ½ä¼šé‡åˆ°æ¥æ”¶æ–¹å¤„ç†æ¶ˆæ¯çš„é¡ºåºå’Œç”Ÿäº§è€…æŠ•é€’çš„ä¸ä¸€è‡´ï¼›æ¶ˆè´¹è€…å°±éœ€è¦å¯¹é¡ºåºä¸ä¸€è‡´çš„æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œå¸¸è§çš„ä¸¤ç§æ–¹å¼å°±æ˜¯ä½¿ç”¨åºåˆ—å·æˆ–è€…çŠ¶æ€æœºã€‚\nåºåˆ—å· # ç”¨é˜»å¡çš„æ–¹å¼ä¿è¯åºåˆ—å·çš„é€’å¢æˆ–è€…å¿½ç•¥éƒ¨åˆ†ã€è¿‡æœŸã€çš„æ¶ˆæ¯ã€‚\nçŠ¶æ€æœº # è™½ç„¶æ¶ˆæ¯æŠ•é€’çš„é¡ºåºæ˜¯ä¹±åºçš„ï¼Œä½†æ˜¯èµ„æºæœ€ç»ˆè¿˜æ˜¯é€šè¿‡çŠ¶æ€æœºè¾¾åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„æ­£ç¡®çŠ¶æ€ï¼Œä¸ä¼šå‡ºç°ä¸ä¸€è‡´çš„é—®é¢˜ã€‚\nåè®® # AMQPï¼š StormMQã€RabbitMQï¼Œ æ”¯æŒæœ€å¤šä¸€æ¬¡å’Œæœ€å°‘ä¸€æ¬¡çš„æŠ•é€’è¯­ä¹‰ï¼Œå½“æˆ‘ä»¬é€‰æ‹©æœ€å°‘ä¸€æ¬¡æ—¶ï¼Œéœ€è¦å¹‚ç­‰æˆ–è€…é‡å…¥æœºåˆ¶ä¿è¯æ¶ˆæ¯é‡å¤ä¸ä¼šå‡ºç°é—®é¢˜ã€‚\nMQTT\nreference # åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°åŸç† åˆ†å¸ƒå¼ç³»ç»Ÿä¸æ¶ˆæ¯çš„æŠ•é€’ æµ…è°ˆæ•°æ®åº“å¹¶å‘æ§åˆ¶ - é”å’Œ MVCC æ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡çš„ç²¾é«“åŸºæœ¬éƒ½è—åœ¨æœ¬æ–‡é‡Œäº† æ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡ç²¾è¦ æ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡ç²¾è¦ "},{"id":23,"href":"/posts/Architecture/MicroServiceDesign/","title":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡é—®é¢˜ã€å¾®æœåŠ¡è®¾è®¡ç¬”è®° è„‘å›¾","section":"Blog","content":"é«˜å¯ç”¨ç³»ç»Ÿè®¾è®¡ï¼Œæœ‰å“ªäº›é—®é¢˜éœ€è¦è§£å†³\nä»€ä¹ˆæ˜¯é«˜å¯ç”¨ç³»ç»Ÿ # å…³äºé«˜å¯ç”¨çš„ç³»ç»Ÿ\né«˜å¯ç”¨ç³»ç»Ÿéœ€è¦è§£å†³çš„é—®é¢˜ # æŒ‘æˆ˜ # æˆå€çš„ API æ•°é‡ å¼•å…¥ç½‘ç»œå»¶è¿Ÿ CAP ç†è®ºï¼Œå¤„ç†è·¨å¤šä¸ªæœåŠ¡çš„äº‹åŠ¡å¤æ‚ è°ƒè¯•åˆ†å¸ƒå¼ç³»ç»Ÿååˆ†å¤æ‚ æœåŠ¡é›ªå´© å¤§é‡è¯·æ±‚å †ç§¯ï¼Œæ•…éšœæ¢å¤æ…¢ å¾®æœåŠ¡æŠ€æœ¯é€‰å‹ API ç‰ˆæœ¬ç®¡ç†æ··ä¹± TCCã€äº‹åŠ¡æ¶ˆæ¯é˜Ÿåˆ— éœ€è¦åšçš„äº‹ # å¯æ‰©å±•ï¼šæ°´å¹³æ‰©å±•ã€å‚ç›´æ‰©å±•ã€‚ é€šè¿‡å†—ä½™éƒ¨ç½²ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚ éš”ç¦»ï¼šé¿å…å•ä¸€ä¸šåŠ¡å ç”¨å…¨éƒ¨èµ„æºã€‚é¿å…ä¸šåŠ¡ä¹‹é—´çš„ç›¸äº’å½±å“ 2. æœºæˆ¿éš”ç¦»é¿å…å•ç‚¹æ•…éšœã€‚ è§£è€¦ï¼šé™ä½ç»´æŠ¤æˆæœ¬ï¼Œé™ä½è€¦åˆé£é™©ã€‚å‡å°‘ä¾èµ–ï¼Œå‡å°‘ç›¸äº’é—´çš„å½±å“ã€‚ é™æµï¼šæ»‘åŠ¨çª—å£è®¡æ•°æ³•ã€æ¼æ¡¶ç®—æ³•ã€ä»¤ç‰Œæ¡¶ç®—æ³•ç­‰ç®—æ³•ã€‚é‡åˆ°çªå‘æµé‡æ—¶ï¼Œä¿è¯ç³»ç»Ÿç¨³å®šã€‚ é™çº§ï¼šç´§æ€¥æƒ…å†µä¸‹é‡Šæ”¾éæ ¸å¿ƒåŠŸèƒ½çš„èµ„æºã€‚ç‰ºç‰²éæ ¸å¿ƒä¸šåŠ¡ï¼Œä¿è¯æ ¸å¿ƒä¸šåŠ¡çš„é«˜å¯ç”¨ã€‚ ç†”æ–­ï¼šå¼‚å¸¸æƒ…å†µè¶…å‡ºé˜ˆå€¼è¿›å…¥ç†”æ–­çŠ¶æ€ï¼Œå¿«é€Ÿå¤±è´¥ã€‚å‡å°‘ä¸ç¨³å®šçš„å¤–éƒ¨ä¾èµ–å¯¹æ ¸å¿ƒæœåŠ¡çš„å½±å“ã€‚ ç³»ç»Ÿç›‘æ§ï¼šå¯¹ CPU åˆ©ç”¨ç‡ï¼Œloadï¼Œå†…å­˜ï¼Œå¸¦å®½ï¼Œç³»ç»Ÿè°ƒç”¨é‡ï¼Œåº”ç”¨é”™è¯¯é‡ï¼ŒPVï¼ŒUV å’Œä¸šåŠ¡é‡è¿›è¡Œç›‘æ§ è‡ªåŠ¨åŒ–æµ‹è¯•ï¼šé€šè¿‡å®Œå–„çš„æµ‹è¯•ï¼Œå‡å°‘å‘å¸ƒå¼•èµ·çš„æ•…éšœã€‚ ç°åº¦å‘å¸ƒ(+å›æ»š)ï¼šç°åº¦å‘å¸ƒæ˜¯é€Ÿåº¦ä¸å®‰å…¨æ€§ä½œä¸ºå¦¥åï¼Œèƒ½å¤Ÿæœ‰æ•ˆå‡å°‘å‘å¸ƒæ•…éšœã€‚ å¼‚æ­¥æ¶ˆæ¯ç³»ç»Ÿ éœ€è¦æ·±å…¥çš„æŠ€æœ¯æ ˆ # åˆ†å¸ƒå¼ç³»ç»Ÿã€DevOpsã€åŸºç¡€æ¶æ„å³ä»£ç (IaC)ã€ä¸åŒç±»å‹çš„æ•°æ®åº“ã€å‰ç«¯ç»„ä»¶åŒ–å’Œå¤åˆåŒ–ã€å•å…ƒæµ‹è¯•ã€å…¨è‡ªåŠ¨å‘å¸ƒã€è¿­ä»£ã€å°ç‰ˆæœ¬å‘å¸ƒè®¡åˆ’ã€æµ‹è¯•å·¥å…·ã€å¤šç‰ˆæœ¬ç®¡ç†\nåˆ†å¸ƒå¼ä¸€è‡´æ€§ä¸å…±è¯†ç®—æ³• # Consensus from wiki, æ€»ç»“ä¸‹æ¥ä¸€è‡´æ€§å°±æ˜¯ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåœ¨ç»™å®šçš„ä¸€ç³»åˆ—æ“ä½œï¼Œå³ä½¿ç³»ç»Ÿå†…éƒ¨å‡ºé”™ï¼Œæœ€ç»ˆæ•´ä¸ªç³»ç»Ÿå¯¹å¤–æä¾›çš„æ•°æ®éƒ½æ˜¯å¯é çš„ã€‚åœ¨åè°ƒä¸€è‡´æ€§çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹äºä¸€ä¸ª Proposal æ•´ä¸ªç³»ç»Ÿè¾¾æˆå…±è¯†ï¼Œå…±è¯†ç®—æ³•èµ·ç€å¾ˆé‡è¦çš„ä½œç”¨ã€‚\nCAP # åŠ å·ä¼¯å…‹åˆ©å¤§å­¦çš„æ•™æˆ Eric Brewer è®ºæ–‡ Brewerâ€™s Conjecture and the Feasibility of Consistent, Available, Partition-Tolerant Web Services é˜è¿°äº† CAP ç†è®º CAP from wiki, è®ºæ–‡ä¸­æå‡ºçš„è§‚ç‚¹ï¼šåœ¨å¼‚æ­¥çš„ç½‘ç»œæ¨¡å‹ä¸­ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹ç”±äºæ²¡æœ‰æ—¶é’Ÿä»…ä»…èƒ½æ ¹æ®æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä½œå‡ºåˆ¤æ–­ï¼Œè¿™æ—¶å®Œå…¨ä¸èƒ½åŒæ—¶ä¿è¯ä¸€è‡´æ€§(Consistency)ã€å¯ç”¨æ€§(Availability)å’Œåˆ†åŒºå®¹é”™æ€§(Partition tolerance)ï¼Œæ¯ä¸€ä¸ªç³»ç»Ÿåªèƒ½åœ¨è¿™ä¸‰ç§ç‰¹æ€§ä¸­é€‰æ‹©ä¸¤ç§ã€‚ ç”±äºç½‘ç»œæœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œå¹¶ä¸èƒ½åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ—¶å€™é‡‡ç”¨æœ€ç»ˆä¸€è‡´æ€§çš„æ–¹å¼ï¼Œå®¹å¿ä¸€å®šæ—¶é—´å†…æ•°æ®ä¸ä¸€è‡´ï¼Œåœ¨ä¸€å®šçš„æ—¶é—´å†…ç³»ç»Ÿå†…éƒ¨å„èŠ‚ç‚¹å¯ä»¥åœ¨æœ‰é™çš„æ—¶é—´å†…è§£å†³å†²çªï¼Œä½¿æ•°æ®æ¢å¤å‡†ç¡®çš„çŠ¶æ€ã€‚\næ‹œå åº­å°†å†›é—®é¢˜ # æ‹œå åº­å°†å†›é—®é¢˜è®ºæ–‡\næ‹œå åº­å°†å†›é—®é¢˜æ˜¯å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿå®¹é”™çš„æœ€é«˜è¦æ±‚ï¼Œç„¶è€Œè¿™ä¸æ˜¯æ—¥å¸¸å·¥ä½œä¸­ä½¿ç”¨çš„å¤§å¤šæ•°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¼šé¢å¯¹çš„é—®é¢˜ï¼Œæˆ‘ä»¬é‡åˆ°æ›´å¤šçš„è¿˜æ˜¯èŠ‚ç‚¹æ•…éšœå®•æœºæˆ–è€…ä¸å“åº”ç­‰æƒ…å†µï¼Œè¿™å°±å¤§å¤§ç®€åŒ–äº†ç³»ç»Ÿå¯¹å®¹é”™çš„è¦æ±‚\nFLP # FLP ä¸å¯èƒ½å®šç†æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸæœ€é‡è¦çš„å®šç†ä¹‹ä¸€ï¼Œå®ƒç»™å‡ºäº†ä¸€ä¸ªéå¸¸é‡è¦çš„ç»“è®ºï¼šåœ¨ç½‘ç»œå¯é å¹¶ä¸”å­˜åœ¨èŠ‚ç‚¹å¤±æ•ˆçš„å¼‚æ­¥æ¨¡å‹ç³»ç»Ÿä¸­ï¼Œä¸å­˜åœ¨ä¸€ä¸ªå¯ä»¥è§£å†³ä¸€è‡´æ€§é—®é¢˜çš„ç¡®å®šæ€§ç®—æ³•ã€‚\nIn this paper, we show the surprising result that no completely asynchronous consensus protocol can tolerate even a single unannounced process death. We do not consider Byzantine failures, and we assume that the message system is reliable it delivers all messages correctly and exactly once.\nç›¸å…³è®ºæ–‡\nå…±è¯†ç®—æ³• # paxos, raft # åŒ…æ‹¬ Paxosã€Raft\nThe Raft Consensus Algorithm raft å·¥ä½œåŸç†åŠ¨å›¾\nPaxos ç®—æ³•éš¾ä»¥ç†è§£ã€éš¾ä»¥å®ç°ï¼Œéš¾é“ä»€ä¹ˆç¨‹åº¦å‘¢ï¼Ÿåœ¨ raft çš„è®ºæ–‡ä¸­æœ‰æåŠã€‚æ¯”å¦‚ zookeeper çš„ zab å°±æ˜¯åœ¨ paxos çš„åŸºç¡€ä¸Šè¿›è¡Œè®¾è®¡çš„ã€‚æ¯ä¸€ç§ Paxos çš„å®ç°ï¼Œéƒ½éœ€è¦é‡æ–°è®¾è®¡å®ç°ä¸€å¥—ç®—æ³•ã€‚è€Œ raft ç›¸å¯¹éš¾åº¦é™ä½å¾ˆå¤šã€‚ åŸºäº raft çš„ etcdï¼Œconsul ç­‰ã€‚\nPOW(Proof-of-Work) # æ— è®ºæ˜¯ Paxos è¿˜æ˜¯ Raft å…¶å®éƒ½åªèƒ½è§£å†³éæ‹œå åº­å°†å†›å®¹é”™çš„ä¸€è‡´æ€§é—®é¢˜ï¼Œä¸èƒ½å¤Ÿåº”å¯¹åˆ†å¸ƒå¼ç½‘ç»œä¸­å‡ºç°çš„æç«¯æƒ…å†µï¼Œä½†æ˜¯è¿™åœ¨ä¼ ç»Ÿçš„åˆ†å¸ƒå¼ç³»ç»Ÿéƒ½ä¸æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œæ— è®ºæ˜¯åˆ†å¸ƒå¼æ•°æ®åº“è¿˜æ˜¯æ¶ˆæ¯é˜Ÿåˆ—é›†ç¾¤ï¼Œå®ƒä»¬å†…éƒ¨çš„èŠ‚ç‚¹å¹¶ä¸ä¼šæ•…æ„çš„å‘é€é”™è¯¯ä¿¡æ¯ï¼Œåœ¨ç±»ä¼¼ç³»ç»Ÿä¸­ï¼Œæœ€å¸¸è§çš„é—®é¢˜å°±æ˜¯èŠ‚ç‚¹å¤±å»å“åº”æˆ–è€…å¤±æ•ˆï¼Œæ‰€ä»¥å®ƒä»¬åœ¨è¿™ç§å‰æä¸‹æ˜¯æœ‰æ•ˆå¯è¡Œçš„ï¼Œä¹Ÿæ˜¯å……åˆ†çš„ã€‚\nå·¥ä½œé‡è¯æ˜æ˜¯ä¸€ä¸ªç”¨äºé˜»æ­¢æ‹’ç»æœåŠ¡æ”»å‡»å’Œç±»ä¼¼åƒåœ¾é‚®ä»¶ç­‰æœåŠ¡é”™è¯¯é—®é¢˜çš„åè®®\nPOS(Proof-of-Stake) # æƒç›Šè¯æ˜æ˜¯åŒºå—é“¾ç½‘ç»œä¸­çš„ä½¿ç”¨çš„å¦ä¸€ç§å…±è¯†ç®—æ³•ï¼Œåœ¨åŸºäºæƒç›Šè¯æ˜çš„å¯†ç è´§å¸ä¸­ï¼Œä¸‹ä¸€ä¸ªåŒºå—çš„é€‰æ‹©æ˜¯æ ¹æ®ä¸åŒèŠ‚ç‚¹çš„è‚¡ä»½å’Œæ—¶é—´è¿›è¡Œéšæœºé€‰æ‹©çš„ã€‚\nDPOS(Delegated Proof-of-Stake) # ã€Šå¾®æœåŠ¡è®¾è®¡ã€‹è„‘å›¾ # è„‘å›¾å¦‚ä¸‹ï¼š è„‘å›¾åœ°å€ references # åç«¯æ¶æ„å¸ˆæŠ€æœ¯å›¾è°±\nhystrix\nbilibili/kratos\nGo Microservices blog series\nmicroservices-in-golang\nshippy-demo\n20 ä¸ªå¥½ç”¨çš„ Go è¯­è¨€å¾®æœåŠ¡å¼€å‘æ¡†æ¶\nmicro/micro\nmicro/go-micro\nCAP theorem\ngrpc-example\nåˆ†å¸ƒå¼ä¸€è‡´æ€§ä¸å…±è¯†ç®—æ³•\n"},{"id":24,"href":"/posts/db/log/","title":"The Log: What every software engineer should know about real-time data's unifying abstraction ç¿»è¯‘","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šç¿»è¯‘ The Log: What every software engineer should know about real-time data\u0026rsquo;s unifying abstraction\næ­£æ–‡ # å…­å¹´å‰æˆ‘åœ¨ä¸€ä¸ªç‰¹åˆ«æœ‰è¶£çš„æ—¶é—´åŠ å…¥äº† LinkedInã€‚ æˆ‘ä»¬åˆšåˆšå¼€å§‹é‡åˆ°å•ä½“é›†ä¸­å¼æ•°æ®åº“çš„æé™ï¼Œéœ€è¦å¼€å§‹å‘åˆ†å¸ƒå¼ç³»ç»Ÿè¿‡æ¸¡ã€‚ è¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„ç»å†ï¼šæˆ‘ä»¬æ„å»ºï¼Œéƒ¨ç½²å¹¶è¿è¡Œåˆ†å¸ƒå¼å›¾å½¢æ•°æ®åº“ï¼Œåˆ†å¸ƒå¼æœç´¢åç«¯ï¼ŒHadoop å®‰è£…ä»¥åŠç¬¬ä¸€ä»£å’Œç¬¬äºŒä»£é”®å€¼å­˜å‚¨ä¸€ç›´åˆ°ä»Šå¤©ã€‚\næˆ‘åœ¨è¿™ä¸€åˆ‡ä¸­å­¦åˆ°çš„æœ€æœ‰ç”¨çš„ä¸œè¥¿ä¹‹ä¸€å°±æ˜¯æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„è®¸å¤šä¸œè¥¿éƒ½æœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„æ¦‚å¿µï¼šæ—¥å¿—ã€‚ æœ‰æ—¶ç§°ä¸ºé¢„å†™æ—¥å¿—æˆ–æäº¤æ—¥å¿—æˆ–äº‹åŠ¡æ—¥å¿—ï¼Œæ—¥å¿—å‡ ä¹ä¸è®¡ç®—æœºä¸€æ ·é•¿ï¼Œå¹¶ä¸”æ˜¯è®¸å¤šåˆ†å¸ƒå¼æ•°æ®ç³»ç»Ÿå’Œå®æ—¶åº”ç”¨ç¨‹åºä½“ç³»ç»“æ„çš„æ ¸å¿ƒã€‚\nåœ¨ä¸äº†è§£æ—¥å¿—çš„æƒ…å†µä¸‹ï¼Œæ‚¨æ— æ³•å®Œå…¨ç†è§£æ•°æ®åº“ï¼ŒNoSQL å­˜å‚¨ï¼Œé”®å€¼å­˜å‚¨ï¼Œå¤åˆ¶ï¼Œpaxosï¼Œhadoopï¼Œç‰ˆæœ¬æ§åˆ¶æˆ–å‡ ä¹ä»»ä½•è½¯ä»¶ç³»ç»Ÿ; ç„¶è€Œï¼Œå¤§å¤šæ•°è½¯ä»¶å·¥ç¨‹å¸ˆå¹¶ä¸ç†Ÿæ‚‰å®ƒä»¬ã€‚ æˆ‘æƒ³æ”¹å˜è¿™ä¸€ç‚¹ã€‚ åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å‘æ‚¨ä»‹ç»æœ‰å…³æ—¥å¿—çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ—¥å¿—ä»¥åŠå¦‚ä½•ä½¿ç”¨æ—¥å¿—è¿›è¡Œæ•°æ®é›†æˆï¼Œå®æ—¶å¤„ç†å’Œç³»ç»Ÿæ„å»ºã€‚\nPart One: What is Log # A log is perhaps the simplest possible storage abstraction. It is an append-only, totally-ordered sequence of records ordered by time.\nè®°å½•é™„åŠ åˆ°æ—¥å¿—çš„æœ«å°¾ï¼Œè¯»å–ä»å·¦åˆ°å³è¿›è¡Œã€‚ æ¯ä¸ªæ¡ç›®éƒ½åˆ†é…æœ‰å”¯ä¸€çš„é¡ºåºæ—¥å¿—æ¡ç›®å·ã€‚\nè®°å½•çš„é¡ºåºå®šä¹‰äº†â€œæ—¶é—´â€çš„æ¦‚å¿µï¼Œå› ä¸ºå·¦è¾¹çš„æ¡ç›®è¢«å®šä¹‰ä¸ºæ¯”å³è¾¹çš„æ¡ç›®æ›´æ—§ã€‚ æ—¥å¿—æ¡ç›®å·å¯ä»¥è¢«è®¤ä¸ºæ˜¯æ¡ç›®çš„â€œæ—¶é—´æˆ³â€ã€‚ å°†è¿™ç§æ’åºæè¿°ä¸ºæ—¶é—´æ¦‚å¿µèµ·åˆçœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼Œä½†å®ƒå…·æœ‰ä¸ä»»ä½•ç‰¹å®šç‰©ç†æ—¶é’Ÿåˆ†ç¦»çš„ä¾¿åˆ©ç‰¹æ€§ã€‚ å½“æˆ‘ä»¬è¿›å…¥åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œæ­¤å±æ€§å°†å˜å¾—è‡³å…³é‡è¦ã€‚\nå‡ºäºæœ¬è®¨è®ºçš„ç›®çš„ï¼Œè®°å½•çš„å†…å®¹å’Œæ ¼å¼å¹¶ä¸é‡è¦ã€‚ æ­¤å¤–ï¼Œæˆ‘ä»¬ä¸èƒ½åªæ˜¯ç»§ç»­å‘æ—¥å¿—æ·»åŠ è®°å½•ï¼Œå› ä¸ºæˆ‘ä»¬æœ€ç»ˆå°†è€—å°½ç©ºé—´ã€‚ æˆ‘ä¼šç¨å¾®å›è¿‡å¤´æ¥çœ‹çœ‹ã€‚\nå› æ­¤ï¼Œæ—¥å¿—ä¸æ–‡ä»¶æˆ–è¡¨æ ¼å®Œå…¨ä¸åŒã€‚ æ–‡ä»¶æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œä¸€ä¸ªè¡¨æ˜¯ä¸€ä¸ªè®°å½•æ•°ç»„ï¼Œä¸€ä¸ªæ—¥å¿—å®é™…ä¸Šåªæ˜¯ä¸€ç§è¡¨æˆ–æ–‡ä»¶ï¼Œå…¶ä¸­è®°å½•æŒ‰æ—¶é—´æ’åºã€‚\nåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæ‚¨å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆå€¼å¾—è°ˆè®ºè¿™ä¹ˆç®€å•çš„äº‹æƒ…ï¼Ÿ å¦‚ä½•ä»¥ä»…é™„åŠ çš„è®°å½•åºåˆ—ä¸æ•°æ®ç³»ç»Ÿç›¸å…³è”ï¼Ÿ ç­”æ¡ˆæ˜¯æ—¥å¿—æœ‰ä¸€ä¸ªç‰¹å®šçš„ç›®çš„ï¼šå®ƒä»¬è®°å½•å‘ç”Ÿçš„äº‹æƒ…å’Œæ—¶é—´ã€‚ å¯¹äºåˆ†å¸ƒå¼æ•°æ®ç³»ç»Ÿï¼Œè¿™åœ¨è®¸å¤šæ–¹é¢éƒ½æ˜¯é—®é¢˜çš„æ ¸å¿ƒã€‚\nä½†åœ¨æˆ‘ä»¬èµ°å¾—å¤ªè¿œä¹‹å‰ï¼Œè®©æˆ‘æ¾„æ¸…ä¸€äº›æœ‰ç‚¹ä»¤äººå›°æƒ‘çš„äº‹æƒ…ã€‚ æ¯ä¸ªç¨‹åºå‘˜éƒ½ç†Ÿæ‚‰å¦ä¸€ä¸ªæ—¥å¿—è®°å½•å®šä¹‰ - åº”ç”¨ç¨‹åºå¯èƒ½ä½¿ç”¨ syslog æˆ– log4j å†™å…¥æœ¬åœ°æ–‡ä»¶çš„éç»“æ„åŒ–é”™è¯¯æ¶ˆæ¯æˆ–è·Ÿè¸ªä¿¡æ¯ã€‚ ä¸ºæ¸…æ¥šèµ·è§ï¼Œæˆ‘å°†å…¶ç§°ä¸ºâ€œåº”ç”¨ç¨‹åºæ—¥å¿—è®°å½•â€ã€‚ åº”ç”¨ç¨‹åºæ—¥å¿—æ˜¯æˆ‘æè¿°çš„æ—¥å¿—æ¦‚å¿µçš„é€€åŒ–å½¢å¼ã€‚ æœ€å¤§çš„åŒºåˆ«æ˜¯æ–‡æœ¬æ—¥å¿—ä¸»è¦æ˜¯ä¾›äººé˜…è¯»ï¼Œè€Œæˆ‘æ‰€æè¿°çš„â€œæ—¥å¿—â€æˆ–â€œæ•°æ®æ—¥å¿—â€æ˜¯ä¸ºç¼–ç¨‹è®¿é—®è€Œæ„å»ºçš„ã€‚\nï¼ˆå®é™…ä¸Šï¼Œå¦‚æœä½ å¯¹å®ƒè¿›è¡Œæ·±å…¥çš„æ€è€ƒï¼Œé‚£ä¹ˆäººä»¬è¯»å–æŸä¸ªæœºå™¨ä¸Šçš„æ—¥å¿—è¿™ç§ç†å¿µæœ‰äº›ä¸é¡ºåº”æ—¶ä»£ã€‚å½“æ¶‰åŠåˆ°è®¸å¤šæœåŠ¡å’ŒæœåŠ¡å™¨çš„æ—¶å€™ï¼Œè¿™ç§æ–¹æ³•å¾ˆå¿«å°±å˜æˆä¸€ä¸ªéš¾äºç®¡ç†çš„æ–¹å¼ï¼Œè€Œä¸”ä¸ºäº†è®¤è¯†å¤šä¸ªæœºå™¨çš„è¡Œä¸ºï¼Œæ—¥å¿—çš„ç›®æ ‡å¾ˆå¿«å°±å˜æˆæŸ¥è¯¢å’Œå›¾å½¢åŒ–è¿™äº›è¡Œä¸ºçš„è¾“å…¥äº†-å¯¹å¤šä¸ªæœºå™¨çš„æŸäº›è¡Œä¸ºè€Œè¨€ï¼Œæ–‡ä»¶é‡Œçš„è‹±æ–‡å½¢å¼çš„æ–‡æœ¬åŒè¿™å„¿æ‰€æè¿°çš„è¿™ç§ç»“æ„åŒ–çš„æ—¥å¿—ç›¸æ¯”å‡ ä¹å°±ä¸é€‚åˆäº†ã€‚ï¼‰\nLogs in databases # æˆ‘ä¸çŸ¥é“æ—¥å¿—æ¦‚å¿µçš„èµ·æº - å¯èƒ½æ˜¯äºŒå…ƒæœç´¢è¿™æ ·çš„äº‹æƒ…ä¹‹ä¸€ï¼Œå¯¹äºå‘æ˜è€…æ¥è¯´å¤ªç®€å•äº†ï¼Œä¸èƒ½å‘ç°å®ƒæ˜¯ä¸€é¡¹å‘æ˜ã€‚ å®ƒæ—©åœ¨ IBM çš„ System R å°±å·²å­˜åœ¨ã€‚æ•°æ®åº“ä¸­çš„ä½¿ç”¨ä¸åœ¨å‡ºç°å´©æºƒæ—¶ä¿æŒåŒæ­¥çš„å„ç§æ•°æ®ç»“æ„å’Œç´¢å¼•æœ‰å…³ã€‚ ä¸ºäº†ä½¿è¿™ç§åŸå­æ€§å’ŒæŒä¹…æ€§ï¼Œæ•°æ®åº“ä½¿ç”¨æ—¥å¿—æ¥å†™å‡ºæœ‰å…³ä»–ä»¬å°†è¦ä¿®æ”¹çš„è®°å½•çš„ä¿¡æ¯ï¼Œç„¶åå°†æ›´æ”¹åº”ç”¨äºå®ƒç»´æŠ¤çš„æ‰€æœ‰å„ç§æ•°æ®ç»“æ„ã€‚ æ—¥å¿—æ˜¯å‘ç”Ÿçš„äº‹ä»¶çš„è®°å½•ï¼Œæ¯ä¸ªè¡¨æˆ–ç´¢å¼•æ˜¯å°†è¯¥å†å²è®°å½•æŠ•å½±åˆ°ä¸€äº›æœ‰ç”¨çš„æ•°æ®ç»“æ„æˆ–ç´¢å¼•ä¸­ã€‚ ç”±äºæ—¥å¿—ä¼šç«‹å³ä¿ç•™ï¼Œå› æ­¤åœ¨å´©æºƒæ—¶å°†å…¶ç”¨ä½œæ¢å¤æ‰€æœ‰å…¶ä»–æŒä¹…æ€§ç»“æ„çš„æƒå¨æ¥æºã€‚\néšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ—¥å¿—çš„ä½¿ç”¨ä» ACID çš„å®ç°ç»†èŠ‚å‘å±•åˆ°åœ¨æ•°æ®åº“ä¹‹é—´å¤åˆ¶æ•°æ®çš„æ–¹æ³•ã€‚ äº‹å®è¯æ˜ï¼Œæ•°æ®åº“ä¸Šå‘ç”Ÿçš„æ›´æ”¹é¡ºåºæ­£æ˜¯ä¿æŒè¿œç¨‹å‰¯æœ¬æ•°æ®åº“åŒæ­¥æ‰€éœ€çš„ã€‚ Oracleï¼ŒMySQL å’Œ PostgreSQL åŒ…æ‹¬æ—¥å¿—ä¼ é€åè®®ï¼Œç”¨äºå°†éƒ¨åˆ†æ—¥å¿—ä¼ è¾“åˆ°å……å½“ä»å±æœåŠ¡å™¨çš„å‰¯æœ¬æ•°æ®åº“ã€‚ Oracle å·²å°†æ—¥å¿—äº§å“åŒ–ä¸ºé oracle æ•°æ®è®¢é˜…è€…çš„é€šç”¨æ•°æ®è®¢é˜…æœºåˆ¶ï¼Œå…¶ XStreamå’Œ GoldenGateä»¥åŠ MySQL å’Œ PostgreSQL ä¸­çš„ç±»ä¼¼å·¥å…·æ˜¯è®¸å¤šæ•°æ®æ¶æ„çš„å…³é”®ç»„ä»¶ã€‚\nç”±äºè¿™ä¸ªèµ·æºï¼Œæœºå™¨å¯è¯»æ—¥å¿—çš„æ¦‚å¿µä¸»è¦å±€é™äºæ•°æ®åº“å†…éƒ¨ã€‚ ä½¿ç”¨æ—¥å¿—ä½œä¸ºæ•°æ®è®¢é˜…çš„æœºåˆ¶ä¼¼ä¹å‡ ä¹æ˜¯å¶ç„¶å‡ºç°çš„ã€‚ ä½†è¿™ç§æŠ½è±¡æ˜¯æ”¯æŒå„ç§æ¶ˆæ¯ä¼ é€’ï¼Œæ•°æ®æµå’Œå®æ—¶æ•°æ®å¤„ç†çš„ç†æƒ³é€‰æ‹©ã€‚\nLogs in distributed systems # æ—¥å¿—è§£å†³çš„ä¸¤ä¸ªé—®é¢˜ - æ’åºæ›´æ”¹(ordering changes)å’Œåˆ†å‘æ•°æ®(distributing data) - åœ¨åˆ†å¸ƒå¼æ•°æ®ç³»ç»Ÿä¸­æ›´ä¸ºé‡è¦ã€‚ åŒæ„è®¢è´­æ›´æ–°ï¼ˆæˆ–åŒæ„ä¸åŒæ„å’Œåº”å¯¹å‰¯ä½œç”¨ï¼‰æ˜¯è¿™äº›ç³»ç»Ÿçš„æ ¸å¿ƒè®¾è®¡é—®é¢˜ã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿçš„ä»¥æ—¥å¿—ä¸ºä¸­å¿ƒçš„æ–¹æ³•æºäºä¸€ä¸ªç®€å•çš„è®¨è®ºï¼Œæˆ‘ç§°ä¹‹ä¸ºçŠ¶æ€æœºå¤åˆ¶åŸåˆ™ï¼š\nIf two identical, deterministic processes begin in the same state and get the same inputs in the same order, they will produce the same output and end in the same state.\nå¦‚æœä¸¤ä¸ªç›¸åŒçš„ç¡®å®šæ€§è¿‡ç¨‹ä»¥ç›¸åŒçš„çŠ¶æ€å¼€å§‹å¹¶ä»¥ç›¸åŒçš„é¡ºåºè·å¾—ç›¸åŒçš„è¾“å…¥ï¼Œåˆ™å®ƒä»¬å°†äº§ç”Ÿç›¸åŒçš„è¾“å‡ºå¹¶ä»¥ç›¸åŒçš„çŠ¶æ€ç»“æŸã€‚\nè¿™å¯èƒ½çœ‹èµ·æ¥æœ‰ç‚¹éš¾æ‡‚çš„(obtuse)ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬æ·±å…¥äº†è§£å®ƒçš„å«ä¹‰ã€‚\nDeterministic(ç¡®å®šæ€§)æ„å‘³ç€å¤„ç†ä¸ä¾èµ–äºæ—¶é—´ï¼Œå¹¶ä¸”ä¸å…è®¸ä»»ä½•å…¶ä»–â€œå¤–éƒ¨çš„â€è¾“å…¥å½±å“å…¶ç»“æœã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªç¨‹åºçš„è¾“å‡ºå—åˆ°çº¿ç¨‹æ‰§è¡Œçš„ç‰¹å®šé¡ºåºçš„å½±å“ï¼Œæˆ–è€…é€šè¿‡è°ƒç”¨ gettimeofday æˆ–å…¶ä»–ä¸€äº›ä¸å¯é‡å¤çš„ä¸œè¥¿ï¼Œé€šå¸¸è¢«è®¤ä¸ºæ˜¯éç¡®å®šæ€§çš„ã€‚\nè¿›ç¨‹çš„ state çŠ¶æ€æ˜¯å¤„ç†ç»“æŸæ—¶æœºå™¨ä¸Šçš„ä»»ä½•æ•°æ®ï¼Œæ— è®ºæ˜¯åœ¨å†…å­˜ä¸­è¿˜æ˜¯åœ¨ç£ç›˜ä¸Šã€‚\nä»¥ç›¸åŒçš„é¡ºåºè·å¾—ç›¸åŒè¾“å…¥çš„åœ°æ–¹åº”å½“å¼•èµ·æ³¨æ„-è¿™å°±æ˜¯å¼•å…¥æ—¥å¿—çš„åœ°æ–¹ã€‚è¿™å„¿æœ‰ä¸€ä¸ªé‡è¦çš„å¸¸è¯†ï¼šå¦‚æœç»™ä¸¤æ®µç¡®å®šæ€§ä»£ç ç›¸åŒçš„æ—¥å¿—è¾“å…¥ï¼Œé‚£ä¹ˆå®ƒä»¬å°±ä¼šç”Ÿæˆç›¸åŒçš„è¾“å‡ºã€‚\nåˆ†å¸ƒå¼è®¡ç®—è¿™æ–¹é¢çš„åº”ç”¨å°±æ ¼å¤–æ˜æ˜¾ã€‚ä½ å¯ä»¥æŠŠç”¨å¤šå°æœºå™¨ä¸€èµ·æ‰§è¡ŒåŒä¸€ä»¶äº‹æƒ…çš„é—®é¢˜ç¼©å‡ä¸ºå®ç°åˆ†å¸ƒå¼ä¸€è‡´æ€§æ—¥å¿—ä¸ºè¿™äº›è¿›ç¨‹è¾“å…¥çš„é—®é¢˜ã€‚è¿™æ—¥å¿—çš„ç›®çš„æ˜¯æŠŠæ‰€æœ‰éç¡®å®šæ€§çš„ä¸œè¥¿æ’é™¤åœ¨è¾“å…¥æµä¹‹å¤–ï¼Œæ¥ç¡®ä¿æ¯ä¸ªå¤åˆ¶è¿›ç¨‹èƒ½å¤ŸåŒæ­¥åœ°å¤„ç†è¾“å…¥ã€‚\nå½“ä½ ç†è§£äº†è¿™ä¸ªä»¥åï¼ŒçŠ¶æ€æœºå¤åˆ¶åŸç†å°±ä¸å†å¤æ‚æˆ–è€…è¯´ä¸å†æ·±å¥¥äº†ï¼šè¿™æˆ–å¤šæˆ–å°‘çš„æ„å‘³ç€\u0026quot;deterministic processing is deterministic\u0026quot;(ç¡®å®šæ€§çš„å¤„ç†è¿‡ç¨‹å°±æ˜¯ç¡®å®šæ€§çš„)ã€‚ä¸ç®¡æ€æ ·ï¼Œæˆ‘éƒ½è®¤ä¸ºå®ƒæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡é‡Œè¾ƒå¸¸ç”¨çš„å·¥å…·ä¹‹ä¸€ã€‚\nè¿™ç§æ–¹å¼çš„ä¸€ä¸ªç¾å¦™ä¹‹å¤„å°±åœ¨äºç´¢å¼•æ—¥å¿—çš„æ—¶é—´æˆ³å°±åƒæ—¶é’ŸçŠ¶æ€çš„ä¸€ä¸ªå‰¯æœ¬â€”â€”ä½ å¯ä»¥ç”¨ä¸€ä¸ªå•ç‹¬çš„æ•°å­—æè¿°æ¯ä¸€ä¸ªå‰¯æœ¬ï¼Œè¿™å°±æ˜¯ç»è¿‡å¤„ç†çš„æ—¥å¿—çš„æ—¶é—´æˆ³ã€‚æ—¶é—´æˆ³ä¸æ—¥å¿—ä¸€ä¸€å¯¹åº”ç€æ•´ä¸ªå‰¯æœ¬çš„çŠ¶æ€ã€‚\nç”±äºå†™è¿›æ—¥å¿—çš„å†…å®¹çš„ä¸åŒï¼Œä¹Ÿå°±æœ‰è®¸å¤šåœ¨ç³»ç»Ÿä¸­åº”ç”¨è¿™ä¸ªåŸåˆ™çš„ä¸åŒæ–¹å¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è®°å½•ä¸€ä¸ªæœåŠ¡çš„è¯·æ±‚ï¼Œæˆ–è€…æœåŠ¡ä»è¯·æ±‚åˆ°å“åº”çš„çŠ¶æ€å˜åŒ–ï¼Œæˆ–è€…å®ƒæ‰§è¡Œå‘½ä»¤çš„è½¬æ¢ã€‚ç†è®ºä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ä¸ºæ¯ä¸€ä¸ªå‰¯æœ¬è®°å½•ä¸€ç³»åˆ—è¦æ‰§è¡Œçš„æœºå™¨æŒ‡ä»¤æˆ–è€…è°ƒç”¨çš„æ–¹æ³•åå’Œå‚æ•°ã€‚åªè¦ä¸¤ä¸ªè¿›ç¨‹ç”¨ç›¸åŒçš„æ–¹å¼å¤„ç†è¿™äº›è¾“å…¥ï¼Œè¿™äº›è¿›ç¨‹å°±ä¼šä¿æŒå‰¯æœ¬çš„ä¸€è‡´æ€§ã€‚\nä¸€åƒä¸ªäººçœ¼ä¸­æœ‰ä¸€åƒç§æ—¥å¿—çš„ç”¨æ³•ã€‚æ•°æ®åº“å·¥ä½œè€…é€šå¸¸åŒºåˆ†ç‰©ç†æ—¥å¿—å’Œé€»è¾‘æ—¥å¿—ã€‚ç‰©ç†æ—¥å¿—å°±æ˜¯è®°å½•æ¯ä¸€è¡Œè¢«æ”¹å˜çš„å†…å®¹ã€‚é€»è¾‘æ—¥å¿—è®°å½•çš„ä¸æ˜¯æ”¹å˜çš„è¡Œè€Œæ˜¯é‚£äº›å¼•èµ·è¡Œçš„å†…å®¹è¢«æ”¹å˜çš„ SQL è¯­å¥ï¼ˆinsertï¼Œupdate å’Œ delete è¯­å¥ï¼‰ã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿé€šå¸¸å¯ä»¥å®½æ³›åˆ†ä¸ºä¸¤ç§æ–¹æ³•æ¥å¤„ç†æ•°æ®å’Œå®Œæˆå“åº”ã€‚â€œçŠ¶æ€æœºå™¨æ¨¡å‹â€é€šå¸¸å¼•ç”¨ä¸€ä¸ªä¸»åŠ¨-ä¸»åŠ¨çš„æ¨¡å‹â€”â€”ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸ºä¹‹è®°å½•è¯·æ±‚å’Œå“åº”çš„å¯¹è±¡ã€‚å¯¹æ­¤è¿›è¡Œä¸€ä¸ªç»†å¾®çš„æ›´æ”¹ï¼Œç§°ä¹‹ä¸ºâ€œä¸»å¤‡æ¨¡å‹â€ï¼Œå°±æ˜¯é€‰å‡ºä¸€ä¸ªå‰¯æœ¬åšä¸º leaderï¼Œå¹¶å…è®¸å®ƒæŒ‰ç…§è¯·æ±‚åˆ°è¾¾çš„æ—¶é—´æ¥è¿›è¡Œå¤„ç†å¹¶ä»å¤„ç†è¿‡ç¨‹ä¸­è¾“å‡ºè®°å½•å…¶çŠ¶æ€æ”¹å˜çš„æ—¥å¿—ã€‚å…¶ä»–çš„å‰¯æœ¬æŒ‰ç…§ leader çŠ¶æ€æ”¹å˜çš„é¡ºåºè€Œåº”ç”¨é‚£äº›æ”¹å˜ï¼Œè¿™æ ·ä»–ä»¬ä¹‹é—´è¾¾åˆ°åŒæ­¥ï¼Œå¹¶èƒ½å¤Ÿåœ¨ leader å¤±è´¥çš„æ—¶å€™æ¥æ›¿ leader çš„å·¥ä½œã€‚\nä¸ºäº†ç†è§£ä¸¤ç§æ–¹å¼çš„ä¸åŒï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¸å¤ªä¸¥è°¨çš„ä¾‹å­ã€‚å‡å®šæœ‰ä¸€ä¸ªç®—æ³•æœåŠ¡çš„å‰¯æœ¬ï¼Œä¿æŒä¸€ä¸ªç‹¬ç«‹çš„æ•°å­—ä½œä¸ºå®ƒçš„çŠ¶æ€ï¼ˆåˆå§‹å€¼ä¸º 0ï¼‰ï¼Œå¹¶å¯¹è¿™ä¸ªå€¼è¿›è¡ŒåŠ æ³•å’Œä¹˜æ³•è¿ç®—ã€‚ä¸»åŠ¨-ä¸»åŠ¨æ–¹å¼åº”è¯¥ä¼šè¾“å‡ºæ‰€è¿›è¡Œçš„å˜æ¢ï¼Œæ¯”å¦‚â€œ+1â€ï¼Œâ€œ*2â€ç­‰ã€‚æ¯ä¸€ä¸ªå‰¯æœ¬éƒ½ä¼šåº”ç”¨è¿™äº›å˜æ¢ï¼Œä»è€Œå¾—åˆ°åŒæ ·çš„è§£é›†ã€‚ä¸»åŠ¨-è¢«åŠ¨æ–¹å¼å°†ä¼šæœ‰ä¸€ä¸ªç‹¬ç«‹çš„ä¸»ä½“æ‰§è¡Œè¿™äº›å˜æ¢å¹¶è¾“å‡ºç»“æœæ—¥å¿—ï¼Œæ¯”å¦‚â€œ1â€ï¼Œâ€œ3â€ï¼Œâ€œ6â€ç­‰ã€‚è¿™ä¸ªä¾‹å­ä¹Ÿæ¸…æ¥šçš„å±•ç¤ºäº†ä¸ºä»€ä¹ˆè¯´é¡ºåºæ˜¯ä¿è¯å„å‰¯æœ¬é—´ä¸€è‡´æ€§çš„å…³é”®ï¼šä¸€æ¬¡åŠ æ³•å’Œä¹˜æ³•çš„é¡ºåºçš„æ”¹å˜å°†ä¼šå¯¼è‡´ä¸åŒçš„ç»“æœã€‚\nåˆ†å¸ƒå¼æ—¥å¿—å¯ä»¥ç†è§£ä¸ºä¸€è‡´æ€§é—®é¢˜æ¨¡å‹çš„æ•°æ®ç»“æ„ã€‚å› ä¸ºæ—¥å¿—ä»£è¡¨äº†åç»­è¿½åŠ å€¼çš„ä¸€ç³»åˆ—å†³ç­–ã€‚ä½ éœ€è¦é‡æ–°å®¡è§† Paxos ç®—æ³•ç°‡ï¼Œå°½ç®¡æ—¥å¿—æ¨¡å—æ˜¯ä»–ä»¬æœ€å¸¸è§çš„åº”ç”¨ã€‚ åœ¨ Paxos ç®—æ³•ä¸­ï¼Œå®ƒé€šå¸¸é€šè¿‡ä½¿ç”¨ç§°ä¹‹ä¸ºå¤š paxos çš„åè®®ï¼Œè¿™ç§åè®®å°†æ—¥å¿—å»ºæ¨¡ä¸ºä¸€ç³»åˆ—çš„é—®é¢˜ï¼Œåœ¨æ—¥å¿—ä¸­æ¯ä¸ªé—®é¢˜éƒ½æœ‰å¯¹åº”çš„éƒ¨åˆ†ã€‚åœ¨ ZABï¼Œ Raftç­‰å…¶å®ƒçš„åè®®ä¸­ï¼Œæ—¥å¿—çš„ä½œç”¨å°¤ä¸ºçªå‡ºï¼Œå®ƒç›´æ¥å¯¹ç»´æŠ¤åˆ†å¸ƒå¼çš„ã€ä¸€è‡´æ€§çš„æ—¥å¿—çš„é—®é¢˜å»ºæ¨¡ã€‚\næˆ‘æ€€ç–‘çš„æ˜¯ï¼Œæˆ‘ä»¬å°±å†å²å‘å±•çš„è§‚ç‚¹æ˜¯æœ‰åå·®çš„ï¼Œå¯èƒ½æ˜¯ç”±äºè¿‡å»çš„å‡ åå¹´ä¸­ï¼Œåˆ†å¸ƒå¼è®¡ç®—çš„ç†è®ºè¿œè¶…è¿‡äº†å…¶å®é™…åº”ç”¨ã€‚åœ¨ç°å®ä¸­ï¼Œå…±è¯†çš„é—®é¢˜æ˜¯æœ‰ç‚¹å¤ªç®€å•äº†ã€‚è®¡ç®—æœºç³»ç»Ÿå¾ˆå°‘éœ€è¦å†³å®šå•ä¸ªå€¼ï¼Œä»–ä»¬å‡ ä¹æ€»æ˜¯å¤„ç†æˆåºåˆ—çš„è¯·æ±‚ã€‚è¿™æ ·çš„è®°å½•ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç®€å•çš„å•å€¼å¯„å­˜å™¨ï¼Œè‡ªç„¶æ˜¯æ›´åŠ æŠ½è±¡ã€‚\næ­¤å¤–ï¼Œä¸“æ³¨äºç®—æ³•æ©ç›–äº† æŠ½è±¡ç³»ç»Ÿéœ€è¦çš„åº•å±‚çš„æ—¥å¿—ã€‚æˆ‘æ€€ç–‘ï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šæŠŠæ—¥å¿—ä¸­æ›´æ³¨é‡ä½œä¸ºä¸€ä¸ªå•†å“åŒ–çš„åŸºçŸ³ï¼Œä¸è®ºå…¶æ˜¯å¦ä»¥åŒæ ·çš„æ–¹å¼ å®æ–½çš„ï¼Œæˆ‘ä»¬ç»å¸¸è°ˆè®ºä¸€ä¸ªå“ˆå¸Œè¡¨è€Œä¸æ˜¯çº ç»“æˆ‘ä»¬ å¾—åˆ°æ˜¯ä¸æ˜¯å…·ä½“æŸä¸ªç»†èŠ‚çš„å“ˆå¸Œè¡¨ï¼Œä¾‹å¦‚çº¿æ€§æˆ–è€…å¸¦æœ‰ä»€ä¹ˆä»€ä¹ˆå…¶å®ƒå˜ä½“å“ˆå¸Œè¡¨ã€‚æ—¥å¿—å°†æˆä¸ºä¸€ç§å¤§ä¼—åŒ–çš„æ¥å£ï¼Œä¸ºå¤§å¤šæ•°ç®—æ³•å’Œå…¶å®ç°æå‡æä¾›æœ€å¥½çš„ä¿è¯å’Œæœ€ä½³çš„æ€§èƒ½ã€‚\nChangelog 101: Tables and Events are Dual # è®©æˆ‘ä»¬ç»§ç»­èŠæ•°æ®åº“ã€‚æ•°æ®åº“ä¸­å­˜åœ¨ç€å¤§é‡å˜æ›´æ—¥å¿—å’Œè¡¨ä¹‹é—´çš„äºŒç›¸æ€§ã€‚è¿™äº›æ—¥å¿—æœ‰ç‚¹ç±»ä¼¼å€Ÿè´·æ¸…å•å’Œé“¶è¡Œçš„æµç¨‹ï¼Œæ•°æ®åº“è¡¨å°±æ˜¯å½“å‰çš„ç›ˆä½™è¡¨ã€‚å¦‚æœä½ æœ‰å¤§é‡çš„å˜æ›´æ—¥å¿—ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨è¿™äº›å˜æ›´ç”¨ä»¥åˆ›å»ºæ•è·å½“å‰çŠ¶æ€çš„è¡¨ã€‚è¿™å¼ è¡¨å°†è®°å½•æ¯ä¸ªå…³é”®ç‚¹ï¼ˆæ—¥å¿—ä¸­ä¸€ä¸ªç‰¹åˆ«çš„æ—¶é—´ç‚¹ï¼‰çš„çŠ¶æ€ä¿¡æ¯ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ—¥å¿—æ˜¯éå¸¸åŸºæœ¬çš„æ•°æ®ç»“æ„çš„æ„ä¹‰æ‰€åœ¨ï¼šæ—¥å¿—å¯ç”¨æ¥åˆ›å»ºåŸºæœ¬è¡¨ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥åˆ›å»ºå„ç±»è¡ç”Ÿè¡¨ã€‚åŒæ—¶æ„å‘³ç€å¯ä»¥å­˜å‚¨éå…³ç³»å‹çš„å¯¹è±¡ã€‚\nè¿™ä¸ªæµç¨‹ä¹Ÿæ˜¯å¯é€†çš„ï¼šå¦‚æœä½ æ­£åœ¨å¯¹ä¸€å¼ è¡¨è¿›è¡Œæ›´æ–°ï¼Œä½ å¯ä»¥è®°å½•è¿™äº›å˜æ›´ï¼Œå¹¶æŠŠæ‰€æœ‰æ›´æ–°çš„æ—¥å¿—å‘å¸ƒåˆ°è¡¨çš„çŠ¶æ€ä¿¡æ¯ä¸­ã€‚è¿™äº›å˜æ›´æ—¥å¿—å°±æ˜¯ä½ æ‰€éœ€è¦çš„æ”¯æŒå‡†å®æ—¶çš„å…‹éš†ã€‚åŸºäºæ­¤ï¼Œä½ å°±å¯ä»¥æ¸…æ¥šçš„ç†è§£è¡¨ä¸äº‹ä»¶çš„äºŒç›¸æ€§ï¼š è¡¨æ”¯æŒäº†é™æ€æ•°æ®è€Œæ—¥å¿—æ•è·å˜æ›´ã€‚æ—¥å¿—çš„é­…åŠ›å°±åœ¨äºå®ƒæ˜¯å˜æ›´çš„å®Œæ•´è®°å½•ï¼Œå®ƒä¸ä»…ä»…æ•è·äº†è¡¨çš„æœ€ç»ˆç‰ˆæœ¬çš„å†…å®¹ï¼Œå®ƒè¿˜è®°å½•äº†æ›¾ç»å­˜åœ¨è¿‡çš„å…¶å®ƒç‰ˆæœ¬çš„ä¿¡æ¯ã€‚æ—¥å¿—å®è´¨ä¸Šæ˜¯è¡¨å†å²çŠ¶æ€çš„ä¸€ç³»åˆ—å¤‡ä»½ã€‚\nè¿™å¯èƒ½ä¼šå¼•èµ·ä½ å¯¹æºä»£ç çš„ç‰ˆæœ¬ç®¡ç†ã€‚æºä»£ç ç®¡ç†å’Œæ•°æ®åº“ä¹‹é—´æœ‰å¯†åˆ‡å…³ç³»ã€‚ç‰ˆæœ¬ç®¡ç†è§£å†³äº†ä¸€ä¸ªå¤§å®¶éå¸¸ç†Ÿæ‚‰çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼æ•°æ®ç³»ç»Ÿéœ€è¦è§£å†³çš„\u0026mdash; æ—¶æ—¶åˆ»åˆ»åœ¨å˜åŒ–ç€çš„åˆ†å¸ƒå¼ç®¡ç†ã€‚ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿé€šå¸¸ä»¥è¡¥ä¸çš„å‘å¸ƒä¸ºåŸºç¡€ï¼Œè¿™å®é™…ä¸Šå¯èƒ½æ˜¯ä¸€ä¸ªæ—¥å¿—ã€‚æ‚¨å¯ä»¥ç›´æ¥å¯¹å½“å‰ ç±»ä¼¼äºè¡¨ä¸­çš„ä»£ç åšå‡ºâ€œå¿«ç…§â€äº’åŠ¨ã€‚ä½ ä¼šæ³¨æ„åˆ°ï¼Œ ä¸å…¶ä»–åˆ†å¸ƒå¼çŠ¶æ€åŒ–ç³»ç»Ÿç±»ä¼¼ï¼Œç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ å½“ä½ æ›´æ–°æ—¶ä¼šå¤åˆ¶æ—¥å¿—ï¼Œä½ å¸Œæœ›çš„åªæ˜¯æ›´æ–°è¡¥ä¸å¹¶å°†å®ƒä»¬åº”ç”¨åˆ°ä½ çš„å½“å‰å¿«ç…§ä¸­ã€‚\næœ€è¿‘ï¼Œæœ‰äº›äººä» Datomic \u0026ndash; ä¸€å®¶é”€å”®æ—¥å¿—æ•°æ®åº“çš„å…¬å¸å¾—åˆ°äº†ä¸€äº›æƒ³æ³•ã€‚ è¿™ä¸ªæ¼”è®²å›é¡¾äº†ä»–ä»¬æ˜¯å¦‚ä½•è®²è¿™ä¸ªæƒ³æ³•åº”ç”¨åˆ°ä»–ä»¬çš„ç³»ç»Ÿä¸­çš„ã€‚è¿™äº›æƒ³æ³•ä½¿ä»–ä»¬å¯¹å¦‚ä½• åœ¨ä»–ä»¬çš„ç³»ç»Ÿåº”ç”¨è¿™äº›æƒ³æ³•æœ‰äº†å¼€é˜”çš„è®¤è¯†ã€‚ å½“ç„¶è¿™äº›æƒ³æ³•ä¸æ˜¯åªé’ˆå¯¹è¿™ä¸ªç³»ç»Ÿï¼Œä»–ä»¬ä¼šæˆä¸º åå¤šå¹´åˆ†å¸ƒå¼ç³»ç»Ÿå’Œæ•°æ®åº“æ–‡çŒ®çš„ä¸€éƒ¨åˆ†ã€‚\nè¿™å¯èƒ½ä¼¼ä¹æœ‰ç‚¹è¿‡äºç†æƒ³åŒ–ã€‚ä½†æ˜¯ä¸è¦æ‚²è§‚ï¼æˆ‘ä»¬ä¼šå¾ˆå¿«æŠŠå®ƒå®ç°ã€‚\nWhat\u0026rsquo;s next # åœ¨è¿™ç¯‡æ–‡ç« çš„å…¶ä½™éƒ¨åˆ†ï¼Œæˆ‘å°†è¯•å›¾è¯´æ˜æ—¥å¿—é™¤äº†å¯ç”¨åœ¨åˆ†å¸ƒå¼è®¡ç®—æˆ–è€…æŠ½è±¡åˆ†å¸ƒå¼è®¡ç®—æ¨¡å‹å†…éƒ¨ä¹‹å¤–ï¼Œè¿˜å¯ç”¨åœ¨å“ªäº›æ–¹é¢ã€‚å…¶ä¸­åŒ…æ‹¬ï¼š\næ•°æ®é›†æˆ(Data Integration)-è®©æœºæ„çš„å…¨éƒ¨å­˜å‚¨å’Œå¤„ç†ç³»ç»Ÿé‡Œçš„æ‰€æœ‰æ•°æ®å¾ˆå®¹æ˜“åœ°å¾—åˆ°è®¿é—®ã€‚ å®æ—¶æ•°æ®å¤„ç†(Real-time data processing)-è®¡ç®—ç”Ÿæˆçš„æ•°æ®æµã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡(Distributed system design)-å®é™…åº”ç”¨çš„ç³»ç»Ÿæ˜¯å¦‚ä½•é€šè¿‡ä½¿ç”¨é›†ä¸­å¼æ—¥å¿—æ¥ç®€åŒ–è®¾è®¡çš„ã€‚ æ‰€æœ‰è¿™äº›ç”¨æ³•éƒ½æ˜¯é€šè¿‡æŠŠæ—¥å¿—ç”¨åšå•ç‹¬æœåŠ¡æ¥å®ç°çš„ã€‚\nåœ¨ä¸Šé¢ä»»ä½•ä¸€ç§ç”¨æ³•é‡Œï¼Œæ—¥å¿—çš„ç”¨é€”å¼€å§‹éƒ½æ˜¯ä½¿ç”¨äº†æ—¥å¿—æ‰€èƒ½æä¾›çš„æŸä¸ªç®€å•åŠŸèƒ½ï¼šç”Ÿæˆæ°¸ä¹…çš„ã€å¯é‡ç°çš„å†å²è®°å½•ã€‚ä»¤äººæ„å¤–çš„æ˜¯ï¼Œé—®é¢˜çš„æ ¸å¿ƒæ˜¯å¯ä»¥è®©å¤šå°‘å°æœºå™¨ä»¥ç‰¹å®šçš„æ–¹å¼ï¼ŒæŒ‰ç…§è‡ªèº«çš„é€Ÿåº¦é‡ç°å†å²è®°å½•çš„èƒ½åŠ›ã€‚\nPart Two: Data Integration # è¯·è®©æˆ‘é¦–å…ˆè§£é‡Š ä¸€ä¸‹â€œæ•°æ®é›†æˆâ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Œè¿˜æœ‰ä¸ºä»€ä¹ˆæˆ‘è§‰å¾—å®ƒå¾ˆé‡è¦ï¼Œä¹‹åæˆ‘ä»¬å†æ¥çœ‹çœ‹å®ƒå’Œæ—¥å¿—æœ‰ä»€ä¹ˆå…³ç³»ã€‚\nData integration is making all the data an organization has available in all its services and systems.\næ•°æ®é›†æˆå°±æ˜¯å°†æ•°æ®ç»„ç»‡èµ·æ¥ï¼Œä½¿å¾—åœ¨ä¸å…¶æœ‰å…³çš„æœåŠ¡å’Œç³»ç»Ÿä¸­å¯ä»¥è®¿é—®å®ƒä»¬\nè€Œæ›´å¸¸è§çš„æœ¯è¯­ ETL é€šå¸¸åªæ˜¯è¦†ç›–äº†æ•°æ®é›†æˆçš„ä¸€ä¸ªæœ‰é™å­é›†(è¯‘æ³¨ï¼šETLï¼ŒExtraction-Transformation-Loading çš„ç¼©å†™ï¼Œå³æ•°æ®æå–ã€è½¬æ¢å’ŒåŠ è½½)â€”â€”ç›¸å¯¹äºå…³ç³»å‹æ•°æ®ä»“åº“ã€‚ä½†æˆ‘æè¿°çš„ä¸œè¥¿å¾ˆå¤§ç¨‹åº¦ä¸Šå¯ä»¥ç†è§£ä¸ºï¼Œå°† ETL æ¨å¹¿è‡³å®æ—¶ç³»ç»Ÿå’Œå¤„ç†æµç¨‹ã€‚\nå¯¹æ•°æ®çš„é«˜æ•ˆä½¿ç”¨éµå¾ªä¸€ç§ é©¬æ–¯æ´›çš„éœ€è¦å±‚æ¬¡ç†è®º ã€‚é‡‘å­—å¡”çš„åŸºç¡€éƒ¨åˆ†åŒ…æ‹¬æ•è·æ‰€æœ‰ç›¸å…³æ•°æ®ï¼Œèƒ½å¤Ÿå°†å®ƒä»¬å…¨éƒ¨æ”¾åˆ°é€‚å½“çš„å¤„ç†ç¯å¢ƒï¼ˆé‚£ä¸ªç¯å¢ƒåº”è¯¥æ˜¯ä¸€ä¸ªå¥‡å¦™çš„å®æ—¶æŸ¥è¯¢ç³»ç»Ÿï¼Œæˆ–è€…ä»…ä»…æ˜¯æ–‡æœ¬æ–‡ä»¶å’Œ python è„šæœ¬ï¼‰ã€‚è¿™äº›æ•°æ®éœ€è¦ä»¥ç»Ÿä¸€çš„æ–¹å¼å»ºæ¨¡ï¼Œè¿™æ ·å°±å¯ä»¥æ–¹ä¾¿è¯»å–å’Œæ•°æ®å¤„ç†ã€‚å¦‚æœè¿™ç§ä»¥ç»Ÿä¸€çš„æ–¹å¼æ•è·æ•°æ®çš„åŸºæœ¬éœ€æ±‚å¾—åˆ°æ»¡è¶³ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨åŸºç¡€è®¾æ–½ä¸Šä»¥è‹¥å¹²ç§æ–¹æ³•å¤„ç†è¿™äº›æ•°æ®â€”â€”æ˜ å°„åŒ–ç®€ï¼ˆMapReduceï¼‰ï¼Œå®æ—¶æŸ¥è¯¢ç³»ç»Ÿï¼Œç­‰ç­‰ã€‚\nå¾ˆæ˜æ˜¾ï¼Œæœ‰ä¸€ç‚¹å€¼å¾—æ³¨æ„ï¼šå¦‚æœæ²¡æœ‰å¯é çš„ã€å®Œæ•´çš„æ•°æ®æµï¼ŒHadoop é›†ç¾¤é™¤äº†è±¡æ˜‚è´µçš„ä¸”éš¾äºå®‰è£…çš„ç©ºé—´å–æš–å™¨å“ªæ ·å¤–ä¸ä¼šåšæ›´å¤šäº‹æƒ…äº†ã€‚ä¸€æ—¦æ•°æ®å’Œå¤„ç†å¯ç”¨ï¼Œäººä»¬å°±ä¼šå…³å¿ƒè‰¯å¥½æ•°æ®æ¨¡å‹å’Œä¸€è‡´åœ°æ˜“äºç†è§£çš„è¯­æ³•å“ªäº›æ›´ç»†è‡´çš„é—®é¢˜ã€‚æœ€åï¼Œäººä»¬æ‰ä¼šå…³æ³¨æ›´åŠ é«˜çº§çš„å¤„ç†-æ›´å¥½çš„å¯è§†åŒ–ã€æŠ¥è¡¨ä»¥åŠå¤„ç†å’Œé¢„æµ‹ç®—æ³•ã€‚ ä»¥æˆ‘çš„ç»éªŒï¼Œå¤§å¤šæ•°æœºæ„åœ¨æ•°æ®é‡‘å­—å¡”çš„åº•éƒ¨å­˜åœ¨å·¨å¤§çš„æ¼æ´-å®ƒä»¬ç¼ºä¹å¯é çš„ã€å®Œæ•´çš„æ•°æ®æµ-è€Œæ˜¯æ‰“ç®—ç›´æ¥è·³åˆ°é«˜çº§æ•°æ®æ¨¡å‹æŠ€æœ¯ä¸Šã€‚è¿™æ ·åšå®Œå…¨æ˜¯åç€æ¥åšçš„ã€‚\nå› æ­¤ï¼Œé—®é¢˜æ˜¯æˆ‘ä»¬å¦‚ä½•æ„å»ºé€šè¿‡æœºæ„å†…æ‰€æœ‰æ•°æ®ç³»ç»Ÿçš„å¯é çš„æ•°æ®æµã€‚\nData Integration: Two complications # ä¸¤ç§è¶‹åŠ¿ä½¿æ•°æ®é›†æˆå˜å¾—æ›´å›°éš¾ã€‚\nç¬¬ä¸€ä¸ªè¶‹åŠ¿æ˜¯å¢é•¿çš„äº‹ä»¶æ•°æ®(event data)ã€‚äº‹ä»¶æ•°æ®è®°å½•çš„æ˜¯å‘ç”Ÿçš„äº‹æƒ…ï¼Œè€Œä¸æ˜¯å­˜åœ¨çš„ä¸œè¥¿ã€‚åœ¨ web ç³»ç»Ÿä¸­ï¼Œè¿™å°±æ„å‘³ç€ç”¨æˆ·æ´»åŠ¨æ—¥å¿—ï¼Œè¿˜æœ‰ä¸ºäº†å¯é çš„æ“ä½œä»¥åŠç›‘æ§æ•°æ®ä¸­å¿ƒçš„æœºå™¨çš„ç›®çš„ï¼Œæ‰€éœ€è¦è®°å½•çš„æœºå™¨çº§åˆ«çš„äº‹ä»¶å’Œç»Ÿè®¡æ•°å­—ã€‚äººä»¬å€¾å‘ç§°å®ƒä»¬ä¸ºâ€œæ—¥å¿—æ•°æ®â€ï¼Œå› ä¸ºå®ƒä»¬ç»å¸¸è¢«å†™åˆ°åº”ç”¨çš„æ—¥å¿—ä¸­ï¼Œä½†æ˜¯è¿™æ··æ·†äº†å½¢å¼ä¸åŠŸèƒ½ã€‚è¿™ç§æ•°æ®ä½äºç°ä»£ web çš„ä¸­å¿ƒï¼šå½’æ ¹ç»“åº•ï¼ŒGoogle çš„èµ„äº§æ˜¯ç”±è¿™æ ·ä¸€äº›å»ºç«‹åœ¨ç‚¹å‡»å’Œæ˜ åƒåŸºç¡€ä¹‹ä¸Šçš„ç›¸å…³ç®¡é“æ‰€ç”Ÿæˆçš„â€”â€”é‚£ä¹Ÿå°±æ˜¯äº‹ä»¶ã€‚\nè¿™äº›ä¸œè¥¿å¹¶ä¸æ˜¯ä»…é™äºç½‘ç»œå…¬å¸ï¼Œåªæ˜¯ç½‘ç»œå…¬å¸å·²ç»å®Œå…¨æ•°å­—åŒ–ï¼Œæ‰€ä»¥å®ƒä»¬æ›´å®¹æ˜“ç”¨è®¾å¤‡è®°å½•ã€‚è´¢åŠ¡æ•°æ®ä¸€ç›´æ˜¯é¢å‘äº‹ä»¶çš„ã€‚ RFID(æ— çº¿å°„é¢‘è¯†åˆ«)å°†è¿™ç§è·Ÿè¸ªèƒ½åŠ›èµ‹äºˆç‰©ç†å¯¹è±¡ã€‚æˆ‘è®¤ä¸ºè¿™ç§è¶‹åŠ¿ä»å°†ç»§ç»­ï¼Œä¼´éšç€è¿™ä¸ªè¿‡ç¨‹çš„æ˜¯ä¼ ç»Ÿå•†åŠ¡æ´»åŠ¨çš„ æ•°å­—åŒ–ã€‚\nè¿™ç§ç±»å‹çš„äº‹ä»¶æ•°æ®è®°å½•ä¸‹å‘ç”Ÿçš„äº‹æƒ…ï¼Œè€Œä¸”å¾€å¾€æ¯”ä¼ ç»Ÿæ•°æ®åº“åº”ç”¨è¦å¤§å¥½å‡ ä¸ªæ•°é‡çº§ã€‚è¿™å¯¹äºå¤„ç†æå‡ºäº†é‡å¤§æŒ‘æˆ˜ã€‚\nTThe explosion of specialized data systems # ç¬¬äºŒä¸ªè¶‹åŠ¿æ¥è‡ªäºä¸“é—¨çš„æ•°æ®ç³»ç»Ÿçš„çˆ†å‘ï¼Œé€šå¸¸è¿™äº›æ•°æ®ç³»ç»Ÿåœ¨æœ€è¿‘çš„äº”å¹´ä¸­å¼€å§‹å˜å¾—æµè¡Œï¼Œå¹¶ä¸”å¯ä»¥å…è´¹è·å¾—ã€‚ä¸“é—¨çš„æ•°æ®ç³»ç»Ÿæ˜¯ä¸º OLAP, æœç´¢, ç®€å• åœ¨çº¿ å­˜å‚¨, æ‰¹å¤„ç†, å›¾åƒåˆ†æ, ç­‰ ç­‰ è€Œå­˜åœ¨çš„ã€‚\næ›´å¤šçš„ä¸åŒç±»å‹æ•°æ®çš„ç»„åˆï¼Œä»¥åŠå°†è¿™äº›æ•°æ®å­˜æ”¾åˆ°æ›´å¤šçš„ç³»ç»Ÿä¸­çš„æ„¿æœ›ï¼Œå¯¼è‡´äº†ä¸€ä¸ªå·¨å¤§çš„æ•°æ®é›†æˆé—®é¢˜ã€‚\nLog-structured data flow # ä¸ºäº†å¤„ç†ç³»ç»Ÿä¹‹é—´çš„æ•°æ®æµï¼Œæ—¥å¿—æ˜¯æœ€è‡ªç„¶çš„æ•°æ®ç»“æ„ã€‚å…¶ä¸­çš„ç§˜è¯€å¾ˆç®€å•ï¼š\nå°†æ‰€æœ‰ç»„ç»‡çš„æ•°æ®æå–å‡ºæ¥ï¼Œå¹¶å°†å®ƒä»¬æ”¾åˆ°ä¸€ä¸ªä¸­å¿ƒæ—¥å¿—ï¼Œä»¥ä¾¿å®æ—¶æŸ¥é˜…ã€‚\næ¯ä¸ªé€»è¾‘æ•°æ®æºéƒ½å¯ä»¥å»ºæ¨¡ä¸ºå®ƒè‡ªå·±çš„æ—¥å¿—ã€‚ä¸€ä¸ªæ•°æ®æºå¯ä»¥æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„äº‹ä»¶æ—¥å¿—ï¼ˆå¦‚ç‚¹å‡»é‡æˆ–è€…é¡µé¢æµè§ˆé‡ï¼‰ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªæ¥å—ä¿®æ”¹çš„æ•°æ®åº“è¡¨ã€‚æ¯ä¸ªè®¢é˜…æ¶ˆæ¯çš„ç³»ç»Ÿéƒ½å°½å¯èƒ½å¿«çš„ä»æ—¥å¿—è¯»å–ä¿¡æ¯ï¼Œå°†æ¯æ¡æ–°çš„è®°å½•ä¿å­˜åˆ°è‡ªå·±çš„å­˜å‚¨ï¼Œå¹¶ä¸”æå‡å…¶åœ¨æ—¥å¿—ä¸­çš„åœ°ä½ã€‚è®¢é˜…æ–¹å¯ä»¥æ˜¯ä»»æ„ä¸€ç§æ•°æ®ç³»ç»Ÿ â€”â€” ä¸€ä¸ªç¼“å­˜ï¼ŒHadoopï¼Œå¦ä¸€ä¸ªç½‘ç«™ä¸­çš„å¦ä¸€ä¸ªæ•°æ®åº“ï¼Œä¸€ä¸ªæœç´¢ç³»ç»Ÿï¼Œç­‰ç­‰ã€‚\nä¾‹å¦‚ï¼Œæ—¥å¿—é’ˆå¯¹æ¯ä¸ªæ›´æ”¹ç»™å‡ºäº†é€»è¾‘æ—¶é’Ÿçš„æ¦‚å¿µï¼Œè¿™æ ·æ‰€æœ‰çš„è®¢é˜…æ–¹éƒ½å¯ä»¥è¢«æµ‹é‡ã€‚æ¨å¯¼ä¸åŒçš„è®¢é˜…ç³»ç»Ÿçš„çŠ¶æ€ä¹Ÿå› æ­¤å˜å¾—ç›¸å¯¹ç®€å•çš„å¤šï¼Œå› ä¸ºæ¯ä¸ªç³»ç»Ÿéƒ½æœ‰ä¸€ä¸ªè¯»å–åŠ¨ä½œçš„â€œæ—¶é—´ç‚¹â€ã€‚\nä¸ºäº†è®©è¿™ä¸ªæ˜¾å¾—æ›´å…·ä½“ï¼Œæˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹ï¼Œæœ‰ä¸€ä¸ªæ•°æ®åº“å’Œä¸€ç»„ç¼“å­˜æœåŠ¡å™¨é›†ç¾¤ã€‚æ—¥å¿—æä¾›äº†ä¸€ç§åŒæ­¥æ›´æ–°æ‰€æœ‰è¿™äº›ç³»ç»Ÿï¼Œå¹¶æ¨å¯¼å‡ºæ¯ä¸€ä¸ªç³»ç»Ÿçš„æ¥è§¦æ—¶é—´ç‚¹çš„æ–¹æ³•ã€‚æˆ‘ä»¬å‡è®¾å†™äº†ä¸€æ¡æ—¥å¿— Xï¼Œç„¶åéœ€è¦ä»ç¼“å­˜åšä¸€æ¬¡è¯»å–ã€‚å¦‚æœæˆ‘ä»¬æƒ³ä¿è¯çœ‹åˆ°çš„ä¸æ˜¯é™ˆæ—§çš„æ•°æ®ï¼Œæˆ‘ä»¬åªéœ€ä¿è¯æ²¡æœ‰ä»ä»»ä½•å°šæœªå¤åˆ¶ X çš„ç¼“å­˜ä¸­è¯»å–å³å¯ã€‚\næ—¥å¿—ä¹Ÿèµ·åˆ°ç¼“å­˜çš„ä½œç”¨ï¼Œä½¿æ•°æ®ç”Ÿäº§ä¸æ•°æ®æ¶ˆè´¹ç›¸åŒæ­¥ã€‚ç”±äºè®¸å¤šåŸå› è¿™ä¸ªåŠŸèƒ½å¾ˆé‡è¦ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šä¸ªè®¢é˜…æ–¹æ¶ˆè´¹æ•°æ®çš„é€Ÿåº¦å„ä¸ç›¸åŒçš„æ—¶å€™ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªè®¢é˜…æ•°æ®ç³»ç»Ÿå¯ä»¥å®•æœºï¼Œæˆ–è€…ä¸‹çº¿ç»´æŠ¤ï¼Œä¹‹åé‡æ–°ä¸Šçº¿ä»¥åå†èµ¶ä¸Šæ¥ï¼šè®¢é˜…æ–¹æŒ‰ç…§è‡ªå·±æ§åˆ¶çš„èŠ‚æ‹æ¥æ¶ˆè´¹æ•°æ®ã€‚æ‰¹å¤„ç†ç³»ç»Ÿï¼Œå¦‚ Hadoop æˆ–è€…æ˜¯ä¸€ä¸ªæ•°æ®ä»“åº“ï¼Œæˆ–è®¸åªæ˜¯æ¯å°æ—¶æˆ–è€…æ¯å¤©æ¶ˆè´¹ä¸€æ¬¡æ•°æ®ï¼Œè€Œå®æ—¶æŸ¥è¯¢ç³»ç»Ÿå¯èƒ½éœ€è¦åŠæ—¶åˆ°ç§’ã€‚ç”±äºæ— è®ºæ˜¯åŸå§‹æ•°æ®æºè¿˜æ˜¯æ—¥å¿—ï¼Œéƒ½æ²¡æœ‰å„ç§ç›®æ ‡æ•°æ®ç³»ç»Ÿçš„ç›¸å…³çŸ¥è¯†ï¼Œå› æ­¤æ¶ˆè´¹æ–¹ç³»ç»Ÿå¯ä»¥è¢«æ·»åŠ å’Œåˆ é™¤ï¼Œè€Œæ— éœ€ä¼ è¾“ç®¡é“çš„å˜åŒ–ã€‚\nEache working data pipeline is designed like a log; each broken data pipeline is broken is its own way \u0026ndash; Anna Karenina principle\nç‰¹åˆ«é‡è¦çš„æ˜¯ï¼šç›®æ ‡ç³»ç»ŸåªçŸ¥é“æ—¥å¿—è€Œä¸çŸ¥é“åŸå§‹ç³»ç»Ÿçš„ä»»ä½•ç»†èŠ‚ã€‚ æ¶ˆè´¹è€…ç³»ç»Ÿä¸éœ€è¦å…³å¿ƒæ•°æ®æ˜¯æ¥è‡ª RDBMSï¼Œæ–°çš„é”®å€¼å­˜å‚¨ï¼Œè¿˜æ˜¯æ²¡æœ‰ä»»ä½•ç±»å‹çš„å®æ—¶æŸ¥è¯¢ç³»ç»Ÿã€‚ è¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªå°é—®é¢˜ï¼Œä½†å®é™…ä¸Šæ˜¯éœ€è¦ä»”ç»†é‰´åˆ«çš„(critical)ã€‚\nè¿™é‡Œæˆ‘ä½¿ç”¨æœ¯è¯­â€œæ—¥å¿—â€å–ä»£äº†â€œæ¶ˆæ¯ç³»ç»Ÿâ€æˆ–è€…â€œå‘å¸ƒ-è®¢é˜…â€ï¼Œå› ä¸ºå®ƒåœ¨è¯­ä¹‰ä¸Šæ›´æ˜ç¡®ï¼Œå¹¶ä¸”å¯¹æ”¯æŒæ•°æ®å¤åˆ¶çš„å®é™…å®ç°è¿™æ ·çš„éœ€æ±‚ï¼Œæœ‰ç€æ›´æ¥è¿‘çš„æè¿°ã€‚æˆ‘å‘ç°â€œå‘å¸ƒè®¢é˜…â€å¹¶ä¸æ¯”é—´æ¥å¯»å€çš„æ¶ˆæ¯å…·æœ‰æ›´å¤šçš„å«ä¹‰â€”â€”å¦‚æœä½ æ¯”è¾ƒä»»ä½•ä¸¤ä¸ªå‘å¸ƒ-è®¢é˜…çš„æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿçš„è¯ï¼Œä½ ä¼šå‘ç°ä»–ä»¬æ‰¿è¯ºçš„æ˜¯å®Œå…¨ä¸åŒçš„ä¸œè¥¿ï¼Œè€Œä¸”å¤§å¤šæ•°æ¨¡å‹åœ¨è¿™ä¸€é¢†åŸŸéƒ½ä¸æ˜¯æœ‰ç”¨çš„ã€‚ä½ å¯ä»¥è®¤ä¸ºæ—¥å¿—æ˜¯ä¸€ç§æ¶ˆæ¯ç³»ç»Ÿï¼Œå®ƒå…·æœ‰æŒä¹…æ€§ä¿è¯å’Œå¼ºå¤§çš„è®¢é˜…è¯­ä¹‰ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªé€šä¿¡æ¨¡å‹æœ‰æ—¶æœ‰ä¸ª(æœ‰äº›å¯æ€•çš„)åå­—å«åš atomic broadcastã€‚\nå€¼å¾—å¼ºè°ƒçš„æ˜¯ï¼Œæ—¥å¿—ä»ç„¶åªæ˜¯åŸºç¡€è®¾æ–½ã€‚è¿™å¹¶ä¸æ˜¯ç®¡ç†æ•°æ®æµè¿™ä¸ªæ•…äº‹çš„ç»“æŸï¼šæ•…äº‹çš„å…¶ä½™éƒ¨åˆ†å›´ç»•ç€å…ƒæ•°æ®ï¼Œæ¨¡å¼ï¼Œå…¼å®¹æ€§ï¼Œä»¥åŠå¤„ç†æ•°æ®ç»“æ„çš„æ‰€æœ‰ç»†èŠ‚åŠå…¶æ¼”åŒ–ã€‚é™¤éæœ‰ä¸€ç§å¯é çš„ï¼Œä¸€èˆ¬çš„æ–¹æ³•æ¥å¤„ç†æ•°æ®æµè¿ä½œï¼Œè¯­ä¹‰åœ¨å…¶ä¸­æ€»æ˜¯æ¬¡è¦çš„ç»†èŠ‚ã€‚\nAt LinkedIn # åœ¨ LinkedIn ä»é›†ä¸­å¼å…³ç³»æ•°æ®åº“å‘åˆ†å¸ƒå¼ç³»ç»Ÿé›†åˆè½¬åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘çœ‹åˆ°è¿™ä¸ªæ•°æ®é›†æˆé—®é¢˜è¿…é€Ÿæ¼”å˜ã€‚\nä¸»è¦çš„æ•°æ®ç³»ç»ŸåŒ…æ‹¬ï¼š\nSearch Social Graph Voldemort (key-value store) Espresso (document store) Recommendation engine OLAP query engine Hadoop Terradata Ingraphs (monitoring graphs and metrics services) è¿™ç§ä½¿ç”¨æ—¥å¿—ä½œä¸ºæ•°æ®æµçš„æ€æƒ³ï¼Œç”šè‡³åœ¨æˆ‘åˆ°è¿™é‡Œä¹‹å‰å°±å·²ç»ä¸ LinkedIn ç›¸ä¼´äº†ã€‚æˆ‘ä»¬å¼€å‘çš„ä¸€ä¸ªæœ€æ—©çš„åŸºç¡€è®¾æ–½ä¹‹ä¸€ï¼Œæ˜¯ä¸€ç§ç§°ä¸º databus çš„æœåŠ¡ï¼Œå®ƒåœ¨æˆ‘ä»¬æ—©æœŸçš„ Oracle è¡¨ä¸Šæä¾›äº†ä¸€ç§æ—¥å¿—ç¼“å­˜æŠ½è±¡ï¼Œå¯ä¼¸ç¼©è®¢é˜…æ•°æ®åº“ä¿®æ”¹,è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾ˆå¥½æ”¯æŒæˆ‘ä»¬çš„ç¤¾äº¤ç½‘ç»œå’Œæœç´¢ç´¢å¼•ã€‚\næˆ‘ä¼šç»™å‡ºä¸€äº›å†å²å¹¶äº¤ä»£ä¸€ä¸‹ä¸Šä¸‹æ–‡ã€‚æˆ‘é¦–æ¬¡å‚ä¸åˆ°è¿™äº›å¤§çº¦æ˜¯åœ¨ 2008 å¹´å·¦å³ï¼Œåœ¨æˆ‘ä»¬è½¬ç§»é”®å€¼å­˜å‚¨ä¹‹åã€‚æˆ‘çš„ä¸‹ä¸€ä¸ªé¡¹ç›®æ˜¯è®©ä¸€ä¸ªå·¥ä½œä¸­çš„ Hadoop é…ç½®æ¼”è¿›ï¼Œå¹¶ç»™å…¶å¢åŠ ä¸€äº›æˆ‘ä»¬çš„æ¨èæµç¨‹ã€‚ç”±äºç¼ºä¹è¿™æ–¹é¢çš„ç»éªŒï¼Œæˆ‘ä»¬è‡ªç„¶è€Œç„¶çš„å®‰æ’äº†æ•°å‘¨è®¡åˆ’åœ¨æ•°æ®çš„å¯¼å…¥å¯¼å‡ºæ–¹é¢ï¼Œå‰©ä¸‹çš„æ—¶é—´åˆ™ç”¨æ¥å®ç°å¥‡å¦™çš„é¢„æµ‹ç®—æ³•ã€‚è¿™æ ·æˆ‘ä»¬å°±å¼€å§‹äº†é•¿é€”è·‹æ¶‰ã€‚\næˆ‘ä»¬æœ¬æ¥è®¡åˆ’æ˜¯ä»…ä»…å°†æ•°æ®ä»ç°å­˜çš„ Oracle æ•°æ®ä»“åº“ä¸­å‰–ç¦»ã€‚ä½†æ˜¯æˆ‘ä»¬é¦–å…ˆå‘ç°å°†æ•°æ®ä» Oracle ä¸­è¿…é€Ÿå–å‡ºæ˜¯ä¸€ç§é»‘æš—è‰ºæœ¯ã€‚æ›´ç³Ÿçš„æ˜¯ï¼Œæ•°æ®ä»“åº“çš„å¤„ç†è¿‡ç¨‹ä¸æˆ‘ä»¬ä¸º Hadoop è€Œè®¡åˆ’çš„æ‰¹å¤„ç†ç”Ÿäº§è¿‡ç¨‹ä¸é€‚åˆâ€”â€”å…¶å¤§éƒ¨åˆ†å¤„ç†éƒ½æ˜¯ä¸å¯é€†è½¬çš„ï¼Œå¹¶ä¸”ä¸å³å°†ç”Ÿæˆçš„æŠ¥å‘Šå…·ä½“ç›¸å…³ã€‚æœ€ç»ˆæˆ‘ä»¬é‡‡å–çš„åŠæ³•æ˜¯ï¼Œé¿å…ä½¿ç”¨æ•°æ®ä»“åº“ï¼Œç›´æ¥è®¿é—®æºæ•°æ®åº“å’Œæ—¥å¿—æ–‡ä»¶ã€‚æœ€åï¼Œæˆ‘ä»¬ä¸ºäº†åŠ è½½ æ•°æ®åˆ°é”®å€¼å­˜å‚¨ å¹¶ç”Ÿæˆç»“æœï¼Œå®ç°äº†å¦å¤–ä¸€ç§ç®¡é“ã€‚\nè¿™ç§æ™®é€šçš„æ•°æ®å¤åˆ¶æœ€ç»ˆæˆä¸ºåŸå§‹å¼€å‘é¡¹ç›®çš„ä¸»è¦å†…å®¹ä¹‹ä¸€ã€‚ç³Ÿç³•çš„æ˜¯ï¼Œåœ¨ä»»ä½•æ—¶é—´ä»»æ„ç®¡é“éƒ½æœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒHadoop ç³»ç»Ÿå¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯æ— ç”¨çš„â€”â€”åœ¨é”™è¯¯çš„æ•°æ®åŸºç¡€ä¸Šè¿è¡Œå¥‡ç‰¹çš„(fancy)ç®—æ³•ï¼Œåªä¼šäº§ç”Ÿæ›´å¤šçš„é”™è¯¯æ•°æ®ã€‚\nè™½ç„¶æˆ‘ä»¬å·²ç»ä»¥ä¸€ç§é€šç”¨çš„æ–¹å¼åˆ›å»ºäº‹ç‰©ï¼Œä½†æ˜¯æ¯ä¸ªæ•°æ®æºéƒ½éœ€è¦è‡ªå®šä¹‰é…ç½®å®‰è£…ã€‚è¿™ä¹Ÿè¢«è¯æ˜æ˜¯å·¨é‡é”™è¯¯ä¸å¤±è´¥çš„æ ¹æºã€‚æˆ‘ä»¬åœ¨ Hadoop ä¸Šå®ç°çš„ç½‘ç«™åŠŸèƒ½å·²ç»å¼€å§‹æµè¡Œèµ·æ¥ï¼ŒåŒæ—¶æˆ‘ä»¬å‘ç°æˆ‘ä»¬æœ‰ä¸€é•¿ä¸²æ„Ÿå…´è¶£çš„å·¥ç¨‹å¸ˆã€‚æ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä»–ä»¬æƒ³è¦é›†æˆçš„ä¸€ç³»åˆ—ç³»ç»Ÿï¼Œä»–ä»¬æƒ³è¦çš„ä¸€ç³»åˆ—æ–°æ•°æ®æºã€‚\nETL in Ancient Greece. Not much has changed.\næœ‰äº›ä¸œè¥¿åœ¨æˆ‘é¢å‰å¼€å§‹æ¸æ¸æ¸…æ™°èµ·æ¥ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬å·²å»ºæˆçš„é€šé“è™½ç„¶æœ‰ä¸€äº›æ‚ä¹±ï¼Œä½†å®è´¨ä¸Šå®ƒä»¬æ˜¯å¾ˆæœ‰ä»·å€¼çš„ã€‚åœ¨é‡‡ç”¨è¯¸å¦‚ Hadoop çš„æ–°çš„å¤„ç†ç³»ç»Ÿç”Ÿæˆå¯ç”¨æ•°æ®çš„è¿‡ç¨‹ï¼Œå®ƒè§£é”äº†å¤§é‡çš„å¯èƒ½æ€§ã€‚ åŸºäºè¿™äº›æ•°æ®è¿‡å»å¾ˆéš¾å®ç°çš„è®¡ç®—ï¼Œå¦‚ä»Šå˜ä¸ºå¯èƒ½ã€‚ è®¸å¤šæ–°çš„äº§å“å’Œåˆ†ææŠ€æœ¯éƒ½æ¥æºäºæŠŠåˆ†ç‰‡çš„æ•°æ®æ”¾åœ¨ä¸€èµ·ï¼Œè¿™äº›æ•°æ®è¢«é”å®šåœ¨ç‰¹å®šçš„ç³»ç»Ÿä¸­ã€‚\nç¬¬äºŒï¼Œ ä¼—æ‰€å‘¨çŸ¥ï¼Œå¯é çš„æ•°æ®åŠ è½½éœ€è¦æ•°æ®é€šé“çš„æ·±åº¦æ”¯æŒã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥æ•è·æ‰€æœ‰æˆ‘ä»¬éœ€è¦çš„ç»“æ„ï¼Œæˆ‘å°±å¯ä»¥ä½¿å¾— Hadoop æ•°æ®å…¨è‡ªåŠ¨çš„åŠ è½½ï¼Œè¿™æ ·å°±ä¸éœ€è¦é¢å¤–çš„æ“ä½œæ¥å¢åŠ æ–°çš„æ•°æ®æºæˆ–è€…å¤„ç†æ¨¡å¼å˜æ›´\u0026ndash;æ•°æ®å°±ä¼šè‡ªåŠ¨çš„å‡ºç°åœ¨ HDFSï¼ŒHive è¡¨å°±ä¼šè‡ªåŠ¨çš„ç”Ÿæˆå¯¹åº”äºæ–°æ•°æ®æºçš„æ°å½“çš„åˆ—ã€‚\nç¬¬ä¸‰ï¼Œæˆ‘ä»¬çš„æ•°æ®è¦†ç›–ç‡ä»ç„¶éå¸¸ä½ã€‚å¦‚æœä½ æŸ¥çœ‹å­˜å‚¨äº Hadoop ä¸­çš„å¯ç”¨çš„ Linked æ•°æ®çš„å…¨éƒ¨ç™¾åˆ†æ¯”ï¼Œå®ƒä»ç„¶æ˜¯ä¸å®Œæ•´çš„ã€‚èŠ±è´¹å¤§é‡çš„åŠªåŠ›å»ä½¿å¾—å„ä¸ªæ–°çš„æ•°æ®æºè¿è½¬èµ·æ¥ï¼Œä½¿å¾—æ•°æ®è¦†ç›–åº¦å®Œæ•´ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚\næˆ‘ä»¬æ­£åœ¨æ¨è¡Œçš„ï¼Œä¸ºæ¯ä¸ªæ•°æ®æºå’Œç›®æ ‡å¢å»ºå®¢æˆ·åŒ–æ•°æ®åŠ è½½ï¼Œè¿™ç§æ–¹å¼å¾ˆæ˜¾ç„¶æ˜¯ä¸å¯è¡Œçš„ã€‚æˆ‘ä»¬æœ‰å¤§é‡çš„æ•°æ®ç³»ç»Ÿå’Œæ•°æ®ä»“åº“ã€‚æŠŠè¿™äº›ç³»ç»Ÿå’Œä»“åº“è”ç³»èµ·æ¥ï¼Œå°±ä¼šå¯¼è‡´ä»»æ„ä¸€å¯¹ç³»ç»Ÿä¼šäº§ç”Ÿå¦‚ä¸‹æ‰€ç¤ºçš„å®¢æˆ·åŒ–é€šé“ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼šæ•°æ®æ˜¯åŒå‘æµåŠ¨çš„ï¼šä¾‹å¦‚è®¸å¤šç³»ç»Ÿè¯¸å¦‚æ•°æ®åº“å’Œ Hadoop æ—¢æ˜¯æ•°æ®è½¬åŒ–çš„æ¥æºåˆæ˜¯æ•°æ®è½¬åŒ–çš„ç›®çš„åœ°ã€‚è¿™å°±æ„å‘³ç€æˆ‘ä»¬æˆ‘ä»¬ä¸å¿…ä¸ºæ¯ä¸ªç³»ç»Ÿå»ºç«‹ä¸¤ä¸ªé€šé“ï¼šä¸€ä¸ªç”¨äºæ•°æ®è¾“å…¥ï¼Œä¸€ä¸ªç”¨äºæ•°æ®è¾“å‡ºã€‚\nè¿™æ˜¾ç„¶éœ€è¦ä¸€å¤§ç¾¤äººï¼Œè€Œä¸”ä¹Ÿä¸å…·æœ‰å¯æ“ä½œæ€§ã€‚éšç€æˆ‘ä»¬æ¥è¿‘å®Œå…¨è¿æ¥ï¼Œæœ€ç»ˆæˆ‘ä»¬å°†æœ‰å·®ä¸å¤š O(N2)æ¡ç®¡é“ã€‚\nInsteadï¼Œæˆ‘ä»¬éœ€è¦åƒè¿™æ ·é€šç”¨çš„ä¸œè¥¿ï¼š\næˆ‘ä»¬éœ€è¦å°½å¯èƒ½çš„å°†æ¯ä¸ªæ¶ˆè´¹è€…ä¸æ•°æ®æºéš”ç¦»ã€‚ç†æƒ³æƒ…å½¢ä¸‹ï¼Œå®ƒä»¬åº”è¯¥åªä¸ä¸€ä¸ªå•ç‹¬çš„æ•°æ®ä»“åº“é›†æˆï¼Œå¹¶ç”±æ­¤è®©ä»–ä»¬èƒ½è®¿é—®åˆ°æ‰€æœ‰ä¸œè¥¿ã€‚\nè¿™ä¸ªæ€æƒ³æ˜¯å¢åŠ ä¸€ä¸ªæ–°çš„æ•°æ®ç³»ç»Ÿâ€”â€”æˆ–è€…å®ƒæ˜¯ä¸€ä¸ªæ•°æ®æºæˆ–è€…å®ƒæ˜¯ä¸€ä¸ªæ•°æ®ç›®çš„åœ°â€”â€”è®©é›†æˆå·¥ä½œåªéœ€è¿æ¥åˆ°ä¸€ä¸ªå•ç‹¬çš„ç®¡é“ï¼Œè€Œæ— éœ€è¿æ¥åˆ°æ¯ä¸ªæ•°æ®æ¶ˆè´¹æ–¹ã€‚\nåœ¨ç›¸å½“é•¿çš„æ—¶é—´å†…ï¼ŒKafka æ˜¯ç‹¬ä¸€æ— äºŒçš„åº•å±‚äº§å“ï¼Œå®ƒæ—¢ä¸æ˜¯æ•°æ®åº“ï¼Œä¹Ÿä¸æ˜¯æ—¥å¿—æ–‡ä»¶æ”¶é›†ç³»ç»Ÿï¼Œæ›´ä¸æ˜¯ä¼ ç»Ÿçš„æ¶ˆæ¯ç³»ç»Ÿã€‚ä½†æ˜¯æœ€è¿‘ Amazon æä¾›äº†éå¸¸ç±»ä¼¼ Kafka çš„æœåŠ¡ï¼Œç§°ä¹‹ä¸º Kinesis.ç›¸ä¼¼åº¦åŒ…æ‹¬äº†åˆ†ç‰‡å¤„ç†çš„æ–¹å¼ï¼Œæ•°æ®çš„ä¿æŒï¼Œç”šè‡³åŒ…æ‹¬åœ¨ Kafka API ä¸­ï¼Œæœ‰ç‚¹ç‰¹åˆ«çš„é«˜ç«¯å’Œä½ç«¯æ¶ˆè´¹è€…åˆ†ç±»ã€‚æˆ‘å¾ˆå¼€å¿ƒçœ‹åˆ°è¿™äº›ï¼Œè¿™è¡¨æ˜äº†ä½ å·²ç»åˆ›å»ºäº†å¾ˆå¥½çš„åº•å±‚åè®®ï¼ŒAWS å·²ç»æŠŠå®ƒä½œä¸ºæœåŠ¡æä¾›ã€‚ä»–ä»¬å¯¹æ­¤çš„æœŸå¾…ä¸æˆ‘æ‰€æè¿°çš„å»åˆï¼šé€šé“è”é€šäº†æ‰€æœ‰çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œè¯¸å¦‚ DynamoDB, RedShift, S3 ç­‰ï¼Œå®ƒåŒæ—¶ä½œä¸ºä½¿ç”¨ EC2 è¿›è¡Œåˆ†å¸ƒå¼æµå¤„ç†çš„åŸºç¡€ã€‚\nRelationship to ETL and the Data Warehouse # æˆ‘ä»¬å†æ¥èŠèŠæ•°æ®ä»“åº“ã€‚æ•°æ®ä»“åº“æ˜¯æ¸…æ´—å’Œå½’ä¸€æ•°æ®ç»“æ„ç”¨äºæ”¯æ’‘æ•°æ®åˆ†æçš„ä»“åº“ã€‚è¿™æ˜¯ä¸€ä¸ªä¼Ÿå¤§çš„ç†å¿µã€‚å¯¹ä¸ç†Ÿæ‚‰æ•°æ®ä»“åº“æ¦‚å¿µçš„äººæ¥è¯´ï¼Œæ•°æ®ä»“åº“æ–¹æ³•è®ºåŒ…æ‹¬äº†ï¼šå‘¨æœŸæ€§çš„ä»æ•°æ®æºæŠ½å–æ•°æ®ï¼ŒæŠŠå®ƒä»¬è½¬åŒ–ä¸ºå¯ç†è§£çš„å½¢å¼ï¼Œç„¶åæŠŠå®ƒå¯¼å…¥ä¸­å¿ƒæ•°æ®ä»“åº“ã€‚å¯¹äºæ•°æ®é›†ä¸­åˆ†æå’Œå¤„ç†ï¼Œæ‹¥æœ‰é«˜åº¦é›†ä¸­çš„ä½ç½®å­˜æ”¾å…¨éƒ¨æ•°æ®çš„åŸå§‹å‰¯æœ¬æ˜¯éå¸¸å®è´µçš„èµ„äº§ã€‚åœ¨é«˜å±‚çº§ä¸Šï¼Œä¹Ÿè®¸ä½ æŠ½å–å’ŒåŠ è½½æ•°æ®çš„é¡ºåºç•¥å¾®è°ƒæ•´ï¼Œè¿™ä¸ªæ–¹æ³•è®ºä¸ä¼šæœ‰å¤ªå¤šå˜åŒ–,æ— è®ºä½ ä½¿ç”¨ä¼ ç»Ÿçš„æ•°æ®ä»“åº“ Oracle è¿˜æ˜¯ Teradata æˆ–è€… Hadoopã€‚\næ•°æ®ä»“åº“æ˜¯æå…¶é‡è¦çš„èµ„äº§ï¼Œå®ƒåŒ…å«äº†åŸå§‹çš„å’Œè§„æ•´çš„æ•°æ®ï¼Œä½†æ˜¯å®ç°æ­¤ç›®æ ‡çš„æœºåˆ¶æœ‰ç‚¹è¿‡æ—¶äº†ã€‚\nå¯¹ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„ç»„ç»‡å…³é”®é—®é¢˜æ˜¯æŠŠåŸå§‹çš„å½’ä¸€æ•°æ®è”ç»“åˆ°æ•°æ®ä»“åº“ã€‚æ•°æ®ä»“åº“æ˜¯æ‰¹å¤„ç†çš„åŸºç¡€æŸ¥è¯¢ï¼šå®ƒä»¬é€‚ç”¨äºå„ç±»æŠ¥è¡¨å’Œä¸´æ—¶æ€§åˆ†æï¼Œç‰¹åˆ«æ˜¯å½“æŸ¥è¯¢åŒ…å«äº†ç®€å•çš„è®¡æ•°ã€èšåˆå’Œè¿‡æ»¤ã€‚ä½†æ˜¯å¦‚æœä¸€ä¸ªæ‰¹å¤„ç†ç³»ç»Ÿä»…ä»…åŒ…å«äº†åŸå§‹çš„å®Œæ•´çš„æ•°æ®çš„æ•°æ®ä»“åº“ï¼Œè¿™å°±æ„å‘³ç€è¿™äº›æ•°æ®å¯¹äºå®æ—¶æ•°æ®å¤„ç†ã€æœç´¢ç´¢å¼•å’Œç³»ç»Ÿç›‘æ§ç­‰å®æ—¶çš„æŸ¥è¯¢æ˜¯ä¸å¯ç”¨çš„ã€‚\nä¾æˆ‘ä¹‹è§ï¼ŒETL åŒ…æ‹¬ä¸¤ä»¶äº‹ï¼šé¦–å…ˆï¼Œå®ƒæ˜¯æŠ½å–å’Œæ•°æ®æ¸…æ´—è¿‡ç¨‹\u0026ndash;ç‰¹åˆ«æ˜¯é‡Šæ”¾è¢«é”åœ¨ç»„ç»‡çš„å„ç±»ç³»ç»Ÿä¸­çš„æ•°æ®ï¼Œç§»é™¤ç³»ç»Ÿä¸“æœ‰çš„æ— ç”¨ç‰©ã€‚ç¬¬äºŒï¼Œä¾ç…§æ•°æ®ä»“åº“çš„æŸ¥è¯¢é‡æ„æ•°æ®ã€‚ä¾‹å¦‚ä½¿å…¶ç¬¦åˆå…³ç³»æ•°æ®åº“ç±»å‹ç³»ç»Ÿï¼Œå¼ºåˆ¶ä½¿ç”¨æ˜Ÿå·ã€é›ªèŠ±å‹æ¨¡å¼ï¼Œæˆ–è€…åˆ†è§£ä¸ºé«˜æ€§èƒ½çš„æŸ±çŠ¶æ ¼å¼ç­‰ã€‚åˆå¹¶è¿™ä¸¤è€…æ˜¯æœ‰å›°éš¾çš„ã€‚è¿™äº›è§„æ•´çš„æ•°æ®é›†åº”å½“å¯ä»¥åœ¨å®æ—¶æˆ–ä½æ—¶å»¶å¤„ç†ä¸­å¯ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨å…¶å®ƒå®æ–½å­˜å‚¨ç³»ç»Ÿç´¢å¼•ã€‚\nåœ¨æˆ‘çœ‹æ¥ï¼Œæ­£æ˜¯å› ä¸ºè¿™ä¸ªåŸå› æœ‰äº†é¢å¤–å¥½å¤„ï¼šä½¿å¾—æ•°æ®ä»“åº“ ETL æ›´å…·äº†ç»„ç»‡çº§çš„è§„æ¨¡ã€‚æ•°æ®ä»“åº“çš„ç²¾å…¸é—®é¢˜æ˜¯æ•°æ®ä»“åº“è´Ÿè´£æ”¶é›†å’Œæ¸…æ´—ç»„ç»‡ä¸­å„ä¸ªç»„æ‰€ç”Ÿæˆçš„å…¨éƒ¨æ•°æ®ã€‚å„ç»„ç»‡çš„åŠ¨æœºæ˜¯ä¸åŒçš„ï¼Œæ•°æ®çš„ç”Ÿäº§è€…å¹¶ä¸çŸ¥æ™“åœ¨æ•°æ®ä»“åº“ä¸­æ•°æ®çš„ä½¿ç”¨æƒ…å†µï¼Œæœ€ç»ˆäº§ç”Ÿçš„æ•°æ®å¾ˆéš¾æŠ½å–ï¼Œæˆ–è€…éœ€è¦èŠ±è´¹è§„æ¨¡åŒ–çš„è½¬åŒ–æ‰å¯ä»¥è½¬åŒ–ä¸ºå¯ç”¨çš„å½¢å¼ã€‚å½“ç„¶ï¼Œ ä¸­å¿ƒå›¢é˜Ÿä¸å¯èƒ½æ°åˆ°å¥½å¤„çš„æŒæ¡è§„æ¨¡ï¼Œä½¿å¾—è¿™è§„æ¨¡åˆšå¥½ä¸ç»„ç»‡ä¸­å…¶å®ƒå›¢é˜Ÿç›¸åŒ¹é…ï¼Œå› æ­¤æ•°æ®çš„è¦†ç›–ç‡å¸¸å¸¸å·®åˆ«å¾ˆå¤§ï¼Œæ•°æ®æµæ˜¯è„†å¼±çš„åŒæ—¶å˜æ›´æ˜¯ç¼“æ…¢çš„ã€‚\nè¾ƒå¥½çš„æ–¹æ³•æ˜¯æœ‰ä¸€ä¸ªä¸­å¿ƒé€šé“ï¼Œæ—¥å¿—å’Œç”¨äºå¢åŠ æ•°æ®çš„å®šä¹‰è‰¯å¥½çš„ APIã€‚ä¸é€šé“é›†æˆçš„ä¸”æä¾›è‰¯å¥½çš„ç»“æ„åŒ–çš„æ•°æ®æ–‡ä»¶çš„èŒè´£ä¾èµ–äºæ•°æ®çš„ç”Ÿäº§è€…æ‰€ç”Ÿæˆçš„æ•°æ®æ–‡ä»¶ã€‚è¿™æ„å‘³ç€åœ¨è®¾è®¡å’Œå®æ–½å…¶å®ƒç³»ç»Ÿæ—¶åº”å½“è€ƒè™‘æ•°æ®çš„è¾“å‡ºä»¥åŠè¾“å‡ºçš„æ•°æ®å¦‚ä½•è½¬åŒ–ä¸ºç»“æ„è‰¯å¥½çš„å½¢å¼å¹¶ä¼ é€’ç»™ä¸­å¿ƒé€šé“ã€‚å¢åŠ æ–°çš„å­˜å‚¨ç³»ç»Ÿå€’æ˜¯ä¸å¿…å› ä¸ºæ•°æ®ä»“åº“å›¢é˜Ÿæœ‰ä¸€ä¸ªä¸­å¿ƒç»“ç‚¹éœ€è¦é›†æˆè€Œå…³æ³¨æ•°æ®ä»“åº“å›¢é˜Ÿã€‚æ•°æ®ä»“åº“å›¢é˜Ÿä»…éœ€å¤„ç†ç®€å•çš„é—®é¢˜ï¼Œä¾‹å¦‚ä»ä¸­å¿ƒæ—¥å¿—ä¸­åŠ è½½ç»“æ„åŒ–çš„æ•°æ®ï¼Œå‘å…¶å®ƒå‘¨è¾¹ç³»ç»Ÿå®æ–½ä¸ªæ€§åŒ–çš„æ•°æ®è½¬åŒ–ç­‰ã€‚\nå¦‚å›¾æ‰€ç¤ºï¼šå½“è€ƒè™‘åœ¨ä¼ ç»Ÿçš„æ•°æ®ä»“åº“ä¹‹å¤–å¢åŠ é¢å¤–çš„æ•°æ®ç³»ç»Ÿæ—¶ï¼Œç»„ç»‡ç»“æ„çš„å¯æ‰©å±•æ€§æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è€ƒè™‘ä¸ºç»„ç»‡çš„å®Œæ•´çš„æ•°æ®é›†æä¾›æœç´¢åŠŸèƒ½ã€‚æˆ–è€…æä¾›äºŒçº§çš„æ•°æ®æµç›‘æ§å®æ—¶æ•°æ®è¶‹åŠ¿å’Œå‘Šè­¦ã€‚æ— è®ºæ˜¯è¿™ä¸¤è€…ä¸­çš„å“ªä¸€ä¸ªï¼Œä¼ ç»Ÿçš„æ•°æ®ä»“åº“æ¶æ„ç”šè‡³äº Hadoop èšç°‡éƒ½ä¸å†é€‚ç”¨ã€‚æ›´ç³Ÿçš„æ˜¯ï¼ŒETL çš„æµç¨‹é€šé“çš„ç›®çš„å°±æ˜¯æ”¯æŒæ•°æ®åŠ è½½ï¼Œç„¶è€Œ ETL ä¼¼ä¹æ— æ³•è¾“å‡ºåˆ°å…¶å®ƒçš„å„ä¸ªç³»ç»Ÿï¼Œä¹Ÿæ— æ³•é€šè¿‡å¼•å¯¼ç¨‹åºï¼Œä½¿å¾—è¿™äº›å¤–å›´çš„ç³»ç»Ÿçš„å„ä¸ªæ¶æ„æˆä¸ºé€‚ç”¨äºæ•°æ®ä»“åº“çš„é‡è¦èµ„äº§ã€‚è¿™å°±ä¸éš¾è§£é‡Šä¸ºä»€ä¹ˆç»„ç»‡å¾ˆéš¾è½»æ¾çš„ä½¿ç”¨å®ƒçš„å…¨éƒ¨æ•°æ®ã€‚åä¹‹ï¼Œå¦‚æœç»„ç»‡å·²å»ºç«‹èµ·äº†ä¸€å¥—æ ‡å‡†çš„ã€ç»“æ„è‰¯å¥½çš„æ•°æ®ï¼Œé‚£ä¹ˆä»»ä½•æ–°çš„ç³»ç»Ÿè¦ä½¿ç”¨è¿™äº›æ•°æ®ä»…ä»…éœ€è¦ä¸é€šé“è¿›è¡Œç®€å•çš„é›†æˆå°±å¯ä»¥å®ç°ã€‚\nè¿™ç§æ¶æ„å¼•å‡ºäº†æ•°æ®æ¸…ç†å’Œè½¬åŒ–åœ¨å“ªä¸ªé˜¶æ®µè¿›è¡Œçš„ä¸åŒè§‚ç‚¹ï¼š\nç”±æ•°æ®çš„ç”Ÿäº§è€…åœ¨æŠŠæ•°æ®å¢åŠ åˆ°å…¬å¸å…¨å±€æ—¥å¿—ä¹‹å‰ã€‚ åœ¨æ—¥å¿—çš„å®æ—¶è½¬åŒ–é˜¶æ®µè¿›è¡Œï¼Œè¿™å°†ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„è½¬åŒ–æ—¥å¿—ã€‚ åœ¨å‘ç›®æ ‡ç³»ç»ŸåŠ è½½æ•°æ®æ—¶ï¼Œåšä¸ºåŠ è½½è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†è¿›è¡Œã€‚ ç†æƒ³çš„æ¨¡å½¢æ˜¯ï¼šç”±æ•°æ®çš„ç”Ÿäº§è€…åœ¨æŠŠæ•°æ®å‘å¸ƒåˆ°æ—¥å¿—ä¹‹å‰å¯¹æ•°æ®è¿›è¡Œæ¸…ç†ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ•°æ®çš„æƒå¨æ€§ï¼Œä¸éœ€è¦ç»´æŠ¤å…¶å®ƒçš„é—ç•™ç‰©ä¾‹å¦‚ä¸ºæ•°æ®äº§ç”Ÿçš„ç‰¹æ®Šå¤„ç†ä»£ç æˆ–è€…ç»´æŠ¤è¿™äº›æ•°æ®çš„å…¶å®ƒçš„å­˜å‚¨ç³»ç»Ÿã€‚è¿™äº›ç»†èŠ‚åº”å½“ç”±äº§ç”Ÿæ•°æ®çš„å›¢é˜Ÿæ¥å¤„ç†ï¼Œå› ä¸ºä»–ä»¬æœ€äº†è§£ä»–ä»¬è‡ªå·±çš„æ•°æ®ã€‚è¿™ä¸ªé˜¶æ®µæ‰€ä½¿ç”¨çš„ä»»ä½•é€»è¾‘éƒ½åº”è¯¥æ˜¯æ— æŸçš„å’Œå¯é€†çš„ã€‚\nä»»ä½•å¯ä»¥å®æ—¶å®Œæˆçš„å¢å€¼è½¬åŒ–ç±»å‹éƒ½åº”å½“åŸºäºåŸå§‹æ—¥å¿—è¿›è¡ŒåæœŸå¤„ç†ã€‚è¿™ä¸€è¿‡ç¨‹åŒ…æ‹¬äº†äº‹ä»¶æ•°æ®çš„ä¼šè¯æµç¨‹ï¼Œæˆ–è€…å¢åŠ å¤§ä¼—æ„Ÿå…´è¶£çš„è¡ç”Ÿå­—æ®µã€‚åŸå§‹çš„æ—¥å¿—ä»ç„¶æ˜¯å¯ç”¨çš„ï¼Œä½†æ˜¯è¿™ç§å®æ—¶å¤„ç†äº§ç”Ÿçš„è¡ç”Ÿæ—¥å¿—åŒ…å«äº†å‚æ•°æ•°æ®ã€‚\næœ€ç»ˆï¼Œåªæœ‰é’ˆå¯¹ç›®æ ‡ç³»ç»Ÿçš„èšåˆéœ€è¦åšäº†åŠ è½½æµç¨‹çš„ä¸€éƒ¨åˆ†ã€‚å®ƒåŒ…æ‹¬äº†æŠŠæ•°æ®è½¬åŒ–æˆç‰¹å®šçš„æ˜Ÿå‹æˆ–è€…é›ªèŠ±çŠ¶æ¨¡å¼ï¼Œä»è€Œç”¨äºæ•°æ®ä»“åº“çš„åˆ†æå’ŒæŠ¥è¡¨ã€‚å› ä¸ºåœ¨è¿™ä¸ªé˜¶æ®µï¼Œå¤§éƒ¨åˆ†è‡ªç„¶çš„æ˜ å°„åˆ°ä¼ ç»Ÿçš„ ETL æµç¨‹ä¸­ï¼Œè€Œç°åœ¨å®ƒæ˜¯åœ¨ä¸€ä¸ªæ›´åŠ å¹²å‡€å’Œè§„æ•´çš„æ•°æ®æµé›†åœ¨è¿›è¡Œçš„ï¼Œå®ƒå°†ä¼šæ›´åŠ çš„ç®€å•ã€‚\nLog Files and Events # æˆ‘ä»¬å†æ¥èŠèŠè¿™ç§æ¶æ„çš„ä¼˜åŠ¿ï¼šå®ƒæ”¯æŒè§£è€¦å’Œäº‹ä»¶é©±åŠ¨çš„ç³»ç»Ÿã€‚\nåœ¨ç½‘ç»œè¡Œä¸šå–å¾—æ´»åŠ¨æ•°æ®çš„å…¸å‹æ–¹æ³•æ˜¯æŠŠå®ƒè®°ä¸ºæ–‡æœ¬å½¢å¼çš„æ—¥å¿—ï¼Œè¿™äº›æ–‡æœ¬æ–‡ä»¶æ˜¯å¯åˆ†è§£è¿›å…¥æ•°æ®ä»“åº“æˆ–è€… Hadoopï¼Œç”¨äºèšåˆå’ŒæŸ¥è¯¢å¤„ç†çš„ã€‚ç”±æ­¤äº§ç”Ÿçš„é—®é¢˜ä¸æ‰€æœ‰æ‰¹å¤„ç†çš„ ETL çš„é—®é¢˜æ˜¯ç›¸åŒçš„ï¼šå®ƒè€¦åˆäº†æ•°æ®æµè¿›å…¥æ•°æ®ä»“åº“ç³»ç»Ÿçš„èƒ½åŠ›å’Œæµç¨‹çš„è°ƒåº¦ã€‚\nåœ¨ LinkedIn ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä»¥ä¸­å¿ƒæ—¥å¿—çš„æ–¹å¼æ„å»ºäº†äº‹ä»¶æ•°æ®å¤„ç†ã€‚æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ Kafka åšä¸ºä¸­å¿ƒçš„ã€å¤šè®¢é˜…è€…äº‹ä»¶æ—¥å¿—ã€‚æˆ‘ä»¬å·²ç»å®šä¹‰äº†æ•°ç™¾ç§äº‹ä»¶ç±»å‹ï¼Œæ¯ç§ç±»å‹éƒ½ä¼šæ•è·ç”¨äºç‰¹å®šç±»å‹åŠ¨ä½œçš„ç‹¬ç‰¹çš„å±æ€§ã€‚è¿™å°†ä¼šè¦†ç›–åŒ…æ‹¬é¡µé¢è§†å›¾ã€è¡¨è¾¾å¼ã€æœç´¢ä»¥åŠæœåŠ¡è°ƒç”¨ã€åº”ç”¨å¼‚å¸¸ç­‰æ–¹æ–¹é¢é¢ã€‚\nä¸ºäº†è¿›ä¸€æ­¥ç†è§£è¿™ä¸€ä¼˜åŠ¿ï¼šè®¾æƒ³ä¸€ä¸ªç®€å•çš„äº‹åŠ¡\u0026ndash;åœ¨æ—¥å¿—é¡µé¢æ˜¾ç¤ºå·²å‘å¸ƒçš„æ—¥å¿—ã€‚è¿™ä¸ªæ—¥å¿—é¡µé¢åº”å½“åªåŒ…æ‹¬æ˜¾ç¤ºæ—¥å¿—æ‰€éœ€è¦çš„é€»è¾‘ã€‚ç„¶è€Œï¼Œåœ¨ç›¸å½“å¤šçš„åŠ¨æ€ç«™ç‚¹ä¸­ï¼Œæ—¥å¿—é¡µé¢å¸¸å¸¸å˜çš„æ·»åŠ äº†å¾ˆå¤šä¸æ˜¾ç¤ºæ—¥å¿—æ— å…³çš„é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å°†å¯¹å¦‚ä¸‹çš„ç³»ç»Ÿè¿›è¡Œé›†æˆï¼š\néœ€è¦æŠŠæ•°æ®ä¼ é€åˆ° Hadoop å’Œæ•°æ®ä»“åº“ä¸­ç”¨äºç¦»çº¿æ•°æ®å¤„ç†ã€‚ éœ€è¦å¯¹è§†å›¾è¿›è¡Œç»Ÿè®¡ï¼Œç¡®ä¿è§†å›¾è®¢é˜…è€…ä¸ä¼šç ´åä¸€äº›å†…å®¹ç‰‡æ®µã€‚ éœ€è¦èšåˆè¿™äº›è§†å›¾ï¼Œè§†å›¾å°†ç”¨äºä½œä¸šå‘å¸ƒè€…çš„åˆ†æé¡µé¢æ˜¾ç¤ºã€‚ éœ€è¦è®°å½•è§†å›¾ä»¥ç¡®ä¿æˆ‘ä»¬ä¸ºä½œä¸šæ¨èçš„ä½¿ç”¨è€…æä¾›äº†æ°å½“çš„å°è±¡è¦†ç›–ï¼Œæˆ‘ä»¬ä¸æƒ³ä¸€æ¬¡æ¬¡çš„é‡å¤åŒæ ·çš„äº‹æƒ…ã€‚ æ¨èç³»ç»Ÿéœ€è¦è®°å½•æ—¥å¿—ç”¨äºæ­£ç¡®çš„è·Ÿè¸ªä½œä¸šçš„æ™®åŠåº¦ã€‚ ç­‰ç­‰ã€‚ ä¸ä¹…ï¼Œç®€å•çš„ä½œä¸šæ˜¾ç¤ºå˜å¾—ç›¸å½“çš„å¤æ‚ã€‚æˆ‘ä»¬å¢åŠ äº†ä½œä¸šæ˜¾ç¤ºçš„å…¶å®ƒç»ˆç«¯\u0026ndash;ç§»åŠ¨ç»ˆç«¯åº”ç”¨ç­‰\u0026ndash;è¿™äº›é€»è¾‘å¿…é¡»ç»§ç»­å­˜åœ¨ï¼Œå¤æ‚åº¦ä¸æ–­çš„å¢åŠ ã€‚æ›´ç³Ÿçš„æ˜¯æˆ‘ä»¬éœ€è¦ä¸ä¹‹åšæ¥å£äº¤äº’çš„ç³»ç»Ÿç°åœ¨æ˜¯é”™ç»¼å¤æ‚çš„\u0026ndash;åœ¨ä¸ºæ˜¾ç¤ºæ—¥ä½œä¸šè€Œå·¥ä½œçš„å·¥ç¨‹å¸ˆä»¬éœ€è¦çŸ¥æ™“å¤šä¸ªå…¶å®ƒç³»ç»Ÿå’Œå®ƒä»¬çš„ç‰¹å¾ï¼Œæ‰å¯ä»¥ç¡®ä¿å®ƒä»¬è¢«æ­£ç¡®çš„é›†æˆäº†ã€‚è¿™ä»…ä»…æ˜¯é—®é¢˜çš„ç®€å•ç‰ˆæœ¬ï¼ŒçœŸå®çš„çš„åº”ç”¨ç³»ç»Ÿåªä¼šæ›´åŠ çš„å¤æ‚ã€‚\nâ€œäº‹ä»¶é©±åŠ¨â€çš„æ¨¡å¼æä¾›äº†ä¸€ç§ç®€åŒ–è¿™ç±»é—®é¢˜çš„æœºåˆ¶ã€‚ä½œä¸šæ˜¾ç¤ºé¡µé¢ç°åœ¨åªæ˜¾ç¤ºä½œä¸šå¹¶è®°å½•ä¸æ­£åœ¨æ˜¾ç¤ºçš„ä½œä¸šï¼Œä½œä¸šè®¢é˜…è€…ç›¸å…³çš„å…¶å®ƒå±æ€§ï¼Œå’Œå…¶å®ƒä¸ä½œä¸šæ˜¾ç¤ºç›¸å…³çš„å…¶å®ƒæœ‰ä»·å€¼çš„å±æ€§ã€‚æ¯ä¸ªä¸æ­¤ç›¸å…³çš„å…¶å®ƒç³»ç»Ÿè¯¸å¦‚æ¨èç³»ç»Ÿã€å®‰å…¨ç³»ç»Ÿã€ä½œä¸šæ¨é€åˆ†æç³»ç»Ÿå’Œæ•°æ®ä»“åº“ï¼Œæ‰€æœ‰è¿™äº›åªæ˜¯è®¢é˜…ç§å­æ–‡ä»¶ï¼Œå¹¶è¿›è¡Œå®ƒä»¬çš„æ“ä½œã€‚æ˜¾ç¤ºä»£ç å¹¶ä¸éœ€è¦å…³æ³¨å…¶å®ƒçš„ç³»ç»Ÿï¼Œä¹Ÿä¸éœ€è¦å› ä¸ºå¢åŠ äº†æ•°æ®çš„æ¶ˆè´¹è€…è€Œç›¸åº”çš„è¿›è¡Œå˜æ›´ã€‚\nBuilding a Scalable Log # å½“ç„¶ï¼ŒæŠŠå‘å¸ƒè€…ä¸è®¢é˜…è€…åˆ†ç¦»ä¸å†æ˜¯ä»€ä¹ˆæ–°é²œäº‹äº†ã€‚ä½†æ˜¯å¦‚æœä½ æƒ³è¦ç¡®ä¿æäº¤æ—¥å¿—çš„è¡Œä¸ºå°±åƒå¤šä¸ªè®¢é˜…è€…å®æ—¶çš„åˆ†ç±»æ—¥å¿—é‚£æ ·è®°å½•ç½‘ç«™å‘ç”Ÿçš„æ¯ä»¶äº‹æ—¶ï¼Œå¯æ‰©å±•æ€§å°±ä¼šæˆä¸ºä½ æ‰€é¢ä¸´çš„é¦–è¦æŒ‘æˆ˜ã€‚å¦‚æœæˆ‘ä»¬ä¸èƒ½åˆ›å»ºå¿«é€Ÿã€é«˜æ€§ä»·æ¯”å’Œå¯æ‰©å±•æ€§çµæ´»çš„æ—¥å¿—ä»¥æ»¡è¶³å®é™…çš„å¯æ‰©å±•éœ€æ±‚ï¼ŒæŠŠæ—¥å¿—åšä¸ºç»Ÿä¸€çš„é›†æˆæœºåˆ¶ä¸å†æ˜¯ç¾å¥½çš„æƒ³åƒï¼Œ\näººä»¬æ™®éè®¤ä¸ºåˆ†å¸ƒå¼æ—¥å¿—æ˜¯ç¼“æ…¢çš„ã€é‡é‡ç»çš„æ¦‚å¿µï¼ˆå¹¶ä¸”é€šå¸¸ä¼šæŠŠå®ƒä»…ä»…ä¸â€œåŸæ•°æ®â€ç±»å‹çš„ä½¿ç”¨è”ç³»èµ·æ¥ï¼Œå¯¹äºè¿™ç±»ä½¿ç”¨ Zookeeper å¯ä»¥é€‚ç”¨ï¼‰ã€‚ä½†æ˜¯æ·±å…¥å®ç°å¹¶é‡ç‚¹å…³æ³¨åˆ†ç±»è®°å½•å¤§è§„æ¨¡çš„æ•°æ®æµï¼Œè¿™ç§éœ€æ±‚æ˜¯ä¸åˆ‡å®é™…çš„ã€‚åœ¨ LinkedIn, æˆ‘ä»¬ç°åœ¨æ¯å¤©é€šè¿‡ Kafka è¿è¡Œç€è¶…è¿‡ 600 äº¿ä¸ªä¸åŒçš„æ¶ˆæ¯å†™å…¥ç‚¹(å¦‚æœ ç»Ÿè®¡é•œç›¸ä¸æ•°æ®ä¸­å¿ƒä¹‹é—´çš„å†™å…¥ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å­—ä¼šæ˜¯æ•°åƒäº¿ã€‚)\næˆ‘ä»¬åœ¨ Kafk ä¸­ä½¿ç”¨äº†ä¸€äº›å°æŠ€å·§æ¥æ”¯æŒè¿™ç§å¯æ‰©å±•æ€§ï¼š\næ—¥å¿—åˆ†ç‰‡ é€šè¿‡æ‰¹å¤„ç†è¯»å‡ºå’Œå†™å…¥ä¼˜åŒ–åååŠ› è§„é¿æ— ç”¨çš„æ•°æ®å¤åˆ¶ ä¸ºäº†ç¡®ä¿æ°´å¹³å¯æ‰©å±•æ€§ï¼Œæˆ‘ä»¬æŠŠæ—¥å¿—è¿›è¡Œåˆ‡ç‰‡ï¼š\næ¯ä¸ªåˆ‡ç‰‡éƒ½æ˜¯ä¸€ç¯‡æœ‰åºçš„æ—¥å¿—ï¼Œä½†æ˜¯å„ç‰‡ä¹‹é—´æ²¡æœ‰å…¨å±€çš„æ¬¡åºï¼ˆè¿™ä¸ªæœ‰åˆ«äºä½ å¯èƒ½åŒ…å«åœ¨æ¶ˆæ¯ä¸­çš„æŒ‚é’Ÿæ—¶é—´ï¼‰ã€‚æŠŠæ¶ˆæ¯åˆ†é…åˆ°ç‰¹å®šçš„æ—¥å¿—ç‰‡æ®µè¿™æ˜¯ç”±å†™å…¥è€…æ§åˆ¶çš„ï¼Œå¤§éƒ¨åˆ†ä½¿ç”¨è€…ä¼šé€šè¿‡ç”¨æˆ· ID ç­‰é”®å€¼æ¥è¿›è¡Œåˆ†ç‰‡ã€‚åˆ†ç‰‡å¯ä»¥æŠŠæ—¥å¿—è¿½åŠ åˆ°ä¸å­˜åœ¨åä½œçš„ç‰‡æ®µä¹‹é—´ï¼Œä¹Ÿå¯ä»¥ä½¿ç³»ç»Ÿçš„ååé‡ä¸ Kafka èšç°‡å¤§å°æˆçº¿æ€§æ¯”ä¾‹å…³ç³»ã€‚\næ¯ä¸ªåˆ†ç‰‡éƒ½æ˜¯é€šè¿‡å¯é…ç½®æ•°é‡çš„å¤åˆ¶å“å¤åˆ¶çš„ï¼Œæ¯ä¸ªå¤åˆ¶å“éƒ½æœ‰åˆ†ç‰‡çš„ä¸€ä»½å®Œå…¨ä¸€è‡´çš„æ‹·è´ã€‚æ— è®ºä½•æ—¶ï¼Œå®ƒä»¬ä¸­çš„ä»»ä¸€ä¸ªéƒ½å¯ä»¥åšä¸ºä¸»åˆ†ç‰‡ï¼Œå¦‚æœä¸»åˆ†ç‰‡å‡ºé”™äº†ï¼Œä»»ä½•ä¸€ä¸ªå¤åˆ¶å“éƒ½å¯ä»¥æ¥ç®¡å¹¶åšä¸ºä¸»åˆ†ç‰‡ã€‚\nç¼ºå°‘è·¨åˆ†ç‰‡çš„å…¨å±€é¡ºåºæ˜¯è¿™ä¸ªæœºåˆ¶çš„å±€é™æ€§ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸è®¤ä¸ºå®ƒæœ‰å¤šé‡è¦ã€‚äº‹å®ä¸Šï¼Œä¸æ—¥å¿—çš„äº¤äº’ä¸»è¦æ¥æºäºæˆç™¾ä¸Šåƒä¸ªä¸åŒçš„æµç¨‹ï¼Œä»¥è‡´äºå¯¹äºå®ƒä»¬çš„è¡Œä¸ºæ’ä¸€ä¸ªæ€»ä½“çš„é¡ºåºæ˜¯æ²¡ä»€ä¹ˆæ„ä¹‰çš„ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿çš„æ˜¯æˆ‘ä»¬æä¾›çš„æ¯ä¸ªåˆ†ç‰‡éƒ½æ˜¯æŒ‰é¡ºåºä¿ç•™çš„ã€‚Kafka ä¿è¯äº†è¿½åŠ åˆ°ç”±å•ä¸€å‘é€è€…é€å‡ºçš„ç‰¹å®šåˆ†ç‰‡ä¼šæŒ‰ç…§å‘é€çš„é¡ºåºä¾æ¬¡å¤„ç†ã€‚\næ—¥å¿—ï¼Œå°±åƒæ–‡ä»¶ç³»ç»Ÿä¸€æ ·ï¼Œæ˜¯å®¹æ˜“ä¼˜åŒ–æˆçº¿æ€§å¯è¯»å¯å†™çš„æ ·å¼çš„ã€‚æ—¥å¿—å¯ä»¥æŠŠå°çš„è¯»å…¥å’Œå†™å‡ºç»„åˆæˆå¤§çš„ã€é«˜ååé‡çš„æ“ä½œã€‚Kafka ä¸€ç›´è‡³ç«‹äºå®ç°è¿™ä¸€ä¼˜åŒ–ç›®æ ‡ã€‚æ‰¹å¤„ç†å¯ä»¥å‘ç”Ÿåœ¨ç”±å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€æ•°æ®ã€å†™å…¥ç£ç›˜;åœ¨æœåŠ¡å™¨å„ç«¯ä¹‹é—´å¤åˆ¶ï¼›æ•°æ®ä¼ é€’ç»™æ¶ˆè´¹è€…å’Œç¡®è®¤æäº¤æ•°æ®ç­‰è¯¸å¤šç¯èŠ‚ã€‚\næœ€ç»ˆï¼ŒKafka ä½¿ç”¨ç®€å•çš„äºŒè¿›åˆ¶å½¢å¼ç»´æŠ¤å†…å­˜æ—¥å¿—ï¼Œç£ç›˜æ—¥å¿—å’Œç½‘ç»œæ•°æ®ä¼ é€ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒ…æ‹¬ â€œ0 æ•°æ®å¤åˆ¶ä¼ é€â€åœ¨å†…çš„å¤§é‡çš„ä¼˜åŒ–æœºåˆ¶ã€‚\nè¿™äº›ä¼˜åŒ–çš„ç§¯ç´¯æ•ˆåº”æ˜¯ä½ å¸¸å¸¸è¿›è¡Œçš„å†™å‡ºå’Œè¯»å…¥æ•°æ®çš„æ“ä½œå¯ä»¥åœ¨ç£ç›˜å’Œç½‘ç»œä¸Šå¾—åˆ°æ”¯æŒï¼Œç”šè‡³äºç»´æŠ¤å†…å­˜ä»¥å¤–çš„å¤§é‡æ•°æ®é›†ã€‚ è¿™äº›è¯¦ç»†è®°è¿°å¹¶ä¸æ„å‘³ç€è¿™æ˜¯å…³äº Kafka çš„ä¸»è¦å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘å°±ä¸éœ€è¦äº†è§£ç»†èŠ‚äº†ã€‚ä½ å¯åœ¨ è¿™ä¸ªé“¾æ¥é˜…è¯»åˆ°æ›´å¤šçš„å…³äº LinkedIn çš„æ–¹æ³•ï¼Œå’Œ è¿™ä¸ªé“¾æ¥æ˜¯å…³äº Kafka çš„è®¾è®¡æ€»è¿°ã€‚\nPart Three: Logs \u0026amp; Real-time Stream Processing # åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘åªæ˜¯æè¿°ä»ç«¯åˆ°ç«¯æ•°æ®å¤åˆ¶çš„ç†æƒ³æœºåˆ¶ã€‚ä½†æ˜¯åœ¨å­˜å‚¨ç³»ç»Ÿä¸­æ¬è¿å­—èŠ‚ä¸æ˜¯æ‰€è¦è®²è¿°å†…å®¹çš„å…¨éƒ¨ã€‚æœ€ç»ˆæˆ‘ä»¬å‘ç°æ—¥å¿—æ˜¯æµçš„å¦ä¸€ç§è¯´æ³•ï¼Œæ—¥å¿—æ˜¯ æµå¤„ç†çš„æ ¸å¿ƒã€‚\nä½†æ˜¯ï¼Œç­‰ç­‰ï¼Œä»€ä¹ˆæ˜¯æµå¤„ç†å‘¢ï¼Ÿ\nå¦‚æœä½ æ˜¯ 90 å¹´ä»£æ™šæœŸæˆ–è€… 21 ä¸–çºªåˆ æ•°æ®åº“æ–‡åŒ–æˆ–è€… æ•°æ®åŸºç¡€æ¶æ„äº§å“çš„çˆ±å¥½è€…ï¼Œé‚£ä¹ˆä½ å°±å¯èƒ½ä¼šæŠŠæµå¤„ç†ä¸å»ºåˆ› SQL å¼•æ“æˆ–è€…åˆ›å»ºâ€œç®±å­å’Œç®­å¤´â€æ¥å£ç”¨äºäº‹ä»¶é©±åŠ¨çš„å¤„ç†ç­‰è”ç³»èµ·æ¥ã€‚\nå¦‚æœä½ å…³æ³¨å¼€æºæ•°æ®åº“ç³»ç»Ÿçš„å¤§é‡å‡ºç°ï¼Œä½ å°±å¯èƒ½æŠŠæµå¤„ç†å’Œä¸€äº›å¼€æºæ•°æ®åº“ç³»ç»Ÿå…³è”èµ·æ¥ï¼Œè¿™äº›ç³»ç»ŸåŒ…æ‹¬äº†ï¼š Storm,Akka,S4å’Œ Samza.ä½†æ˜¯å¤§éƒ¨åˆ†äººä¼šæŠŠè¿™äº›ç³»ç»Ÿä½œä¸ºå¼‚æ­¥æ¶ˆæ¯å¤„ç†ç³»ç»Ÿï¼Œè¿™äº›ç³»ç»Ÿä¸æ”¯æŒç¾¤é›†çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨å±‚çš„åº”ç”¨æ²¡ä»€ä¹ˆå·®åˆ«ï¼ˆè€Œäº‹å®ä¸Šåœ¨å¼€æºæ•°æ®åº“ç³»ç»Ÿé¢†åŸŸæŸäº›æ–¹é¢ç¡®å®å¦‚æ­¤ï¼‰ã€‚\nè¿™äº›è§†å›¾éƒ½æœ‰ä¸€äº›å±€é™æ€§ã€‚æµå¤„ç†ä¸ SQL æ˜¯æ— å…³çš„ã€‚å®ƒä¹Ÿå±€é™äºå®æ—¶æµå¤„ç†ã€‚ä¸å­˜åœ¨å†…åœ¨çš„åŸå› é™åˆ¶ä½ ä¸èƒ½å¤„ç†æ˜¨å¤©çš„æˆ–è€…ä¸€ä¸ªæœˆä¹‹å‰çš„æµæ•°æ®ï¼Œä¸”ä½¿ç”¨å¤šç§ä¸åŒçš„è¯­è¨€è¡¨è¾¾è®¡ç®—ã€‚\næˆ‘æŠŠæµå¤„ç†è§†ä¸ºæ›´å¹¿æ³›çš„æ¦‚å¿µï¼šæŒç»­æ•°æ®æµå¤„ç†çš„åŸºç¡€æ¶æ„ã€‚æˆ‘è®¤ä¸ºè®¡ç®—æ¨¡å‹å¯ä»¥åƒ MapReduce æˆ–è€…åˆ†å¸ƒå¼å¤„ç†æ¶æ„ä¸€æ ·æ™®éï¼Œä½†æ˜¯æœ‰èƒ½åŠ›å¤„ç†ä½æ—¶å»¶çš„ç»“æœã€‚\nå¤„ç†æ¨¡å‹çš„å®æ—¶é©±åŠ¨æ˜¯æ•°æ®æ”¶é›†æ–¹æ³•ã€‚æˆæ‰¹æ”¶é›†çš„æ•°æ®æ˜¯åˆ†æ‰¹å¤„ç†çš„ã€‚æ•°æ®æ˜¯ä¸æ–­æ”¶é›†çš„ï¼Œå®ƒä¹Ÿæ˜¯æŒ‰é¡ºåºä¸æ–­å¤„ç†çš„ã€‚\nç¾å›½çš„ç»Ÿè®¡è°ƒæŸ¥å°±æ˜¯æˆæ‰¹æ”¶é›†æ•°æ®çš„è‰¯å¥½å…¸èŒƒã€‚ç»Ÿè®¡è°ƒæŸ¥å‘¨æœŸæ€§çš„å¼€å±•ï¼Œé€šè¿‡æŒ¨é—¨æŒ¨æˆ·çš„èµ°è®¿ï¼Œä½¿ç”¨è›®åŠ›å‘ç°å’Œç»Ÿè®¡ç¾å›½çš„å…¬æ°‘ä¿¡æ¯ã€‚1790 å¹´ç»Ÿè®¡è°ƒæŸ¥åˆšåˆšå¼€å§‹æ—¶è¿™ç§æ–¹å¼æ˜¯å¥æ•ˆçš„ã€‚é‚£æ—¶çš„æ•°æ®æ”¶é›†æ˜¯æ‰¹å¤„ç†çš„ï¼Œå®ƒåŒ…æ‹¬äº†éª‘ç€é©¬æ‚ é—²çš„è¡Œè¿›ï¼ŒæŠŠä¿¡æ¯å†™åœ¨çº¸ä¸Šï¼Œç„¶åæŠŠæˆæ‰¹çš„è®°å½•ä¼ é€åˆ°äººä»¬ç»Ÿè®¡æ•°æ®çš„ä¸­å¿ƒç«™ç‚¹ã€‚ç°åœ¨ï¼Œåœ¨æè¿°è¿™ä¸ªç»Ÿè®¡è¿‡ç¨‹æ—¶ï¼Œäººä»¬ç«‹å³ä¼šæƒ³åˆ°ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ä¿ç•™å‡ºç”Ÿå’Œæ­»äº¡çš„è®°å½•ï¼Œè¿™æ ·å°±å¯ä»¥äº§ç”Ÿäººå£ç»Ÿè®¡ä¿¡æ¯è¿™äº›ä¿¡æ¯æˆ–æ˜¯æŒç»­çš„æˆ–è€…æ˜¯å…¶å®ƒç»´åº¦çš„ã€‚\nè¿™æ˜¯ä¸€ä¸ªæç«¯çš„ä¾‹å­ï¼Œä½†æ˜¯å¤§é‡çš„æ•°æ®ä¼ é€å¤„ç†ä»ç„¶ä¾èµ–äºå‘¨æœŸæ€§çš„è½¬å‚¨ï¼Œæ‰¹é‡è½¬åŒ–å’Œé›†æˆã€‚å¤„ç†å¤§å®¹é‡è½¬å‚¨çš„å”¯ä¸€æ–¹æ³•å°±æ˜¯æ‰¹é‡çš„å¤„ç†ã€‚ä½†æ˜¯éšç€è¿™äº›æ‰¹å¤„ç†è¢«æŒç»­çš„ä¾›ç»™æ‰€å–ä»£ï¼Œäººä»¬è‡ªç„¶è€Œç„¶çš„å¼€å§‹ä¸é—´æ–­çš„å¤„ç†ä»¥å¹³æ»‘çš„å¤„ç†æ‰€éœ€èµ„æºå¹¶ä¸”æ¶ˆé™¤å»¶è¿Ÿã€‚\nä¾‹å¦‚ LinkedIn å‡ ä¹æ²¡æœ‰æ‰¹é‡æ•°æ®æ”¶é›†ã€‚å¤§éƒ¨åˆ†çš„æ•°æ®æˆ–è€…æ˜¯æ´»åŠ¨æ•°æ®æˆ–è€…æ˜¯æ•°æ®åº“å˜æ›´ï¼Œè¿™ä¸¤è€…éƒ½æ˜¯ä¸é—´æ–­å‘ç”Ÿçš„ã€‚äº‹å®ä¸Šï¼Œä½ å¯ä»¥æƒ³åˆ°çš„ä»»ä½•å•†ä¸šï¼Œæ­£å¦‚ï¼šJack Bauer å‘Šè¯‰æˆ‘ä»¬çš„ï¼Œä½å±‚çš„æœºåˆ¶éƒ½æ˜¯å®æ—¶å‘ç”Ÿçš„ä¸é—´æ–­çš„æµç¨‹äº‹ä»¶ã€‚æ•°æ®æ˜¯æˆæ‰¹æ”¶é›†çš„ï¼Œå®ƒæ€»æ˜¯ä¼šä¾èµ–äºä¸€äº›äººä¸ºçš„æ­¥éª¤ï¼Œæˆ–è€…ç¼ºå°‘æ•°å­—åŒ–æˆ–è€…æ˜¯ä¸€äº›è‡ªåŠ¨åŒ–çš„éæ•°å­—åŒ–æµç¨‹å¤„ç†çš„é—ç•™ä¿¡æ¯ã€‚å½“ä¼ é€å’Œå¤„ç†è¿™äº›æ•°æ®çš„æœºåˆ¶æ˜¯é‚®ä»¶æˆ–è€…äººå·¥çš„å¤„ç†æ—¶ï¼Œè¿™ä¸€è¿‡ç¨‹æ˜¯éå¸¸ç¼“æ…¢çš„ã€‚é¦–è½®è‡ªåŠ¨åŒ–æ€»æ˜¯ä¿æŒç€æœ€åˆçš„å¤„ç†å½¢å¼ï¼Œå®ƒå¸¸å¸¸ä¼šæŒç»­ç›¸å½“é•¿çš„æ—¶é—´ã€‚\næ¯å¤©è¿è¡Œçš„æ‰¹é‡å¤„ç†ä½œä¸šå¸¸å¸¸æ˜¯æ¨¡æ‹Ÿäº†ä¸€ç§ä¸€å¤©çš„çª—å£å¤§å°çš„ä¸é—´æ–­è®¡ç®—ã€‚å½“ç„¶ï¼Œä½å±‚çš„æ•°æ®ä¹Ÿç»å¸¸å˜åŒ–ã€‚åœ¨ LinkedIn,è¿™äº›æ˜¯å¸ç©ºè§è´¯çš„ï¼Œå¹¶ä¸”ä½¿å¾—å®ƒä»¬åœ¨ Hadoop è¿è½¬çš„æœºåˆ¶æ˜¯æœ‰æŠ€å·§çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å®æ–½äº†ä¸€æ•´å¥—ç®¡ç†å¢é‡çš„ Hadoop å·¥ä½œæµçš„æ¶æ„ã€‚\nç”±æ­¤çœ‹æ¥ï¼Œå¯¹äºæµå¤„ç†å¯ä»¥æœ‰ä¸åŒçš„è§‚ç‚¹ã€‚æµå¤„ç†åŒ…æ‹¬äº†åœ¨åº•å±‚æ•°æ®å¤„ç†çš„æ—¶é—´æ¦‚å¿µï¼Œå®ƒä¸éœ€è¦æ•°æ®çš„é™æ€å¿«ç…§ï¼Œå®ƒå¯ä»¥äº§ç”Ÿç”¨æˆ·å¯æ§é¢‘ç‡çš„è¾“å‡ºï¼Œè€Œä¸ç”¨ç­‰å¾…æ•°æ®é›†çš„å…¨éƒ¨åˆ°è¾¾ã€‚ä»è¿™ä¸ªè§’åº¦ä¸Šè®²ï¼Œæµå¤„ç†å°±æ˜¯å¹¿ä¹‰ä¸Šçš„æ‰¹å¤„ç†ï¼Œéšç€å®æ—¶æ•°æ®çš„æµè¡Œï¼Œä¼šå„¿æ›´åŠ æ™®éã€‚\nè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä»ä¼ ç»Ÿçš„è§†è§’çœ‹æ¥æµå¤„ç†æ˜¯åˆ©åŸºåº”ç”¨ã€‚æˆ‘ä¸ªäººè®¤ä¸ºæœ€å¤§çš„åŸå› æ˜¯ç¼ºå°‘å®æ—¶æ•°æ®æ”¶é›†ä½¿å¾—ä¸é—´æ–­çš„å¤„ç†æˆä¸ºäº†å­¦æœ¯æ€§çš„æ¦‚å¿µã€‚\næˆ‘æƒ³ç¼ºå°‘å®æ—¶æ•°æ®æ”¶é›†å°±åƒæ˜¯å•†ç”¨æµå¤„ç†ç³»ç»Ÿæ³¨å®šçš„å‘½è¿ã€‚ä»–ä»¬çš„å®¢æˆ·ä»ç„¶éœ€è¦å¤„ç†é¢å‘æ–‡ä»¶çš„ã€æ¯æ—¥æ‰¹é‡å¤„ç† ETL å’Œæ•°æ®é›†æˆã€‚å…¬å¸å»ºè®¾æµå¤„ç†ç³»ç»Ÿå…³æ³¨çš„æ˜¯æä¾›é™„ç€åœ¨å®æ—¶æ•°æ®æµçš„å¤„ç†å¼•æ“ï¼Œä½†æ˜¯æœ€ç»ˆå½“æ—¶æå°‘æ•°äººçœŸæ­£ä½¿ç”¨äº†å®æ—¶æ•°æ®æµã€‚äº‹å®ä¸Šï¼Œåœ¨æˆ‘åœ¨ LinkedIn å·¥ä½œçš„åˆæœŸï¼Œæœ‰ä¸€å®¶å…¬å¸è¯•å›¾æŠŠä¸€ä¸ªéå¸¸æ£’çš„æµå¤„ç†ç³»ç»Ÿé”€å”®ç»™æˆ‘ä»¬ï¼Œä½†æ˜¯å› ä¸ºå½“æ—¶æˆ‘ä»¬çš„å…¨éƒ¨æ•°æ®éƒ½æŒ‰å°æ—¶æ”¶é›†åœ¨çš„æ–‡ä»¶é‡Œï¼Œå½“æ—¶æˆ‘ä»¬æå‡ºçš„æœ€å¥½çš„åº”ç”¨å°±æ˜¯åœ¨æ¯å°æ—¶çš„æœ€åæŠŠè¿™äº›æ–‡ä»¶è¾“å…¥åˆ°æµå¤„ç†ç³»ç»Ÿä¸­ã€‚ä»–ä»¬æ³¨æ„åˆ°è¿™æ˜¯ä¸€ä¸ªæ™®éæ€§çš„é—®é¢˜ã€‚è¿™äº›å¼‚å¸¸è¯æ˜äº†å¦‚ä¸‹è§„åˆ™ï¼šæµå¤„ç†ç³»ç»Ÿè¦æ»¡è¶³çš„é‡è¦å•†ä¸šç›®æ ‡ä¹‹ä¸€æ˜¯ï¼šè´¢åŠ¡ï¼Œ å®ƒæ˜¯å®æ—¶æ•°æ®æµå·²å…·å¤‡çš„åŸºå‡†ï¼Œå¹¶ä¸”æµå¤„ç†å·²ç»æˆä¸ºäº†ç“¶é¢ˆã€‚\nç”šè‡³äºåœ¨ä¸€ä¸ªå¥åº·çš„æ‰¹å¤„ç†ç³»ç»Ÿä¸­ï¼Œæµå¤„ç†ä½œä¸ºä¸€ç§åŸºç¡€æ¶æ„çš„å®é™…åº”ç”¨èƒ½åŠ›æ˜¯ç›¸å½“å¹¿æ³›çš„ã€‚å®ƒè·¨è¶Šäº†å®æ—¶æ•°æ®è¯·æ±‚-åº”ç­”æœåŠ¡å’Œç¦»çº¿æ‰¹é‡å¤„ç†ä¹‹é—´çš„é¸¿æ²Ÿã€‚ç°åœ¨çš„äº’è”ç½‘å…¬å¸ï¼Œå¤§çº¦ 25%çš„ä»£ç å¯ä»¥åˆ’åˆ†åˆ°è¿™ä¸ªç±»å‹ä¸­ã€‚\næœ€ç»ˆè¿™äº›æ—¥å¿—è§£å†³äº†æµå¤„ç†ä¸­ç»å¤§éƒ¨åˆ†å…³é”®çš„æŠ€æœ¯é—®é¢˜ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œå®ƒæ‰€è§£å†³çš„æœ€å¤§çš„é—®é¢˜æ˜¯å®ƒä½¿å¾—å¤šè®¢é˜…è€…å¯ä»¥è·å¾—å®æ—¶æ•°æ®ã€‚å¯¹è¿™äº›æŠ€æœ¯ç»†èŠ‚æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¼€æºçš„ Samza,å®ƒæ˜¯åŸºäºè¿™äº›ç†å¿µå»ºè®¾çš„ä¸€ä¸ªæµå¤„ç†ç³»ç»Ÿã€‚è¿™äº›åº”ç”¨çš„æ›´å¤šæŠ€æœ¯ç»†èŠ‚æˆ‘ä»¬åœ¨ æ­¤æ–‡æ¡£ä¸­æœ‰è¯¦ç»†çš„æè¿°ã€‚\nData flow graphs # æµå¤„ç†æœ€æœ‰è¶£çš„è§’åº¦æ˜¯å®ƒä¸æµå¤„ç†ç³»ç»Ÿå†…éƒ¨æ— å…³ï¼Œä½†æ˜¯ä¸ä¹‹å¯†åˆ‡ç›¸å…³çš„æ˜¯å¦‚ä½•æ‰©å±•äº†æˆ‘ä»¬è°ˆåˆ°çš„æ—©æœŸæ•°æ®é›†æˆçš„æ•°æ®è·å–çš„ç†å¿µã€‚æˆ‘ä»¬ä¸»è¦è®¨è®ºäº†åŸºç¡€æ•°æ®çš„è·å–æˆ–æ—¥å¿—\u0026ndash;äº‹ä»¶å’Œå„ç±»ç³»ç»Ÿæ‰§è¡Œä¸­äº§ç”Ÿçš„æ•°æ®ç­‰ã€‚ä½†æ˜¯æµå¤„ç†å…è®¸æˆ‘ä»¬åŒ…æ‹¬äº†è®¡ç®—å…¶å®ƒæ•°æ®çš„æ•°æ®ã€‚è¿™äº›è¡ç”Ÿçš„æ•°æ®åœ¨æ¶ˆè´¹è€…çœ‹æ¥ä¸ä»–ä»¬è®¡ç®—çš„åŸå§‹æ•°æ®æ²¡ä»€ä¹ˆå·®åˆ«ã€‚è¿™äº›è¡ç”Ÿçš„æ•°æ®å¯ä»¥æŒ‰ä»»æ„çš„å¤æ‚åº¦è¿›è¡Œå‹ç¼©ã€‚\nè®©æˆ‘ä»¬å†æ·±å…¥ä¸€æ­¥ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ï¼šæµå¤„ç†ä½œä¸šå¯ä»¥è¯»å–ä»»æ„çš„æ—¥å¿—å¹¶æŠŠæ—¥å¿—å†™å…¥åˆ°æ—¥å¿—æˆ–è€…å…¶å®ƒçš„ç³»ç»Ÿä¸­ã€‚ä»–ä»¬ç”¨äºè¾“å…¥è¾“å‡ºçš„æ—¥å¿—æŠŠè¿™äº›å¤„ç†å…³è”åˆ°ä¸€ç»„å¤„ç†è¿‡ç¨‹ä¸­ã€‚äº‹å®ä¸Šï¼Œä½¿ç”¨è¿™ç§æ ·å¼çš„é›†ä¸­æ—¥å¿—ï¼Œä½ å¯ä»¥æŠŠç»„ç»‡å…¨éƒ¨çš„æ•°æ®æŠ“å–ã€è½¬åŒ–å’Œå·¥ä½œæµçœ‹æˆæ˜¯ä¸€ç³»åˆ—çš„æ—¥å¿—å’Œå†™å…¥å®ƒä»¬çš„å¤„ç†è¿‡ç¨‹ã€‚\næµå¤„ç†å™¨æ ¹æœ¬ä¸éœ€è¦ç†æƒ³çš„æ¡†æ¶ï¼šå®ƒå¯èƒ½æ˜¯è¯»å†™æ—¥å¿—çš„ä»»ä½•å¤„ç†å™¨æˆ–è€…å¤„ç†å™¨é›†åˆï¼Œä½†æ˜¯é¢å¤–çš„åŸºç¡€è®¾æ–½å’Œè¾…åŠ©å¯ä»¥æä¾›å¸®åŠ©ç®¡ç†å¤„ç†ä»£ç ã€‚\næ—¥å¿—é›†æˆçš„ç›®æ ‡æ˜¯åŒé‡çš„ï¼š\né¦–å…ˆï¼Œå®ƒç¡®ä¿æ¯ä¸ªæ•°æ®é›†éƒ½æœ‰å¤šä¸ªè®¢é˜…è€…å’Œæœ‰åºçš„ã€‚è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹çŠ¶æ€å¤åˆ¶åŸåˆ™æ¥è®°ä½é¡ºåºçš„é‡è¦æ€§ã€‚ä¸ºäº†ä½¿è¿™ä¸ªæ›´åŠ å…·ä½“ï¼Œè®¾æƒ³ä¸€ä¸‹ä»æ•°æ®åº“ä¸­æ›´æ–°æ•°æ®æµ\u0026ndash;å¦‚æœåœ¨å¤„ç†è¿‡ç¨‹ä¸­æˆ‘ä»¬æŠŠå¯¹åŒä¸€è®°å½•çš„ä¸¤æ¬¡æ›´æ–°é‡æ–°æ’åºï¼Œå¯èƒ½ä¼šäº§ç”Ÿé”™è¯¯çš„è¾“å‡ºã€‚ TCP ä¹‹ç±»çš„é“¾æ¥ä»…ä»…å±€é™äºå•ä¸€çš„ç‚¹å¯¹ç‚¹é“¾æ¥ï¼Œè¿™ä¸€é¡ºåºçš„æŒä¹…æ€§è¦ä¼˜äº TCP ä¹‹ç±»çš„é“¾æ¥ï¼Œå®ƒå¯ä»¥åœ¨æµç¨‹å¤„ç†å¤±è´¥å’Œé‡è¿æ—¶ä»ç„¶å­˜åœ¨ã€‚\nç¬¬äºŒï¼Œæ—¥å¿—æä¾›äº†æµç¨‹çš„ç¼“å†²ã€‚è¿™æ˜¯éå¸¸åŸºç¡€çš„ã€‚å¦‚æœå¤„ç†æµç¨‹æ˜¯éåŒæ­¥çš„ï¼Œé‚£ä¹ˆä¸Šè¡Œç”Ÿæˆæµæ•°æ®çš„ä½œä¸šæ¯”ä¸‹è¡Œæ¶ˆè´¹æµæ•°æ®çš„ä½œä¸šè¿è¡Œçš„æ›´å¿«ã€‚è¿™å°†ä¼šå¯¼è‡´å¤„ç†æµç¨‹é˜»å¡ï¼Œæˆ–è€…ç¼“å†²æ•°æ®ï¼Œæˆ–è€…ä¸¢å¼ƒæ•°æ®ã€‚ä¸¢å¼ƒæ•°æ®å¹¶ä¸æ˜¯å¯è¡Œçš„æ–¹æ³•ï¼Œé˜»å¡å°†ä¼šå¯¼è‡´æ•´ä¸ªæµç¨‹å›¾ç«‹å³åœæ­¢ã€‚ æ—¥å¿—å®é™…ä¸Šæ˜¯ä¸€ä¸ªéå¸¸å¤§çš„ç¼“å†²ï¼Œå®ƒå…è®¸æµç¨‹é‡å¯æˆ–è€…åœæ­¢ä½†ä¸ä¼šå½±å“æµç¨‹å›¾å…¶å®ƒéƒ¨åˆ†çš„å¤„ç†é€Ÿåº¦ã€‚å¦‚æœè¦æŠŠæ•°æ®æµæ‰©å±•åˆ°æ›´å¤§è§„æ¨¡çš„ç»„ç»‡ï¼Œå¦‚æœå¤„ç†ä½œä¸šæ˜¯ç”±å¤šä¸ªä¸åŒçš„å›¢é˜Ÿæä¾›çš„ï¼Œè¿™ç§éš”ç¦»æ€§æ˜¯æå…¶é‡çš„ã€‚æˆ‘ä»¬ä¸èƒ½å®¹å¿ä¸€ä¸ªé”™è¯¯çš„ä½œä¸šå¼•å‘åå°çš„å‹åŠ›ï¼Œè¿™ç§å‹åŠ›ä¼šä½¿å¾—æ•´ä¸ªå¤„ç†æµç¨‹åœæ­¢ã€‚\nStormå’Œ Samaè¿™ä¸¤è€…éƒ½æ˜¯æŒ‰éåŒæ­¥æ–¹å¼è®¾è®¡çš„ï¼Œå¯ä»¥ä½¿ç”¨ Kafka æˆ–è€…å…¶å®ƒç±»ä¼¼çš„ç³»ç»Ÿä½œä¸ºå®ƒä»¬çš„æ—¥å¿—ã€‚\nStateful Real-Time Processing # ä¸€äº›å®æ—¶æµå¤„ç†åœ¨è½¬åŒ–æ—¶æ˜¯æ— çŠ¶æ€çš„è®°å½•ã€‚åœ¨æµå¤„ç†ä¸­å¤§éƒ¨åˆ†çš„åº”ç”¨ä¼šæ˜¯ç›¸å½“å¤æ‚çš„ç»Ÿè®¡ã€èšåˆã€ä¸åŒçª—å£ä¹‹é—´çš„å…³è”ã€‚ä¾‹å¦‚æœ‰æ—¶äººä»¬æƒ³æ‰©å¤§åŒ…å«ç”¨æˆ·æ“ä½œä¿¡æ¯çš„äº‹ä»¶æµï¼ˆä¸€ç³»åˆ—çš„å•å‡»åŠ¨ä½œï¼‰\u0026ndash;å®é™…ä¸Šå…³è”äº†ç”¨æˆ·çš„å•å‡»åŠ¨ä½œæµä¸ç”¨æˆ·çš„è´¦æˆ·ä¿¡æ¯æ•°æ®åº“ã€‚ä¸å˜çš„æ˜¯è¿™ç±»æµç¨‹æœ€ç»ˆä¼šéœ€è¦ç”±å¤„ç†å™¨ç»´æŠ¤çš„ä¸€äº›çŠ¶æ€ä¿¡æ¯ã€‚ä¾‹å¦‚æ•°æ®ç»Ÿè®¡æ—¶ï¼Œä½ éœ€è¦ç»Ÿè®¡åˆ°ç›®å‰ä¸ºæ­¢éœ€è¦ç»´æŠ¤çš„è®¡æ•°å™¨ã€‚å¦‚æœå¤„ç†å™¨æœ¬èº«å¤±è´¥äº†ï¼Œå¦‚ä½•æ­£ç¡®çš„ç»´æŠ¤è¿™äº›çŠ¶æ€ä¿¡æ¯å‘¢ï¼Ÿ\næœ€ç®€å•çš„æ›¿æ¢æ–¹æ¡ˆæ˜¯æŠŠè¿™äº›çŠ¶æ€ä¿¡æ¯ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚ä½†æ˜¯å¦‚æœæµç¨‹å´©æºƒï¼Œå®ƒå°±ä¼šä¸¢å¤±ä¸­é—´çŠ¶æ€ã€‚å¦‚æœçŠ¶æ€æ˜¯æŒ‰çª—å£ç»´æŠ¤çš„ï¼Œæµç¨‹å°±ä¼šå›é€€åˆ°æ—¥å¿—ä¸­çª—å£å¼€å§‹çš„æ—¶é—´ç‚¹ä¸Šã€‚ä½†æ˜¯ï¼Œå¦‚æœç»Ÿè®¡æ˜¯æŒ‰å°æ—¶è¿›è¡Œçš„ï¼Œé‚£ä¹ˆè¿™ç§æ–¹å¼å°±ä¼šå˜å¾—ä¸å¯è¡Œã€‚\nå¦ä¸€ä¸ªæ›¿æ¢æ–¹æ¡ˆæ˜¯ç®€å•çš„å­˜å‚¨æ‰€æœ‰çš„çŠ¶æ€ä¿¡æ¯åˆ°è¿œç¨‹çš„å­˜å‚¨ç³»ç»Ÿï¼Œé€šè¿‡ç½‘ç»œä¸è¿™äº›å­˜å‚¨å…³è”èµ·æ¥ã€‚è¿™ç§æœºåˆ¶çš„é—®é¢˜æ˜¯æ²¡æœ‰æœ¬åœ°æ•°æ®å’Œå¤§é‡çš„ç½‘ç»œé—´é€šä¿¡ã€‚\næˆ‘ä»¬å¦‚ä½•æ”¯æŒå¤„ç†è¿‡ç¨‹å¯ä»¥åƒè¡¨ä¸€æ ·åˆ†åŒºçš„æ•°æ®å‘¢?\nå›é¡¾ä¸€ä¸‹å…³äºè¡¨å’Œæ—¥å¿—äºŒç›¸æ€§çš„è®¨è®ºã€‚è¿™ä¸€æœºåˆ¶æä¾›äº†å·¥å…·æŠŠæ•°æ®æµè½¬åŒ–ä¸ºä¸å¤„ç†è¿‡ç¨‹ååŒå®šä½çš„è¡¨ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†è¿™äº›è¡¨çš„å®¹é”™å¤„ç†çš„æœºåˆ¶ã€‚\næµå¤„ç†å™¨å¯ä»¥æŠŠå®ƒçš„çŠ¶æ€ä¿å­˜åœ¨æœ¬åœ°çš„è¡¨æˆ–ç´¢å¼•\u0026ndash; bdb,æˆ–è€… leveldb,ç”šè‡³äºç±»ä¼¼äº Lucene æˆ– fastbit ä¸€æ ·ä¸å¸¸è§çš„ç´¢å¼•ã€‚è¿™äº›å†…å®¹å­˜å‚¨åœ¨å®ƒçš„è¾“å…¥æµä¸­ï¼ˆæˆ–è®¸æ˜¯ä½¿ç”¨ä»»æ„çš„è½¬åŒ–ï¼‰ã€‚ç”Ÿæˆçš„å˜æ›´æ—¥å¿—è®°å½•äº†æœ¬åœ°çš„ç´¢å¼•ï¼Œå®ƒå…è®¸å­˜å‚¨äº‹ä»¶å´©æºƒã€é‡å¯ç­‰çš„çŠ¶æ€ä¿¡æ¯ã€‚æµå¤„ç†æä¾›äº†é€šç”¨çš„æœºåˆ¶ç”¨äºåœ¨æœ¬åœ°è¾“å…¥æµæ•°æ®çš„éšæœºç´¢å¼•ä¸­ä¿å­˜å…±åŒåˆ†ç‰‡çš„çŠ¶æ€ã€‚\nå½“æµç¨‹è¿è¡Œå¤±è´¥æ—¶ï¼Œå®ƒä¼šä»å˜æ›´æ—¥å¿—ä¸­æ¢å¤å®ƒçš„ç´¢å¼•ã€‚æ¯æ¬¡å¤‡ä»½æ—¶ï¼Œæ—¥å¿—æŠŠæœ¬åœ°çŠ¶æ€è½¬åŒ–æˆä¸€ç³»åˆ—çš„å¢é‡è®°å½•ã€‚\nè¿™ç§çŠ¶æ€ç®¡ç†çš„æ–¹æ³•æœ‰ä¸€ä¸ªä¼˜åŠ¿æ˜¯æŠŠå¤„ç†å™¨çš„çŠ¶æ€ä¹Ÿåšä¸ºæ—¥å¿—è¿›è¡Œç»´æŠ¤ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›æ—¥å¿—çœ‹æˆä¸æ•°æ®åº“è¡¨ç›¸å¯¹åº”çš„å˜æ›´æ—¥å¿—ã€‚äº‹å®ä¸Šï¼Œè¿™äº›å¤„ç†å™¨åŒæ—¶ç»´æŠ¤ç€åƒå…±åŒåˆ†ç‰‡è¡¨ä¸€æ ·çš„è¡¨ã€‚å› ä¸ºè¿™äº›çŠ¶æ€å®ƒæœ¬èº«å°±æ˜¯æ—¥å¿—ï¼Œå…¶å®ƒçš„å¤„ç†å™¨å¯ä»¥è®¢é˜…å®ƒã€‚å¦‚æœæµç¨‹å¤„ç†çš„ç›®æ ‡æ˜¯æ›´æ–°ç»“ç‚¹çš„æœ€åçŠ¶æ€ï¼Œè¿™ç§çŠ¶æ€åˆæ˜¯æµç¨‹çš„è¾“å‡ºï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ³•å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚\nä¸ºäº†æ•°æ®é›†æˆï¼Œä¸æ¥è‡ªæ•°æ®åº“çš„æ—¥å¿—å…³è”ï¼Œæ—¥å¿—å’Œæ•°æ®åº“è¡¨çš„äºŒè±¡æ€§å°±æ›´åŠ æ¸…æ™°äº†ã€‚å˜æ›´æ—¥å¿—å¯ä»¥ä»æ•°æ®åº“ä¸­æŠ½å–å‡ºæ¥ï¼Œæ—¥å¿—å¯ä»¥ç”±ä¸åŒçš„æµå¤„ç†å™¨ï¼ˆæµå¤„ç†å™¨ç”¨äºå…³è”ä¸åŒçš„äº‹ä»¶æµï¼‰æŒ‰ä¸åŒçš„æ–¹å¼è¿›è¡Œç´¢å¼•ã€‚\næˆ‘ä»¬å¯ä»¥åˆ—ä¸¾åœ¨ Samza ä¸­æœ‰çŠ¶æ€æµå¤„ç†ç®¡ç†çš„æ›´å¤šç»†èŠ‚å’Œ å¤§é‡å®ç”¨çš„ä¾‹å­ã€‚\nLog Compaction # å½“ç„¶ï¼Œæˆ‘ä»¬ä¸èƒ½å¥¢æœ›ä¿å­˜å…¨éƒ¨å˜æ›´çš„å®Œæ•´æ—¥å¿—ã€‚é™¤éæƒ³è¦ä½¿ç”¨æ— é™ç©ºé—´ï¼Œæ—¥å¿—ä¸å¯èƒ½å®Œå…¨æ¸…é™¤ã€‚ä¸ºäº†æ¾„æ¸…å®ƒï¼Œæˆ‘ä»¬å†æ¥èŠèŠ Kafka çš„å®ç°ã€‚åœ¨ Kafka ä¸­,æ¸…ç†æœ‰ä¸¤ç§é€‰æ‹©ï¼Œè¿™å–å†³äºæ•°æ®æ˜¯å¦åŒ…æ‹¬å…³é”®æ›´æ–°å’Œäº‹ä»¶æ•°æ®ã€‚å¯¹äºäº‹ä»¶æ•°æ®ï¼ŒKafka æ”¯æŒä»…ç»´æŠ¤ä¸€ä¸ªçª—å£çš„æ•°æ®ã€‚é€šå¸¸ï¼Œé…ç½®éœ€è¦ä¸€äº›æ—¶é—´ï¼Œçª—å£å¯ä»¥æŒ‰æ—¶é—´æˆ–ç©ºé—´å®šä¹‰ã€‚è™½ç„¶å¯¹äºå…³é”®æ•°æ®è€Œè¨€ï¼Œå®Œæ•´æ—¥å¿—çš„é‡è¦ç‰¹å¾æ˜¯ä½ å¯ä»¥é‡ç°æºç³»ç»Ÿçš„çŠ¶æ€ä¿¡æ¯ï¼Œæˆ–è€…åœ¨å…¶å®ƒçš„ç³»ç»Ÿé‡ç°ã€‚\néšç€æ—¶é—´çš„æ¨ç§»ï¼Œä¿æŒå®Œæ•´çš„æ—¥å¿—ä¼šä½¿ç”¨è¶Šæ¥è¶Šå¤šçš„ç©ºé—´ï¼Œé‡ç°æ‰€è€—è´¹çš„æ—¶é—´è¶Šæ¥è¶Šé•¿ã€‚å› äº›åœ¨ Kafka ä¸­,æˆ‘ä»¬æ”¯æŒä¸åŒç±»å‹çš„ä¿ç•™ã€‚æˆ‘ä»¬ç§»é™¤äº†åºŸå¼ƒçš„è®°å½•(è¿™äº›è®°å½•çš„ä¸»é”®æœ€è¿‘æ›´æ–°è¿‡)è€Œä¸æ˜¯ç®€å•çš„ä¸¢å¼ƒæ—§æ—¥å¿—ã€‚æˆ‘ä»¬ä»ç„¶ä¿è¯æ—¥å¿—åŒ…å«äº†æºç³»ç»Ÿçš„å®Œæ•´å¤‡ä»½ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬ä¸å†é‡ç°åŸç³»ç»Ÿçš„å…¨éƒ¨çŠ¶æ€ï¼Œè€Œæ˜¯ä»…ä»…é‡ç°æœ€è¿‘çš„çŠ¶æ€ã€‚æˆ‘ä»¬æŠŠè¿™ä¸€ç‰¹å¾ç§°ä¸º æ—¥å¿—å‹ç¼©ã€‚\nPart Four: System Building # æˆ‘ä»¬æœ€åè¦è®¨è®ºçš„æ˜¯åœ¨çº¿æ•°æ®ç³»ç»Ÿè®¾è®¡ä¸­æ—¥å¿—çš„è§’è‰²ã€‚\nåœ¨åˆ†å¸ƒå¼æ•°æ®åº“æ•°æ®æµä¸­æ—¥å¿—çš„è§’è‰²å’Œåœ¨å¤§å‹ç»„ç»‡æœºæ„æ•°æ®å®Œæ•´ä¸­æ—¥å¿—çš„è§’è‰²æ˜¯ç›¸ä¼¼çš„ã€‚åœ¨è¿™ä¸¤ä¸ªåº”ç”¨åœºæ™¯ä¸­ï¼Œæ—¥å¿—æ˜¯å¯¹äºæ•°æ®æºæ˜¯å¯é çš„ï¼Œä¸€è‡´çš„å’Œå¯æ¢å¤çš„ã€‚ç»„ç»‡å¦‚æœä¸æ˜¯ä¸€ä¸ªå¤æ‚çš„åˆ†å¸ƒå¼æ•°æ®ç³»ç»Ÿå‘¢ï¼Œå®ƒç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿ\nåˆ†ç±»è®¡ä»·å—ï¼Ÿ(Unbundling) # å¦‚æœæ¢ä¸ªè§’åº¦ï¼Œä½ å¯ä»¥çœ‹åˆ°æŠŠæ•´ä¸ªç»„ç»‡ç³»ç»Ÿå’Œæ•°æ®æµçœ‹åšæ˜¯å•ä¸€çš„åˆ†å¸ƒå¼æ•°æ®ç³»ç»Ÿã€‚ä½ å¯ä»¥æŠŠæ‰€æœ‰çš„å­æŸ¥è¯¢ç³»ç»Ÿï¼ˆè¯¸å¦‚ Redis, SOLR,Hive è¡¨ç­‰ï¼‰çœ‹æˆæ˜¯æ•°æ®çš„ç‰¹å®šç´¢å¼•ã€‚ä½ å¯ä»¥æŠŠ Storm æˆ– Samza ä¸€æ ·çš„æµå¤„ç†ç³»ç»Ÿçœ‹æˆæ˜¯å‘å±•è‰¯å¥½çš„è§¦å‘å™¨å’Œè§†å›¾å…·ä½“åŒ–æœºåˆ¶ã€‚æˆ‘å·²ç»æ³¨æ„åˆ°ï¼Œä¼ ç»Ÿçš„æ•°æ®åº“ç®¡ç†äººå‘˜éå¸¸å–œæ¬¢è¿™æ ·çš„è§†å›¾ï¼Œå› ä¸ºå®ƒæœ€ç»ˆè§£é‡Šäº†è¿™äº›ä¸åŒçš„æ•°æ®ç³»ç»Ÿåˆ°åº•æ˜¯åšä»€ä¹ˆç”¨çš„\u0026ndash;å®ƒä»¬åªæ˜¯ä¸åŒçš„ç´¢å¼•ç±»å‹è€Œå·²ã€‚\nä¸å¯å¦è®¤è¿™ç±»æ•°æ®åº“ç³»ç»Ÿç°åœ¨å¤§é‡çš„å‡ºç°ï¼Œä½†æ˜¯äº‹å®ä¸Šï¼Œè¿™ç§å¤æ‚æ€§ä¸€ç›´éƒ½å­˜åœ¨ã€‚å³ä½¿æ˜¯åœ¨å…³ç³»æ•°æ®åº“ç³»ç»Ÿçš„é¼ç››æ—¶æœŸï¼Œç»„ç»‡ä¸­æœ‰å¤§é‡çš„å…³ç³»æ•°æ®åº“ç³»ç»Ÿã€‚æˆ–è®¸è‡ªå¤§å‹æœºæ—¶ä»£å¼€å§‹ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½å­˜å‚¨åœ¨ç›¸åŒçš„ä½ç½®ï¼ŒçœŸæ­£çš„é›†æˆæ˜¯æ ¹æœ¬ä¸å­˜åœ¨çš„ã€‚å­˜åœ¨å¤šç§å¤–åœ¨éœ€æ±‚ï¼Œéœ€è¦æŠŠæ•°æ®åˆ†è§£æˆå¤šä¸ªç³»ç»Ÿï¼Œè¿™äº›å¤–åœ¨éœ€æ±‚åŒ…æ‹¬ï¼šè§„æ¨¡ã€åœ°ç†å› ç´ ã€å®‰å…¨æ€§ï¼Œæ€§èƒ½éš”ç¦»æ˜¯æœ€å¸¸è§çš„å› ç´ ã€‚è¿™äº›éœ€æ±‚éƒ½å¯ä»¥ç”±ä¸€ä¸ªä¼˜è´¨çš„ç³»ç»Ÿå®ç°ï¼šä¾‹å¦‚ï¼Œç»„ç»‡å¯ä»¥ä½¿ç”¨å•ä¸€çš„ Hadoop èšç°‡ï¼Œå®ƒåŒ…æ‹¬äº†å…¨éƒ¨çš„æ•°æ®ï¼Œå¯ä»¥æœåŠ¡äºå¤§å‹çš„å’Œå¤šæ ·æ€§çš„å®¢æˆ·ã€‚\nå› æ­¤åœ¨å‘åˆ†å¸ƒå¼ç³»ç»Ÿå˜è¿çš„è¿‡ç¨‹ä¸­ï¼Œå·²ç»å­˜åœ¨ä¸€ç§å¤„ç†æ•°æ®çš„ç®€ä¾¿çš„æ–¹æ³•ï¼šæŠŠå¤§é‡çš„ä¸åŒç³»ç»Ÿçš„å°çš„å®ä¾‹èšåˆæˆä¸ºå¤§çš„èšç°‡ã€‚è®¸å¤šçš„ç³»ç»Ÿè¿˜ä¸è¶³ä»¥æ”¯æŒè¿™ä¸€æ–¹æ³•ï¼šå› ä¸ºå®ƒä»¬ä¸å¤Ÿå®‰å…¨ï¼Œæˆ–è€…æ€§èƒ½éš”ç¦»æ€§å¾—ä¸åˆ°ä¿è¯ï¼Œæˆ–è€…è§„æ¨¡ä¸ç¬¦åˆè¦æ±‚ã€‚ä¸è¿‡è¿™äº›é—®é¢˜éƒ½æ˜¯å¯ä»¥è§£å†³çš„ã€‚\nä¾æˆ‘ä¹‹è§ï¼Œä¸åŒç³»ç»Ÿå¤§é‡å‡ºç°çš„åŸå› æ˜¯å»ºè®¾åˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿå¾ˆå›°éš¾ã€‚é€šè¿‡å‰Šå‡åˆ°å•ä¸€çš„æŸ¥è¯¢æˆ–è€…ç”¨ä¾‹ï¼Œæ¯ä¸ªç³»ç»Ÿéƒ½å¯ä»¥æŠŠè§„æ¨¡æ§åˆ¶åˆ°æ˜“äºå®ç°çš„ç¨‹åº¦ã€‚ä½†æ˜¯è¿è¡Œè¿™äº›ç³»ç»Ÿäº§ç”Ÿçš„å¤æ‚åº¦ä¾ç„¶å¾ˆé«˜ã€‚\næœªæ¥è¿™ç±»é—®é¢˜å¯èƒ½çš„å‘å±•è¶‹åŠ¿æœ‰ä¸‰ç§ï¼š\nç¬¬ä¸€ç§å¯èƒ½æ˜¯ä¿æŒç°çŠ¶ï¼šå­¤ç«‹çš„ç³»ç»Ÿè¿˜ä¼šæˆ–é•¿æˆ–çŸ­çš„æŒç»­ä¸€æ®µæ—¶é—´ã€‚è¿™æ˜¯å› ä¸ºå»ºè®¾åˆ†å¸ƒå¼ç³»ç»Ÿçš„å›°éš¾å¾ˆéš¾å…‹æœï¼Œæˆ–è€…å› ä¸ºå­¤ç«‹ç³»ç»Ÿçš„ç‹¬ç‰¹æ€§å’Œä¾¿æ·æ€§å¾ˆéš¾è¾¾åˆ°ã€‚åŸºäºè¿™äº›åŸå› ï¼Œæ•°æ®é›†æˆçš„æ ¸å¿ƒé—®é¢˜ä»ç„¶æ˜¯å¦‚ä½•æ°å½“çš„ä½¿ç”¨æ•°æ®ã€‚å› æ­¤ï¼Œé›†æˆæ•°æ®çš„å¤–éƒ¨æ—¥å¿—éå¸¸çš„é‡è¦ã€‚\nç¬¬äºŒç§å¯èƒ½æ˜¯é‡æ„ï¼šå…·å¤‡é€šç”¨æ€§çš„å•ä¸€çš„ç³»ç»Ÿé€æ­¥èåˆå¤šä¸ªåŠŸèƒ½å½¢æˆè¶…æç³»ç»Ÿã€‚è¿™ä¸ªè¶…çº§ç³»ç»Ÿè¡¨é¢çœ‹èµ·æ¥ç±»ä¼¼å…³ç³»æ•°æ®åº“ç³»ç»Ÿï¼Œä½†æ˜¯åœ¨ç»„ç»‡ä¸­ä½ ä½¿ç”¨æ—¶æœ€å¤§çš„ä¸åŒæ˜¯ä½ åªéœ€è¦ä¸€ä¸ªå¤§çš„ç³»ç»Ÿè€Œä¸æ˜¯æ— æ•°ä¸ªå°ç³»ç»Ÿã€‚åœ¨è¿™ä¸ªä¸–ç•Œé‡Œï¼Œé™¤äº†åœ¨ç³»ç»Ÿå†…å·²è§£å†³çš„è¿™ä¸ªé—®é¢˜ä¸å­˜åœ¨ä»€ä¹ˆçœŸæ­£çš„æ•°æ®é›†æˆé—®é¢˜ã€‚æˆ‘æƒ³è¿™æ˜¯å› ä¸ºå»ºè®¾è¿™æ ·çš„ç³»ç»Ÿçš„å®é™…å›°éš¾ã€‚\nè™½ç„¶å¦ä¸€ç§å¯èƒ½çš„ç»“æœå¯¹äºå·¥ç¨‹å¸ˆæ¥è¯´æ˜¯å¾ˆæœ‰å¸å¼•åŠ›çš„ã€‚æ–°ä¸€ä»£æ•°æ®åº“ç³»ç»Ÿçš„ç‰¹å¾ä¹‹ä¸€æ˜¯å®ƒä»¬æ˜¯å®Œå…¨å¼€æºçš„ã€‚å¼€æºæä¾›äº†ä¸€ç§å¯èƒ½æ€§ï¼šæ•°æ®åŸºç¡€æ¶æ„ä¸å¿…æ‰“åŒ…æˆæœåŠ¡é›†æˆ–è€…é¢å‘åº”ç”¨çš„ç³»ç»Ÿæ¥å£ã€‚åœ¨ Java æ ˆä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°åœ¨ä¸€å®šç¨‹åº¦ä¸Šï¼Œè¿™ç§çŠ¶å†µå·²ç»å‘ç”Ÿäº†ã€‚\nZookeeperç”¨äºå¤„ç†å¤šä¸ªç³»ç»Ÿä¹‹é—´çš„åè°ƒï¼Œæˆ–è®¸ä¼šä»è¯¸å¦‚ Helix æˆ–è€… Curatorç­‰é«˜çº§åˆ«çš„æŠ½è±¡ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ã€‚ Mesoså’Œ YARNç”¨äºå¤„ç†æµç¨‹å¯è§†åŒ–å’Œèµ„æºç®¡ç†ã€‚ Luceneå’Œ LevelDBç­‰åµŒå…¥å¼ç±»åº“åšä¸ºç´¢å¼•ã€‚ Netty, Jettyå’Œ Finagle, rest.liç­‰å°è£…æˆé«˜çº§åˆ«çš„ç”¨äºå¤„ç†è¿œç¨‹é€šä¿¡ã€‚ Avro, Protocol Buffers, Thriftå’Œ umpteen zillionç­‰å…¶å®ƒç±»åº“ç”¨äºå¤„ç†åºåˆ—åŒ–ã€‚ Kafkaå’Œ Bookeeperæä¾›æ”¯æŒæ—¥å¿—ã€‚ å¦‚æœä½ æŠŠè¿™äº›å †æ”¾åœ¨ä¸€èµ·ï¼Œæ¢ä¸ªè§’åº¦çœ‹ï¼Œå®ƒæœ‰ç‚¹åƒæ˜¯ç®€åŒ–ç‰ˆçš„åˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿå·¥ç¨‹ã€‚ä½ å¯ä»¥æŠŠè¿™äº›æ‹¼è£…åœ¨ä¸€èµ·ï¼Œåˆ›å»ºå¤§é‡çš„å¯èƒ½çš„ç³»ç»Ÿã€‚æ˜¾è€Œæ˜“è§ï¼Œç°åœ¨æ¢è®¨çš„ä¸æ˜¯æœ€ç»ˆç”¨æˆ·æ‰€å…³å¿ƒçš„ API æˆ–è€…å¦‚ä½•å®ç°ï¼Œè€Œæ˜¯åœ¨ä¸æ–­å¤šæ ·åŒ–å’Œæ¨¡å—åŒ–çš„è¿‡ç¨‹ä¸­å¦‚ä½•è®¾è®¡å®ç°å•ä¸€ç³»ç»Ÿçš„é€”å¾„ã€‚å› ä¸ºéšç€å¯é çš„ã€çµæ´»çš„æ¨¡å—çš„å‡ºç°ï¼Œå®æ–½åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ—¶é—´å‘¨æœŸç”±å¹´ç¼©å‡ä¸ºå‘¨ï¼Œèšåˆå½¢æˆå¤§å‹æ•´ä½“ç³»ç»Ÿçš„å‹åŠ›é€æ­¥æ¶ˆå¤±ã€‚\nThe place of the log in system architecture # é‚£äº›æä¾›å¤–éƒ¨æ—¥å¿—çš„ç³»ç»Ÿå¦‚ä»Šå·²å…è®¸ä¸ªäººç”µè„‘æŠ›å¼ƒä»–ä»¬è‡ªèº«å¤æ‚çš„æ—¥å¿—ç³»ç»Ÿè½¬è€Œä½¿ç”¨å…±äº«æ—¥å¿—ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œæ—¥å¿—å¯ä»¥åšåˆ°ä»¥ä¸‹äº‹æƒ…ï¼š\né€šè¿‡å¯¹èŠ‚ç‚¹çš„å¹¶å‘æ›´æ–°çš„æ’åºå¤„ç†æ•°æ®çš„ä¸€è‡´æ€§ï¼ˆæ— è®ºåœ¨åŠæ—¶è¿˜æ˜¯æœ€ç»ˆæƒ…å†µä¸‹ï¼‰ æä¾›èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®å¤åˆ¶ æä¾›â€commitâ€œè¯­æ³•ï¼ˆåªæœ‰å½“å†™å…¥å™¨ç¡®ä¿æ•°æ®ä¸ä¼šä¸¢å¤±æ—¶æ‰ä¼šå†™å…¥ï¼‰ ä½ç³»ç»Ÿæä¾›å¤–éƒ¨çš„æ•°æ®è®¢é˜…èµ„æº æä¾›å­˜å‚¨å¤±è´¥çš„å¤åˆ¶æ“ä½œå’Œå¼•å¯¼æ–°çš„å¤åˆ¶æ“ä½œçš„èƒ½åŠ› å¤„ç†èŠ‚ç‚¹é—´çš„æ•°æ®å¹³è¡¡ è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°æ®åˆ†å‘ç³»ç»Ÿæœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå‰©ä¸‹çš„å¤§éƒ¨åˆ†å†…å®¹ä¸ç»ˆç«¯è°ƒç”¨çš„ API å’Œç´¢å¼•ç­–ç•¥ç›¸å…³ã€‚è¿™æ­£æ˜¯ä¸åŒç³»ç»Ÿé—´çš„å·®å¼‚æ‰€åœ¨ï¼Œä¾‹å¦‚ï¼šä¸€ä¸ªå…¨æ–‡æœ¬æŸ¥è¯¢è¯­å¥éœ€è¦æŸ¥è¯¢æ‰€æœ‰çš„åˆ†åŒºï¼Œè€Œä¸€ä¸ªä¸»é”®æŸ¥è¯¢åªéœ€è¦æŸ¥è¯¢è´Ÿè´£é”®æ•°æ®çš„å•ä¸ªèŠ‚ç‚¹å°±å¯ä»¥äº†ã€‚\nä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹è¯¥ç³»ç»Ÿæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ç³»ç»Ÿè¢«åˆ†ä¸ºä¸¤ä¸ªé€»è¾‘åŒºåŸŸï¼šæ—¥å¿—å’ŒæœåŠ¡å±‚ã€‚æ—¥å¿—æŒ‰é¡ºåºæ•è·çŠ¶æ€å˜åŒ–ï¼ŒæœåŠ¡èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•æä¾›æŸ¥è¯¢æœåŠ¡éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ï¼ˆé”®-å€¼çš„å­˜å‚¨å¯èƒ½ä»¥ B-tree æˆ– SSTable çš„æ–¹å¼è¿›è¡Œï¼Œè€Œæœç´¢ç³»ç»Ÿå¯èƒ½å­˜åœ¨ä¸ä¹‹ç›¸åçš„ç´¢å¼•ï¼‰ã€‚å†™å…¥å™¨å¯ä»¥ç›´æ¥è®¿é—®æ—¥å¿—ï¼Œå°½ç®¡éœ€è¦é€šè¿‡æœåŠ¡å±‚ä»£ç†ã€‚åœ¨å†™å…¥æ—¥å¿—çš„æ—¶å€™ä¼šäº§ç”Ÿé€»è¾‘æ—¶é—´æˆ³ï¼ˆå³ log ä¸­çš„ç´¢å¼•ï¼‰ï¼Œå¦‚æœç³»ç»Ÿæ˜¯åˆ†æ®µå¼çš„ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿä¸æ®µæ•°ç›®ç›¸åŒæ•°é‡çš„æ—¥å¿—æ–‡ä»¶å’ŒæœåŠ¡èŠ‚ç‚¹ï¼Œè¿™é‡Œçš„æ•°é‡å’Œæœºå™¨æ•°é‡å¯èƒ½ä¼šæœ‰è¾ƒå¤§å·®è·ã€‚\næœåŠ¡èŠ‚ç‚¹è®¢é˜…æ—¥å¿—ä¿¡æ¯å¹¶å°†å†™å…¥å™¨æŒ‰ç…§æ—¥å¿—å­˜å‚¨çš„é¡ºåºå°½å¿«åº”ç”¨åˆ°å®ƒçš„æœ¬åœ°ç´¢å¼•ä¸Šã€‚\nå®¢æˆ·ç«¯åªè¦åœ¨æŸ¥è¯¢è¯­å¥ä¸­æä¾›å¯¹åº”çš„å†™å…¥å™¨çš„æ—¶é—´æˆ³ï¼Œå®ƒå°±å¯ä»¥ä»ä»»ä½•èŠ‚ç‚¹ä¸­è·å–â€è¯»å†™â€œè¯­ä¹‰ã€‚æœåŠ¡èŠ‚ç‚¹æ”¶åˆ°è¯¥æŸ¥è¯¢è¯­å¥åä¼šå°†å…¶ä¸­çš„æ—¶é—´æˆ³ä¸è‡ªèº«çš„ç´¢å¼•æ¯”è¾ƒï¼Œå¦‚æœå¿…è¦ï¼ŒæœåŠ¡èŠ‚ç‚¹ä¼šå»¶è¿Ÿè¯·æ±‚ç›´åˆ°å¯¹åº”æ—¶é—´çš„ç´¢å¼•å»ºç«‹å®Œæ¯•ï¼Œä»¥å…æä¾›æ—§æ•°æ®ã€‚\næœåŠ¡èŠ‚ç‚¹æˆ–è®¸æ ¹æœ¬æ— éœ€çŸ¥é“â€æ§åˆ¶â€œæˆ–â€lerder é€‰ä¸¾ï¼ˆleader electionï¼‰â€œçš„æ¦‚å¿µï¼Œå¯¹å¾ˆå¤šç®€å•çš„æ“ä½œï¼ŒæœåŠ¡èŠ‚ç‚¹å¯ä»¥çˆ±å®Œå…¨è„±ç¦»é¢†å¯¼çš„æƒ…å†µä¸‹æä¾›æœåŠ¡ï¼Œæ—¥å¿—å³æ˜¯ä¿¡æ¯çš„æ¥æºã€‚\nåˆ†å‘ç³»ç»Ÿæ‰€éœ€è¦åšçš„å…¶ä¸­ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„å·¥ä½œï¼Œå°±æ˜¯ä¿®å¤å¤±è´¥èŠ‚ç‚¹å¹¶ç§»é™¤å‡ ç‚¹ä¹‹é—´çš„éš”ç¦»ã€‚ä¿ç•™ä¿®å¤çš„æ•°æ®å¹¶ç»“åˆä¸Šå„åŒºåŸŸå†…çš„æ•°æ®å¿«ç…§æ˜¯ä¸€ç§è¾ƒä¸ºå…¸å‹çš„åšæ³•ï¼Œå®ƒä¸ä¿ç•™å®Œæ•´çš„æ•°æ®å¤‡ä»½å¹¶ä» åƒåœ¾ç®±å†…å›æ”¶æ—¥å¿—çš„åšæ³•å‡ ä¹ç­‰ä»·ã€‚è¿™å°±ä½¿å¾—æœåŠ¡å±‚ç®€å•äº†å¾ˆå¤šï¼Œæ—¥å¿—ç³»ç»Ÿä¹Ÿæ›´æœ‰é’ˆå¯¹æ€§ã€‚\næœ‰äº†è¿™ä¸ªæ—¥å¿—ç³»ç»Ÿï¼Œä½ å¯ä»¥è®¢é˜…åˆ°APIï¼Œè¿™ä¸ªAPIæä¾›äº†æŠŠETLæä¾›ç»™å…¶å®ƒç³»ç»Ÿçš„æ•°æ®å†…å®¹ã€‚äº‹å®ä¸Šï¼Œè®¸å¤šç³»ç»Ÿéƒ½å¯ä»¥å…±äº«ç›¸åŒçš„æ—¥å¿—åŒæ—¶æä¾›ä¸åŒçš„ç´¢å¼•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nè¿™ä¸ªç³»ç»Ÿçš„è§†å›¾å¯ä»¥æ¸…æ™°çš„åˆ†è§£åˆ°æ—¥å¿—å’ŒæŸ¥è¯¢API,å› ä¸ºå®ƒå…è®¸ä½ ä»ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œä¸€è‡´æ€§è§’åº¦åˆ†è§£æŸ¥è¯¢çš„ç‰¹å¾ã€‚è¿™å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¯¹ç³»ç»Ÿè¿›è¡Œåˆ†è§£ï¼Œå¹¶ç†è§£é‚£äº›å¹¶æ²¡æŒ‰è¿™ç§æ–¹å¼è®¾è®¡å®æ–½çš„ç³»ç»Ÿã€‚\nè™½ç„¶Kafkaå’ŒBookeeperéƒ½æ˜¯ä¸€è‡´æ€§æ—¥å¿—ï¼Œä½†è¿™ä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿæ²¡ä»€ä¹ˆæ„ä¹‰ã€‚ä½ å¯ä»¥è½»æ¾çš„æŠŠDynamoä¹‹ç±»çš„æ•°æ®æ„åˆ†è§£ä¸ºä¸€è‡´æ€§çš„APæ—¥å¿—å’Œé”®å€¼å¯¹æœåŠ¡å±‚ã€‚è¿™æ ·çš„æ—¥å¿—ä½¿ç”¨èµ·æ¥çµæ´»ï¼Œå› ä¸ºå®ƒé‡ä¼ äº†æ—§æ¶ˆæ¯ï¼ŒåƒDynamoä¸€æ ·ï¼Œè¿™æ ·çš„å¤„ç†å–å†³äºæ¶ˆæ¯çš„è®¢é˜…è€…ã€‚\nåœ¨å¾ˆå¤šäººçœ‹æ¥ï¼Œåœ¨æ—¥å¿—ä¸­å¦å¤–ä¿å­˜ä¸€ä»½æ•°æ®çš„å®Œæ•´å¤æœ¬æ˜¯ä¸€ç§æµªè´¹ã€‚äº‹å®ä¸Šï¼Œè™½ç„¶æœ‰å¾ˆå¤šå› ç´ ä½¿å¾—è¿™ä»¶äº‹å¹¶ä¸å›°éš¾ã€‚é¦–å…ˆï¼Œæ—¥å¿—å¯ä»¥æ˜¯ä¸€ç§æœ‰æ•ˆçš„å­˜å‚¨æœºåˆ¶ã€‚æˆ‘ä»¬åœ¨Kafkaç”Ÿäº§ç¯å¢ƒçš„æœåŠ¡å™¨ä¸Šå­˜å‚¨äº†5 TBçš„æ•°æ®ã€‚åŒæ—¶æœ‰è®¸å¤šçš„æœåŠ¡ç³»ç»Ÿéœ€è¦æ›´å¤šçš„å†…å­˜æ¥æä¾›æœ‰æ•ˆçš„æ•°æ®æœåŠ¡ï¼Œä¾‹å¦‚æ–‡æœ¬æœç´¢ï¼Œå®ƒé€šå¸¸æ˜¯åœ¨å†…å­˜ä¸­çš„ã€‚æœåŠ¡ç³»ç»ŸåŒæ ·ä¹Ÿéœ€æ ·ç¡¬ç›˜çš„ä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„å®æ—¶æ•°æ®ç³»ç»Ÿæˆ–è€…åœ¨å†…å­˜å¤–æä¾›æœåŠ¡æˆ–è€…ä½¿ç”¨å›ºæ€ç¡¬ç›˜ã€‚ç›¸åï¼Œæ—¥å¿—ç³»ç»Ÿåªéœ€è¦çº¿æ€§çš„è¯»å†™ï¼Œå› æ­¤ï¼Œå®ƒå¾ˆä¹äºä½¿ç”¨TBé‡çº§çš„ç¡¬ç›˜ã€‚æœ€ç»ˆï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç”±å¤šä¸ªç³»ç»Ÿæä¾›çš„æ•°æ®ï¼Œæ—¥å¿—çš„æˆæœ¬åˆ†æ‘Šåˆ°å¤šä¸ªç´¢å¼•ä¸Šï¼Œè¿™ç§èšåˆä½¿å¾—å¤–éƒ¨æ—¥å¿—çš„æˆæœ¬é™åˆ°äº†æœ€ä½ç‚¹ã€‚\nLinkedInå°±æ˜¯ä½¿ç”¨äº†è¿™ç§æ–¹å¼å®ç°å®ƒçš„å¤šä¸ªå®æ—¶æŸ¥è¯¢ç³»ç»Ÿçš„ã€‚è¿™äº›ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªæ•°æ®åº“ï¼ˆä½¿ç”¨æ•°æ®æ€»çº¿åšä¸ºæ—¥å¿—æ‘˜è¦ï¼Œæˆ–è€…ä»Kafkaå»æ‰ä¸“ç”¨çš„æ—¥å¿—ï¼‰ï¼Œè¿™äº›ç³»ç»Ÿåœ¨é¡¶å±‚æ•°æ®æµä¸Šè¿˜æä¾›äº†ç‰¹æ®Šçš„åˆ†ç‰‡ã€ç´¢å¼•å’ŒæŸ¥è¯¢åŠŸèƒ½ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å®æ–½æœç´¢ã€ç¤¾äº¤ç½‘ç»œå’ŒOLAPæŸ¥è¯¢ç³»ç»Ÿçš„æ–¹å¼ã€‚äº‹å®ä¸Šè¿™ç§æ–¹å¼æ˜¯ç›¸å½“æ™®éçš„ï¼šä¸ºå¤šä¸ªç”¨äºå®æ—¶æœåŠ¡çš„æœåŠ¡ç³»ç»Ÿæä¾›å•ä¸€çš„æ•°æ®ï¼ˆè¿™äº›æ¥è‡ªHadoopçš„æ•°æ®æˆ–æ˜¯å®æ—¶çš„æˆ–æ˜¯è¡ç”Ÿçš„ï¼‰ã€‚è¿™ç§æ–¹å¼å·²è¢«è¯å®æ˜¯ç›¸å½“ç®€æ´çš„ã€‚è¿™äº›ç³»ç»Ÿæ ¹æœ¬ä¸éœ€è¦å¤–éƒ¨å¯å†™å…¥çš„APIï¼ŒKafkaå’Œæ•°æ®åº“è¢«ç”¨åšç³»ç»Ÿçš„è®°å½•å’Œå˜æ›´æµï¼Œé€šè¿‡æ—¥å¿—ä½ å¯ä»¥æŸ¥è¯¢ç³»ç»Ÿã€‚æŒæœ‰ç‰¹å®šåˆ†ç‰‡çš„ç»“ç‚¹åœ¨æœ¬åœ°å®Œæˆå†™æ“ä½œã€‚è¿™äº›ç»“ç‚¹ç›²ç›®çš„æŠŠæ—¥å¿—æä¾›çš„æ•°æ®è½¬å½•åˆ°å®ƒä»¬è‡ªå·±çš„å­˜å‚¨ç©ºé—´ä¸­ã€‚é€šè¿‡å›æ”¾ä¸Šè¡Œæµæ—¥å¿—å¯ä»¥æ¢å¤è½¬å½•å¤±è´¥çš„ç»“ç‚¹ã€‚\nè¿™äº›ç³»ç»Ÿçš„ç¨‹åº¦åˆ™å–å†³äºæ—¥å¿—çš„å¤šæ ·æ€§ã€‚ä¸€ä¸ªå®Œå…¨å¯é çš„ç³»ç»Ÿå¯ä»¥ç”¨æ—¥å¿—æ¥å¯¹æ•°æ®åˆ†ç‰‡ã€å­˜å‚¨ç»“ç‚¹ã€å‡è¡¡è´Ÿè½½ï¼Œä»¥åŠç”¨äºæ•°æ®ä¸€è‡´æ€§å’Œæ•°æ®å¤åˆ¶ç­‰å¤šæ–¹é¢ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å±‚å®é™…ä¸Šåªä¸è¿‡æ˜¯ä¸€ç§ç¼“å­˜æœºåˆ¶ï¼Œè¿™ç§ç¼“å­˜æœºåˆ¶å…è®¸ç›´æ¥å†™å…¥æ—¥å¿—çš„æµå¤„ç†ã€‚\nç»“æŸè¯­ # å¦‚æœä½ å¯¹äºæœ¬æ–‡ä¸­æ‰€è°ˆåˆ°çš„å…³äºæ—¥å¿—çš„å¤§éƒ¨å†…å®¹ï¼Œå¦‚ä¸‹å†…å®¹æ˜¯æ‚¨å¯ä»¥å‚è€ƒçš„å…¶å®ƒèµ„æ–™ã€‚å¯¹äºåŒä¸€äº‹åŠ¡äººä»¬ä¼šç”¨ä¸åŒçš„æœ¯è¯­ï¼Œè¿™ä¼šè®©äººæœ‰ä¸€äº›å›°æƒ‘ï¼Œä»æ•°æ®åº“ç³»ç»Ÿåˆ°åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä»å„ç±»ä¼ä¸šçº§åº”ç”¨è½¯ä»¶åˆ°å¹¿é˜”çš„å¼€æºä¸–ç•Œã€‚æ— è®ºå¦‚ä½•ï¼Œåœ¨å¤§æ–¹å‘ä¸Šè¿˜æ˜¯æœ‰ä¸€äº›å…±åŒä¹‹å¤„ã€‚\nreferences # å‚è€ƒç¿»è¯‘ éƒ¨åˆ†è‡ªå·±ç¿»è¯‘ï¼Œå¤§æ®µçš„æŠ„è¿™é‡Œçš„ç¿»è¯‘ï½ å‚è€ƒæ–‡çŒ®è§æ­¤ "},{"id":25,"href":"/posts/db/newdb/","title":"Newdb","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šç®€å•ä»‹ç»æœ€è¿‘è‡ªå·±æœ€è¿‘è®¾è®¡å®ç° newdb çš„å·¥ä½œ\né¡¹ç›®åœ°å€ anydemo/newdb\næœ€è¿‘ä¸€æ®µæ—¶é—´èŠ±äº†å¾ˆå¤§çš„åŠ›æ°”å­¦ä¹ æ•°æ®åº“çš„çŸ¥è¯†ï¼Œè®¾è®¡å®ç°äº†ç®€å•çš„ RDBMS, æ”¶è·æ¯”è¾ƒä¸°å¯Œ\nå¼€å§‹å…ˆä»æ•°æ®åº“åº•å±‚çš„æ•°æ®æŒä¹…åŒ–å¼€å§‹ã€‚å†æ­¤è®¾è®¡çš„æ•°æ®åº“ä¸»è¦æ˜¯å›ºå®šç±»å‹å¤§å°çš„å…³ç³»å‹æ•°æ®åº“ã€‚ä¸€ä¸ª table ä¸­æœ‰å›ºå®šå¤§å°çš„ä¸€å®šæ•°é‡çš„æ•°æ®åˆ—ï¼Œæ¯ä¸€ä¸ª tuple çš„å¤§å°æ˜¯å›ºå®šä¸å˜çš„ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ª page çš„å¯ä»¥å®¹çº³çš„ tuple æ˜¯ä¸€å®šçš„ï¼Œè¿™æ ·å¾ˆå®¹æ˜“åœ¨è®°å½•æŸä¸€ä¸ª tuple çš„ä½ç½®ã€ä»¥åŠå…¶åœ¨æ–‡ä»¶ä¸­çš„ä½ç½®ã€‚åœ¨è¿™è¿‡ç¨‹ä¸­æ”¶è·æœ€å¤§çš„éƒ¨åˆ†å°±æ˜¯å¯¹äº Marshal äº Unmarshal çš„ç†è§£æ›´è¿›ä¸€æ­¥ï¼ŒçŸ¥é“æ•°æ®å¦‚ä½•åœ¨æ•°æ®åº“ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Œä»¥åŠäº‹åŠ¡çš„æœ¬è´¨ã€‚\næœ€åé€šè¿‡ä¸€ä¸ª Sequences Scan çš„ä¾‹å­ï¼Œæ‰‹å†™ä¸€ä¸ªç‰©ç†æ‰§è¡Œè®¡åˆ’ï¼Œæ‰§è¡Œä¸€æ¬¡å…¨è¡¨æ‰«æã€‚\næœªæ¥è¿˜æœ‰å¾ˆå¤šçš„å†…å®¹å¯ä»¥åšï¼Œæš‚æ—¶å‘Šä¸€æ®µè½ï¼Œæœ€è¿‘æŠ½æ—¶é—´æ²‰æ·€ä¸€ä¸‹ï¼Œæ€è€ƒä¸€ä¸‹æœªæ¥ï¼Œå›å¤´æœ‰æ—¶é—´äº†å†å›å¤´ç»§ç»­åŠ æ–°çš„å†…å®¹ã€‚æ¯•ç«Ÿ issuesç§¯æ”’äº†å¤ªå¤šã€‚\n"},{"id":26,"href":"/posts/Go/rpc-ipc/","title":"Go å¯åŠ¨å¤šä¸ªç¨‹åºï¼ŒåŠ IPC å’Œ RPC äº¤äº’ä¾‹å­,ä»¥åŠ Gracefully Shutdown","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šGo ç¨‹åºå¯åŠ¨ RPC å­è¿›ç¨‹ï¼Œé€šè¿‡ pipe è¿›è¡Œäº¤äº’ï¼Œä»¥åŠé€šè¿‡ RPC äº¤äº’\nä»£ç è§ exfly/go-ipc\nå¼•è¨€ # ä¸ºä»€ä¹ˆè¦å†™è¿™ç¯‡æ–‡ç« ã€‚æœ€è¿‘çœ‹äº†ä¸€äº› Docker æºç ã€‚dockerd çš„æ¶æ„é•¿ è¿™ä¸ªæ ·å­ã€‚ ä¸€æ¡ docker å‘½ä»¤çš„æ‰§è¡Œï¼Œæ¯”å¦‚docker runï¼Œæ˜¯å…ˆç”± containerd æ‰§è¡Œï¼Œcontainerd ä¹ŸåŒæ ·ä¸æ˜¯çœŸæ­£è¿è¡Œå®¹å™¨ï¼Œä»–ä¼šå°†æ‰§è¡Œè¯·æ±‚å‘ç»™ runcï¼Œæœ‰ runc çœŸæ­£å»æ‰§è¡Œã€‚dockerdã€containderdã€runc åˆ†åˆ«æ˜¯ä¸‰ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä»–ä»¬æ˜¯é€šè¿‡ ç®¡é“ï¼ˆIPCï¼‰ä»¥åŠ restã€RPC è¿›è¡Œäº¤äº’çš„ã€‚\nä¸ºäº†å±•ç¤ºä¸‰è€…äº¤äº’æ–¹å¼æ˜¯å¦‚ä½•è¿›è¡Œçš„ï¼Œè¿™é‡Œå†™ä¸€ä¸ªç®€å•çš„ demo æ¥è§£é‡Šã€‚\næ­£æ–‡ # RPC # é¦–å…ˆè¯´ä¸€ä¸‹ RPCã€‚Go æ ‡å‡†åº“ä¾¿æœ‰net/rpcï¼Œå†™ä¸€ä¸ª Go çš„ rpc å¾ˆç®€å•ï¼š\npackage main import ( \u0026#34;log\u0026#34; \u0026#34;net\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;net/rpc\u0026#34; ) type Task []string type Todo {ID string} func (t Task) Get(id string, reply *Todo) error { *reply=Todo{ID:id} return nil } func main() { task := new(Task) // Publish the receivers methods err := rpc.Register(task) if err != nil { log.Fatal(\u0026#34;Format of service Task isn\u0026#39;t correct. \u0026#34;, err) } // Register a HTTP handler rpc.HandleHTTP() listener, e := net.Listen(\u0026#34;unix\u0026#34;, \u0026#34;rpc.sock\u0026#34;) if e != nil { log.Fatal(\u0026#34;Listen error: \u0026#34;, e) } err = http.Serve(listener, nil) if err != nil { log.Fatal(\u0026#34;Error serving: \u0026#34;, err) } } // client client, err := rpc.DialHTTP(\u0026#34;unix\u0026#34;, \u0026#34;rpc.sock\u0026#34;) reply := TODO{} err = client.Call(\u0026#34;Task.Get\u0026#34;, \u0026#34;new_id\u0026#34;, \u0026amp;reply) å¦‚ä½•è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡ IPC å‘¢ # é¦–å…ˆ linux ä¸‹çš„ FIFOï¼ˆæœ‰åç®¡é“ï¼‰æ˜¯ä»€ä¹ˆæ ·å­çš„\nmkfifo tpipe ll # total 8 # drwx------ 2 vagrant vagrant 4096 May 18 17:28 ./ # drwxrwxrwt 10 root root 4096 May 18 17:28 ../ # prw-rw-r-- 1 vagrant vagrant 0 May 18 17:28 tpipe| # ç°åœ¨ä¸€ä¸ªterminal cat tpipe # å¦ä¸€ä¸ªterminal echo tttttttttt \u0026gt; tpipe æ­¤æ—¶ç¬¬ä¸€ä¸ª terminal ä¼šè¾“å‡º ttttttttttï¼Œå¦ä¸€ä¸ªå‘½ä»¤è¡Œä¼šè¿”å›\nåœ¨ Go ä¸­åº”è¯¥å¦‚ä½•ä½¿ç”¨\nrpcSvrCmd := exec.Command(conf.RPCSvrBinPath) rpcSvrStdinPipe, err := rpcSvrCmd.StdinPipe() rpcSvrStdoutPipe, err := rpcSvrCmd.StdoutPipe() rpcSvrStderrPipe, err := rpcSvrCmd.StderrPipe() rpcSvrCmd.Start() å¦‚æ­¤å³å¯è·å¾—å­è¿›ç¨‹çš„å„ç§ FIFO\nå®Œæ•´ä¾‹å­ # ä»£ç è§ exfly/go-ipc\nmake task rpc \u0026amp;\u0026amp; ./bin/task # â–¶ running gofmtâ€¦ # â–¶ running golintâ€¦ # â–¶ building executableâ€¦ # â–¶ building executableâ€¦ # 2019/05/19 01:33:12 sleep 1s to wait rpc server startup # 2019/05/19 01:33:13 2019/05/19 01:33:12 Serving RPC server on {unix rpc.sock} # 2019/05/19 01:33:13 Finish App: {Finish App Started} # 2019/05/19 01:33:13 2019/05/19 01:33:13 stop the server # 2019/05/19 01:33:13 2019/05/19 01:33:13 deleted socket file: rpc.sock # 2019/05/19 01:33:13 pipe rpc_srv_stderr has Closed # 2019/05/19 01:33:13 pipe rpc_srv_stdout has Closed # 2019/05/19 01:33:13 stop subproc ./bin/task-rpc success å½“å‰æ›´æ–°ä¸»è¦ä»¥å‘å¸ƒä»£ç ä¸ºä¸»ï¼Œæ²¡æœ‰è¯¦ç»†è§£é‡Šï¼Œè¯¦ç»†è§ä»£ç  exfly/go-ipc\n"},{"id":27,"href":"/posts/docker/docker-volume/","title":"Docker æºç é˜…è¯»: Docker Volume","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šæè¿° docker volume çš„åŸç†\ndocker å­˜å‚¨åŸºäº UnionFS å®ç°ï¼Œæ‰€æœ‰å®¹å™¨å­˜å‚¨æ˜¯å°†å¤šä¸ª layout å±‚é€šè¿‡ç±»ä¼¼ aufs æˆ–è€… overlay2 å°†å¤šä¸ªå±‚è”åˆåˆ°ä¸€èµ·ï¼Œmount æˆæ–°çš„ç›®å½•ï¼Œåœ¨é€šè¿‡ namespaces å°†æ–°çš„æ–‡ä»¶ç›®å½• chroot è¿›å…¥æ–°å¯åŠ¨çš„è¿›ç¨‹ï¼Œè¾¾åˆ°æ–‡ä»¶éš”ç¦»çš„ç›®çš„ã€‚\nå¯¹äºè¯»è¯·æ±‚ï¼Œç”±äºå†™å®å¤åˆ¶æŠ€æœ¯ï¼Œä¼šç›´æ¥è¯»å–åº•å±‚æ–‡ä»¶ å¯¹äºå†™è¯·æ±‚ï¼Œä¼šå…ˆå°†æ–‡ä»¶å¤åˆ¶åˆ°è¯»å†™å±‚ï¼Œç„¶åè¿›è¡Œä¿®æ”¹æ–‡ä»¶ å¯¹äºåˆ é™¤ï¼Œæ²¡æœ‰çœŸæ­£åˆ é™¤æ–‡ä»¶ï¼Œåªæ˜¯è®²æ–‡ä»¶æ ‡è®°åˆ é™¤ï¼Œæ²¡æœ‰çœŸæ­£åˆ é™¤ä¸‹å±‚æ–‡ä»¶ã€‚ å‘½ä»¤ # docker volume create volume-for-testå¯ä»¥åˆ›å»ºæ–°çš„ volume\ndocker volume ls æŸ¥çœ‹æ–°åˆ›å»ºçš„ volume\ndocker volume inspect volume-for-test\ndocker run -d --name devtest --mount source=volume-for-test,target=/app alpine /bin/sh\ndocker inspect \u0026lt;container_id\u0026gt;| grap Mounts å¯ä»¥çœ‹åˆ°åˆšåˆš mount è¿›å»çš„ volume /var/lib/docker/volumes/volume-for-test/_data\nrelated links # Manage data in Docker Use volumes docker å­˜å‚¨åŸºç¡€ "},{"id":28,"href":"/posts/docker/docker-build/","title":"Docker æºç é˜…è¯»: Docker Build","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šdocker build æºç é˜…è¯»\né˜…è¯»æºç é¡ºåº # api/server/router/build/build_routes.go#postBuild api/server/backend/build/backend.go#Build builder/builder-next/builder.go#Build builder/dockerfile/builder.go#Build builder/dockerfile/builder.go#dispatchDockerfileWithCancellation builder/dockerfile/evaluator.go#dispatchï¼Œåœ¨è¿™é‡Œï¼Œæœ‰æ‰€æœ‰å‘½ä»¤çš„æ‰§è¡Œæ–¹å¼ï¼Œå¯ä»¥ä»”ç»†ç ”ç©¶ä¸€ä¸‹ åœ¨dispatchä¸­æœ‰ dockerfile æ”¯æŒçš„æŒ‡ä»¤ï¼Œå¦‚RUNç­‰ã€‚ä»¥ RUN ä¸ºä¾‹ï¼Œdockerd ä¼šè¯»å– CLI å‘æ¥çš„ dockerfileï¼Œè§£æåã€‚å¦‚æœä¸º RUNï¼Œåˆ™ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„ container,ç„¶ååœ¨å®¹å™¨ä¸­æ‰§è¡Œï¼Œæ‰§è¡Œç»“æŸåå°†å½“å‰å±‚ commitï¼Œç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæŒ‡ä»¤.\nå…¶ä»– # ä» v18.09å¼€å§‹ï¼Œdocker build ä¾èµ–äº buildkit "},{"id":29,"href":"/posts/docker/docker-run/","title":"Docker æºç é˜…è¯»: Docker Run","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šé€šè¿‡åˆ†æ docker run å‘½ä»¤ï¼Œç†è§£ Docker çš„å·¥ä½œåŸç†\ndocker runæ‰§è¡Œæµç¨‹åˆ†æ # æ•´ä½“æ‰§è¡Œæµç¨‹: ä»æœ¬åœ°é•œåƒä¸­å¯»æ‰¾æ˜¯å¦å­˜åœ¨å‘½ä»¤æŒ‡å®šé•œåƒï¼Œå¦‚æœå­˜åœ¨åˆ™æ­£å¸¸è¿”å›ï¼Œæ‰§è¡Œæ¥ä¸‹æ¥æµç¨‹ã€‚å¦‚æœä¸å­˜åœ¨é•œåƒï¼Œdeamon è¿”å›é”™è¯¯ï¼Œç”± cli é‡æ–°å‘èµ· pull è¯·æ±‚ï¼Œä¹‹åé‡è¯•ã€‚\næ€»ä½“æè¿° # createContainer cli é€šè¿‡ rest æ¥å£è¯·æ±‚ dockerd åˆ›å»ºå®¹å™¨ï¼Œdockerd è®¾ç½®åŸºç¡€é…ç½®åè®°å½•åˆ›å»ºçš„å®¹å™¨ ContainerStart cli é€šè¿‡ rest æ¥å£è¯·æ±‚ dockerd è¿è¡Œå®¹å™¨ï¼Œdockerd ä½¿ç”¨ rpc é“¾æ¥ containnerd è¿›è¡Œè¿è¡Œå®¹å™¨ ä»£ç  lanything/code-read forked moby/moby, lanything/cli forked docker/cli\ncreateContainer # docker/cli cli/command/container/run.go#NewRunCommand docker/cli cli/command/container/run.go#runContainer // cli/command/container/create.go#createContainer func createContainer(ctx context.Context, dockerCli command.Cli, containerConfig *containerConfig, opts *createOptions) (*container.ContainerCreateCreatedBody, error) { config := containerConfig.Config hostConfig := containerConfig.HostConfig networkingConfig := containerConfig.NetworkingConfig stderr := dockerCli.Err() warnOnOomKillDisable(*hostConfig, stderr) warnOnLocalhostDNS(*hostConfig, stderr) var ( trustedRef reference.Canonical namedRef reference.Named ) containerIDFile, err := newCIDFile(hostConfig.ContainerIDFile) if err != nil { return nil, err } defer containerIDFile.Close() ref, err := reference.ParseAnyReference(config.Image) if err != nil { return nil, err } if named, ok := ref.(reference.Named); ok { namedRef = reference.TagNameOnly(named) if taggedRef, ok := namedRef.(reference.NamedTagged); ok \u0026amp;\u0026amp; !opts.untrusted { var err error trustedRef, err = image.TrustedReference(ctx, dockerCli, taggedRef, nil) if err != nil { return nil, err } config.Image = reference.FamiliarString(trustedRef) } } //create the container response, err := dockerCli.Client().ContainerCreate(ctx, config, hostConfig, networkingConfig, opts.name) //if image not found try to pull it if err != nil { if apiclient.IsErrNotFound(err) \u0026amp;\u0026amp; namedRef != nil { fmt.Fprintf(stderr, \u0026#34;Unable to find image \u0026#39;%s\u0026#39; locally\\n\u0026#34;, reference.FamiliarString(namedRef)) // we don\u0026#39;t want to write to stdout anything apart from container.ID if err := pullImage(ctx, dockerCli, config.Image, opts.platform, stderr); err != nil { return nil, err } if taggedRef, ok := namedRef.(reference.NamedTagged); ok \u0026amp;\u0026amp; trustedRef != nil { if err := image.TagTrusted(ctx, dockerCli, trustedRef, taggedRef); err != nil { return nil, err } } // Retry var retryErr error response, retryErr = dockerCli.Client().ContainerCreate(ctx, config, hostConfig, networkingConfig, opts.name) if retryErr != nil { return nil, retryErr } } else { return nil, err } } for _, warning := range response.Warnings { fmt.Fprintf(stderr, \u0026#34;WARNING: %s\\n\u0026#34;, warning) } err = containerIDFile.Write(response.ID) return \u0026amp;response, err } docker/cli cli/command/container/create.go#createContainer è°ƒç”¨ ContainerCreate moby/moby api/server/router/container/container.go#initRoutes.postContainersCreate moby/moby api/server/router/container/container_routes.go#postContainersCreate moby/moby daemon/create.go#ContainerCreate containerCreate # // `moby/moby` daemon/create.go#containerCreate func (daemon *Daemon) containerCreate(opts createOpts) (containertypes.ContainerCreateCreatedBody, error) { start := time.Now() if opts.params.Config == nil { return containertypes.ContainerCreateCreatedBody{}, errdefs.InvalidParameter(errors.New(\u0026#34;Config cannot be empty in order to create a container\u0026#34;)) } os := runtime.GOOS if opts.params.Config.Image != \u0026#34;\u0026#34; { img, err := daemon.imageService.GetImage(opts.params.Config.Image) if err == nil { os = img.OS } } else { // This mean scratch. On Windows, we can safely assume that this is a linux // container. On other platforms, it\u0026#39;s the host OS (which it already is) if runtime.GOOS == \u0026#34;windows\u0026#34; \u0026amp;\u0026amp; system.LCOWSupported() { os = \u0026#34;linux\u0026#34; } } warnings, err := daemon.verifyContainerSettings(os, opts.params.HostConfig, opts.params.Config, false) if err != nil { return containertypes.ContainerCreateCreatedBody{Warnings: warnings}, errdefs.InvalidParameter(err) } err = verifyNetworkingConfig(opts.params.NetworkingConfig) if err != nil { return containertypes.ContainerCreateCreatedBody{Warnings: warnings}, errdefs.InvalidParameter(err) } if opts.params.HostConfig == nil { opts.params.HostConfig = \u0026amp;containertypes.HostConfig{} } err = daemon.adaptContainerSettings(opts.params.HostConfig, opts.params.AdjustCPUShares) if err != nil { return containertypes.ContainerCreateCreatedBody{Warnings: warnings}, errdefs.InvalidParameter(err) } container, err := daemon.create(opts) if err != nil { return containertypes.ContainerCreateCreatedBody{Warnings: warnings}, err } containerActions.WithValues(\u0026#34;create\u0026#34;).UpdateSince(start) if warnings == nil { warnings = make([]string, 0) // Create an empty slice to avoid https://github.com/moby/moby/issues/38222 } return containertypes.ContainerCreateCreatedBody{ID: container.ID, Warnings: warnings}, nil } GetImages # // GetImage returns an image corresponding to the image referred to by refOrID. func (i *ImageService) GetImage(refOrID string) (*image.Image, error) { ref, err := reference.ParseAnyReference(refOrID) if err != nil { return nil, errdefs.InvalidParameter(err) } namedRef, ok := ref.(reference.Named) if !ok { digested, ok := ref.(reference.Digested) if !ok { return nil, ErrImageDoesNotExist{ref} } id := image.IDFromDigest(digested.Digest()) if img, err := i.imageStore.Get(id); err == nil { return img, nil } return nil, ErrImageDoesNotExist{ref} } if digest, err := i.referenceStore.Get(namedRef); err == nil { // Search the image stores to get the operating system, defaulting to host OS. id := image.IDFromDigest(digest) if img, err := i.imageStore.Get(id); err == nil { return img, nil } } // Search based on ID if id, err := i.imageStore.Search(refOrID); err == nil { img, err := i.imageStore.Get(id) if err != nil { return nil, ErrImageDoesNotExist{ref} } return img, nil } return nil, ErrImageDoesNotExist{ref} } ImageService.imageStore åœ¨mobydaemon/daemon.go#NewDaemon ä¸­æœ‰è®¾ç½® ImageService.imageStore åœ¨mobyimage/store.go#NewImageStore æœ‰åˆå§‹åŒ–\nContainerStart # moby daemon/start.go#ContainerStart\nfunc (daemon *Daemon) ContainerStart(name string, hostConfig *containertypes.HostConfig, checkpoint string, checkpointDir string) error { if checkpoint != \u0026#34;\u0026#34; \u0026amp;\u0026amp; !daemon.HasExperimental() { return errdefs.InvalidParameter(errors.New(\u0026#34;checkpoint is only supported in experimental mode\u0026#34;)) } container, err := daemon.GetContainer(name) if err != nil { return err } validateState := func() error { container.Lock() defer container.Unlock() if container.Paused { return errdefs.Conflict(errors.New(\u0026#34;cannot start a paused container, try unpause instead\u0026#34;)) } if container.Running { return containerNotModifiedError{running: true} } if container.RemovalInProgress || container.Dead { return errdefs.Conflict(errors.New(\u0026#34;container is marked for removal and cannot be started\u0026#34;)) } return nil } if err := validateState(); err != nil { return err } // Windows does not have the backwards compatibility issue here. if runtime.GOOS != \u0026#34;windows\u0026#34; { // This is kept for backward compatibility - hostconfig should be passed when // creating a container, not during start. if hostConfig != nil { logrus.Warn(\u0026#34;DEPRECATED: Setting host configuration options when the container starts is deprecated and has been removed in Docker 1.12\u0026#34;) oldNetworkMode := container.HostConfig.NetworkMode if err := daemon.setSecurityOptions(container, hostConfig); err != nil { return errdefs.InvalidParameter(err) } if err := daemon.mergeAndVerifyLogConfig(\u0026amp;hostConfig.LogConfig); err != nil { return errdefs.InvalidParameter(err) } if err := daemon.setHostConfig(container, hostConfig); err != nil { return errdefs.InvalidParameter(err) } newNetworkMode := container.HostConfig.NetworkMode if string(oldNetworkMode) != string(newNetworkMode) { // if user has change the network mode on starting, clean up the // old networks. It is a deprecated feature and has been removed in Docker 1.12 container.NetworkSettings.Networks = nil if err := container.CheckpointTo(daemon.containersReplica); err != nil { return errdefs.System(err) } } container.InitDNSHostConfig() } } else { if hostConfig != nil { return errdefs.InvalidParameter(errors.New(\u0026#34;Supplying a hostconfig on start is not supported. It should be supplied on create\u0026#34;)) } } // check if hostConfig is in line with the current system settings. // It may happen cgroups are umounted or the like. if _, err = daemon.verifyContainerSettings(container.OS, container.HostConfig, nil, false); err != nil { return errdefs.InvalidParameter(err) } // Adapt for old containers in case we have updates in this function and // old containers never have chance to call the new function in create stage. if hostConfig != nil { if err := daemon.adaptContainerSettings(container.HostConfig, false); err != nil { return errdefs.InvalidParameter(err) } } return daemon.containerStart(container, checkpoint, checkpointDir, true) } moby daemon/start.go#containerStart\n// containerStart prepares the container to run by setting up everything the // container needs, such as storage and networking, as well as links // between containers. The container is left waiting for a signal to // begin running. func (daemon *Daemon) containerStart(container *container.Container, checkpoint string, checkpointDir string, resetRestartManager bool) (err error) { start := time.Now() container.Lock() defer container.Unlock() if resetRestartManager \u0026amp;\u0026amp; container.Running { // skip this check if already in restarting step and resetRestartManager==false return nil } if container.RemovalInProgress || container.Dead { return errdefs.Conflict(errors.New(\u0026#34;container is marked for removal and cannot be started\u0026#34;)) } if checkpointDir != \u0026#34;\u0026#34; { // TODO(mlaventure): how would we support that? return errdefs.Forbidden(errors.New(\u0026#34;custom checkpointdir is not supported\u0026#34;)) } // if we encounter an error during start we need to ensure that any other // setup has been cleaned up properly defer func() { if err != nil { container.SetError(err) // if no one else has set it, make sure we don\u0026#39;t leave it at zero if container.ExitCode() == 0 { container.SetExitCode(128) } if err := container.CheckpointTo(daemon.containersReplica); err != nil { logrus.Errorf(\u0026#34;%s: failed saving state on start failure: %v\u0026#34;, container.ID, err) } container.Reset(false) daemon.Cleanup(container) // if containers AutoRemove flag is set, remove it after clean up if container.HostConfig.AutoRemove { container.Unlock() if err := daemon.ContainerRm(container.ID, \u0026amp;types.ContainerRmConfig{ForceRemove: true, RemoveVolume: true}); err != nil { logrus.Errorf(\u0026#34;can\u0026#39;t remove container %s: %v\u0026#34;, container.ID, err) } container.Lock() } } }() if err := daemon.conditionalMountOnStart(container); err != nil { return err } if err := daemon.initializeNetworking(container); err != nil { return err } spec, err := daemon.createSpec(container) if err != nil { return errdefs.System(err) } if resetRestartManager { container.ResetRestartManager(true) container.HasBeenManuallyStopped = false } if daemon.saveApparmorConfig(container); err != nil { return err } if checkpoint != \u0026#34;\u0026#34; { checkpointDir, err = getCheckpointDir(checkpointDir, checkpoint, container.Name, container.ID, container.CheckpointDir(), false) if err != nil { return err } } createOptions, err := daemon.getLibcontainerdCreateOptions(container) if err != nil { return err } ctx := context.TODO() err = daemon.containerd.Create(ctx, container.ID, spec, createOptions) // daemon/daemon.go#NewDaemon#L1043 libcontainerd.NewClient if err != nil { if errdefs.IsConflict(err) { logrus.WithError(err).WithField(\u0026#34;container\u0026#34;, container.ID).Error(\u0026#34;Container not cleaned up from containerd from previous run\u0026#34;) // best effort to clean up old container object daemon.containerd.DeleteTask(ctx, container.ID) if err := daemon.containerd.Delete(ctx, container.ID); err != nil \u0026amp;\u0026amp; !errdefs.IsNotFound(err) { logrus.WithError(err).WithField(\u0026#34;container\u0026#34;, container.ID).Error(\u0026#34;Error cleaning up stale containerd container object\u0026#34;) } err = daemon.containerd.Create(ctx, container.ID, spec, createOptions) } if err != nil { return translateContainerdStartErr(container.Path, container.SetExitCode, err) } } // TODO(mlaventure): we need to specify checkpoint options here pid, err := daemon.containerd.Start(context.Background(), container.ID, checkpointDir, container.StreamConfig.Stdin() != nil || container.Config.Tty, container.InitializeStdio) if err != nil { if err := daemon.containerd.Delete(context.Background(), container.ID); err != nil { logrus.WithError(err).WithField(\u0026#34;container\u0026#34;, container.ID). Error(\u0026#34;failed to delete failed start container\u0026#34;) } return translateContainerdStartErr(container.Path, container.SetExitCode, err) } container.SetRunning(pid, true) container.HasBeenStartedBefore = true daemon.setStateCounter(container) daemon.initHealthMonitor(container) if err := container.CheckpointTo(daemon.containersReplica); err != nil { logrus.WithError(err).WithField(\u0026#34;container\u0026#34;, container.ID). Errorf(\u0026#34;failed to store container\u0026#34;) } daemon.LogContainerEvent(container, \u0026#34;start\u0026#34;) containerActions.WithValues(\u0026#34;start\u0026#34;).UpdateSince(start) return nil } ä¸Šè¾¹è¿™æ®µä»£ç åˆ° err = daemon.containerd.Create(ctx, container.ID, spec, createOptions) // daemon/daemon.go#NewDaemon#L1043 libcontainerd.NewClient è¿™é‡Œä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦åˆ°libcontainerd/libcontainerd_linux.go#NewClientå¯»æ‰¾æºç \n// libcontainerd/remote/client.go#Creat( func (c *client) Create(ctx context.Context, id string, ociSpec *specs.Spec, runtimeOptions interface{}) error { bdir := c.bundleDir(id) c.logger.WithField(\u0026#34;bundle\u0026#34;, bdir).WithField(\u0026#34;root\u0026#34;, ociSpec.Root.Path).Debug(\u0026#34;bundle dir created\u0026#34;) _, err := c.client.NewContainer(ctx, id, containerd.WithSpec(ociSpec), containerd.WithRuntime(runtimeName, runtimeOptions), WithBundle(bdir, ociSpec), ) if err != nil { if containerderrors.IsAlreadyExists(err) { return errors.WithStack(errdefs.Conflict(errors.New(\u0026#34;id already in use\u0026#34;))) } return wrapError(err) } return nil } æŠ€å·§ # åœ¨è¿™è¿‡ç¨‹ä¸­ï¼Œæ¯”è¾ƒæ–¹ä¾¿çš„å¯»æ‰¾ä»£ç å®ç°æ–¹æ³•æ˜¯ æ¯”å¦‚ ContainerExecStart æ˜¯ä¸€ä¸ªæ¥å£ä¸­çš„æ–¹æ³•ï¼Œå¸Œæœ›æ‰¾åˆ°å¥¹çš„å®ç°å¯ä»¥é€šè¿‡æ¯”è¾ƒç®€å•çš„æœç´¢æ³¨é‡Šå¯»æ‰¾åˆ°æ–¹æ³•ï¼šæ¯”å¦‚æœç´¢ //ContainerExecStart\n"},{"id":30,"href":"/posts/docker/docker-source-dev-install/","title":"Docker æºç é˜…è¯»: å¼€å‘ç¯å¢ƒæ­å»º","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šä»‹ç» docker å¼€å‘ç¯å¢ƒæ­å»º\ndocker å®˜æ–¹çš„è´¡çŒ®å¼•å¯¼: moby/docs/contributing/README.md\næ­¥éª¤ # moby/docs/contributing/set-up-dev-env.mdå®Œæ•´çš„æè¿°äº†å¼€å‘ç¯å¢ƒå¦‚ä½•æ­å»º\nå¼€å‘ç¯å¢ƒæ­å»º # å› ä¸ºç½‘ç»œé—®é¢˜ï¼Œéœ€è¦å°½å¿«çš„æé€Ÿå®‰è£… dev ç¯å¢ƒï¼Œéœ€è¦é…ç½® Dockerfile ä¸­çš„é…ç½® APT_MIRROR=mirrors.163.com\nè¿è¡Œmake --just-print BIND_DIR=. shellç®€å•çš„çœ‹ä¸€ä¸‹ make éƒ½åšäº†é‚£äº›äº‹æƒ… è¿è¡Œmake BIND_DIR=. shellå¼€å§‹å®‰è£…å¼€å‘ç¯å¢ƒ\nç¼–è¯‘ # ä¸Šä¸€èŠ‚å·²ç»è¿›å…¥ docker ä¸­ï¼Œå¯ä»¥å¼€å§‹ç¼–è¯‘ dockerd\nhack/make.sh binary make installcopy binary to container\u0026rsquo;s /usr/local/bin/ dockerd -D \u0026amp; æ—¥å¸¸å·¥ä½œæµ # ä¿®æ”¹ä»£ç  hack/make.sh binary install-binary å¸¸ç”¨ç›®å½•/å‘½ä»¤ # docker inspect æŸ¥çœ‹é•œåƒæˆ–å®¹å™¨è¿è¡Œé…ç½®ä¿¡æ¯ï¼ŒGraphDriver ä¸ºå®¹å™¨æŒ‚è½½ä¿¡æ¯ /var/lib/docker/overlay2/\u0026lt;image_id\u0026gt;/{merged, diff, work} /var/lib/docker/containerså½“å‰è¿è¡Œä¸­çš„å®¹å™¨é…ç½®ä¿¡æ¯ /var/lib/docker/imageé•œåƒåº“ /var/lib/docker/volumesvolumes å‚¨å­˜ä½ç½® è°ƒè¯• # è°ƒè¯• makefile # make --just-print BIND_DIR=. shell\nè°ƒè¯• shell # bash -x hack/make.sh binary\n"},{"id":31,"href":"/posts/docker/docker-architecture/","title":"Docker æºç é˜…è¯»: Dockeræ¶æ„ä»‹ç»","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šdockeråŸºæœ¬æ¶æ„ï¼Œä»¥åŠåœ¨ moby å¼€æºé¡¹ç›®ç›¸å…³çš„ä¸€äº›ç»„ä»¶ä¹‹é—´å¦‚ä½•ååŒå·¥ä½œçš„\nDocker? # æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Docker åšä»€ä¹ˆ # å¿«é€Ÿï¼Œä¸€è‡´åœ°äº¤ä»˜æ‚¨çš„åº”ç”¨ç¨‹åº\nDocker å…è®¸å¼€å‘äººå‘˜ä½¿ç”¨æä¾›åº”ç”¨ç¨‹åºå’ŒæœåŠ¡çš„æœ¬åœ°å®¹å™¨åœ¨æ ‡å‡†åŒ–ç¯å¢ƒä¸­å·¥ä½œï¼Œä»è€Œç®€åŒ–äº†å¼€å‘ç”Ÿå‘½å‘¨æœŸã€‚ å®¹å™¨éå¸¸é€‚åˆæŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ï¼ˆCI / CDï¼‰å·¥ä½œæµç¨‹ã€‚\ndocker å…¨å±€æ¶æ„ # CLI ä½¿ç”¨ Docker REST API é€šè¿‡è„šæœ¬æˆ–ç›´æ¥ CLI å‘½ä»¤æ§åˆ¶ Docker å®ˆæŠ¤ç¨‹åºæˆ–ä¸ Docker å®ˆæŠ¤ç¨‹åºäº¤äº’ã€‚ è®¸å¤šå…¶ä»– Docker åº”ç”¨ç¨‹åºä½¿ç”¨åº•å±‚ API å’Œ CLIã€‚\nDocker daemon åˆ›å»ºå’Œç®¡ç† Docker å¯¹è±¡ï¼Œä¾‹å¦‚ imagesï¼Œcontainersï¼Œnetworks å’Œ volumesã€‚\nThe Docker daemon # Docker daemonï¼ˆdockerdï¼‰ç›‘å¬ Docker API è¯·æ±‚å¹¶ç®¡ç† Docker å¯¹è±¡ï¼Œä¾‹å¦‚ imagesï¼Œcontainersï¼Œnetworks å’Œ volumesã€‚ Docker daemon è¿˜å¯ä»¥ä¸å…¶ä»–å®ˆæŠ¤ç¨‹åºé€šä¿¡ä»¥ç®¡ç† Docker æœåŠ¡ã€‚\nNote: ä¾‹å¦‚ dockerd é€šè¿‡ rest æ¥å£ä¸ containnerd è¿›è¡Œäº¤äº’ï¼Œcontainerd ä¸ runc é€šè¿‡ grpc è¿›è¡Œé€šä¿¡\nThe Docker client # Docker å®¢æˆ·ç«¯ï¼ˆdockerï¼‰æ˜¯è®¸å¤š Docker ç”¨æˆ·ä¸ Docker äº¤äº’çš„ä¸»è¦æ–¹å¼ã€‚ å½“æ‚¨ä½¿ç”¨è¯¸å¦‚ docker run ä¹‹ç±»çš„å‘½ä»¤æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šå°†è¿™äº›å‘½ä»¤å‘é€åˆ° dockerdï¼Œdockerd å°†å…¶æ‰§è¡Œã€‚ docker (CLI) å‘½ä»¤è°ƒç”¨ REST é£æ ¼çš„ Docker APIã€‚ Docker å®¢æˆ·ç«¯å¯ä»¥ä¸å¤šä¸ªå®ˆæŠ¤è¿›ç¨‹é€šä¿¡ã€‚\nNote: docker å¯ä»¥é€šè¿‡é…ç½®ç¯å¢ƒå˜é‡ DOCKER_HOSTæˆ–è€…ä¿®æ”¹é…ç½®å˜é‡ï¼Œæˆ–è€…å‘½ä»¤è¡Œå‚æ•°çš„æ–¹å¼è¿æ¥ dockerd\nDocker registries # Docker registry å­˜å‚¨ Docker é•œåƒã€‚ Docker Hub æ˜¯ä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨çš„å…¬å…±æ³¨å†Œä¸­å¿ƒï¼ŒDocker é…ç½®ä¸ºé»˜è®¤åœ¨ Docker Hub ä¸ŠæŸ¥æ‰¾ imagesã€‚ æ‚¨ç”šè‡³å¯ä»¥è¿è¡Œè‡ªå·±çš„ç§äºº registryã€‚ å¦‚æœæ‚¨ä½¿ç”¨ Docker Datacenterï¼ˆDDCï¼‰ï¼Œå®ƒåŒ…å« Docker Trusted Registryï¼ˆDTRï¼‰ã€‚\nNote: å¯ä»¥é€šè¿‡é…ç½®ä¸åŒçš„ Docker registry ä½œä¸º images ä¸‹è½½æºï¼Œæ¯”å¦‚å…¬å¸å†…éƒ¨æ­å»º registry ç§æœï¼Œåœ¨å¹³æ—¶ CI/CD ä¸­æé«˜å·¥ä½œé€Ÿåº¦ã€‚\nDocker objects # ä½¿ç”¨ Docker æ—¶ï¼Œæ‚¨æ­£åœ¨åˆ›å»ºå’Œä½¿ç”¨ imagesï¼Œcontainersï¼Œnetworks å’Œ volumesï¼Œplugins å’Œå…¶ä»–å¯¹è±¡ã€‚ æœ¬èŠ‚ç®€è¦ä»‹ç»å…¶ä¸­ä¸€äº›å¯¹è±¡ã€‚\nIMAGES # images æ˜¯ä¸€ä¸ªåªè¯»æ¨¡æ¿ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³åˆ›å»º Docker å®¹å™¨çš„è¯´æ˜ã€‚ é€šå¸¸ï¼Œimages åŸºäºå¦ä¸€ä¸ª imagesï¼Œå¹¶å¸¦æœ‰ä¸€äº›é¢å¤–çš„è‡ªå®šä¹‰ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ„å»ºåŸºäº ubuntu images çš„ imagesï¼Œä½†å®‰è£… Apache Web æœåŠ¡å™¨å’Œåº”ç”¨ç¨‹åºï¼Œä»¥åŠè¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„é…ç½®è¯¦ç»†ä¿¡æ¯ã€‚\næ‚¨å¯ä»¥åˆ›å»ºè‡ªå·±çš„ imagesï¼Œä¹Ÿå¯ä»¥åªä½¿ç”¨å…¶ä»–äººåˆ›å»ºçš„ images å¹¶åœ¨ registries ä¸­å‘å¸ƒã€‚ è¦æ„å»ºè‡ªå·±çš„ imagesï¼Œå¯ä»¥ä½¿ç”¨ç®€å•çš„è¯­æ³•åˆ›å»º Dockerfileï¼Œä»¥å®šä¹‰åˆ›å»º images å¹¶è¿è¡Œ images æ‰€éœ€çš„æ­¥éª¤ã€‚ Dockerfile ä¸­çš„æ¯æ¡æŒ‡ä»¤éƒ½åœ¨ images ä¸­åˆ›å»ºä¸€ä¸ª layerã€‚ æ›´æ”¹ Dockerfile å¹¶é‡å»º images æ—¶ï¼Œä»…é‡å»ºå·²æ›´æ”¹çš„é‚£äº›å±‚ã€‚ ä¸å…¶ä»–è™šæ‹ŸåŒ–æŠ€æœ¯ç›¸æ¯”ï¼Œè¿™æ˜¯ä½¿ images å¦‚æ­¤è½»é‡ï¼Œå°å·§å’Œå¿«é€Ÿçš„éƒ¨åˆ†åŸå› ã€‚\nNote: æ¯”è¾ƒè¯¦ç»†çš„å·¥ä½œåŸç†å¯ä»¥çœ‹ä¸‹æ–‡ Union file systemséƒ¨åˆ†\nCONTAINERS # CONTAINERS æ˜¯ images çš„å¯è¿è¡Œå®ä¾‹ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ Docker API æˆ– CLI åˆ›å»ºï¼Œå¯åŠ¨ï¼Œåœæ­¢ï¼Œç§»åŠ¨æˆ–åˆ é™¤å®¹å™¨ã€‚ æ‚¨å¯ä»¥å°†å®¹å™¨è¿æ¥åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªç½‘ç»œï¼Œå°†å­˜å‚¨è¿æ¥åˆ°å®ƒï¼Œç”šè‡³å¯ä»¥æ ¹æ®å…¶å½“å‰çŠ¶æ€åˆ›å»ºæ–° imagesã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼ŒCONTAINERS ä¸å…¶ä»– CONTAINERS åŠå…¶ä¸»æœºç›¸å¯¹éš”ç¦»ã€‚ æ‚¨å¯ä»¥æ§åˆ¶ CONTAINERS çš„ç½‘ç»œï¼Œå­˜å‚¨æˆ–å…¶ä»–åŸºç¡€å­ç³»ç»Ÿä¸å…¶ä»– CONTAINERS æˆ–ä¸»æœºçš„éš”ç¦»ç¨‹åº¦ã€‚\nCONTAINERS ç”±å…¶ images ä»¥åŠæ‚¨åœ¨åˆ›å»ºæˆ–å¯åŠ¨æ—¶ä¸ºå…¶æä¾›çš„ä»»ä½•é…ç½®é€‰é¡¹å®šä¹‰ã€‚ åˆ é™¤ containers åï¼Œå¯¹å…¶çŠ¶æ€çš„ä»»ä½•æœªå­˜å‚¨åœ¨æŒä¹…å­˜å‚¨ä¸­çš„æ›´æ”¹éƒ½å°†æ¶ˆå¤±ã€‚\nSERVICES # services å…è®¸æ‚¨è·¨å¤šä¸ª Docker å®ˆæŠ¤ç¨‹åºæ‰©å±•å®¹å™¨ï¼Œè¿™äº›å®ˆæŠ¤ç¨‹åºä¸€èµ·ä½œä¸ºå…·æœ‰å¤šä¸ªç®¡ç†å™¨å’Œå·¥ä½œç¨‹åºçš„ç¾¤ç»„ä¸€èµ·å·¥ä½œã€‚ swarm çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ Docker å®ˆæŠ¤ç¨‹åºï¼Œå®ˆæŠ¤è¿›ç¨‹éƒ½ä½¿ç”¨ Docker API è¿›è¡Œé€šä¿¡ã€‚ æœåŠ¡å…è®¸æ‚¨å®šä¹‰æ‰€éœ€çš„çŠ¶æ€ï¼Œä¾‹å¦‚åœ¨ä»»ä½•ç»™å®šæ—¶é—´å¿…é¡»å¯ç”¨çš„æœåŠ¡çš„å‰¯æœ¬æ•°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡åœ¨æ‰€æœ‰å·¥ä½œèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œè´Ÿè½½å¹³è¡¡ã€‚ å¯¹äºæ¶ˆè´¹è€…æ¥è¯´ï¼ŒDocker æœåŠ¡ä¼¼ä¹æ˜¯ä¸€ä¸ªå•ç‹¬çš„åº”ç”¨ç¨‹åºã€‚ Docker Engine æ”¯æŒ Docker 1.12 åŠæ›´é«˜ç‰ˆæœ¬ä¸­çš„ swarm æ¨¡å¼ã€‚\nDocker åº•å±‚æŠ€æœ¯ # Docker æ˜¯ç”¨ Go ç¼–å†™çš„ï¼Œå®ƒåˆ©ç”¨ Linux å†…æ ¸çš„å‡ ä¸ªåŠŸèƒ½æ¥æä¾›å…¶åŠŸèƒ½ã€‚ä½¿ç”¨åˆ°çš„å†…æ ¸ç‰¹æ€§åŒ…æ‹¬ namespacesã€cgroupsã€Union file systems\nnamespaces # Docker ä½¿ç”¨ç§°ä¸º namespaces çš„æŠ€æœ¯æ¥æä¾›ç§°ä¸ºå®¹å™¨çš„éš”ç¦»å·¥ä½œç©ºé—´ã€‚ è¿è¡Œå®¹å™¨æ—¶ï¼ŒDocker ä¼šä¸ºè¯¥å®¹å™¨åˆ›å»ºä¸€ç»„ namespacesã€‚\nè¿™äº› namespaces æä¾›äº†ä¸€å±‚éš”ç¦»ã€‚ å®¹å™¨çš„æ¯ä¸ªæ–¹é¢éƒ½åœ¨ä¸€ä¸ªå•ç‹¬çš„å‘½åç©ºé—´ä¸­è¿è¡Œï¼Œå…¶è®¿é—®æƒé™ä»…é™äºè¯¥ namespacesã€‚\nDocker Engine åœ¨ Linux ä¸Šä½¿ç”¨ä»¥ä¸‹å‘½åç©ºé—´ï¼š\npid å‘½åç©ºé—´ï¼šè¿›ç¨‹éš”ç¦»ï¼ˆPIDï¼šè¿›ç¨‹ IDï¼‰ã€‚ net å‘½åç©ºé—´ï¼šç®¡ç†ç½‘ç»œæ¥å£ï¼ˆNETï¼šNetworkingï¼‰ã€‚ ipc åç§°ç©ºé—´ï¼šç®¡ç†å¯¹ IPC èµ„æºçš„è®¿é—®ï¼ˆIPCï¼šè¿›ç¨‹é—´é€šä¿¡ï¼‰ã€‚ mnt åç§°ç©ºé—´ï¼šç®¡ç†æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹ï¼ˆMNTï¼šMountï¼‰ã€‚ uts å‘½åç©ºé—´ï¼šéš”ç¦»å†…æ ¸å’Œç‰ˆæœ¬æ ‡è¯†ç¬¦ã€‚ ï¼ˆæ‚‰å°¼ç§‘æŠ€å¤§å­¦ï¼šUnix åˆ†æ—¶ç³»ç»Ÿï¼‰ã€‚ cgroups # Linux ä¸Šçš„ Docker Engine è¿˜ä¾èµ–äºå¦ä¸€ç§ç§°ä¸ºæ§åˆ¶ç»„ï¼ˆcgroupsï¼‰çš„æŠ€æœ¯ã€‚ cgroup å°†åº”ç”¨ç¨‹åºé™åˆ¶ä¸ºç‰¹å®šçš„èµ„æºé›†ã€‚ cgroups å…è®¸ Docker Engine å°†å¯ç”¨çš„ç¡¬ä»¶èµ„æºå…±äº«ç»™å®¹å™¨ï¼Œå¹¶å¯é€‰æ‹©å¼ºåˆ¶æ‰§è¡Œé™åˆ¶å’Œçº¦æŸã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥é™åˆ¶ç‰¹å®šå®¹å™¨çš„å¯ç”¨å†…å­˜ã€‚\nUnion file systems # è”åˆæ–‡ä»¶ç³»ç»Ÿæˆ– UnionFS æ˜¯é€šè¿‡åˆ›å»º layers æ¥æ“ä½œçš„æ–‡ä»¶ç³»ç»Ÿï¼Œä½¿å®ƒä»¬éå¸¸è½»é‡å’Œå¿«é€Ÿã€‚ Docker Engine ä½¿ç”¨ UnionFS ä¸ºå®¹å™¨æä¾›æ„å»ºå—ã€‚ Docker Engine å¯ä»¥ä½¿ç”¨å¤šç§ UnionFS å˜ä½“ï¼ŒåŒ…æ‹¬ AUFSï¼Œbtrfsï¼Œvfs å’Œ DeviceMapperã€‚\nNote: Docker é»˜è®¤ä¸º overylay2\nContainer format # Docker Engine å°† namespacesï¼Œcgroups å’Œ UnionFS ç»„åˆæˆä¸€ä¸ªç§°ä¸ºå®¹å™¨æ ¼å¼çš„åŒ…è£…å™¨ã€‚ é»˜è®¤å®¹å™¨æ ¼å¼æ˜¯ libcontainerã€‚ å°†æ¥ï¼ŒDocker å¯ä»¥é€šè¿‡ä¸ BSD Jails æˆ– Solaris Zones ç­‰æŠ€æœ¯é›†æˆæ¥æ”¯æŒå…¶ä»–å®¹å™¨æ ¼å¼ã€‚\nNote: å¦‚ä¸Šéƒ¨åˆ†ç¿»è¯‘è‡ª docker overviewï¼ŒåŒæ—¶æ·»åŠ è‡ªå·±æœ¬äººç†è§£ã€‚\nmoby ç­‰ä»£ç çš„ä¾èµ–ä»‹ç»ï¼Œç›¸å…³è°ƒç”¨æ–¹å¼ï¼Œæ¶æ„ # Docker ä»ä¸€ä¸ªå•ä¸€çš„è½¯ä»¶è½¬ç§»åˆ°ä¸€ç»„ç‹¬ç«‹çš„ç»„ä»¶å’Œé¡¹ç›®ã€‚\nDocker å¦‚ä½•è¿è¡Œå®¹å™¨ï¼Ÿ # Docker å¼•æ“åˆ›å»º imagesï¼Œ æŠŠ images ä¼ é€’ç»™ containerdï¼Œ containerd è°ƒç”¨ containerd-shimï¼Œ containerd-shim ä½¿ç”¨ runC æ¥è¿è¡Œ containerï¼Œ containerd-shim å…è®¸è¿è¡Œæ—¶ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º runCï¼‰åœ¨å¯åŠ¨å®¹å™¨åé€€å‡º è¿™ä¸ªæ¨¡å‹çš„ä¸¤ä¸ªä¸»è¦å¥½å¤„æ˜¯ # deamon è¿è¡Œè¾ƒå°‘çš„å®¹å™¨ èƒ½å¤Ÿåœ¨ä¸ç ´åæ­£åœ¨è¿è¡Œçš„å®¹å™¨çš„æƒ…å†µä¸‹é‡å¯æˆ–å‡çº§å¼•æ“ containerd # containerd æ¶æ„ related link # moby\nlibnetwork\ncontainerd\nrunc\nVisualizing Docker Containers and Images\n"},{"id":32,"href":"/posts/docker/docker-contents/","title":"Docker æºç é˜…è¯»: ç›®å½•","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šèµ„æ–™æ±‡æ€»ä»¥åŠæºç é˜…è¯»ç›®å½•\nContents # Docker æ¶æ„ä»‹ç» Docker ç¼–è¯‘å¼€å‘ç¯å¢ƒæ­å»º Docker Run Docker Build Docker Volume todo docker network èµ„æ–™æ±‡æ€» # Visualizing Docker Containers and Imageså®¹å™¨ã€é•œåƒå¯è§†åŒ– Docker æ ¸å¿ƒæŠ€æœ¯ä¸å®ç°åŸç† docker-debug related links # Visualizing Docker Containers and Images "},{"id":33,"href":"/posts/contribute-to-opensource/","title":"Contribute to Opensource","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šå¦‚ä½•å‚ä¸å¼€æºé¡¹ç›®ã€‚åœ¨è¿™é‡Œåˆ†äº«ä¸€äº›æ€è·¯å’Œå¼€æºèµ„æºã€‚\nç®€ä»‹ # è‡ªä»å­¦ä¹ è®¡ç®—æœºå¼€å§‹ï¼Œå¾ˆå¤šæ—¶å€™å¸Œæœ›è‡ªå·±èƒ½å¤Ÿä¹Ÿä¸º opensource è´¡çŒ®ä¸€äº›ä»€ä¹ˆã€‚è¿™é‡Œä¼šæ€»ç»“ä¸€äº›æ€è·¯ä¸ºå¼€æºåšäº›ä»€ä¹ˆã€‚\næ€è·¯ # Start Your Open Source Careerè¿™é‡Œç®€è¿°äº†å¦‚ä½•å‚ä¸å¼€æºé¡¹ç›®ã€‚å¯¹è‡ªå·±æœ‰å¾ˆå¤šå¯ç¤ºã€‚æˆ‘ä»¬åœ¨å·¥ä½œå­¦ä¹ ä¸­ä¹Ÿä¼šæœ‰ä¸€äº›è‡ªå·±æ„Ÿè§‰å¾ˆå¥½çš„å¯¹æŸä¸ªæŠ€æœ¯é—®é¢˜çš„è§£å†³æ–¹å¼,å¸Œæœ›å¯ä»¥åˆ†äº«ç»™å¤§å®¶ï¼Œæˆ–è€…å¸Œæœ›å­¦ä¹ æ–°çš„çŸ¥è¯†ï¼Œæˆä¸ºæŸä¸ªå·¥å…·çš„æ ¸å¿ƒç»´æŠ¤è€…ã€‚ è¿™é‡Œä¼šæ€»ç»“ä¸€äº›æ¯”è¾ƒå¥½çš„å‚ä¸å¼€æºé¡¹ç›®çš„æ€è·¯ã€‚\ngood first issue or help wanted # å¾ˆå¤šå¼€æºé¡¹ç›®çš„issueä¸­å·²ç»æ ‡è®°å‡ºå¾ˆå¤šç±»ä¼¼good first issue or help wantedçš„ labelï¼Œè¿™äº› label è¡¨ç¤ºæ–°äººå¯ä»¥æ¥å¸®å¿™ã€‚å¯ä»¥é€šè¿‡ä¸€äº›ç½‘ç«™æ‰¾åˆ°æ‰“ç›¸åº” label çš„é¡¹ç›®ï¼Œè¿™å¯èƒ½æˆä¸ºä½ è´¡çŒ®å¼€æºé¡¹ç›®çš„å¼€ç«¯ã€‚ æˆ–è®¸è¿™äº›ç½‘ç«™å¯ä»¥å¸®åˆ°ä½ ( æ¥è‡ª github)ï¼š\nå¼€æºæ˜ŸæœŸäº” - opensourcefriday ç»Ÿè®¡è‡ªå·±å‚ä¸çš„é¡¹ç›®ï¼ŒåŒæ—¶æ¨èå¦‚ä½•å¼€å§‹ github-explore github ä¼šä¸ºä½ æ¨èä¸€äº›ä½ æ„Ÿå…´è¶£çš„é¡¹ç›® project-based-learning Curated list of project-based tutorials first timers only è´¡çŒ® pr éœ€è¦çš„ git çŸ¥è¯†ï¼Œlabel æœç´¢ï¼Œç›¸å…³è®¢é˜…æé†’ç­‰ codetriage è®¢é˜… github ä¸­çš„é¡¹ç›®ï¼Œissue ç­‰ï¼Œæ–¹ä¾¿é€šçŸ¥è‡ªå·±æ„Ÿå…´è¶£çš„é¡¹ç›® issuehub æŒ‰ç…§æ ‡ç­¾æœç´¢é¡¹ç›® pullrequestroulette æ£€ç´¢éœ€è¦ reviews çš„ pr up-for-grabs.net æ ¹æ® label ç­‰æ£€ç´¢é¡¹ç›® how-to-contribute/#a-checklist-before-you-contribute æ€è·¯ # æ„å»ºä¸€äº›å·¥å…· # æ¯”å¦‚æ„å»ºä¸€äº›é¡¹ç›®æ¨¡ç‰ˆï¼Œæ¯”å¦‚ graphql+mongoboilerplate. æ¯”å¦‚ç¼–å†™ä¸€äº›å¹³æ—¶å¯ä»¥æé«˜å·¥ä½œæ•ˆç‡çš„å·¥å…·ï¼Œ alibaba/arthas\næˆä¸ºæ–°çš„ç»´æŠ¤è€… # æœ‰å¾ˆå¤šæœ‰ä»·å€¼çš„é¡¹ç›®å› ä¸ºæ²¡æœ‰ç»´æŠ¤è€…æ¸æ¸è¢«äººé—å¼ƒã€‚ä½ æ˜¯å¦å¯ä»¥æˆä¸ºæ–°çš„ç»´æŠ¤è€…å‘¢ï¼Ÿå¯ä»¥é€šè¿‡é‚®ä»¶ã€twiter ç­‰è”ç³»åŸä½œè€…ï¼Œæˆä¸ºé¡¹ç›®ç»´æŠ¤è€…æ˜¯ä¸æ˜¯å¾ˆæ£’ï¼Ÿ\nåˆ›å»ºè‡ªå·±çš„é¡¹ç›® # å¦‚æœè‡ªå·±æœ‰å¯¹æ–°çš„æŠ€æœ¯é—®é¢˜çš„è§£å†³åŠæ³•ï¼Œå¯ä»¥å¼€æºå‡ºæ¥ï¼Œåˆ†äº«è‡ªå·±æ˜¯å¦‚ä½•è§£å†³çš„\nå‘å¸ƒï¼Œæ¨å¹¿ï¼Œåˆ†äº« # ä¸ºäº†ç¡®ä¿æ¯ä¸ªæœ‰éœ€è¦çš„äººéƒ½ä¹æ„æ¥æ‰¾åˆ°ä½ çš„æ¨¡å—ï¼Œä½ å¿…é¡»ï¼š\næ’°å†™ readme ç­‰ license README ç‰ˆæœ¬å¾½ç«  è´¡çŒ®æŒ‡å— æä¾› ISSUE_TEMPLATE ä½¿ç”¨æœ¬é¡¹ç›®çš„äº§å“ ä¸ºé¡¹ç›®æ’°å†™ç²¾å¿ƒè®¾è®¡çš„åœ¨çº¿ç½‘ç«™ï¼Œå’Œæ–‡æ¡£ï¼Œå¯ä»¥ä½¿ç”¨é™æ€ç½‘ç«™å·¥å…·ç”Ÿæˆï¼Œå¦‚ vuepress åœ¨ StackOverflow å’Œ GitHub ç­‰ç¤¾äº¤åª’ä½“ä¸­å¯»æ‰¾ç›¸å…³é—®é¢˜å¹¶è´´å‡ºä½ çš„é¡¹ç›®ï¼Œå¹¶è§£ç­” å°†é¡¹ç›®å‘å¸ƒåˆ°æ±‡é›†å¼€æºé¡¹ç›®çš„ç¤¾åŒºä¸­ï¼Œå¦‚ HackerNewsã€ redditã€ producthuntã€ hashnode å‚ä¸ä¸€äº›çº¿ä¸‹åˆ†äº«ã€è®¨è®ºä¼šã€æ¼”è®²ç­‰ä¸­ä»‹ç»ä½ çš„é¡¹ç›® é“¾æ¥ # octobox å°†ä½ çš„ GitHub é€šçŸ¥è½¬æˆé‚®ä»¶çš„å½¢å¼ï¼Œè¿™æ˜¯é¿å…å› å †ç§¯ã€Œå¤ªå¤šé—®é¢˜ã€ä»¥è‡³äºå½±å“å…³æ³¨é‡è¦é—®é¢˜çš„å¾ˆå¥½çš„æ–¹æ³• probot GitHub App å¯ä»¥è‡ªåŠ¨åŒ–å’Œæ”¹å–„ä½ çš„å·¥ä½œæµç¨‹ refined-github æµè§ˆå™¨æ‰©å±•ï¼Œç®€åŒ–äº† GitHub ç•Œé¢å¹¶æ·»åŠ äº†æœ‰ç”¨çš„åŠŸèƒ½ Start Your Open Source Career https://www.atlassian.com/git/tutorials/merging-vs-rebasing "},{"id":34,"href":"/posts/Java/openapi/","title":"Openapi","section":"Blog","content":"swagger and openapi ä»£ç ç”Ÿæˆå’Œæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆä¸€äº›ä½“ä¼š\nè¯´åœ¨å‰é¢ # å¹³æ—¶ä½¿ç”¨ gqlgenï¼Œä¸€èˆ¬çš„ workflow æ˜¯å…ˆå†™ graphql çš„ schemaï¼Œç„¶å code generate å¯¹åº”çš„ model å’Œ api çš„å®ç°çš„ç©ºæ¥å£ï¼Œè‡ªå·±å¯¹åº”å®ç°å¯¹åº”çš„ resolver å³å¯ã€‚ä½¿ç”¨èµ·æ¥å¾ˆæµç¨‹ã€‚æœ€è¿‘è°ƒç ”ä¸€ä¸‹ java ä¸‹ç±»ä¼¼çš„å·¥å…·ã€‚æ‰¾åˆ°åœ¨ java ä¸‹ star æœ€å¤šçš„é¡¹ç›® graphql-javaï¼Œä½†å¹¶ä¸æ˜¯è¿™é‡Œè®¨è®ºçš„ã€‚ è¿™é‡Œè®¨è®ºçš„æ˜¯åŸºäº spring çš„ openapi çš„å®ç°å’Œ code generate æ–¹æ¡ˆã€‚\nåŸºäº openapi çš„ code generate æ–¹æ¡ˆ # é¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ openapiï¼Œä»–æ˜¯è¯­è¨€æ— å…³çš„ restful æè¿°è¯­è¨€ï¼Œå¯ä»¥ä½¿ç”¨ yaml è¿›è¡Œç¼–å†™æ¥å£æ–‡æ¡£ï¼Œé€šè¿‡ generateï¼Œç”Ÿæˆä¸åŒè¯­è¨€çš„ client å’Œ serverã€‚ è¿™é‡Œæœ‰å®˜æ–¹çš„ç®€ä»‹ã€‚è‡ªå·±æ¯”è¾ƒå…³æ³¨çš„è¯­è¨€æ˜¯ pythonã€javaã€goã€rustï¼Œjsã€‚\nè¸©åˆ°çš„ä¸€äº›å‘ï¼Œè¿™é‡Œç®€å•è¯•ç”¨äº†ä¸€ä¸‹generate javaã€‚é¦–å…ˆï¼Œmavenä¸‹æœ‰å¯¹åº”çš„openapiçš„pluginï¼Œ openapi-generator-maven-plugin, ä½†æ¯æ¬¡compileéƒ½ä¼šè¿›è¡Œgenerateï¼Œå¹¶ä¸æ˜¯æˆ‘æ‰€å¸Œæœ›çš„ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨äº†åŸºäºdockerçš„ä½¿ç”¨æ–¹æ¡ˆã€‚ä»£ç è§ exfly:gorgestar/isn,ä½¿ç”¨ generator.shç”Ÿæˆå¯¹åº”çš„ä»£ç ï¼Œé…ç½®æ–‡ä»¶å¯ä»¥çœ‹ generator.jsonï¼Œ\næˆ‘çš„ä½¿ç”¨ç­–ç•¥æ˜¯ï¼Œå…ˆä¿®æ”¹ openapi.yamlï¼Œåˆ›å»ºæˆ–è€…ä¿®æ”¹restful apiï¼Œç„¶å bash ./generator.shï¼Œç”Ÿæˆå¯¹åº”æ¥å£é»˜è®¤ç©ºå®ç°ï¼Œä¹‹åç”±æˆ‘ä»¬å¯¹åº”çš„å®ç°æ¥å£å³å¯ã€‚\nä¸€äº›è‡ªå·±æ²¡æœ‰è¿›è¡Œæ“ä½œçš„æ–¹æ¡ˆï¼š\nå¦‚ä½•ä¿è¯apiå’Œæ¥å£æ–‡æ¡£ä¸€è‡´ï¼šå¯ä»¥å¯¹åº”çš„ä½¿ç”¨swaggerçš„api-doc jsonè¿›è¡Œè½¬æ¢ä¸ºyamlï¼Œå¯¹åŸæœ¬æ‰‹å†™çš„openapi.yamlè¿›è¡Œæ¯”è¾ƒï¼Œç¡®è®¤æ–‡æ¡£çš„ä¸€è‡´æ€§ è¿™ä¸ªç‰ˆæœ¬çš„generateæ¯æ¬¡éƒ½ä¼šå°†æ‰€æœ‰çš„æ–‡ä»¶è¦†ç›–ï¼Œéœ€è¦ç¼–è¾‘ .openapi-generator-ignoreï¼Œç±»ä¼¼gitignoreçš„ä¸œè¥¿ï¼Œç±»æ¯”ä¿®æ”¹å³å¯ã€‚è¢«å¿½ç•¥çš„æ–‡ä»¶ï¼Œå³ä½¿è¢«åˆ é™¤ï¼Œä¹Ÿä¸ä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”æ–‡ä»¶ï¼Œç”Ÿæˆé€»è¾‘çœ‹èµ·æ¥æ¯”è¾ƒå‚»ã€‚ å…¶ä»–èµ„æº # exfly:gorgestar/isn,æœ¬æ–‡é¡¹ç›®ä»£ç \nswagger\nraml\nOpenAPI-Specification\nopenapi-generator\nopenapi generator maven plugin\nspring rest docs\n"},{"id":35,"href":"/posts/tools/wsl/","title":"WSL(windows subsystem for linux) winå­ç³»ç»Ÿ","section":"Blog","content":"\u0008win å­ç³»ç»Ÿå®‰è£…ä¸ cmder+zsh å¼€å‘ç¯å¢ƒæ­å»º\nè¯´åœ¨å‰é¢ # è¿™é‡Œåªå±•ç¤ºå¯ä»¥åšåˆ°ä»€ä¹ˆç¨‹åº¦ï¼Œå…·ä½“æ€ä¹ˆåšï¼Œç½‘ä¸Šæ•™ç¨‹å¾ˆå¤šï¼Œåè¾¹ä¼šè´´å‡ºè‡ªå·±æ„Ÿè§‰æ¯”è¾ƒå¥½çš„ç½‘å€\nå¤§è‡´æ“ä½œæ€è·¯ # å…ˆåœ¨ windows ä¸‹ æ‰“å¼€ win subsystem for linux åŠŸèƒ½ï¼Œä¹‹åå» win store ä¸­ä¸‹è½½å¯¹åº”çš„ linux å‘è¡Œç‰ˆ.ä¹‹åå°±æ˜¯æ‰“å¼€å¯¹åº”çš„ linux å‘è¡Œç‰ˆçš„ bashã€é…ç½® zsh äº†ï¼Œè¯¦ç»†æ­¥éª¤è§ è¿™é‡Œã€‚å…·ä½“ zsh æ€ä¹ˆæŠ˜è…¾ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ è¿™é‡Œ\nè´´ä¸€å¼ è‡ªå·±é…ç½®ä¹‹åï¼Œä½¿ç”¨ zsh å’Œ tmux ä¹‹åçš„æˆªå›¾ ç»™æˆ‘çš„ä½“éªŒæ˜¯ï¼ŒåŸºæœ¬å¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†æ—¥å¸¸å¼€å‘å·¥ä½œ\nå…¶ä»– # win ä¸‹çš„ CDEF ç›˜è¢«æŒ‚è½½åˆ°/mntä¸‹ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå¯ä»¥å°†ä»–ä»¬ln -s /mnt/d $HOME/windirï¼Œè¿™æ ·æ–¹ä¾¿è‡ªå·±ä½¿ç”¨ å› ä¸ºä¹‹å‰å®‰è£…è¿‡ vscodeï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨code filename æ‰“å¼€ç³»ç»Ÿä¸­çš„æ–‡ä»¶ ç±»ä¼¼ jdk è¿™ç§éœ€è¦åœ¨ subsystem ä¸­é‡æ–°å®‰è£…æ‰å¯ä»¥åœ¨ wsl ä¸­ä½¿ç”¨ å›¾ä¸­ä½¿ç”¨çš„ Cmder æ˜¯éå¸¸è¿œå¤çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥è¯·å¿½ç•¥ cmd ä¹‹å‰çš„æ¡† é“¾æ¥ # Windows10 ç»ˆç«¯ä¼˜åŒ–æ–¹æ¡ˆï¼šUbuntu å­ç³»ç»Ÿ+cmder+oh-my-zsh "},{"id":36,"href":"/posts/frontend/front-end-separation-architecture-environment-construction/","title":"å‰åç«¯åˆ†ç¦»æ¶æ„çš„Vueç¯å¢ƒæ­å»ºæŒ‡å—","section":"Blog","content":"ä½¿ç”¨ Vue å‰åç«¯+Go åç«¯ï¼ŒåŸºäº webpack ä»£ç†è½¬å‘ï¼Œé…ç½®å‰åç«¯åˆ†ç¦»æ¶æ„å¼€å‘ç¯å¢ƒ\nåŸæ–‡åœ°å€\nWeb ç ”å‘æ¨¡å¼æ¼”å˜ # æœ€è¿‘ç ”ç©¶ä¸€ä¸‹å‰åç«¯çš„å¼€å‘æ¨¡å¼ï¼Œçœ‹åˆ°ä¸€ä¸ªå¾ˆå¥½çš„å…¥é—¨è·¯å¾„ developer-roadmap: frontend backend DevOps,å¯ä»¥çœ‹ä¸€ä¸‹ï¼Œæ•ˆæœè¿˜æ˜¯ä¸é”™çš„ã€‚\nä¹‹å‰çœ‹åˆ°ä¸€ä¸ªè¯´ web ç ”å‘æ¼”è¿›è¿™é‡Œæ€»ç»“ä¸€ä¸‹ã€‚\nå¾ˆä¹…ä¹‹å‰ï¼Œå‰åç«¯çš„åˆ†å·¥æ˜¯ï¼Œå‰ç«¯ä»è®¾è®¡å¸ˆé‚£é‡Œæ‹¿åˆ°è®¾è®¡å›¾çº¸ï¼Œè½¬åŒ–é™æ€é¡µé¢æ¨¡æ¿ï¼Œç”±åç«¯å·¥ç¨‹å¸ˆè¿›è¡Œæ•°æ®åº“è®¾è®¡ç­‰ä¸€ç³»åˆ—è®¾è®¡ä¹‹åï¼Œå¥—å‰ç«¯ç»™çš„æ¨¡æ¿ã€‚å¦‚ä¸Šä¹Ÿå³åç«¯æ¸²æŸ“ã€‚\nä½†æ˜¯è¿™æ ·çš„æµç¨‹ï¼Œæ‰€æœ‰å·¥ä½œçš„ Block åœ¨åç«¯ï¼Œæƒ³è¿›ä¸€æ­¥æé«˜ç ”å‘é€Ÿåº¦ï¼Œåº”è¯¥å¦‚ä½•åˆ†å·¥ï¼Ÿåˆ°å¦‚ä»Šç»™å‡ºçš„ç­”æ¡ˆæ˜¯åŸºäº Nodejs çš„å‰åç«¯åˆ†ç¦»æ¶æ„ã€‚è¿™æ—¶å‰åç«¯åˆ†å·¥æ˜¯è¿™æ ·çš„ï¼š\nå‰ç«¯çš„å·¥ä½œ # UI è®¾è®¡ å‰ç«¯è·¯ç”±è®¾è®¡ å¤„ç†æµè§ˆå™¨å±‚çš„å±•ç°é€»è¾‘ é€šè¿‡ CSS æ¸²æŸ“æ ·å¼ï¼Œé€šè¿‡ JavaScript æ·»åŠ äº¤äº’åŠŸèƒ½ï¼ŒHTML çš„ç”Ÿæˆä¹Ÿå¯ä»¥æ”¾åœ¨è¿™å±‚ï¼Œå…·ä½“çœ‹åº”ç”¨åœºæ™¯\nåç«¯çš„å·¥ä½œ # ä¸šåŠ¡é€»è¾‘å’Œ API çš„è®¾è®¡å’Œå®ç° æ•°æ®åº“è®¾è®¡å’Œç»´æŠ¤ åç«¯ç¼“å­˜è®¾è®¡ å‰åç«¯åˆ†ç¦»ä¸‹åä½œä½“ç³» # å‰åç«¯åˆ†ç¦»ä¸‹çš„åä½œæ–¹å¼ä¸€èˆ¬æ˜¯ï¼Œå‰åç«¯å„å¸å…¶èŒï¼Œäº’ä¸å½±å“ã€‚\né¦–å…ˆï¼Œå¯¹äºåç«¯æ¥è¯´ï¼Œåç«¯çš„ä¸»è¦å·¥ä½œä¾ç„¶æ˜¯ä¼ ç»Ÿçš„æ•°æ®åº“è®¾è®¡ã€ä¸šåŠ¡é€»è¾‘è®¾è®¡ï¼Œä½†ä¸éœ€è¦å¥—æ¨¡æ¿äº†ï¼Œè€Œæ˜¯ä¸ºå‰ç«¯æä¾›æ•°æ®æ¥å£\nå…¶æ¬¡ï¼Œå¯¹äºå‰ç«¯æ¥è¯´ï¼Œå‰ç«¯çš„ä¸»è¦å·¥ä½œæ˜¯ï¼Œå‰ç«¯çš„ uiï¼Œä»¥åŠè·å–æ•°æ®ï¼Œåœ¨å‰ç«¯æ¸²æŸ“ã€‚\nå·¥ä½œæµç¨‹æ˜¯ï¼Œå…ˆè¿›è¡Œ API è®¾è®¡ã€‚å‰åç«¯ä¸€èµ·è®¾è®¡æ•°æ®æ¥å£ä»¥åŠæ•°æ®è¿”å›çš„æ ¼å¼ï¼Œç°åœ¨æ¯”è¾ƒå¸¸è§çš„æ˜¯ json æ•°æ®ã€‚å¯ä»¥æ ¹æ®æ¥å£ç”Ÿæˆä¸€äº› mock ç”¨çš„ json æ•°æ®æ–‡ä»¶ï¼Œä¾›å‰ç«¯å¼€å‘ä½¿ç”¨ã€‚åç«¯æ ¹æ®è¿™ä¸ª API è§„èŒƒå®ç°çœŸæ­£çš„æ¥å£ã€‚ä¸¤ç«¯åˆ†åˆ«å¹¶è¡Œå¼€å‘ã€‚å¼€å‘ç»“æŸæ—¶å€™è”è°ƒï¼Œæ‰“é€šå‰åç«¯ä¹‹åè¿›è¡Œè°ƒè¯•ã€‚\nå…·ä½“ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ ç½‘æ˜“å‰åç«¯åˆ†ç¦»å®è·µ.\nåŸºäº Vue å‰åç«¯åˆ†ç¦»ç¯å¢ƒæ­å»º # è¿™é‡Œå¯¹å‰åç«¯åˆ†ç¦» Vue çš„å¼€å‘ç¯å¢ƒè¿›è¡Œæ¼”ç¤ºã€‚æ€è·¯æ˜¯ï¼Œå‰åç«¯åˆ†ç¦»ï¼Œåç«¯å¯ä»¥è®¾ç½® cookieï¼Œå‰ç«¯å¯ä»¥æ¥æ”¶åˆ°é…ç½®çš„ cookie\nnode ç¯å¢ƒå®‰è£… # å®‰è£…æ–¹æ³•è§ è¿™é‡Œ\nVue å®‰è£… # npm config set registry \u0026#39;https://registry.npm.taobao.org\u0026#39; npm install -g @vue/cli vue init webpack demo cd demo npm dev run å³å¯åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°æ•ˆæœï¼Œç†Ÿæ‚‰çš„ vue é¡µé¢\nå®‰è£… axiosï¼Œå®ç°å‰åç«¯äº¤äº’ï¼Œå¹¶å®ç°åç«¯è®¾ç½® cookieï¼Œåœ¨å‰ç«¯å¯ä»¥ç”Ÿæ•ˆ # å®‰è£… axios\nnpm install axios ä¿®æ”¹/src/components/HelloWorld.vue ä¸­å¯¹åº”çš„ srcipt\n\u0026lt;script\u0026gt; import axios from \u0026#39;axios\u0026#39; axios.get(\u0026#39;/sc\u0026#39;) // ä½¿ç”¨ajax export default { name: \u0026#39;HelloWorld\u0026#39;, data () { return { msg: \u0026#39;Welcome to Your Vue.js App\u0026#39; } } } \u0026lt;/script\u0026gt; æœ€ç»ˆå®Œæˆçš„æ—¶å€™ï¼Œè®¿é—® \u0026lsquo;/\u0026rsquo;ï¼Œå¯ä»¥çœ‹åˆ° cookie æ·»åŠ äº†ä¸€ä¸ª kv å¯¹ã€‚ç°åœ¨æš‚æ—¶çœ‹ä¸åˆ°æ•ˆæœï¼Œå› ä¸ºæ¥å£åç«¯æ²¡æœ‰å®ç°ã€‚\nåç«¯æ¥å£å®ç°,è¿™é‡Œä½¿ç”¨çš„ goï¼Œå…·ä½“ go ç¼–è¯‘å™¨çš„å®‰è£…æ–¹æ³• è§è¿™é‡Œ\npackage main import ( \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;time\u0026#34; ) func LoggingMiddleware(next http.Handler) http.Handler { return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) { log.Println(\u0026#34;-\u0026gt;\u0026#34;, r.URL) next.ServeHTTP(w, r) log.Println(\u0026#34;\u0026lt;-\u0026#34;) }) } func main() { http.Handle(\u0026#34;/sc\u0026#34;, LoggingMiddleware(http.HandlerFunc(indexHandler))) port := \u0026#34;:8081\u0026#34; log.Println(\u0026#34;starting on http://localhost\u0026#34; + port) log.Fatal(http.ListenAndServe(port, nil)) } func indexHandler(w http.ResponseWriter, req *http.Request) { expire := time.Now().AddDate(0, 0, 1) cookie := http.Cookie{Name: \u0026#34;csrftoken\u0026#34;, Value: expire.String(), Expires: expire} http.SetCookie(w, \u0026amp;cookie) } æ­¤æ—¶å‰åç«¯éƒ½å·²ç»å®ç°äº†ï¼Œä½†æ˜¯å› ä¸ºå‰ç«¯å¼€åœ¨äº†ç«¯å£ 8080ï¼Œåç«¯å¼€åœ¨äº† 8081ï¼Œæ¶‰åŠåˆ°è·¨åŸŸï¼Œç›¸äº’æ²¡æ³•è®¿é—®ã€‚éœ€è¦é…ç½®ä¸€ä¸‹ webpack çš„é…ç½®æ‰å¯ä»¥ã€‚\n// ä¿®æ”¹ä¸€ä¸‹æ–‡ä»¶/config/index.js: 13 line proxyTable: { \u0026#39;/\u0026#39;: { target: \u0026#39;http://localhost:8081\u0026#39;, changeOrigin: true } }, ä¹‹åï¼Œå¼€å¯å‰åç«¯æœåŠ¡ï¼š\nnpm dev run go run server.go ä¹‹åè®¿é—®å‰ç«¯é¡µé¢ï¼Œlocalhost:8080ï¼ŒæŒ‰ F12 -\u0026gt; Application -\u0026gt; Cookiesï¼Œ å³å¯çœ‹åˆ°æ¯æ¬¡åˆ·æ–°éƒ½ä¼šæ”¹å˜çš„ csrftoken çš„ cookie\næœ€ç»ˆçš„ç½‘ç«™è§ ExFly/FrontBackSep\nåè®° # æ—¢ç„¶åœ¨å‰åç«¯åˆ†ç¦»åçš„åç«¯å¯ä»¥é…ç½®cookieï¼Œå…¶ä»–çš„æ‰€æœ‰æ“ä½œéƒ½å¯ä»¥è¿›è¡Œäº†ã€‚è¿›ä¸€æ­¥å¯ä»¥å®ç°å…¶ä»–çš„æ“ä½œã€‚å¦‚ä¸Šã€‚\nå¼•ç”¨ # developer-roadmap: frontend backend DevOps web ç ”å‘æ¼”è¿› ç½‘æ˜“å‰åç«¯åˆ†ç¦»å®è·µ "},{"id":37,"href":"/posts/Architecture/ITabstract/","title":"æŠ€æœ¯å˜é©","section":"Blog","content":"æ€»ç»“ä¸€ä¸‹æ•°æ®åº“ã€åˆ†å¸ƒå¼ç­‰æŠ€æœ¯äº§ç”Ÿçš„åœºæ™¯çš„ä½¿ç”¨åœºæ™¯ã€‚åŒ…æ‹¬æ•°æ®åº“ã€ç¼“å­˜ã€åˆ†å¸ƒå¼ã€å®¹å™¨\nä»ä½¿ç”¨åˆ°çš„æŠ€æœ¯æ¥è¯´ï¼Œå¦‚ä»Šå„å¤§ç½‘ç«™å¹³å°è¶‹å‘äºä½¿ç”¨ç»è¿‡é•¿æœŸæ£€éªŒè¿‡çš„æŠ€æœ¯ï¼ŒåŒ…æ‹¬ä¸é™äºåŠ¨æ€ç½‘ç«™æŠ€æœ¯ã€æ•°æ®åº“æŠ€æœ¯ã€é«˜é€Ÿç¼“å­˜æŠ€æœ¯ã€è´Ÿè½½å‡è¡¡ã€åˆ†å¸ƒå¼ç›¸å…³æŠ€æœ¯ã€‚\né¦–å…ˆåŠ¨æ€ç½‘ç«™æŠ€æœ¯ï¼Œå¼€å§‹æ²¡æœ‰åŠ¨æ€ç½‘ç«™æ—¶æœŸï¼Œå¤§éƒ¨åˆ† BBS ä½¿ç”¨åŸºäº Telnet åè®®ä¸ºåŸºç¡€çš„ BBS è¿›è¡Œäº¤æµã€‚HTTP åè®®çš„å‡ºç°ï¼Œä½¿å¾— BS æ¶æ„çš„ç½‘ç«™èƒ½å¤Ÿå±•ç°å¤šåª’ä½“ç­‰ä¿¡æ¯å¦‚è§†é¢‘ã€éŸ³ä¹ç­‰ã€‚èµ·åˆ HTTP åè®®ä¸€èˆ¬ä»…å±•ç¤ºä¸€äº›é™æ€æ•°æ®ï¼Œå…¶è¡¨ç°èƒ½åŠ›ä¸å¼ºï¼Œä¸èƒ½æ›´å¥½çš„åŠ¨æ€çš„ä¸ºç”¨æˆ·äº¤äº’ã€‚ä¹‹ååŠ¨æ€ç½‘ç«™æŠ€æœ¯å¦‚ CGI çš„å‡ºç°ï¼Œä½¿å¾—ç½‘ç«™æ‹¥æœ‰çš„æ›´åŠ ä¸°å¯Œçš„äº¤äº’åŠŸèƒ½ã€‚ç»è¿‡æ•°åå¹´çš„æŠ€æœ¯ç§¯ç´¯ï¼ŒåŠ¨æ€ç½‘ç«™æŠ€æœ¯å·²ç»èƒ½å¤Ÿæ”¯æ’‘èµ·ç°å¦‚ä»Šçš„å¤§éƒ¨åˆ†ä¿¡æ¯çš„è·å–ã€‚\nå…¶æ¬¡æ˜¯å­˜å‚¨æŠ€æœ¯ã€‚å¼€å§‹çš„æ—¶å€™æ•°æ®ä»…ä»…ä½¿ç”¨æœ¬åœ°æ–‡ä»¶è¿›è¡Œå­˜å‚¨ã€‚æ–‡ä»¶çš„è¯»å†™æ•ˆç‡å¾ˆé«˜ï¼Œä½†æ˜¯éœ€è¦ç¨‹åºå‘˜é‡å¤çš„ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„è¾ƒåº•å±‚çš„æ“ä½œæ¥æ“ä½œæ–‡ä»¶ï¼Œå¯¹ç¨‹åºå‘˜çš„è¦æ±‚å¤ªå¤§ã€‚è€Œä¸”å¯¹è¿™ç§ç»“æ„åŒ–çš„æ•°æ®æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ¨¡å¼è¿›è¡Œæ“ä½œã€‚æ‰€ä»¥æœ‰äº†æ•°æ®åº“å…³ç³»ç³»ç»Ÿï¼Œå°¤å…¶å…³ç³»å‹æ•°æ®åº“ã€‚ä»æ­¤ï¼Œå¯¹äºä¸€äº›ç»“æ„åŒ–çš„æ•°æ®åªéœ€è¦ä½¿ç”¨ SQL è¿™ç§æ•°æ®æ“ä½œè¯­è¨€ï¼Œå°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ“ä½œæ•°æ®ï¼Œè€ŒçœŸæ­£çš„æ•°æ®ç®¡ç†ç»´æŠ¤å·¥ä½œç”±æ•°æ®åº“ç®¡ç†ç³»ç»Ÿè¿›è¡Œç»´æŠ¤ï¼Œäººå¯ä»¥é€šè¿‡é…ç½®æ•°æ®åº“ï¼Œä½¿æ•°æ®åº“è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚å½“ç”¨æˆ·é‡å¾ˆå¤§æ—¶å€™ï¼Œå•æœºå“åº”å‡ºç°ç“¶é¢ˆï¼Œå•å°æ•°æ®åº“ä¸èƒ½å¤Ÿæ»¡è¶³è¿™æ ·çš„è¯·æ±‚ã€‚å¯ä»¥é€šè¿‡å¤åˆ¶çš„æ–¹å¼ï¼Œå°†ç›¸åŒçš„æ•°æ®å¤åˆ¶åˆ°å¤šå°æœºå™¨ä¸Šï¼Œå¤šå°æœºå™¨ä¸ºç”¨æˆ·æä¾›æ•°æ®ï¼Œå¯¹äºè¯»æ“ä½œè¿›è¡Œæ‰©å±•ã€‚å¯¹äºè¯»å¤šå†™å°‘çš„ç½‘ç«™ï¼Œè¿™ç§æ–¹å¼åŸºæœ¬å¯ä»¥å®ç°çº¿æ€§çš„æ€§èƒ½æå‡ã€‚æ•°æ®é‡å†å¤§ä¸€äº›ï¼Œä½¿ç”¨åˆ†åº“åˆ†è¡¨æ–¹å¼ï¼ŒæŠŠä¸€ä»½æ•°æ®åˆ‡ç‰‡ï¼Œåˆ†å¸ƒåˆ°å¤šå°æœºå™¨ä¸Šæé«˜æ€§èƒ½ã€‚è¿›è€Œä½¿ç”¨å¤åˆ¶ä¸åˆ†åº“åˆ†è¡¨çš„æ–¹å¼ï¼Œè¿›ä¸€æ­¥å‹æ¦¨å•æœºçš„æ€§èƒ½æ½œåŠ›ã€‚å•æœºæ•°æ®åº“å¾ˆå¼ºå¤§ï¼Œä½†æ•°æ®é‡è¾¾åˆ°ä¸€å®šçš„æ•°é‡çº§ï¼Œæ•°æ®åº“çš„æ€§èƒ½å®Œå…¨ä¸èƒ½æ»¡è¶³éœ€æ±‚ã€‚å¤§æ•°æ®æ—¶ä»£ï¼Œæ•°æ®é‡è¾¾åˆ° PBã€TB çº§åˆ«ã€‚è€Œæ¯ä¸€å—ç¡¬ç›˜ä»…ä»…å‡  Tï¼Œå•æœºå®Œå…¨ä¸å¯èƒ½å°†æ‰€æœ‰çš„æ•°æ®éƒ½å­˜å‚¨ä¸‹æ¥ã€‚å¦‚ä¸Šåˆ†åº“åˆ†è¡¨çš„æ–¹å¼åŸºæœ¬å·²ç»ä¸èƒ½å®Œå…¨è§£å†³å¦‚ä¸Šçš„é—®é¢˜ï¼Œæ‰€ä»¥å‡ºç°äº†åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œæ¯”å¦‚ MySQL Cluster ç­‰é€šè¿‡ä¸¤é˜¶æ®µæäº¤ç­‰æ–¹å¼ï¼Œç»´æŠ¤çº¿ä¸Šæ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œæ¯”å¦‚ Google ç ”å‘çš„ GFSï¼Œç°å¦‚ä»Šæ­£ç«çƒ­çš„ HDFS ç­‰ï¼ŒåŸºæœ¬å¯ä»¥æ»¡è¶³æµ·é‡æ•°æ®çš„å­˜å‚¨ã€‚\né«˜é€Ÿç¼“å­˜æŠ€æœ¯ï¼Œå¦‚ä¸€äº›åœºæ™¯é‡å¤è¯»çš„åœºæ™¯ï¼Œæ•°æ®åº“çš„æŸ¥è¯¢å¾ˆæ˜‚è´µï¼Œå¦‚ä½•å‡å°‘æ•°æ®åº“çš„è®¿é—®æ¬¡æ•°ï¼Ÿä½¿ç”¨ç±»ä¼¼ Redis çš„ç¼“å­˜ã€‚redis çš„æ•°æ®å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå†…å­˜çš„é€Ÿåº¦è¿œè¿œè¶…è¿‡æ•°æ®åº“çš„æŸ¥è¯¢é€Ÿåº¦ã€‚ç»´æŠ¤ redis ä¸­çš„ç¼“å­˜æ•°æ®ä¸€è‡´æ€§ï¼Œé˜²æ­¢ç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©çš„é—®é¢˜ï¼Œä»¥åŠå¦‚ä½•æ­£ç¡®çš„ä½¿ç”¨ç¼“å­˜ç­‰ä¸€ç³»åˆ—é—®é¢˜ï¼Œç°å¦‚ä»Šå·²ç»åŸºæœ¬æœ‰äº†å¾ˆå¥½çš„è§£å†³åŠæ³•ã€‚\nè´Ÿè½½å‡è¡¡ä¸åå‘ä»£ç†ï¼Œä¼ ç»Ÿä¸­ä½¿ç”¨ nginx ä½œä¸ºç½‘å…³ï¼Œæ¥å—çš„è¯·æ±‚åˆ†å‘åˆ°å¤šå°æœåŠ¡å™¨ä¸­ï¼Œä¸€å®šç¨‹åº¦ä¸Šåˆ†æ‹…å•å°æœåŠ¡å™¨çš„å‹åŠ›ã€‚\nå¯¹äºåˆ†å¸ƒå¼æŠ€æœ¯ã€‚é¦–å…ˆæ˜¯ Google ç ”å‘å¹¶ä½¿ç”¨çš„ GFS ä»¥åŠæ­å»ºåœ¨ GFS åŸºç¡€ä¸Šçš„ BigTableï¼Œä»¥åŠ MapReduce ç®—æ³•ï¼Œä½¿å¾—åˆ†å¸ƒå¼å­˜å‚¨ä¸åˆ†å¸ƒå¼è®¡ç®—æˆä¸ºäº†å¯èƒ½ã€‚å¯¹åº”çš„å¼€æºç‰ˆæœ¬ä¸º HDFSã€Hadoopã€Spark ç­‰ä¸€ç³»åˆ—åˆ†å¸ƒå¼åŸºç¡€è®¾æ–½ã€‚å­˜å‚¨çš„åˆ†å¸ƒå¼ï¼Œä¹Ÿå¯¹åº”ç€åº”ç”¨éƒ¨ç½²çš„åˆ†å¸ƒå¼ï¼Œä¹Ÿå°±æ˜¯ç°å¦‚ä»Šä½¿ç”¨æ¯”è¾ƒå¹¿æ³›çš„å¾®æœåŠ¡ï¼ˆå°†ä¸€ä¸ªæ•´ä½“çš„åº”ç”¨æ‹†åˆ†æˆä¸åŒçš„æœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´åˆ†åˆ«å¼€å‘å’Œéƒ¨ç½²ï¼Œé€šè¿‡ç»Ÿä¸€çš„æ¥å£è¿›è¡Œåä½œï¼‰ã€‚å¾®æœåŠ¡éƒ¨ç½²å°‘åˆ™å‡ ä¸ªï¼Œå¤šåˆ™æˆç™¾ä¸Šåƒï¼Œå¦‚æ­¤å¤šçš„æœåŠ¡éœ€è¦å¼€å‘éƒ¨ç½²å·¥ä½œé‡å·¨å¤§ã€‚åŒæ—¶å¾ˆå¸¸è§çš„é—®é¢˜æ˜¯å¼€å‘ç¯å¢ƒå¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä¸Šçº¿å´æ— æ³•å·¥ä½œã€‚è¿™ä¸ªé—®é¢˜ç°å¦‚ä»Šçš„è§£å†³åŠæ³•æ˜¯ä½¿ç”¨ dockerã€‚é¦–å…ˆ docker æ˜¯ä¸€ç§ä½¿ç”¨ Linux å†…æ ¸æä¾›çš„ cgroup å’Œ namespace åŠŸèƒ½ï¼Œå®ƒå¯ä»¥å°†è®¡ç®—æœºçš„èµ„æºè¿›è¡Œéš”ç¦»ã€‚ä½¿ç”¨åœºæ™¯æ˜¯é€šè¿‡å®¹å™¨ç¼–æ’å·¥å…·ï¼Œå°†æœåŠ¡æ‰€ä¾èµ–çš„èµ„æºé€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œå®šä¹‰ï¼Œç”±ç¼–æ’å·¥å…·ç»Ÿä¸€å¯¹æ‰€æœ‰çš„æœåŠ¡è¿›è¡Œå¯åŠ¨éƒ¨ç½²ã€‚ç°å¦‚ä»Šå®è´¨ä¸Šçš„å®¹å™¨ç¼–æ’æ ‡å‡† Kubernetesï¼Œå·²ç»è¢«ä¸é™äº Googleã€ç™¾åº¦ã€é˜¿é‡Œå·´å·´ã€äº¬ä¸œç­‰ä½¿ç”¨ã€‚å¯¹äº Google ç­‰åŸºæœ¬å®ç°å®¹å™¨åŒ–ã€Kubernetes åŒ–ã€‚\n"},{"id":38,"href":"/posts/tools/realize/","title":"Realizeä»£ç åˆ†æ","section":"Blog","content":" realize ä»£ç åˆ†æ\nRealize # realize æ˜¯ Go å†™çš„ workfloaw å·¥å…·ï¼Œå¯ä»¥é…ç½®è‡ªå·±çš„å·¥ä½œæµã€‚é¡¹ç›®åœ¨ä¿®æ”¹ä¹‹åéœ€è¦è¿›è¡Œç¼–è¯‘ã€æµ‹è¯•ï¼Œå¯ä»¥è¿˜æœ‰å…¶ä»–çš„ä¸€ç³»åˆ—æµç¨‹éœ€è¦èµ°ï¼Œå¯ä»¥ä½¿ç”¨ realize è¿›è¡Œè‡ªåŠ¨åŒ–ã€‚æŠ½ç‚¹æ—¶é—´ç ”ç©¶äº†ä¸€ä¸‹æºç ã€‚è¿™é‡Œæ€»ç»“ä¸€ä¸‹æ€è·¯ï¼Œä¸æ˜¯å¾ˆå®Œæ•´çš„è§£é‡Šï¼Œç®€å•è¯´ä¸€ä¸‹æ€è·¯ã€‚\nåŸç† # ä» Linux 2.6.13 å†…æ ¸å¼€å§‹ï¼ŒLinux å°±æ¨å‡ºäº† inotifyï¼Œå…è®¸ç›‘æ§ç¨‹åºæ‰“å¼€ä¸€ä¸ªç‹¬ç«‹æ–‡ä»¶æè¿°ç¬¦ï¼Œå¹¶é’ˆå¯¹äº‹ä»¶é›†ç›‘æ§ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–‡ä»¶ï¼Œä¾‹å¦‚æ‰“å¼€ã€å…³é—­ã€ç§»åŠ¨/é‡å‘½åã€åˆ é™¤ã€åˆ›å»ºæˆ–è€…æ”¹å˜å±æ€§ã€‚glib å¯¹å¯¹æ­¤è¿›è¡Œäº†å°è£… glib/inotify.h,åŒæ—¶å„ä¸ªæ“ä½œç³»ç»Ÿéƒ½æœ‰å¯¹åº”çš„å®ç°ï¼Œwin ä¸‹çš„ ReadDirectoryChangesWï¼Œmac ä¸‹çš„ FSEventsã€‚åŒæ—¶ go ä¸‹å·²ç»æœ‰å†™å¥½çš„å°è£…åº“ fsnotify/fsnotifyï¼Œå¯¹ä¸åŒçš„å¹³å°è¿›è¡Œäº†å°è£…ã€‚\nç®€å•æ¥è®²ï¼Œå†…æ ¸ä¸ºåº”ç”¨ç¨‹åºæä¾›äº†ç³»ç»Ÿçº§æ–‡ä»¶ä¿®æ”¹äº‹ä»¶çš„ç›‘è§†å™¨ã€‚å½“æ–‡ä»¶è¿›è¡Œä¿®æ”¹åï¼Œä¼šé€šçŸ¥åº”ç”¨ç¨‹åºç›‘è§†çš„æ–‡ä»¶å·²ç»ä¿®æ”¹äº†ï¼Œä¹‹åæœ‰realizeè¿›è¡Œäº‹ä»¶çš„å¤„ç†å³å¯ã€‚\næ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ï¼Œyamlæ–‡ä»¶çš„marshalå’Œunmarshalã€‚ä¹‹åå¯ä»¥ç ”ç©¶ä¸€ä¸‹ã€‚\næ ¸å¿ƒä»£ç  # // github.com/oxequa/realize/realize/projects.go func (p *Project) Watch(wg *sync.WaitGroup) { var err error // change channel p.stop = make(chan bool) // init a new watcher p.watcher, err = NewFileWatcher(p.parent.Settings.Legacy) if err != nil { log.Fatal(err) } defer func() { close(p.stop) p.watcher.Close() }() // before start checks p.Before() // start watcher go p.Reload(\u0026#34;\u0026#34;, p.stop) L: for { select { case event := \u0026lt;-p.watcher.Events(): if p.parent.Settings.Recovery.Events { log.Println(\u0026#34;File:\u0026#34;, event.Name, \u0026#34;LastFile:\u0026#34;, p.last.file, \u0026#34;Time:\u0026#34;, time.Now(), \u0026#34;LastTime:\u0026#34;, p.last.time) } if time.Now().Truncate(time.Second).After(p.last.time) { // switch event type switch event.Op { case fsnotify.Chmod: case fsnotify.Remove: p.watcher.Remove(event.Name) if p.Validate(event.Name, false) \u0026amp;\u0026amp; ext(event.Name) != \u0026#34;\u0026#34; { // stop and restart close(p.stop) p.stop = make(chan bool) p.Change(event) go p.Reload(\u0026#34;\u0026#34;, p.stop) } default: if p.Validate(event.Name, true) { fi, err := os.Stat(event.Name) if err != nil { continue } if fi.IsDir() { filepath.Walk(event.Name, p.walk) } else { // stop and restart close(p.stop) p.stop = make(chan bool) p.Change(event) go p.Reload(event.Name, p.stop) p.last.time = time.Now().Truncate(time.Second) p.last.file = event.Name } } } } case err := \u0026lt;-p.watcher.Errors(): p.Err(err) case \u0026lt;-p.exit: p.After() break L } } wg.Done() } Reference # ç”¨ inotify ç›‘æ§ Linux æ–‡ä»¶ç³»ç»Ÿäº‹ä»¶ oxequa/realize fsnotify/fsnotify "},{"id":39,"href":"/posts/Bigdata/SparkStream/","title":"SparkStreamç­‰ç›¸å…³äº§å“é€‰å‹ä»¥åŠSparkå®‰è£…ä¸ç®€å•ä½¿ç”¨","section":"Blog","content":"æ¯”è¾ƒSparkStreamç±»ä¼¼äº§å“å¦‚Samzaã€Stormï¼Œä»‹ç»Sparkå’ŒSpark Streamå®‰è£…å’Œç®€å•ä½¿ç”¨æ–¹æ³•\nå„äº§å“æ¯”è¾ƒ # Samza # Samza æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æµå¼æ•°æ®å¤„ç†æ¡†æ¶ï¼ˆstreaming processingï¼‰ï¼ŒLinkedin å¼€æºçš„äº§å“ï¼Œ å®ƒæ˜¯åŸºäº Kafka æ¶ˆæ¯é˜Ÿåˆ—æ¥å®ç°ç±»å®æ—¶çš„æµå¼æ•°æ®å¤„ç†çš„ã€‚æ›´ä¸ºå‡†ç¡®çš„è¯´æ³•æ˜¯ï¼ŒSamza æ˜¯é€šè¿‡æ¨¡å—åŒ–çš„å½¢å¼æ¥ä½¿ç”¨ Apache Kafka çš„ï¼Œå› æ­¤å¯ä»¥æ„æ¶åœ¨å…¶ä»–æ¶ˆæ¯é˜Ÿåˆ—æ¡†æ¶ä¸Šï¼Œä½†å‡ºå‘ç‚¹å’Œé»˜è®¤å®ç°æ˜¯åŸºäº Apache Kafkaã€‚\næœ¬è´¨ä¸Šè¯´ï¼ŒSamza æ˜¯åœ¨æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿä¸Šçš„æ›´é«˜å±‚çš„æŠ½è±¡ï¼Œæ˜¯ä¸€ç§åº”ç”¨æµå¼å¤„ç†æ¡†æ¶åœ¨æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿä¸Šçš„ä¸€ç§åº”ç”¨æ¨¡å¼çš„å®ç°ã€‚\næ€»çš„æ¥è¯´ï¼ŒSamza ä¸ Storm ç›¸æ¯”ï¼Œä¼ è¾“ä¸Šå®Œå…¨åŸºäº Apache Kafkaï¼Œé›†ç¾¤ç®¡ç†åŸºäº Hadoop YARNï¼Œå³ Samza åªè´Ÿè´£å¤„ç†è¿™ä¸€å—å…·ä½“ä¸šåŠ¡ï¼Œå†åŠ ä¸ŠåŸºäº RocksDB çš„çŠ¶æ€ç®¡ç†ã€‚ç”±äºå—é™äº Kafka å’Œ YARNï¼Œæ‰€ä»¥å®ƒçš„æ‹“æ‰‘ç»“æ„ä¸å¤Ÿçµæ´»ã€‚\nStorm # Storm æ¡†æ¶ä¸å…¶ä»–å¤§æ•°æ®è§£å†³æ–¹æ¡ˆçš„ä¸åŒä¹‹å¤„ï¼Œåœ¨äºå®ƒçš„å¤„ç†æ–¹å¼ã€‚Apcahe Hadoop æœ¬è´¨ä¸Šæ¥è¯´æ˜¯ä¸€ä¸ªæ‰¹å¤„ç†ç³»ç»Ÿï¼Œå³ç›®æ ‡åº”ç”¨æ¨¡å¼æ˜¯é’ˆå¯¹ç¦»çº¿åˆ†æä¸ºä¸»ã€‚æ•°æ®è¢«å¼•å…¥Hadoopçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ (HDFS)ï¼Œå¹¶è¢«å‡åŒ€åœ°åˆ†å‘åˆ°å„ä¸ªèŠ‚ç‚¹è¿›è¡Œå¤„ç†ï¼ŒHDFS çš„æ•°æ®å¹³è¡¡è§„åˆ™å¯ä»¥å‚ç…§æœ¬æ–‡ä½œè€…å‘è¡¨äºIBMçš„æ–‡ç« ã€ŠHDFSæ•°æ®å¹³è¡¡è§„åˆ™åŠå®éªŒä»‹ç»ã€‹ï¼Œè¿›è¡Œæ·±å…¥äº†è§£ã€‚å½“å¤„ç†å®Œæˆæ—¶ï¼Œç»“æœæ•°æ®è¿”å›åˆ°HDFSï¼Œç„¶åå¯ä»¥ä¾›å¤„ç†å‘èµ·è€…ä½¿ç”¨ã€‚Stormåˆ™æ”¯æŒåˆ›å»ºæ‹“æ‰‘ç»“æ„æ¥è½¬æ¢æ²¡æœ‰ç»ˆç‚¹çš„æ•°æ®æµã€‚ä¸åŒäºHadoopä½œä¸šï¼Œè¿™äº›è½¬æ¢ä»ä¸ä¼šè‡ªåŠ¨åœæ­¢ï¼Œå®ƒä»¬ä¼šæŒç»­å¤„ç†åˆ°è¾¾çš„æ•°æ®ï¼Œå³Stormçš„æµå¼å®æ—¶å¤„ç†æ–¹å¼ã€‚\nSpark Streaming # Spark Streaming ç±»ä¼¼äº Apache Stormï¼Œç”¨äºæµå¼æ•°æ®çš„å¤„ç†ã€‚æ ¹æ®å…¶å®˜æ–¹æ–‡æ¡£ä»‹ç»ï¼ŒSpark Streaming æœ‰é«˜ååé‡å’Œå®¹é”™èƒ½åŠ›å¼ºè¿™ä¸¤ä¸ªç‰¹ç‚¹ã€‚Spark Streaming æ”¯æŒçš„æ•°æ®è¾“å…¥æºå¾ˆå¤šï¼Œä¾‹å¦‚ï¼šKafkaã€Flumeã€Twitterã€ZeroMQ å’Œç®€å•çš„ TCP å¥—æ¥å­—ç­‰ç­‰ã€‚æ•°æ®è¾“å…¥åå¯ä»¥ç”¨ Spark çš„é«˜åº¦æŠ½è±¡åŸè¯­å¦‚ï¼šmapã€reduceã€joinã€window ç­‰è¿›è¡Œè¿ç®—ã€‚è€Œç»“æœä¹Ÿèƒ½ä¿å­˜åœ¨å¾ˆå¤šåœ°æ–¹ï¼Œå¦‚ HDFSï¼Œæ•°æ®åº“ç­‰ã€‚å¦å¤– Spark Streaming ä¹Ÿèƒ½å’Œ MLlibï¼ˆæœºå™¨å­¦ä¹ ï¼‰ä»¥åŠ Graphx å®Œç¾èåˆã€‚\nåœ¨ Spark Streamingä¸­ï¼Œå¤„ç†æ•°æ®çš„å•ä½æ˜¯ä¸€æ‰¹è€Œä¸æ˜¯å•æ¡ï¼Œè€Œæ•°æ®é‡‡é›†å´æ˜¯é€æ¡è¿›è¡Œçš„ï¼Œå› æ­¤ Spark Streamingç³»ç»Ÿéœ€è¦è®¾ç½®é—´éš”ä½¿å¾—æ•°æ®æ±‡æ€»åˆ°ä¸€å®šçš„é‡åå†ä¸€å¹¶æ“ä½œï¼Œè¿™ä¸ªé—´éš”å°±æ˜¯æ‰¹å¤„ç†é—´éš”ã€‚æ‰¹å¤„ç†é—´éš”ï¼ˆ0.2s-2sï¼‰æ˜¯ Spark Streaming çš„æ ¸å¿ƒæ¦‚å¿µå’Œå…³é”®å‚æ•°ï¼Œå®ƒå†³å®šäº† Spark Streaming æäº¤ä½œä¸šçš„é¢‘ç‡å’Œæ•°æ®å¤„ç†çš„å»¶è¿Ÿï¼ŒåŒæ—¶ä¹Ÿå½±å“ç€æ•°æ®å¤„ç†çš„ååé‡å’Œæ€§èƒ½ã€‚\nKafka Sreeam # Kafka Streamsæ˜¯ä¸€ä¸ªç”¨äºå¤„ç†å’Œåˆ†ææ•°æ®çš„å®¢æˆ·ç«¯åº“ã€‚å®ƒå…ˆæŠŠå­˜å‚¨åœ¨Kafkaä¸­çš„æ•°æ®è¿›è¡Œå¤„ç†å’Œåˆ†æï¼Œç„¶åå°†æœ€ç»ˆæ‰€å¾—çš„æ•°æ®ç»“æœå›å†™åˆ°Kafkaæˆ–å‘é€åˆ°å¤–éƒ¨ç³»ç»Ÿå»ã€‚å®ƒå»ºç«‹åœ¨ä¸€äº›éå¸¸é‡è¦çš„æµå¼å¤„ç†æ¦‚å¿µä¹‹ä¸Šï¼Œä¾‹å¦‚é€‚å½“åŒºåˆ†äº‹ä»¶æ—¶é—´å’Œå¤„ç†æ—¶é—´ã€çª—å£æ”¯æŒï¼Œä»¥åŠåº”ç”¨ç¨‹åºçŠ¶æ€çš„ç®€å•ï¼ˆé«˜æ•ˆï¼‰ç®¡ç†ã€‚åŒæ—¶ï¼Œå®ƒä¹ŸåŸºäºKafkaä¸­çš„è®¸å¤šæ¦‚å¿µï¼Œä¾‹å¦‚é€šè¿‡åˆ’åˆ†ä¸»é¢˜è¿›è¡Œæ‰©å±•ã€‚æ­¤å¤–ï¼Œç”±äºè¿™ä¸ªåŸå› ï¼Œå®ƒä½œä¸ºä¸€ä¸ªè½»é‡çº§çš„åº“å¯ä»¥é›†æˆåˆ°åº”ç”¨ç¨‹åºä¸­å»ã€‚è¿™ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®éœ€è¦ç‹¬ç«‹è¿è¡Œã€åœ¨åº”ç”¨ç¨‹åºæœåŠ¡å™¨ä¸­è¿è¡Œã€ä½œä¸ºDockerå®¹å™¨ï¼Œæˆ–é€šè¿‡èµ„æºç®¡ç†å™¨ï¼ˆå¦‚Mesosï¼‰è¿›è¡Œæ“ä½œã€‚\nKafka Sreeamç›´æ¥è§£å†³äº†æµå¼å¤„ç†ä¸­çš„å¾ˆå¤šå›°éš¾é—®é¢˜:æ¯«ç§’çº§å»¶è¿Ÿçš„é€ä¸ªäº‹ä»¶å¤„ç†ã€‚æœ‰çŠ¶æ€çš„å¤„ç†ï¼ŒåŒ…æ‹¬åˆ†å¸ƒå¼è¿æ¥å’Œèšåˆã€‚æ–¹ä¾¿çš„DSLã€‚ä½¿ç”¨ç±»ä¼¼DataFlowçš„æ¨¡å‹å¯¹æ— åºæ•°æ®è¿›è¡Œçª—å£åŒ–ã€‚å…·æœ‰å¿«é€Ÿæ•…éšœåˆ‡æ¢çš„åˆ†å¸ƒå¼å¤„ç†å’Œå®¹é”™èƒ½åŠ›ã€‚æ— åœæœºæ»šåŠ¨éƒ¨ç½²ã€‚\nä¸»è¦æ¯”è¾ƒSpark Streamå’ŒStormå’Œé€‰æ‹© # æ¯”è¾ƒé¡¹ SparkStream Storm è¡€ç»Ÿ UC Berkeley AMP lab Twitter å¼€æºæ—¶é—´ 2011.05 2011.09 ä¾èµ–ç¯å¢ƒ Java Zookeeper Java Python å¼€å‘è¯­è¨€ Scala Java Clojure æ”¯æŒè¯­è¨€ Scala Java Python R Any ç¡¬ç›˜IO å°‘ ä¸€èˆ¬ é›†ç¾¤æ”¯æŒ è¶…è¿‡1000èŠ‚ç‚¹ å¥½ ååé‡ å¥½ è¾ƒå¥½ ä½¿ç”¨å…¬å¸ intel è…¾è®¯ æ·˜å® ä¸­ç§»åŠ¨ Goole æ·˜å® ç™¾åº¦ Twitter é›…è™ é€‚ç”¨åœºæ™¯ è¾ƒå¤§æ•°æ®å—\u0026amp;éœ€è¦é«˜æ—¶æ•ˆæ€§çš„å°æ‰¹é‡è®¡ç®— å®æ—¶å°æ•°æ®å—çš„åˆ†æè®¡ç®— å»¶æ—¶ å‡†å®æ—¶ï¼šä¸€æ¬¡å¤„ç†ä¸€ä¸ªå³å°†åˆ°è¾¾çš„äº‹ä»¶ å®æ—¶ï¼šå¤„ç†åœ¨ä¸€å®šçš„æ—¶é—´å†…ï¼ˆæ—¶é—´é—´éš”å¯è‡ªå·±è®¾ç½®ï¼‰åœ¨çª—å£ä¸­æ”¶åˆ°çš„ä¸€æ‰¹äº‹ä»¶ å®¹é”™ åœ¨æ‰¹å¤„ç†çº§åˆ«è¿›è¡Œè·Ÿè¸ªå¤„ç†ï¼Œå› æ­¤å³ä½¿å‘ç”ŸèŠ‚ç‚¹æ•…éšœç­‰æ•…éšœï¼Œä¹Ÿå¯ä»¥æœ‰æ•ˆåœ°ä¿è¯æ¯ä¸ªå°æ‰¹é‡éƒ½èƒ½å¤Ÿè¢«ç²¾ç¡®å¤„ç†ä¸€æ¬¡ æ¯ä¸ªå•ç‹¬çš„è®°å½•å¿…é¡»åœ¨å…¶é€šè¿‡ç³»ç»Ÿæ—¶è¢«è·Ÿè¸ªï¼Œå› æ­¤Stormä»…ä¿è¯æ¯ä¸ªè®°å½•è‡³å°‘è¢«å¤„ç†ä¸€æ¬¡ï¼Œä½†æ˜¯ä»æ•…éšœä¸­æ¢å¤æœŸé—´å…è®¸å‡ºç°é‡å¤ã€‚ è¿™æ„å‘³ç€å¯å˜çŠ¶æ€å¯èƒ½ä¸æ­£ç¡®åœ°æ›´æ–°äº†ä¸¤æ¬¡ 1.å¤„ç†æ¨¡å‹ä»¥åŠå»¶è¿Ÿ\nè™½ç„¶è¿™ä¸¤ä¸ªæ¡†æ¶éƒ½æä¾›å¯æ‰©å±•æ€§(Scalability)å’Œå¯å®¹é”™æ€§(Fault Tolerance),ä½†æ˜¯å®ƒä»¬çš„å¤„ç†æ¨¡å‹ä»æ ¹æœ¬ä¸Šè¯´æ˜¯ä¸ä¸€æ ·çš„ã€‚Stormå¤„ç†çš„æ˜¯æ¯æ¬¡ä¼ å…¥çš„ä¸€ä¸ªäº‹ä»¶ï¼Œè€ŒSpark Streamingæ˜¯å¤„ç†æŸä¸ªæ—¶é—´æ®µçª—å£å†…çš„äº‹ä»¶æµã€‚å› æ­¤ï¼ŒStormå¤„ç†ä¸€ä¸ªäº‹ä»¶å¯ä»¥è¾¾åˆ°äºšç§’çº§çš„å»¶è¿Ÿï¼Œè€ŒSpark Streamingåˆ™æœ‰ç§’çº§çš„å»¶è¿Ÿã€‚\n2.å®¹é”™å’Œæ•°æ®ä¿è¯\nåœ¨å®¹é”™æ•°æ®ä¿è¯æ–¹é¢çš„æƒè¡¡æ–¹é¢ï¼ŒSpark Streamingæä¾›äº†æ›´å¥½çš„æ”¯æŒå®¹é”™çŠ¶æ€è®¡ç®—ã€‚åœ¨Stormä¸­ï¼Œå½“æ¯æ¡å•ç‹¬çš„è®°å½•é€šè¿‡ç³»ç»Ÿæ—¶å¿…é¡»è¢«è·Ÿè¸ªï¼Œæ‰€ä»¥Stormèƒ½å¤Ÿè‡³å°‘ä¿è¯æ¯æ¡è®°å½•å°†è¢«å¤„ç†ä¸€æ¬¡ï¼Œä½†æ˜¯åœ¨ä»é”™è¯¯ä¸­æ¢å¤è¿‡æ¥æ—¶å€™å…è®¸å‡ºç°é‡å¤è®°å½•ï¼Œè¿™æ„å‘³ç€å¯å˜çŠ¶æ€å¯èƒ½ä¸æ­£ç¡®åœ°è¢«æ›´æ–°ä¸¤æ¬¡ã€‚è€ŒSpark Streamingåªéœ€è¦åœ¨æ‰¹å¤„ç†çº§åˆ«å¯¹è®°å½•è¿›è¡Œè·Ÿè¸ªå¤„ç†ï¼Œå› æ­¤å¯ä»¥æœ‰æ•ˆåœ°ä¿è¯æ¯æ¡è®°å½•å°†å®Œå…¨è¢«å¤„ç†ä¸€æ¬¡ï¼Œå³ä¾¿ä¸€ä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœã€‚è™½ç„¶Stormçš„ Trident libraryåº“ä¹Ÿæä¾›äº†å®Œå…¨ä¸€æ¬¡å¤„ç†çš„åŠŸèƒ½ã€‚ä½†æ˜¯å®ƒä¾èµ–äºäº‹åŠ¡æ›´æ–°çŠ¶æ€ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ˆæ…¢çš„ï¼Œå¹¶ä¸”é€šå¸¸å¿…é¡»ç”±ç”¨æˆ·å®ç°ã€‚\nç®€è€Œè¨€ä¹‹,å¦‚æœä½ éœ€è¦äºšç§’çº§çš„å»¶è¿Ÿï¼ŒStormæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œè€Œä¸”æ²¡æœ‰æ•°æ®ä¸¢å¤±ã€‚å¦‚æœä½ éœ€è¦æœ‰çŠ¶æ€çš„è®¡ç®—ï¼Œè€Œä¸”è¦å®Œå…¨ä¿è¯æ¯ä¸ªäº‹ä»¶åªè¢«å¤„ç†ä¸€æ¬¡ï¼ŒSpark Streamingåˆ™æ›´å¥½ã€‚Spark Streamingç¼–ç¨‹é€»è¾‘ä¹Ÿå¯èƒ½æ›´å®¹æ˜“ï¼Œå› ä¸ºå®ƒç±»ä¼¼äºæ‰¹å¤„ç†ç¨‹åºï¼Œç‰¹åˆ«æ˜¯åœ¨ä½ ä½¿ç”¨æ‰¹æ¬¡(å°½ç®¡æ˜¯å¾ˆå°çš„)æ—¶ã€‚\n3.å®ç°å’Œç¼–ç¨‹API\nStormä¸»è¦æ˜¯ç”±Clojureè¯­è¨€å®ç°ï¼ŒSpark Streamingæ˜¯ç”±Scalaå®ç°ã€‚å¦‚æœä½ æƒ³çœ‹çœ‹è¿™ä¸¤ä¸ªæ¡†æ¶æ˜¯å¦‚ä½•å®ç°çš„æˆ–è€…ä½ æƒ³è‡ªå®šä¹‰ä¸€äº›ä¸œè¥¿ä½ å°±å¾—è®°ä½è¿™ä¸€ç‚¹ã€‚Stormæ˜¯ç”±BackTypeå’Œ Twitterå¼€å‘ï¼Œè€ŒSpark Streamingæ˜¯åœ¨UC Berkeleyå¼€å‘çš„ã€‚\nStormæä¾›äº†Java APIï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå…¶ä»–è¯­è¨€çš„APIã€‚ Spark Streamingæ”¯æŒScalaå’ŒJavaè¯­è¨€(å…¶å®ä¹Ÿæ”¯æŒPython)ã€‚å¦å¤–Spark Streamingçš„ä¸€ä¸ªå¾ˆæ£’çš„ç‰¹æ€§å°±æ˜¯å®ƒæ˜¯åœ¨Sparkæ¡†æ¶ä¸Šè¿è¡Œçš„ã€‚è¿™æ ·ä½ å°±å¯ä»¥æƒ³ä½¿ç”¨å…¶ä»–æ‰¹å¤„ç†ä»£ç ä¸€æ ·æ¥å†™Spark Streamingç¨‹åºï¼Œæˆ–è€…æ˜¯åœ¨Sparkä¸­äº¤äº’æŸ¥è¯¢ã€‚è¿™å°±å‡å°‘äº†å•ç‹¬ç¼–å†™æµæ‰¹é‡å¤„ç†ç¨‹åºå’Œå†å²æ•°æ®å¤„ç†ç¨‹åºã€‚\n4.ç”Ÿäº§æ”¯æŒ\nStormå·²ç»å‡ºç°å¥½å¤šå¹´äº†ï¼Œè€Œä¸”è‡ªä»2011å¹´å¼€å§‹å°±åœ¨Twitterå†…éƒ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›å…¬å¸ã€‚è€ŒSpark Streamingæ˜¯ä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œå¹¶ä¸”åœ¨2013å¹´ä»…ä»…è¢«Sharethroughä½¿ç”¨(æ®ä½œè€…äº†è§£)ã€‚\nStormæ˜¯ Hortonworks Hadoopæ•°æ®å¹³å°ä¸­æµå¤„ç†çš„è§£å†³æ–¹æ¡ˆï¼Œè€ŒSpark Streamingå‡ºç°åœ¨ MapRçš„åˆ†å¸ƒå¼å¹³å°å’ŒClouderaçš„ä¼ä¸šæ•°æ®å¹³å°ä¸­ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒDatabricksæ˜¯ä¸ºSparkæä¾›æŠ€æœ¯æ”¯æŒçš„å…¬å¸ï¼ŒåŒ…æ‹¬äº†Spark Streamingã€‚\n5.é›†ç¾¤ç®¡ç†é›†æˆ\nå°½ç®¡ä¸¤ä¸ªç³»ç»Ÿéƒ½è¿è¡Œåœ¨å®ƒä»¬è‡ªå·±çš„é›†ç¾¤ä¸Šï¼ŒStormä¹Ÿèƒ½è¿è¡Œåœ¨Mesosï¼Œè€ŒSpark Streamingèƒ½è¿è¡Œåœ¨YARN å’Œ Mesosä¸Šã€‚\nè¿™é‡Œæ€»ç»“äº†Kafka Stream-Spark Streaming-Stormæµå¼è®¡ç®—æ¡†æ¶æ¯”è¾ƒé€‰å‹çš„ç›¸å…³èµ„æ–™ã€‚\nè¿™é‡Œç”±æ›´å¤šçš„ç›¸å…³äº§å“çš„å·®å¼‚æ¯”è¾ƒèµ„æºï¼š\nStormä»‹ç» Spark Streaming vs. Kafka Stream å“ªä¸ªæ›´é€‚åˆä½ ï¼Ÿ å¤§æ•°æ®æ¡†æ¶å¯¹æ¯”ï¼šHadoopã€Stormã€Samzaã€Sparkå’ŒFlink Spark Streamingä¸Stormçš„å¯¹æ¯”åˆ†æ Stormå’ŒSpark Streamingçš„æ¨ªå‘æ¯”è¾ƒ Spark Streamingå’ŒStormå¦‚ä½•é€‰æ‹©ï¼Ÿæ­å»ºæµå¼å®æ—¶è®¡ç®—å¹³å°ï¼Œå¹¿å‘Šæ—¥å¿—å®æ—¶èŠ±è´¹ Spark Streaming æ–°æ‰‹æŒ‡å— Spark ä»‹ç» Sparkç”Ÿæ€ # Sparkå®˜ç½‘ç®€å•ä»‹ç»äº†sparkçš„çš„ä¼˜åŠ¿ã€‚\nè¿™é‡Œéå¸¸è¯¦ç»†äº†ä»‹ç»Sparkç”Ÿæ€ã€å„å¤§å‚åº”ç”¨åœºæ™¯ã€SparkåŸºæœ¬åŸç†ã€‚\nSpark å’Œ Spark Streamçš„å®‰è£…å’Œä½¿ç”¨ # Sparkä»‹ç» # Spark Streaming æ˜¯ Spark Core API çš„æ‰©å±•, å®ƒæ”¯æŒå¼¹æ€§çš„, é«˜ååçš„, å®¹é”™çš„å®æ—¶æ•°æ®æµçš„å¤„ç†. æ•°æ®å¯ä»¥é€šè¿‡å¤šç§æ•°æ®æºè·å–, ä¾‹å¦‚ Kafka, Flume, Kinesis ä»¥åŠ TCP sockets, ä¹Ÿå¯ä»¥é€šè¿‡ä¾‹å¦‚ map, reduce, join, window ç­‰çš„é«˜çº§å‡½æ•°ç»„æˆçš„å¤æ‚ç®—æ³•å¤„ç†. æœ€ç»ˆ, å¤„ç†åçš„æ•°æ®å¯ä»¥è¾“å‡ºåˆ°æ–‡ä»¶ç³»ç»Ÿ, æ•°æ®åº“ä»¥åŠå®æ—¶ä»ªè¡¨ç›˜ä¸­.äº‹å®ä¸Š,ä½ è¿˜å¯ä»¥åœ¨ data streamsï¼ˆæ•°æ®æµï¼‰ä¸Šä½¿ç”¨ æœºå™¨å­¦ä¹ ä»¥åŠ å›¾è®¡ç®— ç®—æ³•\nåœ¨å†…éƒ¨, å®ƒå·¥ä½œåŸç†å¦‚ä¸‹, Spark Streaming æ¥æ”¶å®æ—¶è¾“å…¥æ•°æ®æµå¹¶å°†æ•°æ®åˆ‡åˆ†æˆå¤šä¸ª batchï¼ˆæ‰¹ï¼‰æ•°æ®, ç„¶åç”± Spark å¼•æ“å¤„ç†å®ƒä»¬ä»¥ç”Ÿæˆæœ€ç»ˆçš„ stream of results in batchesï¼ˆåˆ†æ‰¹æµç»“æœï¼‰.\nSpark Streaming æä¾›äº†ä¸€ä¸ªåä¸º discretized stream æˆ– DStream çš„é«˜çº§æŠ½è±¡, å®ƒä»£è¡¨ä¸€ä¸ªè¿ç»­çš„æ•°æ®æµ. DStream å¯ä»¥ä»æ•°æ®æºçš„è¾“å…¥æ•°æ®æµåˆ›å»º, ä¾‹å¦‚ Kafka, Flume ä»¥åŠ Kinesis, æˆ–è€…åœ¨å…¶ä»– DStream ä¸Šè¿›è¡Œé«˜å±‚æ¬¡çš„æ“ä½œä»¥åˆ›å»º. åœ¨å†…éƒ¨, ä¸€ä¸ª DStream æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„ RDDs æ¥è¡¨ç¤º.\nä½ å¯ä»¥ä½¿ç”¨ Scala , Java æˆ–è€… Pythonï¼ˆSpark 1.2 ç‰ˆæœ¬åå¼•è¿›ï¼‰æ¥ç¼–å†™ Spark Streaming ç¨‹åº.\nè¿™é‡Œæ˜¯ä¸€ç¯‡å®˜æ–¹ç¼–ç¨‹æŒ‡å—\nSparkå®‰è£… # æ–¹å¼1 # wget http://mirror.bit.edu.cn/apache/spark/spark-2.3.1/spark-2.3.1-bin-hadoop2.7.tgz tar -xzf spark-2.3.1-bin-hadoop2.7.tgz # è¿è¡Œä¸€ä¸ªä¾‹å­ cd spark-2.3.1-bin-hadoop2.7 ./bin/run-example SparkPi æ–¹å¼äºŒ # æ¨èè¿™ç§æ–¹å¼è¿™é‡Œæ€»ç»“äº†è‡ªå·±æ­å»ºå„ç§å¼€å‘ç¯å¢ƒçš„å°±è‡ªåŠ¨åŒ–å®‰è£…è„šæœ¬ã€‚ç¬¬ä¸€æ¬¡å®‰è£…ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œä¹‹åå®ç°ä¸€æ¡å‘½ä»¤è‡ªåŠ¨å®‰è£…ã€‚éœ€è¦vagrant\u0026amp;virtualã€‚æœ‰ä¸€äº›ä¾èµ–docker\ngit clone https://github.com/ExFly/ComputSciLab.git cd ComputSciLab vagrant up vagrant ssh cd /vagrant/Java source install-small.sh cd /vagrant/Spark ./install.sh cd /vagrant/.softwenv/spark-2.3.1-bin-hadoop2.7 ./bin/run-example SparkPi ç»“æœå›¾ï¼š\nsparké›†ç¾¤ # æ‰¾åˆ°ä¸€ä¸ª ä¸­æ–‡çš„æ–‡æ¡£,å¯ä»¥çœ‹ä¸€ä¸‹ï¼Œéƒ¨ç½²å¾ˆç®€å•\næ€»ç»“ # å¦‚ä¸Š\n"},{"id":40,"href":"/posts/Architecture/EventuallyConsistent/","title":"åˆ†å¸ƒå¼æ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§","section":"Blog","content":"å•ä½“åº”ç”¨ï¼Œéœ€è¦å€ŸåŠ©åˆ†åº“åˆ†è¡¨ã€å¤åˆ¶æŠ€æœ¯ã€è¯»å†™åˆ†ç¦»æé«˜æœåŠ¡å¹¶å‘è®¿é—®é‡ã€‚å¾®æœåŠ¡ä¸ºä»£è¡¨çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå…¶é«˜å¹¶å‘å’Œå¾®æœåŠ¡äº‹åŠ¡ä¸€è‡´æ€§è¯¥å¦‚ä½•ä¿è¯ï¼Ÿ\nç®€ä»‹ # ç”±äºè‡ªå·±åˆšåˆšæ¥è§¦ï¼Œè‡ªå·±ç†è§£çš„ä¹Ÿä¸æ·±ã€‚åœ¨è¿™é‡Œï¼ŒæŠŠæˆ‘æ•´ç†çš„ä¸€äº›èµ„æ–™æ±‡æ€»ä¸‹æ¥ã€‚\nå¾®æœåŠ¡æ¶æ„ # å¾®æœåŠ¡æ¶æ„å°†å•åº”ç”¨æ”¾åœ¨å¤šä¸ªç›¸äº’ç‹¬ç«‹çš„æœåŠ¡ï¼Œè¿™ä¸ªæ¯ä¸ªæœåŠ¡èƒ½å¤ŸæŒç»­ç‹¬ç«‹çš„å¼€å‘å’Œéƒ¨ç½²ï¼Œéš¾é¢˜æ˜¯æ•°æ®è¯¥å¦‚ä½•å­˜å‚¨ï¼Ÿ\nå¤šä¸ªåº”ç”¨ä½¿ç”¨åŒä¸€æ•°æ®åº“ # ä¼ ç»Ÿçš„å•ä½“åº”ç”¨ä¸€èˆ¬é‡‡ç”¨çš„æ˜¯æ•°æ®åº“æä¾›çš„äº‹åŠ¡ä¸€è‡´æ€§ï¼Œé€šè¿‡æ•°æ®åº“æä¾›çš„æäº¤ä»¥åŠå›æ»šæœºåˆ¶æ¥ä¿è¯ç›¸å…³æ“ä½œçš„ACIDï¼Œè¿™äº›æ“ä½œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚å„ä¸ªæœåŠ¡çœ‹åˆ°æ•°æ®åº“ä¸­çš„æ•°æ®æ˜¯ä¸€è‡´çš„ï¼ŒåŒæ—¶æ•°æ®åº“çš„æ“ä½œä¹Ÿæ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œæœ€åæ•°æ®ä¹Ÿæ˜¯åœ¨æ•°æ®åº“ä¸­æŒä¹…å­˜å‚¨çš„ã€‚è¿™æ ·çš„æ¶æ„ä¸å…·å¤‡æ¨ªå‘æ‰©å±•èƒ½åŠ›ï¼ŒæœåŠ¡ä¹‹é—´çš„è€¦åˆç¨‹åº¦ä¹Ÿæ¯”è¾ƒé«˜ï¼Œä¼šå­˜åœ¨å•ç‚¹æ•…éšœã€‚\nå…¸å‹å¾®æœåŠ¡æ¶æ„ # åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œ æœ‰ä¸€ä¸ªdatabase per serviceçš„æ¨¡å¼ï¼Œ è¿™ä¸ªæ¨¡å¼å°±æ˜¯æ¯ä¸€ä¸ªæœåŠ¡ä¸€ä¸ªæ•°æ®åº“ã€‚ è¿™æ ·å¯ä»¥ä¿è¯å¾®æœåŠ¡ç‹¬ç«‹å¼€å‘ï¼Œç‹¬ç«‹æ¼”è¿›ï¼Œç‹¬ç«‹éƒ¨ç½²ï¼Œ ç‹¬ç«‹å›¢é˜Ÿã€‚\nç”±äºä¸€ä¸ªåº”ç”¨æ˜¯ç”±ä¸€ç»„ç›¸äº’åä½œçš„å¾®æœåŠ¡æ‰€ç»„æˆï¼Œåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ç”±äºå„ä¸ªæœåŠ¡è®¿é—®çš„æ•°æ®æ˜¯ç›¸äº’åˆ†ç¦»çš„ï¼Œ æœåŠ¡ä¹‹é—´ä¸èƒ½é æ•°æ®åº“æ¥ä¿è¯äº‹åŠ¡ä¸€è‡´æ€§ã€‚ è¿™å°±éœ€è¦åœ¨åº”ç”¨å±‚é¢æä¾›ä¸€ä¸ªåè°ƒæœºåˆ¶ï¼Œæ¥ä¿è¯ä¸€ç»„äº‹åŠ¡æ‰§è¡Œè¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚\nCAPå®šå¾‹ # ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰å’Œåˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰è¿™ä¸‰é¡¹ä¸­çš„ä¸¤é¡¹ã€‚\né€šè¿‡CAPç†è®ºï¼Œæˆ‘ä»¬çŸ¥é“æ— æ³•åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ã€å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªç‰¹æ€§ï¼Œé‚£è¦èˆå¼ƒå“ªä¸ªå‘¢ï¼Ÿ\nCA without Pï¼šå¦‚æœä¸è¦æ±‚Pï¼ˆä¸å…è®¸åˆ†åŒºï¼‰ï¼Œåˆ™Cï¼ˆå¼ºä¸€è‡´æ€§ï¼‰å’ŒAï¼ˆå¯ç”¨æ€§ï¼‰æ˜¯å¯ä»¥ä¿è¯çš„ã€‚ä½†å…¶å®åˆ†åŒºä¸æ˜¯ä½ æƒ³ä¸æƒ³çš„é—®é¢˜ï¼Œè€Œæ˜¯å§‹ç»ˆä¼šå­˜åœ¨ï¼Œå› æ­¤CAçš„ç³»ç»Ÿæ›´å¤šçš„æ˜¯å…è®¸åˆ†åŒºåå„å­ç³»ç»Ÿä¾ç„¶ä¿æŒCAã€‚\nCP without Aï¼šå¦‚æœä¸è¦æ±‚Aï¼ˆå¯ç”¨ï¼‰ï¼Œç›¸å½“äºæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦åœ¨Serverä¹‹é—´å¼ºä¸€è‡´ï¼Œè€ŒPï¼ˆåˆ†åŒºï¼‰ä¼šå¯¼è‡´åŒæ­¥æ—¶é—´æ— é™å»¶é•¿ï¼Œå¦‚æ­¤CPä¹Ÿæ˜¯å¯ä»¥ä¿è¯çš„ã€‚å¾ˆå¤šä¼ ç»Ÿçš„æ•°æ®åº“åˆ†å¸ƒå¼äº‹åŠ¡éƒ½å±äºè¿™ç§æ¨¡å¼ã€‚\nAP wihtout Cï¼šè¦é«˜å¯ç”¨å¹¶å…è®¸åˆ†åŒºï¼Œåˆ™éœ€æ”¾å¼ƒä¸€è‡´æ€§ã€‚ä¸€æ—¦åˆ†åŒºå‘ç”Ÿï¼ŒèŠ‚ç‚¹ä¹‹é—´å¯èƒ½ä¼šå¤±å»è”ç³»ï¼Œä¸ºäº†é«˜å¯ç”¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªèƒ½ç”¨æœ¬åœ°æ•°æ®æä¾›æœåŠ¡ï¼Œè€Œè¿™æ ·ä¼šå¯¼è‡´å…¨å±€æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚ç°åœ¨ä¼—å¤šçš„NoSQLéƒ½å±äºæ­¤ç±»ã€‚\nå¯¹äºå¤šæ•°å¤§å‹äº’è”ç½‘åº”ç”¨çš„åœºæ™¯ï¼Œä¸»æœºä¼—å¤šã€éƒ¨ç½²åˆ†æ•£ï¼Œè€Œä¸”ç°åœ¨çš„é›†ç¾¤è§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œæ‰€ä»¥èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œæ•…éšœæ˜¯å¸¸æ€ï¼Œè€Œä¸”è¦ä¿è¯æœåŠ¡å¯ç”¨æ€§è¾¾åˆ°Nä¸ª9ï¼Œå³ä¿è¯På’ŒAï¼Œèˆå¼ƒCï¼ˆé€€è€Œæ±‚å…¶æ¬¡ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼‰ã€‚è™½ç„¶æŸäº›åœ°æ–¹ä¼šå½±å“å®¢æˆ·ä½“éªŒï¼Œä½†æ²¡è¾¾åˆ°é€ æˆç”¨æˆ·æµç¨‹çš„ä¸¥é‡ç¨‹åº¦ã€‚\nå¯¹äºæ¶‰åŠåˆ°é’±è´¢è¿™æ ·ä¸èƒ½æœ‰ä¸€ä¸è®©æ­¥çš„åœºæ™¯ï¼ŒCå¿…é¡»ä¿è¯ã€‚ç½‘ç»œå‘ç”Ÿæ•…éšœå®å¯åœæ­¢æœåŠ¡ï¼Œè¿™æ˜¯ä¿è¯CAï¼Œèˆå¼ƒPã€‚è²Œä¼¼è¿™å‡ å¹´å›½å†…é“¶è¡Œä¸šå‘ç”Ÿäº†ä¸ä¸‹10èµ·äº‹æ•…ï¼Œä½†å½±å“é¢ä¸å¤§ï¼ŒæŠ¥åˆ°ä¹Ÿä¸å¤šï¼Œå¹¿å¤§ç¾¤ä¼—çŸ¥é“çš„å°‘ã€‚è¿˜æœ‰ä¸€ç§æ˜¯ä¿è¯CPï¼Œèˆå¼ƒAã€‚ä¾‹å¦‚ç½‘ç»œæ•…éšœäº‹åªè¯»ä¸å†™ã€‚\nå¸¸ç”¨çš„è§£å†³æ–¹æ³• # è¿™é‡Œæ€»ç»“äº†ä¸€äº›åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§çš„è§£å†³æ–¹æ³•ã€‚åˆ†å¸ƒå¼äº‹åŠ¡ä¿è¯å¼ºä¸€è‡´æ€§ï¼Œä½†ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæ”¾å¼ƒäº†ä¸€äº›ç³»ç»Ÿæ€§èƒ½ã€‚å¦ä¸€ç§ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œæ”¾å¼ƒäº†æ—¶æ—¶æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä½†å¤„ç†æ•ˆç‡æœ€å¥½ã€‚\nè¿™é‡Œæœ‰ä¸€äº›ä¾‹å­å¦‚ä½•è§£å†³çš„ã€‚\nBASE # è¿™é‡Œå®éªŒäº†ä¸€ä¸ªåŸºäºBASEåè®®çš„æœ€ç»ˆä¸€è‡´æ€§demoã€‚æ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨åˆ°äº†Kafkaï¼Œéœ€è¦è‡ªå·±åœ¨æœ¬åœ°å¼€KafkaæœåŠ¡ã€‚\nå…¶ä»–èµ„æ–™ # ä¹¦ï¼šå¤§è§„æ¨¡åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼šåŸç†è§£æä¸æ¶æ„å®ç° ä¹¦ï¼šå¾®æœåŠ¡è®¾è®¡ åˆ†å¸ƒå¼äº‹åŠ¡ï¼ŸNo, æœ€ç»ˆä¸€è‡´æ€§ åˆ†å¸ƒå¼äº‹åŠ¡å®è·µ -èŠ±é’±çš„ï¼Œä½œä¸ºç›®å½•ä½¿ç”¨ å¤šç ”ç©¶äº›æ¶æ„ï¼Œå°‘è°ˆäº›æ¡†æ¶ï¼ˆ3ï¼‰\u0026ndash; å¾®æœåŠ¡å’Œäº‹ä»¶é©±åŠ¨ æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆä¸€ï¼‰åˆ†å¸ƒå¼ç³»ç»Ÿäº‹åŠ¡ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆå¤§å¯¹æ¯”ï¼Œè°æœ€å¥½ä½¿ï¼Ÿ Sagaåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆä¸å®è·µ è§£å†³ä¸šåŠ¡ä»£ç é‡Œçš„åˆ†å¸ƒå¼äº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜ åˆ†å¸ƒå¼äº‹åŠ¡å®è·µ å®æˆ˜ åŸºäºKafkaæ¶ˆæ¯é©±åŠ¨æœ€ç»ˆä¸€è‡´äº‹åŠ¡ï¼ˆäºŒï¼‰ "},{"id":41,"href":"/posts/Java/gradle_maven/","title":"Gradleå’ŒMavenä½¿ç”¨æ–¹æ³•æ€»ç»“","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼š 1.æ€»ç»“gradleå’Œmavenæ­£ç¡®ä½¿ç”¨æ–¹æ³• 2.å¼€ç®±å³ç”¨maven\u0026amp;gradleåŒæ—¶æ”¯æŒçš„é¡¹ç›®é…ç½®ã€‚\nGradleå’ŒMavenä½¿ç”¨èµ·æ¥éƒ½æ¯”è¾ƒæ–¹ä¾¿ï¼Œè€ŒGradleä½¿ç”¨æ›´çµæ´»ï¼Œé…ç½®æ›´æ–¹ä¾¿ã€‚è€Œå…¬å¸ç¯å¢ƒä¸€èˆ¬ä½¿ç”¨Mavenã€‚å› æ­¤å°±æœ‰äº†å–èˆï¼Œæ˜¯è¿ç§»åˆ°Gradleï¼Œè¿˜æ˜¯ç»§ç»­ä½¿ç”¨Mavenï¼Ÿå…¶å®ä¸éœ€è¦çº ç»“ï¼Œè°è¯´å¿…é¡»å–èˆçš„ï¼Œä¸¤ä¸ªéƒ½ç”¨èµ·æ¥å°±æ˜¯äº†ï¼ï¼ï¼\nè¯´åœ¨å‰é¢ # Gradleå’ŒMavenéƒ½æ˜¯é¡¹ç›®è‡ªåŠ¨æ„å»ºå·¥å…·ï¼Œç¼–è¯‘æºä»£ç åªæ˜¯æ•´ä¸ªè¿‡ç¨‹çš„ä¸€ä¸ªæ–¹é¢ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œä½ è¦æŠŠä½ çš„è½¯ä»¶å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒä¸­æ¥äº§ç”Ÿå•†ä¸šä»·å€¼ï¼Œæ‰€ä»¥ï¼Œä½ è¦è¿è¡Œæµ‹è¯•ï¼Œæ„å»ºåˆ†å¸ƒã€åˆ†æä»£ç è´¨é‡ã€ç”šè‡³ä¸ºä¸åŒç›®æ ‡ç¯å¢ƒæä¾›ä¸åŒç‰ˆæœ¬ï¼Œç„¶åéƒ¨ç½²ã€‚æ•´ä¸ªè¿‡ç¨‹è¿›è¡Œè‡ªåŠ¨åŒ–æ“ä½œæ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚\næ•´ä¸ªè¿‡ç¨‹å¯ä»¥åˆ†æˆä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\nç¼–è¯‘æºä»£ç  è¿è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯• æ‰§è¡Œé™æ€ä»£ç åˆ†æã€ç”Ÿæˆåˆ†ææŠ¥å‘Š åˆ›å»ºå‘å¸ƒç‰ˆæœ¬ éƒ¨ç½²åˆ°ç›®æ ‡ç¯å¢ƒ éƒ¨ç½²ä¼ é€’è¿‡ç¨‹ æ‰§è¡Œå†’çƒŸæµ‹è¯•å’Œè‡ªåŠ¨åŠŸèƒ½æµ‹è¯• ä¸¤è€…éƒ½æ˜¯é¡¹ç›®å·¥å…·ï¼Œä½†æ˜¯mavenä½¿ç”¨çš„æœ€å¤šï¼ŒGradleæ˜¯åèµ·ä¹‹ç§€ï¼Œæƒ³springç­‰éƒ½æ˜¯ä½¿ç”¨gradleæ„å»ºçš„ã€‚GradleæŠ›å¼ƒäº†Mavençš„åŸºäºXMLçš„ç¹çé…ç½®ï¼Œé‡‡ç”¨äº†é¢†åŸŸç‰¹å®šè¯­è¨€Groovyçš„é…ç½®ï¼Œå¤§å¤§ç®€åŒ–äº†æ„å»ºä»£ç çš„è¡Œæ•°ã€‚\næ¯”å¦‚mavenè¦ è¿™ä¹ˆå†™\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-core\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${spring.version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; gradleè¿™ä¹ˆå†™\ncompile(\u0026#39;org.springframework:spring-core:2.5.6\u0026#39;) è¯¦ç»†çš„Gradleå’ŒMavenæ¯”è¾ƒçœ‹ è¿™é‡Œè®²çš„å¾ˆå¥½äº†ã€‚ gradleå®˜æ–¹ä¹Ÿå¯¹ä¸¤ä¸ªå·¥å…·è¿›è¡Œäº†æ¯”è¾ƒã€‚\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªï¼Œæˆ–è€…ä¸¤ä¸ªä¸€èµ·ä½¿ç”¨ï¼ï¼ï¼è¿™æ˜¯å¯è¡Œçš„ï¼Œå½“ç„¶å‰ææ˜¯ï¼Œæœ‰ä¸€ä¸ªäººåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ç»´æŠ¤ç›¸åŒåŠŸèƒ½çš„ä¸¤ä»½é…ç½®ã€‚å®é™…ä¸Šå¹¶ä¸éš¾ã€‚æŠ½ä¸€ä¸ªå‘¨æœ«ç©ºä½™æ—¶é—´ï¼Œè‡ªå·±æŠŠè¿™ä¸¤ä¸ªéƒ½ç†Ÿæ‚‰äº†ä¸€ä¸‹ï¼Œæ•´ç†äº†ä¸€å¥—Gradle\u0026amp;Mavenæ—¥å¸¸å¼€å‘ä¸­å¸¸ç”¨çš„åŒ…å’Œæ’ä»¶çš„é›†åˆï¼Œä½œä¸ºé¡¹ç›®çš„å¼€å§‹ã€‚æ¯”è¾ƒé€šç”¨ï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®å…¬å¸æˆ–ä¸ªäººé¡¹ç›®å®é™…æƒ…å†µåŠ å…¥ç§æœçš„é…ç½®ï¼Œä»¥åŠä½ æƒ³ä½¿ç”¨çš„jaråŒ…ï¼Œå¦‚æ­¤ç®€å•ã€‚å¦‚æœä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Œè¯·è”ç³»æˆ‘ã€‚åˆ«å¿˜äº†ï¼Œå¸®æˆ‘starä¸€ä¸‹ã€‚\næ¥ä¸‹æ¥æ¶‰åŠåˆ°çš„å†…å®¹ï¼š\nmaven æ­£ç¡®ä½¿ç”¨æ–¹æ³• gradleæ­£ç¡®ä½¿ç”¨æ–¹æ³• gradleé¡¹ç›®å’Œmavené¡¹ç›®ç›¸äº’è½¬åŒ– ä¸€ä¸ªé¡¹ç›®åŒæ—¶æ”¯æŒmavenå’Œgradleé…ç½®ï¼šä¸€ä¸ªå¥½çš„å¼€å§‹ maven æ­£ç¡®ä½¿ç”¨æ–¹æ³• # mavenç‰ˆæœ¬ä¸ç›¸åŒé—®é¢˜ # æˆ‘ä»¬å¤§éƒ¨åˆ†æ—¶å€™ä½¿ç”¨IDEè¿›è¡Œé¡¹ç›®å¼€å‘çš„æ—¶å€™ï¼Œå¤§éƒ¨åˆ†æ—¶å€™ä¼šç›´æ¥ä½¿ç”¨IDEåˆ›å»ºMAVENé¡¹ç›®ï¼Œè¿™æ˜¯æ­£ç¡®çš„ã€‚å¯æ˜¯ï¼Œæ‚¨æœ‰æ²¡æœ‰å‘ç°ï¼Œå¤§å®¶åˆä½œçš„æ—¶å€™ï¼Œç”±äºmavenç‰ˆæœ¬ä¸ç›¸åŒï¼Œå“ªæ€•æ˜¯3.5.1å’Œ3.5.2çš„åŒºåˆ«ï¼Œéƒ½ä¼šå¼•å‘ä¸€åœºè¡€æ¡ˆï¼æˆ‘çš„å¯ä»¥æ­£å¸¸æ‰“å¼€é¡¹ç›®ï¼Œè€Œå…¶ä»–äººå´ä¼šå‡ºç°é—®é¢˜ã€‚é™¤äº†IDEä¸‹è½½åŒ…æŸåå¤–ï¼Œå°±æ˜¯mavençš„ç‰ˆæœ¬ä¸ç›¸åŒã€‚å…¶å®é€šè¿‡ä¸€äº›å·¥å…·ï¼Œå·²ç»å¯ä»¥è®©è¿™ç§æƒ…å†µä¸åœ¨å‘ç”Ÿï¼Œé‚£å°±æ˜¯ Wrapperã€‚è¯·çœ‹å¦‚ä¸‹å›¾(å›¾æ²¡é…é”™ï¼Œmavençš„wrapperå’Œgradleçš„wrapperæµç¨‹ä¸Šå®Œå…¨ç›¸åŒ)\nå‰ææ¡ä»¶ï¼š\né¡¹ç›®åˆ›å»ºè€…ç³»ç»Ÿä¸­å·²ç»ç”±mavençš„å‘½ä»¤ å…¶ä»–äººæ²¡æœ‰è¦æ±‚ï¼Œmvnå¯æœ‰å¯æ— ï¼ˆåŸå› ä¹‹åè¯´ï¼‰ å…·ä½“å¦‚ä½•åšï¼š\né¡¹ç›®åˆ›å»ºè€…æ‰§è¡Œ mvn -N io.takari:maven:wrapper -Dmaven=3.5.3 æ­¤æ—¶ï¼Œé¡¹ç›®ç›®å½•ä¼šç”Ÿæˆmvnw.cmdå’Œmvnwï¼Œä¹‹åçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸºäºæ­¤ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé¡¹ç›®å¼€å‘è€…ä¸éœ€è¦ç”±ä»»ä½•ä¾èµ–ï¼Œé™¤äº†jdk-_!!! é¡¹ç›®åˆ›å»ºè€…æ‰§è¡Œ mvnw archetype:generate æ­¤æ­¥æ˜¯è‡ªåŠ¨ç”Ÿæˆé¡¹ç›®ç›®å½•ç»“æ„ã€‚åŒæ—¶ï¼Œé¡¹ç›®ç®¡ç†è€…éœ€è¦æ­å»ºå¥½åŸºç¡€çš„ä»£ç æ¡†æ¶ã€‚ä¹‹åå¯ä»¥å¼€å‘äº† é¡¹ç›®å¼€å‘è€… mvnw.cmd compiler:compile mvnw.cmd exec:java -Dexec.mainClass=\u0026quot;org.exfly.LombokL.LombokLApplication\u0026quot; -q mvn.cmd clean mvn.cmd test ã€‚ã€‚ã€‚ æ³¨æ„:\nå½“ç¬¬ä¸€æ¬¡æ‰§è¡Œmvnw.cmdæ—¶å€™ï¼Œä¼šè‡ªåŠ¨ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„Mavenï¼Œmavençš„$HOME/.m2/wrapper/dists/\u0026lt;version\u0026gt;/ä¸‹ã€‚ åˆç½‘ç»œé—®é¢˜ï¼Œå¦‚æœå‡ºç°é”™è¯¯ï¼Œä¾èµ–åŒ…å·²ç»ä¸‹å¥½ï¼Œåªéœ€è¦åˆ°1æ‰€è¯´çš„ä½ç½®å»æ‰åç¼€.packï¼Œé‡æ–°è¿è¡Œå³å¯ã€‚ ä½¿ç”¨ dependencyManagementé›†ä¸­ç®¡ç†ç‰ˆæœ¬ä¾èµ– # dependencyManagementè¿™é‡Œå·²ç»å¾ˆå¥½çš„è§£é‡Šå¦‚ä½•åšã€‚åŒæ—¶å¯ä»¥å€Ÿé‰´springboot-parent å¤šæ¨¡å—é¡¹ç›®ç®¡ç†æ–¹æ³• # å¤šæ¨¡å—é¡¹ç›®çš„POMé‡æ„ é€šè¿‡parentçš„æ–¹å¼ï¼Œå°†å¤šæ¨¡å—ä¾èµ–é›†ä¸­ç®¡ç†ï¼Œ å¦‚ä½•æ›´å¥½çš„ä½¿ç”¨mavenè¿›è¡Œé¡¹ç›®ç®¡ç† å‡ ç‚¹å»ºè®® # å°½é‡ä½¿ç”¨wapperå¤š ä½¿ç”¨ dependencyManagementé›†ä¸­ç®¡ç†ç‰ˆæœ¬ä¾èµ– binä¸‹æœ‰mvnå’ŒmvnDebug(è¿è¡Œmvnæ—¶å¼€å§‹debug) M2_HOME mavenä¸»ç¨‹åºçš„å®‰è£…ç›®å½• ~/.m2 æœ¬åœ°åŒ…ä¸‹è½½ä½ç½® httpä»£ç† setting.xmlä¸­çš„proxies MAVEN_OPTS è¿è¡Œmvnæ—¶å€™ç›¸å½“äºè¿è¡Œjavaå‘½ä»¤ï¼ŒMAVEN_OPTSå¯ä»¥é…ç½®ä¸ºä»»ä½•javaçš„å‘½ä»¤å‚æ•° è®¾ç½®MAVEN_OPTSç¯å¢ƒå˜é‡ é…ç½®ç”¨æˆ·èŒƒå›´settings.xml %M2_HOME%/conf/settings.xml ä¸ºå…¨å±€é…ç½®æ–‡ä»¶ ~/.m2/settings.xml ä¸ºç”¨æˆ·é…ç½®æ–‡ä»¶ ä¸è¦ä½¿ç”¨IDEå†…åµŒçš„Mavenï¼Œåº”è¯¥é…ç½®IDEä¸­ä¸ºè‡ªå·±å®‰è£…çš„maven æ˜¾ç¤ºå£°æ˜æ‰€æœ‰ç”¨åˆ°çš„ä¾èµ– æˆ‘çš„mavenå¸¸ç”¨å‘½ä»¤ç¬”è®° # æˆ‘çš„mavenå¸¸ç”¨å‘½ä»¤ç¬”è®°\ngradleæ­£ç¡®ä½¿ç”¨æ–¹æ³• # ç†ç”±åŒä¸ŠèŠ‚ï¼Œç›´æ¥è¯´ä½¿ç”¨æ–¹æ³•ã€‚å¯ä»¥å¯¹ç…§ æˆ‘çš„ç¬”è®°æŸ¥çœ‹ã€‚\ngradle init \u0026ndash;type java-library è¿™é‡Œè‡ªåŠ¨ç”Ÿæˆgradlewï¼Œå¹¶åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„ ä¹‹åæ‰€æœ‰å‘½ä»¤ä½¿ç”¨gradlewå³å¯ gradleé¡¹ç›®å’Œmavené¡¹ç›®ç›¸äº’è½¬åŒ– # gradleå’Œmavenå¯ä»¥ç›¸äº’è½¬åŒ–ï¼Œæ„å‘³ç€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨gradleä¸ºä¸»çš„å¼€å‘ï¼Œä¹‹åå¯¼å‡ºä¸ºmavené¡¹ç›®ï¼Œä¾›ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚å‰æï¼Œä½ è¶³å¤Ÿäº†è§£gradleå’Œmavenã€‚\nmaven -\u0026gt; gradle # cd /path/to/mavenproject gradle init gradle wrapper gradle -\u0026gt; maven # cd /path/to/gradleproject gradlew install å°†é¡¹ç›®è½¬æ¢ä¸ºmavenå’Œgradleé¡¹ç›®åï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š ä¹‹åï¼Œæˆ‘ä»¬ä¹ æƒ¯ä½¿ç”¨mavnwæˆ–è€…gradlewï¼Œéƒ½å¯ä»¥ã€‚å¦‚æ­¤ï¼Œåšåˆ°äº†å…±å­˜ã€‚\nä¸€ä¸ªé¡¹ç›®åŒæ—¶æ”¯æŒmavenå’Œgradleé…ç½®ï¼šä¸€ä¸ªå¥½çš„å¼€å§‹ # æŠ½æ—¶é—´ï¼Œåšäº†å¸¸ç”¨jaråŒ…å’Œæ’ä»¶æ•´åˆåŒ…ï¼Œä¸€ä¸ªé¡¹ç›®åŒæ—¶æ”¯æŒmavenå’Œgradleã€‚\nå…±åŒçš„ä¾èµ–ï¼š\nå†…å®¹åŒ…æ‹¬ï¼š æ—¥å¿—ã€é€šç”¨å·¥å…·åº“ã€å•å…ƒæµ‹è¯•ã€ä»£ç è´¨é‡åº¦é‡ã€æ–‡æ¡£ç”Ÿæˆç­‰ jar: slf4jã€logbackã€lombokã€guavaã€junitã€mockito é…ç½®ä¸­æ•´åˆçš„å·¥å…·ï¼š\nä»£ç è´¨é‡åˆ†ææŠ¥å‘Šå·¥å…·ï¼špmdã€findbugsã€checkstyleã€jdepend å•å…ƒæµ‹è¯•æŠ¥å‘Šå·¥å…·ã€javadocã€ä¾èµ–ç®¡ç†ã€é¡¹ç›®ä¿¡æ¯æ±‡æ€»ç­‰å¯è§†åŒ–ä¿¡æ¯ mavenå…·ä½“å†…å®¹\nmaven-compiler-pluginã€maven-javadoc-pluginã€cobertura-maven-pluginã€maven-checkstyle-pluginã€findbugs-maven-pluginã€maven-pmd-pluginã€jdepend-maven-pluginã€maven-jar-pluginã€maven-surefire-pluginã€maven-surefire-report-plugin gradleå…·ä½“å†…å®¹\njavaã€mavenã€checkstyleã€pmdã€findbugsã€jdependã€eclipseã€ideaã€javadoc é¦–å…ˆmavené…ç½®è§ æ­¤æ–‡ä»¶\nå…¶æ¬¡gradleé…ç½®è§ æ­¤æ–‡ä»¶\nèµ„æ–™æ±‡æ€» # å®Œæ•´çš„æ•´åˆé¡¹ç›®ï¼Œæ”¯æŒmavenå’Œgradleï¼Œç‚¹æˆ‘ä¸‹è½½ æˆ‘çš„Gradleç¬”è®°ï¼Œç‚¹æˆ‘æŸ¥çœ‹ æˆ‘çš„mavenç¬”è®°ï¼Œç‚¹æˆ‘æŸ¥çœ‹ "},{"id":42,"href":"/posts/Lua/openresty_awesome/","title":"OpenRestyæœ€ä½³å®è·µ","section":"Blog","content":"å¦‚æœä½ æ­£åœ¨å­¦Luaä¸openrestyï¼Œé‚£ä½ å°±ä¸€å®šçŸ¥é“åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè°ƒè¯•ä»£ç ã€å•å…ƒæµ‹è¯•æ˜¯å¤šä¹ˆçš„éº»çƒ¦ã€‚è¿™é‡Œæ•´ç†äº†ä¸€äº›luaå¼€å‘çš„æœ€ä½³å®è·µã€‚\nç®€ä»‹ # openrestyä¸­lua ideè°ƒè¯•ï¼Œå•å…ƒæµ‹è¯•æ¯”è¾ƒéº»çƒ¦ï¼›luaå¯¹åº“çš„ç®¡ç†æ¯”è¾ƒæ•£æ¼«ã€‚åœ¨å…¬å¸ç”Ÿäº§ç¯å¢ƒï¼Œä¸€èˆ¬æ²¡æœ‰å¤–ç½‘ç¯å¢ƒï¼ŒOpenRestyçš„å®‰è£…å’Œluaé¡¹ç›®çš„éƒ¨ç½²éƒ½æ¯”è¾ƒéº»çƒ¦ã€‚ ç»“åˆPythonçš„ä¸€äº›ç»éªŒï¼Œåœ¨è¿™é‡Œæ•´ç†ä¸€ä¸‹è‡ªå·±å¯¹Luaçš„ç†è§£ï¼Œä»¥åŠLuaæœ€ä½³å®è·µã€‚\nOpenRestyå®‰è£… # å¯¹äºè½¯ä»¶ï¼Œä½¿ç”¨ç¼–è¯‘æ–¹å¼å®‰è£…æ¯”è¾ƒå¥½ï¼Œæ¯”å¦‚Ubuntuï¼Œapt-getå®‰è£…çš„åŒ…ä¸€èˆ¬éƒ½ä¼šæ¯”è¾ƒæ—§ã€‚å¦‚ä¸‹ä»‹ç»æˆ‘çš„ç¼–è¯‘å‚æ•°ã€‚è¿™é‡Œéœ€è¦è‡ªå·±ä¸‹è½½è‡ªå·±çš„ä¾èµ–åŒ…ï¼šnaxsi, nginx-goodies-nginx-sticky-module-ngï¼Œpcreï¼Œopensslï¼Œzlibï¼Œå¹¶æ ¹æ®æˆ‘çš„é…ç½®è¿›è¡Œä¿®æ”¹ç›¸åº”å‚æ•°\n./configure --prefix=$HOME/openresty \\ --add-module=$HOME/openresty/setupfile/third/naxsi-0.55.3/naxsi_src \\ --add-module=$HOME/openresty/setupfile/third/nginx-goodies-nginx-sticky-module-ng \\ --with-pcre=$HOME/openresty/setupfile/depency/pcre-8.41 \\ --with-openssl=$HOME/openresty/setupfile/depency/openssl-1.0.2k \\ --with-zlib=$HOME/openresty/setupfile/depency/zlib-1.2.11 \\ --with-http_v2_module \\ --with-http_sub_module \\ --with-http_stub_status_module \\ --with-http_realip_module \\ --with-cc-opt=-O2 \\ --with-luajit è¿™é‡Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ nginxçš„ç¬”è®°ï¼Œå¯ä»¥è¿‡ä¸€é æˆ‘åœ¨å­¦ä¹ çš„æ—¶å€™ï¼Œçœ‹äº†è¿™æœ¬ä¹¦ æ·±å…¥ç†è§£Nginxæ¨¡å—å¼€å‘ä¸æ¶æ„è§£æ,æ¯•ç«Ÿè®²çš„æ¯”è¾ƒç³»ç»Ÿï¼Œå¯ä»¥å€Ÿé‰´ä¸€ä¸‹ æœ‰é—®é¢˜ï¼ŒçŸ¥ä¹ï¼Œæœç´¢å¼•æ“ å®‰è£…luarocks # ä¸‹è½½åœ°å€ http://luarocks.github.io/luarocks/releases/ ç¼–è¯‘å®‰è£… ./configure --prefix=$HOME/openresty/luajit \\ --with-lua=$HOME/openresty/luajit \\ --lua-suffix=jit \\ --with-lua-include=$HOME/openresty/luajit/include/luajit-2.1 --prefix è®¾å®š luarocks çš„å®‰è£…ç›®å½• --with-lua åˆ™æ˜¯ç³»ç»Ÿä¸­å®‰è£…çš„ lua çš„æ ¹ç›®å½• --lua-suffix ç‰ˆæœ¬åç¼€ï¼Œæ­¤å¤„å› ä¸ºopenresytçš„luaè§£é‡Šå™¨ä½¿ç”¨çš„æ˜¯ luajit ,æ‰€ä»¥æ­¤å¤„å¾—å†™ jit --with-lua-include è®¾ç½® lua å¼•å…¥ä¸€äº›å¤´æ–‡ä»¶å¤´æ–‡ä»¶çš„ç›®å½• make build \u0026amp;\u0026amp; make install luaé¢å‘å¯¹è±¡ # lua å€ŸåŠ©tableä»¥åŠmetatableçš„æ¦‚å¿µè¿›è¡Œooçš„ã€‚è¿™é‡Œæ‘˜äº†ä¸€ä¸ªåšå®¢çš„ä»£ç ï¼Œçœ‹èµ·æ¥è¿˜å¯ä»¥ã€‚ä»¥åå¯ä»¥ä½¿ç”¨è¿™ä¸ªã€‚ Lua ä¸­å®ç°é¢å‘å¯¹è±¡ã€‚ è¿™é‡Œè¦è¯´ä¸€ä¸‹luaä¸­ .è¿ç®—å’Œ:çš„åŒºåˆ«ï¼Œa={};a.fun(a, arg) ç­‰ä»·äº a:fun(arg)ï¼Œå…¶å®å°±æ˜¯:å¯ä»¥çœç•¥selfå‚æ•°ã€‚\nlocal _class={} function class(super) local class_type={} class_type.ctor=false class_type.super=super class_type.new=function(...) local obj={} do local create create = function(c,...) if c.super then create(c.super,...) end if c.ctor then c.ctor(obj,...) end end create(class_type,...) end setmetatable(obj,{ __index=_class[class_type] }) return obj end local vtbl={} _class[class_type]=vtbl setmetatable(class_type,{__newindex= function(t,k,v) vtbl[k]=v end }) if super then setmetatable(vtbl,{__index= function(t,k) local ret=_class[super][k] vtbl[k]=ret return ret end }) end return class_type end åŸºæœ¬ç¼–ç è§„èŒƒ è®¾è®¡ # å¯ä»¥å‚è€ƒOpenRestyçš„æœ€ä½³å®è·µï¼Œå¹³æ—¶ç”¨èµ·æ¥ï¼Œå¤§éƒ¨åˆ†è·Ÿcçš„é£æ ¼å·®ä¸å¤šå§ã€‚ä¸»è¦æ˜¯æ‰€ä½¿ç”¨çš„ä»£ç é£æ ¼è¦ç»Ÿä¸€ã€‚\nåŒ…ç®¡ç† # luaä¸‹æœ‰ä¸¤ä¸ªåŒ…ç®¡ç†ç³»ç»Ÿï¼ŒLuaDistå’ŒLuaRocks\nå•å…ƒæµ‹è¯• # é‡ç‚¹ å¦‚ä¸‹æ–¹æ³•è¯·åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ç±»ä¼¼curl localhost/unittestè¿›è¡Œæµ‹è¯•ï¼Œæµè§ˆå™¨ä¸­çœ‹ä¼šå¾ˆç—›è‹¦ OpenRestyæœ€ä½³å®è·µ-å•å…ƒæµ‹è¯•ç»™å‡ºä¸€ç§æ–¹æ³•ã€‚æˆ‘çš„å¤„ç†æ–¹æ³•æ˜¯ï¼Œåœ¨nginx.confä¸­çš„serverä¸­å»ºä¸€ä¸ªå•ç‹¬çš„locationï¼Œcontent_by_lua_file è®¾ç½®unittest.luaã€‚å…¬å¸ç”¨çš„verynginxï¼Œæ‰€ä»¥æˆ‘æŠŠæ­¤é…ç½®æ”¾åˆ°äº†router.luaä¸­(å½“ç„¶é…ç½®æ–¹æ³•ç±»ä¼¼ï¼Œè¿™ä¸ªå¾ˆå®¹æ˜“ç ”ç©¶ï¼Œå°±ä¸æ”¾åˆ°è¿™é‡Œäº†)ã€‚ -- file: unittest.lua local _M = {} local csrf_test = require(\u0026#34;test.test_csrf\u0026#34;) local tmp_test = require(\u0026#34;test.tmp_test\u0026#34;) function _M:run_unittest() csrf_test:run() end return _M -- file: test_csrf.lua local iresty_test = require(\u0026#34;resty.iresty_test\u0026#34;) local json = require(\u0026#34;json\u0026#34;) local config = require(\u0026#34;config\u0026#34;) local csrf_config = require(\u0026#34;csrf_config\u0026#34;) local token = require(\u0026#34;token\u0026#34;) local tabletls = require(\u0026#34;tabletls\u0026#34;) local tb = iresty_test.new({unit_name=\u0026#34;test_csrf\u0026#34;}) local function assert_eq(wanted, real, msg) if wanted ~= real then error(msg or \u0026#34;error\u0026#34;, 2) -- è¯·æ³¨æ„å‚æ•° 2 end end local function assert_not_eq(wanted, real, msg) if wanted == real then error(msg or \u0026#34;error\u0026#34;, 2) end end function tb:test_geturl() assert_eq(\u0026#34;/unittest\u0026#34;, ngx.var.uri, \u0026#34;the unittest url changed\u0026#34;) end function tb:run_unittest() tb:run() end return tb å¦‚ä¸Šæœ‰ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„åœ°æ–¹ï¼Œerror(msg or \u0026quot;error\u0026quot;, 2),å…¶ä¸­çš„2æœ‰äº›è®²ç©¶ï¼Œè¡¨ç¤ºè¿”å›è°ƒç”¨å‡½æ•°æ‰€åœ¨è¡Œï¼Œè¿˜æœ‰0ï¼ˆå¿½ç•¥è¡Œå·ï¼‰ï¼Œ1ï¼ˆerrorè°ƒç”¨ä½ç½®è¡Œå·ï¼‰ æ€§èƒ½æµ‹è¯• ä»£ç è¦†ç›–ç‡ APIæµ‹è¯•ç­‰ï¼Œéƒ½å¯ä»¥å» OpenRestyæœ€ä½³å®è·µä¸­æ‰¾ï¼Œé…ç½®å¾ˆç®€å•ã€‚ è¿œç¨‹è°ƒè¯• OpenResty # å¯¹äºæ­¤éƒ¨åˆ†ï¼Œå¯¹äºæœ‰äº›äººæ¥è¯´ï¼Œä½¿ç”¨æ—¥å¿—å°±å·²ç»è¶³å¤Ÿäº†ã€‚å¯å¯¹äºæœ‰äº›æ—¶å€™ï¼Œåœ¨ä»£ç ä¸­å¤ªå¤šçš„æ—¥å¿—æœ‰ä¸åˆ©äºç»´æŠ¤ã€‚è¿™é‡Œè‡ªå·±è¦å°½åŠ›åšå¥½æ—¥å¿—å’Œè°ƒè¯•çš„å¹³è¡¡å§ã€‚ æ­¤è°ƒè¯•æ–¹æ³•é€‚ç”¨äº win linux osx å…ˆè´´è¿™é‡Œç”¨åˆ°çš„luaIDEåœ°å€ï¼š ZeroBraneStudio å¦‚ä¸‹ä¸ºå®‰è£…æ­¥éª¤ï¼š ä¸‹è½½è¿™ä¸ªé¡¹ç›®ï¼Œ ZeroBraneStudioï¼Œè§£å‹å¯ä»¥ç›´æ¥ç”¨ã€è°ƒè¯•æ–¹æ³•åœ¨ä¸‹è½½å¥½çš„æ–‡ä»¶ä¸­README.mdä¸­æœ‰ç›¸åº”çš„é“¾æ¥ã€‘ å¯åŠ¨ZBSï¼ŒProject -\u0026gt; Start Debugger Server å¤åˆ¶/lualibs/mobdebug/mobdebug.lua -\u0026gt; nginx lua path, å¤åˆ¶/lualibs/socket.lua -\u0026gt; nginx lua pathï¼Œ å¤åˆ¶/bin/clibs/socket/core -\u0026gt; socketè®¾ä¸ºnginx lua cpathï¼ˆè°ƒè¯•æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯require(\u0026ldquo;socket.core\u0026rdquo;)å½¢å¼å¯¼å…¥åŒ…ã€‚è¿™é‡Œéœ€è¦æ³¨æ„coreæ–‡ä»¶åç¼€ï¼Œwinæ˜¯dllï¼Œlinuxæ˜¯soï¼Œï¼‰ nginxé…ç½®å¥½,å°†å¦‚ä¸Šä¾èµ–åŠ åˆ°nginx.confä¸­ï¼Œè®©luaå¯ä»¥æ‰¾åˆ°è¿™äº›æ–‡ä»¶å³å¯ åˆ›å»ºéœ€è¦è°ƒè¯•çš„luaæ–‡ä»¶ require(\u0026#39;mobdebug\u0026#39;).start(\u0026#39;192.168.1.22\u0026#39;) local name = ngx.var.arg_name or \u0026#34;Anonymous\u0026#34; ngx.say(\u0026#34;Hello, \u0026#34;, name, \u0026#34;!\u0026#34;) ngx.say(\u0026#34;Done debugging.\u0026#34;) require(\u0026#39;mobdebug\u0026#39;).done() æ³¨ï¼šstart()å‘¼å«éœ€è¦è¿è¡ŒIDEçš„è®¡ç®—æœºçš„IP ã€‚é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨â€œlocalhostâ€ï¼Œä½†æ˜¯ç”±äºæ‚¨çš„nginxå®ä¾‹æ­£åœ¨è¿è¡Œï¼Œå› æ­¤æ‚¨éœ€è¦æŒ‡å®šè¿è¡ŒIDEçš„è®¡ç®—æœºçš„IPåœ°å€ï¼ˆåœ¨æˆ‘çš„ä¾‹å­ä¸­192.168.1.22ï¼‰\nåœ¨ideä¸­æ‰“å¼€éœ€è¦è°ƒè¯•çš„å¦‚ä¸Šluaæ–‡ä»¶ Project -\u0026gt; Project Directory -\u0026gt; Set From Current Fileã€‚ æ­¤æ—¶ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®éœ€è¦æ­¤æ–‡ä»¶å¤„ç†çš„é“¾æ¥ æ­¤æ—¶å¼€å§‹è°ƒè¯• æ³¨ï¼šåœ¨æœ€ä¸‹ä¾§æœ‰Remote consoleï¼Œåœ¨è¿™é‡Œå¯ä»¥æ‰§è¡Œä»»ä½•ngx luaè¯­å¥ å¦‚ä¸Šæµç¨‹æ²¡æœ‰æˆªå›¾ï¼Œæˆ–è€…æ²¡æœ‰è¯´æ¸…æ¥šï¼Œå¯ä»¥æ¥ è¿™é‡Œ nginxä¸€äº›æŠ€å·§ # çœ‹æˆ‘é…ç½®çš„nginx.conf lua_package_path \u0026#39;$prefix/lua_script/?.lua;;\u0026#39;; æˆ‘çš„ç¬”è®° èµ„æ–™ # ç« äº¦æ˜¥ OpenResty OpenRestyæœ€ä½³å®è·µ Lua 5.1 å‚è€ƒæ‰‹å†Œ Lua 5.3 å‚è€ƒæ‰‹å†Œ äº‘é£ github awesome-lua awesome-resty Nginx-Lua-OpenResty-ResourcesA collection of resources covering Nginx, Nginx + Lua, OpenResty and Tengine "},{"id":43,"href":"/posts/Java/spring/beans/","title":"Spring Beansçš„è£…é…è§„åˆ™æ€»ç»“","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šspringä¸­beançš„è£…é…æœ‰ä¸€å®šè§„åˆ™ï¼Œåœ¨è¿™é‡Œè¿›è¡Œæ€»ç»“ã€‚æœ¬æ–‡ä¸»è¦è®²è§£ä¸€äº›æ¦‚å¿µå’Œjavaé…ç½®æ–¹æ³•ã€‚demoä»£ç è§æ–‡æœ«ã€‚\nç›®å½• # æ‰‹åŠ¨è£…é… ä½¿ç”¨@Bean è‡ªåŠ¨è£…é… ä½¿ç”¨@ComponentScan è‡ªåŠ¨è£…é…çš„æ­§ä¹‰æ€§ æ¡ä»¶ç”Ÿæ•ˆ Bean profile beanä½œç”¨åŸŸ æ‰‹åŠ¨è£…é… # æ‰‹åŠ¨è£…é…å¯ä»¥é€šè¿‡å£°æ˜xmlæ–‡ä»¶å’Œjavaé…ç½®æ–‡ä»¶ä¸¤ç§æ‰‹æ®µã€‚åœ¨è¿™ä¸¤ç§æ–¹å¼ä¸­ï¼Œæ›´åŠ æ¨èä½¿ç”¨javaé…ç½®çš„æ–¹å¼ã€‚ä¸¤ç§é…ç½®ä¸æ˜¯ç›¸äº’æ›¿ä»£çš„å…³ç³»ï¼Œä¸€èˆ¬å°†ä¸šåŠ¡ç›¸å…³çš„é…ç½®æ”¾åˆ°javaé…ç½®ä¸­ï¼Œå¯¹äºéä¸šåŠ¡ï¼Œå¦‚æ•°æ®åº“ç­‰ï¼Œå¯ä»¥æ”¾åˆ°xmlä¸­ã€‚ é€šè¿‡ä½¿ç”¨@Beanæ³¨è§£æ–¹æ³•ï¼Œå¯ä»¥å£°æ˜å¹¶æ³¨å†Œä¸€ä¸ªä»¥æ–¹æ³•åä¸ºnameçš„beanã€‚@Bean(name= {\u0026ldquo;sayAndPlayServiceNewName\u0026rdquo;, \u0026ldquo;sayAndPlayService\u0026rdquo;})\npublic interface SayAndPlayService { String say(); String play(); } public class PeopleSayAndPlayServiceImpl implements SayAndPlayService { @Override public String say() { return \u0026#34;People Service implements say.\u0026#34;; } @Override public String play() { return \u0026#34;People Service implements play.\u0026#34;; } } @Configuration public class SimpleManualwireConfig { @Bean public SayAndPlayService sayAndPlayService() { return new PeopleSayAndPlayServiceImpl(); } } @RunWith(SpringRunner.class) @ContextConfiguration(classes= {org.exfly.demo.config.SimpleManualwireConfig.class}) public class SimpleBeanManualwireTest { @Autowired private SayAndPlayService service; @Test public void testTestOneAutowiredService() { Assert.assertEquals(\u0026#34;People Service implements say.\u0026#34;, service.say()); } @Test public void testAnnotationConfigAppContext() { ApplicationContext context = new AnnotationConfigApplicationContext(org.exfly.demo.config.SimpleManualwireConfig.class); SayAndPlayService service = (SayAndPlayService) context.getBean(\u0026#34;sayAndPlayService\u0026#34;); Assert.assertEquals(\u0026#34;People Service implements say.\u0026#34;, service.say()); } } è‡ªåŠ¨è£…é… # ä½¿ç”¨@ComponentScanå¯ä»¥è‡ªåŠ¨æ‰«æï¼Œ@ComponentScanå‘Šè¯‰Spring å“ªä¸ªpackages çš„ç”¨æ³¨è§£æ ‡è¯†çš„ç±» ä¼šè¢«springè‡ªåŠ¨æ‰«æå¹¶ä¸”è£…å…¥beanå®¹å™¨ã€‚è‡ªåŠ¨æ‰«æï¼Œä¼šæ‰«æç›¸åº”åŒ…ä»¥åŠå­åŒ…ï¼Œå¹¶ä¸ºæ‰€æœ‰beanç”Ÿæˆnameï¼Œnameå‘½åè§„åˆ™ä¸ºå…¶ç±»é¦–å­—æ¯å˜å°å†™ï¼Œå¦‚interface UserServiceè¢«å”¯ä¸€çš„UserServiceImplå®ç°ï¼Œåˆ™ç»è¿‡æ‰«æï¼Œbeanè¢«å£°æ˜ä¸ºnameä¸ºuserServiceImplã€‚å¦‚æœæ¥å£è¢«å¤šå„ç±»å®ç°ï¼Œéœ€è¦è½¬åˆ°ä¸‹æ–‡æ¶ˆé™¤æ­§ä¹‰éƒ¨åˆ†è¿›è¡Œäº†è§£ã€‚\npublic interface SpeakService { String speak(); } @Service public class PeopleSpeakServiceImpl implements SpeakService { @Override public String speak() { return \u0026#34;People speak\u0026#34;; } } @Configuration @ComponentScan(basePackageClasses={org.exfly.demo.service.SpeakService.class}) public class SimpleConfigScanConfig {} @RunWith(SpringRunner.class) @ContextConfiguration(classes= {org.exfly.demo.config.SimpleManualwireConfig.class}) public class SimpleBeanManualwireTest { @Test public void testAnnotationConfigAppContextAutoScan() { ApplicationContext context = new AnnotationConfigApplicationContext(org.exfly.demo.config.SimpleConfigScanConfig.class); SpeakService service = (SpeakService) context.getBean(\u0026#34;peopleSpeakServiceImpl\u0026#34;); Assert.assertEquals(\u0026#34;People speak\u0026#34;, service.speak()); } } //å¦‚æœå¸Œæœ›ä½¿ç”¨@Autowiredè‡ªåŠ¨è£…é…ï¼Œ @RunWith(SpringRunner.class) @ContextConfiguration(classes= {org.exfly.demo.config.SimpleConfigScanConfig.class}) public class SimpleAutoScanTest { @Autowired //æ ¹æ®ç±»å‹è¿›è¡Œè‡ªåŠ¨æ³¨å…¥ private SpeakService sservice; @Test public void testAnnotationConfigAppContextAutoScanAutoWire() { Assert.assertEquals(\u0026#34;People speak\u0026#34;, sservice.speak()); } } @Autowired # å¯ä»¥åœ¨å±æ€§ã€æ„é€ æ–¹æ³•ã€setå‡½æ•°ä¸­è¿›è¡Œè‡ªåŠ¨æ³¨å…¥\næ¶ˆé™¤æ­§ä¹‰ # é€šè¿‡ä½¿ç”¨@Beanæ³¨è§£æ–¹æ³•ï¼Œå¯ä»¥å£°æ˜å¹¶æ³¨å†Œä¸€ä¸ªä»¥æ–¹æ³•åä¸ºnameçš„beanã€‚å¦‚æœä½¿ç”¨@Bean(name= {\u0026ldquo;sayAndPlayServiceNewName\u0026rdquo;, \u0026ldquo;sayAndPlayService\u0026rdquo;})å¯¹beanè¿›è¡Œå‘½åï¼Œå¯ä»¥ç”¨ä¸åŒçš„åå­—å–ç”¨ï¼ˆåœ¨@Autowiredå¤„å†åŠ ä¸€ä¸ª@Qualifier(\u0026ldquo;sayAndPlayServiceNewName\u0026rdquo;)ï¼‰; å¦‚æœä½¿ç”¨@ComponentScanï¼Œç›¸åº”çš„Beanå®šä¹‰éœ€è¦ä½¿ç”¨Componentç­‰è¿›è¡Œæ³¨è§£ï¼ŒåŒæ—¶ä½¿ç”¨@Qualifier(\u0026ldquo;BeanId\u0026rdquo;)é™å®šç¬¦ï¼Œå¦‚ä¸‹\n@Configuration public class SimpleManualwireConfig { @Bean(name={\u0026#34;sayAndPlayServiceNewName\u0026#34;, \u0026#34;sayAndPlayService\u0026#34;}) public SayAndPlayService sayAndPlayService() { return new PeopleSayAndPlayServiceImpl(); }\t} @Service @Qualifier(\u0026#34;peopleSayServ\u0026#34;) public class PeopleSayServiceImpl implements SayService {} //or @Service(\u0026#34;peopleSayServ\u0026#34;) public class PeopleSayServiceImpl implements SayService {} //å¦‚ä½•ä½¿ç”¨ @Autowired @Qualifier(\u0026#34;peopleSayServ\u0026#34;) SayService service; æ¡ä»¶ç”Ÿæ•ˆ # å¦‚ä¸‹çš„è§£é‡Šï¼šåœ¨å½“å‰ä¸Šä¸‹æ–‡ä¸­ï¼Œå¦‚æœConditionalæ³¨è§£ä¸­çš„MagitExistsCondition.matchesæ–¹æ³•è¿”å›trueï¼Œåˆ™å½“å‰beanï¼šmagicBeanç”Ÿæ•ˆã€‚@Profileå’Œspringbootè‡ªåŠ¨é…ç½®éƒ½æ˜¯åŸºäºæ­¤ç§åŸç†å®ç°çš„ã€‚\n@Bean @Conditional(MagitExistsCondition.class) public MagicBean magicBean(){ return new MagitBean(); } public class MagitExistsCondition implements Condition { boolean matches(ConditionContext ctxt, AnnotatedTypeMetadat metadate){ Environment env = ctxt.getEnvironment(); return env.containsProperty(\u0026#34;magic\u0026#34;); } } @Profile # beanä½œç”¨åŸŸ # Singleton é»˜è®¤ åªåˆ›å»ºä¸€ä¸ªå®ä¾‹ Prototype æ¯æ¬¡åˆ›å»ºæ–°çš„å®ä¾‹ Session æ¯ä¸ªä¼šè¯åˆ›å»ºä¸€ä¸ªå®ä¾‹ Request æ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªå®ä¾‹ ä½¿ç”¨@Scopeè¿›è¡Œé…ç½®å³å¯\n@Component @Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE) public class Notepad{} è¿è¡Œæ—¶å€¼æ³¨å…¥ # ä»¥åè¡¥å……\nå…¶ä»– # é¡¹ç›®ä»£ç \n"},{"id":44,"href":"/posts/Java/CollectionsLearn/","title":"CollectionsçŸ¥è¯†æ•´ç†","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šå­¦Java Collectionsé›†åˆï¼Œå¯¹å…¶ä¸­ä¸€äº›çŸ¥è¯†è¿›è¡Œæ•´ç†\nCollectionsç»“æ„ # ä½¿ç”¨ä¾‹å­ # Iterator # public void testIterator(){ //åˆ›å»ºä¸€ä¸ªé›†åˆ Collection books = new HashSet(); books.add(\u0026#34;è½»é‡çº§J2EEä¼ä¸šåº”ç”¨å®æˆ˜\u0026#34;); books.add(\u0026#34;Struts2æƒå¨æŒ‡å—\u0026#34;); books.add(\u0026#34;åŸºäºJ2EEçš„Ajaxå®å…¸\u0026#34;); //è·å–booksé›†åˆå¯¹åº”çš„è¿­ä»£å™¨ Iterator\u0026lt;String\u0026gt; it = books.iterator(); while(it.hasNext()) { String book = it.next(); System.out.println(book); if (book.equals(\u0026#34;Struts2æƒå¨æŒ‡å—\u0026#34;)) { it.remove(); //ä½¿ç”¨Iteratorè¿­ä»£è¿‡ç¨‹ä¸­ï¼Œä¸å¯ä¿®æ”¹é›†åˆå…ƒç´ ,ä¸‹é¢ä»£ç å¼•å‘å¼‚å¸¸ //books.remove(book); } //å¯¹bookå˜é‡èµ‹å€¼ï¼Œä¸ä¼šæ”¹å˜é›†åˆå…ƒç´ æœ¬èº« book = \u0026#34;æµ‹è¯•å­—ç¬¦ä¸²\u0026#34;; } System.out.println(books); } List # å®ç°Listæ¥å£çš„å¸¸ç”¨ç±»æœ‰LinkedListï¼ŒArrayList\nList\u0026lt;String\u0026gt; list = new LinkedList\u0026lt;\u0026gt;(); Set # Setæ¥å£æœ‰ä»¥ä¸‹å‡ ç§å®ç°ï¼š\nHashSet : ä¸ºå¿«é€ŸæŸ¥æ‰¾è®¾è®¡çš„Setï¼Œä¸»è¦çš„ç‰¹ç‚¹æ˜¯ï¼šä¸èƒ½å­˜æ”¾é‡å¤å…ƒç´ ï¼Œè€Œä¸”é‡‡ç”¨æ•£åˆ—çš„å­˜å‚¨æ–¹æ³•ï¼Œæ‰€ä»¥æ²¡æœ‰é¡ºåºã€‚è¿™é‡Œæ‰€è¯´çš„æ²¡æœ‰é¡ºåºæ˜¯æŒ‡å…ƒç´ æ’å…¥çš„é¡ºåºä¸è¾“å‡ºçš„é¡ºåºä¸ä¸€è‡´ã€‚ TreeSet : ä¿å­˜æ¬¡åºçš„Set, åº•å±‚ä¸ºæ ‘ç»“æ„ã€‚ä½¿ç”¨å®ƒå¯ä»¥ä»Setä¸­æå–æœ‰åºçš„åºåˆ—ã€‚ LinkedHashSet : å…·æœ‰HashSetçš„æŸ¥è¯¢é€Ÿåº¦ï¼Œä¸”å†…éƒ¨ä½¿ç”¨é“¾è¡¨ç»´æŠ¤å…ƒç´ çš„é¡ºåº(æ’å…¥çš„æ¬¡åº)ã€‚äºæ˜¯åœ¨ä½¿ç”¨è¿­ä»£å™¨éå†Setæ—¶ï¼Œç»“æœä¼šæŒ‰å…ƒç´ æ’å…¥çš„æ¬¡åºæ˜¾ç¤ºã€‚ Set\u0026lt;String\u0026gt; hs = new HashSet\u0026lt;\u0026gt;(); Map # Mapæ¥å£æœ‰ä»¥ä¸‹å‡ ç§å®ç°ï¼š HashMapã€LinkedHashMapã€HashTableå’ŒTreeMap\nMap\u0026lt;String, String\u0026gt; m1 = new HashMap\u0026lt;\u0026gt;(); m1.put(\u0026#34;Zara\u0026#34;, \u0026#34;8\u0026#34;); m1.get(\u0026#34;Zara\u0026#34;); // 8 m1.containsKey(\u0026#34;Zara\u0026#34;); // true Java8çš„HashMapè¯¦è§£ï¼ˆå­˜å‚¨ç»“æ„ï¼ŒåŠŸèƒ½å®ç°ï¼Œæ‰©å®¹ä¼˜åŒ–ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œéå†æ–¹æ³•ï¼‰ Queue # Queue\u0026lt;String\u0026gt; queue = new LinkedList\u0026lt;String\u0026gt;(); //æ·»åŠ å…ƒç´  queue.offer(\u0026#34;a\u0026#34;); queue.offer(\u0026#34;b\u0026#34;); queue.offer(\u0026#34;c\u0026#34;); queue.offer(\u0026#34;d\u0026#34;); queue.offer(\u0026#34;e\u0026#34;); for(String q : queue){ System.out.println(q); } System.out.println(\u0026#34;===\u0026#34;); System.out.println(\u0026#34;poll=\u0026#34;+queue.poll()); //è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶åœ¨é˜Ÿåˆ—ä¸­åˆ é™¤ for(String q : queue){ System.out.println(q); } System.out.println(\u0026#34;===\u0026#34;); System.out.println(\u0026#34;element=\u0026#34;+queue.element()); //è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´  for(String q : queue){ System.out.println(q); } System.out.println(\u0026#34;===\u0026#34;); System.out.println(\u0026#34;peek=\u0026#34;+queue.peek()); //è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´  for(String q : queue){ System.out.println(q); } /* a b c d e === poll=a b c d e === element=b b c d e === peek=b b c d e */ è½¬æˆçº¿ç¨‹å®‰å…¨ # List\u0026lt;String\u0026gt; list = Collections.synchronizedList(new LinkedList\u0026lt;\u0026gt;()); èµ„æº # å®˜æ–¹ Collections Api reference Javaé›†åˆæ¡†æ¶é¢è¯•é¢˜ æ¯”è¾ƒç»†è‡´çš„è®²è§£ é¢è¯•æ•´ç†-Javaç»¼åˆé«˜çº§ç¯‡ï¼ˆåè¡€æ•´ç†ï¼‰ æœ€å…¨çš„BATå¤§å‚é¢è¯•é¢˜æ•´ç† "},{"id":45,"href":"/posts/tools/wox_everything/","title":"Wox+Everythingæ”¹å˜æ—¥å¸¸ä½¿ç”¨ç”µè„‘çš„æµç¨‹ç¥å™¨ï¼Œå¢™è£‚æ¨è","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šä½ å¯ä»¥å°† Wox çœ‹ä½œä¸€ä¸ªé«˜æ•ˆçš„æœ¬åœ°å¿«é€Ÿæœç´¢æ¡†ï¼Œé€šè¿‡å¿«æ·é”®å‘¼å‡ºï¼ˆé»˜è®¤alt+ç©ºæ ¼ï¼‰ï¼Œç„¶åè¾“å…¥å…³é”®å­—ï¼ˆæ”¯æŒæ‹¼éŸ³æ¨¡ç³ŠæŸ¥è¯¢ï¼‰æ¥æœç´¢ç¨‹åºè¿›è¡Œå¿«é€Ÿå¯åŠ¨ï¼Œæˆ–è€…æœç´¢æœ¬åœ°ç¡¬ç›˜çš„æ–‡ä»¶ï¼Œæ‰“å¼€ç™¾åº¦ã€Google è¿›è¡Œæœç´¢ï¼Œç”šè‡³æ˜¯é€šè¿‡ä¸€äº›æ’ä»¶çš„åŠŸèƒ½å®ç°å•è¯ç¿»è¯‘ã€å…³é—­å±å¹•ã€æŸ¥è¯¢å‰ªè´´æ¿å†å²ã€æŸ¥è¯¢ç¼–ç¨‹æ–‡æ¡£ã€æŸ¥è¯¢å¤©æ°”ç­‰æ›´å¤šåŠŸèƒ½ã€‚\nè½¯ä»¶å‡†å¤‡ # everything wox ä»‹ç»ä¸€äº›è½¯ä»¶çš„ç‰¹æ€§ # ç›´æ¥ä½¿ç”¨æœç´¢å¼•æ“æœç´¢ å¯ä»¥æœç´¢è½¯ä»¶ï¼Œç›´æ¥å›è½¦å³å¯è¿è¡Œ æœç´¢æ–‡ä»¶ã€æ–‡ä»¶å¤¹ï¼Œå›è½¦åä½¿ç”¨ç³»ç»Ÿé»˜è®¤è½¯ä»¶æ‰“å¼€ é…ç½®ç³»ç»Ÿå‘½ä»¤ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œ(ç±»ä¼¼Win+R) é€šè¿‡æ’ä»¶å¯ä»¥å®ç°å•è¯ç¿»è¯‘ç­‰åŠŸèƒ½ å®‰è£…æ–¹æ³• # é“¾æ¥ä¸­æœ‰å…·ä½“çš„ä½¿ç”¨æ–¹æ³•ã€‚æˆ‘æ›´å–œæ¬¢ç»¿è‰²è½¯ä»¶ï¼Œä¸‹è½½ä¸‹æ¥ç›´æ¥å¯ä»¥ä½¿ç”¨ã€‚\nå®‰è£…ä¹‹å # çœ‹ä¸€ä¸‹ä½¿ç”¨æ•ˆæœï¼š å¼•ç”¨ # Woxä¸€æ¬¾å›½äº§å¼€æºçš„å¿«æ·å¯åŠ¨å™¨è¾…åŠ©å·¥å…·ç¥å™¨ å…·ä½“æ€ä¹ˆé…ç½®å¯ä»¥çœ‹è¿™ä¸ª woxç¨‹åºå¼€æºåœ°å€ "},{"id":46,"href":"/posts/Algorithm/wiki_zh_practice_Word2Vec/","title":"ä½¿ç”¨gensimè®­ç»ƒword2vecæ¨¡å‹--ä¸­æ–‡ç»´åŸºç™¾ç§‘è¯­æ–™","section":"Blog","content":"æ–‡ç« ç®€ä»‹ï¼šä¸ºäº†å†™è®ºæ–‡ï¼Œä½¿ç”¨gensimè®­ç»ƒword2vecæ¨¡å‹ï¼Œå¦‚ä¸‹è®°å½•äº†è¿›è¡Œè®­ç»ƒçš„è¿‡ç¨‹\nå‡†å¤‡ # ä¸­æ–‡ç»´åŸºç™¾ç§‘é¢„æ–™ï¼š zhwiki-latest-pages-articles.xml.bz2 python3 wiki_zh_word2vec ç¹ä½“è½¬ç®€ä½“ï¼š openccä¸€å®šè¦ä¸‹*-win32.7z,win64çš„åœ¨æˆ‘ç”µè„‘ä¸Šæ— æ³•è¿è¡Œã€‚å¦‚æœä½¿ç”¨æˆ‘çš„ wiki_zh_word2vec,åˆ™é¡¹ç›®ä¸­åŒ…å«å¯ä»¥ç›´æ¥ä½¿ç”¨çš„opencc TODO # ä¾èµ–å‡†å¤‡ # ä¸‹è½½ ä¸­æ–‡ç»´åŸºç™¾ç§‘é¢„æ–™ git clone https://github.com/ExFly/wiki_zh_word2vec.git å°†zhwiki-latest-pages-articles.xml.bz2æ”¾åˆ°buildæ–‡ä»¶å¤¹ä¸‹ cd path/to/wiki_zh_word2vec pip install pipenv pipenv install \u0026ndash;dev å°†XMLçš„Wikiæ•°æ®è½¬æ¢ä¸ºtextæ ¼å¼ # pipenv run python 1_process.py build/zhwiki-latest-pages-articles.xml.bz2 build/wiki.zh.txt 31åˆ†é’Ÿè¿è¡Œå®Œæˆ282855ç¯‡æ–‡ç« ï¼Œå¾—åˆ°ä¸€ä¸ª931Mçš„txtæ–‡ä»¶\nä¸­æ–‡ç¹ä½“æ›¿æ¢æˆç®€ä½“ # opencc-1.0.1-win32/opencc -i build/wiki.zh.txt -o build/wiki.zh.simp.txt -c opencc-1.0.1-win32/t2s.json å¤§çº¦ä½¿ç”¨äº†15åˆ†é’Ÿ\nç»“å·´åˆ†è¯ # pipenv run python 2_jieba_participle.py å¤§çº¦ä½¿ç”¨äº†30åˆ†é’Ÿ\nWord2Vecæ¨¡å‹è®­ç»ƒ # pipenv run python 3_train_word2vec_model.py å¤§çº¦ä½¿ç”¨äº†30åˆ†é’Ÿï¼Œä¸”å…¨ç¨‹cpuä½¿ç”¨ç‡è¾¾åˆ°90%+\næ¨¡å‹æµ‹è¯• # pipenv run python 4_model_match.py d:\\Project\\wiki_zh_word2vec (develop) Î» pipenv run python 4_model_match.py å›½é™…è¶³çƒ 0.5256255865097046 è¶³çƒé˜Ÿ 0.5234458446502686 ç¯®çƒ 0.5108680725097656 è¶³çƒè¿åŠ¨ 0.5033905506134033 å›½å®¶è¶³çƒé˜Ÿ 0.494105726480484 è¶³çƒæ¯”èµ› 0.4919792115688324 ç”·å­ç¯®çƒ 0.48382389545440674 è¶³çƒè”èµ› 0.4837716817855835 ä½“è‚² 0.4835757911205292 football 0.47945135831832886 æŸ¥çœ‹ç»“æœ # å¯ä»¥ä½¿ç”¨linuxçš„headæˆ–è€…tailå‘½ä»¤æŸ¥çœ‹è¿è¡Œçš„ç»“æœã€‚\nhead -n 100 wiki.zh.simp.txt \u0026gt; wiki.zh.simp_head_100.txt,ç›´æ¥æŸ¥çœ‹wiki.zh.simp_head_100.txtå³å¯ æ²¡æœ‰headå‘½ä»¤ï¼Œå¯ä»¥å®‰è£… gowï¼Œæˆ–è€…ç›´æ¥ä¸‹è½½ cmder,è¿›å…¥å°±å¯ä»¥ä½¿ç”¨headå‘½ä»¤äº† ç»“æœ # è‡³æ­¤ï¼Œä½¿ç”¨pythonå¯¹ä¸­æ–‡wikiè¯­æ–™çš„è¯å‘é‡å»ºæ¨¡å°±å…¨éƒ¨ç»“æŸäº†ï¼Œwiki.zh.text.vectorä¸­æ˜¯æ¯ä¸ªè¯å¯¹åº”çš„è¯å‘é‡ï¼Œå¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šä½œæ–‡æœ¬ç‰¹å¾çš„æå–ä»¥åŠåˆ†ç±»ã€‚æ‰€æœ‰ä»£ç éƒ½å·²ä¸Šä¼ è‡³ æœ¬äººGitHubä¸­ï¼Œæ¬¢è¿æŒ‡æ•™ï¼ æ„Ÿè°¢ AimeeLee77,å…¶ä»£ç ä¸ºPython2ï¼Œæˆ‘çš„é¡¹ç›® exfly/wiki_zh_word2vecå·²ç»å®Œå…¨è¿ç§»åˆ°python3,å¹¶å‘ AimeeLee77æäº¤äº†pull request wiki_zh_word2vec "},{"id":47,"href":"/posts/diary/2018.02.01-2017-holiday-summary/","title":"2017å¹´ç»ˆæ€»ç»“ï¼Œæœªæ¥è§„åˆ’","section":"Blog","content":"å¯¹2017å¹´å…¨å¹´çš„æ€»ç»“ï¼Œå¹¶ä¸ºæœªæ¥åšä¸€äº›å®‰æ’ã€‚\nå¹´å‰ä¸€å¤©ï¼Œä¾æ—§å¿™ç¢Œ # å¾€äº‹ # å¦‚ä»Š # æœªæ¥ # ä»¥åè¯¥æ€ä¹ˆå¦‚ä½•è¿›æ­¥ï¼Ÿ\nå…¶ä»– # ç»§ç»­å­¦ä¹ ï¼Œå…±å‹‰ï¼\n"},{"id":48,"href":"/posts/tools/vim/","title":"Vimå­¦ä¹ ","section":"Blog","content":"å­¦ä¹ vimåŸºæœ¬ä½¿ç”¨çš„ç¬”è®°\nå¼•è¨€ # æƒ³å­¦ä¸€ä¸‹Vimçš„é”®ä½ï¼Œç»“åˆsublime textå’Œvscodeçš„vimæ’ä»¶åŠ å¿«ç¼–ç é€Ÿåº¦ç¼–ç \næ­£æ–‡ # èµ„æº # ä½¿ç”¨æ–¹æ³• # Vim ç®€ä½“ä¸­æ–‡ cheatsheet # vim_cheat_sheet vim_è¡¨æ ¼å½¢å¼ vim_è„‘å›¾å½¢å¼ vim_ä¸­æ–‡å½¢å¼ "},{"id":49,"href":"/posts/sercurity/2017.12.19-%E4%B8%AA%E4%BA%BA%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86-Android%E8%A3%85%E6%9C%BA%E6%8C%87%E5%8D%97/","title":"ä¸ªäººå¯†ç ç®¡ç†+Androidè£…æœºæŒ‡å—","section":"Blog","content":"åˆ†äº«è‡ªå·±çš„å¯†ç ç®¡ç†ä½“ç³»: keepass+ åšæœäº‘+ keepass2Androidï¼Œä»¥åŠä½¿ç”¨ å®¹å™¨ï¼Œæ­å»ºé˜²æ­¢æ‰‹æœºè¶Šç”¨è¶Šå¡çš„æ—¥å¸¸ä½¿ç”¨appä½“ç³»ï¼Œè¯¥åº”ç”¨ä¸éœ€è¦rootã€‚\nä¸ªäººå¯†ç ç®¡ç† # å‡†å¤‡ # win: keepass è‡ªåŠ©äº‘å­˜å‚¨: åšæœäº‘è´¦å· Android: keepass2Android å¼€å§‹ # å·¥å…·å‡†å¤‡å¥½å°±å¼€å§‹å§ï¼ŒæŒ‰å¦‚ä¸‹æ­¥éª¤ï¼š\nç”µè„‘ç«¯keepassæœ¬åœ°å»ºä¸€ä¸ªå¯†ç æ–‡ä»¶ï¼ˆéœ€è¦ä¸€ä¸ªä¸»å¯†ç ï¼Œä»¥åå¯ä»¥ä¿®æ”¹ï¼Œä¸»å¯†ç ä¸€å®šè¦å¤æ‚ï¼‰ï¼Œåä¸Šä¼ åˆ°åšæœäº‘é‡Œï¼Œï¼ˆè¿™æ—¶å€™å°±å¯ä»¥åˆ é™¤æœ¬åœ°çš„å¯†ç æ–‡ä»¶äº†ï¼‰ï¼› åšæœäº‘ä¸­é…ç½®ç¬¬ä¸‰æ–¹åº”ç”¨æˆæƒã€‚ï¼ˆåšæœäº‘è®°å¾—å¼€äºŒæ­¥éªŒè¯ï¼Œè¿™æ ·æ¯æ¬¡ç™»é™†éœ€è¦å¾®ä¿¡æ¥æ”¶éªŒè¯ç æ‰å¯ä»¥ç™»é™†ï¼Œæ›´å®‰å…¨ä¸€äº›ï¼‰ï¼› ç”µè„‘keepassæ‰“å¼€urlï¼Œä»¥åŠAndroidæ‰‹æœºkeepass2Androidæ‰“å¼€urlï¼› å®Œã€‚ å…·ä½“å¦‚ä½•åˆ›å»ºè¯·çœ‹è¿™ä¸ª é“¾æ¥ï¼Œ å¦‚æˆ‘è¿™èˆ¬å»ºå¯†ç ç»´æŠ¤åŸºæœ¬ä¸ä¼šå‡ºç°é—®é¢˜ã€‚\nåˆ°è¿™é‡Œå¯†ç ç®¡ç†ä½“ç³»åŸºæœ¬å®Œæˆäº†ã€‚å¯æ˜¯å¯¹äºä¸€ä¸ªæ–°æ‰‹æœºï¼Œç”¨å¥½ä¹…å°±ä¼šå¡ï¼Œå¾ˆå¡ï¼Œè¶…çº§å¡ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±è¦è€ä¸€äº›å°æ‰‹æ®µï¼Œå…·ä½“å¦‚ä¸‹ã€‚\nAndroidè£…æœºæŒ‡å— # å‡†å¤‡ # å®¹å™¨å¼€æºäº§å“ï¼ŒåŸºäºvirtualappæ¡†æ¶ï¼Œæœ‰ç‚¹åƒDockerï¼›åˆæ˜¯åŒå¼€å·¥å…·ï¼Œä»–è‡ªå·±æœ‰è‡ªå·±çš„è¿è¡Œç¯å¢ƒï¼›åˆå¯ä»¥è¯´æ˜¯Androidä¸‹çš„å…å®‰è£…åº”ç”¨çš„è¿è¡Œå¹³å°ã€‚ä¹‹åä¼šå‘Šè¯‰ä½ æ€ä¹ˆç”¨ï¼Œè¶…çº§æ£’ é…·å®‰åº”ç”¨å•†åº— apkpure.comä¸‹è½½ä¸­å›½ä¸‹è½½ä¸äº†çš„åº”ç”¨ï¼Œæœ‰ä¸€ä¸ªæ²¡è¢«å¢™çš„ç½‘å€ï¼Œä¸‹è½½å¥½appåï¼Œappä¸éœ€è¦vpnï¼Œæ‡‚äº†æ²¡ï¼ŸåŸŸåæ²¡æ‰¾åˆ°ï¼Œæ‡’å¾—æ‰¾äº†ã€‚googleå•†åº—é‡Œæ‰€æœ‰çš„åº”ç”¨è¿™é‡Œéƒ½å¯ä»¥ä¸‹ï¼Œè‡ªå·±æƒ³åƒå§ å¼€å§‹ # å…ˆæˆªä¸ªå›¾ï¼Œçœ‹ä¸€çœ‹ æœ€å±Œç‚¸å¤©çš„æ˜¯ï¼Œæˆ‘æŠŠæ·˜å®ã€ç‹è€…è£è€€å’Œåƒé¸¡éƒ½æ”¾åˆ°å®¹å™¨äº†ï¼Œè€Œä¸”å®Œå…¨æ²¡æœ‰æ€§èƒ½æŸå¤±\nåŸºæœ¬æ€è·¯ï¼šæŠŠå¿…é¡»è£…åˆ°æ‰‹æœºé‡Œçš„ï¼ˆæ¯”å¦‚æ”¯ä»˜å®ï¼Œå¾®ä¿¡ç­‰ï¼‰è£…åˆ°æ‰‹æœºé‡Œï¼Œéå¿…éœ€ï¼ˆæ¯”å¦‚æ·˜å®ï¼Œç™¾åº¦äº‘ç­‰ï¼‰ï¼Œéƒ½è£…å®¹å™¨é‡Œã€‚\nç±»æ¯”çœŸæœºï¼Œè½¯ä»¶éœ€è¦æœ‰ä¸€ä¸ªæ‰§è¡Œç¯å¢ƒå’Œä¸´æ—¶æ–‡ä»¶ï¼Œå®¹å™¨é‡Œçš„è½¯ä»¶æ–‡ä»¶éƒ½å­˜åˆ°äº†/virtualä¸­çš„ã€‚\nä½¿ç”¨æ€è·¯ï¼šå¹³æ—¶æŠŠå¯ä»¥æ”¾åˆ°å®¹å™¨ä¸­çš„è½¯ä»¶æ”¾åˆ°é‡Œè¾¹ï¼Œä¸ç”¨çš„æ—¶å€™ç›´æ¥å…³é—­å®¹å™¨ï¼Œå®¹å™¨é‡Œæ‰€æœ‰çš„è½¯ä»¶ä¼šå…³é—­ã€‚è¿™æ ·å°±é˜²æ­¢è½¯ä»¶çš„åå°è‡ªåŠ¨å¯åŠ¨ï¼Œæµªè´¹å†…å­˜ï¼Œæ‰‹æœºè¶Šç”¨è¶Šæ…¢çš„ç°è±¡ã€‚\nå…·ä½“çœ‹æˆ‘å¹³æ—¶å¸¸ç”¨çš„ä¸€äº›è½¯ä»¶ï¼Œæˆ‘æŠŠä»–ä»¬åˆ†ä¸ºä¸»æœºï¼ˆå°±æ˜¯å®‰è£…åˆ°çœŸæœºä¸­ï¼‰å’Œå®¹å™¨ä¸­çš„ã€‚åœ°å€åˆ†åˆ«å¦‚ä¸‹\nçœŸæœº å®¹å™¨ æœ€å # æœ‰ä»€ä¹ˆé—®é¢˜è¯·ç›´æ¥åœ¨æˆ‘çš„é…·å®‰@æˆ‘ï¼Œæˆ–è€…é‚®ç®±æˆ‘ï¼šexflycat@gmail.comã€‚\nEnjoy!!!\n"},{"id":50,"href":"/posts/sercurity/2017.09.17-black-phone/","title":"oneplus one åˆ·Kali Linux NetHunter","section":"Blog","content":"çœ‹äº†ä½™å¼¦å¤§å¤§çš„çŸ¥ä¹liveåï¼Œå‘ç°çœŸçš„éœ€è¦å¯¹è‡ªå·±çš„éšç§å®‰å…¨åšç‚¹ä»€ä¹ˆäº†ã€‚ä¸€æ¿€åŠ¨ï¼Œæ·˜å®500å¤§æ´‹ä¹°äº†ä¸€éƒ¨oneplus oneï¼Œåˆ·kaliã€‚ è¿™é‡Œè®°å½•ä½¿ç”¨oneplus oneæ‰‹æœºæ‰“é€ é»‘æ‰‹å…¨è¿‡ç¨‹ï¼Œä»¥åŠä¸€äº›ä½¿ç”¨åˆ°çš„èµ„æºï¼Œä»¥åŠç»éªŒæ±‡æ€»ã€‚\nä¸€ # ä½¿ç”¨oneplus oneæ­å»ºé»‘æ‰‹è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå› ä¸ºå¯¹Androidå¹³å°ä¸ç†Ÿæ‚‰ï¼Œåˆ·kaliè¿‡ç¨‹ä¸­è¸©äº†è®¸å¤šå‘ã€‚æ¯”å¦‚ äºŒæ¸…ã€ä¸‰æ¸…ã€å››æ¸…ç­‰ç­‰ã€‚å¦‚ä¸‹ä¸€æ­¥ä¸€æ­¥çš„è¯´å¦‚ä½•åˆ·ã€‚\näºŒ # åˆ·æœºå››æ­¥èµ° # ç¬¬ä¸€æ­¥ï¼Œ ä»”ç»†é˜…è¯» å®˜æ–¹Wiki # ä»”ç»†ç ”è¯»ä»”ç»†é˜…è¯» å®˜æ–¹Wikiï¼Œå¯ä»¥å‡å°‘åˆ·æœºè¿‡ç¨‹ä¸­å„ç§å‘ã€‚\nç¬¬äºŒæ­¥ï¼Œ åˆ· TWRP-oneplus1 # ä¸€å¥è¯æ€»ç»“å°±æ˜¯ï¼šè§£é”ã€åˆ·è¿›å¯¹åº”çš„ twrp.imgã€‚æ•´ä¸ªè¿‡ç¨‹æœ¬è´¨æ˜¯ä¸€åŠ  3T å¼€å¯äº†å¼€å‘è€…æ¨¡å¼ï¼ŒåŒæ—¶ç”µè„‘ä¸ŠåŸºäºé¢„é…ç½®å¥½çš„adbã€fastbootå‘½ä»¤å®Œæˆè¿™ä¸€ç³»åˆ—æ“ä½œã€‚è¿™ä¸ª\u0026quot;é¢„é…ç½®\u0026quot;åœ¨ Windows ä¸‹ï¼Œä¹Ÿå¯ä»¥å‚è€ƒ\u0026quot; Bacon Root Toolkit\u0026quot;ï¼ˆè¿™æ˜¯ä¸“ä¸ºä¸€åŠ æ‰“é€ çš„GUIå·¥å…·é›†ï¼Œå½“æ—¶è¿˜æ˜¯ä¸€åŠ 1æ—¶ï¼Œç”¨è¿™ä¸ªå¾ˆæ–¹ä¾¿ï¼Œè™½ç„¶å¾ˆä¹…æ²¡æ›´æ–°äº†ï¼Œä½†ä½œä¸ºå‚è€ƒè¿˜æ˜¯å¾ˆå¥½çš„ï¼‰ã€‚\nç¬¬ä¸‰æ­¥ï¼Œä¸‹è½½æœ€æ–°çš„ NetHunterï¼Œå¹¶è¿›å…¥TWRPçš„recoveryæ¨¡å¼åˆ·å…¥kali # kernel-nethunter-[device]-[os]-*.zip nethunter-generic-[arch]-kalifs-*.zip å¯¹äºoneplus1æ‰‹æœºæ¥è¯´ï¼Œå…¶å¯¹åº”çš„[arch]ä¸ºarmhfã€‚ éšåè¿›è¡Œåˆ·å…¥æ“ä½œã€‚è¿›å…¥TWRPï¼Œé€‰æ‹©å®‰è£…ã€‚å…ˆæ‰¾åˆ°CM13.0åˆ·åˆ°oneplusä¸­ï¼Œåè¿›è¡Œé»˜è®¤çš„WIPEã€‚ä¹‹åå†TWRPå®‰è£…ä¸­é€‰æ‹©kernel-nethunter-[device]-[os]-*.zipï¼Œå®‰è£…ç»“æŸåï¼Œåœ¨é€‰æ‹©nethunter-generic-[arch]-kalifs-*.zipï¼Œæœ€åè¿™ä¸ªæ–‡ä»¶å®‰è£…è¯è´¹çš„æ—¶é—´æ¯”è¾ƒä¹…ï¼Œå¤§çº¦10å¤šåˆ†é’Ÿçš„æ ·å­ã€‚\nç¬¬å››æ­¥ï¼Œéƒ½åˆ·é¡ºåˆ©åï¼Œå¼€æœºè¿›å…¥kali ï¼Œç”¨å·²ç»â€œé¢„è£…â€ä¸Šçš„ SuperSU App æ¥å®Œæˆä¹‹åä¸€ç³»åˆ—çš„ Rootæˆæƒå³å¯ã€‚ # ä¸‰ # å¦‚æœå®‰è£…Kali Linux NetHunter,éœ€è¦ä¸‹è½½çš„æ–‡ä»¶å¦‚ä¸‹ï¼š\nCM13.0 TWRPï¼šç¬¬ä¸‰æ–¹recovery brtï¼šoneplusçš„è§£é”ã€rootå·¥å…· Kali Linux NetHunterï¼šå¦‚æœåˆ·å…¶ä»–ç³»ç»Ÿï¼Œå¯èƒ½éœ€è¦çš„æ–‡ä»¶å¦‚ä¸‹ï¼š TWRPï¼šç¬¬ä¸‰æ–¹recovery lineageos romï¼šcmçš„é‡ç”Ÿ supersuï¼šrootå·¥å…· å›› # Enjoyï¼\næœ€å # å®‰è£…äº†Kali Linux NetHunterï¼Œæ‰‹æœºä¾¿æœ‰äº†å®Œæ•´çš„pythonç¯å¢ƒã€‚å‰©ä¸‹çš„ï¼Œä½ æ‡‚çš„ã€‚\n"},{"id":51,"href":"/posts/Algorithm/sort/","title":"å„ç§æ’åºç®—æ³•å®ç°æ–¹æ³•","section":"Blog","content":"æ€»ç»“ä¸€äº›å¸¸ç”¨çš„æ’åºç®—æ³•ï¼Œå¦‚å†’æ³¡æ’åºã€æ’å…¥æ’åºã€å¿«é€Ÿæ’åºã€è®¡æ•°æ’åºã€äºŒåˆ†æ’åºã€å½’å¹¶æ’åºç­‰ã€‚\nSource # æ’åºç®—æ³•æ¯”è¾ƒ-wiki visualgo æ’åºç®—æ³•çš„åŠ¨æ€å›¾ æ’åºç®—æ³•å¤æ‚åº¦ å†’æ³¡æ’åº # ä¼ªä»£ç  # function bubble_sort (array, length) { var i, j; for(i from 0 to length-1){ for(j from 0 to length-1-i){ if (array[j] \u0026gt; array[j+1]) swap(array[j], array[j+1]) } } } å‡½æ•° å†’æ³¡æ’åº è¾“å…¥ ä¸€ä¸ªæ•°ç»„åç§°ä¸ºarray å…¶é•¿åº¦ä¸ºlength i ä» 0 åˆ° (length - 1) j ä» 0 åˆ° (length - 1 - i) å¦‚æœ array[j] \u0026gt; array[j + 1] äº¤æ¢ array[j] å’Œ array[j + 1] çš„å€¼ å¦‚æœç»“æŸ jå¾ªç¯ç»“æŸ iå¾ªç¯ç»“æŸ å‡½æ•°ç»“æŸ pythonå®ç° # def bubble(List): for j in range(len(List)-1,0,-1): for i in range(0, j): if List[i] \u0026gt; List[i+1]: List[i], List[i+1] = List[i+1], List[i] return List æ’å…¥æ’åº # pythonå®ç° # def insert_sort(lst): n=len(lst) if n==1: return lst for i in range(1,n): for j in range(i,0,-1): if lst[j] \u0026lt; lst[j-1]: lst[j], lst[j-1] = lst[j-1], lst[j] return lst å¿«é€Ÿæ’åº # pythonå®ç° # def quicksort(a): if len(a) == 1: return a[0] if len(a) \u0026lt; 1: return 0 return quicksort([x for x in a[1:] if x \u0026lt; a[0]]), [a[0]], quicksort([x for x in a[1:] if x \u0026gt; a[0]]) Cè¯­è¨€å®ç° # int partition(int arr[], int low, int high){ int key; key = arr[low]; while(low \u0026lt; high){ while(low \u0026lt; high \u0026amp;\u0026amp; arr[high]\u0026gt;= key ) high--; if(low \u0026lt; high) arr[low++] = arr[high]; while( low \u0026lt; high \u0026amp;\u0026amp; arr[low]\u0026lt;=key ) low++; if(low \u0026lt; high) arr[high--] = arr[low]; } arr[low] = key; return low; } void quick_sort(int arr[], int start, int end){ int pos; if (start \u0026lt; end){ pos = partition(arr, start, end); quick_sort(arr,start,pos-1); quick_sort(arr,pos+1,end); } return; } å½’å¹¶æ’åº # pythonå®ç° # from collections import deque def merge_sort(lst): if len(lst) \u0026lt;= 1: return lst def merge(left, right): merged,left,right = deque(),deque(left),deque(right) while left and right: merged.append(left.popleft() if left[0] \u0026lt;= right[0] else right.popleft()) # deque popleft is also O(1) merged.extend(right if right else left) return list(merged) middle = int(len(lst) // 2) left = merge_sort(lst[:middle]) right = merge_sort(lst[middle:]) return merge(left, right) è®¡æ•°æ’åº # Cå®ç° # void counting_sort(int *ini_arr, int *sorted_arr, int n) { int *count_arr = (int *) malloc(sizeof(int) * 100); int i, j, k; for (k = 0; k \u0026lt; 100; k++) count_arr[k] = 0; for (i = 0; i \u0026lt; n; i++) count_arr[ini_arr[i]]++; for (k = 1; k \u0026lt; 100; k++) count_arr[k] += count_arr[k - 1]; for (j = n; j \u0026gt; 0; j--) sorted_arr[--count_arr[ini_arr[j - 1]]] = ini_arr[j - 1]; free(count_arr); } äºŒåˆ†æŸ¥æ‰¾ # int binary_search(int array[],int n,int value){ int left=0; int right=n-1; while (left\u0026lt;=right){ int middle=left + ((right-left)\u0026gt;\u0026gt;1); //é˜²æ­¢æº¢å‡ºï¼Œç§»ä½ä¹Ÿæ›´é«˜æ•ˆã€‚åŒæ—¶ï¼Œæ¯æ¬¡å¾ªç¯éƒ½éœ€è¦æ›´æ–°ã€‚ if (array[middle] \u0026gt; value) { right =middle-1; } else if(array[middle] \u0026lt; value) { left=middle+1; } else { return middle; } } return -1; } "},{"id":52,"href":"/posts/diary/2017.01.01-2016-holiday-summary/","title":"2016å¹´ç»ˆæ€»ç»“ï¼Œæœªæ¥è§„åˆ’","section":"Blog","content":"å¯¹2016å¹´å…¨å¹´çš„æ€»ç»“ï¼Œå¹¶ä¸ºæœªæ¥åšä¸€äº›å®‰æ’ã€‚\nå¹´å‰ä¸€å¤©ï¼Œä¾æ—§å¿™ç¢Œ # å¾€äº‹ # 14å¹´åæœˆè‡³ä»Šå¤©ï¼Œä»0åˆ°1çš„è½¬å˜ã€‚ å¼€å§‹çš„æ—¶å€™ï¼Œä¸æ–­çš„å­¦ä¹ å„ç§è½¯ä»¶çš„ä½¿ç”¨ï¼Œåƒä»€ä¹ˆPSä¹‹ç±»çš„ä¸œè¥¿ç©äº†ä¸ªéï¼Œæ€»æ„Ÿè§‰è¿™äº›ä¸œè¥¿éƒ½æ˜¯åˆ«äººåšå‡ºæ¥çš„ä¸œè¥¿ï¼Œä¾¿ç”Ÿå‡ºè‡ªå·±ä¹Ÿæå‡ºä¸€äº›æƒ³è¿™ç±»è½¯ä»¶ã€‚ç„¶è€Œç»§ç»­çš„çæã€‚ ä¸çŸ¥ä»€ä¹ˆæ—¶å€™ï¼ŒçŸ¥é“é€šè¿‡å­¦ä¹ cå¯ä»¥åšå‡ºæ¥å¥½å¤šæœ‰æ„æ€çš„å°ç©æ„ï¼Œæ¯”å¦‚è´ªåƒè›‡ï¼Œä¾¿å¼€å§‹å­¦ä¹ é«˜çº§è¯­è¨€ã€‚ ä¹‹åï¼ŒçŸ¥é“åŸæ¥å­¦ä¹ è®¡ç®—æœºï¼Œéœ€è¦ç³»ç»Ÿçš„å­¦ä¹ è®¡ç®—æœºçš„ç†è®ºçŸ¥è¯†ï¼Œä»æ­¤å…¥å‘ï¼Œä¸€å‘ä¸å¯æ”¶æ‹¾ã€‚ ç½‘æ˜“äº‘è¯¾å ‚æ˜¯è‡ªå·±è®¡ç®—æœºå¯è’™è¯¾ç¨‹ã€‚è·Ÿç€ä¸Šè¾¹çš„è¯¾ç¨‹å­¦äº†å¥½ä¹…ï¼Œæ‡‚äº†è®¡ç®—æœºéœ€è¦å¦‚ä½•å…¥é—¨ã€‚å­¦äº†å¯¼è®ºã€è®¡ç»„ã€Cè¯­è¨€ã€ç®—æ³•å’Œæ•°æ®ç»“æ„ã€æ“ä½œç³»ç»Ÿã€è®¡ç®—æœºç½‘ç»œã€æ•°æ®åº“åŸç†ç­‰ç­‰ã€‚è‡ªå·±æ‰¾è§†é¢‘çœ‹äº†Linuxï¼Œè¯»äº†é¸Ÿå“¥çš„linuxä¹¦ï¼Œç”šè‡³ç›´æ¥å§è‡ªå·±çš„ç”µè„‘ç³»ç»Ÿæ¢æˆäº†Ubuntu/linuxmintï¼ŒçœŸæ­£ä½“ä¼šåˆ°Linuxè¯¥å¦‚ä½•ä½¿ç”¨ã€‚ å‡æœŸç”¨Flaskå®Œæˆäº†åŠ¨æ€ç½‘ç«™ï¼Œéƒ¨ç½²åˆ°æœåŠ¡å™¨é‡Œä¸€æ®µæ—¶é—´ï¼Œåæ¥å› ä¸ºç½‘ç«™å¤ªç®€å•ï¼Œç»™æ’¤äº†ã€‚ åæ¥æ·±å…¥webï¼Œç”¨äº†ä¸¤ä¸ªæœˆçš„æ—¶é—´ï¼ŒæŠŠå‰ç«¯å­¦äº†ä¸€ä¸‹ï¼ŒåŒæ—¶å®Œæˆäº†è‡ªå·±ç¬¬ä¸€ä¸ªç½‘é¡µã€‚å­¦äº†Tornado,é‡æ„äº†å‡ æ¬¡Project Generatorï¼Œä¹Ÿç®—åˆæ­¥æŒæ¡å…¨æ ˆå¼€å‘ã€‚åŒå­¦ç§‘ç ”è®­ç»ƒï¼Œæ‰¾äº†ä¸€ä¸ªTornadoå¼€æºé¡¹ç›®ï¼Œæ”¹æˆäº†è®ºå›ç³»ç»Ÿï¼Œè¿˜å¸®è¿™ä¸ªé¡¹ç›®ä¿®äº†å‡ ä¸ªbugã€‚ å­¦äº†äº›ä¸œè¥¿ã€‚\nå¦‚ä»Š # å¦‚ä»Šï¼Œè¶ç€å‡æœŸï¼Œä¹Ÿæ˜¯å‡†å¤‡è€ƒç ”å‰çš„æœ€åä¸€ä¸ªå¯ä»¥è‡ªç”±æ”¯é…çš„å‡æœŸï¼Œå‡†å¤‡äº†äº›ä¸œè¥¿å›æ¥å­¦ã€‚æ¯å¤©å®Œæˆä¸€ä¸ªæ±‡ç¼–çš„é¡¹ç›®ï¼Œ( å‡æœŸæ±‡ç¼– )ã€‚å‡†å¤‡å¥½å¥½å­¦å­¦æ•°æ®ç»“æ„å’Œç®—æ³•å¯¼è®º.\nè¶ŠåŠªåŠ›è¶Šè¿·èŒ« # è¶ŠåŠªåŠ›ï¼ŒçŸ¥é“çš„è¶Šå¤šï¼Œä¸çŸ¥åˆ°çš„æ›´å¤šã€‚ä¸ºäº†é€‰æ‹©è‡ªå·±çš„æŠ€æœ¯æ–¹å‘ï¼Œè¶Šæ¥è§¦è¶Šä¸çŸ¥é“è¯¥å­¦ä»€ä¹ˆï¼Œè¶Šç€æ€¥ï¼Œè¶Šæ€¥èºã€‚ åŒæ—¶è¿˜æœ‰ä¸€äº›å…¶ä»–çš„äº‹è®©æˆ‘çƒ¦å¿ƒã€‚æ…¢æ…¢æ¥å§ï¼Œæ€¥ä¸æ¥ã€‚\næœªæ¥ # ä»¥åè¯¥æ€ä¹ˆå¦‚ä½•è¿›æ­¥ï¼Ÿ\nå…¶ä»– # ç»§ç»­å­¦ä¹ ï¼Œå…±å‹‰ï¼\n"},{"id":53,"href":"/posts/linux/linux0.11-read-code/","title":"Linux0.11æºç å­¦ä¹ ç¯å¢ƒé…ç½®ä¸ç›¸å…³èµ„æºæ±‡æ€»","section":"Blog","content":"è®°å½•å­¦ä¹ Linuxæ“ä½œç³»ç»Ÿå®ç°æ—¶å€™ä½¿ç”¨è¿‡çš„èµ„æºï¼Œä¸€éƒ¨åˆ†ç¬”è®°ï¼Œä»¥åŠè°ƒè¯•ä¸­ç”¨åˆ°çš„æŠ€å·§ã€‚å†…å®¹æœ‰ç‚¹ä¹±ï¼Œä»…ä¾›ä¸ªäººä½¿ç”¨ã€‚\nlinux history # linux 0.11 linux 0.95 å®ç°è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ linux 0.96 å®ç°ç½‘ç»œæ¥å£ linux # linuxé‡‡ç”¨åˆ†æ®µ+åˆ†é¡µæœºåˆ¶ç»“åˆç®¡ç†å†…å­˜\nlinux è°ƒè¯•æ–¹æ³• # linux0.11 è°ƒè¯•æ–¹æ³• gdb tools/system target remote localhost:1234 gdbå¸¸ç”¨å‘½ä»¤ b: ä¸‹ä¸­æ–·é» info b :u åˆ—å‡ºç›®å‰ä¸­æ–­ç‚¹ï¼Œä¹Ÿå¯ç®€å†™æˆ\u0026#34;i b\u0026#34; continue(c) ç»§ç»­æ‰§è¡Œç›´åˆ°ä¸‹ä¸€ä¸ªä¸­æ–­ç‚¹æˆ–ç»“æŸ list(l): åˆ—å‡ºç›®å‰ä¸Šä¸‹æ–‡ step(s): å•æ­¥ (ä¼šè¿›å…¥ funciton) next(n) : å•æ­¥ (ä¸ä¼šè¿›å…¥ funciton) until(u) è·³ç¦»ä¸€ä¸ª while for å¾ªç¯ print(p): æ˜¾ç¤ºæŸå˜é‡ï¼Œå¦‚ p str info register(i r) : æ˜¾ç¤º CPU çš„ register GDB æ‰“å°å‡ºå†…å­˜ä¸­çš„å…§å®¹ï¼Œæ ¼å¼ç‚º x/nyzï¼Œå…¶ä¸­ n: è¦å°å‡ºçš„æ•¸é‡ y: æ˜¾ç¤ºçš„æ ¼å¼ï¼Œå¯ä¸ºC( char), d(æ•´æ•°), x(hex) z: å•ä½ï¼Œå¯ä¸º b(byte), h(16bit), w(32bit) cgdb\tå¯æ˜¾ç¤ºä¸ºä¸ŠåŠéƒ¨åˆ†ä¸ºä»£ç ï¼Œä¸‹åŠéƒ¨åˆ†å‘½ä»¤éƒ¨åˆ† cgdb tools/system* [linux-0.11å¯åŠ¨è¿‡ç¨‹æè¿°](http://labrick.cc/2015/08/13/linux-0-11-boot/) * [Linux0.11å¯åŠ¨è¿‡ç¨‹](http://linux.chinaunix.net/techdoc/install/2007/04/10/954810.shtml) * [80386ä¿æŠ¤æ¨¡å¼çš„æœ¬è´¨](http://www.jianshu.com/p/1cea7dc5d6b7) * [linuxè™šæ‹Ÿåœ°å€åˆ°çº¿æ€§åœ°å€çš„è½¬åŒ–](http://luodw.cc/2016/02/17/address/) * [Linuxå†…å­˜å¯»å€ä¹‹åˆ†æ®µæœºåˆ¶-linuxå›é¿äº†åˆ†æ®µæœºåˆ¶](http://blog.xiaohansong.com/2015/10/03/Linux%E5%86%85%E5%AD%98%E5%AF%BB%E5%9D%80%E4%B9%8B%E5%88%86%E6%AE%B5%E6%9C%BA%E5%88%B6/) * [Linuxå†…å­˜å¯»å€ä¹‹åˆ†é¡µæœºåˆ¶/](http://blog.xiaohansong.com/2015/10/05/Linux%E5%86%85%E5%AD%98%E5%AF%BB%E5%9D%80%E4%B9%8B%E5%88%86%E9%A1%B5%E6%9C%BA%E5%88%B6/) * [é€»è¾‘åœ°å€ã€çº¿æ€§åœ°å€ã€ç‰©ç†åœ°å€å’Œè™šæ‹Ÿåœ°å€](http://www.voidcn.com/blog/will130/article/p-5705051.html) * [Intel 80386 ç¨‹åºå‘˜å‚è€ƒæ‰‹å†Œ](http://www.kancloud.cn/wizardforcel/intel-80386-ref-manual/123838) * [linux0.11å†…æ ¸ä¹‹æ–‡ä»¶ç³»ç»Ÿ](http://harpsword.leanote.com/post/Untitled-563d6103ab6441584f000164) source # 80386å†…å­˜è®¿é—®å…¬å¼ # 32ä½çº¿æ€§åœ°å€ = æ®µåŸºåœ°å€(32ä½) + æ®µå†…åç§»(32ä½)\n48bit = 16 + 32 16ä½åœ°æ®µé€‰æ‹©å­ + 32è™šæ‹Ÿåœ°å€ -\u0026gt; 32çº¿æ€§åœ°å€ 32çº¿æ€§åœ°å€ -\u0026gt; ç‰©ç†åœ°å€\n"}]